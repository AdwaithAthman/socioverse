import{Y as hooks,j as jsxRuntimeExports,C as CONSTANTS_COMMON,u as useSelector,r as reactExports,a as useDispatch,Q,T as TOAST_ACTION,t as setSelectedChat,Z as setFetchUserChatsAgain,b as react,_ as ChatLoading,$ as searchUsers,k,A as AiOutlineCloseCircle,L as Link,a0 as ConfirmDeleteToast,a1 as setChats,a2 as commonjsGlobal,a3 as getDefaultExportFromCjs,a4 as React,a5 as getAllMessagesFromChat,D as classnames,a6 as InputEmojiWithRef,a7 as ImAttachment,a8 as sendMessageWithImg,a9 as sendMessage,aa as setJoinVideoRoom,ab as FaArrowLeft,v as setOpenVideoCall,q as MdVideoCall,ac as SlOptionsVertical,ad as BiSearchAlt,ae as AiOutlinePlusCircle,m as useNavigate,c as getUserInfo,s as store,d as setCredentials,S as isAxiosError}from"./index-6d813b4e.js";import{u as updateGroupChat,a as addGroupDp,r as removeFromGroup,g as groupRemove,f as fetchOtherUserChat,c as createGroupChat,b as fetchChats}from"./index-fe2a000f.js";const getSender=(e,r)=>r[0]._id===e?r[1]:r[0],groupByDate=e=>e.reduce((r,s)=>{const d=hooks(s.createdAt).format("LL");return r[d]||(r[d]=[]),r[d].push(s),r},{}),truncate=(e,r)=>{if(!(!e||typeof e!="string"))return e.length<=r?e:e.slice(0,r)+"..."},UserCard=({user:e})=>jsxRuntimeExports.jsx("div",{className:`flex w-full px-4 py-2 mb-5 items-center justify-between transition duration-100 
                                    ease-in-out rounded-lg shadow-md hover:scale-95 hover:rounded-lg cursor-pointer 
                                    bg-[#E8E8E8] hover:bg-blue-gray-600 group`,children:jsxRuntimeExports.jsxs("div",{className:"s) => setLimt-3 flex items-center space-x-2",children:[jsxRuntimeExports.jsx("img",{className:"inline-block h-12 w-12 rounded-full",src:e.dp?e.dp:CONSTANTS_COMMON.DEFAULT_IMG,alt:"user dp"}),jsxRuntimeExports.jsxs("span",{className:"flex flex-col",children:[jsxRuntimeExports.jsx("span",{className:"text-[14px] font-medium text-gray-900 group-hover:text-white group-hover:font-bold",children:e.name}),jsxRuntimeExports.jsxs("span",{className:"text-[11px] font-medium text-gray-500 group-hover:text-white group-hover:font-bold",children:["@",e.username]})]})]})}),AdminGroupEdit=({updateGroup:e,setUpdateGroup:r,handleOpenOptions:s,setDisableUpdate:d,socket:f})=>{const _=useSelector(cE=>cE.chat.selectedChat),C=useSelector(cE=>{var _E;return(_E=cE.auth.user)==null?void 0:_E._id}),[P,x]=reactExports.useState((_==null?void 0:_.chatName)??""),[B,_t]=reactExports.useState(""),[ue,Wt]=reactExports.useState((_==null?void 0:_.users)??[]),[_n,_i]=reactExports.useState(),[Ei,_a]=reactExports.useState([]),[Di,_o]=reactExports.useState(!1),[_s,_c]=reactExports.useState(new FormData),[_m,Qm]=reactExports.useState(new FormData),tE=useDispatch();reactExports.useEffect(()=>{(_==null?void 0:_.chatName)===P&&(_==null?void 0:_.users)===ue?d(!0):d(!1),_n&&d(!1)},[P,ue,_n]),reactExports.useEffect(()=>{let cE;const _E=async()=>{try{_o(!0);const iE=await searchUsers(B);_o(!1),_a(iE.users)}catch{Q.dismiss(),Q.error("Failed to load search results",TOAST_ACTION)}};return B.length>0&&(cE=setTimeout(_E,500)),()=>{clearTimeout(cE)}},[B]),reactExports.useEffect(()=>{e&&aE()},[r,e]);const aE=async()=>{if(P.trim().length===0&&ue.length===0){Q.dismiss(),Q.error("Group name and members cannot be empty",TOAST_ACTION);return}if(P!==(_==null?void 0:_.chatName)&&_s.append("chatName",P),ue!==(_==null?void 0:_.users)){const cE=ue.map(_E=>_E._id);_s.append("users",JSON.stringify(cE))}_n&&_m.append("groupDp",_n);try{let cE;Q.info("Updating group...",{...TOAST_ACTION,autoClose:!1}),(P!==(_==null?void 0:_.chatName)||ue!==(_==null?void 0:_.users))&&(cE=_&&await updateGroupChat(_==null?void 0:_._id,_s)),_n&&(cE=_&&await addGroupDp(_._id,_m)),cE&&tE(setSelectedChat(cE.groupChat)),tE(setFetchUserChatsAgain(!0)),cE&&f.emit("group updation",cE.groupChat),Q.dismiss(),r(!1),Q.success("Group updated successfully",TOAST_ACTION),Qm(new FormData),_c(new FormData),s()}catch{Q.dismiss(),Q.error("Failed to update group",TOAST_ACTION)}},CE=cE=>{Wt(ue.filter(_E=>_E!==cE))},lE=cE=>{if(ue.some(_E=>_E._id===cE._id)){Q.dismiss(),Q.warn("User already added",TOAST_ACTION);return}else Wt([...ue,cE])},gE=cE=>{cE.target.files&&cE.target.files.length>0&&_i(cE.target.files[0])};return jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx(react.Typography,{className:"-mb-2",variant:"h6",children:"Add Image"}),jsxRuntimeExports.jsxs("div",{className:"mx-auto",children:[jsxRuntimeExports.jsx("input",{type:"file",accept:"image/*",id:"newGroup-image",className:"hidden",onChange:gE}),jsxRuntimeExports.jsx("label",{htmlFor:"newGroup-image",children:jsxRuntimeExports.jsx("img",{src:_n instanceof File?URL.createObjectURL(_n):_==null?void 0:_.groupDp,className:"h-36 w-36 rounded-full border-4 border-gray-500 border-dashed bg-white m-2 flex items-center justify-center cursor-pointer p-2"})})]}),jsxRuntimeExports.jsx(react.Typography,{className:"-mb-2",variant:"h6",children:"Group Name"}),jsxRuntimeExports.jsx(react.Input,{label:"Enter the name",size:"lg",value:P,onChange:cE=>x(cE.target.value)}),jsxRuntimeExports.jsx(react.Typography,{className:"-mb-2",variant:"h6",children:"Add Members"}),jsxRuntimeExports.jsx(react.Input,{label:"Enter the members",size:"lg",onChange:cE=>_t(cE.target.value)}),jsxRuntimeExports.jsx("div",{className:"max-h-36 overflow-y-scroll flex items-center justify-center flex-wrap gap-2 no-scrollbar",children:ue.map(cE=>cE._id!==C&&jsxRuntimeExports.jsx("div",{children:jsxRuntimeExports.jsx(react.Chip,{variant:"ghost",animate:{mount:{y:0},unmount:{y:50}},value:cE.name,onClose:()=>CE(cE),className:"rounded-full",color:"green"})},`selected-${cE._id}`))}),Di?jsxRuntimeExports.jsx("div",{className:"overflow-y-hidden flex flex-col gap-4",children:Array(3).fill(0).map((cE,_E)=>jsxRuntimeExports.jsx(ChatLoading,{},_E))}):jsxRuntimeExports.jsx("div",{className:"max-h-64 overflow-y-scroll overflow-x-hidden no-scrollbar mx-4",children:Ei==null?void 0:Ei.slice(0,4).map(cE=>cE._id!==C&&jsxRuntimeExports.jsx("div",{className:"w-full",onClick:()=>lE(cE),children:jsxRuntimeExports.jsx(UserCard,{user:cE})},`search-${cE._id}`))})]})},OptionsDialog=({openOptions:e,handleOpenOptions:r,socket:s})=>{const d=useSelector(Ei=>Ei.chat.selectedChat),f=useSelector(Ei=>{var _a;return(_a=Ei.auth.user)==null?void 0:_a._id}),_=useSelector(Ei=>Ei.chat.chats),[C,P]=reactExports.useState(!1),[x,B]=reactExports.useState(!1),_t=useDispatch(),ue=async()=>{Q.dismiss(),Q(jsxRuntimeExports.jsx(ConfirmDeleteToast,{onDelete:Wt,message:"Are you sure you want to leave this Group?"}),{...TOAST_ACTION,closeButton:!1})},Wt=async()=>{const Ei=d&&f&&await removeFromGroup(d==null?void 0:d._id,f);Ei&&(Ei==null?void 0:Ei.status)==="success"&&(Q.dismiss(),_t(setSelectedChat("")),_t(setChats(_.filter(_a=>_a._id!==(d==null?void 0:d._id)))),Q.success("Successfully left the group"),r())},_n=async()=>{Q.dismiss(),Q(jsxRuntimeExports.jsx(ConfirmDeleteToast,{onDelete:_i,message:"Are you sure you want to delete this group?"}),{...TOAST_ACTION,closeButton:!1})},_i=async()=>{const Ei=d&&await groupRemove(d==null?void 0:d._id);Ei&&(Ei==null?void 0:Ei.status)==="success"&&(Q.dismiss(),_t(setSelectedChat("")),_t(setChats(_.filter(_a=>_a._id!==(d==null?void 0:d._id)))),Q.success("Successfully deleted the group"),r())};return jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children:jsxRuntimeExports.jsxs(react.Dialog,{size:"xs",dismiss:{enabled:!1},open:e,handler:r,className:"bg-transparent shadow-none",children:[jsxRuntimeExports.jsx(k,{}),jsxRuntimeExports.jsxs(react.Card,{className:"mx-auto w-full ",children:[jsxRuntimeExports.jsxs(react.CardBody,{className:"flex flex-col gap-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between",children:[jsxRuntimeExports.jsx("h1",{className:"text-2xl font-medium text-black",children:d!=null&&d.isGroupChat?d.chatName:"User Info"}),jsxRuntimeExports.jsx(AiOutlineCloseCircle,{className:"text-3xl cursor-pointer text-black",onClick:Ei=>{Ei.stopPropagation(),r()}})]}),d&&!d.isGroupChat?jsxRuntimeExports.jsxs("div",{className:"relative h-60 md:h-80 w-60 md:w-80 rounded-md mx-auto overflow-hidden",children:[jsxRuntimeExports.jsx("img",{src:f&&getSender(f,d.users).dp?getSender(f,d.users).dp:CONSTANTS_COMMON.DEFAULT_IMG,alt:"user dp",className:"z-0 h-full w-full rounded-md object-cover"}),jsxRuntimeExports.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-gray-900 to-transparent"}),jsxRuntimeExports.jsxs("div",{className:"absolute bottom-4 left-4 text-left",children:[jsxRuntimeExports.jsx("h1",{className:"text-lg font-semibold text-white",children:f&&getSender(f,d.users).name}),jsxRuntimeExports.jsxs("h1",{className:"text-xs font-light text-white",children:["@",f&&getSender(f,d.users).username]}),jsxRuntimeExports.jsx(Link,{to:`/profile/${f&&getSender(f,d.users)._id}`,children:jsxRuntimeExports.jsx("button",{className:"mt-2 inline-flex cursor-pointer items-center text-sm font-semibold text-white",children:"View Profile â†’"})})]})]}):(d==null?void 0:d.groupAdmin._id)===f?jsxRuntimeExports.jsx(AdminGroupEdit,{updateGroup:C,setUpdateGroup:P,handleOpenOptions:r,setDisableUpdate:B,socket:s}):jsxRuntimeExports.jsxs("div",{className:"max-h-96 overflow-y-scroll overflow-x-hidden no-scrollbar mx-4",children:[jsxRuntimeExports.jsx("img",{src:d==null?void 0:d.groupDp,className:"h-48 w-48 rounded-full border-4 border-gray-500 border-dashed bg-white mx-auto flex items-center justify-center p-2"}),jsxRuntimeExports.jsxs("div",{className:"flex gap-2 items-center mb-2",children:[jsxRuntimeExports.jsx("h1",{className:"text-lg font-medium",children:"Admin"}),jsxRuntimeExports.jsx("span",{className:`inline-flex items-center justify-center px-2 py-1 mr-2 text-xs 
                        font-bold leading-none text-white bg-socioverse-400 rounded-full`,children:d&&(d==null?void 0:d.users.filter(Ei=>Ei._id===d.groupAdmin._id).length)})]}),d==null?void 0:d.users.map(Ei=>Ei._id===d.groupAdmin._id&&jsxRuntimeExports.jsx(UserCard,{user:Ei},Ei._id)),jsxRuntimeExports.jsxs("div",{className:"flex gap-2 items-center mb-2",children:[jsxRuntimeExports.jsx("h1",{className:"text-lg font-medium",children:"Members"}),jsxRuntimeExports.jsx("span",{className:`inline-flex items-center justify-center px-2 py-1 mr-2 text-xs 
                        font-bold leading-none text-white bg-socioverse-400 rounded-full`,children:d&&(d==null?void 0:d.users.filter(Ei=>Ei._id!==d.groupAdmin._id).length)})]}),d==null?void 0:d.users.map(Ei=>Ei._id!==d.groupAdmin._id&&jsxRuntimeExports.jsx(UserCard,{user:Ei},Ei._id))]})]}),(d==null?void 0:d.isGroupChat)&&jsxRuntimeExports.jsx(react.CardFooter,{className:"pt-0",children:d.groupAdmin._id===f?jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between gap-2 float-right",children:[jsxRuntimeExports.jsx(react.Button,{className:" rounded-full text-black border-black hover:border-2 ",variant:"outlined",onClick:()=>P(!0),disabled:x,children:"Update"}),jsxRuntimeExports.jsx(react.Button,{className:" bg-socioverse-400 rounded-full",onClick:_n,children:"Leave"})]}):jsxRuntimeExports.jsx(react.Button,{className:"float-right bg-socioverse-400 rounded-full",onClick:ue,children:"Leave Group"})})]})]})})};var lottie$1={exports:{}};(function(module,exports){typeof navigator<"u"&&function(e,r){module.exports=r()}(commonjsGlobal,function(){var svgNS="http://www.w3.org/2000/svg",locationHref="",_useWebWorker=!1,initialDefaultFrame=-999999,setWebWorker=function(r){_useWebWorker=!!r},getWebWorker=function(){return _useWebWorker},setLocationHref=function(r){locationHref=r},getLocationHref=function(){return locationHref};function createTag(e){return document.createElement(e)}function extendPrototype(e,r){var s,d=e.length,f;for(s=0;s<d;s+=1){f=e[s].prototype;for(var _ in f)Object.prototype.hasOwnProperty.call(f,_)&&(r.prototype[_]=f[_])}}function getDescriptor(e,r){return Object.getOwnPropertyDescriptor(e,r)}function createProxyFunction(e){function r(){}return r.prototype=e,r}var audioControllerFactory=function(){function e(r){this.audios=[],this.audioFactory=r,this._volume=1,this._isMuted=!1}return e.prototype={addAudio:function(s){this.audios.push(s)},pause:function(){var s,d=this.audios.length;for(s=0;s<d;s+=1)this.audios[s].pause()},resume:function(){var s,d=this.audios.length;for(s=0;s<d;s+=1)this.audios[s].resume()},setRate:function(s){var d,f=this.audios.length;for(d=0;d<f;d+=1)this.audios[d].setRate(s)},createAudio:function(s){return this.audioFactory?this.audioFactory(s):window.Howl?new window.Howl({src:[s]}):{isPlaying:!1,play:function(){this.isPlaying=!0},seek:function(){this.isPlaying=!1},playing:function(){},rate:function(){},setVolume:function(){}}},setAudioFactory:function(s){this.audioFactory=s},setVolume:function(s){this._volume=s,this._updateVolume()},mute:function(){this._isMuted=!0,this._updateVolume()},unmute:function(){this._isMuted=!1,this._updateVolume()},getVolume:function(){return this._volume},_updateVolume:function(){var s,d=this.audios.length;for(s=0;s<d;s+=1)this.audios[s].volume(this._volume*(this._isMuted?0:1))}},function(){return new e}}(),createTypedArray=function(){function e(s,d){var f=0,_=[],C;switch(s){case"int16":case"uint8c":C=1;break;default:C=1.1;break}for(f=0;f<d;f+=1)_.push(C);return _}function r(s,d){return s==="float32"?new Float32Array(d):s==="int16"?new Int16Array(d):s==="uint8c"?new Uint8ClampedArray(d):e(s,d)}return typeof Uint8ClampedArray=="function"&&typeof Float32Array=="function"?r:e}();function createSizedArray(e){return Array.apply(null,{length:e})}function _typeof$6(e){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?_typeof$6=function(s){return typeof s}:_typeof$6=function(s){return s&&typeof Symbol=="function"&&s.constructor===Symbol&&s!==Symbol.prototype?"symbol":typeof s},_typeof$6(e)}var subframeEnabled=!0,expressionsPlugin=null,expressionsInterfaces=null,idPrefix$1="",isSafari=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),bmPow=Math.pow,bmSqrt=Math.sqrt,bmFloor=Math.floor,bmMax=Math.max,bmMin=Math.min,BMMath={};(function(){var e=["abs","acos","acosh","asin","asinh","atan","atanh","atan2","ceil","cbrt","expm1","clz32","cos","cosh","exp","floor","fround","hypot","imul","log","log1p","log2","log10","max","min","pow","random","round","sign","sin","sinh","sqrt","tan","tanh","trunc","E","LN10","LN2","LOG10E","LOG2E","PI","SQRT1_2","SQRT2"],r,s=e.length;for(r=0;r<s;r+=1)BMMath[e[r]]=Math[e[r]]})(),BMMath.random=Math.random,BMMath.abs=function(e){var r=_typeof$6(e);if(r==="object"&&e.length){var s=createSizedArray(e.length),d,f=e.length;for(d=0;d<f;d+=1)s[d]=Math.abs(e[d]);return s}return Math.abs(e)};var defaultCurveSegments=150,degToRads=Math.PI/180,roundCorner=.5519;function styleDiv(e){e.style.position="absolute",e.style.top=0,e.style.left=0,e.style.display="block",e.style.transformOrigin="0 0",e.style.webkitTransformOrigin="0 0",e.style.backfaceVisibility="visible",e.style.webkitBackfaceVisibility="visible",e.style.transformStyle="preserve-3d",e.style.webkitTransformStyle="preserve-3d",e.style.mozTransformStyle="preserve-3d"}function BMEnterFrameEvent(e,r,s,d){this.type=e,this.currentTime=r,this.totalTime=s,this.direction=d<0?-1:1}function BMCompleteEvent(e,r){this.type=e,this.direction=r<0?-1:1}function BMCompleteLoopEvent(e,r,s,d){this.type=e,this.currentLoop=s,this.totalLoops=r,this.direction=d<0?-1:1}function BMSegmentStartEvent(e,r,s){this.type=e,this.firstFrame=r,this.totalFrames=s}function BMDestroyEvent(e,r){this.type=e,this.target=r}function BMRenderFrameErrorEvent(e,r){this.type="renderFrameError",this.nativeError=e,this.currentTime=r}function BMConfigErrorEvent(e){this.type="configError",this.nativeError=e}var createElementID=function(){var e=0;return function(){return e+=1,idPrefix$1+"__lottie_element_"+e}}();function HSVtoRGB(e,r,s){var d,f,_,C,P,x,B,_t;switch(C=Math.floor(e*6),P=e*6-C,x=s*(1-r),B=s*(1-P*r),_t=s*(1-(1-P)*r),C%6){case 0:d=s,f=_t,_=x;break;case 1:d=B,f=s,_=x;break;case 2:d=x,f=s,_=_t;break;case 3:d=x,f=B,_=s;break;case 4:d=_t,f=x,_=s;break;case 5:d=s,f=x,_=B;break}return[d,f,_]}function RGBtoHSV(e,r,s){var d=Math.max(e,r,s),f=Math.min(e,r,s),_=d-f,C,P=d===0?0:_/d,x=d/255;switch(d){case f:C=0;break;case e:C=r-s+_*(r<s?6:0),C/=6*_;break;case r:C=s-e+_*2,C/=6*_;break;case s:C=e-r+_*4,C/=6*_;break}return[C,P,x]}function addSaturationToRGB(e,r){var s=RGBtoHSV(e[0]*255,e[1]*255,e[2]*255);return s[1]+=r,s[1]>1?s[1]=1:s[1]<=0&&(s[1]=0),HSVtoRGB(s[0],s[1],s[2])}function addBrightnessToRGB(e,r){var s=RGBtoHSV(e[0]*255,e[1]*255,e[2]*255);return s[2]+=r,s[2]>1?s[2]=1:s[2]<0&&(s[2]=0),HSVtoRGB(s[0],s[1],s[2])}function addHueToRGB(e,r){var s=RGBtoHSV(e[0]*255,e[1]*255,e[2]*255);return s[0]+=r/360,s[0]>1?s[0]-=1:s[0]<0&&(s[0]+=1),HSVtoRGB(s[0],s[1],s[2])}var rgbToHex=function(){var e=[],r,s;for(r=0;r<256;r+=1)s=r.toString(16),e[r]=s.length===1?"0"+s:s;return function(d,f,_){return d<0&&(d=0),f<0&&(f=0),_<0&&(_=0),"#"+e[d]+e[f]+e[_]}}(),setSubframeEnabled=function(r){subframeEnabled=!!r},getSubframeEnabled=function(){return subframeEnabled},setExpressionsPlugin=function(r){expressionsPlugin=r},getExpressionsPlugin=function(){return expressionsPlugin},setExpressionInterfaces=function(r){expressionsInterfaces=r},getExpressionInterfaces=function(){return expressionsInterfaces},setDefaultCurveSegments=function(r){defaultCurveSegments=r},getDefaultCurveSegments=function(){return defaultCurveSegments},setIdPrefix=function(r){idPrefix$1=r};function createNS(e){return document.createElementNS(svgNS,e)}function _typeof$5(e){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?_typeof$5=function(s){return typeof s}:_typeof$5=function(s){return s&&typeof Symbol=="function"&&s.constructor===Symbol&&s!==Symbol.prototype?"symbol":typeof s},_typeof$5(e)}var dataManager=function(){var e=1,r=[],s,d,f={onmessage:function(){},postMessage:function(_n){s({data:_n})}},_={postMessage:function(_n){f.onmessage({data:_n})}};function C(Wt){if(window.Worker&&window.Blob&&getWebWorker()){var _n=new Blob(["var _workerSelf = self; self.onmessage = ",Wt.toString()],{type:"text/javascript"}),_i=URL.createObjectURL(_n);return new Worker(_i)}return s=Wt,f}function P(){d||(d=C(function(_n){function _i(){function _a(rE,vf){var Fg,_d,_f=rE.length,uE,dE,IE,DE;for(_d=0;_d<_f;_d+=1)if(Fg=rE[_d],"ks"in Fg&&!Fg.completed){if(Fg.completed=!0,Fg.hasMask){var GE=Fg.masksProperties;for(dE=GE.length,uE=0;uE<dE;uE+=1)if(GE[uE].pt.k.i)_m(GE[uE].pt.k);else for(DE=GE[uE].pt.k.length,IE=0;IE<DE;IE+=1)GE[uE].pt.k[IE].s&&_m(GE[uE].pt.k[IE].s[0]),GE[uE].pt.k[IE].e&&_m(GE[uE].pt.k[IE].e[0])}Fg.ty===0?(Fg.layers=_s(Fg.refId,vf),_a(Fg.layers,vf)):Fg.ty===4?_c(Fg.shapes):Fg.ty===5&&_E(Fg)}}function Di(rE,vf){if(rE){var Fg=0,_d=rE.length;for(Fg=0;Fg<_d;Fg+=1)rE[Fg].t===1&&(rE[Fg].data.layers=_s(rE[Fg].data.refId,vf),_a(rE[Fg].data.layers,vf))}}function _o(rE,vf){for(var Fg=0,_d=vf.length;Fg<_d;){if(vf[Fg].id===rE)return vf[Fg];Fg+=1}return null}function _s(rE,vf){var Fg=_o(rE,vf);return Fg?Fg.layers.__used?JSON.parse(JSON.stringify(Fg.layers)):(Fg.layers.__used=!0,Fg.layers):null}function _c(rE){var vf,Fg=rE.length,_d,_f;for(vf=Fg-1;vf>=0;vf-=1)if(rE[vf].ty==="sh")if(rE[vf].ks.k.i)_m(rE[vf].ks.k);else for(_f=rE[vf].ks.k.length,_d=0;_d<_f;_d+=1)rE[vf].ks.k[_d].s&&_m(rE[vf].ks.k[_d].s[0]),rE[vf].ks.k[_d].e&&_m(rE[vf].ks.k[_d].e[0]);else rE[vf].ty==="gr"&&_c(rE[vf].it)}function _m(rE){var vf,Fg=rE.i.length;for(vf=0;vf<Fg;vf+=1)rE.i[vf][0]+=rE.v[vf][0],rE.i[vf][1]+=rE.v[vf][1],rE.o[vf][0]+=rE.v[vf][0],rE.o[vf][1]+=rE.v[vf][1]}function Qm(rE,vf){var Fg=vf?vf.split("."):[100,100,100];return rE[0]>Fg[0]?!0:Fg[0]>rE[0]?!1:rE[1]>Fg[1]?!0:Fg[1]>rE[1]?!1:rE[2]>Fg[2]?!0:Fg[2]>rE[2]?!1:null}var tE=function(){var rE=[4,4,14];function vf(_d){var _f=_d.t.d;_d.t.d={k:[{s:_f,t:0}]}}function Fg(_d){var _f,uE=_d.length;for(_f=0;_f<uE;_f+=1)_d[_f].ty===5&&vf(_d[_f])}return function(_d){if(Qm(rE,_d.v)&&(Fg(_d.layers),_d.assets)){var _f,uE=_d.assets.length;for(_f=0;_f<uE;_f+=1)_d.assets[_f].layers&&Fg(_d.assets[_f].layers)}}}(),aE=function(){var rE=[4,7,99];return function(vf){if(vf.chars&&!Qm(rE,vf.v)){var Fg,_d=vf.chars.length;for(Fg=0;Fg<_d;Fg+=1){var _f=vf.chars[Fg];_f.data&&_f.data.shapes&&(_c(_f.data.shapes),_f.data.ip=0,_f.data.op=99999,_f.data.st=0,_f.data.sr=1,_f.data.ks={p:{k:[0,0],a:0},s:{k:[100,100],a:0},a:{k:[0,0],a:0},r:{k:0,a:0},o:{k:100,a:0}},vf.chars[Fg].t||(_f.data.shapes.push({ty:"no"}),_f.data.shapes[0].it.push({p:{k:[0,0],a:0},s:{k:[100,100],a:0},a:{k:[0,0],a:0},r:{k:0,a:0},o:{k:100,a:0},sk:{k:0,a:0},sa:{k:0,a:0},ty:"tr"})))}}}}(),CE=function(){var rE=[5,7,15];function vf(_d){var _f=_d.t.p;typeof _f.a=="number"&&(_f.a={a:0,k:_f.a}),typeof _f.p=="number"&&(_f.p={a:0,k:_f.p}),typeof _f.r=="number"&&(_f.r={a:0,k:_f.r})}function Fg(_d){var _f,uE=_d.length;for(_f=0;_f<uE;_f+=1)_d[_f].ty===5&&vf(_d[_f])}return function(_d){if(Qm(rE,_d.v)&&(Fg(_d.layers),_d.assets)){var _f,uE=_d.assets.length;for(_f=0;_f<uE;_f+=1)_d.assets[_f].layers&&Fg(_d.assets[_f].layers)}}}(),lE=function(){var rE=[4,1,9];function vf(_d){var _f,uE=_d.length,dE,IE;for(_f=0;_f<uE;_f+=1)if(_d[_f].ty==="gr")vf(_d[_f].it);else if(_d[_f].ty==="fl"||_d[_f].ty==="st")if(_d[_f].c.k&&_d[_f].c.k[0].i)for(IE=_d[_f].c.k.length,dE=0;dE<IE;dE+=1)_d[_f].c.k[dE].s&&(_d[_f].c.k[dE].s[0]/=255,_d[_f].c.k[dE].s[1]/=255,_d[_f].c.k[dE].s[2]/=255,_d[_f].c.k[dE].s[3]/=255),_d[_f].c.k[dE].e&&(_d[_f].c.k[dE].e[0]/=255,_d[_f].c.k[dE].e[1]/=255,_d[_f].c.k[dE].e[2]/=255,_d[_f].c.k[dE].e[3]/=255);else _d[_f].c.k[0]/=255,_d[_f].c.k[1]/=255,_d[_f].c.k[2]/=255,_d[_f].c.k[3]/=255}function Fg(_d){var _f,uE=_d.length;for(_f=0;_f<uE;_f+=1)_d[_f].ty===4&&vf(_d[_f].shapes)}return function(_d){if(Qm(rE,_d.v)&&(Fg(_d.layers),_d.assets)){var _f,uE=_d.assets.length;for(_f=0;_f<uE;_f+=1)_d.assets[_f].layers&&Fg(_d.assets[_f].layers)}}}(),gE=function(){var rE=[4,4,18];function vf(_d){var _f,uE=_d.length,dE,IE;for(_f=uE-1;_f>=0;_f-=1)if(_d[_f].ty==="sh")if(_d[_f].ks.k.i)_d[_f].ks.k.c=_d[_f].closed;else for(IE=_d[_f].ks.k.length,dE=0;dE<IE;dE+=1)_d[_f].ks.k[dE].s&&(_d[_f].ks.k[dE].s[0].c=_d[_f].closed),_d[_f].ks.k[dE].e&&(_d[_f].ks.k[dE].e[0].c=_d[_f].closed);else _d[_f].ty==="gr"&&vf(_d[_f].it)}function Fg(_d){var _f,uE,dE=_d.length,IE,DE,GE,QE;for(uE=0;uE<dE;uE+=1){if(_f=_d[uE],_f.hasMask){var a_=_f.masksProperties;for(DE=a_.length,IE=0;IE<DE;IE+=1)if(a_[IE].pt.k.i)a_[IE].pt.k.c=a_[IE].cl;else for(QE=a_[IE].pt.k.length,GE=0;GE<QE;GE+=1)a_[IE].pt.k[GE].s&&(a_[IE].pt.k[GE].s[0].c=a_[IE].cl),a_[IE].pt.k[GE].e&&(a_[IE].pt.k[GE].e[0].c=a_[IE].cl)}_f.ty===4&&vf(_f.shapes)}}return function(_d){if(Qm(rE,_d.v)&&(Fg(_d.layers),_d.assets)){var _f,uE=_d.assets.length;for(_f=0;_f<uE;_f+=1)_d.assets[_f].layers&&Fg(_d.assets[_f].layers)}}}();function cE(rE){rE.__complete||(lE(rE),tE(rE),aE(rE),CE(rE),gE(rE),_a(rE.layers,rE.assets),Di(rE.chars,rE.assets),rE.__complete=!0)}function _E(rE){rE.t.a.length===0&&"m"in rE.t.p}var iE={};return iE.completeData=cE,iE.checkColors=lE,iE.checkChars=aE,iE.checkPathProperties=CE,iE.checkShapes=gE,iE.completeLayers=_a,iE}if(_.dataManager||(_.dataManager=_i()),_.assetLoader||(_.assetLoader=function(){function _a(_o){var _s=_o.getResponseHeader("content-type");return _s&&_o.responseType==="json"&&_s.indexOf("json")!==-1||_o.response&&_typeof$5(_o.response)==="object"?_o.response:_o.response&&typeof _o.response=="string"?JSON.parse(_o.response):_o.responseText?JSON.parse(_o.responseText):null}function Di(_o,_s,_c,_m){var Qm,tE=new XMLHttpRequest;try{tE.responseType="json"}catch{}tE.onreadystatechange=function(){if(tE.readyState===4)if(tE.status===200)Qm=_a(tE),_c(Qm);else try{Qm=_a(tE),_c(Qm)}catch(aE){_m&&_m(aE)}};try{tE.open(["G","E","T"].join(""),_o,!0)}catch{tE.open(["G","E","T"].join(""),_s+"/"+_o,!0)}tE.send()}return{load:Di}}()),_n.data.type==="loadAnimation")_.assetLoader.load(_n.data.path,_n.data.fullPath,function(_a){_.dataManager.completeData(_a),_.postMessage({id:_n.data.id,payload:_a,status:"success"})},function(){_.postMessage({id:_n.data.id,status:"error"})});else if(_n.data.type==="complete"){var Ei=_n.data.animation;_.dataManager.completeData(Ei),_.postMessage({id:_n.data.id,payload:Ei,status:"success"})}else _n.data.type==="loadData"&&_.assetLoader.load(_n.data.path,_n.data.fullPath,function(_a){_.postMessage({id:_n.data.id,payload:_a,status:"success"})},function(){_.postMessage({id:_n.data.id,status:"error"})})}),d.onmessage=function(Wt){var _n=Wt.data,_i=_n.id,Ei=r[_i];r[_i]=null,_n.status==="success"?Ei.onComplete(_n.payload):Ei.onError&&Ei.onError()})}function x(Wt,_n){e+=1;var _i="processId_"+e;return r[_i]={onComplete:Wt,onError:_n},_i}function B(Wt,_n,_i){P();var Ei=x(_n,_i);d.postMessage({type:"loadAnimation",path:Wt,fullPath:window.location.origin+window.location.pathname,id:Ei})}function _t(Wt,_n,_i){P();var Ei=x(_n,_i);d.postMessage({type:"loadData",path:Wt,fullPath:window.location.origin+window.location.pathname,id:Ei})}function ue(Wt,_n,_i){P();var Ei=x(_n,_i);d.postMessage({type:"complete",animation:Wt,id:Ei})}return{loadAnimation:B,loadData:_t,completeAnimation:ue}}(),ImagePreloader=function(){var e=function(){var Di=createTag("canvas");Di.width=1,Di.height=1;var _o=Di.getContext("2d");return _o.fillStyle="rgba(0,0,0,0)",_o.fillRect(0,0,1,1),Di}();function r(){this.loadedAssets+=1,this.loadedAssets===this.totalImages&&this.loadedFootagesCount===this.totalFootages&&this.imagesLoadedCb&&this.imagesLoadedCb(null)}function s(){this.loadedFootagesCount+=1,this.loadedAssets===this.totalImages&&this.loadedFootagesCount===this.totalFootages&&this.imagesLoadedCb&&this.imagesLoadedCb(null)}function d(Di,_o,_s){var _c="";if(Di.e)_c=Di.p;else if(_o){var _m=Di.p;_m.indexOf("images/")!==-1&&(_m=_m.split("/")[1]),_c=_o+_m}else _c=_s,_c+=Di.u?Di.u:"",_c+=Di.p;return _c}function f(Di){var _o=0,_s=setInterval((function(){var _c=Di.getBBox();(_c.width||_o>500)&&(this._imageLoaded(),clearInterval(_s)),_o+=1}).bind(this),50)}function _(Di){var _o=d(Di,this.assetsPath,this.path),_s=createNS("image");isSafari?this.testImageLoaded(_s):_s.addEventListener("load",this._imageLoaded,!1),_s.addEventListener("error",(function(){_c.img=e,this._imageLoaded()}).bind(this),!1),_s.setAttributeNS("http://www.w3.org/1999/xlink","href",_o),this._elementHelper.append?this._elementHelper.append(_s):this._elementHelper.appendChild(_s);var _c={img:_s,assetData:Di};return _c}function C(Di){var _o=d(Di,this.assetsPath,this.path),_s=createTag("img");_s.crossOrigin="anonymous",_s.addEventListener("load",this._imageLoaded,!1),_s.addEventListener("error",(function(){_c.img=e,this._imageLoaded()}).bind(this),!1),_s.src=_o;var _c={img:_s,assetData:Di};return _c}function P(Di){var _o={assetData:Di},_s=d(Di,this.assetsPath,this.path);return dataManager.loadData(_s,(function(_c){_o.img=_c,this._footageLoaded()}).bind(this),(function(){_o.img={},this._footageLoaded()}).bind(this)),_o}function x(Di,_o){this.imagesLoadedCb=_o;var _s,_c=Di.length;for(_s=0;_s<_c;_s+=1)Di[_s].layers||(!Di[_s].t||Di[_s].t==="seq"?(this.totalImages+=1,this.images.push(this._createImageData(Di[_s]))):Di[_s].t===3&&(this.totalFootages+=1,this.images.push(this.createFootageData(Di[_s]))))}function B(Di){this.path=Di||""}function _t(Di){this.assetsPath=Di||""}function ue(Di){for(var _o=0,_s=this.images.length;_o<_s;){if(this.images[_o].assetData===Di)return this.images[_o].img;_o+=1}return null}function Wt(){this.imagesLoadedCb=null,this.images.length=0}function _n(){return this.totalImages===this.loadedAssets}function _i(){return this.totalFootages===this.loadedFootagesCount}function Ei(Di,_o){Di==="svg"?(this._elementHelper=_o,this._createImageData=this.createImageData.bind(this)):this._createImageData=this.createImgData.bind(this)}function _a(){this._imageLoaded=r.bind(this),this._footageLoaded=s.bind(this),this.testImageLoaded=f.bind(this),this.createFootageData=P.bind(this),this.assetsPath="",this.path="",this.totalImages=0,this.totalFootages=0,this.loadedAssets=0,this.loadedFootagesCount=0,this.imagesLoadedCb=null,this.images=[]}return _a.prototype={loadAssets:x,setAssetsPath:_t,setPath:B,loadedImages:_n,loadedFootages:_i,destroy:Wt,getAsset:ue,createImgData:C,createImageData:_,imageLoaded:r,footageLoaded:s,setCacheType:Ei},_a}();function BaseEvent(){}BaseEvent.prototype={triggerEvent:function(r,s){if(this._cbs[r])for(var d=this._cbs[r],f=0;f<d.length;f+=1)d[f](s)},addEventListener:function(r,s){return this._cbs[r]||(this._cbs[r]=[]),this._cbs[r].push(s),(function(){this.removeEventListener(r,s)}).bind(this)},removeEventListener:function(r,s){if(!s)this._cbs[r]=null;else if(this._cbs[r]){for(var d=0,f=this._cbs[r].length;d<f;)this._cbs[r][d]===s&&(this._cbs[r].splice(d,1),d-=1,f-=1),d+=1;this._cbs[r].length||(this._cbs[r]=null)}}};var markerParser=function(){function e(r){for(var s=r.split(`\r
`),d={},f,_=0,C=0;C<s.length;C+=1)f=s[C].split(":"),f.length===2&&(d[f[0]]=f[1].trim(),_+=1);if(_===0)throw new Error;return d}return function(r){for(var s=[],d=0;d<r.length;d+=1){var f=r[d],_={time:f.tm,duration:f.dr};try{_.payload=JSON.parse(r[d].cm)}catch{try{_.payload=e(r[d].cm)}catch{_.payload={name:r[d].cm}}}s.push(_)}return s}}(),ProjectInterface=function(){function e(r){this.compositions.push(r)}return function(){function r(s){for(var d=0,f=this.compositions.length;d<f;){if(this.compositions[d].data&&this.compositions[d].data.nm===s)return this.compositions[d].prepareFrame&&this.compositions[d].data.xt&&this.compositions[d].prepareFrame(this.currentFrame),this.compositions[d].compInterface;d+=1}return null}return r.compositions=[],r.currentFrame=0,r.registerComposition=e,r}}(),renderers={},registerRenderer=function(r,s){renderers[r]=s};function getRenderer(e){return renderers[e]}function getRegisteredRenderer(){if(renderers.canvas)return"canvas";for(var e in renderers)if(renderers[e])return e;return""}function _typeof$4(e){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?_typeof$4=function(s){return typeof s}:_typeof$4=function(s){return s&&typeof Symbol=="function"&&s.constructor===Symbol&&s!==Symbol.prototype?"symbol":typeof s},_typeof$4(e)}var AnimationItem=function(){this._cbs=[],this.name="",this.path="",this.isLoaded=!1,this.currentFrame=0,this.currentRawFrame=0,this.firstFrame=0,this.totalFrames=0,this.frameRate=0,this.frameMult=0,this.playSpeed=1,this.playDirection=1,this.playCount=0,this.animationData={},this.assets=[],this.isPaused=!0,this.autoplay=!1,this.loop=!0,this.renderer=null,this.animationID=createElementID(),this.assetsPath="",this.timeCompleted=0,this.segmentPos=0,this.isSubframeEnabled=getSubframeEnabled(),this.segments=[],this._idle=!0,this._completedLoop=!1,this.projectInterface=ProjectInterface(),this.imagePreloader=new ImagePreloader,this.audioController=audioControllerFactory(),this.markers=[],this.configAnimation=this.configAnimation.bind(this),this.onSetupError=this.onSetupError.bind(this),this.onSegmentComplete=this.onSegmentComplete.bind(this),this.drawnFrameEvent=new BMEnterFrameEvent("drawnFrame",0,0,0),this.expressionsPlugin=getExpressionsPlugin()};extendPrototype([BaseEvent],AnimationItem),AnimationItem.prototype.setParams=function(e){(e.wrapper||e.container)&&(this.wrapper=e.wrapper||e.container);var r="svg";e.animType?r=e.animType:e.renderer&&(r=e.renderer);var s=getRenderer(r);this.renderer=new s(this,e.rendererSettings),this.imagePreloader.setCacheType(r,this.renderer.globalData.defs),this.renderer.setProjectInterface(this.projectInterface),this.animType=r,e.loop===""||e.loop===null||e.loop===void 0||e.loop===!0?this.loop=!0:e.loop===!1?this.loop=!1:this.loop=parseInt(e.loop,10),this.autoplay="autoplay"in e?e.autoplay:!0,this.name=e.name?e.name:"",this.autoloadSegments=Object.prototype.hasOwnProperty.call(e,"autoloadSegments")?e.autoloadSegments:!0,this.assetsPath=e.assetsPath,this.initialSegment=e.initialSegment,e.audioFactory&&this.audioController.setAudioFactory(e.audioFactory),e.animationData?this.setupAnimation(e.animationData):e.path&&(e.path.lastIndexOf("\\")!==-1?this.path=e.path.substr(0,e.path.lastIndexOf("\\")+1):this.path=e.path.substr(0,e.path.lastIndexOf("/")+1),this.fileName=e.path.substr(e.path.lastIndexOf("/")+1),this.fileName=this.fileName.substr(0,this.fileName.lastIndexOf(".json")),dataManager.loadAnimation(e.path,this.configAnimation,this.onSetupError))},AnimationItem.prototype.onSetupError=function(){this.trigger("data_failed")},AnimationItem.prototype.setupAnimation=function(e){dataManager.completeAnimation(e,this.configAnimation)},AnimationItem.prototype.setData=function(e,r){r&&_typeof$4(r)!=="object"&&(r=JSON.parse(r));var s={wrapper:e,animationData:r},d=e.attributes;s.path=d.getNamedItem("data-animation-path")?d.getNamedItem("data-animation-path").value:d.getNamedItem("data-bm-path")?d.getNamedItem("data-bm-path").value:d.getNamedItem("bm-path")?d.getNamedItem("bm-path").value:"",s.animType=d.getNamedItem("data-anim-type")?d.getNamedItem("data-anim-type").value:d.getNamedItem("data-bm-type")?d.getNamedItem("data-bm-type").value:d.getNamedItem("bm-type")?d.getNamedItem("bm-type").value:d.getNamedItem("data-bm-renderer")?d.getNamedItem("data-bm-renderer").value:d.getNamedItem("bm-renderer")?d.getNamedItem("bm-renderer").value:getRegisteredRenderer()||"canvas";var f=d.getNamedItem("data-anim-loop")?d.getNamedItem("data-anim-loop").value:d.getNamedItem("data-bm-loop")?d.getNamedItem("data-bm-loop").value:d.getNamedItem("bm-loop")?d.getNamedItem("bm-loop").value:"";f==="false"?s.loop=!1:f==="true"?s.loop=!0:f!==""&&(s.loop=parseInt(f,10));var _=d.getNamedItem("data-anim-autoplay")?d.getNamedItem("data-anim-autoplay").value:d.getNamedItem("data-bm-autoplay")?d.getNamedItem("data-bm-autoplay").value:d.getNamedItem("bm-autoplay")?d.getNamedItem("bm-autoplay").value:!0;s.autoplay=_!=="false",s.name=d.getNamedItem("data-name")?d.getNamedItem("data-name").value:d.getNamedItem("data-bm-name")?d.getNamedItem("data-bm-name").value:d.getNamedItem("bm-name")?d.getNamedItem("bm-name").value:"";var C=d.getNamedItem("data-anim-prerender")?d.getNamedItem("data-anim-prerender").value:d.getNamedItem("data-bm-prerender")?d.getNamedItem("data-bm-prerender").value:d.getNamedItem("bm-prerender")?d.getNamedItem("bm-prerender").value:"";C==="false"&&(s.prerender=!1),s.path?this.setParams(s):this.trigger("destroy")},AnimationItem.prototype.includeLayers=function(e){e.op>this.animationData.op&&(this.animationData.op=e.op,this.totalFrames=Math.floor(e.op-this.animationData.ip));var r=this.animationData.layers,s,d=r.length,f=e.layers,_,C=f.length;for(_=0;_<C;_+=1)for(s=0;s<d;){if(r[s].id===f[_].id){r[s]=f[_];break}s+=1}if((e.chars||e.fonts)&&(this.renderer.globalData.fontManager.addChars(e.chars),this.renderer.globalData.fontManager.addFonts(e.fonts,this.renderer.globalData.defs)),e.assets)for(d=e.assets.length,s=0;s<d;s+=1)this.animationData.assets.push(e.assets[s]);this.animationData.__complete=!1,dataManager.completeAnimation(this.animationData,this.onSegmentComplete)},AnimationItem.prototype.onSegmentComplete=function(e){this.animationData=e;var r=getExpressionsPlugin();r&&r.initExpressions(this),this.loadNextSegment()},AnimationItem.prototype.loadNextSegment=function(){var e=this.animationData.segments;if(!e||e.length===0||!this.autoloadSegments){this.trigger("data_ready"),this.timeCompleted=this.totalFrames;return}var r=e.shift();this.timeCompleted=r.time*this.frameRate;var s=this.path+this.fileName+"_"+this.segmentPos+".json";this.segmentPos+=1,dataManager.loadData(s,this.includeLayers.bind(this),(function(){this.trigger("data_failed")}).bind(this))},AnimationItem.prototype.loadSegments=function(){var e=this.animationData.segments;e||(this.timeCompleted=this.totalFrames),this.loadNextSegment()},AnimationItem.prototype.imagesLoaded=function(){this.trigger("loaded_images"),this.checkLoaded()},AnimationItem.prototype.preloadImages=function(){this.imagePreloader.setAssetsPath(this.assetsPath),this.imagePreloader.setPath(this.path),this.imagePreloader.loadAssets(this.animationData.assets,this.imagesLoaded.bind(this))},AnimationItem.prototype.configAnimation=function(e){if(this.renderer)try{this.animationData=e,this.initialSegment?(this.totalFrames=Math.floor(this.initialSegment[1]-this.initialSegment[0]),this.firstFrame=Math.round(this.initialSegment[0])):(this.totalFrames=Math.floor(this.animationData.op-this.animationData.ip),this.firstFrame=Math.round(this.animationData.ip)),this.renderer.configAnimation(e),e.assets||(e.assets=[]),this.assets=this.animationData.assets,this.frameRate=this.animationData.fr,this.frameMult=this.animationData.fr/1e3,this.renderer.searchExtraCompositions(e.assets),this.markers=markerParser(e.markers||[]),this.trigger("config_ready"),this.preloadImages(),this.loadSegments(),this.updaFrameModifier(),this.waitForFontsLoaded(),this.isPaused&&this.audioController.pause()}catch(r){this.triggerConfigError(r)}},AnimationItem.prototype.waitForFontsLoaded=function(){this.renderer&&(this.renderer.globalData.fontManager.isLoaded?this.checkLoaded():setTimeout(this.waitForFontsLoaded.bind(this),20))},AnimationItem.prototype.checkLoaded=function(){if(!this.isLoaded&&this.renderer.globalData.fontManager.isLoaded&&(this.imagePreloader.loadedImages()||this.renderer.rendererType!=="canvas")&&this.imagePreloader.loadedFootages()){this.isLoaded=!0;var e=getExpressionsPlugin();e&&e.initExpressions(this),this.renderer.initItems(),setTimeout((function(){this.trigger("DOMLoaded")}).bind(this),0),this.gotoFrame(),this.autoplay&&this.play()}},AnimationItem.prototype.resize=function(e,r){var s=typeof e=="number"?e:void 0,d=typeof r=="number"?r:void 0;this.renderer.updateContainerSize(s,d)},AnimationItem.prototype.setSubframe=function(e){this.isSubframeEnabled=!!e},AnimationItem.prototype.gotoFrame=function(){this.currentFrame=this.isSubframeEnabled?this.currentRawFrame:~~this.currentRawFrame,this.timeCompleted!==this.totalFrames&&this.currentFrame>this.timeCompleted&&(this.currentFrame=this.timeCompleted),this.trigger("enterFrame"),this.renderFrame(),this.trigger("drawnFrame")},AnimationItem.prototype.renderFrame=function(){if(!(this.isLoaded===!1||!this.renderer))try{this.expressionsPlugin&&this.expressionsPlugin.resetFrame(),this.renderer.renderFrame(this.currentFrame+this.firstFrame)}catch(e){this.triggerRenderFrameError(e)}},AnimationItem.prototype.play=function(e){e&&this.name!==e||this.isPaused===!0&&(this.isPaused=!1,this.trigger("_play"),this.audioController.resume(),this._idle&&(this._idle=!1,this.trigger("_active")))},AnimationItem.prototype.pause=function(e){e&&this.name!==e||this.isPaused===!1&&(this.isPaused=!0,this.trigger("_pause"),this._idle=!0,this.trigger("_idle"),this.audioController.pause())},AnimationItem.prototype.togglePause=function(e){e&&this.name!==e||(this.isPaused===!0?this.play():this.pause())},AnimationItem.prototype.stop=function(e){e&&this.name!==e||(this.pause(),this.playCount=0,this._completedLoop=!1,this.setCurrentRawFrameValue(0))},AnimationItem.prototype.getMarkerData=function(e){for(var r,s=0;s<this.markers.length;s+=1)if(r=this.markers[s],r.payload&&r.payload.name===e)return r;return null},AnimationItem.prototype.goToAndStop=function(e,r,s){if(!(s&&this.name!==s)){var d=Number(e);if(isNaN(d)){var f=this.getMarkerData(e);f&&this.goToAndStop(f.time,!0)}else r?this.setCurrentRawFrameValue(e):this.setCurrentRawFrameValue(e*this.frameModifier);this.pause()}},AnimationItem.prototype.goToAndPlay=function(e,r,s){if(!(s&&this.name!==s)){var d=Number(e);if(isNaN(d)){var f=this.getMarkerData(e);f&&(f.duration?this.playSegments([f.time,f.time+f.duration],!0):this.goToAndStop(f.time,!0))}else this.goToAndStop(d,r,s);this.play()}},AnimationItem.prototype.advanceTime=function(e){if(!(this.isPaused===!0||this.isLoaded===!1)){var r=this.currentRawFrame+e*this.frameModifier,s=!1;r>=this.totalFrames-1&&this.frameModifier>0?!this.loop||this.playCount===this.loop?this.checkSegments(r>this.totalFrames?r%this.totalFrames:0)||(s=!0,r=this.totalFrames-1):r>=this.totalFrames?(this.playCount+=1,this.checkSegments(r%this.totalFrames)||(this.setCurrentRawFrameValue(r%this.totalFrames),this._completedLoop=!0,this.trigger("loopComplete"))):this.setCurrentRawFrameValue(r):r<0?this.checkSegments(r%this.totalFrames)||(this.loop&&!(this.playCount--<=0&&this.loop!==!0)?(this.setCurrentRawFrameValue(this.totalFrames+r%this.totalFrames),this._completedLoop?this.trigger("loopComplete"):this._completedLoop=!0):(s=!0,r=0)):this.setCurrentRawFrameValue(r),s&&(this.setCurrentRawFrameValue(r),this.pause(),this.trigger("complete"))}},AnimationItem.prototype.adjustSegment=function(e,r){this.playCount=0,e[1]<e[0]?(this.frameModifier>0&&(this.playSpeed<0?this.setSpeed(-this.playSpeed):this.setDirection(-1)),this.totalFrames=e[0]-e[1],this.timeCompleted=this.totalFrames,this.firstFrame=e[1],this.setCurrentRawFrameValue(this.totalFrames-.001-r)):e[1]>e[0]&&(this.frameModifier<0&&(this.playSpeed<0?this.setSpeed(-this.playSpeed):this.setDirection(1)),this.totalFrames=e[1]-e[0],this.timeCompleted=this.totalFrames,this.firstFrame=e[0],this.setCurrentRawFrameValue(.001+r)),this.trigger("segmentStart")},AnimationItem.prototype.setSegment=function(e,r){var s=-1;this.isPaused&&(this.currentRawFrame+this.firstFrame<e?s=e:this.currentRawFrame+this.firstFrame>r&&(s=r-e)),this.firstFrame=e,this.totalFrames=r-e,this.timeCompleted=this.totalFrames,s!==-1&&this.goToAndStop(s,!0)},AnimationItem.prototype.playSegments=function(e,r){if(r&&(this.segments.length=0),_typeof$4(e[0])==="object"){var s,d=e.length;for(s=0;s<d;s+=1)this.segments.push(e[s])}else this.segments.push(e);this.segments.length&&r&&this.adjustSegment(this.segments.shift(),0),this.isPaused&&this.play()},AnimationItem.prototype.resetSegments=function(e){this.segments.length=0,this.segments.push([this.animationData.ip,this.animationData.op]),e&&this.checkSegments(0)},AnimationItem.prototype.checkSegments=function(e){return this.segments.length?(this.adjustSegment(this.segments.shift(),e),!0):!1},AnimationItem.prototype.destroy=function(e){e&&this.name!==e||!this.renderer||(this.renderer.destroy(),this.imagePreloader.destroy(),this.trigger("destroy"),this._cbs=null,this.onEnterFrame=null,this.onLoopComplete=null,this.onComplete=null,this.onSegmentStart=null,this.onDestroy=null,this.renderer=null,this.expressionsPlugin=null,this.imagePreloader=null,this.projectInterface=null)},AnimationItem.prototype.setCurrentRawFrameValue=function(e){this.currentRawFrame=e,this.gotoFrame()},AnimationItem.prototype.setSpeed=function(e){this.playSpeed=e,this.updaFrameModifier()},AnimationItem.prototype.setDirection=function(e){this.playDirection=e<0?-1:1,this.updaFrameModifier()},AnimationItem.prototype.setLoop=function(e){this.loop=e},AnimationItem.prototype.setVolume=function(e,r){r&&this.name!==r||this.audioController.setVolume(e)},AnimationItem.prototype.getVolume=function(){return this.audioController.getVolume()},AnimationItem.prototype.mute=function(e){e&&this.name!==e||this.audioController.mute()},AnimationItem.prototype.unmute=function(e){e&&this.name!==e||this.audioController.unmute()},AnimationItem.prototype.updaFrameModifier=function(){this.frameModifier=this.frameMult*this.playSpeed*this.playDirection,this.audioController.setRate(this.playSpeed*this.playDirection)},AnimationItem.prototype.getPath=function(){return this.path},AnimationItem.prototype.getAssetsPath=function(e){var r="";if(e.e)r=e.p;else if(this.assetsPath){var s=e.p;s.indexOf("images/")!==-1&&(s=s.split("/")[1]),r=this.assetsPath+s}else r=this.path,r+=e.u?e.u:"",r+=e.p;return r},AnimationItem.prototype.getAssetData=function(e){for(var r=0,s=this.assets.length;r<s;){if(e===this.assets[r].id)return this.assets[r];r+=1}return null},AnimationItem.prototype.hide=function(){this.renderer.hide()},AnimationItem.prototype.show=function(){this.renderer.show()},AnimationItem.prototype.getDuration=function(e){return e?this.totalFrames:this.totalFrames/this.frameRate},AnimationItem.prototype.updateDocumentData=function(e,r,s){try{var d=this.renderer.getElementByPath(e);d.updateDocumentData(r,s)}catch{}},AnimationItem.prototype.trigger=function(e){if(this._cbs&&this._cbs[e])switch(e){case"enterFrame":this.triggerEvent(e,new BMEnterFrameEvent(e,this.currentFrame,this.totalFrames,this.frameModifier));break;case"drawnFrame":this.drawnFrameEvent.currentTime=this.currentFrame,this.drawnFrameEvent.totalTime=this.totalFrames,this.drawnFrameEvent.direction=this.frameModifier,this.triggerEvent(e,this.drawnFrameEvent);break;case"loopComplete":this.triggerEvent(e,new BMCompleteLoopEvent(e,this.loop,this.playCount,this.frameMult));break;case"complete":this.triggerEvent(e,new BMCompleteEvent(e,this.frameMult));break;case"segmentStart":this.triggerEvent(e,new BMSegmentStartEvent(e,this.firstFrame,this.totalFrames));break;case"destroy":this.triggerEvent(e,new BMDestroyEvent(e,this));break;default:this.triggerEvent(e)}e==="enterFrame"&&this.onEnterFrame&&this.onEnterFrame.call(this,new BMEnterFrameEvent(e,this.currentFrame,this.totalFrames,this.frameMult)),e==="loopComplete"&&this.onLoopComplete&&this.onLoopComplete.call(this,new BMCompleteLoopEvent(e,this.loop,this.playCount,this.frameMult)),e==="complete"&&this.onComplete&&this.onComplete.call(this,new BMCompleteEvent(e,this.frameMult)),e==="segmentStart"&&this.onSegmentStart&&this.onSegmentStart.call(this,new BMSegmentStartEvent(e,this.firstFrame,this.totalFrames)),e==="destroy"&&this.onDestroy&&this.onDestroy.call(this,new BMDestroyEvent(e,this))},AnimationItem.prototype.triggerRenderFrameError=function(e){var r=new BMRenderFrameErrorEvent(e,this.currentFrame);this.triggerEvent("error",r),this.onError&&this.onError.call(this,r)},AnimationItem.prototype.triggerConfigError=function(e){var r=new BMConfigErrorEvent(e,this.currentFrame);this.triggerEvent("error",r),this.onError&&this.onError.call(this,r)};var animationManager=function(){var e={},r=[],s=0,d=0,f=0,_=!0,C=!1;function P(vf){for(var Fg=0,_d=vf.target;Fg<d;)r[Fg].animation===_d&&(r.splice(Fg,1),Fg-=1,d-=1,_d.isPaused||ue()),Fg+=1}function x(vf,Fg){if(!vf)return null;for(var _d=0;_d<d;){if(r[_d].elem===vf&&r[_d].elem!==null)return r[_d].animation;_d+=1}var _f=new AnimationItem;return Wt(_f,vf),_f.setData(vf,Fg),_f}function B(){var vf,Fg=r.length,_d=[];for(vf=0;vf<Fg;vf+=1)_d.push(r[vf].animation);return _d}function _t(){f+=1,lE()}function ue(){f-=1}function Wt(vf,Fg){vf.addEventListener("destroy",P),vf.addEventListener("_active",_t),vf.addEventListener("_idle",ue),r.push({elem:Fg,animation:vf}),d+=1}function _n(vf){var Fg=new AnimationItem;return Wt(Fg,null),Fg.setParams(vf),Fg}function _i(vf,Fg){var _d;for(_d=0;_d<d;_d+=1)r[_d].animation.setSpeed(vf,Fg)}function Ei(vf,Fg){var _d;for(_d=0;_d<d;_d+=1)r[_d].animation.setDirection(vf,Fg)}function _a(vf){var Fg;for(Fg=0;Fg<d;Fg+=1)r[Fg].animation.play(vf)}function Di(vf){var Fg=vf-s,_d;for(_d=0;_d<d;_d+=1)r[_d].animation.advanceTime(Fg);s=vf,f&&!C?window.requestAnimationFrame(Di):_=!0}function _o(vf){s=vf,window.requestAnimationFrame(Di)}function _s(vf){var Fg;for(Fg=0;Fg<d;Fg+=1)r[Fg].animation.pause(vf)}function _c(vf,Fg,_d){var _f;for(_f=0;_f<d;_f+=1)r[_f].animation.goToAndStop(vf,Fg,_d)}function _m(vf){var Fg;for(Fg=0;Fg<d;Fg+=1)r[Fg].animation.stop(vf)}function Qm(vf){var Fg;for(Fg=0;Fg<d;Fg+=1)r[Fg].animation.togglePause(vf)}function tE(vf){var Fg;for(Fg=d-1;Fg>=0;Fg-=1)r[Fg].animation.destroy(vf)}function aE(vf,Fg,_d){var _f=[].concat([].slice.call(document.getElementsByClassName("lottie")),[].slice.call(document.getElementsByClassName("bodymovin"))),uE,dE=_f.length;for(uE=0;uE<dE;uE+=1)_d&&_f[uE].setAttribute("data-bm-type",_d),x(_f[uE],vf);if(Fg&&dE===0){_d||(_d="svg");var IE=document.getElementsByTagName("body")[0];IE.innerText="";var DE=createTag("div");DE.style.width="100%",DE.style.height="100%",DE.setAttribute("data-bm-type",_d),IE.appendChild(DE),x(DE,vf)}}function CE(){var vf;for(vf=0;vf<d;vf+=1)r[vf].animation.resize()}function lE(){!C&&f&&_&&(window.requestAnimationFrame(_o),_=!1)}function gE(){C=!0}function cE(){C=!1,lE()}function _E(vf,Fg){var _d;for(_d=0;_d<d;_d+=1)r[_d].animation.setVolume(vf,Fg)}function iE(vf){var Fg;for(Fg=0;Fg<d;Fg+=1)r[Fg].animation.mute(vf)}function rE(vf){var Fg;for(Fg=0;Fg<d;Fg+=1)r[Fg].animation.unmute(vf)}return e.registerAnimation=x,e.loadAnimation=_n,e.setSpeed=_i,e.setDirection=Ei,e.play=_a,e.pause=_s,e.stop=_m,e.togglePause=Qm,e.searchAnimations=aE,e.resize=CE,e.goToAndStop=_c,e.destroy=tE,e.freeze=gE,e.unfreeze=cE,e.setVolume=_E,e.mute=iE,e.unmute=rE,e.getRegisteredAnimations=B,e}(),BezierFactory=function(){var e={};e.getBezierEasing=s;var r={};function s(_o,_s,_c,_m,Qm){var tE=Qm||("bez_"+_o+"_"+_s+"_"+_c+"_"+_m).replace(/\./g,"p");if(r[tE])return r[tE];var aE=new Di([_o,_s,_c,_m]);return r[tE]=aE,aE}var d=4,f=.001,_=1e-7,C=10,P=11,x=1/(P-1),B=typeof Float32Array=="function";function _t(_o,_s){return 1-3*_s+3*_o}function ue(_o,_s){return 3*_s-6*_o}function Wt(_o){return 3*_o}function _n(_o,_s,_c){return((_t(_s,_c)*_o+ue(_s,_c))*_o+Wt(_s))*_o}function _i(_o,_s,_c){return 3*_t(_s,_c)*_o*_o+2*ue(_s,_c)*_o+Wt(_s)}function Ei(_o,_s,_c,_m,Qm){var tE,aE,CE=0;do aE=_s+(_c-_s)/2,tE=_n(aE,_m,Qm)-_o,tE>0?_c=aE:_s=aE;while(Math.abs(tE)>_&&++CE<C);return aE}function _a(_o,_s,_c,_m){for(var Qm=0;Qm<d;++Qm){var tE=_i(_s,_c,_m);if(tE===0)return _s;var aE=_n(_s,_c,_m)-_o;_s-=aE/tE}return _s}function Di(_o){this._p=_o,this._mSampleValues=B?new Float32Array(P):new Array(P),this._precomputed=!1,this.get=this.get.bind(this)}return Di.prototype={get:function(_s){var _c=this._p[0],_m=this._p[1],Qm=this._p[2],tE=this._p[3];return this._precomputed||this._precompute(),_c===_m&&Qm===tE?_s:_s===0?0:_s===1?1:_n(this._getTForX(_s),_m,tE)},_precompute:function(){var _s=this._p[0],_c=this._p[1],_m=this._p[2],Qm=this._p[3];this._precomputed=!0,(_s!==_c||_m!==Qm)&&this._calcSampleValues()},_calcSampleValues:function(){for(var _s=this._p[0],_c=this._p[2],_m=0;_m<P;++_m)this._mSampleValues[_m]=_n(_m*x,_s,_c)},_getTForX:function(_s){for(var _c=this._p[0],_m=this._p[2],Qm=this._mSampleValues,tE=0,aE=1,CE=P-1;aE!==CE&&Qm[aE]<=_s;++aE)tE+=x;--aE;var lE=(_s-Qm[aE])/(Qm[aE+1]-Qm[aE]),gE=tE+lE*x,cE=_i(gE,_c,_m);return cE>=f?_a(_s,gE,_c,_m):cE===0?gE:Ei(_s,tE,tE+x,_c,_m)}},e}(),pooling=function(){function e(r){return r.concat(createSizedArray(r.length))}return{double:e}}(),poolFactory=function(){return function(e,r,s){var d=0,f=e,_=createSizedArray(f),C={newElement:P,release:x};function P(){var B;return d?(d-=1,B=_[d]):B=r(),B}function x(B){d===f&&(_=pooling.double(_),f*=2),s&&s(B),_[d]=B,d+=1}return C}}(),bezierLengthPool=function(){function e(){return{addedLength:0,percents:createTypedArray("float32",getDefaultCurveSegments()),lengths:createTypedArray("float32",getDefaultCurveSegments())}}return poolFactory(8,e)}(),segmentsLengthPool=function(){function e(){return{lengths:[],totalLength:0}}function r(s){var d,f=s.lengths.length;for(d=0;d<f;d+=1)bezierLengthPool.release(s.lengths[d]);s.lengths.length=0}return poolFactory(8,e,r)}();function bezFunction(){var e=Math;function r(Wt,_n,_i,Ei,_a,Di){var _o=Wt*Ei+_n*_a+_i*Di-_a*Ei-Di*Wt-_i*_n;return _o>-.001&&_o<.001}function s(Wt,_n,_i,Ei,_a,Di,_o,_s,_c){if(_i===0&&Di===0&&_c===0)return r(Wt,_n,Ei,_a,_o,_s);var _m=e.sqrt(e.pow(Ei-Wt,2)+e.pow(_a-_n,2)+e.pow(Di-_i,2)),Qm=e.sqrt(e.pow(_o-Wt,2)+e.pow(_s-_n,2)+e.pow(_c-_i,2)),tE=e.sqrt(e.pow(_o-Ei,2)+e.pow(_s-_a,2)+e.pow(_c-Di,2)),aE;return _m>Qm?_m>tE?aE=_m-Qm-tE:aE=tE-Qm-_m:tE>Qm?aE=tE-Qm-_m:aE=Qm-_m-tE,aE>-1e-4&&aE<1e-4}var d=function(){return function(Wt,_n,_i,Ei){var _a=getDefaultCurveSegments(),Di,_o,_s,_c,_m,Qm=0,tE,aE=[],CE=[],lE=bezierLengthPool.newElement();for(_s=_i.length,Di=0;Di<_a;Di+=1){for(_m=Di/(_a-1),tE=0,_o=0;_o<_s;_o+=1)_c=bmPow(1-_m,3)*Wt[_o]+3*bmPow(1-_m,2)*_m*_i[_o]+3*(1-_m)*bmPow(_m,2)*Ei[_o]+bmPow(_m,3)*_n[_o],aE[_o]=_c,CE[_o]!==null&&(tE+=bmPow(aE[_o]-CE[_o],2)),CE[_o]=aE[_o];tE&&(tE=bmSqrt(tE),Qm+=tE),lE.percents[Di]=_m,lE.lengths[Di]=Qm}return lE.addedLength=Qm,lE}}();function f(Wt){var _n=segmentsLengthPool.newElement(),_i=Wt.c,Ei=Wt.v,_a=Wt.o,Di=Wt.i,_o,_s=Wt._length,_c=_n.lengths,_m=0;for(_o=0;_o<_s-1;_o+=1)_c[_o]=d(Ei[_o],Ei[_o+1],_a[_o],Di[_o+1]),_m+=_c[_o].addedLength;return _i&&_s&&(_c[_o]=d(Ei[_o],Ei[0],_a[_o],Di[0]),_m+=_c[_o].addedLength),_n.totalLength=_m,_n}function _(Wt){this.segmentLength=0,this.points=new Array(Wt)}function C(Wt,_n){this.partialLength=Wt,this.point=_n}var P=function(){var Wt={};return function(_n,_i,Ei,_a){var Di=(_n[0]+"_"+_n[1]+"_"+_i[0]+"_"+_i[1]+"_"+Ei[0]+"_"+Ei[1]+"_"+_a[0]+"_"+_a[1]).replace(/\./g,"p");if(!Wt[Di]){var _o=getDefaultCurveSegments(),_s,_c,_m,Qm,tE,aE=0,CE,lE,gE=null;_n.length===2&&(_n[0]!==_i[0]||_n[1]!==_i[1])&&r(_n[0],_n[1],_i[0],_i[1],_n[0]+Ei[0],_n[1]+Ei[1])&&r(_n[0],_n[1],_i[0],_i[1],_i[0]+_a[0],_i[1]+_a[1])&&(_o=2);var cE=new _(_o);for(_m=Ei.length,_s=0;_s<_o;_s+=1){for(lE=createSizedArray(_m),tE=_s/(_o-1),CE=0,_c=0;_c<_m;_c+=1)Qm=bmPow(1-tE,3)*_n[_c]+3*bmPow(1-tE,2)*tE*(_n[_c]+Ei[_c])+3*(1-tE)*bmPow(tE,2)*(_i[_c]+_a[_c])+bmPow(tE,3)*_i[_c],lE[_c]=Qm,gE!==null&&(CE+=bmPow(lE[_c]-gE[_c],2));CE=bmSqrt(CE),aE+=CE,cE.points[_s]=new C(CE,lE),gE=lE}cE.segmentLength=aE,Wt[Di]=cE}return Wt[Di]}}();function x(Wt,_n){var _i=_n.percents,Ei=_n.lengths,_a=_i.length,Di=bmFloor((_a-1)*Wt),_o=Wt*_n.addedLength,_s=0;if(Di===_a-1||Di===0||_o===Ei[Di])return _i[Di];for(var _c=Ei[Di]>_o?-1:1,_m=!0;_m;)if(Ei[Di]<=_o&&Ei[Di+1]>_o?(_s=(_o-Ei[Di])/(Ei[Di+1]-Ei[Di]),_m=!1):Di+=_c,Di<0||Di>=_a-1){if(Di===_a-1)return _i[Di];_m=!1}return _i[Di]+(_i[Di+1]-_i[Di])*_s}function B(Wt,_n,_i,Ei,_a,Di){var _o=x(_a,Di),_s=1-_o,_c=e.round((_s*_s*_s*Wt[0]+(_o*_s*_s+_s*_o*_s+_s*_s*_o)*_i[0]+(_o*_o*_s+_s*_o*_o+_o*_s*_o)*Ei[0]+_o*_o*_o*_n[0])*1e3)/1e3,_m=e.round((_s*_s*_s*Wt[1]+(_o*_s*_s+_s*_o*_s+_s*_s*_o)*_i[1]+(_o*_o*_s+_s*_o*_o+_o*_s*_o)*Ei[1]+_o*_o*_o*_n[1])*1e3)/1e3;return[_c,_m]}var _t=createTypedArray("float32",8);function ue(Wt,_n,_i,Ei,_a,Di,_o){_a<0?_a=0:_a>1&&(_a=1);var _s=x(_a,_o);Di=Di>1?1:Di;var _c=x(Di,_o),_m,Qm=Wt.length,tE=1-_s,aE=1-_c,CE=tE*tE*tE,lE=_s*tE*tE*3,gE=_s*_s*tE*3,cE=_s*_s*_s,_E=tE*tE*aE,iE=_s*tE*aE+tE*_s*aE+tE*tE*_c,rE=_s*_s*aE+tE*_s*_c+_s*tE*_c,vf=_s*_s*_c,Fg=tE*aE*aE,_d=_s*aE*aE+tE*_c*aE+tE*aE*_c,_f=_s*_c*aE+tE*_c*_c+_s*aE*_c,uE=_s*_c*_c,dE=aE*aE*aE,IE=_c*aE*aE+aE*_c*aE+aE*aE*_c,DE=_c*_c*aE+aE*_c*_c+_c*aE*_c,GE=_c*_c*_c;for(_m=0;_m<Qm;_m+=1)_t[_m*4]=e.round((CE*Wt[_m]+lE*_i[_m]+gE*Ei[_m]+cE*_n[_m])*1e3)/1e3,_t[_m*4+1]=e.round((_E*Wt[_m]+iE*_i[_m]+rE*Ei[_m]+vf*_n[_m])*1e3)/1e3,_t[_m*4+2]=e.round((Fg*Wt[_m]+_d*_i[_m]+_f*Ei[_m]+uE*_n[_m])*1e3)/1e3,_t[_m*4+3]=e.round((dE*Wt[_m]+IE*_i[_m]+DE*Ei[_m]+GE*_n[_m])*1e3)/1e3;return _t}return{getSegmentsLength:f,getNewSegment:ue,getPointInSegment:B,buildBezierData:P,pointOnLine2D:r,pointOnLine3D:s}}var bez=bezFunction(),initFrame=initialDefaultFrame,mathAbs=Math.abs;function interpolateValue(e,r){var s=this.offsetTime,d;this.propType==="multidimensional"&&(d=createTypedArray("float32",this.pv.length));for(var f=r.lastIndex,_=f,C=this.keyframes.length-1,P=!0,x,B,_t;P;){if(x=this.keyframes[_],B=this.keyframes[_+1],_===C-1&&e>=B.t-s){x.h&&(x=B),f=0;break}if(B.t-s>e){f=_;break}_<C-1?_+=1:(f=0,P=!1)}_t=this.keyframesMetadata[_]||{};var ue,Wt,_n,_i,Ei,_a,Di=B.t-s,_o=x.t-s,_s;if(x.to){_t.bezierData||(_t.bezierData=bez.buildBezierData(x.s,B.s||x.e,x.to,x.ti));var _c=_t.bezierData;if(e>=Di||e<_o){var _m=e>=Di?_c.points.length-1:0;for(Wt=_c.points[_m].point.length,ue=0;ue<Wt;ue+=1)d[ue]=_c.points[_m].point[ue]}else{_t.__fnct?_a=_t.__fnct:(_a=BezierFactory.getBezierEasing(x.o.x,x.o.y,x.i.x,x.i.y,x.n).get,_t.__fnct=_a),_n=_a((e-_o)/(Di-_o));var Qm=_c.segmentLength*_n,tE,aE=r.lastFrame<e&&r._lastKeyframeIndex===_?r._lastAddedLength:0;for(Ei=r.lastFrame<e&&r._lastKeyframeIndex===_?r._lastPoint:0,P=!0,_i=_c.points.length;P;){if(aE+=_c.points[Ei].partialLength,Qm===0||_n===0||Ei===_c.points.length-1){for(Wt=_c.points[Ei].point.length,ue=0;ue<Wt;ue+=1)d[ue]=_c.points[Ei].point[ue];break}else if(Qm>=aE&&Qm<aE+_c.points[Ei+1].partialLength){for(tE=(Qm-aE)/_c.points[Ei+1].partialLength,Wt=_c.points[Ei].point.length,ue=0;ue<Wt;ue+=1)d[ue]=_c.points[Ei].point[ue]+(_c.points[Ei+1].point[ue]-_c.points[Ei].point[ue])*tE;break}Ei<_i-1?Ei+=1:P=!1}r._lastPoint=Ei,r._lastAddedLength=aE-_c.points[Ei].partialLength,r._lastKeyframeIndex=_}}else{var CE,lE,gE,cE,_E;if(C=x.s.length,_s=B.s||x.e,this.sh&&x.h!==1)if(e>=Di)d[0]=_s[0],d[1]=_s[1],d[2]=_s[2];else if(e<=_o)d[0]=x.s[0],d[1]=x.s[1],d[2]=x.s[2];else{var iE=createQuaternion(x.s),rE=createQuaternion(_s),vf=(e-_o)/(Di-_o);quaternionToEuler(d,slerp(iE,rE,vf))}else for(_=0;_<C;_+=1)x.h!==1&&(e>=Di?_n=1:e<_o?_n=0:(x.o.x.constructor===Array?(_t.__fnct||(_t.__fnct=[]),_t.__fnct[_]?_a=_t.__fnct[_]:(CE=x.o.x[_]===void 0?x.o.x[0]:x.o.x[_],lE=x.o.y[_]===void 0?x.o.y[0]:x.o.y[_],gE=x.i.x[_]===void 0?x.i.x[0]:x.i.x[_],cE=x.i.y[_]===void 0?x.i.y[0]:x.i.y[_],_a=BezierFactory.getBezierEasing(CE,lE,gE,cE).get,_t.__fnct[_]=_a)):_t.__fnct?_a=_t.__fnct:(CE=x.o.x,lE=x.o.y,gE=x.i.x,cE=x.i.y,_a=BezierFactory.getBezierEasing(CE,lE,gE,cE).get,x.keyframeMetadata=_a),_n=_a((e-_o)/(Di-_o)))),_s=B.s||x.e,_E=x.h===1?x.s[_]:x.s[_]+(_s[_]-x.s[_])*_n,this.propType==="multidimensional"?d[_]=_E:d=_E}return r.lastIndex=f,d}function slerp(e,r,s){var d=[],f=e[0],_=e[1],C=e[2],P=e[3],x=r[0],B=r[1],_t=r[2],ue=r[3],Wt,_n,_i,Ei,_a;return _n=f*x+_*B+C*_t+P*ue,_n<0&&(_n=-_n,x=-x,B=-B,_t=-_t,ue=-ue),1-_n>1e-6?(Wt=Math.acos(_n),_i=Math.sin(Wt),Ei=Math.sin((1-s)*Wt)/_i,_a=Math.sin(s*Wt)/_i):(Ei=1-s,_a=s),d[0]=Ei*f+_a*x,d[1]=Ei*_+_a*B,d[2]=Ei*C+_a*_t,d[3]=Ei*P+_a*ue,d}function quaternionToEuler(e,r){var s=r[0],d=r[1],f=r[2],_=r[3],C=Math.atan2(2*d*_-2*s*f,1-2*d*d-2*f*f),P=Math.asin(2*s*d+2*f*_),x=Math.atan2(2*s*_-2*d*f,1-2*s*s-2*f*f);e[0]=C/degToRads,e[1]=P/degToRads,e[2]=x/degToRads}function createQuaternion(e){var r=e[0]*degToRads,s=e[1]*degToRads,d=e[2]*degToRads,f=Math.cos(r/2),_=Math.cos(s/2),C=Math.cos(d/2),P=Math.sin(r/2),x=Math.sin(s/2),B=Math.sin(d/2),_t=f*_*C-P*x*B,ue=P*x*C+f*_*B,Wt=P*_*C+f*x*B,_n=f*x*C-P*_*B;return[ue,Wt,_n,_t]}function getValueAtCurrentTime(){var e=this.comp.renderedFrame-this.offsetTime,r=this.keyframes[0].t-this.offsetTime,s=this.keyframes[this.keyframes.length-1].t-this.offsetTime;if(!(e===this._caching.lastFrame||this._caching.lastFrame!==initFrame&&(this._caching.lastFrame>=s&&e>=s||this._caching.lastFrame<r&&e<r))){this._caching.lastFrame>=e&&(this._caching._lastKeyframeIndex=-1,this._caching.lastIndex=0);var d=this.interpolateValue(e,this._caching);this.pv=d}return this._caching.lastFrame=e,this.pv}function setVValue(e){var r;if(this.propType==="unidimensional")r=e*this.mult,mathAbs(this.v-r)>1e-5&&(this.v=r,this._mdf=!0);else for(var s=0,d=this.v.length;s<d;)r=e[s]*this.mult,mathAbs(this.v[s]-r)>1e-5&&(this.v[s]=r,this._mdf=!0),s+=1}function processEffectsSequence(){if(!(this.elem.globalData.frameId===this.frameId||!this.effectsSequence.length)){if(this.lock){this.setVValue(this.pv);return}this.lock=!0,this._mdf=this._isFirstFrame;var e,r=this.effectsSequence.length,s=this.kf?this.pv:this.data.k;for(e=0;e<r;e+=1)s=this.effectsSequence[e](s);this.setVValue(s),this._isFirstFrame=!1,this.lock=!1,this.frameId=this.elem.globalData.frameId}}function addEffect(e){this.effectsSequence.push(e),this.container.addDynamicProperty(this)}function ValueProperty(e,r,s,d){this.propType="unidimensional",this.mult=s||1,this.data=r,this.v=s?r.k*s:r.k,this.pv=r.k,this._mdf=!1,this.elem=e,this.container=d,this.comp=e.comp,this.k=!1,this.kf=!1,this.vel=0,this.effectsSequence=[],this._isFirstFrame=!0,this.getValue=processEffectsSequence,this.setVValue=setVValue,this.addEffect=addEffect}function MultiDimensionalProperty(e,r,s,d){this.propType="multidimensional",this.mult=s||1,this.data=r,this._mdf=!1,this.elem=e,this.container=d,this.comp=e.comp,this.k=!1,this.kf=!1,this.frameId=-1;var f,_=r.k.length;for(this.v=createTypedArray("float32",_),this.pv=createTypedArray("float32",_),this.vel=createTypedArray("float32",_),f=0;f<_;f+=1)this.v[f]=r.k[f]*this.mult,this.pv[f]=r.k[f];this._isFirstFrame=!0,this.effectsSequence=[],this.getValue=processEffectsSequence,this.setVValue=setVValue,this.addEffect=addEffect}function KeyframedValueProperty(e,r,s,d){this.propType="unidimensional",this.keyframes=r.k,this.keyframesMetadata=[],this.offsetTime=e.data.st,this.frameId=-1,this._caching={lastFrame:initFrame,lastIndex:0,value:0,_lastKeyframeIndex:-1},this.k=!0,this.kf=!0,this.data=r,this.mult=s||1,this.elem=e,this.container=d,this.comp=e.comp,this.v=initFrame,this.pv=initFrame,this._isFirstFrame=!0,this.getValue=processEffectsSequence,this.setVValue=setVValue,this.interpolateValue=interpolateValue,this.effectsSequence=[getValueAtCurrentTime.bind(this)],this.addEffect=addEffect}function KeyframedMultidimensionalProperty(e,r,s,d){this.propType="multidimensional";var f,_=r.k.length,C,P,x,B;for(f=0;f<_-1;f+=1)r.k[f].to&&r.k[f].s&&r.k[f+1]&&r.k[f+1].s&&(C=r.k[f].s,P=r.k[f+1].s,x=r.k[f].to,B=r.k[f].ti,(C.length===2&&!(C[0]===P[0]&&C[1]===P[1])&&bez.pointOnLine2D(C[0],C[1],P[0],P[1],C[0]+x[0],C[1]+x[1])&&bez.pointOnLine2D(C[0],C[1],P[0],P[1],P[0]+B[0],P[1]+B[1])||C.length===3&&!(C[0]===P[0]&&C[1]===P[1]&&C[2]===P[2])&&bez.pointOnLine3D(C[0],C[1],C[2],P[0],P[1],P[2],C[0]+x[0],C[1]+x[1],C[2]+x[2])&&bez.pointOnLine3D(C[0],C[1],C[2],P[0],P[1],P[2],P[0]+B[0],P[1]+B[1],P[2]+B[2]))&&(r.k[f].to=null,r.k[f].ti=null),C[0]===P[0]&&C[1]===P[1]&&x[0]===0&&x[1]===0&&B[0]===0&&B[1]===0&&(C.length===2||C[2]===P[2]&&x[2]===0&&B[2]===0)&&(r.k[f].to=null,r.k[f].ti=null));this.effectsSequence=[getValueAtCurrentTime.bind(this)],this.data=r,this.keyframes=r.k,this.keyframesMetadata=[],this.offsetTime=e.data.st,this.k=!0,this.kf=!0,this._isFirstFrame=!0,this.mult=s||1,this.elem=e,this.container=d,this.comp=e.comp,this.getValue=processEffectsSequence,this.setVValue=setVValue,this.interpolateValue=interpolateValue,this.frameId=-1;var _t=r.k[0].s.length;for(this.v=createTypedArray("float32",_t),this.pv=createTypedArray("float32",_t),f=0;f<_t;f+=1)this.v[f]=initFrame,this.pv[f]=initFrame;this._caching={lastFrame:initFrame,lastIndex:0,value:createTypedArray("float32",_t)},this.addEffect=addEffect}var PropertyFactory=function(){function e(s,d,f,_,C){d.sid&&(d=s.globalData.slotManager.getProp(d));var P;if(!d.k.length)P=new ValueProperty(s,d,_,C);else if(typeof d.k[0]=="number")P=new MultiDimensionalProperty(s,d,_,C);else switch(f){case 0:P=new KeyframedValueProperty(s,d,_,C);break;case 1:P=new KeyframedMultidimensionalProperty(s,d,_,C);break}return P.effectsSequence.length&&C.addDynamicProperty(P),P}var r={getProp:e};return r}();function DynamicPropertyContainer(){}DynamicPropertyContainer.prototype={addDynamicProperty:function(r){this.dynamicProperties.indexOf(r)===-1&&(this.dynamicProperties.push(r),this.container.addDynamicProperty(this),this._isAnimated=!0)},iterateDynamicProperties:function(){this._mdf=!1;var r,s=this.dynamicProperties.length;for(r=0;r<s;r+=1)this.dynamicProperties[r].getValue(),this.dynamicProperties[r]._mdf&&(this._mdf=!0)},initDynamicPropertyContainer:function(r){this.container=r,this.dynamicProperties=[],this._mdf=!1,this._isAnimated=!1}};var pointPool=function(){function e(){return createTypedArray("float32",2)}return poolFactory(8,e)}();function ShapePath(){this.c=!1,this._length=0,this._maxLength=8,this.v=createSizedArray(this._maxLength),this.o=createSizedArray(this._maxLength),this.i=createSizedArray(this._maxLength)}ShapePath.prototype.setPathData=function(e,r){this.c=e,this.setLength(r);for(var s=0;s<r;)this.v[s]=pointPool.newElement(),this.o[s]=pointPool.newElement(),this.i[s]=pointPool.newElement(),s+=1},ShapePath.prototype.setLength=function(e){for(;this._maxLength<e;)this.doubleArrayLength();this._length=e},ShapePath.prototype.doubleArrayLength=function(){this.v=this.v.concat(createSizedArray(this._maxLength)),this.i=this.i.concat(createSizedArray(this._maxLength)),this.o=this.o.concat(createSizedArray(this._maxLength)),this._maxLength*=2},ShapePath.prototype.setXYAt=function(e,r,s,d,f){var _;switch(this._length=Math.max(this._length,d+1),this._length>=this._maxLength&&this.doubleArrayLength(),s){case"v":_=this.v;break;case"i":_=this.i;break;case"o":_=this.o;break;default:_=[];break}(!_[d]||_[d]&&!f)&&(_[d]=pointPool.newElement()),_[d][0]=e,_[d][1]=r},ShapePath.prototype.setTripleAt=function(e,r,s,d,f,_,C,P){this.setXYAt(e,r,"v",C,P),this.setXYAt(s,d,"o",C,P),this.setXYAt(f,_,"i",C,P)},ShapePath.prototype.reverse=function(){var e=new ShapePath;e.setPathData(this.c,this._length);var r=this.v,s=this.o,d=this.i,f=0;this.c&&(e.setTripleAt(r[0][0],r[0][1],d[0][0],d[0][1],s[0][0],s[0][1],0,!1),f=1);var _=this._length-1,C=this._length,P;for(P=f;P<C;P+=1)e.setTripleAt(r[_][0],r[_][1],d[_][0],d[_][1],s[_][0],s[_][1],P,!1),_-=1;return e},ShapePath.prototype.length=function(){return this._length};var shapePool=function(){function e(){return new ShapePath}function r(f){var _=f._length,C;for(C=0;C<_;C+=1)pointPool.release(f.v[C]),pointPool.release(f.i[C]),pointPool.release(f.o[C]),f.v[C]=null,f.i[C]=null,f.o[C]=null;f._length=0,f.c=!1}function s(f){var _=d.newElement(),C,P=f._length===void 0?f.v.length:f._length;for(_.setLength(P),_.c=f.c,C=0;C<P;C+=1)_.setTripleAt(f.v[C][0],f.v[C][1],f.o[C][0],f.o[C][1],f.i[C][0],f.i[C][1],C);return _}var d=poolFactory(4,e,r);return d.clone=s,d}();function ShapeCollection(){this._length=0,this._maxLength=4,this.shapes=createSizedArray(this._maxLength)}ShapeCollection.prototype.addShape=function(e){this._length===this._maxLength&&(this.shapes=this.shapes.concat(createSizedArray(this._maxLength)),this._maxLength*=2),this.shapes[this._length]=e,this._length+=1},ShapeCollection.prototype.releaseShapes=function(){var e;for(e=0;e<this._length;e+=1)shapePool.release(this.shapes[e]);this._length=0};var shapeCollectionPool=function(){var e={newShapeCollection:f,release:_},r=0,s=4,d=createSizedArray(s);function f(){var C;return r?(r-=1,C=d[r]):C=new ShapeCollection,C}function _(C){var P,x=C._length;for(P=0;P<x;P+=1)shapePool.release(C.shapes[P]);C._length=0,r===s&&(d=pooling.double(d),s*=2),d[r]=C,r+=1}return e}(),ShapePropertyFactory=function(){var e=-999999;function r(Di,_o,_s){var _c=_s.lastIndex,_m,Qm,tE,aE,CE,lE,gE,cE,_E,iE=this.keyframes;if(Di<iE[0].t-this.offsetTime)_m=iE[0].s[0],tE=!0,_c=0;else if(Di>=iE[iE.length-1].t-this.offsetTime)_m=iE[iE.length-1].s?iE[iE.length-1].s[0]:iE[iE.length-2].e[0],tE=!0;else{for(var rE=_c,vf=iE.length-1,Fg=!0,_d,_f,uE;Fg&&(_d=iE[rE],_f=iE[rE+1],!(_f.t-this.offsetTime>Di));)rE<vf-1?rE+=1:Fg=!1;if(uE=this.keyframesMetadata[rE]||{},tE=_d.h===1,_c=rE,!tE){if(Di>=_f.t-this.offsetTime)cE=1;else if(Di<_d.t-this.offsetTime)cE=0;else{var dE;uE.__fnct?dE=uE.__fnct:(dE=BezierFactory.getBezierEasing(_d.o.x,_d.o.y,_d.i.x,_d.i.y).get,uE.__fnct=dE),cE=dE((Di-(_d.t-this.offsetTime))/(_f.t-this.offsetTime-(_d.t-this.offsetTime)))}Qm=_f.s?_f.s[0]:_d.e[0]}_m=_d.s[0]}for(lE=_o._length,gE=_m.i[0].length,_s.lastIndex=_c,aE=0;aE<lE;aE+=1)for(CE=0;CE<gE;CE+=1)_E=tE?_m.i[aE][CE]:_m.i[aE][CE]+(Qm.i[aE][CE]-_m.i[aE][CE])*cE,_o.i[aE][CE]=_E,_E=tE?_m.o[aE][CE]:_m.o[aE][CE]+(Qm.o[aE][CE]-_m.o[aE][CE])*cE,_o.o[aE][CE]=_E,_E=tE?_m.v[aE][CE]:_m.v[aE][CE]+(Qm.v[aE][CE]-_m.v[aE][CE])*cE,_o.v[aE][CE]=_E}function s(){var Di=this.comp.renderedFrame-this.offsetTime,_o=this.keyframes[0].t-this.offsetTime,_s=this.keyframes[this.keyframes.length-1].t-this.offsetTime,_c=this._caching.lastFrame;return _c!==e&&(_c<_o&&Di<_o||_c>_s&&Di>_s)||(this._caching.lastIndex=_c<Di?this._caching.lastIndex:0,this.interpolateShape(Di,this.pv,this._caching)),this._caching.lastFrame=Di,this.pv}function d(){this.paths=this.localShapeCollection}function f(Di,_o){if(Di._length!==_o._length||Di.c!==_o.c)return!1;var _s,_c=Di._length;for(_s=0;_s<_c;_s+=1)if(Di.v[_s][0]!==_o.v[_s][0]||Di.v[_s][1]!==_o.v[_s][1]||Di.o[_s][0]!==_o.o[_s][0]||Di.o[_s][1]!==_o.o[_s][1]||Di.i[_s][0]!==_o.i[_s][0]||Di.i[_s][1]!==_o.i[_s][1])return!1;return!0}function _(Di){f(this.v,Di)||(this.v=shapePool.clone(Di),this.localShapeCollection.releaseShapes(),this.localShapeCollection.addShape(this.v),this._mdf=!0,this.paths=this.localShapeCollection)}function C(){if(this.elem.globalData.frameId!==this.frameId){if(!this.effectsSequence.length){this._mdf=!1;return}if(this.lock){this.setVValue(this.pv);return}this.lock=!0,this._mdf=!1;var Di;this.kf?Di=this.pv:this.data.ks?Di=this.data.ks.k:Di=this.data.pt.k;var _o,_s=this.effectsSequence.length;for(_o=0;_o<_s;_o+=1)Di=this.effectsSequence[_o](Di);this.setVValue(Di),this.lock=!1,this.frameId=this.elem.globalData.frameId}}function P(Di,_o,_s){this.propType="shape",this.comp=Di.comp,this.container=Di,this.elem=Di,this.data=_o,this.k=!1,this.kf=!1,this._mdf=!1;var _c=_s===3?_o.pt.k:_o.ks.k;this.v=shapePool.clone(_c),this.pv=shapePool.clone(this.v),this.localShapeCollection=shapeCollectionPool.newShapeCollection(),this.paths=this.localShapeCollection,this.paths.addShape(this.v),this.reset=d,this.effectsSequence=[]}function x(Di){this.effectsSequence.push(Di),this.container.addDynamicProperty(this)}P.prototype.interpolateShape=r,P.prototype.getValue=C,P.prototype.setVValue=_,P.prototype.addEffect=x;function B(Di,_o,_s){this.propType="shape",this.comp=Di.comp,this.elem=Di,this.container=Di,this.offsetTime=Di.data.st,this.keyframes=_s===3?_o.pt.k:_o.ks.k,this.keyframesMetadata=[],this.k=!0,this.kf=!0;var _c=this.keyframes[0].s[0].i.length;this.v=shapePool.newElement(),this.v.setPathData(this.keyframes[0].s[0].c,_c),this.pv=shapePool.clone(this.v),this.localShapeCollection=shapeCollectionPool.newShapeCollection(),this.paths=this.localShapeCollection,this.paths.addShape(this.v),this.lastFrame=e,this.reset=d,this._caching={lastFrame:e,lastIndex:0},this.effectsSequence=[s.bind(this)]}B.prototype.getValue=C,B.prototype.interpolateShape=r,B.prototype.setVValue=_,B.prototype.addEffect=x;var _t=function(){var Di=roundCorner;function _o(_s,_c){this.v=shapePool.newElement(),this.v.setPathData(!0,4),this.localShapeCollection=shapeCollectionPool.newShapeCollection(),this.paths=this.localShapeCollection,this.localShapeCollection.addShape(this.v),this.d=_c.d,this.elem=_s,this.comp=_s.comp,this.frameId=-1,this.initDynamicPropertyContainer(_s),this.p=PropertyFactory.getProp(_s,_c.p,1,0,this),this.s=PropertyFactory.getProp(_s,_c.s,1,0,this),this.dynamicProperties.length?this.k=!0:(this.k=!1,this.convertEllToPath())}return _o.prototype={reset:d,getValue:function(){this.elem.globalData.frameId!==this.frameId&&(this.frameId=this.elem.globalData.frameId,this.iterateDynamicProperties(),this._mdf&&this.convertEllToPath())},convertEllToPath:function(){var _c=this.p.v[0],_m=this.p.v[1],Qm=this.s.v[0]/2,tE=this.s.v[1]/2,aE=this.d!==3,CE=this.v;CE.v[0][0]=_c,CE.v[0][1]=_m-tE,CE.v[1][0]=aE?_c+Qm:_c-Qm,CE.v[1][1]=_m,CE.v[2][0]=_c,CE.v[2][1]=_m+tE,CE.v[3][0]=aE?_c-Qm:_c+Qm,CE.v[3][1]=_m,CE.i[0][0]=aE?_c-Qm*Di:_c+Qm*Di,CE.i[0][1]=_m-tE,CE.i[1][0]=aE?_c+Qm:_c-Qm,CE.i[1][1]=_m-tE*Di,CE.i[2][0]=aE?_c+Qm*Di:_c-Qm*Di,CE.i[2][1]=_m+tE,CE.i[3][0]=aE?_c-Qm:_c+Qm,CE.i[3][1]=_m+tE*Di,CE.o[0][0]=aE?_c+Qm*Di:_c-Qm*Di,CE.o[0][1]=_m-tE,CE.o[1][0]=aE?_c+Qm:_c-Qm,CE.o[1][1]=_m+tE*Di,CE.o[2][0]=aE?_c-Qm*Di:_c+Qm*Di,CE.o[2][1]=_m+tE,CE.o[3][0]=aE?_c-Qm:_c+Qm,CE.o[3][1]=_m-tE*Di}},extendPrototype([DynamicPropertyContainer],_o),_o}(),ue=function(){function Di(_o,_s){this.v=shapePool.newElement(),this.v.setPathData(!0,0),this.elem=_o,this.comp=_o.comp,this.data=_s,this.frameId=-1,this.d=_s.d,this.initDynamicPropertyContainer(_o),_s.sy===1?(this.ir=PropertyFactory.getProp(_o,_s.ir,0,0,this),this.is=PropertyFactory.getProp(_o,_s.is,0,.01,this),this.convertToPath=this.convertStarToPath):this.convertToPath=this.convertPolygonToPath,this.pt=PropertyFactory.getProp(_o,_s.pt,0,0,this),this.p=PropertyFactory.getProp(_o,_s.p,1,0,this),this.r=PropertyFactory.getProp(_o,_s.r,0,degToRads,this),this.or=PropertyFactory.getProp(_o,_s.or,0,0,this),this.os=PropertyFactory.getProp(_o,_s.os,0,.01,this),this.localShapeCollection=shapeCollectionPool.newShapeCollection(),this.localShapeCollection.addShape(this.v),this.paths=this.localShapeCollection,this.dynamicProperties.length?this.k=!0:(this.k=!1,this.convertToPath())}return Di.prototype={reset:d,getValue:function(){this.elem.globalData.frameId!==this.frameId&&(this.frameId=this.elem.globalData.frameId,this.iterateDynamicProperties(),this._mdf&&this.convertToPath())},convertStarToPath:function(){var _s=Math.floor(this.pt.v)*2,_c=Math.PI*2/_s,_m=!0,Qm=this.or.v,tE=this.ir.v,aE=this.os.v,CE=this.is.v,lE=2*Math.PI*Qm/(_s*2),gE=2*Math.PI*tE/(_s*2),cE,_E,iE,rE,vf=-Math.PI/2;vf+=this.r.v;var Fg=this.data.d===3?-1:1;for(this.v._length=0,cE=0;cE<_s;cE+=1){_E=_m?Qm:tE,iE=_m?aE:CE,rE=_m?lE:gE;var _d=_E*Math.cos(vf),_f=_E*Math.sin(vf),uE=_d===0&&_f===0?0:_f/Math.sqrt(_d*_d+_f*_f),dE=_d===0&&_f===0?0:-_d/Math.sqrt(_d*_d+_f*_f);_d+=+this.p.v[0],_f+=+this.p.v[1],this.v.setTripleAt(_d,_f,_d-uE*rE*iE*Fg,_f-dE*rE*iE*Fg,_d+uE*rE*iE*Fg,_f+dE*rE*iE*Fg,cE,!0),_m=!_m,vf+=_c*Fg}},convertPolygonToPath:function(){var _s=Math.floor(this.pt.v),_c=Math.PI*2/_s,_m=this.or.v,Qm=this.os.v,tE=2*Math.PI*_m/(_s*4),aE,CE=-Math.PI*.5,lE=this.data.d===3?-1:1;for(CE+=this.r.v,this.v._length=0,aE=0;aE<_s;aE+=1){var gE=_m*Math.cos(CE),cE=_m*Math.sin(CE),_E=gE===0&&cE===0?0:cE/Math.sqrt(gE*gE+cE*cE),iE=gE===0&&cE===0?0:-gE/Math.sqrt(gE*gE+cE*cE);gE+=+this.p.v[0],cE+=+this.p.v[1],this.v.setTripleAt(gE,cE,gE-_E*tE*Qm*lE,cE-iE*tE*Qm*lE,gE+_E*tE*Qm*lE,cE+iE*tE*Qm*lE,aE,!0),CE+=_c*lE}this.paths.length=0,this.paths[0]=this.v}},extendPrototype([DynamicPropertyContainer],Di),Di}(),Wt=function(){function Di(_o,_s){this.v=shapePool.newElement(),this.v.c=!0,this.localShapeCollection=shapeCollectionPool.newShapeCollection(),this.localShapeCollection.addShape(this.v),this.paths=this.localShapeCollection,this.elem=_o,this.comp=_o.comp,this.frameId=-1,this.d=_s.d,this.initDynamicPropertyContainer(_o),this.p=PropertyFactory.getProp(_o,_s.p,1,0,this),this.s=PropertyFactory.getProp(_o,_s.s,1,0,this),this.r=PropertyFactory.getProp(_o,_s.r,0,0,this),this.dynamicProperties.length?this.k=!0:(this.k=!1,this.convertRectToPath())}return Di.prototype={convertRectToPath:function(){var _s=this.p.v[0],_c=this.p.v[1],_m=this.s.v[0]/2,Qm=this.s.v[1]/2,tE=bmMin(_m,Qm,this.r.v),aE=tE*(1-roundCorner);this.v._length=0,this.d===2||this.d===1?(this.v.setTripleAt(_s+_m,_c-Qm+tE,_s+_m,_c-Qm+tE,_s+_m,_c-Qm+aE,0,!0),this.v.setTripleAt(_s+_m,_c+Qm-tE,_s+_m,_c+Qm-aE,_s+_m,_c+Qm-tE,1,!0),tE!==0?(this.v.setTripleAt(_s+_m-tE,_c+Qm,_s+_m-tE,_c+Qm,_s+_m-aE,_c+Qm,2,!0),this.v.setTripleAt(_s-_m+tE,_c+Qm,_s-_m+aE,_c+Qm,_s-_m+tE,_c+Qm,3,!0),this.v.setTripleAt(_s-_m,_c+Qm-tE,_s-_m,_c+Qm-tE,_s-_m,_c+Qm-aE,4,!0),this.v.setTripleAt(_s-_m,_c-Qm+tE,_s-_m,_c-Qm+aE,_s-_m,_c-Qm+tE,5,!0),this.v.setTripleAt(_s-_m+tE,_c-Qm,_s-_m+tE,_c-Qm,_s-_m+aE,_c-Qm,6,!0),this.v.setTripleAt(_s+_m-tE,_c-Qm,_s+_m-aE,_c-Qm,_s+_m-tE,_c-Qm,7,!0)):(this.v.setTripleAt(_s-_m,_c+Qm,_s-_m+aE,_c+Qm,_s-_m,_c+Qm,2),this.v.setTripleAt(_s-_m,_c-Qm,_s-_m,_c-Qm+aE,_s-_m,_c-Qm,3))):(this.v.setTripleAt(_s+_m,_c-Qm+tE,_s+_m,_c-Qm+aE,_s+_m,_c-Qm+tE,0,!0),tE!==0?(this.v.setTripleAt(_s+_m-tE,_c-Qm,_s+_m-tE,_c-Qm,_s+_m-aE,_c-Qm,1,!0),this.v.setTripleAt(_s-_m+tE,_c-Qm,_s-_m+aE,_c-Qm,_s-_m+tE,_c-Qm,2,!0),this.v.setTripleAt(_s-_m,_c-Qm+tE,_s-_m,_c-Qm+tE,_s-_m,_c-Qm+aE,3,!0),this.v.setTripleAt(_s-_m,_c+Qm-tE,_s-_m,_c+Qm-aE,_s-_m,_c+Qm-tE,4,!0),this.v.setTripleAt(_s-_m+tE,_c+Qm,_s-_m+tE,_c+Qm,_s-_m+aE,_c+Qm,5,!0),this.v.setTripleAt(_s+_m-tE,_c+Qm,_s+_m-aE,_c+Qm,_s+_m-tE,_c+Qm,6,!0),this.v.setTripleAt(_s+_m,_c+Qm-tE,_s+_m,_c+Qm-tE,_s+_m,_c+Qm-aE,7,!0)):(this.v.setTripleAt(_s-_m,_c-Qm,_s-_m+aE,_c-Qm,_s-_m,_c-Qm,1,!0),this.v.setTripleAt(_s-_m,_c+Qm,_s-_m,_c+Qm-aE,_s-_m,_c+Qm,2,!0),this.v.setTripleAt(_s+_m,_c+Qm,_s+_m-aE,_c+Qm,_s+_m,_c+Qm,3,!0)))},getValue:function(){this.elem.globalData.frameId!==this.frameId&&(this.frameId=this.elem.globalData.frameId,this.iterateDynamicProperties(),this._mdf&&this.convertRectToPath())},reset:d},extendPrototype([DynamicPropertyContainer],Di),Di}();function _n(Di,_o,_s){var _c;if(_s===3||_s===4){var _m=_s===3?_o.pt:_o.ks,Qm=_m.k;Qm.length?_c=new B(Di,_o,_s):_c=new P(Di,_o,_s)}else _s===5?_c=new Wt(Di,_o):_s===6?_c=new _t(Di,_o):_s===7&&(_c=new ue(Di,_o));return _c.k&&Di.addDynamicProperty(_c),_c}function _i(){return P}function Ei(){return B}var _a={};return _a.getShapeProp=_n,_a.getConstructorFunction=_i,_a.getKeyframedConstructorFunction=Ei,_a}();/*!
 Transformation Matrix v2.0
 (c) Epistemex 2014-2015
 www.epistemex.com
 By Ken Fyrstenberg
 Contributions by leeoniya.
 License: MIT, header required.
 */var Matrix=function(){var e=Math.cos,r=Math.sin,s=Math.tan,d=Math.round;function f(){return this.props[0]=1,this.props[1]=0,this.props[2]=0,this.props[3]=0,this.props[4]=0,this.props[5]=1,this.props[6]=0,this.props[7]=0,this.props[8]=0,this.props[9]=0,this.props[10]=1,this.props[11]=0,this.props[12]=0,this.props[13]=0,this.props[14]=0,this.props[15]=1,this}function _(_d){if(_d===0)return this;var _f=e(_d),uE=r(_d);return this._t(_f,-uE,0,0,uE,_f,0,0,0,0,1,0,0,0,0,1)}function C(_d){if(_d===0)return this;var _f=e(_d),uE=r(_d);return this._t(1,0,0,0,0,_f,-uE,0,0,uE,_f,0,0,0,0,1)}function P(_d){if(_d===0)return this;var _f=e(_d),uE=r(_d);return this._t(_f,0,uE,0,0,1,0,0,-uE,0,_f,0,0,0,0,1)}function x(_d){if(_d===0)return this;var _f=e(_d),uE=r(_d);return this._t(_f,-uE,0,0,uE,_f,0,0,0,0,1,0,0,0,0,1)}function B(_d,_f){return this._t(1,_f,_d,1,0,0)}function _t(_d,_f){return this.shear(s(_d),s(_f))}function ue(_d,_f){var uE=e(_f),dE=r(_f);return this._t(uE,dE,0,0,-dE,uE,0,0,0,0,1,0,0,0,0,1)._t(1,0,0,0,s(_d),1,0,0,0,0,1,0,0,0,0,1)._t(uE,-dE,0,0,dE,uE,0,0,0,0,1,0,0,0,0,1)}function Wt(_d,_f,uE){return!uE&&uE!==0&&(uE=1),_d===1&&_f===1&&uE===1?this:this._t(_d,0,0,0,0,_f,0,0,0,0,uE,0,0,0,0,1)}function _n(_d,_f,uE,dE,IE,DE,GE,QE,a_,m0,W0,mS,M0,s0,Y0,o_){return this.props[0]=_d,this.props[1]=_f,this.props[2]=uE,this.props[3]=dE,this.props[4]=IE,this.props[5]=DE,this.props[6]=GE,this.props[7]=QE,this.props[8]=a_,this.props[9]=m0,this.props[10]=W0,this.props[11]=mS,this.props[12]=M0,this.props[13]=s0,this.props[14]=Y0,this.props[15]=o_,this}function _i(_d,_f,uE){return uE=uE||0,_d!==0||_f!==0||uE!==0?this._t(1,0,0,0,0,1,0,0,0,0,1,0,_d,_f,uE,1):this}function Ei(_d,_f,uE,dE,IE,DE,GE,QE,a_,m0,W0,mS,M0,s0,Y0,o_){var LE=this.props;if(_d===1&&_f===0&&uE===0&&dE===0&&IE===0&&DE===1&&GE===0&&QE===0&&a_===0&&m0===0&&W0===1&&mS===0)return LE[12]=LE[12]*_d+LE[15]*M0,LE[13]=LE[13]*DE+LE[15]*s0,LE[14]=LE[14]*W0+LE[15]*Y0,LE[15]*=o_,this._identityCalculated=!1,this;var R_=LE[0],KE=LE[1],f_=LE[2],F_=LE[3],T0=LE[4],Mb=LE[5],A0=LE[6],jS=LE[7],eT=LE[8],gS=LE[9],VS=LE[10],rS=LE[11],GT=LE[12],t0=LE[13],qT=LE[14],xR=LE[15];return LE[0]=R_*_d+KE*IE+f_*a_+F_*M0,LE[1]=R_*_f+KE*DE+f_*m0+F_*s0,LE[2]=R_*uE+KE*GE+f_*W0+F_*Y0,LE[3]=R_*dE+KE*QE+f_*mS+F_*o_,LE[4]=T0*_d+Mb*IE+A0*a_+jS*M0,LE[5]=T0*_f+Mb*DE+A0*m0+jS*s0,LE[6]=T0*uE+Mb*GE+A0*W0+jS*Y0,LE[7]=T0*dE+Mb*QE+A0*mS+jS*o_,LE[8]=eT*_d+gS*IE+VS*a_+rS*M0,LE[9]=eT*_f+gS*DE+VS*m0+rS*s0,LE[10]=eT*uE+gS*GE+VS*W0+rS*Y0,LE[11]=eT*dE+gS*QE+VS*mS+rS*o_,LE[12]=GT*_d+t0*IE+qT*a_+xR*M0,LE[13]=GT*_f+t0*DE+qT*m0+xR*s0,LE[14]=GT*uE+t0*GE+qT*W0+xR*Y0,LE[15]=GT*dE+t0*QE+qT*mS+xR*o_,this._identityCalculated=!1,this}function _a(_d){var _f=_d.props;return this.transform(_f[0],_f[1],_f[2],_f[3],_f[4],_f[5],_f[6],_f[7],_f[8],_f[9],_f[10],_f[11],_f[12],_f[13],_f[14],_f[15])}function Di(){return this._identityCalculated||(this._identity=!(this.props[0]!==1||this.props[1]!==0||this.props[2]!==0||this.props[3]!==0||this.props[4]!==0||this.props[5]!==1||this.props[6]!==0||this.props[7]!==0||this.props[8]!==0||this.props[9]!==0||this.props[10]!==1||this.props[11]!==0||this.props[12]!==0||this.props[13]!==0||this.props[14]!==0||this.props[15]!==1),this._identityCalculated=!0),this._identity}function _o(_d){for(var _f=0;_f<16;){if(_d.props[_f]!==this.props[_f])return!1;_f+=1}return!0}function _s(_d){var _f;for(_f=0;_f<16;_f+=1)_d.props[_f]=this.props[_f];return _d}function _c(_d){var _f;for(_f=0;_f<16;_f+=1)this.props[_f]=_d[_f]}function _m(_d,_f,uE){return{x:_d*this.props[0]+_f*this.props[4]+uE*this.props[8]+this.props[12],y:_d*this.props[1]+_f*this.props[5]+uE*this.props[9]+this.props[13],z:_d*this.props[2]+_f*this.props[6]+uE*this.props[10]+this.props[14]}}function Qm(_d,_f,uE){return _d*this.props[0]+_f*this.props[4]+uE*this.props[8]+this.props[12]}function tE(_d,_f,uE){return _d*this.props[1]+_f*this.props[5]+uE*this.props[9]+this.props[13]}function aE(_d,_f,uE){return _d*this.props[2]+_f*this.props[6]+uE*this.props[10]+this.props[14]}function CE(){var _d=this.props[0]*this.props[5]-this.props[1]*this.props[4],_f=this.props[5]/_d,uE=-this.props[1]/_d,dE=-this.props[4]/_d,IE=this.props[0]/_d,DE=(this.props[4]*this.props[13]-this.props[5]*this.props[12])/_d,GE=-(this.props[0]*this.props[13]-this.props[1]*this.props[12])/_d,QE=new Matrix;return QE.props[0]=_f,QE.props[1]=uE,QE.props[4]=dE,QE.props[5]=IE,QE.props[12]=DE,QE.props[13]=GE,QE}function lE(_d){var _f=this.getInverseMatrix();return _f.applyToPointArray(_d[0],_d[1],_d[2]||0)}function gE(_d){var _f,uE=_d.length,dE=[];for(_f=0;_f<uE;_f+=1)dE[_f]=lE(_d[_f]);return dE}function cE(_d,_f,uE){var dE=createTypedArray("float32",6);if(this.isIdentity())dE[0]=_d[0],dE[1]=_d[1],dE[2]=_f[0],dE[3]=_f[1],dE[4]=uE[0],dE[5]=uE[1];else{var IE=this.props[0],DE=this.props[1],GE=this.props[4],QE=this.props[5],a_=this.props[12],m0=this.props[13];dE[0]=_d[0]*IE+_d[1]*GE+a_,dE[1]=_d[0]*DE+_d[1]*QE+m0,dE[2]=_f[0]*IE+_f[1]*GE+a_,dE[3]=_f[0]*DE+_f[1]*QE+m0,dE[4]=uE[0]*IE+uE[1]*GE+a_,dE[5]=uE[0]*DE+uE[1]*QE+m0}return dE}function _E(_d,_f,uE){var dE;return this.isIdentity()?dE=[_d,_f,uE]:dE=[_d*this.props[0]+_f*this.props[4]+uE*this.props[8]+this.props[12],_d*this.props[1]+_f*this.props[5]+uE*this.props[9]+this.props[13],_d*this.props[2]+_f*this.props[6]+uE*this.props[10]+this.props[14]],dE}function iE(_d,_f){if(this.isIdentity())return _d+","+_f;var uE=this.props;return Math.round((_d*uE[0]+_f*uE[4]+uE[12])*100)/100+","+Math.round((_d*uE[1]+_f*uE[5]+uE[13])*100)/100}function rE(){for(var _d=0,_f=this.props,uE="matrix3d(",dE=1e4;_d<16;)uE+=d(_f[_d]*dE)/dE,uE+=_d===15?")":",",_d+=1;return uE}function vf(_d){var _f=1e4;return _d<1e-6&&_d>0||_d>-1e-6&&_d<0?d(_d*_f)/_f:_d}function Fg(){var _d=this.props,_f=vf(_d[0]),uE=vf(_d[1]),dE=vf(_d[4]),IE=vf(_d[5]),DE=vf(_d[12]),GE=vf(_d[13]);return"matrix("+_f+","+uE+","+dE+","+IE+","+DE+","+GE+")"}return function(){this.reset=f,this.rotate=_,this.rotateX=C,this.rotateY=P,this.rotateZ=x,this.skew=_t,this.skewFromAxis=ue,this.shear=B,this.scale=Wt,this.setTransform=_n,this.translate=_i,this.transform=Ei,this.multiply=_a,this.applyToPoint=_m,this.applyToX=Qm,this.applyToY=tE,this.applyToZ=aE,this.applyToPointArray=_E,this.applyToTriplePoints=cE,this.applyToPointStringified=iE,this.toCSS=rE,this.to2dCSS=Fg,this.clone=_s,this.cloneFromProps=_c,this.equals=_o,this.inversePoints=gE,this.inversePoint=lE,this.getInverseMatrix=CE,this._t=this.transform,this.isIdentity=Di,this._identity=!0,this._identityCalculated=!1,this.props=createTypedArray("float32",16),this.reset()}}();function _typeof$3(e){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?_typeof$3=function(s){return typeof s}:_typeof$3=function(s){return s&&typeof Symbol=="function"&&s.constructor===Symbol&&s!==Symbol.prototype?"symbol":typeof s},_typeof$3(e)}var lottie={};function setLocation(e){setLocationHref(e)}function searchAnimations(){animationManager.searchAnimations()}function setSubframeRendering(e){setSubframeEnabled(e)}function setPrefix(e){setIdPrefix(e)}function loadAnimation(e){return animationManager.loadAnimation(e)}function setQuality(e){if(typeof e=="string")switch(e){case"high":setDefaultCurveSegments(200);break;default:case"medium":setDefaultCurveSegments(50);break;case"low":setDefaultCurveSegments(10);break}else!isNaN(e)&&e>1&&setDefaultCurveSegments(e)}function inBrowser(){return typeof navigator<"u"}function installPlugin(e,r){e==="expressions"&&setExpressionsPlugin(r)}function getFactory(e){switch(e){case"propertyFactory":return PropertyFactory;case"shapePropertyFactory":return ShapePropertyFactory;case"matrix":return Matrix;default:return null}}lottie.play=animationManager.play,lottie.pause=animationManager.pause,lottie.setLocationHref=setLocation,lottie.togglePause=animationManager.togglePause,lottie.setSpeed=animationManager.setSpeed,lottie.setDirection=animationManager.setDirection,lottie.stop=animationManager.stop,lottie.searchAnimations=searchAnimations,lottie.registerAnimation=animationManager.registerAnimation,lottie.loadAnimation=loadAnimation,lottie.setSubframeRendering=setSubframeRendering,lottie.resize=animationManager.resize,lottie.goToAndStop=animationManager.goToAndStop,lottie.destroy=animationManager.destroy,lottie.setQuality=setQuality,lottie.inBrowser=inBrowser,lottie.installPlugin=installPlugin,lottie.freeze=animationManager.freeze,lottie.unfreeze=animationManager.unfreeze,lottie.setVolume=animationManager.setVolume,lottie.mute=animationManager.mute,lottie.unmute=animationManager.unmute,lottie.getRegisteredAnimations=animationManager.getRegisteredAnimations,lottie.useWebWorker=setWebWorker,lottie.setIDPrefix=setPrefix,lottie.__getFactory=getFactory,lottie.version="5.12.2";function checkReady(){document.readyState==="complete"&&(clearInterval(readyStateCheckInterval),searchAnimations())}function getQueryVariable(e){for(var r=queryString.split("&"),s=0;s<r.length;s+=1){var d=r[s].split("=");if(decodeURIComponent(d[0])==e)return decodeURIComponent(d[1])}return null}var queryString="";{var scripts=document.getElementsByTagName("script"),index=scripts.length-1,myScript=scripts[index]||{src:""};queryString=myScript.src?myScript.src.replace(/^[^\?]+\??/,""):"",getQueryVariable("renderer")}var readyStateCheckInterval=setInterval(checkReady,100);try{_typeof$3(exports)!=="object"&&(window.bodymovin=lottie)}catch(e){}var ShapeModifiers=function(){var e={},r={};e.registerModifier=s,e.getModifier=d;function s(f,_){r[f]||(r[f]=_)}function d(f,_,C){return new r[f](_,C)}return e}();function ShapeModifier(){}ShapeModifier.prototype.initModifierProperties=function(){},ShapeModifier.prototype.addShapeToModifier=function(){},ShapeModifier.prototype.addShape=function(e){if(!this.closed){e.sh.container.addDynamicProperty(e.sh);var r={shape:e.sh,data:e,localShapeCollection:shapeCollectionPool.newShapeCollection()};this.shapes.push(r),this.addShapeToModifier(r),this._isAnimated&&e.setAsAnimated()}},ShapeModifier.prototype.init=function(e,r){this.shapes=[],this.elem=e,this.initDynamicPropertyContainer(e),this.initModifierProperties(e,r),this.frameId=initialDefaultFrame,this.closed=!1,this.k=!1,this.dynamicProperties.length?this.k=!0:this.getValue(!0)},ShapeModifier.prototype.processKeys=function(){this.elem.globalData.frameId!==this.frameId&&(this.frameId=this.elem.globalData.frameId,this.iterateDynamicProperties())},extendPrototype([DynamicPropertyContainer],ShapeModifier);function TrimModifier(){}extendPrototype([ShapeModifier],TrimModifier),TrimModifier.prototype.initModifierProperties=function(e,r){this.s=PropertyFactory.getProp(e,r.s,0,.01,this),this.e=PropertyFactory.getProp(e,r.e,0,.01,this),this.o=PropertyFactory.getProp(e,r.o,0,0,this),this.sValue=0,this.eValue=0,this.getValue=this.processKeys,this.m=r.m,this._isAnimated=!!this.s.effectsSequence.length||!!this.e.effectsSequence.length||!!this.o.effectsSequence.length},TrimModifier.prototype.addShapeToModifier=function(e){e.pathsData=[]},TrimModifier.prototype.calculateShapeEdges=function(e,r,s,d,f){var _=[];r<=1?_.push({s:e,e:r}):e>=1?_.push({s:e-1,e:r-1}):(_.push({s:e,e:1}),_.push({s:0,e:r-1}));var C=[],P,x=_.length,B;for(P=0;P<x;P+=1)if(B=_[P],!(B.e*f<d||B.s*f>d+s)){var _t,ue;B.s*f<=d?_t=0:_t=(B.s*f-d)/s,B.e*f>=d+s?ue=1:ue=(B.e*f-d)/s,C.push([_t,ue])}return C.length||C.push([0,0]),C},TrimModifier.prototype.releasePathsData=function(e){var r,s=e.length;for(r=0;r<s;r+=1)segmentsLengthPool.release(e[r]);return e.length=0,e},TrimModifier.prototype.processShapes=function(e){var r,s;if(this._mdf||e){var d=this.o.v%360/360;if(d<0&&(d+=1),this.s.v>1?r=1+d:this.s.v<0?r=0+d:r=this.s.v+d,this.e.v>1?s=1+d:this.e.v<0?s=0+d:s=this.e.v+d,r>s){var f=r;r=s,s=f}r=Math.round(r*1e4)*1e-4,s=Math.round(s*1e4)*1e-4,this.sValue=r,this.eValue=s}else r=this.sValue,s=this.eValue;var _,C,P=this.shapes.length,x,B,_t,ue,Wt,_n=0;if(s===r)for(C=0;C<P;C+=1)this.shapes[C].localShapeCollection.releaseShapes(),this.shapes[C].shape._mdf=!0,this.shapes[C].shape.paths=this.shapes[C].localShapeCollection,this._mdf&&(this.shapes[C].pathsData.length=0);else if(s===1&&r===0||s===0&&r===1){if(this._mdf)for(C=0;C<P;C+=1)this.shapes[C].pathsData.length=0,this.shapes[C].shape._mdf=!0}else{var _i=[],Ei,_a;for(C=0;C<P;C+=1)if(Ei=this.shapes[C],!Ei.shape._mdf&&!this._mdf&&!e&&this.m!==2)Ei.shape.paths=Ei.localShapeCollection;else{if(_=Ei.shape.paths,B=_._length,Wt=0,!Ei.shape._mdf&&Ei.pathsData.length)Wt=Ei.totalShapeLength;else{for(_t=this.releasePathsData(Ei.pathsData),x=0;x<B;x+=1)ue=bez.getSegmentsLength(_.shapes[x]),_t.push(ue),Wt+=ue.totalLength;Ei.totalShapeLength=Wt,Ei.pathsData=_t}_n+=Wt,Ei.shape._mdf=!0}var Di=r,_o=s,_s=0,_c;for(C=P-1;C>=0;C-=1)if(Ei=this.shapes[C],Ei.shape._mdf){for(_a=Ei.localShapeCollection,_a.releaseShapes(),this.m===2&&P>1?(_c=this.calculateShapeEdges(r,s,Ei.totalShapeLength,_s,_n),_s+=Ei.totalShapeLength):_c=[[Di,_o]],B=_c.length,x=0;x<B;x+=1){Di=_c[x][0],_o=_c[x][1],_i.length=0,_o<=1?_i.push({s:Ei.totalShapeLength*Di,e:Ei.totalShapeLength*_o}):Di>=1?_i.push({s:Ei.totalShapeLength*(Di-1),e:Ei.totalShapeLength*(_o-1)}):(_i.push({s:Ei.totalShapeLength*Di,e:Ei.totalShapeLength}),_i.push({s:0,e:Ei.totalShapeLength*(_o-1)}));var _m=this.addShapes(Ei,_i[0]);if(_i[0].s!==_i[0].e){if(_i.length>1){var Qm=Ei.shape.paths.shapes[Ei.shape.paths._length-1];if(Qm.c){var tE=_m.pop();this.addPaths(_m,_a),_m=this.addShapes(Ei,_i[1],tE)}else this.addPaths(_m,_a),_m=this.addShapes(Ei,_i[1])}this.addPaths(_m,_a)}}Ei.shape.paths=_a}}},TrimModifier.prototype.addPaths=function(e,r){var s,d=e.length;for(s=0;s<d;s+=1)r.addShape(e[s])},TrimModifier.prototype.addSegment=function(e,r,s,d,f,_,C){f.setXYAt(r[0],r[1],"o",_),f.setXYAt(s[0],s[1],"i",_+1),C&&f.setXYAt(e[0],e[1],"v",_),f.setXYAt(d[0],d[1],"v",_+1)},TrimModifier.prototype.addSegmentFromArray=function(e,r,s,d){r.setXYAt(e[1],e[5],"o",s),r.setXYAt(e[2],e[6],"i",s+1),d&&r.setXYAt(e[0],e[4],"v",s),r.setXYAt(e[3],e[7],"v",s+1)},TrimModifier.prototype.addShapes=function(e,r,s){var d=e.pathsData,f=e.shape.paths.shapes,_,C=e.shape.paths._length,P,x,B=0,_t,ue,Wt,_n,_i=[],Ei,_a=!0;for(s?(ue=s._length,Ei=s._length):(s=shapePool.newElement(),ue=0,Ei=0),_i.push(s),_=0;_<C;_+=1){for(Wt=d[_].lengths,s.c=f[_].c,x=f[_].c?Wt.length:Wt.length+1,P=1;P<x;P+=1)if(_t=Wt[P-1],B+_t.addedLength<r.s)B+=_t.addedLength,s.c=!1;else if(B>r.e){s.c=!1;break}else r.s<=B&&r.e>=B+_t.addedLength?(this.addSegment(f[_].v[P-1],f[_].o[P-1],f[_].i[P],f[_].v[P],s,ue,_a),_a=!1):(_n=bez.getNewSegment(f[_].v[P-1],f[_].v[P],f[_].o[P-1],f[_].i[P],(r.s-B)/_t.addedLength,(r.e-B)/_t.addedLength,Wt[P-1]),this.addSegmentFromArray(_n,s,ue,_a),_a=!1,s.c=!1),B+=_t.addedLength,ue+=1;if(f[_].c&&Wt.length){if(_t=Wt[P-1],B<=r.e){var Di=Wt[P-1].addedLength;r.s<=B&&r.e>=B+Di?(this.addSegment(f[_].v[P-1],f[_].o[P-1],f[_].i[0],f[_].v[0],s,ue,_a),_a=!1):(_n=bez.getNewSegment(f[_].v[P-1],f[_].v[0],f[_].o[P-1],f[_].i[0],(r.s-B)/Di,(r.e-B)/Di,Wt[P-1]),this.addSegmentFromArray(_n,s,ue,_a),_a=!1,s.c=!1)}else s.c=!1;B+=_t.addedLength,ue+=1}if(s._length&&(s.setXYAt(s.v[Ei][0],s.v[Ei][1],"i",Ei),s.setXYAt(s.v[s._length-1][0],s.v[s._length-1][1],"o",s._length-1)),B>r.e)break;_<C-1&&(s=shapePool.newElement(),_a=!0,_i.push(s),ue=0)}return _i};function PuckerAndBloatModifier(){}extendPrototype([ShapeModifier],PuckerAndBloatModifier),PuckerAndBloatModifier.prototype.initModifierProperties=function(e,r){this.getValue=this.processKeys,this.amount=PropertyFactory.getProp(e,r.a,0,null,this),this._isAnimated=!!this.amount.effectsSequence.length},PuckerAndBloatModifier.prototype.processPath=function(e,r){var s=r/100,d=[0,0],f=e._length,_=0;for(_=0;_<f;_+=1)d[0]+=e.v[_][0],d[1]+=e.v[_][1];d[0]/=f,d[1]/=f;var C=shapePool.newElement();C.c=e.c;var P,x,B,_t,ue,Wt;for(_=0;_<f;_+=1)P=e.v[_][0]+(d[0]-e.v[_][0])*s,x=e.v[_][1]+(d[1]-e.v[_][1])*s,B=e.o[_][0]+(d[0]-e.o[_][0])*-s,_t=e.o[_][1]+(d[1]-e.o[_][1])*-s,ue=e.i[_][0]+(d[0]-e.i[_][0])*-s,Wt=e.i[_][1]+(d[1]-e.i[_][1])*-s,C.setTripleAt(P,x,B,_t,ue,Wt,_);return C},PuckerAndBloatModifier.prototype.processShapes=function(e){var r,s,d=this.shapes.length,f,_,C=this.amount.v;if(C!==0){var P,x;for(s=0;s<d;s+=1){if(P=this.shapes[s],x=P.localShapeCollection,!(!P.shape._mdf&&!this._mdf&&!e))for(x.releaseShapes(),P.shape._mdf=!0,r=P.shape.paths.shapes,_=P.shape.paths._length,f=0;f<_;f+=1)x.addShape(this.processPath(r[f],C));P.shape.paths=P.localShapeCollection}}this.dynamicProperties.length||(this._mdf=!1)};var TransformPropertyFactory=function(){var e=[0,0];function r(x){var B=this._mdf;this.iterateDynamicProperties(),this._mdf=this._mdf||B,this.a&&x.translate(-this.a.v[0],-this.a.v[1],this.a.v[2]),this.s&&x.scale(this.s.v[0],this.s.v[1],this.s.v[2]),this.sk&&x.skewFromAxis(-this.sk.v,this.sa.v),this.r?x.rotate(-this.r.v):x.rotateZ(-this.rz.v).rotateY(this.ry.v).rotateX(this.rx.v).rotateZ(-this.or.v[2]).rotateY(this.or.v[1]).rotateX(this.or.v[0]),this.data.p.s?this.data.p.z?x.translate(this.px.v,this.py.v,-this.pz.v):x.translate(this.px.v,this.py.v,0):x.translate(this.p.v[0],this.p.v[1],-this.p.v[2])}function s(x){if(this.elem.globalData.frameId!==this.frameId){if(this._isDirty&&(this.precalculateMatrix(),this._isDirty=!1),this.iterateDynamicProperties(),this._mdf||x){var B;if(this.v.cloneFromProps(this.pre.props),this.appliedTransformations<1&&this.v.translate(-this.a.v[0],-this.a.v[1],this.a.v[2]),this.appliedTransformations<2&&this.v.scale(this.s.v[0],this.s.v[1],this.s.v[2]),this.sk&&this.appliedTransformations<3&&this.v.skewFromAxis(-this.sk.v,this.sa.v),this.r&&this.appliedTransformations<4?this.v.rotate(-this.r.v):!this.r&&this.appliedTransformations<4&&this.v.rotateZ(-this.rz.v).rotateY(this.ry.v).rotateX(this.rx.v).rotateZ(-this.or.v[2]).rotateY(this.or.v[1]).rotateX(this.or.v[0]),this.autoOriented){var _t,ue;if(B=this.elem.globalData.frameRate,this.p&&this.p.keyframes&&this.p.getValueAtTime)this.p._caching.lastFrame+this.p.offsetTime<=this.p.keyframes[0].t?(_t=this.p.getValueAtTime((this.p.keyframes[0].t+.01)/B,0),ue=this.p.getValueAtTime(this.p.keyframes[0].t/B,0)):this.p._caching.lastFrame+this.p.offsetTime>=this.p.keyframes[this.p.keyframes.length-1].t?(_t=this.p.getValueAtTime(this.p.keyframes[this.p.keyframes.length-1].t/B,0),ue=this.p.getValueAtTime((this.p.keyframes[this.p.keyframes.length-1].t-.05)/B,0)):(_t=this.p.pv,ue=this.p.getValueAtTime((this.p._caching.lastFrame+this.p.offsetTime-.01)/B,this.p.offsetTime));else if(this.px&&this.px.keyframes&&this.py.keyframes&&this.px.getValueAtTime&&this.py.getValueAtTime){_t=[],ue=[];var Wt=this.px,_n=this.py;Wt._caching.lastFrame+Wt.offsetTime<=Wt.keyframes[0].t?(_t[0]=Wt.getValueAtTime((Wt.keyframes[0].t+.01)/B,0),_t[1]=_n.getValueAtTime((_n.keyframes[0].t+.01)/B,0),ue[0]=Wt.getValueAtTime(Wt.keyframes[0].t/B,0),ue[1]=_n.getValueAtTime(_n.keyframes[0].t/B,0)):Wt._caching.lastFrame+Wt.offsetTime>=Wt.keyframes[Wt.keyframes.length-1].t?(_t[0]=Wt.getValueAtTime(Wt.keyframes[Wt.keyframes.length-1].t/B,0),_t[1]=_n.getValueAtTime(_n.keyframes[_n.keyframes.length-1].t/B,0),ue[0]=Wt.getValueAtTime((Wt.keyframes[Wt.keyframes.length-1].t-.01)/B,0),ue[1]=_n.getValueAtTime((_n.keyframes[_n.keyframes.length-1].t-.01)/B,0)):(_t=[Wt.pv,_n.pv],ue[0]=Wt.getValueAtTime((Wt._caching.lastFrame+Wt.offsetTime-.01)/B,Wt.offsetTime),ue[1]=_n.getValueAtTime((_n._caching.lastFrame+_n.offsetTime-.01)/B,_n.offsetTime))}else ue=e,_t=ue;this.v.rotate(-Math.atan2(_t[1]-ue[1],_t[0]-ue[0]))}this.data.p&&this.data.p.s?this.data.p.z?this.v.translate(this.px.v,this.py.v,-this.pz.v):this.v.translate(this.px.v,this.py.v,0):this.v.translate(this.p.v[0],this.p.v[1],-this.p.v[2])}this.frameId=this.elem.globalData.frameId}}function d(){if(this.appliedTransformations=0,this.pre.reset(),!this.a.effectsSequence.length)this.pre.translate(-this.a.v[0],-this.a.v[1],this.a.v[2]),this.appliedTransformations=1;else return;if(!this.s.effectsSequence.length)this.pre.scale(this.s.v[0],this.s.v[1],this.s.v[2]),this.appliedTransformations=2;else return;if(this.sk)if(!this.sk.effectsSequence.length&&!this.sa.effectsSequence.length)this.pre.skewFromAxis(-this.sk.v,this.sa.v),this.appliedTransformations=3;else return;this.r?this.r.effectsSequence.length||(this.pre.rotate(-this.r.v),this.appliedTransformations=4):!this.rz.effectsSequence.length&&!this.ry.effectsSequence.length&&!this.rx.effectsSequence.length&&!this.or.effectsSequence.length&&(this.pre.rotateZ(-this.rz.v).rotateY(this.ry.v).rotateX(this.rx.v).rotateZ(-this.or.v[2]).rotateY(this.or.v[1]).rotateX(this.or.v[0]),this.appliedTransformations=4)}function f(){}function _(x){this._addDynamicProperty(x),this.elem.addDynamicProperty(x),this._isDirty=!0}function C(x,B,_t){if(this.elem=x,this.frameId=-1,this.propType="transform",this.data=B,this.v=new Matrix,this.pre=new Matrix,this.appliedTransformations=0,this.initDynamicPropertyContainer(_t||x),B.p&&B.p.s?(this.px=PropertyFactory.getProp(x,B.p.x,0,0,this),this.py=PropertyFactory.getProp(x,B.p.y,0,0,this),B.p.z&&(this.pz=PropertyFactory.getProp(x,B.p.z,0,0,this))):this.p=PropertyFactory.getProp(x,B.p||{k:[0,0,0]},1,0,this),B.rx){if(this.rx=PropertyFactory.getProp(x,B.rx,0,degToRads,this),this.ry=PropertyFactory.getProp(x,B.ry,0,degToRads,this),this.rz=PropertyFactory.getProp(x,B.rz,0,degToRads,this),B.or.k[0].ti){var ue,Wt=B.or.k.length;for(ue=0;ue<Wt;ue+=1)B.or.k[ue].to=null,B.or.k[ue].ti=null}this.or=PropertyFactory.getProp(x,B.or,1,degToRads,this),this.or.sh=!0}else this.r=PropertyFactory.getProp(x,B.r||{k:0},0,degToRads,this);B.sk&&(this.sk=PropertyFactory.getProp(x,B.sk,0,degToRads,this),this.sa=PropertyFactory.getProp(x,B.sa,0,degToRads,this)),this.a=PropertyFactory.getProp(x,B.a||{k:[0,0,0]},1,0,this),this.s=PropertyFactory.getProp(x,B.s||{k:[100,100,100]},1,.01,this),B.o?this.o=PropertyFactory.getProp(x,B.o,0,.01,x):this.o={_mdf:!1,v:1},this._isDirty=!0,this.dynamicProperties.length||this.getValue(!0)}C.prototype={applyToMatrix:r,getValue:s,precalculateMatrix:d,autoOrient:f},extendPrototype([DynamicPropertyContainer],C),C.prototype.addDynamicProperty=_,C.prototype._addDynamicProperty=DynamicPropertyContainer.prototype.addDynamicProperty;function P(x,B,_t){return new C(x,B,_t)}return{getTransformProperty:P}}();function RepeaterModifier(){}extendPrototype([ShapeModifier],RepeaterModifier),RepeaterModifier.prototype.initModifierProperties=function(e,r){this.getValue=this.processKeys,this.c=PropertyFactory.getProp(e,r.c,0,null,this),this.o=PropertyFactory.getProp(e,r.o,0,null,this),this.tr=TransformPropertyFactory.getTransformProperty(e,r.tr,this),this.so=PropertyFactory.getProp(e,r.tr.so,0,.01,this),this.eo=PropertyFactory.getProp(e,r.tr.eo,0,.01,this),this.data=r,this.dynamicProperties.length||this.getValue(!0),this._isAnimated=!!this.dynamicProperties.length,this.pMatrix=new Matrix,this.rMatrix=new Matrix,this.sMatrix=new Matrix,this.tMatrix=new Matrix,this.matrix=new Matrix},RepeaterModifier.prototype.applyTransforms=function(e,r,s,d,f,_){var C=_?-1:1,P=d.s.v[0]+(1-d.s.v[0])*(1-f),x=d.s.v[1]+(1-d.s.v[1])*(1-f);e.translate(d.p.v[0]*C*f,d.p.v[1]*C*f,d.p.v[2]),r.translate(-d.a.v[0],-d.a.v[1],d.a.v[2]),r.rotate(-d.r.v*C*f),r.translate(d.a.v[0],d.a.v[1],d.a.v[2]),s.translate(-d.a.v[0],-d.a.v[1],d.a.v[2]),s.scale(_?1/P:P,_?1/x:x),s.translate(d.a.v[0],d.a.v[1],d.a.v[2])},RepeaterModifier.prototype.init=function(e,r,s,d){for(this.elem=e,this.arr=r,this.pos=s,this.elemsData=d,this._currentCopies=0,this._elements=[],this._groups=[],this.frameId=-1,this.initDynamicPropertyContainer(e),this.initModifierProperties(e,r[s]);s>0;)s-=1,this._elements.unshift(r[s]);this.dynamicProperties.length?this.k=!0:this.getValue(!0)},RepeaterModifier.prototype.resetElements=function(e){var r,s=e.length;for(r=0;r<s;r+=1)e[r]._processed=!1,e[r].ty==="gr"&&this.resetElements(e[r].it)},RepeaterModifier.prototype.cloneElements=function(e){var r=JSON.parse(JSON.stringify(e));return this.resetElements(r),r},RepeaterModifier.prototype.changeGroupRender=function(e,r){var s,d=e.length;for(s=0;s<d;s+=1)e[s]._render=r,e[s].ty==="gr"&&this.changeGroupRender(e[s].it,r)},RepeaterModifier.prototype.processShapes=function(e){var r,s,d,f,_,C=!1;if(this._mdf||e){var P=Math.ceil(this.c.v);if(this._groups.length<P){for(;this._groups.length<P;){var x={it:this.cloneElements(this._elements),ty:"gr"};x.it.push({a:{a:0,ix:1,k:[0,0]},nm:"Transform",o:{a:0,ix:7,k:100},p:{a:0,ix:2,k:[0,0]},r:{a:1,ix:6,k:[{s:0,e:0,t:0},{s:0,e:0,t:1}]},s:{a:0,ix:3,k:[100,100]},sa:{a:0,ix:5,k:0},sk:{a:0,ix:4,k:0},ty:"tr"}),this.arr.splice(0,0,x),this._groups.splice(0,0,x),this._currentCopies+=1}this.elem.reloadShapes(),C=!0}_=0;var B;for(d=0;d<=this._groups.length-1;d+=1){if(B=_<P,this._groups[d]._render=B,this.changeGroupRender(this._groups[d].it,B),!B){var _t=this.elemsData[d].it,ue=_t[_t.length-1];ue.transform.op.v!==0?(ue.transform.op._mdf=!0,ue.transform.op.v=0):ue.transform.op._mdf=!1}_+=1}this._currentCopies=P;var Wt=this.o.v,_n=Wt%1,_i=Wt>0?Math.floor(Wt):Math.ceil(Wt),Ei=this.pMatrix.props,_a=this.rMatrix.props,Di=this.sMatrix.props;this.pMatrix.reset(),this.rMatrix.reset(),this.sMatrix.reset(),this.tMatrix.reset(),this.matrix.reset();var _o=0;if(Wt>0){for(;_o<_i;)this.applyTransforms(this.pMatrix,this.rMatrix,this.sMatrix,this.tr,1,!1),_o+=1;_n&&(this.applyTransforms(this.pMatrix,this.rMatrix,this.sMatrix,this.tr,_n,!1),_o+=_n)}else if(Wt<0){for(;_o>_i;)this.applyTransforms(this.pMatrix,this.rMatrix,this.sMatrix,this.tr,1,!0),_o-=1;_n&&(this.applyTransforms(this.pMatrix,this.rMatrix,this.sMatrix,this.tr,-_n,!0),_o-=_n)}d=this.data.m===1?0:this._currentCopies-1,f=this.data.m===1?1:-1,_=this._currentCopies;for(var _s,_c;_;){if(r=this.elemsData[d].it,s=r[r.length-1].transform.mProps.v.props,_c=s.length,r[r.length-1].transform.mProps._mdf=!0,r[r.length-1].transform.op._mdf=!0,r[r.length-1].transform.op.v=this._currentCopies===1?this.so.v:this.so.v+(this.eo.v-this.so.v)*(d/(this._currentCopies-1)),_o!==0){for((d!==0&&f===1||d!==this._currentCopies-1&&f===-1)&&this.applyTransforms(this.pMatrix,this.rMatrix,this.sMatrix,this.tr,1,!1),this.matrix.transform(_a[0],_a[1],_a[2],_a[3],_a[4],_a[5],_a[6],_a[7],_a[8],_a[9],_a[10],_a[11],_a[12],_a[13],_a[14],_a[15]),this.matrix.transform(Di[0],Di[1],Di[2],Di[3],Di[4],Di[5],Di[6],Di[7],Di[8],Di[9],Di[10],Di[11],Di[12],Di[13],Di[14],Di[15]),this.matrix.transform(Ei[0],Ei[1],Ei[2],Ei[3],Ei[4],Ei[5],Ei[6],Ei[7],Ei[8],Ei[9],Ei[10],Ei[11],Ei[12],Ei[13],Ei[14],Ei[15]),_s=0;_s<_c;_s+=1)s[_s]=this.matrix.props[_s];this.matrix.reset()}else for(this.matrix.reset(),_s=0;_s<_c;_s+=1)s[_s]=this.matrix.props[_s];_o+=1,_-=1,d+=f}}else for(_=this._currentCopies,d=0,f=1;_;)r=this.elemsData[d].it,s=r[r.length-1].transform.mProps.v.props,r[r.length-1].transform.mProps._mdf=!1,r[r.length-1].transform.op._mdf=!1,_-=1,d+=f;return C},RepeaterModifier.prototype.addShape=function(){};function RoundCornersModifier(){}extendPrototype([ShapeModifier],RoundCornersModifier),RoundCornersModifier.prototype.initModifierProperties=function(e,r){this.getValue=this.processKeys,this.rd=PropertyFactory.getProp(e,r.r,0,null,this),this._isAnimated=!!this.rd.effectsSequence.length},RoundCornersModifier.prototype.processPath=function(e,r){var s=shapePool.newElement();s.c=e.c;var d,f=e._length,_,C,P,x,B,_t,ue=0,Wt,_n,_i,Ei,_a,Di;for(d=0;d<f;d+=1)_=e.v[d],P=e.o[d],C=e.i[d],_[0]===P[0]&&_[1]===P[1]&&_[0]===C[0]&&_[1]===C[1]?(d===0||d===f-1)&&!e.c?(s.setTripleAt(_[0],_[1],P[0],P[1],C[0],C[1],ue),ue+=1):(d===0?x=e.v[f-1]:x=e.v[d-1],B=Math.sqrt(Math.pow(_[0]-x[0],2)+Math.pow(_[1]-x[1],2)),_t=B?Math.min(B/2,r)/B:0,_a=_[0]+(x[0]-_[0])*_t,Wt=_a,Di=_[1]-(_[1]-x[1])*_t,_n=Di,_i=Wt-(Wt-_[0])*roundCorner,Ei=_n-(_n-_[1])*roundCorner,s.setTripleAt(Wt,_n,_i,Ei,_a,Di,ue),ue+=1,d===f-1?x=e.v[0]:x=e.v[d+1],B=Math.sqrt(Math.pow(_[0]-x[0],2)+Math.pow(_[1]-x[1],2)),_t=B?Math.min(B/2,r)/B:0,_i=_[0]+(x[0]-_[0])*_t,Wt=_i,Ei=_[1]+(x[1]-_[1])*_t,_n=Ei,_a=Wt-(Wt-_[0])*roundCorner,Di=_n-(_n-_[1])*roundCorner,s.setTripleAt(Wt,_n,_i,Ei,_a,Di,ue),ue+=1):(s.setTripleAt(e.v[d][0],e.v[d][1],e.o[d][0],e.o[d][1],e.i[d][0],e.i[d][1],ue),ue+=1);return s},RoundCornersModifier.prototype.processShapes=function(e){var r,s,d=this.shapes.length,f,_,C=this.rd.v;if(C!==0){var P,x;for(s=0;s<d;s+=1){if(P=this.shapes[s],x=P.localShapeCollection,!(!P.shape._mdf&&!this._mdf&&!e))for(x.releaseShapes(),P.shape._mdf=!0,r=P.shape.paths.shapes,_=P.shape.paths._length,f=0;f<_;f+=1)x.addShape(this.processPath(r[f],C));P.shape.paths=P.localShapeCollection}}this.dynamicProperties.length||(this._mdf=!1)};function floatEqual(e,r){return Math.abs(e-r)*1e5<=Math.min(Math.abs(e),Math.abs(r))}function floatZero(e){return Math.abs(e)<=1e-5}function lerp(e,r,s){return e*(1-s)+r*s}function lerpPoint(e,r,s){return[lerp(e[0],r[0],s),lerp(e[1],r[1],s)]}function quadRoots(e,r,s){if(e===0)return[];var d=r*r-4*e*s;if(d<0)return[];var f=-r/(2*e);if(d===0)return[f];var _=Math.sqrt(d)/(2*e);return[f-_,f+_]}function polynomialCoefficients(e,r,s,d){return[-e+3*r-3*s+d,3*e-6*r+3*s,-3*e+3*r,e]}function singlePoint(e){return new PolynomialBezier(e,e,e,e,!1)}function PolynomialBezier(e,r,s,d,f){f&&pointEqual(e,r)&&(r=lerpPoint(e,d,1/3)),f&&pointEqual(s,d)&&(s=lerpPoint(e,d,2/3));var _=polynomialCoefficients(e[0],r[0],s[0],d[0]),C=polynomialCoefficients(e[1],r[1],s[1],d[1]);this.a=[_[0],C[0]],this.b=[_[1],C[1]],this.c=[_[2],C[2]],this.d=[_[3],C[3]],this.points=[e,r,s,d]}PolynomialBezier.prototype.point=function(e){return[((this.a[0]*e+this.b[0])*e+this.c[0])*e+this.d[0],((this.a[1]*e+this.b[1])*e+this.c[1])*e+this.d[1]]},PolynomialBezier.prototype.derivative=function(e){return[(3*e*this.a[0]+2*this.b[0])*e+this.c[0],(3*e*this.a[1]+2*this.b[1])*e+this.c[1]]},PolynomialBezier.prototype.tangentAngle=function(e){var r=this.derivative(e);return Math.atan2(r[1],r[0])},PolynomialBezier.prototype.normalAngle=function(e){var r=this.derivative(e);return Math.atan2(r[0],r[1])},PolynomialBezier.prototype.inflectionPoints=function(){var e=this.a[1]*this.b[0]-this.a[0]*this.b[1];if(floatZero(e))return[];var r=-.5*(this.a[1]*this.c[0]-this.a[0]*this.c[1])/e,s=r*r-1/3*(this.b[1]*this.c[0]-this.b[0]*this.c[1])/e;if(s<0)return[];var d=Math.sqrt(s);return floatZero(d)?d>0&&d<1?[r]:[]:[r-d,r+d].filter(function(f){return f>0&&f<1})},PolynomialBezier.prototype.split=function(e){if(e<=0)return[singlePoint(this.points[0]),this];if(e>=1)return[this,singlePoint(this.points[this.points.length-1])];var r=lerpPoint(this.points[0],this.points[1],e),s=lerpPoint(this.points[1],this.points[2],e),d=lerpPoint(this.points[2],this.points[3],e),f=lerpPoint(r,s,e),_=lerpPoint(s,d,e),C=lerpPoint(f,_,e);return[new PolynomialBezier(this.points[0],r,f,C,!0),new PolynomialBezier(C,_,d,this.points[3],!0)]};function extrema(e,r){var s=e.points[0][r],d=e.points[e.points.length-1][r];if(s>d){var f=d;d=s,s=f}for(var _=quadRoots(3*e.a[r],2*e.b[r],e.c[r]),C=0;C<_.length;C+=1)if(_[C]>0&&_[C]<1){var P=e.point(_[C])[r];P<s?s=P:P>d&&(d=P)}return{min:s,max:d}}PolynomialBezier.prototype.bounds=function(){return{x:extrema(this,0),y:extrema(this,1)}},PolynomialBezier.prototype.boundingBox=function(){var e=this.bounds();return{left:e.x.min,right:e.x.max,top:e.y.min,bottom:e.y.max,width:e.x.max-e.x.min,height:e.y.max-e.y.min,cx:(e.x.max+e.x.min)/2,cy:(e.y.max+e.y.min)/2}};function intersectData(e,r,s){var d=e.boundingBox();return{cx:d.cx,cy:d.cy,width:d.width,height:d.height,bez:e,t:(r+s)/2,t1:r,t2:s}}function splitData(e){var r=e.bez.split(.5);return[intersectData(r[0],e.t1,e.t),intersectData(r[1],e.t,e.t2)]}function boxIntersect(e,r){return Math.abs(e.cx-r.cx)*2<e.width+r.width&&Math.abs(e.cy-r.cy)*2<e.height+r.height}function intersectsImpl(e,r,s,d,f,_){if(boxIntersect(e,r)){if(s>=_||e.width<=d&&e.height<=d&&r.width<=d&&r.height<=d){f.push([e.t,r.t]);return}var C=splitData(e),P=splitData(r);intersectsImpl(C[0],P[0],s+1,d,f,_),intersectsImpl(C[0],P[1],s+1,d,f,_),intersectsImpl(C[1],P[0],s+1,d,f,_),intersectsImpl(C[1],P[1],s+1,d,f,_)}}PolynomialBezier.prototype.intersections=function(e,r,s){r===void 0&&(r=2),s===void 0&&(s=7);var d=[];return intersectsImpl(intersectData(this,0,1),intersectData(e,0,1),0,r,d,s),d},PolynomialBezier.shapeSegment=function(e,r){var s=(r+1)%e.length();return new PolynomialBezier(e.v[r],e.o[r],e.i[s],e.v[s],!0)},PolynomialBezier.shapeSegmentInverted=function(e,r){var s=(r+1)%e.length();return new PolynomialBezier(e.v[s],e.i[s],e.o[r],e.v[r],!0)};function crossProduct(e,r){return[e[1]*r[2]-e[2]*r[1],e[2]*r[0]-e[0]*r[2],e[0]*r[1]-e[1]*r[0]]}function lineIntersection(e,r,s,d){var f=[e[0],e[1],1],_=[r[0],r[1],1],C=[s[0],s[1],1],P=[d[0],d[1],1],x=crossProduct(crossProduct(f,_),crossProduct(C,P));return floatZero(x[2])?null:[x[0]/x[2],x[1]/x[2]]}function polarOffset(e,r,s){return[e[0]+Math.cos(r)*s,e[1]-Math.sin(r)*s]}function pointDistance(e,r){return Math.hypot(e[0]-r[0],e[1]-r[1])}function pointEqual(e,r){return floatEqual(e[0],r[0])&&floatEqual(e[1],r[1])}function ZigZagModifier(){}extendPrototype([ShapeModifier],ZigZagModifier),ZigZagModifier.prototype.initModifierProperties=function(e,r){this.getValue=this.processKeys,this.amplitude=PropertyFactory.getProp(e,r.s,0,null,this),this.frequency=PropertyFactory.getProp(e,r.r,0,null,this),this.pointsType=PropertyFactory.getProp(e,r.pt,0,null,this),this._isAnimated=this.amplitude.effectsSequence.length!==0||this.frequency.effectsSequence.length!==0||this.pointsType.effectsSequence.length!==0};function setPoint(e,r,s,d,f,_,C){var P=s-Math.PI/2,x=s+Math.PI/2,B=r[0]+Math.cos(s)*d*f,_t=r[1]-Math.sin(s)*d*f;e.setTripleAt(B,_t,B+Math.cos(P)*_,_t-Math.sin(P)*_,B+Math.cos(x)*C,_t-Math.sin(x)*C,e.length())}function getPerpendicularVector(e,r){var s=[r[0]-e[0],r[1]-e[1]],d=-Math.PI*.5,f=[Math.cos(d)*s[0]-Math.sin(d)*s[1],Math.sin(d)*s[0]+Math.cos(d)*s[1]];return f}function getProjectingAngle(e,r){var s=r===0?e.length()-1:r-1,d=(r+1)%e.length(),f=e.v[s],_=e.v[d],C=getPerpendicularVector(f,_);return Math.atan2(0,1)-Math.atan2(C[1],C[0])}function zigZagCorner(e,r,s,d,f,_,C){var P=getProjectingAngle(r,s),x=r.v[s%r._length],B=r.v[s===0?r._length-1:s-1],_t=r.v[(s+1)%r._length],ue=_===2?Math.sqrt(Math.pow(x[0]-B[0],2)+Math.pow(x[1]-B[1],2)):0,Wt=_===2?Math.sqrt(Math.pow(x[0]-_t[0],2)+Math.pow(x[1]-_t[1],2)):0;setPoint(e,r.v[s%r._length],P,C,d,Wt/((f+1)*2),ue/((f+1)*2))}function zigZagSegment(e,r,s,d,f,_){for(var C=0;C<d;C+=1){var P=(C+1)/(d+1),x=f===2?Math.sqrt(Math.pow(r.points[3][0]-r.points[0][0],2)+Math.pow(r.points[3][1]-r.points[0][1],2)):0,B=r.normalAngle(P),_t=r.point(P);setPoint(e,_t,B,_,s,x/((d+1)*2),x/((d+1)*2)),_=-_}return _}ZigZagModifier.prototype.processPath=function(e,r,s,d){var f=e._length,_=shapePool.newElement();if(_.c=e.c,e.c||(f-=1),f===0)return _;var C=-1,P=PolynomialBezier.shapeSegment(e,0);zigZagCorner(_,e,0,r,s,d,C);for(var x=0;x<f;x+=1)C=zigZagSegment(_,P,r,s,d,-C),x===f-1&&!e.c?P=null:P=PolynomialBezier.shapeSegment(e,(x+1)%f),zigZagCorner(_,e,x+1,r,s,d,C);return _},ZigZagModifier.prototype.processShapes=function(e){var r,s,d=this.shapes.length,f,_,C=this.amplitude.v,P=Math.max(0,Math.round(this.frequency.v)),x=this.pointsType.v;if(C!==0){var B,_t;for(s=0;s<d;s+=1){if(B=this.shapes[s],_t=B.localShapeCollection,!(!B.shape._mdf&&!this._mdf&&!e))for(_t.releaseShapes(),B.shape._mdf=!0,r=B.shape.paths.shapes,_=B.shape.paths._length,f=0;f<_;f+=1)_t.addShape(this.processPath(r[f],C,P,x));B.shape.paths=B.localShapeCollection}}this.dynamicProperties.length||(this._mdf=!1)};function linearOffset(e,r,s){var d=Math.atan2(r[0]-e[0],r[1]-e[1]);return[polarOffset(e,d,s),polarOffset(r,d,s)]}function offsetSegment(e,r){var s,d,f,_,C,P,x;x=linearOffset(e.points[0],e.points[1],r),s=x[0],d=x[1],x=linearOffset(e.points[1],e.points[2],r),f=x[0],_=x[1],x=linearOffset(e.points[2],e.points[3],r),C=x[0],P=x[1];var B=lineIntersection(s,d,f,_);B===null&&(B=d);var _t=lineIntersection(C,P,f,_);return _t===null&&(_t=C),new PolynomialBezier(s,B,_t,P)}function joinLines(e,r,s,d,f){var _=r.points[3],C=s.points[0];if(d===3||pointEqual(_,C))return _;if(d===2){var P=-r.tangentAngle(1),x=-s.tangentAngle(0)+Math.PI,B=lineIntersection(_,polarOffset(_,P+Math.PI/2,100),C,polarOffset(C,P+Math.PI/2,100)),_t=B?pointDistance(B,_):pointDistance(_,C)/2,ue=polarOffset(_,P,2*_t*roundCorner);return e.setXYAt(ue[0],ue[1],"o",e.length()-1),ue=polarOffset(C,x,2*_t*roundCorner),e.setTripleAt(C[0],C[1],C[0],C[1],ue[0],ue[1],e.length()),C}var Wt=pointEqual(_,r.points[2])?r.points[0]:r.points[2],_n=pointEqual(C,s.points[1])?s.points[3]:s.points[1],_i=lineIntersection(Wt,_,C,_n);return _i&&pointDistance(_i,_)<f?(e.setTripleAt(_i[0],_i[1],_i[0],_i[1],_i[0],_i[1],e.length()),_i):_}function getIntersection(e,r){var s=e.intersections(r);return s.length&&floatEqual(s[0][0],1)&&s.shift(),s.length?s[0]:null}function pruneSegmentIntersection(e,r){var s=e.slice(),d=r.slice(),f=getIntersection(e[e.length-1],r[0]);return f&&(s[e.length-1]=e[e.length-1].split(f[0])[0],d[0]=r[0].split(f[1])[1]),e.length>1&&r.length>1&&(f=getIntersection(e[0],r[r.length-1]),f)?[[e[0].split(f[0])[0]],[r[r.length-1].split(f[1])[1]]]:[s,d]}function pruneIntersections(e){for(var r,s=1;s<e.length;s+=1)r=pruneSegmentIntersection(e[s-1],e[s]),e[s-1]=r[0],e[s]=r[1];return e.length>1&&(r=pruneSegmentIntersection(e[e.length-1],e[0]),e[e.length-1]=r[0],e[0]=r[1]),e}function offsetSegmentSplit(e,r){var s=e.inflectionPoints(),d,f,_,C;if(s.length===0)return[offsetSegment(e,r)];if(s.length===1||floatEqual(s[1],1))return _=e.split(s[0]),d=_[0],f=_[1],[offsetSegment(d,r),offsetSegment(f,r)];_=e.split(s[0]),d=_[0];var P=(s[1]-s[0])/(1-s[0]);return _=_[1].split(P),C=_[0],f=_[1],[offsetSegment(d,r),offsetSegment(C,r),offsetSegment(f,r)]}function OffsetPathModifier(){}extendPrototype([ShapeModifier],OffsetPathModifier),OffsetPathModifier.prototype.initModifierProperties=function(e,r){this.getValue=this.processKeys,this.amount=PropertyFactory.getProp(e,r.a,0,null,this),this.miterLimit=PropertyFactory.getProp(e,r.ml,0,null,this),this.lineJoin=r.lj,this._isAnimated=this.amount.effectsSequence.length!==0},OffsetPathModifier.prototype.processPath=function(e,r,s,d){var f=shapePool.newElement();f.c=e.c;var _=e.length();e.c||(_-=1);var C,P,x,B=[];for(C=0;C<_;C+=1)x=PolynomialBezier.shapeSegment(e,C),B.push(offsetSegmentSplit(x,r));if(!e.c)for(C=_-1;C>=0;C-=1)x=PolynomialBezier.shapeSegmentInverted(e,C),B.push(offsetSegmentSplit(x,r));B=pruneIntersections(B);var _t=null,ue=null;for(C=0;C<B.length;C+=1){var Wt=B[C];for(ue&&(_t=joinLines(f,ue,Wt[0],s,d)),ue=Wt[Wt.length-1],P=0;P<Wt.length;P+=1)x=Wt[P],_t&&pointEqual(x.points[0],_t)?f.setXYAt(x.points[1][0],x.points[1][1],"o",f.length()-1):f.setTripleAt(x.points[0][0],x.points[0][1],x.points[1][0],x.points[1][1],x.points[0][0],x.points[0][1],f.length()),f.setTripleAt(x.points[3][0],x.points[3][1],x.points[3][0],x.points[3][1],x.points[2][0],x.points[2][1],f.length()),_t=x.points[3]}return B.length&&joinLines(f,ue,B[0][0],s,d),f},OffsetPathModifier.prototype.processShapes=function(e){var r,s,d=this.shapes.length,f,_,C=this.amount.v,P=this.miterLimit.v,x=this.lineJoin;if(C!==0){var B,_t;for(s=0;s<d;s+=1){if(B=this.shapes[s],_t=B.localShapeCollection,!(!B.shape._mdf&&!this._mdf&&!e))for(_t.releaseShapes(),B.shape._mdf=!0,r=B.shape.paths.shapes,_=B.shape.paths._length,f=0;f<_;f+=1)_t.addShape(this.processPath(r[f],C,x,P));B.shape.paths=B.localShapeCollection}}this.dynamicProperties.length||(this._mdf=!1)};function getFontProperties(e){for(var r=e.fStyle?e.fStyle.split(" "):[],s="normal",d="normal",f=r.length,_,C=0;C<f;C+=1)switch(_=r[C].toLowerCase(),_){case"italic":d="italic";break;case"bold":s="700";break;case"black":s="900";break;case"medium":s="500";break;case"regular":case"normal":s="400";break;case"light":case"thin":s="200";break}return{style:d,weight:e.fWeight||s}}var FontManager=function(){var e=5e3,r={w:0,size:0,shapes:[],data:{shapes:[]}},s=[];s=s.concat([2304,2305,2306,2307,2362,2363,2364,2364,2366,2367,2368,2369,2370,2371,2372,2373,2374,2375,2376,2377,2378,2379,2380,2381,2382,2383,2387,2388,2389,2390,2391,2402,2403]);var d=127988,f=917631,_=917601,C=917626,P=65039,x=8205,B=127462,_t=127487,ue=["d83cdffb","d83cdffc","d83cdffd","d83cdffe","d83cdfff"];function Wt(vf){var Fg=vf.split(","),_d,_f=Fg.length,uE=[];for(_d=0;_d<_f;_d+=1)Fg[_d]!=="sans-serif"&&Fg[_d]!=="monospace"&&uE.push(Fg[_d]);return uE.join(",")}function _n(vf,Fg){var _d=createTag("span");_d.setAttribute("aria-hidden",!0),_d.style.fontFamily=Fg;var _f=createTag("span");_f.innerText="giItT1WQy@!-/#",_d.style.position="absolute",_d.style.left="-10000px",_d.style.top="-10000px",_d.style.fontSize="300px",_d.style.fontVariant="normal",_d.style.fontStyle="normal",_d.style.fontWeight="normal",_d.style.letterSpacing="0",_d.appendChild(_f),document.body.appendChild(_d);var uE=_f.offsetWidth;return _f.style.fontFamily=Wt(vf)+", "+Fg,{node:_f,w:uE,parent:_d}}function _i(){var vf,Fg=this.fonts.length,_d,_f,uE=Fg;for(vf=0;vf<Fg;vf+=1)this.fonts[vf].loaded?uE-=1:this.fonts[vf].fOrigin==="n"||this.fonts[vf].origin===0?this.fonts[vf].loaded=!0:(_d=this.fonts[vf].monoCase.node,_f=this.fonts[vf].monoCase.w,_d.offsetWidth!==_f?(uE-=1,this.fonts[vf].loaded=!0):(_d=this.fonts[vf].sansCase.node,_f=this.fonts[vf].sansCase.w,_d.offsetWidth!==_f&&(uE-=1,this.fonts[vf].loaded=!0)),this.fonts[vf].loaded&&(this.fonts[vf].sansCase.parent.parentNode.removeChild(this.fonts[vf].sansCase.parent),this.fonts[vf].monoCase.parent.parentNode.removeChild(this.fonts[vf].monoCase.parent)));uE!==0&&Date.now()-this.initTime<e?setTimeout(this.checkLoadedFontsBinded,20):setTimeout(this.setIsLoadedBinded,10)}function Ei(vf,Fg){var _d=document.body&&Fg?"svg":"canvas",_f,uE=getFontProperties(vf);if(_d==="svg"){var dE=createNS("text");dE.style.fontSize="100px",dE.setAttribute("font-family",vf.fFamily),dE.setAttribute("font-style",uE.style),dE.setAttribute("font-weight",uE.weight),dE.textContent="1",vf.fClass?(dE.style.fontFamily="inherit",dE.setAttribute("class",vf.fClass)):dE.style.fontFamily=vf.fFamily,Fg.appendChild(dE),_f=dE}else{var IE=new OffscreenCanvas(500,500).getContext("2d");IE.font=uE.style+" "+uE.weight+" 100px "+vf.fFamily,_f=IE}function DE(GE){return _d==="svg"?(_f.textContent=GE,_f.getComputedTextLength()):_f.measureText(GE).width}return{measureText:DE}}function _a(vf,Fg){if(!vf){this.isLoaded=!0;return}if(this.chars){this.isLoaded=!0,this.fonts=vf.list;return}if(!document.body){this.isLoaded=!0,vf.list.forEach(function(W0){W0.helper=Ei(W0),W0.cache={}}),this.fonts=vf.list;return}var _d=vf.list,_f,uE=_d.length,dE=uE;for(_f=0;_f<uE;_f+=1){var IE=!0,DE,GE;if(_d[_f].loaded=!1,_d[_f].monoCase=_n(_d[_f].fFamily,"monospace"),_d[_f].sansCase=_n(_d[_f].fFamily,"sans-serif"),!_d[_f].fPath)_d[_f].loaded=!0,dE-=1;else if(_d[_f].fOrigin==="p"||_d[_f].origin===3){if(DE=document.querySelectorAll('style[f-forigin="p"][f-family="'+_d[_f].fFamily+'"], style[f-origin="3"][f-family="'+_d[_f].fFamily+'"]'),DE.length>0&&(IE=!1),IE){var QE=createTag("style");QE.setAttribute("f-forigin",_d[_f].fOrigin),QE.setAttribute("f-origin",_d[_f].origin),QE.setAttribute("f-family",_d[_f].fFamily),QE.type="text/css",QE.innerText="@font-face {font-family: "+_d[_f].fFamily+"; font-style: normal; src: url('"+_d[_f].fPath+"');}",Fg.appendChild(QE)}}else if(_d[_f].fOrigin==="g"||_d[_f].origin===1){for(DE=document.querySelectorAll('link[f-forigin="g"], link[f-origin="1"]'),GE=0;GE<DE.length;GE+=1)DE[GE].href.indexOf(_d[_f].fPath)!==-1&&(IE=!1);if(IE){var a_=createTag("link");a_.setAttribute("f-forigin",_d[_f].fOrigin),a_.setAttribute("f-origin",_d[_f].origin),a_.type="text/css",a_.rel="stylesheet",a_.href=_d[_f].fPath,document.body.appendChild(a_)}}else if(_d[_f].fOrigin==="t"||_d[_f].origin===2){for(DE=document.querySelectorAll('script[f-forigin="t"], script[f-origin="2"]'),GE=0;GE<DE.length;GE+=1)_d[_f].fPath===DE[GE].src&&(IE=!1);if(IE){var m0=createTag("link");m0.setAttribute("f-forigin",_d[_f].fOrigin),m0.setAttribute("f-origin",_d[_f].origin),m0.setAttribute("rel","stylesheet"),m0.setAttribute("href",_d[_f].fPath),Fg.appendChild(m0)}}_d[_f].helper=Ei(_d[_f],Fg),_d[_f].cache={},this.fonts.push(_d[_f])}dE===0?this.isLoaded=!0:setTimeout(this.checkLoadedFonts.bind(this),100)}function Di(vf){if(vf){this.chars||(this.chars=[]);var Fg,_d=vf.length,_f,uE=this.chars.length,dE;for(Fg=0;Fg<_d;Fg+=1){for(_f=0,dE=!1;_f<uE;)this.chars[_f].style===vf[Fg].style&&this.chars[_f].fFamily===vf[Fg].fFamily&&this.chars[_f].ch===vf[Fg].ch&&(dE=!0),_f+=1;dE||(this.chars.push(vf[Fg]),uE+=1)}}}function _o(vf,Fg,_d){for(var _f=0,uE=this.chars.length;_f<uE;){if(this.chars[_f].ch===vf&&this.chars[_f].style===Fg&&this.chars[_f].fFamily===_d)return this.chars[_f];_f+=1}return(typeof vf=="string"&&vf.charCodeAt(0)!==13||!vf)&&console&&console.warn&&!this._warned&&(this._warned=!0,console.warn("Missing character from exported characters list: ",vf,Fg,_d)),r}function _s(vf,Fg,_d){var _f=this.getFontByName(Fg),uE=vf;if(!_f.cache[uE]){var dE=_f.helper;if(vf===" "){var IE=dE.measureText("|"+vf+"|"),DE=dE.measureText("||");_f.cache[uE]=(IE-DE)/100}else _f.cache[uE]=dE.measureText(vf)/100}return _f.cache[uE]*_d}function _c(vf){for(var Fg=0,_d=this.fonts.length;Fg<_d;){if(this.fonts[Fg].fName===vf)return this.fonts[Fg];Fg+=1}return this.fonts[0]}function _m(vf){var Fg=0,_d=vf.charCodeAt(0);if(_d>=55296&&_d<=56319){var _f=vf.charCodeAt(1);_f>=56320&&_f<=57343&&(Fg=(_d-55296)*1024+_f-56320+65536)}return Fg}function Qm(vf,Fg){var _d=vf.toString(16)+Fg.toString(16);return ue.indexOf(_d)!==-1}function tE(vf){return vf===x}function aE(vf){return vf===P}function CE(vf){var Fg=_m(vf);return Fg>=B&&Fg<=_t}function lE(vf){return CE(vf.substr(0,2))&&CE(vf.substr(2,2))}function gE(vf){return s.indexOf(vf)!==-1}function cE(vf,Fg){var _d=_m(vf.substr(Fg,2));if(_d!==d)return!1;var _f=0;for(Fg+=2;_f<5;){if(_d=_m(vf.substr(Fg,2)),_d<_||_d>C)return!1;_f+=1,Fg+=2}return _m(vf.substr(Fg,2))===f}function _E(){this.isLoaded=!0}var iE=function(){this.fonts=[],this.chars=null,this.typekitLoaded=0,this.isLoaded=!1,this._warned=!1,this.initTime=Date.now(),this.setIsLoadedBinded=this.setIsLoaded.bind(this),this.checkLoadedFontsBinded=this.checkLoadedFonts.bind(this)};iE.isModifier=Qm,iE.isZeroWidthJoiner=tE,iE.isFlagEmoji=lE,iE.isRegionalCode=CE,iE.isCombinedCharacter=gE,iE.isRegionalFlag=cE,iE.isVariationSelector=aE,iE.BLACK_FLAG_CODE_POINT=d;var rE={addChars:Di,addFonts:_a,getCharData:_o,getFontByName:_c,measureText:_s,checkLoadedFonts:_i,setIsLoaded:_E};return iE.prototype=rE,iE}();function SlotManager(e){this.animationData=e}SlotManager.prototype.getProp=function(e){return this.animationData.slots&&this.animationData.slots[e.sid]?Object.assign(e,this.animationData.slots[e.sid].p):e};function slotFactory(e){return new SlotManager(e)}function RenderableElement(){}RenderableElement.prototype={initRenderable:function(){this.isInRange=!1,this.hidden=!1,this.isTransparent=!1,this.renderableComponents=[]},addRenderableComponent:function(r){this.renderableComponents.indexOf(r)===-1&&this.renderableComponents.push(r)},removeRenderableComponent:function(r){this.renderableComponents.indexOf(r)!==-1&&this.renderableComponents.splice(this.renderableComponents.indexOf(r),1)},prepareRenderableFrame:function(r){this.checkLayerLimits(r)},checkTransparency:function(){this.finalTransform.mProp.o.v<=0?!this.isTransparent&&this.globalData.renderConfig.hideOnTransparent&&(this.isTransparent=!0,this.hide()):this.isTransparent&&(this.isTransparent=!1,this.show())},checkLayerLimits:function(r){this.data.ip-this.data.st<=r&&this.data.op-this.data.st>r?this.isInRange!==!0&&(this.globalData._mdf=!0,this._mdf=!0,this.isInRange=!0,this.show()):this.isInRange!==!1&&(this.globalData._mdf=!0,this.isInRange=!1,this.hide())},renderRenderable:function(){var r,s=this.renderableComponents.length;for(r=0;r<s;r+=1)this.renderableComponents[r].renderFrame(this._isFirstFrame)},sourceRectAtTime:function(){return{top:0,left:0,width:100,height:100}},getLayerSize:function(){return this.data.ty===5?{w:this.data.textData.width,h:this.data.textData.height}:{w:this.data.width,h:this.data.height}}};var getBlendMode=function(){var e={0:"source-over",1:"multiply",2:"screen",3:"overlay",4:"darken",5:"lighten",6:"color-dodge",7:"color-burn",8:"hard-light",9:"soft-light",10:"difference",11:"exclusion",12:"hue",13:"saturation",14:"color",15:"luminosity"};return function(r){return e[r]||""}}();function SliderEffect(e,r,s){this.p=PropertyFactory.getProp(r,e.v,0,0,s)}function AngleEffect(e,r,s){this.p=PropertyFactory.getProp(r,e.v,0,0,s)}function ColorEffect(e,r,s){this.p=PropertyFactory.getProp(r,e.v,1,0,s)}function PointEffect(e,r,s){this.p=PropertyFactory.getProp(r,e.v,1,0,s)}function LayerIndexEffect(e,r,s){this.p=PropertyFactory.getProp(r,e.v,0,0,s)}function MaskIndexEffect(e,r,s){this.p=PropertyFactory.getProp(r,e.v,0,0,s)}function CheckboxEffect(e,r,s){this.p=PropertyFactory.getProp(r,e.v,0,0,s)}function NoValueEffect(){this.p={}}function EffectsManager(e,r){var s=e.ef||[];this.effectElements=[];var d,f=s.length,_;for(d=0;d<f;d+=1)_=new GroupEffect(s[d],r),this.effectElements.push(_)}function GroupEffect(e,r){this.init(e,r)}extendPrototype([DynamicPropertyContainer],GroupEffect),GroupEffect.prototype.getValue=GroupEffect.prototype.iterateDynamicProperties,GroupEffect.prototype.init=function(e,r){this.data=e,this.effectElements=[],this.initDynamicPropertyContainer(r);var s,d=this.data.ef.length,f,_=this.data.ef;for(s=0;s<d;s+=1){switch(f=null,_[s].ty){case 0:f=new SliderEffect(_[s],r,this);break;case 1:f=new AngleEffect(_[s],r,this);break;case 2:f=new ColorEffect(_[s],r,this);break;case 3:f=new PointEffect(_[s],r,this);break;case 4:case 7:f=new CheckboxEffect(_[s],r,this);break;case 10:f=new LayerIndexEffect(_[s],r,this);break;case 11:f=new MaskIndexEffect(_[s],r,this);break;case 5:f=new EffectsManager(_[s],r);break;default:f=new NoValueEffect(_[s]);break}f&&this.effectElements.push(f)}};function BaseElement(){}BaseElement.prototype={checkMasks:function(){if(!this.data.hasMask)return!1;for(var r=0,s=this.data.masksProperties.length;r<s;){if(this.data.masksProperties[r].mode!=="n"&&this.data.masksProperties[r].cl!==!1)return!0;r+=1}return!1},initExpressions:function(){var r=getExpressionInterfaces();if(r){var s=r("layer"),d=r("effects"),f=r("shape"),_=r("text"),C=r("comp");this.layerInterface=s(this),this.data.hasMask&&this.maskManager&&this.layerInterface.registerMaskInterface(this.maskManager);var P=d.createEffectsInterface(this,this.layerInterface);this.layerInterface.registerEffectsInterface(P),this.data.ty===0||this.data.xt?this.compInterface=C(this):this.data.ty===4?(this.layerInterface.shapeInterface=f(this.shapesData,this.itemsData,this.layerInterface),this.layerInterface.content=this.layerInterface.shapeInterface):this.data.ty===5&&(this.layerInterface.textInterface=_(this),this.layerInterface.text=this.layerInterface.textInterface)}},setBlendMode:function(){var r=getBlendMode(this.data.bm),s=this.baseElement||this.layerElement;s.style["mix-blend-mode"]=r},initBaseData:function(r,s,d){this.globalData=s,this.comp=d,this.data=r,this.layerId=createElementID(),this.data.sr||(this.data.sr=1),this.effectsManager=new EffectsManager(this.data,this,this.dynamicProperties)},getType:function(){return this.type},sourceRectAtTime:function(){}};function FrameElement(){}FrameElement.prototype={initFrame:function(){this._isFirstFrame=!1,this.dynamicProperties=[],this._mdf=!1},prepareProperties:function(r,s){var d,f=this.dynamicProperties.length;for(d=0;d<f;d+=1)(s||this._isParent&&this.dynamicProperties[d].propType==="transform")&&(this.dynamicProperties[d].getValue(),this.dynamicProperties[d]._mdf&&(this.globalData._mdf=!0,this._mdf=!0))},addDynamicProperty:function(r){this.dynamicProperties.indexOf(r)===-1&&this.dynamicProperties.push(r)}};function FootageElement(e,r,s){this.initFrame(),this.initRenderable(),this.assetData=r.getAssetData(e.refId),this.footageData=r.imageLoader.getAsset(this.assetData),this.initBaseData(e,r,s)}FootageElement.prototype.prepareFrame=function(){},extendPrototype([RenderableElement,BaseElement,FrameElement],FootageElement),FootageElement.prototype.getBaseElement=function(){return null},FootageElement.prototype.renderFrame=function(){},FootageElement.prototype.destroy=function(){},FootageElement.prototype.initExpressions=function(){var e=getExpressionInterfaces();if(e){var r=e("footage");this.layerInterface=r(this)}},FootageElement.prototype.getFootageData=function(){return this.footageData};function AudioElement(e,r,s){this.initFrame(),this.initRenderable(),this.assetData=r.getAssetData(e.refId),this.initBaseData(e,r,s),this._isPlaying=!1,this._canPlay=!1;var d=this.globalData.getAssetsPath(this.assetData);this.audio=this.globalData.audioController.createAudio(d),this._currentTime=0,this.globalData.audioController.addAudio(this),this._volumeMultiplier=1,this._volume=1,this._previousVolume=null,this.tm=e.tm?PropertyFactory.getProp(this,e.tm,0,r.frameRate,this):{_placeholder:!0},this.lv=PropertyFactory.getProp(this,e.au&&e.au.lv?e.au.lv:{k:[100]},1,.01,this)}AudioElement.prototype.prepareFrame=function(e){if(this.prepareRenderableFrame(e,!0),this.prepareProperties(e,!0),this.tm._placeholder)this._currentTime=e/this.data.sr;else{var r=this.tm.v;this._currentTime=r}this._volume=this.lv.v[0];var s=this._volume*this._volumeMultiplier;this._previousVolume!==s&&(this._previousVolume=s,this.audio.volume(s))},extendPrototype([RenderableElement,BaseElement,FrameElement],AudioElement),AudioElement.prototype.renderFrame=function(){this.isInRange&&this._canPlay&&(this._isPlaying?(!this.audio.playing()||Math.abs(this._currentTime/this.globalData.frameRate-this.audio.seek())>.1)&&this.audio.seek(this._currentTime/this.globalData.frameRate):(this.audio.play(),this.audio.seek(this._currentTime/this.globalData.frameRate),this._isPlaying=!0))},AudioElement.prototype.show=function(){},AudioElement.prototype.hide=function(){this.audio.pause(),this._isPlaying=!1},AudioElement.prototype.pause=function(){this.audio.pause(),this._isPlaying=!1,this._canPlay=!1},AudioElement.prototype.resume=function(){this._canPlay=!0},AudioElement.prototype.setRate=function(e){this.audio.rate(e)},AudioElement.prototype.volume=function(e){this._volumeMultiplier=e,this._previousVolume=e*this._volume,this.audio.volume(this._previousVolume)},AudioElement.prototype.getBaseElement=function(){return null},AudioElement.prototype.destroy=function(){},AudioElement.prototype.sourceRectAtTime=function(){},AudioElement.prototype.initExpressions=function(){};function BaseRenderer(){}BaseRenderer.prototype.checkLayers=function(e){var r,s=this.layers.length,d;for(this.completeLayers=!0,r=s-1;r>=0;r-=1)this.elements[r]||(d=this.layers[r],d.ip-d.st<=e-this.layers[r].st&&d.op-d.st>e-this.layers[r].st&&this.buildItem(r)),this.completeLayers=this.elements[r]?this.completeLayers:!1;this.checkPendingElements()},BaseRenderer.prototype.createItem=function(e){switch(e.ty){case 2:return this.createImage(e);case 0:return this.createComp(e);case 1:return this.createSolid(e);case 3:return this.createNull(e);case 4:return this.createShape(e);case 5:return this.createText(e);case 6:return this.createAudio(e);case 13:return this.createCamera(e);case 15:return this.createFootage(e);default:return this.createNull(e)}},BaseRenderer.prototype.createCamera=function(){throw new Error("You're using a 3d camera. Try the html renderer.")},BaseRenderer.prototype.createAudio=function(e){return new AudioElement(e,this.globalData,this)},BaseRenderer.prototype.createFootage=function(e){return new FootageElement(e,this.globalData,this)},BaseRenderer.prototype.buildAllItems=function(){var e,r=this.layers.length;for(e=0;e<r;e+=1)this.buildItem(e);this.checkPendingElements()},BaseRenderer.prototype.includeLayers=function(e){this.completeLayers=!1;var r,s=e.length,d,f=this.layers.length;for(r=0;r<s;r+=1)for(d=0;d<f;){if(this.layers[d].id===e[r].id){this.layers[d]=e[r];break}d+=1}},BaseRenderer.prototype.setProjectInterface=function(e){this.globalData.projectInterface=e},BaseRenderer.prototype.initItems=function(){this.globalData.progressiveLoad||this.buildAllItems()},BaseRenderer.prototype.buildElementParenting=function(e,r,s){for(var d=this.elements,f=this.layers,_=0,C=f.length;_<C;)f[_].ind==r&&(!d[_]||d[_]===!0?(this.buildItem(_),this.addPendingElement(e)):(s.push(d[_]),d[_].setAsParent(),f[_].parent!==void 0?this.buildElementParenting(e,f[_].parent,s):e.setHierarchy(s))),_+=1},BaseRenderer.prototype.addPendingElement=function(e){this.pendingElements.push(e)},BaseRenderer.prototype.searchExtraCompositions=function(e){var r,s=e.length;for(r=0;r<s;r+=1)if(e[r].xt){var d=this.createComp(e[r]);d.initExpressions(),this.globalData.projectInterface.registerComposition(d)}},BaseRenderer.prototype.getElementById=function(e){var r,s=this.elements.length;for(r=0;r<s;r+=1)if(this.elements[r].data.ind===e)return this.elements[r];return null},BaseRenderer.prototype.getElementByPath=function(e){var r=e.shift(),s;if(typeof r=="number")s=this.elements[r];else{var d,f=this.elements.length;for(d=0;d<f;d+=1)if(this.elements[d].data.nm===r){s=this.elements[d];break}}return e.length===0?s:s.getElementByPath(e)},BaseRenderer.prototype.setupGlobalData=function(e,r){this.globalData.fontManager=new FontManager,this.globalData.slotManager=slotFactory(e),this.globalData.fontManager.addChars(e.chars),this.globalData.fontManager.addFonts(e.fonts,r),this.globalData.getAssetData=this.animationItem.getAssetData.bind(this.animationItem),this.globalData.getAssetsPath=this.animationItem.getAssetsPath.bind(this.animationItem),this.globalData.imageLoader=this.animationItem.imagePreloader,this.globalData.audioController=this.animationItem.audioController,this.globalData.frameId=0,this.globalData.frameRate=e.fr,this.globalData.nm=e.nm,this.globalData.compSize={w:e.w,h:e.h}};var effectTypes={TRANSFORM_EFFECT:"transformEFfect"};function TransformElement(){}TransformElement.prototype={initTransform:function(){var r=new Matrix;this.finalTransform={mProp:this.data.ks?TransformPropertyFactory.getTransformProperty(this,this.data.ks,this):{o:0},_matMdf:!1,_localMatMdf:!1,_opMdf:!1,mat:r,localMat:r,localOpacity:1},this.data.ao&&(this.finalTransform.mProp.autoOriented=!0),this.data.ty},renderTransform:function(){if(this.finalTransform._opMdf=this.finalTransform.mProp.o._mdf||this._isFirstFrame,this.finalTransform._matMdf=this.finalTransform.mProp._mdf||this._isFirstFrame,this.hierarchy){var r,s=this.finalTransform.mat,d=0,f=this.hierarchy.length;if(!this.finalTransform._matMdf)for(;d<f;){if(this.hierarchy[d].finalTransform.mProp._mdf){this.finalTransform._matMdf=!0;break}d+=1}if(this.finalTransform._matMdf)for(r=this.finalTransform.mProp.v.props,s.cloneFromProps(r),d=0;d<f;d+=1)s.multiply(this.hierarchy[d].finalTransform.mProp.v)}this.finalTransform._matMdf&&(this.finalTransform._localMatMdf=this.finalTransform._matMdf),this.finalTransform._opMdf&&(this.finalTransform.localOpacity=this.finalTransform.mProp.o.v)},renderLocalTransform:function(){if(this.localTransforms){var r=0,s=this.localTransforms.length;if(this.finalTransform._localMatMdf=this.finalTransform._matMdf,!this.finalTransform._localMatMdf||!this.finalTransform._opMdf)for(;r<s;)this.localTransforms[r]._mdf&&(this.finalTransform._localMatMdf=!0),this.localTransforms[r]._opMdf&&!this.finalTransform._opMdf&&(this.finalTransform.localOpacity=this.finalTransform.mProp.o.v,this.finalTransform._opMdf=!0),r+=1;if(this.finalTransform._localMatMdf){var d=this.finalTransform.localMat;for(this.localTransforms[0].matrix.clone(d),r=1;r<s;r+=1){var f=this.localTransforms[r].matrix;d.multiply(f)}d.multiply(this.finalTransform.mat)}if(this.finalTransform._opMdf){var _=this.finalTransform.localOpacity;for(r=0;r<s;r+=1)_*=this.localTransforms[r].opacity*.01;this.finalTransform.localOpacity=_}}},searchEffectTransforms:function(){if(this.renderableEffectsManager){var r=this.renderableEffectsManager.getEffects(effectTypes.TRANSFORM_EFFECT);if(r.length){this.localTransforms=[],this.finalTransform.localMat=new Matrix;var s=0,d=r.length;for(s=0;s<d;s+=1)this.localTransforms.push(r[s])}}},globalToLocal:function(r){var s=[];s.push(this.finalTransform);for(var d=!0,f=this.comp;d;)f.finalTransform?(f.data.hasMask&&s.splice(0,0,f.finalTransform),f=f.comp):d=!1;var _,C=s.length,P;for(_=0;_<C;_+=1)P=s[_].mat.applyToPointArray(0,0,0),r=[r[0]-P[0],r[1]-P[1],0];return r},mHelper:new Matrix};function MaskElement(e,r,s){this.data=e,this.element=r,this.globalData=s,this.storedData=[],this.masksProperties=this.data.masksProperties||[],this.maskElement=null;var d=this.globalData.defs,f,_=this.masksProperties?this.masksProperties.length:0;this.viewData=createSizedArray(_),this.solidPath="";var C,P=this.masksProperties,x=0,B=[],_t,ue,Wt=createElementID(),_n,_i,Ei,_a,Di="clipPath",_o="clip-path";for(f=0;f<_;f+=1)if((P[f].mode!=="a"&&P[f].mode!=="n"||P[f].inv||P[f].o.k!==100||P[f].o.x)&&(Di="mask",_o="mask"),(P[f].mode==="s"||P[f].mode==="i")&&x===0?(_n=createNS("rect"),_n.setAttribute("fill","#ffffff"),_n.setAttribute("width",this.element.comp.data.w||0),_n.setAttribute("height",this.element.comp.data.h||0),B.push(_n)):_n=null,C=createNS("path"),P[f].mode==="n")this.viewData[f]={op:PropertyFactory.getProp(this.element,P[f].o,0,.01,this.element),prop:ShapePropertyFactory.getShapeProp(this.element,P[f],3),elem:C,lastPath:""},d.appendChild(C);else{x+=1,C.setAttribute("fill",P[f].mode==="s"?"#000000":"#ffffff"),C.setAttribute("clip-rule","nonzero");var _s;if(P[f].x.k!==0?(Di="mask",_o="mask",_a=PropertyFactory.getProp(this.element,P[f].x,0,null,this.element),_s=createElementID(),_i=createNS("filter"),_i.setAttribute("id",_s),Ei=createNS("feMorphology"),Ei.setAttribute("operator","erode"),Ei.setAttribute("in","SourceGraphic"),Ei.setAttribute("radius","0"),_i.appendChild(Ei),d.appendChild(_i),C.setAttribute("stroke",P[f].mode==="s"?"#000000":"#ffffff")):(Ei=null,_a=null),this.storedData[f]={elem:C,x:_a,expan:Ei,lastPath:"",lastOperator:"",filterId:_s,lastRadius:0},P[f].mode==="i"){ue=B.length;var _c=createNS("g");for(_t=0;_t<ue;_t+=1)_c.appendChild(B[_t]);var _m=createNS("mask");_m.setAttribute("mask-type","alpha"),_m.setAttribute("id",Wt+"_"+x),_m.appendChild(C),d.appendChild(_m),_c.setAttribute("mask","url("+getLocationHref()+"#"+Wt+"_"+x+")"),B.length=0,B.push(_c)}else B.push(C);P[f].inv&&!this.solidPath&&(this.solidPath=this.createLayerSolidPath()),this.viewData[f]={elem:C,lastPath:"",op:PropertyFactory.getProp(this.element,P[f].o,0,.01,this.element),prop:ShapePropertyFactory.getShapeProp(this.element,P[f],3),invRect:_n},this.viewData[f].prop.k||this.drawPath(P[f],this.viewData[f].prop.v,this.viewData[f])}for(this.maskElement=createNS(Di),_=B.length,f=0;f<_;f+=1)this.maskElement.appendChild(B[f]);x>0&&(this.maskElement.setAttribute("id",Wt),this.element.maskedElement.setAttribute(_o,"url("+getLocationHref()+"#"+Wt+")"),d.appendChild(this.maskElement)),this.viewData.length&&this.element.addRenderableComponent(this)}MaskElement.prototype.getMaskProperty=function(e){return this.viewData[e].prop},MaskElement.prototype.renderFrame=function(e){var r=this.element.finalTransform.mat,s,d=this.masksProperties.length;for(s=0;s<d;s+=1)if((this.viewData[s].prop._mdf||e)&&this.drawPath(this.masksProperties[s],this.viewData[s].prop.v,this.viewData[s]),(this.viewData[s].op._mdf||e)&&this.viewData[s].elem.setAttribute("fill-opacity",this.viewData[s].op.v),this.masksProperties[s].mode!=="n"&&(this.viewData[s].invRect&&(this.element.finalTransform.mProp._mdf||e)&&this.viewData[s].invRect.setAttribute("transform",r.getInverseMatrix().to2dCSS()),this.storedData[s].x&&(this.storedData[s].x._mdf||e))){var f=this.storedData[s].expan;this.storedData[s].x.v<0?(this.storedData[s].lastOperator!=="erode"&&(this.storedData[s].lastOperator="erode",this.storedData[s].elem.setAttribute("filter","url("+getLocationHref()+"#"+this.storedData[s].filterId+")")),f.setAttribute("radius",-this.storedData[s].x.v)):(this.storedData[s].lastOperator!=="dilate"&&(this.storedData[s].lastOperator="dilate",this.storedData[s].elem.setAttribute("filter",null)),this.storedData[s].elem.setAttribute("stroke-width",this.storedData[s].x.v*2))}},MaskElement.prototype.getMaskelement=function(){return this.maskElement},MaskElement.prototype.createLayerSolidPath=function(){var e="M0,0 ";return e+=" h"+this.globalData.compSize.w,e+=" v"+this.globalData.compSize.h,e+=" h-"+this.globalData.compSize.w,e+=" v-"+this.globalData.compSize.h+" ",e},MaskElement.prototype.drawPath=function(e,r,s){var d=" M"+r.v[0][0]+","+r.v[0][1],f,_;for(_=r._length,f=1;f<_;f+=1)d+=" C"+r.o[f-1][0]+","+r.o[f-1][1]+" "+r.i[f][0]+","+r.i[f][1]+" "+r.v[f][0]+","+r.v[f][1];if(r.c&&_>1&&(d+=" C"+r.o[f-1][0]+","+r.o[f-1][1]+" "+r.i[0][0]+","+r.i[0][1]+" "+r.v[0][0]+","+r.v[0][1]),s.lastPath!==d){var C="";s.elem&&(r.c&&(C=e.inv?this.solidPath+d:d),s.elem.setAttribute("d",C)),s.lastPath=d}},MaskElement.prototype.destroy=function(){this.element=null,this.globalData=null,this.maskElement=null,this.data=null,this.masksProperties=null};var filtersFactory=function(){var e={};e.createFilter=r,e.createAlphaToLuminanceFilter=s;function r(d,f){var _=createNS("filter");return _.setAttribute("id",d),f!==!0&&(_.setAttribute("filterUnits","objectBoundingBox"),_.setAttribute("x","0%"),_.setAttribute("y","0%"),_.setAttribute("width","100%"),_.setAttribute("height","100%")),_}function s(){var d=createNS("feColorMatrix");return d.setAttribute("type","matrix"),d.setAttribute("color-interpolation-filters","sRGB"),d.setAttribute("values","0 0 0 1 0  0 0 0 1 0  0 0 0 1 0  0 0 0 1 1"),d}return e}(),featureSupport=function(){var e={maskType:!0,svgLumaHidden:!0,offscreenCanvas:typeof OffscreenCanvas<"u"};return(/MSIE 10/i.test(navigator.userAgent)||/MSIE 9/i.test(navigator.userAgent)||/rv:11.0/i.test(navigator.userAgent)||/Edge\/\d./i.test(navigator.userAgent))&&(e.maskType=!1),/firefox/i.test(navigator.userAgent)&&(e.svgLumaHidden=!1),e}(),registeredEffects$1={},idPrefix="filter_result_";function SVGEffects(e){var r,s="SourceGraphic",d=e.data.ef?e.data.ef.length:0,f=createElementID(),_=filtersFactory.createFilter(f,!0),C=0;this.filters=[];var P;for(r=0;r<d;r+=1){P=null;var x=e.data.ef[r].ty;if(registeredEffects$1[x]){var B=registeredEffects$1[x].effect;P=new B(_,e.effectsManager.effectElements[r],e,idPrefix+C,s),s=idPrefix+C,registeredEffects$1[x].countsAsEffect&&(C+=1)}P&&this.filters.push(P)}C&&(e.globalData.defs.appendChild(_),e.layerElement.setAttribute("filter","url("+getLocationHref()+"#"+f+")")),this.filters.length&&e.addRenderableComponent(this)}SVGEffects.prototype.renderFrame=function(e){var r,s=this.filters.length;for(r=0;r<s;r+=1)this.filters[r].renderFrame(e)},SVGEffects.prototype.getEffects=function(e){var r,s=this.filters.length,d=[];for(r=0;r<s;r+=1)this.filters[r].type===e&&d.push(this.filters[r]);return d};function registerEffect$1(e,r,s){registeredEffects$1[e]={effect:r,countsAsEffect:s}}function SVGBaseElement(){}SVGBaseElement.prototype={initRendererElement:function(){this.layerElement=createNS("g")},createContainerElements:function(){this.matteElement=createNS("g"),this.transformedElement=this.layerElement,this.maskedElement=this.layerElement,this._sizeChanged=!1;var r=null;if(this.data.td){this.matteMasks={};var s=createNS("g");s.setAttribute("id",this.layerId),s.appendChild(this.layerElement),r=s,this.globalData.defs.appendChild(s)}else this.data.tt?(this.matteElement.appendChild(this.layerElement),r=this.matteElement,this.baseElement=this.matteElement):this.baseElement=this.layerElement;if(this.data.ln&&this.layerElement.setAttribute("id",this.data.ln),this.data.cl&&this.layerElement.setAttribute("class",this.data.cl),this.data.ty===0&&!this.data.hd){var d=createNS("clipPath"),f=createNS("path");f.setAttribute("d","M0,0 L"+this.data.w+",0 L"+this.data.w+","+this.data.h+" L0,"+this.data.h+"z");var _=createElementID();if(d.setAttribute("id",_),d.appendChild(f),this.globalData.defs.appendChild(d),this.checkMasks()){var C=createNS("g");C.setAttribute("clip-path","url("+getLocationHref()+"#"+_+")"),C.appendChild(this.layerElement),this.transformedElement=C,r?r.appendChild(this.transformedElement):this.baseElement=this.transformedElement}else this.layerElement.setAttribute("clip-path","url("+getLocationHref()+"#"+_+")")}this.data.bm!==0&&this.setBlendMode()},renderElement:function(){this.finalTransform._localMatMdf&&this.transformedElement.setAttribute("transform",this.finalTransform.localMat.to2dCSS()),this.finalTransform._opMdf&&this.transformedElement.setAttribute("opacity",this.finalTransform.localOpacity)},destroyBaseElement:function(){this.layerElement=null,this.matteElement=null,this.maskManager.destroy()},getBaseElement:function(){return this.data.hd?null:this.baseElement},createRenderableComponents:function(){this.maskManager=new MaskElement(this.data,this,this.globalData),this.renderableEffectsManager=new SVGEffects(this),this.searchEffectTransforms()},getMatte:function(r){if(this.matteMasks||(this.matteMasks={}),!this.matteMasks[r]){var s=this.layerId+"_"+r,d,f,_,C;if(r===1||r===3){var P=createNS("mask");P.setAttribute("id",s),P.setAttribute("mask-type",r===3?"luminance":"alpha"),_=createNS("use"),_.setAttributeNS("http://www.w3.org/1999/xlink","href","#"+this.layerId),P.appendChild(_),this.globalData.defs.appendChild(P),!featureSupport.maskType&&r===1&&(P.setAttribute("mask-type","luminance"),d=createElementID(),f=filtersFactory.createFilter(d),this.globalData.defs.appendChild(f),f.appendChild(filtersFactory.createAlphaToLuminanceFilter()),C=createNS("g"),C.appendChild(_),P.appendChild(C),C.setAttribute("filter","url("+getLocationHref()+"#"+d+")"))}else if(r===2){var x=createNS("mask");x.setAttribute("id",s),x.setAttribute("mask-type","alpha");var B=createNS("g");x.appendChild(B),d=createElementID(),f=filtersFactory.createFilter(d);var _t=createNS("feComponentTransfer");_t.setAttribute("in","SourceGraphic"),f.appendChild(_t);var ue=createNS("feFuncA");ue.setAttribute("type","table"),ue.setAttribute("tableValues","1.0 0.0"),_t.appendChild(ue),this.globalData.defs.appendChild(f);var Wt=createNS("rect");Wt.setAttribute("width",this.comp.data.w),Wt.setAttribute("height",this.comp.data.h),Wt.setAttribute("x","0"),Wt.setAttribute("y","0"),Wt.setAttribute("fill","#ffffff"),Wt.setAttribute("opacity","0"),B.setAttribute("filter","url("+getLocationHref()+"#"+d+")"),B.appendChild(Wt),_=createNS("use"),_.setAttributeNS("http://www.w3.org/1999/xlink","href","#"+this.layerId),B.appendChild(_),featureSupport.maskType||(x.setAttribute("mask-type","luminance"),f.appendChild(filtersFactory.createAlphaToLuminanceFilter()),C=createNS("g"),B.appendChild(Wt),C.appendChild(this.layerElement),B.appendChild(C)),this.globalData.defs.appendChild(x)}this.matteMasks[r]=s}return this.matteMasks[r]},setMatte:function(r){this.matteElement&&this.matteElement.setAttribute("mask","url("+getLocationHref()+"#"+r+")")}};function HierarchyElement(){}HierarchyElement.prototype={initHierarchy:function(){this.hierarchy=[],this._isParent=!1,this.checkParenting()},setHierarchy:function(r){this.hierarchy=r},setAsParent:function(){this._isParent=!0},checkParenting:function(){this.data.parent!==void 0&&this.comp.buildElementParenting(this,this.data.parent,[])}};function RenderableDOMElement(){}(function(){var e={initElement:function(s,d,f){this.initFrame(),this.initBaseData(s,d,f),this.initTransform(s,d,f),this.initHierarchy(),this.initRenderable(),this.initRendererElement(),this.createContainerElements(),this.createRenderableComponents(),this.createContent(),this.hide()},hide:function(){if(!this.hidden&&(!this.isInRange||this.isTransparent)){var s=this.baseElement||this.layerElement;s.style.display="none",this.hidden=!0}},show:function(){if(this.isInRange&&!this.isTransparent){if(!this.data.hd){var s=this.baseElement||this.layerElement;s.style.display="block"}this.hidden=!1,this._isFirstFrame=!0}},renderFrame:function(){this.data.hd||this.hidden||(this.renderTransform(),this.renderRenderable(),this.renderLocalTransform(),this.renderElement(),this.renderInnerContent(),this._isFirstFrame&&(this._isFirstFrame=!1))},renderInnerContent:function(){},prepareFrame:function(s){this._mdf=!1,this.prepareRenderableFrame(s),this.prepareProperties(s,this.isInRange),this.checkTransparency()},destroy:function(){this.innerElem=null,this.destroyBaseElement()}};extendPrototype([RenderableElement,createProxyFunction(e)],RenderableDOMElement)})();function IImageElement(e,r,s){this.assetData=r.getAssetData(e.refId),this.assetData&&this.assetData.sid&&(this.assetData=r.slotManager.getProp(this.assetData)),this.initElement(e,r,s),this.sourceRect={top:0,left:0,width:this.assetData.w,height:this.assetData.h}}extendPrototype([BaseElement,TransformElement,SVGBaseElement,HierarchyElement,FrameElement,RenderableDOMElement],IImageElement),IImageElement.prototype.createContent=function(){var e=this.globalData.getAssetsPath(this.assetData);this.innerElem=createNS("image"),this.innerElem.setAttribute("width",this.assetData.w+"px"),this.innerElem.setAttribute("height",this.assetData.h+"px"),this.innerElem.setAttribute("preserveAspectRatio",this.assetData.pr||this.globalData.renderConfig.imagePreserveAspectRatio),this.innerElem.setAttributeNS("http://www.w3.org/1999/xlink","href",e),this.layerElement.appendChild(this.innerElem)},IImageElement.prototype.sourceRectAtTime=function(){return this.sourceRect};function ProcessedElement(e,r){this.elem=e,this.pos=r}function IShapeElement(){}IShapeElement.prototype={addShapeToModifiers:function(r){var s,d=this.shapeModifiers.length;for(s=0;s<d;s+=1)this.shapeModifiers[s].addShape(r)},isShapeInAnimatedModifiers:function(r){for(var s=0,d=this.shapeModifiers.length;s<d;)if(this.shapeModifiers[s].isAnimatedWithShape(r))return!0;return!1},renderModifiers:function(){if(this.shapeModifiers.length){var r,s=this.shapes.length;for(r=0;r<s;r+=1)this.shapes[r].sh.reset();s=this.shapeModifiers.length;var d;for(r=s-1;r>=0&&(d=this.shapeModifiers[r].processShapes(this._isFirstFrame),!d);r-=1);}},searchProcessedElement:function(r){for(var s=this.processedElements,d=0,f=s.length;d<f;){if(s[d].elem===r)return s[d].pos;d+=1}return 0},addProcessedElement:function(r,s){for(var d=this.processedElements,f=d.length;f;)if(f-=1,d[f].elem===r){d[f].pos=s;return}d.push(new ProcessedElement(r,s))},prepareFrame:function(r){this.prepareRenderableFrame(r),this.prepareProperties(r,this.isInRange)}};var lineCapEnum={1:"butt",2:"round",3:"square"},lineJoinEnum={1:"miter",2:"round",3:"bevel"};function SVGShapeData(e,r,s){this.caches=[],this.styles=[],this.transformers=e,this.lStr="",this.sh=s,this.lvl=r,this._isAnimated=!!s.k;for(var d=0,f=e.length;d<f;){if(e[d].mProps.dynamicProperties.length){this._isAnimated=!0;break}d+=1}}SVGShapeData.prototype.setAsAnimated=function(){this._isAnimated=!0};function SVGStyleData(e,r){this.data=e,this.type=e.ty,this.d="",this.lvl=r,this._mdf=!1,this.closed=e.hd===!0,this.pElem=createNS("path"),this.msElem=null}SVGStyleData.prototype.reset=function(){this.d="",this._mdf=!1};function DashProperty(e,r,s,d){this.elem=e,this.frameId=-1,this.dataProps=createSizedArray(r.length),this.renderer=s,this.k=!1,this.dashStr="",this.dashArray=createTypedArray("float32",r.length?r.length-1:0),this.dashoffset=createTypedArray("float32",1),this.initDynamicPropertyContainer(d);var f,_=r.length||0,C;for(f=0;f<_;f+=1)C=PropertyFactory.getProp(e,r[f].v,0,0,this),this.k=C.k||this.k,this.dataProps[f]={n:r[f].n,p:C};this.k||this.getValue(!0),this._isAnimated=this.k}DashProperty.prototype.getValue=function(e){if(!(this.elem.globalData.frameId===this.frameId&&!e)&&(this.frameId=this.elem.globalData.frameId,this.iterateDynamicProperties(),this._mdf=this._mdf||e,this._mdf)){var r=0,s=this.dataProps.length;for(this.renderer==="svg"&&(this.dashStr=""),r=0;r<s;r+=1)this.dataProps[r].n!=="o"?this.renderer==="svg"?this.dashStr+=" "+this.dataProps[r].p.v:this.dashArray[r]=this.dataProps[r].p.v:this.dashoffset[0]=this.dataProps[r].p.v}},extendPrototype([DynamicPropertyContainer],DashProperty);function SVGStrokeStyleData(e,r,s){this.initDynamicPropertyContainer(e),this.getValue=this.iterateDynamicProperties,this.o=PropertyFactory.getProp(e,r.o,0,.01,this),this.w=PropertyFactory.getProp(e,r.w,0,null,this),this.d=new DashProperty(e,r.d||{},"svg",this),this.c=PropertyFactory.getProp(e,r.c,1,255,this),this.style=s,this._isAnimated=!!this._isAnimated}extendPrototype([DynamicPropertyContainer],SVGStrokeStyleData);function SVGFillStyleData(e,r,s){this.initDynamicPropertyContainer(e),this.getValue=this.iterateDynamicProperties,this.o=PropertyFactory.getProp(e,r.o,0,.01,this),this.c=PropertyFactory.getProp(e,r.c,1,255,this),this.style=s}extendPrototype([DynamicPropertyContainer],SVGFillStyleData);function SVGNoStyleData(e,r,s){this.initDynamicPropertyContainer(e),this.getValue=this.iterateDynamicProperties,this.style=s}extendPrototype([DynamicPropertyContainer],SVGNoStyleData);function GradientProperty(e,r,s){this.data=r,this.c=createTypedArray("uint8c",r.p*4);var d=r.k.k[0].s?r.k.k[0].s.length-r.p*4:r.k.k.length-r.p*4;this.o=createTypedArray("float32",d),this._cmdf=!1,this._omdf=!1,this._collapsable=this.checkCollapsable(),this._hasOpacity=d,this.initDynamicPropertyContainer(s),this.prop=PropertyFactory.getProp(e,r.k,1,null,this),this.k=this.prop.k,this.getValue(!0)}GradientProperty.prototype.comparePoints=function(e,r){for(var s=0,d=this.o.length/2,f;s<d;){if(f=Math.abs(e[s*4]-e[r*4+s*2]),f>.01)return!1;s+=1}return!0},GradientProperty.prototype.checkCollapsable=function(){if(this.o.length/2!==this.c.length/4)return!1;if(this.data.k.k[0].s)for(var e=0,r=this.data.k.k.length;e<r;){if(!this.comparePoints(this.data.k.k[e].s,this.data.p))return!1;e+=1}else if(!this.comparePoints(this.data.k.k,this.data.p))return!1;return!0},GradientProperty.prototype.getValue=function(e){if(this.prop.getValue(),this._mdf=!1,this._cmdf=!1,this._omdf=!1,this.prop._mdf||e){var r,s=this.data.p*4,d,f;for(r=0;r<s;r+=1)d=r%4===0?100:255,f=Math.round(this.prop.v[r]*d),this.c[r]!==f&&(this.c[r]=f,this._cmdf=!e);if(this.o.length)for(s=this.prop.v.length,r=this.data.p*4;r<s;r+=1)d=r%2===0?100:1,f=r%2===0?Math.round(this.prop.v[r]*100):this.prop.v[r],this.o[r-this.data.p*4]!==f&&(this.o[r-this.data.p*4]=f,this._omdf=!e);this._mdf=!e}},extendPrototype([DynamicPropertyContainer],GradientProperty);function SVGGradientFillStyleData(e,r,s){this.initDynamicPropertyContainer(e),this.getValue=this.iterateDynamicProperties,this.initGradientData(e,r,s)}SVGGradientFillStyleData.prototype.initGradientData=function(e,r,s){this.o=PropertyFactory.getProp(e,r.o,0,.01,this),this.s=PropertyFactory.getProp(e,r.s,1,null,this),this.e=PropertyFactory.getProp(e,r.e,1,null,this),this.h=PropertyFactory.getProp(e,r.h||{k:0},0,.01,this),this.a=PropertyFactory.getProp(e,r.a||{k:0},0,degToRads,this),this.g=new GradientProperty(e,r.g,this),this.style=s,this.stops=[],this.setGradientData(s.pElem,r),this.setGradientOpacity(r,s),this._isAnimated=!!this._isAnimated},SVGGradientFillStyleData.prototype.setGradientData=function(e,r){var s=createElementID(),d=createNS(r.t===1?"linearGradient":"radialGradient");d.setAttribute("id",s),d.setAttribute("spreadMethod","pad"),d.setAttribute("gradientUnits","userSpaceOnUse");var f=[],_,C,P;for(P=r.g.p*4,C=0;C<P;C+=4)_=createNS("stop"),d.appendChild(_),f.push(_);e.setAttribute(r.ty==="gf"?"fill":"stroke","url("+getLocationHref()+"#"+s+")"),this.gf=d,this.cst=f},SVGGradientFillStyleData.prototype.setGradientOpacity=function(e,r){if(this.g._hasOpacity&&!this.g._collapsable){var s,d,f,_=createNS("mask"),C=createNS("path");_.appendChild(C);var P=createElementID(),x=createElementID();_.setAttribute("id",x);var B=createNS(e.t===1?"linearGradient":"radialGradient");B.setAttribute("id",P),B.setAttribute("spreadMethod","pad"),B.setAttribute("gradientUnits","userSpaceOnUse"),f=e.g.k.k[0].s?e.g.k.k[0].s.length:e.g.k.k.length;var _t=this.stops;for(d=e.g.p*4;d<f;d+=2)s=createNS("stop"),s.setAttribute("stop-color","rgb(255,255,255)"),B.appendChild(s),_t.push(s);C.setAttribute(e.ty==="gf"?"fill":"stroke","url("+getLocationHref()+"#"+P+")"),e.ty==="gs"&&(C.setAttribute("stroke-linecap",lineCapEnum[e.lc||2]),C.setAttribute("stroke-linejoin",lineJoinEnum[e.lj||2]),e.lj===1&&C.setAttribute("stroke-miterlimit",e.ml)),this.of=B,this.ms=_,this.ost=_t,this.maskId=x,r.msElem=C}},extendPrototype([DynamicPropertyContainer],SVGGradientFillStyleData);function SVGGradientStrokeStyleData(e,r,s){this.initDynamicPropertyContainer(e),this.getValue=this.iterateDynamicProperties,this.w=PropertyFactory.getProp(e,r.w,0,null,this),this.d=new DashProperty(e,r.d||{},"svg",this),this.initGradientData(e,r,s),this._isAnimated=!!this._isAnimated}extendPrototype([SVGGradientFillStyleData,DynamicPropertyContainer],SVGGradientStrokeStyleData);function ShapeGroupData(){this.it=[],this.prevViewData=[],this.gr=createNS("g")}function SVGTransformData(e,r,s){this.transform={mProps:e,op:r,container:s},this.elements=[],this._isAnimated=this.transform.mProps.dynamicProperties.length||this.transform.op.effectsSequence.length}var buildShapeString=function(r,s,d,f){if(s===0)return"";var _=r.o,C=r.i,P=r.v,x,B=" M"+f.applyToPointStringified(P[0][0],P[0][1]);for(x=1;x<s;x+=1)B+=" C"+f.applyToPointStringified(_[x-1][0],_[x-1][1])+" "+f.applyToPointStringified(C[x][0],C[x][1])+" "+f.applyToPointStringified(P[x][0],P[x][1]);return d&&s&&(B+=" C"+f.applyToPointStringified(_[x-1][0],_[x-1][1])+" "+f.applyToPointStringified(C[0][0],C[0][1])+" "+f.applyToPointStringified(P[0][0],P[0][1]),B+="z"),B},SVGElementsRenderer=function(){var e=new Matrix,r=new Matrix,s={createRenderFunction:d};function d(ue){switch(ue.ty){case"fl":return P;case"gf":return B;case"gs":return x;case"st":return _t;case"sh":case"el":case"rc":case"sr":return C;case"tr":return f;case"no":return _;default:return null}}function f(ue,Wt,_n){(_n||Wt.transform.op._mdf)&&Wt.transform.container.setAttribute("opacity",Wt.transform.op.v),(_n||Wt.transform.mProps._mdf)&&Wt.transform.container.setAttribute("transform",Wt.transform.mProps.v.to2dCSS())}function _(){}function C(ue,Wt,_n){var _i,Ei,_a,Di,_o,_s,_c=Wt.styles.length,_m=Wt.lvl,Qm,tE,aE,CE;for(_s=0;_s<_c;_s+=1){if(Di=Wt.sh._mdf||_n,Wt.styles[_s].lvl<_m){for(tE=r.reset(),aE=_m-Wt.styles[_s].lvl,CE=Wt.transformers.length-1;!Di&&aE>0;)Di=Wt.transformers[CE].mProps._mdf||Di,aE-=1,CE-=1;if(Di)for(aE=_m-Wt.styles[_s].lvl,CE=Wt.transformers.length-1;aE>0;)tE.multiply(Wt.transformers[CE].mProps.v),aE-=1,CE-=1}else tE=e;if(Qm=Wt.sh.paths,Ei=Qm._length,Di){for(_a="",_i=0;_i<Ei;_i+=1)_o=Qm.shapes[_i],_o&&_o._length&&(_a+=buildShapeString(_o,_o._length,_o.c,tE));Wt.caches[_s]=_a}else _a=Wt.caches[_s];Wt.styles[_s].d+=ue.hd===!0?"":_a,Wt.styles[_s]._mdf=Di||Wt.styles[_s]._mdf}}function P(ue,Wt,_n){var _i=Wt.style;(Wt.c._mdf||_n)&&_i.pElem.setAttribute("fill","rgb("+bmFloor(Wt.c.v[0])+","+bmFloor(Wt.c.v[1])+","+bmFloor(Wt.c.v[2])+")"),(Wt.o._mdf||_n)&&_i.pElem.setAttribute("fill-opacity",Wt.o.v)}function x(ue,Wt,_n){B(ue,Wt,_n),_t(ue,Wt,_n)}function B(ue,Wt,_n){var _i=Wt.gf,Ei=Wt.g._hasOpacity,_a=Wt.s.v,Di=Wt.e.v;if(Wt.o._mdf||_n){var _o=ue.ty==="gf"?"fill-opacity":"stroke-opacity";Wt.style.pElem.setAttribute(_o,Wt.o.v)}if(Wt.s._mdf||_n){var _s=ue.t===1?"x1":"cx",_c=_s==="x1"?"y1":"cy";_i.setAttribute(_s,_a[0]),_i.setAttribute(_c,_a[1]),Ei&&!Wt.g._collapsable&&(Wt.of.setAttribute(_s,_a[0]),Wt.of.setAttribute(_c,_a[1]))}var _m,Qm,tE,aE;if(Wt.g._cmdf||_n){_m=Wt.cst;var CE=Wt.g.c;for(tE=_m.length,Qm=0;Qm<tE;Qm+=1)aE=_m[Qm],aE.setAttribute("offset",CE[Qm*4]+"%"),aE.setAttribute("stop-color","rgb("+CE[Qm*4+1]+","+CE[Qm*4+2]+","+CE[Qm*4+3]+")")}if(Ei&&(Wt.g._omdf||_n)){var lE=Wt.g.o;for(Wt.g._collapsable?_m=Wt.cst:_m=Wt.ost,tE=_m.length,Qm=0;Qm<tE;Qm+=1)aE=_m[Qm],Wt.g._collapsable||aE.setAttribute("offset",lE[Qm*2]+"%"),aE.setAttribute("stop-opacity",lE[Qm*2+1])}if(ue.t===1)(Wt.e._mdf||_n)&&(_i.setAttribute("x2",Di[0]),_i.setAttribute("y2",Di[1]),Ei&&!Wt.g._collapsable&&(Wt.of.setAttribute("x2",Di[0]),Wt.of.setAttribute("y2",Di[1])));else{var gE;if((Wt.s._mdf||Wt.e._mdf||_n)&&(gE=Math.sqrt(Math.pow(_a[0]-Di[0],2)+Math.pow(_a[1]-Di[1],2)),_i.setAttribute("r",gE),Ei&&!Wt.g._collapsable&&Wt.of.setAttribute("r",gE)),Wt.e._mdf||Wt.h._mdf||Wt.a._mdf||_n){gE||(gE=Math.sqrt(Math.pow(_a[0]-Di[0],2)+Math.pow(_a[1]-Di[1],2)));var cE=Math.atan2(Di[1]-_a[1],Di[0]-_a[0]),_E=Wt.h.v;_E>=1?_E=.99:_E<=-1&&(_E=-.99);var iE=gE*_E,rE=Math.cos(cE+Wt.a.v)*iE+_a[0],vf=Math.sin(cE+Wt.a.v)*iE+_a[1];_i.setAttribute("fx",rE),_i.setAttribute("fy",vf),Ei&&!Wt.g._collapsable&&(Wt.of.setAttribute("fx",rE),Wt.of.setAttribute("fy",vf))}}}function _t(ue,Wt,_n){var _i=Wt.style,Ei=Wt.d;Ei&&(Ei._mdf||_n)&&Ei.dashStr&&(_i.pElem.setAttribute("stroke-dasharray",Ei.dashStr),_i.pElem.setAttribute("stroke-dashoffset",Ei.dashoffset[0])),Wt.c&&(Wt.c._mdf||_n)&&_i.pElem.setAttribute("stroke","rgb("+bmFloor(Wt.c.v[0])+","+bmFloor(Wt.c.v[1])+","+bmFloor(Wt.c.v[2])+")"),(Wt.o._mdf||_n)&&_i.pElem.setAttribute("stroke-opacity",Wt.o.v),(Wt.w._mdf||_n)&&(_i.pElem.setAttribute("stroke-width",Wt.w.v),_i.msElem&&_i.msElem.setAttribute("stroke-width",Wt.w.v))}return s}();function SVGShapeElement(e,r,s){this.shapes=[],this.shapesData=e.shapes,this.stylesList=[],this.shapeModifiers=[],this.itemsData=[],this.processedElements=[],this.animatedContents=[],this.initElement(e,r,s),this.prevViewData=[]}extendPrototype([BaseElement,TransformElement,SVGBaseElement,IShapeElement,HierarchyElement,FrameElement,RenderableDOMElement],SVGShapeElement),SVGShapeElement.prototype.initSecondaryElement=function(){},SVGShapeElement.prototype.identityMatrix=new Matrix,SVGShapeElement.prototype.buildExpressionInterface=function(){},SVGShapeElement.prototype.createContent=function(){this.searchShapes(this.shapesData,this.itemsData,this.prevViewData,this.layerElement,0,[],!0),this.filterUniqueShapes()},SVGShapeElement.prototype.filterUniqueShapes=function(){var e,r=this.shapes.length,s,d,f=this.stylesList.length,_,C=[],P=!1;for(d=0;d<f;d+=1){for(_=this.stylesList[d],P=!1,C.length=0,e=0;e<r;e+=1)s=this.shapes[e],s.styles.indexOf(_)!==-1&&(C.push(s),P=s._isAnimated||P);C.length>1&&P&&this.setShapesAsAnimated(C)}},SVGShapeElement.prototype.setShapesAsAnimated=function(e){var r,s=e.length;for(r=0;r<s;r+=1)e[r].setAsAnimated()},SVGShapeElement.prototype.createStyleElement=function(e,r){var s,d=new SVGStyleData(e,r),f=d.pElem;if(e.ty==="st")s=new SVGStrokeStyleData(this,e,d);else if(e.ty==="fl")s=new SVGFillStyleData(this,e,d);else if(e.ty==="gf"||e.ty==="gs"){var _=e.ty==="gf"?SVGGradientFillStyleData:SVGGradientStrokeStyleData;s=new _(this,e,d),this.globalData.defs.appendChild(s.gf),s.maskId&&(this.globalData.defs.appendChild(s.ms),this.globalData.defs.appendChild(s.of),f.setAttribute("mask","url("+getLocationHref()+"#"+s.maskId+")"))}else e.ty==="no"&&(s=new SVGNoStyleData(this,e,d));return(e.ty==="st"||e.ty==="gs")&&(f.setAttribute("stroke-linecap",lineCapEnum[e.lc||2]),f.setAttribute("stroke-linejoin",lineJoinEnum[e.lj||2]),f.setAttribute("fill-opacity","0"),e.lj===1&&f.setAttribute("stroke-miterlimit",e.ml)),e.r===2&&f.setAttribute("fill-rule","evenodd"),e.ln&&f.setAttribute("id",e.ln),e.cl&&f.setAttribute("class",e.cl),e.bm&&(f.style["mix-blend-mode"]=getBlendMode(e.bm)),this.stylesList.push(d),this.addToAnimatedContents(e,s),s},SVGShapeElement.prototype.createGroupElement=function(e){var r=new ShapeGroupData;return e.ln&&r.gr.setAttribute("id",e.ln),e.cl&&r.gr.setAttribute("class",e.cl),e.bm&&(r.gr.style["mix-blend-mode"]=getBlendMode(e.bm)),r},SVGShapeElement.prototype.createTransformElement=function(e,r){var s=TransformPropertyFactory.getTransformProperty(this,e,this),d=new SVGTransformData(s,s.o,r);return this.addToAnimatedContents(e,d),d},SVGShapeElement.prototype.createShapeElement=function(e,r,s){var d=4;e.ty==="rc"?d=5:e.ty==="el"?d=6:e.ty==="sr"&&(d=7);var f=ShapePropertyFactory.getShapeProp(this,e,d,this),_=new SVGShapeData(r,s,f);return this.shapes.push(_),this.addShapeToModifiers(_),this.addToAnimatedContents(e,_),_},SVGShapeElement.prototype.addToAnimatedContents=function(e,r){for(var s=0,d=this.animatedContents.length;s<d;){if(this.animatedContents[s].element===r)return;s+=1}this.animatedContents.push({fn:SVGElementsRenderer.createRenderFunction(e),element:r,data:e})},SVGShapeElement.prototype.setElementStyles=function(e){var r=e.styles,s,d=this.stylesList.length;for(s=0;s<d;s+=1)this.stylesList[s].closed||r.push(this.stylesList[s])},SVGShapeElement.prototype.reloadShapes=function(){this._isFirstFrame=!0;var e,r=this.itemsData.length;for(e=0;e<r;e+=1)this.prevViewData[e]=this.itemsData[e];for(this.searchShapes(this.shapesData,this.itemsData,this.prevViewData,this.layerElement,0,[],!0),this.filterUniqueShapes(),r=this.dynamicProperties.length,e=0;e<r;e+=1)this.dynamicProperties[e].getValue();this.renderModifiers()},SVGShapeElement.prototype.searchShapes=function(e,r,s,d,f,_,C){var P=[].concat(_),x,B=e.length-1,_t,ue,Wt=[],_n=[],_i,Ei,_a;for(x=B;x>=0;x-=1){if(_a=this.searchProcessedElement(e[x]),_a?r[x]=s[_a-1]:e[x]._render=C,e[x].ty==="fl"||e[x].ty==="st"||e[x].ty==="gf"||e[x].ty==="gs"||e[x].ty==="no")_a?r[x].style.closed=!1:r[x]=this.createStyleElement(e[x],f),e[x]._render&&r[x].style.pElem.parentNode!==d&&d.appendChild(r[x].style.pElem),Wt.push(r[x].style);else if(e[x].ty==="gr"){if(!_a)r[x]=this.createGroupElement(e[x]);else for(ue=r[x].it.length,_t=0;_t<ue;_t+=1)r[x].prevViewData[_t]=r[x].it[_t];this.searchShapes(e[x].it,r[x].it,r[x].prevViewData,r[x].gr,f+1,P,C),e[x]._render&&r[x].gr.parentNode!==d&&d.appendChild(r[x].gr)}else e[x].ty==="tr"?(_a||(r[x]=this.createTransformElement(e[x],d)),_i=r[x].transform,P.push(_i)):e[x].ty==="sh"||e[x].ty==="rc"||e[x].ty==="el"||e[x].ty==="sr"?(_a||(r[x]=this.createShapeElement(e[x],P,f)),this.setElementStyles(r[x])):e[x].ty==="tm"||e[x].ty==="rd"||e[x].ty==="ms"||e[x].ty==="pb"||e[x].ty==="zz"||e[x].ty==="op"?(_a?(Ei=r[x],Ei.closed=!1):(Ei=ShapeModifiers.getModifier(e[x].ty),Ei.init(this,e[x]),r[x]=Ei,this.shapeModifiers.push(Ei)),_n.push(Ei)):e[x].ty==="rp"&&(_a?(Ei=r[x],Ei.closed=!0):(Ei=ShapeModifiers.getModifier(e[x].ty),r[x]=Ei,Ei.init(this,e,x,r),this.shapeModifiers.push(Ei),C=!1),_n.push(Ei));this.addProcessedElement(e[x],x+1)}for(B=Wt.length,x=0;x<B;x+=1)Wt[x].closed=!0;for(B=_n.length,x=0;x<B;x+=1)_n[x].closed=!0},SVGShapeElement.prototype.renderInnerContent=function(){this.renderModifiers();var e,r=this.stylesList.length;for(e=0;e<r;e+=1)this.stylesList[e].reset();for(this.renderShape(),e=0;e<r;e+=1)(this.stylesList[e]._mdf||this._isFirstFrame)&&(this.stylesList[e].msElem&&(this.stylesList[e].msElem.setAttribute("d",this.stylesList[e].d),this.stylesList[e].d="M0 0"+this.stylesList[e].d),this.stylesList[e].pElem.setAttribute("d",this.stylesList[e].d||"M0 0"))},SVGShapeElement.prototype.renderShape=function(){var e,r=this.animatedContents.length,s;for(e=0;e<r;e+=1)s=this.animatedContents[e],(this._isFirstFrame||s.element._isAnimated)&&s.data!==!0&&s.fn(s.data,s.element,this._isFirstFrame)},SVGShapeElement.prototype.destroy=function(){this.destroyBaseElement(),this.shapesData=null,this.itemsData=null};function LetterProps(e,r,s,d,f,_){this.o=e,this.sw=r,this.sc=s,this.fc=d,this.m=f,this.p=_,this._mdf={o:!0,sw:!!r,sc:!!s,fc:!!d,m:!0,p:!0}}LetterProps.prototype.update=function(e,r,s,d,f,_){this._mdf.o=!1,this._mdf.sw=!1,this._mdf.sc=!1,this._mdf.fc=!1,this._mdf.m=!1,this._mdf.p=!1;var C=!1;return this.o!==e&&(this.o=e,this._mdf.o=!0,C=!0),this.sw!==r&&(this.sw=r,this._mdf.sw=!0,C=!0),this.sc!==s&&(this.sc=s,this._mdf.sc=!0,C=!0),this.fc!==d&&(this.fc=d,this._mdf.fc=!0,C=!0),this.m!==f&&(this.m=f,this._mdf.m=!0,C=!0),_.length&&(this.p[0]!==_[0]||this.p[1]!==_[1]||this.p[4]!==_[4]||this.p[5]!==_[5]||this.p[12]!==_[12]||this.p[13]!==_[13])&&(this.p=_,this._mdf.p=!0,C=!0),C};function TextProperty(e,r){this._frameId=initialDefaultFrame,this.pv="",this.v="",this.kf=!1,this._isFirstFrame=!0,this._mdf=!1,r.d&&r.d.sid&&(r.d=e.globalData.slotManager.getProp(r.d)),this.data=r,this.elem=e,this.comp=this.elem.comp,this.keysIndex=0,this.canResize=!1,this.minimumFontSize=1,this.effectsSequence=[],this.currentData={ascent:0,boxWidth:this.defaultBoxWidth,f:"",fStyle:"",fWeight:"",fc:"",j:"",justifyOffset:"",l:[],lh:0,lineWidths:[],ls:"",of:"",s:"",sc:"",sw:0,t:0,tr:0,sz:0,ps:null,fillColorAnim:!1,strokeColorAnim:!1,strokeWidthAnim:!1,yOffset:0,finalSize:0,finalText:[],finalLineHeight:0,__complete:!1},this.copyData(this.currentData,this.data.d.k[0].s),this.searchProperty()||this.completeTextData(this.currentData)}TextProperty.prototype.defaultBoxWidth=[0,0],TextProperty.prototype.copyData=function(e,r){for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s]);return e},TextProperty.prototype.setCurrentData=function(e){e.__complete||this.completeTextData(e),this.currentData=e,this.currentData.boxWidth=this.currentData.boxWidth||this.defaultBoxWidth,this._mdf=!0},TextProperty.prototype.searchProperty=function(){return this.searchKeyframes()},TextProperty.prototype.searchKeyframes=function(){return this.kf=this.data.d.k.length>1,this.kf&&this.addEffect(this.getKeyframeValue.bind(this)),this.kf},TextProperty.prototype.addEffect=function(e){this.effectsSequence.push(e),this.elem.addDynamicProperty(this)},TextProperty.prototype.getValue=function(e){if(!((this.elem.globalData.frameId===this.frameId||!this.effectsSequence.length)&&!e)){this.currentData.t=this.data.d.k[this.keysIndex].s.t;var r=this.currentData,s=this.keysIndex;if(this.lock){this.setCurrentData(this.currentData);return}this.lock=!0,this._mdf=!1;var d,f=this.effectsSequence.length,_=e||this.data.d.k[this.keysIndex].s;for(d=0;d<f;d+=1)s!==this.keysIndex?_=this.effectsSequence[d](_,_.t):_=this.effectsSequence[d](this.currentData,_.t);r!==_&&this.setCurrentData(_),this.v=this.currentData,this.pv=this.v,this.lock=!1,this.frameId=this.elem.globalData.frameId}},TextProperty.prototype.getKeyframeValue=function(){for(var e=this.data.d.k,r=this.elem.comp.renderedFrame,s=0,d=e.length;s<=d-1&&!(s===d-1||e[s+1].t>r);)s+=1;return this.keysIndex!==s&&(this.keysIndex=s),this.data.d.k[this.keysIndex].s},TextProperty.prototype.buildFinalText=function(e){for(var r=[],s=0,d=e.length,f,_,C=!1,P=!1,x="";s<d;)C=P,P=!1,f=e.charCodeAt(s),x=e.charAt(s),FontManager.isCombinedCharacter(f)?C=!0:f>=55296&&f<=56319?FontManager.isRegionalFlag(e,s)?x=e.substr(s,14):(_=e.charCodeAt(s+1),_>=56320&&_<=57343&&(FontManager.isModifier(f,_)?(x=e.substr(s,2),C=!0):FontManager.isFlagEmoji(e.substr(s,4))?x=e.substr(s,4):x=e.substr(s,2))):f>56319?(_=e.charCodeAt(s+1),FontManager.isVariationSelector(f)&&(C=!0)):FontManager.isZeroWidthJoiner(f)&&(C=!0,P=!0),C?(r[r.length-1]+=x,C=!1):r.push(x),s+=x.length;return r},TextProperty.prototype.completeTextData=function(e){e.__complete=!0;var r=this.elem.globalData.fontManager,s=this.data,d=[],f,_,C,P=0,x,B=s.m.g,_t=0,ue=0,Wt=0,_n=[],_i=0,Ei=0,_a,Di,_o=r.getFontByName(e.f),_s,_c=0,_m=getFontProperties(_o);e.fWeight=_m.weight,e.fStyle=_m.style,e.finalSize=e.s,e.finalText=this.buildFinalText(e.t),_=e.finalText.length,e.finalLineHeight=e.lh;var Qm=e.tr/1e3*e.finalSize,tE;if(e.sz)for(var aE=!0,CE=e.sz[0],lE=e.sz[1],gE,cE;aE;){cE=this.buildFinalText(e.t),gE=0,_i=0,_=cE.length,Qm=e.tr/1e3*e.finalSize;var _E=-1;for(f=0;f<_;f+=1)tE=cE[f].charCodeAt(0),C=!1,cE[f]===" "?_E=f:(tE===13||tE===3)&&(_i=0,C=!0,gE+=e.finalLineHeight||e.finalSize*1.2),r.chars?(_s=r.getCharData(cE[f],_o.fStyle,_o.fFamily),_c=C?0:_s.w*e.finalSize/100):_c=r.measureText(cE[f],e.f,e.finalSize),_i+_c>CE&&cE[f]!==" "?(_E===-1?_+=1:f=_E,gE+=e.finalLineHeight||e.finalSize*1.2,cE.splice(f,_E===f?1:0,"\r"),_E=-1,_i=0):(_i+=_c,_i+=Qm);gE+=_o.ascent*e.finalSize/100,this.canResize&&e.finalSize>this.minimumFontSize&&lE<gE?(e.finalSize-=1,e.finalLineHeight=e.finalSize*e.lh/e.s):(e.finalText=cE,_=e.finalText.length,aE=!1)}_i=-Qm,_c=0;var iE=0,rE;for(f=0;f<_;f+=1)if(C=!1,rE=e.finalText[f],tE=rE.charCodeAt(0),tE===13||tE===3?(iE=0,_n.push(_i),Ei=_i>Ei?_i:Ei,_i=-2*Qm,x="",C=!0,Wt+=1):x=rE,r.chars?(_s=r.getCharData(rE,_o.fStyle,r.getFontByName(e.f).fFamily),_c=C?0:_s.w*e.finalSize/100):_c=r.measureText(x,e.f,e.finalSize),rE===" "?iE+=_c+Qm:(_i+=_c+Qm+iE,iE=0),d.push({l:_c,an:_c,add:_t,n:C,anIndexes:[],val:x,line:Wt,animatorJustifyOffset:0}),B==2){if(_t+=_c,x===""||x===" "||f===_-1){for((x===""||x===" ")&&(_t-=_c);ue<=f;)d[ue].an=_t,d[ue].ind=P,d[ue].extra=_c,ue+=1;P+=1,_t=0}}else if(B==3){if(_t+=_c,x===""||f===_-1){for(x===""&&(_t-=_c);ue<=f;)d[ue].an=_t,d[ue].ind=P,d[ue].extra=_c,ue+=1;_t=0,P+=1}}else d[P].ind=P,d[P].extra=0,P+=1;if(e.l=d,Ei=_i>Ei?_i:Ei,_n.push(_i),e.sz)e.boxWidth=e.sz[0],e.justifyOffset=0;else switch(e.boxWidth=Ei,e.j){case 1:e.justifyOffset=-e.boxWidth;break;case 2:e.justifyOffset=-e.boxWidth/2;break;default:e.justifyOffset=0}e.lineWidths=_n;var vf=s.a,Fg,_d;Di=vf.length;var _f,uE,dE=[];for(_a=0;_a<Di;_a+=1){for(Fg=vf[_a],Fg.a.sc&&(e.strokeColorAnim=!0),Fg.a.sw&&(e.strokeWidthAnim=!0),(Fg.a.fc||Fg.a.fh||Fg.a.fs||Fg.a.fb)&&(e.fillColorAnim=!0),uE=0,_f=Fg.s.b,f=0;f<_;f+=1)_d=d[f],_d.anIndexes[_a]=uE,(_f==1&&_d.val!==""||_f==2&&_d.val!==""&&_d.val!==" "||_f==3&&(_d.n||_d.val==" "||f==_-1)||_f==4&&(_d.n||f==_-1))&&(Fg.s.rn===1&&dE.push(uE),uE+=1);s.a[_a].s.totalChars=uE;var IE=-1,DE;if(Fg.s.rn===1)for(f=0;f<_;f+=1)_d=d[f],IE!=_d.anIndexes[_a]&&(IE=_d.anIndexes[_a],DE=dE.splice(Math.floor(Math.random()*dE.length),1)[0]),_d.anIndexes[_a]=DE}e.yOffset=e.finalLineHeight||e.finalSize*1.2,e.ls=e.ls||0,e.ascent=_o.ascent*e.finalSize/100},TextProperty.prototype.updateDocumentData=function(e,r){r=r===void 0?this.keysIndex:r;var s=this.copyData({},this.data.d.k[r].s);s=this.copyData(s,e),this.data.d.k[r].s=s,this.recalculate(r),this.setCurrentData(s),this.elem.addDynamicProperty(this)},TextProperty.prototype.recalculate=function(e){var r=this.data.d.k[e].s;r.__complete=!1,this.keysIndex=0,this._isFirstFrame=!0,this.getValue(r)},TextProperty.prototype.canResizeFont=function(e){this.canResize=e,this.recalculate(this.keysIndex),this.elem.addDynamicProperty(this)},TextProperty.prototype.setMinimumFontSize=function(e){this.minimumFontSize=Math.floor(e)||1,this.recalculate(this.keysIndex),this.elem.addDynamicProperty(this)};var TextSelectorProp=function(){var e=Math.max,r=Math.min,s=Math.floor;function d(_,C){this._currentTextLength=-1,this.k=!1,this.data=C,this.elem=_,this.comp=_.comp,this.finalS=0,this.finalE=0,this.initDynamicPropertyContainer(_),this.s=PropertyFactory.getProp(_,C.s||{k:0},0,0,this),"e"in C?this.e=PropertyFactory.getProp(_,C.e,0,0,this):this.e={v:100},this.o=PropertyFactory.getProp(_,C.o||{k:0},0,0,this),this.xe=PropertyFactory.getProp(_,C.xe||{k:0},0,0,this),this.ne=PropertyFactory.getProp(_,C.ne||{k:0},0,0,this),this.sm=PropertyFactory.getProp(_,C.sm||{k:100},0,0,this),this.a=PropertyFactory.getProp(_,C.a,0,.01,this),this.dynamicProperties.length||this.getValue()}d.prototype={getMult:function(C){this._currentTextLength!==this.elem.textProperty.currentData.l.length&&this.getValue();var P=0,x=0,B=1,_t=1;this.ne.v>0?P=this.ne.v/100:x=-this.ne.v/100,this.xe.v>0?B=1-this.xe.v/100:_t=1+this.xe.v/100;var ue=BezierFactory.getBezierEasing(P,x,B,_t).get,Wt=0,_n=this.finalS,_i=this.finalE,Ei=this.data.sh;if(Ei===2)_i===_n?Wt=C>=_i?1:0:Wt=e(0,r(.5/(_i-_n)+(C-_n)/(_i-_n),1)),Wt=ue(Wt);else if(Ei===3)_i===_n?Wt=C>=_i?0:1:Wt=1-e(0,r(.5/(_i-_n)+(C-_n)/(_i-_n),1)),Wt=ue(Wt);else if(Ei===4)_i===_n?Wt=0:(Wt=e(0,r(.5/(_i-_n)+(C-_n)/(_i-_n),1)),Wt<.5?Wt*=2:Wt=1-2*(Wt-.5)),Wt=ue(Wt);else if(Ei===5){if(_i===_n)Wt=0;else{var _a=_i-_n;C=r(e(0,C+.5-_n),_i-_n);var Di=-_a/2+C,_o=_a/2;Wt=Math.sqrt(1-Di*Di/(_o*_o))}Wt=ue(Wt)}else Ei===6?(_i===_n?Wt=0:(C=r(e(0,C+.5-_n),_i-_n),Wt=(1+Math.cos(Math.PI+Math.PI*2*C/(_i-_n)))/2),Wt=ue(Wt)):(C>=s(_n)&&(C-_n<0?Wt=e(0,r(r(_i,1)-(_n-C),1)):Wt=e(0,r(_i-C,1))),Wt=ue(Wt));if(this.sm.v!==100){var _s=this.sm.v*.01;_s===0&&(_s=1e-8);var _c=.5-_s*.5;Wt<_c?Wt=0:(Wt=(Wt-_c)/_s,Wt>1&&(Wt=1))}return Wt*this.a.v},getValue:function(C){this.iterateDynamicProperties(),this._mdf=C||this._mdf,this._currentTextLength=this.elem.textProperty.currentData.l.length||0,C&&this.data.r===2&&(this.e.v=this._currentTextLength);var P=this.data.r===2?1:100/this.data.totalChars,x=this.o.v/P,B=this.s.v/P+x,_t=this.e.v/P+x;if(B>_t){var ue=B;B=_t,_t=ue}this.finalS=B,this.finalE=_t}},extendPrototype([DynamicPropertyContainer],d);function f(_,C,P){return new d(_,C)}return{getTextSelectorProp:f}}();function TextAnimatorDataProperty(e,r,s){var d={propType:!1},f=PropertyFactory.getProp,_=r.a;this.a={r:_.r?f(e,_.r,0,degToRads,s):d,rx:_.rx?f(e,_.rx,0,degToRads,s):d,ry:_.ry?f(e,_.ry,0,degToRads,s):d,sk:_.sk?f(e,_.sk,0,degToRads,s):d,sa:_.sa?f(e,_.sa,0,degToRads,s):d,s:_.s?f(e,_.s,1,.01,s):d,a:_.a?f(e,_.a,1,0,s):d,o:_.o?f(e,_.o,0,.01,s):d,p:_.p?f(e,_.p,1,0,s):d,sw:_.sw?f(e,_.sw,0,0,s):d,sc:_.sc?f(e,_.sc,1,0,s):d,fc:_.fc?f(e,_.fc,1,0,s):d,fh:_.fh?f(e,_.fh,0,0,s):d,fs:_.fs?f(e,_.fs,0,.01,s):d,fb:_.fb?f(e,_.fb,0,.01,s):d,t:_.t?f(e,_.t,0,0,s):d},this.s=TextSelectorProp.getTextSelectorProp(e,r.s,s),this.s.t=r.s.t}function TextAnimatorProperty(e,r,s){this._isFirstFrame=!0,this._hasMaskedPath=!1,this._frameId=-1,this._textData=e,this._renderType=r,this._elem=s,this._animatorsData=createSizedArray(this._textData.a.length),this._pathData={},this._moreOptions={alignment:{}},this.renderedLetters=[],this.lettersChangedFlag=!1,this.initDynamicPropertyContainer(s)}TextAnimatorProperty.prototype.searchProperties=function(){var e,r=this._textData.a.length,s,d=PropertyFactory.getProp;for(e=0;e<r;e+=1)s=this._textData.a[e],this._animatorsData[e]=new TextAnimatorDataProperty(this._elem,s,this);this._textData.p&&"m"in this._textData.p?(this._pathData={a:d(this._elem,this._textData.p.a,0,0,this),f:d(this._elem,this._textData.p.f,0,0,this),l:d(this._elem,this._textData.p.l,0,0,this),r:d(this._elem,this._textData.p.r,0,0,this),p:d(this._elem,this._textData.p.p,0,0,this),m:this._elem.maskManager.getMaskProperty(this._textData.p.m)},this._hasMaskedPath=!0):this._hasMaskedPath=!1,this._moreOptions.alignment=d(this._elem,this._textData.m.a,1,0,this)},TextAnimatorProperty.prototype.getMeasures=function(e,r){if(this.lettersChangedFlag=r,!(!this._mdf&&!this._isFirstFrame&&!r&&(!this._hasMaskedPath||!this._pathData.m._mdf))){this._isFirstFrame=!1;var s=this._moreOptions.alignment.v,d=this._animatorsData,f=this._textData,_=this.mHelper,C=this._renderType,P=this.renderedLetters.length,x,B,_t,ue,Wt=e.l,_n,_i,Ei,_a,Di,_o,_s,_c,_m,Qm,tE,aE,CE,lE,gE;if(this._hasMaskedPath){if(gE=this._pathData.m,!this._pathData.n||this._pathData._mdf){var cE=gE.v;this._pathData.r.v&&(cE=cE.reverse()),_n={tLength:0,segments:[]},ue=cE._length-1;var _E;for(aE=0,_t=0;_t<ue;_t+=1)_E=bez.buildBezierData(cE.v[_t],cE.v[_t+1],[cE.o[_t][0]-cE.v[_t][0],cE.o[_t][1]-cE.v[_t][1]],[cE.i[_t+1][0]-cE.v[_t+1][0],cE.i[_t+1][1]-cE.v[_t+1][1]]),_n.tLength+=_E.segmentLength,_n.segments.push(_E),aE+=_E.segmentLength;_t=ue,gE.v.c&&(_E=bez.buildBezierData(cE.v[_t],cE.v[0],[cE.o[_t][0]-cE.v[_t][0],cE.o[_t][1]-cE.v[_t][1]],[cE.i[0][0]-cE.v[0][0],cE.i[0][1]-cE.v[0][1]]),_n.tLength+=_E.segmentLength,_n.segments.push(_E),aE+=_E.segmentLength),this._pathData.pi=_n}if(_n=this._pathData.pi,_i=this._pathData.f.v,_s=0,_o=1,_a=0,Di=!0,Qm=_n.segments,_i<0&&gE.v.c)for(_n.tLength<Math.abs(_i)&&(_i=-Math.abs(_i)%_n.tLength),_s=Qm.length-1,_m=Qm[_s].points,_o=_m.length-1;_i<0;)_i+=_m[_o].partialLength,_o-=1,_o<0&&(_s-=1,_m=Qm[_s].points,_o=_m.length-1);_m=Qm[_s].points,_c=_m[_o-1],Ei=_m[_o],tE=Ei.partialLength}ue=Wt.length,x=0,B=0;var iE=e.finalSize*1.2*.714,rE=!0,vf,Fg,_d,_f,uE;_f=d.length;var dE,IE=-1,DE,GE,QE,a_=_i,m0=_s,W0=_o,mS=-1,M0,s0,Y0,o_,LE,R_,KE,f_,F_="",T0=this.defaultPropsArray,Mb;if(e.j===2||e.j===1){var A0=0,jS=0,eT=e.j===2?-.5:-1,gS=0,VS=!0;for(_t=0;_t<ue;_t+=1)if(Wt[_t].n){for(A0&&(A0+=jS);gS<_t;)Wt[gS].animatorJustifyOffset=A0,gS+=1;A0=0,VS=!0}else{for(_d=0;_d<_f;_d+=1)vf=d[_d].a,vf.t.propType&&(VS&&e.j===2&&(jS+=vf.t.v*eT),Fg=d[_d].s,dE=Fg.getMult(Wt[_t].anIndexes[_d],f.a[_d].s.totalChars),dE.length?A0+=vf.t.v*dE[0]*eT:A0+=vf.t.v*dE*eT);VS=!1}for(A0&&(A0+=jS);gS<_t;)Wt[gS].animatorJustifyOffset=A0,gS+=1}for(_t=0;_t<ue;_t+=1){if(_.reset(),M0=1,Wt[_t].n)x=0,B+=e.yOffset,B+=rE?1:0,_i=a_,rE=!1,this._hasMaskedPath&&(_s=m0,_o=W0,_m=Qm[_s].points,_c=_m[_o-1],Ei=_m[_o],tE=Ei.partialLength,_a=0),F_="",f_="",R_="",Mb="",T0=this.defaultPropsArray;else{if(this._hasMaskedPath){if(mS!==Wt[_t].line){switch(e.j){case 1:_i+=aE-e.lineWidths[Wt[_t].line];break;case 2:_i+=(aE-e.lineWidths[Wt[_t].line])/2;break}mS=Wt[_t].line}IE!==Wt[_t].ind&&(Wt[IE]&&(_i+=Wt[IE].extra),_i+=Wt[_t].an/2,IE=Wt[_t].ind),_i+=s[0]*Wt[_t].an*.005;var rS=0;for(_d=0;_d<_f;_d+=1)vf=d[_d].a,vf.p.propType&&(Fg=d[_d].s,dE=Fg.getMult(Wt[_t].anIndexes[_d],f.a[_d].s.totalChars),dE.length?rS+=vf.p.v[0]*dE[0]:rS+=vf.p.v[0]*dE),vf.a.propType&&(Fg=d[_d].s,dE=Fg.getMult(Wt[_t].anIndexes[_d],f.a[_d].s.totalChars),dE.length?rS+=vf.a.v[0]*dE[0]:rS+=vf.a.v[0]*dE);for(Di=!0,this._pathData.a.v&&(_i=Wt[0].an*.5+(aE-this._pathData.f.v-Wt[0].an*.5-Wt[Wt.length-1].an*.5)*IE/(ue-1),_i+=this._pathData.f.v);Di;)_a+tE>=_i+rS||!_m?(CE=(_i+rS-_a)/Ei.partialLength,GE=_c.point[0]+(Ei.point[0]-_c.point[0])*CE,QE=_c.point[1]+(Ei.point[1]-_c.point[1])*CE,_.translate(-s[0]*Wt[_t].an*.005,-(s[1]*iE)*.01),Di=!1):_m&&(_a+=Ei.partialLength,_o+=1,_o>=_m.length&&(_o=0,_s+=1,Qm[_s]?_m=Qm[_s].points:gE.v.c?(_o=0,_s=0,_m=Qm[_s].points):(_a-=Ei.partialLength,_m=null)),_m&&(_c=Ei,Ei=_m[_o],tE=Ei.partialLength));DE=Wt[_t].an/2-Wt[_t].add,_.translate(-DE,0,0)}else DE=Wt[_t].an/2-Wt[_t].add,_.translate(-DE,0,0),_.translate(-s[0]*Wt[_t].an*.005,-s[1]*iE*.01,0);for(_d=0;_d<_f;_d+=1)vf=d[_d].a,vf.t.propType&&(Fg=d[_d].s,dE=Fg.getMult(Wt[_t].anIndexes[_d],f.a[_d].s.totalChars),(x!==0||e.j!==0)&&(this._hasMaskedPath?dE.length?_i+=vf.t.v*dE[0]:_i+=vf.t.v*dE:dE.length?x+=vf.t.v*dE[0]:x+=vf.t.v*dE));for(e.strokeWidthAnim&&(Y0=e.sw||0),e.strokeColorAnim&&(e.sc?s0=[e.sc[0],e.sc[1],e.sc[2]]:s0=[0,0,0]),e.fillColorAnim&&e.fc&&(o_=[e.fc[0],e.fc[1],e.fc[2]]),_d=0;_d<_f;_d+=1)vf=d[_d].a,vf.a.propType&&(Fg=d[_d].s,dE=Fg.getMult(Wt[_t].anIndexes[_d],f.a[_d].s.totalChars),dE.length?_.translate(-vf.a.v[0]*dE[0],-vf.a.v[1]*dE[1],vf.a.v[2]*dE[2]):_.translate(-vf.a.v[0]*dE,-vf.a.v[1]*dE,vf.a.v[2]*dE));for(_d=0;_d<_f;_d+=1)vf=d[_d].a,vf.s.propType&&(Fg=d[_d].s,dE=Fg.getMult(Wt[_t].anIndexes[_d],f.a[_d].s.totalChars),dE.length?_.scale(1+(vf.s.v[0]-1)*dE[0],1+(vf.s.v[1]-1)*dE[1],1):_.scale(1+(vf.s.v[0]-1)*dE,1+(vf.s.v[1]-1)*dE,1));for(_d=0;_d<_f;_d+=1){if(vf=d[_d].a,Fg=d[_d].s,dE=Fg.getMult(Wt[_t].anIndexes[_d],f.a[_d].s.totalChars),vf.sk.propType&&(dE.length?_.skewFromAxis(-vf.sk.v*dE[0],vf.sa.v*dE[1]):_.skewFromAxis(-vf.sk.v*dE,vf.sa.v*dE)),vf.r.propType&&(dE.length?_.rotateZ(-vf.r.v*dE[2]):_.rotateZ(-vf.r.v*dE)),vf.ry.propType&&(dE.length?_.rotateY(vf.ry.v*dE[1]):_.rotateY(vf.ry.v*dE)),vf.rx.propType&&(dE.length?_.rotateX(vf.rx.v*dE[0]):_.rotateX(vf.rx.v*dE)),vf.o.propType&&(dE.length?M0+=(vf.o.v*dE[0]-M0)*dE[0]:M0+=(vf.o.v*dE-M0)*dE),e.strokeWidthAnim&&vf.sw.propType&&(dE.length?Y0+=vf.sw.v*dE[0]:Y0+=vf.sw.v*dE),e.strokeColorAnim&&vf.sc.propType)for(LE=0;LE<3;LE+=1)dE.length?s0[LE]+=(vf.sc.v[LE]-s0[LE])*dE[0]:s0[LE]+=(vf.sc.v[LE]-s0[LE])*dE;if(e.fillColorAnim&&e.fc){if(vf.fc.propType)for(LE=0;LE<3;LE+=1)dE.length?o_[LE]+=(vf.fc.v[LE]-o_[LE])*dE[0]:o_[LE]+=(vf.fc.v[LE]-o_[LE])*dE;vf.fh.propType&&(dE.length?o_=addHueToRGB(o_,vf.fh.v*dE[0]):o_=addHueToRGB(o_,vf.fh.v*dE)),vf.fs.propType&&(dE.length?o_=addSaturationToRGB(o_,vf.fs.v*dE[0]):o_=addSaturationToRGB(o_,vf.fs.v*dE)),vf.fb.propType&&(dE.length?o_=addBrightnessToRGB(o_,vf.fb.v*dE[0]):o_=addBrightnessToRGB(o_,vf.fb.v*dE))}}for(_d=0;_d<_f;_d+=1)vf=d[_d].a,vf.p.propType&&(Fg=d[_d].s,dE=Fg.getMult(Wt[_t].anIndexes[_d],f.a[_d].s.totalChars),this._hasMaskedPath?dE.length?_.translate(0,vf.p.v[1]*dE[0],-vf.p.v[2]*dE[1]):_.translate(0,vf.p.v[1]*dE,-vf.p.v[2]*dE):dE.length?_.translate(vf.p.v[0]*dE[0],vf.p.v[1]*dE[1],-vf.p.v[2]*dE[2]):_.translate(vf.p.v[0]*dE,vf.p.v[1]*dE,-vf.p.v[2]*dE));if(e.strokeWidthAnim&&(R_=Y0<0?0:Y0),e.strokeColorAnim&&(KE="rgb("+Math.round(s0[0]*255)+","+Math.round(s0[1]*255)+","+Math.round(s0[2]*255)+")"),e.fillColorAnim&&e.fc&&(f_="rgb("+Math.round(o_[0]*255)+","+Math.round(o_[1]*255)+","+Math.round(o_[2]*255)+")"),this._hasMaskedPath){if(_.translate(0,-e.ls),_.translate(0,s[1]*iE*.01+B,0),this._pathData.p.v){lE=(Ei.point[1]-_c.point[1])/(Ei.point[0]-_c.point[0]);var GT=Math.atan(lE)*180/Math.PI;Ei.point[0]<_c.point[0]&&(GT+=180),_.rotate(-GT*Math.PI/180)}_.translate(GE,QE,0),_i-=s[0]*Wt[_t].an*.005,Wt[_t+1]&&IE!==Wt[_t+1].ind&&(_i+=Wt[_t].an/2,_i+=e.tr*.001*e.finalSize)}else{switch(_.translate(x,B,0),e.ps&&_.translate(e.ps[0],e.ps[1]+e.ascent,0),e.j){case 1:_.translate(Wt[_t].animatorJustifyOffset+e.justifyOffset+(e.boxWidth-e.lineWidths[Wt[_t].line]),0,0);break;case 2:_.translate(Wt[_t].animatorJustifyOffset+e.justifyOffset+(e.boxWidth-e.lineWidths[Wt[_t].line])/2,0,0);break}_.translate(0,-e.ls),_.translate(DE,0,0),_.translate(s[0]*Wt[_t].an*.005,s[1]*iE*.01,0),x+=Wt[_t].l+e.tr*.001*e.finalSize}C==="html"?F_=_.toCSS():C==="svg"?F_=_.to2dCSS():T0=[_.props[0],_.props[1],_.props[2],_.props[3],_.props[4],_.props[5],_.props[6],_.props[7],_.props[8],_.props[9],_.props[10],_.props[11],_.props[12],_.props[13],_.props[14],_.props[15]],Mb=M0}P<=_t?(uE=new LetterProps(Mb,R_,KE,f_,F_,T0),this.renderedLetters.push(uE),P+=1,this.lettersChangedFlag=!0):(uE=this.renderedLetters[_t],this.lettersChangedFlag=uE.update(Mb,R_,KE,f_,F_,T0)||this.lettersChangedFlag)}}},TextAnimatorProperty.prototype.getValue=function(){this._elem.globalData.frameId!==this._frameId&&(this._frameId=this._elem.globalData.frameId,this.iterateDynamicProperties())},TextAnimatorProperty.prototype.mHelper=new Matrix,TextAnimatorProperty.prototype.defaultPropsArray=[],extendPrototype([DynamicPropertyContainer],TextAnimatorProperty);function ITextElement(){}ITextElement.prototype.initElement=function(e,r,s){this.lettersChangedFlag=!0,this.initFrame(),this.initBaseData(e,r,s),this.textProperty=new TextProperty(this,e.t,this.dynamicProperties),this.textAnimator=new TextAnimatorProperty(e.t,this.renderType,this),this.initTransform(e,r,s),this.initHierarchy(),this.initRenderable(),this.initRendererElement(),this.createContainerElements(),this.createRenderableComponents(),this.createContent(),this.hide(),this.textAnimator.searchProperties(this.dynamicProperties)},ITextElement.prototype.prepareFrame=function(e){this._mdf=!1,this.prepareRenderableFrame(e),this.prepareProperties(e,this.isInRange)},ITextElement.prototype.createPathShape=function(e,r){var s,d=r.length,f,_="";for(s=0;s<d;s+=1)r[s].ty==="sh"&&(f=r[s].ks.k,_+=buildShapeString(f,f.i.length,!0,e));return _},ITextElement.prototype.updateDocumentData=function(e,r){this.textProperty.updateDocumentData(e,r)},ITextElement.prototype.canResizeFont=function(e){this.textProperty.canResizeFont(e)},ITextElement.prototype.setMinimumFontSize=function(e){this.textProperty.setMinimumFontSize(e)},ITextElement.prototype.applyTextPropertiesToMatrix=function(e,r,s,d,f){switch(e.ps&&r.translate(e.ps[0],e.ps[1]+e.ascent,0),r.translate(0,-e.ls,0),e.j){case 1:r.translate(e.justifyOffset+(e.boxWidth-e.lineWidths[s]),0,0);break;case 2:r.translate(e.justifyOffset+(e.boxWidth-e.lineWidths[s])/2,0,0);break}r.translate(d,f,0)},ITextElement.prototype.buildColor=function(e){return"rgb("+Math.round(e[0]*255)+","+Math.round(e[1]*255)+","+Math.round(e[2]*255)+")"},ITextElement.prototype.emptyProp=new LetterProps,ITextElement.prototype.destroy=function(){},ITextElement.prototype.validateText=function(){(this.textProperty._mdf||this.textProperty._isFirstFrame)&&(this.buildNewText(),this.textProperty._isFirstFrame=!1,this.textProperty._mdf=!1)};var emptyShapeData={shapes:[]};function SVGTextLottieElement(e,r,s){this.textSpans=[],this.renderType="svg",this.initElement(e,r,s)}extendPrototype([BaseElement,TransformElement,SVGBaseElement,HierarchyElement,FrameElement,RenderableDOMElement,ITextElement],SVGTextLottieElement),SVGTextLottieElement.prototype.createContent=function(){this.data.singleShape&&!this.globalData.fontManager.chars&&(this.textContainer=createNS("text"))},SVGTextLottieElement.prototype.buildTextContents=function(e){for(var r=0,s=e.length,d=[],f="";r<s;)e[r]===String.fromCharCode(13)||e[r]===String.fromCharCode(3)?(d.push(f),f=""):f+=e[r],r+=1;return d.push(f),d},SVGTextLottieElement.prototype.buildShapeData=function(e,r){if(e.shapes&&e.shapes.length){var s=e.shapes[0];if(s.it){var d=s.it[s.it.length-1];d.s&&(d.s.k[0]=r,d.s.k[1]=r)}}return e},SVGTextLottieElement.prototype.buildNewText=function(){this.addDynamicProperty(this);var e,r,s=this.textProperty.currentData;this.renderedLetters=createSizedArray(s?s.l.length:0),s.fc?this.layerElement.setAttribute("fill",this.buildColor(s.fc)):this.layerElement.setAttribute("fill","rgba(0,0,0,0)"),s.sc&&(this.layerElement.setAttribute("stroke",this.buildColor(s.sc)),this.layerElement.setAttribute("stroke-width",s.sw)),this.layerElement.setAttribute("font-size",s.finalSize);var d=this.globalData.fontManager.getFontByName(s.f);if(d.fClass)this.layerElement.setAttribute("class",d.fClass);else{this.layerElement.setAttribute("font-family",d.fFamily);var f=s.fWeight,_=s.fStyle;this.layerElement.setAttribute("font-style",_),this.layerElement.setAttribute("font-weight",f)}this.layerElement.setAttribute("aria-label",s.t);var C=s.l||[],P=!!this.globalData.fontManager.chars;r=C.length;var x,B=this.mHelper,_t="",ue=this.data.singleShape,Wt=0,_n=0,_i=!0,Ei=s.tr*.001*s.finalSize;if(ue&&!P&&!s.sz){var _a=this.textContainer,Di="start";switch(s.j){case 1:Di="end";break;case 2:Di="middle";break;default:Di="start";break}_a.setAttribute("text-anchor",Di),_a.setAttribute("letter-spacing",Ei);var _o=this.buildTextContents(s.finalText);for(r=_o.length,_n=s.ps?s.ps[1]+s.ascent:0,e=0;e<r;e+=1)x=this.textSpans[e].span||createNS("tspan"),x.textContent=_o[e],x.setAttribute("x",0),x.setAttribute("y",_n),x.style.display="inherit",_a.appendChild(x),this.textSpans[e]||(this.textSpans[e]={span:null,glyph:null}),this.textSpans[e].span=x,_n+=s.finalLineHeight;this.layerElement.appendChild(_a)}else{var _s=this.textSpans.length,_c;for(e=0;e<r;e+=1){if(this.textSpans[e]||(this.textSpans[e]={span:null,childSpan:null,glyph:null}),!P||!ue||e===0){if(x=_s>e?this.textSpans[e].span:createNS(P?"g":"text"),_s<=e){if(x.setAttribute("stroke-linecap","butt"),x.setAttribute("stroke-linejoin","round"),x.setAttribute("stroke-miterlimit","4"),this.textSpans[e].span=x,P){var _m=createNS("g");x.appendChild(_m),this.textSpans[e].childSpan=_m}this.textSpans[e].span=x,this.layerElement.appendChild(x)}x.style.display="inherit"}if(B.reset(),ue&&(C[e].n&&(Wt=-Ei,_n+=s.yOffset,_n+=_i?1:0,_i=!1),this.applyTextPropertiesToMatrix(s,B,C[e].line,Wt,_n),Wt+=C[e].l||0,Wt+=Ei),P){_c=this.globalData.fontManager.getCharData(s.finalText[e],d.fStyle,this.globalData.fontManager.getFontByName(s.f).fFamily);var Qm;if(_c.t===1)Qm=new SVGCompElement(_c.data,this.globalData,this);else{var tE=emptyShapeData;_c.data&&_c.data.shapes&&(tE=this.buildShapeData(_c.data,s.finalSize)),Qm=new SVGShapeElement(tE,this.globalData,this)}if(this.textSpans[e].glyph){var aE=this.textSpans[e].glyph;this.textSpans[e].childSpan.removeChild(aE.layerElement),aE.destroy()}this.textSpans[e].glyph=Qm,Qm._debug=!0,Qm.prepareFrame(0),Qm.renderFrame(),this.textSpans[e].childSpan.appendChild(Qm.layerElement),_c.t===1&&this.textSpans[e].childSpan.setAttribute("transform","scale("+s.finalSize/100+","+s.finalSize/100+")")}else ue&&x.setAttribute("transform","translate("+B.props[12]+","+B.props[13]+")"),x.textContent=C[e].val,x.setAttributeNS("http://www.w3.org/XML/1998/namespace","xml:space","preserve")}ue&&x&&x.setAttribute("d",_t)}for(;e<this.textSpans.length;)this.textSpans[e].span.style.display="none",e+=1;this._sizeChanged=!0},SVGTextLottieElement.prototype.sourceRectAtTime=function(){if(this.prepareFrame(this.comp.renderedFrame-this.data.st),this.renderInnerContent(),this._sizeChanged){this._sizeChanged=!1;var e=this.layerElement.getBBox();this.bbox={top:e.y,left:e.x,width:e.width,height:e.height}}return this.bbox},SVGTextLottieElement.prototype.getValue=function(){var e,r=this.textSpans.length,s;for(this.renderedFrame=this.comp.renderedFrame,e=0;e<r;e+=1)s=this.textSpans[e].glyph,s&&(s.prepareFrame(this.comp.renderedFrame-this.data.st),s._mdf&&(this._mdf=!0))},SVGTextLottieElement.prototype.renderInnerContent=function(){if(this.validateText(),(!this.data.singleShape||this._mdf)&&(this.textAnimator.getMeasures(this.textProperty.currentData,this.lettersChangedFlag),this.lettersChangedFlag||this.textAnimator.lettersChangedFlag)){this._sizeChanged=!0;var e,r,s=this.textAnimator.renderedLetters,d=this.textProperty.currentData.l;r=d.length;var f,_,C;for(e=0;e<r;e+=1)d[e].n||(f=s[e],_=this.textSpans[e].span,C=this.textSpans[e].glyph,C&&C.renderFrame(),f._mdf.m&&_.setAttribute("transform",f.m),f._mdf.o&&_.setAttribute("opacity",f.o),f._mdf.sw&&_.setAttribute("stroke-width",f.sw),f._mdf.sc&&_.setAttribute("stroke",f.sc),f._mdf.fc&&_.setAttribute("fill",f.fc))}};function ISolidElement(e,r,s){this.initElement(e,r,s)}extendPrototype([IImageElement],ISolidElement),ISolidElement.prototype.createContent=function(){var e=createNS("rect");e.setAttribute("width",this.data.sw),e.setAttribute("height",this.data.sh),e.setAttribute("fill",this.data.sc),this.layerElement.appendChild(e)};function NullElement(e,r,s){this.initFrame(),this.initBaseData(e,r,s),this.initFrame(),this.initTransform(e,r,s),this.initHierarchy()}NullElement.prototype.prepareFrame=function(e){this.prepareProperties(e,!0)},NullElement.prototype.renderFrame=function(){},NullElement.prototype.getBaseElement=function(){return null},NullElement.prototype.destroy=function(){},NullElement.prototype.sourceRectAtTime=function(){},NullElement.prototype.hide=function(){},extendPrototype([BaseElement,TransformElement,HierarchyElement,FrameElement],NullElement);function SVGRendererBase(){}extendPrototype([BaseRenderer],SVGRendererBase),SVGRendererBase.prototype.createNull=function(e){return new NullElement(e,this.globalData,this)},SVGRendererBase.prototype.createShape=function(e){return new SVGShapeElement(e,this.globalData,this)},SVGRendererBase.prototype.createText=function(e){return new SVGTextLottieElement(e,this.globalData,this)},SVGRendererBase.prototype.createImage=function(e){return new IImageElement(e,this.globalData,this)},SVGRendererBase.prototype.createSolid=function(e){return new ISolidElement(e,this.globalData,this)},SVGRendererBase.prototype.configAnimation=function(e){this.svgElement.setAttribute("xmlns","http://www.w3.org/2000/svg"),this.svgElement.setAttribute("xmlns:xlink","http://www.w3.org/1999/xlink"),this.renderConfig.viewBoxSize?this.svgElement.setAttribute("viewBox",this.renderConfig.viewBoxSize):this.svgElement.setAttribute("viewBox","0 0 "+e.w+" "+e.h),this.renderConfig.viewBoxOnly||(this.svgElement.setAttribute("width",e.w),this.svgElement.setAttribute("height",e.h),this.svgElement.style.width="100%",this.svgElement.style.height="100%",this.svgElement.style.transform="translate3d(0,0,0)",this.svgElement.style.contentVisibility=this.renderConfig.contentVisibility),this.renderConfig.width&&this.svgElement.setAttribute("width",this.renderConfig.width),this.renderConfig.height&&this.svgElement.setAttribute("height",this.renderConfig.height),this.renderConfig.className&&this.svgElement.setAttribute("class",this.renderConfig.className),this.renderConfig.id&&this.svgElement.setAttribute("id",this.renderConfig.id),this.renderConfig.focusable!==void 0&&this.svgElement.setAttribute("focusable",this.renderConfig.focusable),this.svgElement.setAttribute("preserveAspectRatio",this.renderConfig.preserveAspectRatio),this.animationItem.wrapper.appendChild(this.svgElement);var r=this.globalData.defs;this.setupGlobalData(e,r),this.globalData.progressiveLoad=this.renderConfig.progressiveLoad,this.data=e;var s=createNS("clipPath"),d=createNS("rect");d.setAttribute("width",e.w),d.setAttribute("height",e.h),d.setAttribute("x",0),d.setAttribute("y",0);var f=createElementID();s.setAttribute("id",f),s.appendChild(d),this.layerElement.setAttribute("clip-path","url("+getLocationHref()+"#"+f+")"),r.appendChild(s),this.layers=e.layers,this.elements=createSizedArray(e.layers.length)},SVGRendererBase.prototype.destroy=function(){this.animationItem.wrapper&&(this.animationItem.wrapper.innerText=""),this.layerElement=null,this.globalData.defs=null;var e,r=this.layers?this.layers.length:0;for(e=0;e<r;e+=1)this.elements[e]&&this.elements[e].destroy&&this.elements[e].destroy();this.elements.length=0,this.destroyed=!0,this.animationItem=null},SVGRendererBase.prototype.updateContainerSize=function(){},SVGRendererBase.prototype.findIndexByInd=function(e){var r=0,s=this.layers.length;for(r=0;r<s;r+=1)if(this.layers[r].ind===e)return r;return-1},SVGRendererBase.prototype.buildItem=function(e){var r=this.elements;if(!(r[e]||this.layers[e].ty===99)){r[e]=!0;var s=this.createItem(this.layers[e]);if(r[e]=s,getExpressionsPlugin()&&(this.layers[e].ty===0&&this.globalData.projectInterface.registerComposition(s),s.initExpressions()),this.appendElementInPos(s,e),this.layers[e].tt){var d="tp"in this.layers[e]?this.findIndexByInd(this.layers[e].tp):e-1;if(d===-1)return;if(!this.elements[d]||this.elements[d]===!0)this.buildItem(d),this.addPendingElement(s);else{var f=r[d],_=f.getMatte(this.layers[e].tt);s.setMatte(_)}}}},SVGRendererBase.prototype.checkPendingElements=function(){for(;this.pendingElements.length;){var e=this.pendingElements.pop();if(e.checkParenting(),e.data.tt)for(var r=0,s=this.elements.length;r<s;){if(this.elements[r]===e){var d="tp"in e.data?this.findIndexByInd(e.data.tp):r-1,f=this.elements[d],_=f.getMatte(this.layers[r].tt);e.setMatte(_);break}r+=1}}},SVGRendererBase.prototype.renderFrame=function(e){if(!(this.renderedFrame===e||this.destroyed)){e===null?e=this.renderedFrame:this.renderedFrame=e,this.globalData.frameNum=e,this.globalData.frameId+=1,this.globalData.projectInterface.currentFrame=e,this.globalData._mdf=!1;var r,s=this.layers.length;for(this.completeLayers||this.checkLayers(e),r=s-1;r>=0;r-=1)(this.completeLayers||this.elements[r])&&this.elements[r].prepareFrame(e-this.layers[r].st);if(this.globalData._mdf)for(r=0;r<s;r+=1)(this.completeLayers||this.elements[r])&&this.elements[r].renderFrame()}},SVGRendererBase.prototype.appendElementInPos=function(e,r){var s=e.getBaseElement();if(s){for(var d=0,f;d<r;)this.elements[d]&&this.elements[d]!==!0&&this.elements[d].getBaseElement()&&(f=this.elements[d].getBaseElement()),d+=1;f?this.layerElement.insertBefore(s,f):this.layerElement.appendChild(s)}},SVGRendererBase.prototype.hide=function(){this.layerElement.style.display="none"},SVGRendererBase.prototype.show=function(){this.layerElement.style.display="block"};function ICompElement(){}extendPrototype([BaseElement,TransformElement,HierarchyElement,FrameElement,RenderableDOMElement],ICompElement),ICompElement.prototype.initElement=function(e,r,s){this.initFrame(),this.initBaseData(e,r,s),this.initTransform(e,r,s),this.initRenderable(),this.initHierarchy(),this.initRendererElement(),this.createContainerElements(),this.createRenderableComponents(),(this.data.xt||!r.progressiveLoad)&&this.buildAllItems(),this.hide()},ICompElement.prototype.prepareFrame=function(e){if(this._mdf=!1,this.prepareRenderableFrame(e),this.prepareProperties(e,this.isInRange),!(!this.isInRange&&!this.data.xt)){if(this.tm._placeholder)this.renderedFrame=e/this.data.sr;else{var r=this.tm.v;r===this.data.op&&(r=this.data.op-1),this.renderedFrame=r}var s,d=this.elements.length;for(this.completeLayers||this.checkLayers(this.renderedFrame),s=d-1;s>=0;s-=1)(this.completeLayers||this.elements[s])&&(this.elements[s].prepareFrame(this.renderedFrame-this.layers[s].st),this.elements[s]._mdf&&(this._mdf=!0))}},ICompElement.prototype.renderInnerContent=function(){var e,r=this.layers.length;for(e=0;e<r;e+=1)(this.completeLayers||this.elements[e])&&this.elements[e].renderFrame()},ICompElement.prototype.setElements=function(e){this.elements=e},ICompElement.prototype.getElements=function(){return this.elements},ICompElement.prototype.destroyElements=function(){var e,r=this.layers.length;for(e=0;e<r;e+=1)this.elements[e]&&this.elements[e].destroy()},ICompElement.prototype.destroy=function(){this.destroyElements(),this.destroyBaseElement()};function SVGCompElement(e,r,s){this.layers=e.layers,this.supports3d=!0,this.completeLayers=!1,this.pendingElements=[],this.elements=this.layers?createSizedArray(this.layers.length):[],this.initElement(e,r,s),this.tm=e.tm?PropertyFactory.getProp(this,e.tm,0,r.frameRate,this):{_placeholder:!0}}extendPrototype([SVGRendererBase,ICompElement,SVGBaseElement],SVGCompElement),SVGCompElement.prototype.createComp=function(e){return new SVGCompElement(e,this.globalData,this)};function SVGRenderer(e,r){this.animationItem=e,this.layers=null,this.renderedFrame=-1,this.svgElement=createNS("svg");var s="";if(r&&r.title){var d=createNS("title"),f=createElementID();d.setAttribute("id",f),d.textContent=r.title,this.svgElement.appendChild(d),s+=f}if(r&&r.description){var _=createNS("desc"),C=createElementID();_.setAttribute("id",C),_.textContent=r.description,this.svgElement.appendChild(_),s+=" "+C}s&&this.svgElement.setAttribute("aria-labelledby",s);var P=createNS("defs");this.svgElement.appendChild(P);var x=createNS("g");this.svgElement.appendChild(x),this.layerElement=x,this.renderConfig={preserveAspectRatio:r&&r.preserveAspectRatio||"xMidYMid meet",imagePreserveAspectRatio:r&&r.imagePreserveAspectRatio||"xMidYMid slice",contentVisibility:r&&r.contentVisibility||"visible",progressiveLoad:r&&r.progressiveLoad||!1,hideOnTransparent:!(r&&r.hideOnTransparent===!1),viewBoxOnly:r&&r.viewBoxOnly||!1,viewBoxSize:r&&r.viewBoxSize||!1,className:r&&r.className||"",id:r&&r.id||"",focusable:r&&r.focusable,filterSize:{width:r&&r.filterSize&&r.filterSize.width||"100%",height:r&&r.filterSize&&r.filterSize.height||"100%",x:r&&r.filterSize&&r.filterSize.x||"0%",y:r&&r.filterSize&&r.filterSize.y||"0%"},width:r&&r.width,height:r&&r.height,runExpressions:!r||r.runExpressions===void 0||r.runExpressions},this.globalData={_mdf:!1,frameNum:-1,defs:P,renderConfig:this.renderConfig},this.elements=[],this.pendingElements=[],this.destroyed=!1,this.rendererType="svg"}extendPrototype([SVGRendererBase],SVGRenderer),SVGRenderer.prototype.createComp=function(e){return new SVGCompElement(e,this.globalData,this)};function ShapeTransformManager(){this.sequences={},this.sequenceList=[],this.transform_key_count=0}ShapeTransformManager.prototype={addTransformSequence:function(r){var s,d=r.length,f="_";for(s=0;s<d;s+=1)f+=r[s].transform.key+"_";var _=this.sequences[f];return _||(_={transforms:[].concat(r),finalTransform:new Matrix,_mdf:!1},this.sequences[f]=_,this.sequenceList.push(_)),_},processSequence:function(r,s){for(var d=0,f=r.transforms.length,_=s;d<f&&!s;){if(r.transforms[d].transform.mProps._mdf){_=!0;break}d+=1}if(_)for(r.finalTransform.reset(),d=f-1;d>=0;d-=1)r.finalTransform.multiply(r.transforms[d].transform.mProps.v);r._mdf=_},processSequences:function(r){var s,d=this.sequenceList.length;for(s=0;s<d;s+=1)this.processSequence(this.sequenceList[s],r)},getNewKey:function(){return this.transform_key_count+=1,"_"+this.transform_key_count}};var lumaLoader=function(){var r="__lottie_element_luma_buffer",s=null,d=null,f=null;function _(){var x=createNS("svg"),B=createNS("filter"),_t=createNS("feColorMatrix");return B.setAttribute("id",r),_t.setAttribute("type","matrix"),_t.setAttribute("color-interpolation-filters","sRGB"),_t.setAttribute("values","0.3, 0.3, 0.3, 0, 0, 0.3, 0.3, 0.3, 0, 0, 0.3, 0.3, 0.3, 0, 0, 0.3, 0.3, 0.3, 0, 0"),B.appendChild(_t),x.appendChild(B),x.setAttribute("id",r+"_svg"),featureSupport.svgLumaHidden&&(x.style.display="none"),x}function C(){s||(f=_(),document.body.appendChild(f),s=createTag("canvas"),d=s.getContext("2d"),d.filter="url(#"+r+")",d.fillStyle="rgba(0,0,0,0)",d.fillRect(0,0,1,1))}function P(x){return s||C(),s.width=x.width,s.height=x.height,d.filter="url(#"+r+")",s}return{load:C,get:P}};function createCanvas(e,r){if(featureSupport.offscreenCanvas)return new OffscreenCanvas(e,r);var s=createTag("canvas");return s.width=e,s.height=r,s}var assetLoader=function(){return{loadLumaCanvas:lumaLoader.load,getLumaCanvas:lumaLoader.get,createCanvas}}(),registeredEffects={};function CVEffects(e){var r,s=e.data.ef?e.data.ef.length:0;this.filters=[];var d;for(r=0;r<s;r+=1){d=null;var f=e.data.ef[r].ty;if(registeredEffects[f]){var _=registeredEffects[f].effect;d=new _(e.effectsManager.effectElements[r],e)}d&&this.filters.push(d)}this.filters.length&&e.addRenderableComponent(this)}CVEffects.prototype.renderFrame=function(e){var r,s=this.filters.length;for(r=0;r<s;r+=1)this.filters[r].renderFrame(e)},CVEffects.prototype.getEffects=function(e){var r,s=this.filters.length,d=[];for(r=0;r<s;r+=1)this.filters[r].type===e&&d.push(this.filters[r]);return d};function registerEffect(e,r){registeredEffects[e]={effect:r}}function CVMaskElement(e,r){this.data=e,this.element=r,this.masksProperties=this.data.masksProperties||[],this.viewData=createSizedArray(this.masksProperties.length);var s,d=this.masksProperties.length,f=!1;for(s=0;s<d;s+=1)this.masksProperties[s].mode!=="n"&&(f=!0),this.viewData[s]=ShapePropertyFactory.getShapeProp(this.element,this.masksProperties[s],3);this.hasMasks=f,f&&this.element.addRenderableComponent(this)}CVMaskElement.prototype.renderFrame=function(){if(this.hasMasks){var e=this.element.finalTransform.mat,r=this.element.canvasContext,s,d=this.masksProperties.length,f,_,C;for(r.beginPath(),s=0;s<d;s+=1)if(this.masksProperties[s].mode!=="n"){this.masksProperties[s].inv&&(r.moveTo(0,0),r.lineTo(this.element.globalData.compSize.w,0),r.lineTo(this.element.globalData.compSize.w,this.element.globalData.compSize.h),r.lineTo(0,this.element.globalData.compSize.h),r.lineTo(0,0)),C=this.viewData[s].v,f=e.applyToPointArray(C.v[0][0],C.v[0][1],0),r.moveTo(f[0],f[1]);var P,x=C._length;for(P=1;P<x;P+=1)_=e.applyToTriplePoints(C.o[P-1],C.i[P],C.v[P]),r.bezierCurveTo(_[0],_[1],_[2],_[3],_[4],_[5]);_=e.applyToTriplePoints(C.o[P-1],C.i[0],C.v[0]),r.bezierCurveTo(_[0],_[1],_[2],_[3],_[4],_[5])}this.element.globalData.renderer.save(!0),r.clip()}},CVMaskElement.prototype.getMaskProperty=MaskElement.prototype.getMaskProperty,CVMaskElement.prototype.destroy=function(){this.element=null};function CVBaseElement(){}var operationsMap={1:"source-in",2:"source-out",3:"source-in",4:"source-out"};CVBaseElement.prototype={createElements:function(){},initRendererElement:function(){},createContainerElements:function(){if(this.data.tt>=1){this.buffers=[];var r=this.globalData.canvasContext,s=assetLoader.createCanvas(r.canvas.width,r.canvas.height);this.buffers.push(s);var d=assetLoader.createCanvas(r.canvas.width,r.canvas.height);this.buffers.push(d),this.data.tt>=3&&!document._isProxy&&assetLoader.loadLumaCanvas()}this.canvasContext=this.globalData.canvasContext,this.transformCanvas=this.globalData.transformCanvas,this.renderableEffectsManager=new CVEffects(this),this.searchEffectTransforms()},createContent:function(){},setBlendMode:function(){var r=this.globalData;if(r.blendMode!==this.data.bm){r.blendMode=this.data.bm;var s=getBlendMode(this.data.bm);r.canvasContext.globalCompositeOperation=s}},createRenderableComponents:function(){this.maskManager=new CVMaskElement(this.data,this),this.transformEffects=this.renderableEffectsManager.getEffects(effectTypes.TRANSFORM_EFFECT)},hideElement:function(){!this.hidden&&(!this.isInRange||this.isTransparent)&&(this.hidden=!0)},showElement:function(){this.isInRange&&!this.isTransparent&&(this.hidden=!1,this._isFirstFrame=!0,this.maskManager._isFirstFrame=!0)},clearCanvas:function(r){r.clearRect(this.transformCanvas.tx,this.transformCanvas.ty,this.transformCanvas.w*this.transformCanvas.sx,this.transformCanvas.h*this.transformCanvas.sy)},prepareLayer:function(){if(this.data.tt>=1){var r=this.buffers[0],s=r.getContext("2d");this.clearCanvas(s),s.drawImage(this.canvasContext.canvas,0,0),this.currentTransform=this.canvasContext.getTransform(),this.canvasContext.setTransform(1,0,0,1,0,0),this.clearCanvas(this.canvasContext),this.canvasContext.setTransform(this.currentTransform)}},exitLayer:function(){if(this.data.tt>=1){var r=this.buffers[1],s=r.getContext("2d");this.clearCanvas(s),s.drawImage(this.canvasContext.canvas,0,0),this.canvasContext.setTransform(1,0,0,1,0,0),this.clearCanvas(this.canvasContext),this.canvasContext.setTransform(this.currentTransform);var d=this.comp.getElementById("tp"in this.data?this.data.tp:this.data.ind-1);if(d.renderFrame(!0),this.canvasContext.setTransform(1,0,0,1,0,0),this.data.tt>=3&&!document._isProxy){var f=assetLoader.getLumaCanvas(this.canvasContext.canvas),_=f.getContext("2d");_.drawImage(this.canvasContext.canvas,0,0),this.clearCanvas(this.canvasContext),this.canvasContext.drawImage(f,0,0)}this.canvasContext.globalCompositeOperation=operationsMap[this.data.tt],this.canvasContext.drawImage(r,0,0),this.canvasContext.globalCompositeOperation="destination-over",this.canvasContext.drawImage(this.buffers[0],0,0),this.canvasContext.setTransform(this.currentTransform),this.canvasContext.globalCompositeOperation="source-over"}},renderFrame:function(r){if(!(this.hidden||this.data.hd)&&!(this.data.td===1&&!r)){this.renderTransform(),this.renderRenderable(),this.renderLocalTransform(),this.setBlendMode();var s=this.data.ty===0;this.prepareLayer(),this.globalData.renderer.save(s),this.globalData.renderer.ctxTransform(this.finalTransform.localMat.props),this.globalData.renderer.ctxOpacity(this.finalTransform.localOpacity),this.renderInnerContent(),this.globalData.renderer.restore(s),this.exitLayer(),this.maskManager.hasMasks&&this.globalData.renderer.restore(!0),this._isFirstFrame&&(this._isFirstFrame=!1)}},destroy:function(){this.canvasContext=null,this.data=null,this.globalData=null,this.maskManager.destroy()},mHelper:new Matrix},CVBaseElement.prototype.hide=CVBaseElement.prototype.hideElement,CVBaseElement.prototype.show=CVBaseElement.prototype.showElement;function CVShapeData(e,r,s,d){this.styledShapes=[],this.tr=[0,0,0,0,0,0];var f=4;r.ty==="rc"?f=5:r.ty==="el"?f=6:r.ty==="sr"&&(f=7),this.sh=ShapePropertyFactory.getShapeProp(e,r,f,e);var _,C=s.length,P;for(_=0;_<C;_+=1)s[_].closed||(P={transforms:d.addTransformSequence(s[_].transforms),trNodes:[]},this.styledShapes.push(P),s[_].elements.push(P))}CVShapeData.prototype.setAsAnimated=SVGShapeData.prototype.setAsAnimated;function CVShapeElement(e,r,s){this.shapes=[],this.shapesData=e.shapes,this.stylesList=[],this.itemsData=[],this.prevViewData=[],this.shapeModifiers=[],this.processedElements=[],this.transformsManager=new ShapeTransformManager,this.initElement(e,r,s)}extendPrototype([BaseElement,TransformElement,CVBaseElement,IShapeElement,HierarchyElement,FrameElement,RenderableElement],CVShapeElement),CVShapeElement.prototype.initElement=RenderableDOMElement.prototype.initElement,CVShapeElement.prototype.transformHelper={opacity:1,_opMdf:!1},CVShapeElement.prototype.dashResetter=[],CVShapeElement.prototype.createContent=function(){this.searchShapes(this.shapesData,this.itemsData,this.prevViewData,!0,[])},CVShapeElement.prototype.createStyleElement=function(e,r){var s={data:e,type:e.ty,preTransforms:this.transformsManager.addTransformSequence(r),transforms:[],elements:[],closed:e.hd===!0},d={};if(e.ty==="fl"||e.ty==="st"?(d.c=PropertyFactory.getProp(this,e.c,1,255,this),d.c.k||(s.co="rgb("+bmFloor(d.c.v[0])+","+bmFloor(d.c.v[1])+","+bmFloor(d.c.v[2])+")")):(e.ty==="gf"||e.ty==="gs")&&(d.s=PropertyFactory.getProp(this,e.s,1,null,this),d.e=PropertyFactory.getProp(this,e.e,1,null,this),d.h=PropertyFactory.getProp(this,e.h||{k:0},0,.01,this),d.a=PropertyFactory.getProp(this,e.a||{k:0},0,degToRads,this),d.g=new GradientProperty(this,e.g,this)),d.o=PropertyFactory.getProp(this,e.o,0,.01,this),e.ty==="st"||e.ty==="gs"){if(s.lc=lineCapEnum[e.lc||2],s.lj=lineJoinEnum[e.lj||2],e.lj==1&&(s.ml=e.ml),d.w=PropertyFactory.getProp(this,e.w,0,null,this),d.w.k||(s.wi=d.w.v),e.d){var f=new DashProperty(this,e.d,"canvas",this);d.d=f,d.d.k||(s.da=d.d.dashArray,s.do=d.d.dashoffset[0])}}else s.r=e.r===2?"evenodd":"nonzero";return this.stylesList.push(s),d.style=s,d},CVShapeElement.prototype.createGroupElement=function(){var e={it:[],prevViewData:[]};return e},CVShapeElement.prototype.createTransformElement=function(e){var r={transform:{opacity:1,_opMdf:!1,key:this.transformsManager.getNewKey(),op:PropertyFactory.getProp(this,e.o,0,.01,this),mProps:TransformPropertyFactory.getTransformProperty(this,e,this)}};return r},CVShapeElement.prototype.createShapeElement=function(e){var r=new CVShapeData(this,e,this.stylesList,this.transformsManager);return this.shapes.push(r),this.addShapeToModifiers(r),r},CVShapeElement.prototype.reloadShapes=function(){this._isFirstFrame=!0;var e,r=this.itemsData.length;for(e=0;e<r;e+=1)this.prevViewData[e]=this.itemsData[e];for(this.searchShapes(this.shapesData,this.itemsData,this.prevViewData,!0,[]),r=this.dynamicProperties.length,e=0;e<r;e+=1)this.dynamicProperties[e].getValue();this.renderModifiers(),this.transformsManager.processSequences(this._isFirstFrame)},CVShapeElement.prototype.addTransformToStyleList=function(e){var r,s=this.stylesList.length;for(r=0;r<s;r+=1)this.stylesList[r].closed||this.stylesList[r].transforms.push(e)},CVShapeElement.prototype.removeTransformFromStyleList=function(){var e,r=this.stylesList.length;for(e=0;e<r;e+=1)this.stylesList[e].closed||this.stylesList[e].transforms.pop()},CVShapeElement.prototype.closeStyles=function(e){var r,s=e.length;for(r=0;r<s;r+=1)e[r].closed=!0},CVShapeElement.prototype.searchShapes=function(e,r,s,d,f){var _,C=e.length-1,P,x,B=[],_t=[],ue,Wt,_n,_i=[].concat(f);for(_=C;_>=0;_-=1){if(ue=this.searchProcessedElement(e[_]),ue?r[_]=s[ue-1]:e[_]._shouldRender=d,e[_].ty==="fl"||e[_].ty==="st"||e[_].ty==="gf"||e[_].ty==="gs")ue?r[_].style.closed=!1:r[_]=this.createStyleElement(e[_],_i),B.push(r[_].style);else if(e[_].ty==="gr"){if(!ue)r[_]=this.createGroupElement(e[_]);else for(x=r[_].it.length,P=0;P<x;P+=1)r[_].prevViewData[P]=r[_].it[P];this.searchShapes(e[_].it,r[_].it,r[_].prevViewData,d,_i)}else e[_].ty==="tr"?(ue||(_n=this.createTransformElement(e[_]),r[_]=_n),_i.push(r[_]),this.addTransformToStyleList(r[_])):e[_].ty==="sh"||e[_].ty==="rc"||e[_].ty==="el"||e[_].ty==="sr"?ue||(r[_]=this.createShapeElement(e[_])):e[_].ty==="tm"||e[_].ty==="rd"||e[_].ty==="pb"||e[_].ty==="zz"||e[_].ty==="op"?(ue?(Wt=r[_],Wt.closed=!1):(Wt=ShapeModifiers.getModifier(e[_].ty),Wt.init(this,e[_]),r[_]=Wt,this.shapeModifiers.push(Wt)),_t.push(Wt)):e[_].ty==="rp"&&(ue?(Wt=r[_],Wt.closed=!0):(Wt=ShapeModifiers.getModifier(e[_].ty),r[_]=Wt,Wt.init(this,e,_,r),this.shapeModifiers.push(Wt),d=!1),_t.push(Wt));this.addProcessedElement(e[_],_+1)}for(this.removeTransformFromStyleList(),this.closeStyles(B),C=_t.length,_=0;_<C;_+=1)_t[_].closed=!0},CVShapeElement.prototype.renderInnerContent=function(){this.transformHelper.opacity=1,this.transformHelper._opMdf=!1,this.renderModifiers(),this.transformsManager.processSequences(this._isFirstFrame),this.renderShape(this.transformHelper,this.shapesData,this.itemsData,!0)},CVShapeElement.prototype.renderShapeTransform=function(e,r){(e._opMdf||r.op._mdf||this._isFirstFrame)&&(r.opacity=e.opacity,r.opacity*=r.op.v,r._opMdf=!0)},CVShapeElement.prototype.drawLayer=function(){var e,r=this.stylesList.length,s,d,f,_,C,P,x=this.globalData.renderer,B=this.globalData.canvasContext,_t,ue;for(e=0;e<r;e+=1)if(ue=this.stylesList[e],_t=ue.type,!((_t==="st"||_t==="gs")&&ue.wi===0||!ue.data._shouldRender||ue.coOp===0||this.globalData.currentGlobalAlpha===0)){for(x.save(),C=ue.elements,_t==="st"||_t==="gs"?(x.ctxStrokeStyle(_t==="st"?ue.co:ue.grd),x.ctxLineWidth(ue.wi),x.ctxLineCap(ue.lc),x.ctxLineJoin(ue.lj),x.ctxMiterLimit(ue.ml||0)):x.ctxFillStyle(_t==="fl"?ue.co:ue.grd),x.ctxOpacity(ue.coOp),_t!=="st"&&_t!=="gs"&&B.beginPath(),x.ctxTransform(ue.preTransforms.finalTransform.props),d=C.length,s=0;s<d;s+=1){for((_t==="st"||_t==="gs")&&(B.beginPath(),ue.da&&(B.setLineDash(ue.da),B.lineDashOffset=ue.do)),P=C[s].trNodes,_=P.length,f=0;f<_;f+=1)P[f].t==="m"?B.moveTo(P[f].p[0],P[f].p[1]):P[f].t==="c"?B.bezierCurveTo(P[f].pts[0],P[f].pts[1],P[f].pts[2],P[f].pts[3],P[f].pts[4],P[f].pts[5]):B.closePath();(_t==="st"||_t==="gs")&&(x.ctxStroke(),ue.da&&B.setLineDash(this.dashResetter))}_t!=="st"&&_t!=="gs"&&this.globalData.renderer.ctxFill(ue.r),x.restore()}},CVShapeElement.prototype.renderShape=function(e,r,s,d){var f,_=r.length-1,C;for(C=e,f=_;f>=0;f-=1)r[f].ty==="tr"?(C=s[f].transform,this.renderShapeTransform(e,C)):r[f].ty==="sh"||r[f].ty==="el"||r[f].ty==="rc"||r[f].ty==="sr"?this.renderPath(r[f],s[f]):r[f].ty==="fl"?this.renderFill(r[f],s[f],C):r[f].ty==="st"?this.renderStroke(r[f],s[f],C):r[f].ty==="gf"||r[f].ty==="gs"?this.renderGradientFill(r[f],s[f],C):r[f].ty==="gr"?this.renderShape(C,r[f].it,s[f].it):r[f].ty;d&&this.drawLayer()},CVShapeElement.prototype.renderStyledShape=function(e,r){if(this._isFirstFrame||r._mdf||e.transforms._mdf){var s=e.trNodes,d=r.paths,f,_,C,P=d._length;s.length=0;var x=e.transforms.finalTransform;for(C=0;C<P;C+=1){var B=d.shapes[C];if(B&&B.v){for(_=B._length,f=1;f<_;f+=1)f===1&&s.push({t:"m",p:x.applyToPointArray(B.v[0][0],B.v[0][1],0)}),s.push({t:"c",pts:x.applyToTriplePoints(B.o[f-1],B.i[f],B.v[f])});_===1&&s.push({t:"m",p:x.applyToPointArray(B.v[0][0],B.v[0][1],0)}),B.c&&_&&(s.push({t:"c",pts:x.applyToTriplePoints(B.o[f-1],B.i[0],B.v[0])}),s.push({t:"z"}))}}e.trNodes=s}},CVShapeElement.prototype.renderPath=function(e,r){if(e.hd!==!0&&e._shouldRender){var s,d=r.styledShapes.length;for(s=0;s<d;s+=1)this.renderStyledShape(r.styledShapes[s],r.sh)}},CVShapeElement.prototype.renderFill=function(e,r,s){var d=r.style;(r.c._mdf||this._isFirstFrame)&&(d.co="rgb("+bmFloor(r.c.v[0])+","+bmFloor(r.c.v[1])+","+bmFloor(r.c.v[2])+")"),(r.o._mdf||s._opMdf||this._isFirstFrame)&&(d.coOp=r.o.v*s.opacity)},CVShapeElement.prototype.renderGradientFill=function(e,r,s){var d=r.style,f;if(!d.grd||r.g._mdf||r.s._mdf||r.e._mdf||e.t!==1&&(r.h._mdf||r.a._mdf)){var _=this.globalData.canvasContext,C=r.s.v,P=r.e.v;if(e.t===1)f=_.createLinearGradient(C[0],C[1],P[0],P[1]);else{var x=Math.sqrt(Math.pow(C[0]-P[0],2)+Math.pow(C[1]-P[1],2)),B=Math.atan2(P[1]-C[1],P[0]-C[0]),_t=r.h.v;_t>=1?_t=.99:_t<=-1&&(_t=-.99);var ue=x*_t,Wt=Math.cos(B+r.a.v)*ue+C[0],_n=Math.sin(B+r.a.v)*ue+C[1];f=_.createRadialGradient(Wt,_n,0,C[0],C[1],x)}var _i,Ei=e.g.p,_a=r.g.c,Di=1;for(_i=0;_i<Ei;_i+=1)r.g._hasOpacity&&r.g._collapsable&&(Di=r.g.o[_i*2+1]),f.addColorStop(_a[_i*4]/100,"rgba("+_a[_i*4+1]+","+_a[_i*4+2]+","+_a[_i*4+3]+","+Di+")");d.grd=f}d.coOp=r.o.v*s.opacity},CVShapeElement.prototype.renderStroke=function(e,r,s){var d=r.style,f=r.d;f&&(f._mdf||this._isFirstFrame)&&(d.da=f.dashArray,d.do=f.dashoffset[0]),(r.c._mdf||this._isFirstFrame)&&(d.co="rgb("+bmFloor(r.c.v[0])+","+bmFloor(r.c.v[1])+","+bmFloor(r.c.v[2])+")"),(r.o._mdf||s._opMdf||this._isFirstFrame)&&(d.coOp=r.o.v*s.opacity),(r.w._mdf||this._isFirstFrame)&&(d.wi=r.w.v)},CVShapeElement.prototype.destroy=function(){this.shapesData=null,this.globalData=null,this.canvasContext=null,this.stylesList.length=0,this.itemsData.length=0};function CVTextElement(e,r,s){this.textSpans=[],this.yOffset=0,this.fillColorAnim=!1,this.strokeColorAnim=!1,this.strokeWidthAnim=!1,this.stroke=!1,this.fill=!1,this.justifyOffset=0,this.currentRender=null,this.renderType="canvas",this.values={fill:"rgba(0,0,0,0)",stroke:"rgba(0,0,0,0)",sWidth:0,fValue:""},this.initElement(e,r,s)}extendPrototype([BaseElement,TransformElement,CVBaseElement,HierarchyElement,FrameElement,RenderableElement,ITextElement],CVTextElement),CVTextElement.prototype.tHelper=createTag("canvas").getContext("2d"),CVTextElement.prototype.buildNewText=function(){var e=this.textProperty.currentData;this.renderedLetters=createSizedArray(e.l?e.l.length:0);var r=!1;e.fc?(r=!0,this.values.fill=this.buildColor(e.fc)):this.values.fill="rgba(0,0,0,0)",this.fill=r;var s=!1;e.sc&&(s=!0,this.values.stroke=this.buildColor(e.sc),this.values.sWidth=e.sw);var d=this.globalData.fontManager.getFontByName(e.f),f,_,C=e.l,P=this.mHelper;this.stroke=s,this.values.fValue=e.finalSize+"px "+this.globalData.fontManager.getFontByName(e.f).fFamily,_=e.finalText.length;var x,B,_t,ue,Wt,_n,_i,Ei,_a,Di,_o=this.data.singleShape,_s=e.tr*.001*e.finalSize,_c=0,_m=0,Qm=!0,tE=0;for(f=0;f<_;f+=1){x=this.globalData.fontManager.getCharData(e.finalText[f],d.fStyle,this.globalData.fontManager.getFontByName(e.f).fFamily),B=x&&x.data||{},P.reset(),_o&&C[f].n&&(_c=-_s,_m+=e.yOffset,_m+=Qm?1:0,Qm=!1),Wt=B.shapes?B.shapes[0].it:[],_i=Wt.length,P.scale(e.finalSize/100,e.finalSize/100),_o&&this.applyTextPropertiesToMatrix(e,P,C[f].line,_c,_m),_a=createSizedArray(_i-1);var aE=0;for(_n=0;_n<_i;_n+=1)if(Wt[_n].ty==="sh"){for(ue=Wt[_n].ks.k.i.length,Ei=Wt[_n].ks.k,Di=[],_t=1;_t<ue;_t+=1)_t===1&&Di.push(P.applyToX(Ei.v[0][0],Ei.v[0][1],0),P.applyToY(Ei.v[0][0],Ei.v[0][1],0)),Di.push(P.applyToX(Ei.o[_t-1][0],Ei.o[_t-1][1],0),P.applyToY(Ei.o[_t-1][0],Ei.o[_t-1][1],0),P.applyToX(Ei.i[_t][0],Ei.i[_t][1],0),P.applyToY(Ei.i[_t][0],Ei.i[_t][1],0),P.applyToX(Ei.v[_t][0],Ei.v[_t][1],0),P.applyToY(Ei.v[_t][0],Ei.v[_t][1],0));Di.push(P.applyToX(Ei.o[_t-1][0],Ei.o[_t-1][1],0),P.applyToY(Ei.o[_t-1][0],Ei.o[_t-1][1],0),P.applyToX(Ei.i[0][0],Ei.i[0][1],0),P.applyToY(Ei.i[0][0],Ei.i[0][1],0),P.applyToX(Ei.v[0][0],Ei.v[0][1],0),P.applyToY(Ei.v[0][0],Ei.v[0][1],0)),_a[aE]=Di,aE+=1}_o&&(_c+=C[f].l,_c+=_s),this.textSpans[tE]?this.textSpans[tE].elem=_a:this.textSpans[tE]={elem:_a},tE+=1}},CVTextElement.prototype.renderInnerContent=function(){this.validateText();var e=this.canvasContext;e.font=this.values.fValue,this.globalData.renderer.ctxLineCap("butt"),this.globalData.renderer.ctxLineJoin("miter"),this.globalData.renderer.ctxMiterLimit(4),this.data.singleShape||this.textAnimator.getMeasures(this.textProperty.currentData,this.lettersChangedFlag);var r,s,d,f,_,C,P=this.textAnimator.renderedLetters,x=this.textProperty.currentData.l;s=x.length;var B,_t=null,ue=null,Wt=null,_n,_i,Ei=this.globalData.renderer;for(r=0;r<s;r+=1)if(!x[r].n){if(B=P[r],B&&(Ei.save(),Ei.ctxTransform(B.p),Ei.ctxOpacity(B.o)),this.fill){for(B&&B.fc?_t!==B.fc&&(Ei.ctxFillStyle(B.fc),_t=B.fc):_t!==this.values.fill&&(_t=this.values.fill,Ei.ctxFillStyle(this.values.fill)),_n=this.textSpans[r].elem,f=_n.length,this.globalData.canvasContext.beginPath(),d=0;d<f;d+=1)for(_i=_n[d],C=_i.length,this.globalData.canvasContext.moveTo(_i[0],_i[1]),_=2;_<C;_+=6)this.globalData.canvasContext.bezierCurveTo(_i[_],_i[_+1],_i[_+2],_i[_+3],_i[_+4],_i[_+5]);this.globalData.canvasContext.closePath(),Ei.ctxFill()}if(this.stroke){for(B&&B.sw?Wt!==B.sw&&(Wt=B.sw,Ei.ctxLineWidth(B.sw)):Wt!==this.values.sWidth&&(Wt=this.values.sWidth,Ei.ctxLineWidth(this.values.sWidth)),B&&B.sc?ue!==B.sc&&(ue=B.sc,Ei.ctxStrokeStyle(B.sc)):ue!==this.values.stroke&&(ue=this.values.stroke,Ei.ctxStrokeStyle(this.values.stroke)),_n=this.textSpans[r].elem,f=_n.length,this.globalData.canvasContext.beginPath(),d=0;d<f;d+=1)for(_i=_n[d],C=_i.length,this.globalData.canvasContext.moveTo(_i[0],_i[1]),_=2;_<C;_+=6)this.globalData.canvasContext.bezierCurveTo(_i[_],_i[_+1],_i[_+2],_i[_+3],_i[_+4],_i[_+5]);this.globalData.canvasContext.closePath(),Ei.ctxStroke()}B&&this.globalData.renderer.restore()}};function CVImageElement(e,r,s){this.assetData=r.getAssetData(e.refId),this.img=r.imageLoader.getAsset(this.assetData),this.initElement(e,r,s)}extendPrototype([BaseElement,TransformElement,CVBaseElement,HierarchyElement,FrameElement,RenderableElement],CVImageElement),CVImageElement.prototype.initElement=SVGShapeElement.prototype.initElement,CVImageElement.prototype.prepareFrame=IImageElement.prototype.prepareFrame,CVImageElement.prototype.createContent=function(){if(this.img.width&&(this.assetData.w!==this.img.width||this.assetData.h!==this.img.height)){var e=createTag("canvas");e.width=this.assetData.w,e.height=this.assetData.h;var r=e.getContext("2d"),s=this.img.width,d=this.img.height,f=s/d,_=this.assetData.w/this.assetData.h,C,P,x=this.assetData.pr||this.globalData.renderConfig.imagePreserveAspectRatio;f>_&&x==="xMidYMid slice"||f<_&&x!=="xMidYMid slice"?(P=d,C=P*_):(C=s,P=C/_),r.drawImage(this.img,(s-C)/2,(d-P)/2,C,P,0,0,this.assetData.w,this.assetData.h),this.img=e}},CVImageElement.prototype.renderInnerContent=function(){this.canvasContext.drawImage(this.img,0,0)},CVImageElement.prototype.destroy=function(){this.img=null};function CVSolidElement(e,r,s){this.initElement(e,r,s)}extendPrototype([BaseElement,TransformElement,CVBaseElement,HierarchyElement,FrameElement,RenderableElement],CVSolidElement),CVSolidElement.prototype.initElement=SVGShapeElement.prototype.initElement,CVSolidElement.prototype.prepareFrame=IImageElement.prototype.prepareFrame,CVSolidElement.prototype.renderInnerContent=function(){this.globalData.renderer.ctxFillStyle(this.data.sc),this.globalData.renderer.ctxFillRect(0,0,this.data.sw,this.data.sh)};function CanvasRendererBase(){}extendPrototype([BaseRenderer],CanvasRendererBase),CanvasRendererBase.prototype.createShape=function(e){return new CVShapeElement(e,this.globalData,this)},CanvasRendererBase.prototype.createText=function(e){return new CVTextElement(e,this.globalData,this)},CanvasRendererBase.prototype.createImage=function(e){return new CVImageElement(e,this.globalData,this)},CanvasRendererBase.prototype.createSolid=function(e){return new CVSolidElement(e,this.globalData,this)},CanvasRendererBase.prototype.createNull=SVGRenderer.prototype.createNull,CanvasRendererBase.prototype.ctxTransform=function(e){e[0]===1&&e[1]===0&&e[4]===0&&e[5]===1&&e[12]===0&&e[13]===0||this.canvasContext.transform(e[0],e[1],e[4],e[5],e[12],e[13])},CanvasRendererBase.prototype.ctxOpacity=function(e){this.canvasContext.globalAlpha*=e<0?0:e},CanvasRendererBase.prototype.ctxFillStyle=function(e){this.canvasContext.fillStyle=e},CanvasRendererBase.prototype.ctxStrokeStyle=function(e){this.canvasContext.strokeStyle=e},CanvasRendererBase.prototype.ctxLineWidth=function(e){this.canvasContext.lineWidth=e},CanvasRendererBase.prototype.ctxLineCap=function(e){this.canvasContext.lineCap=e},CanvasRendererBase.prototype.ctxLineJoin=function(e){this.canvasContext.lineJoin=e},CanvasRendererBase.prototype.ctxMiterLimit=function(e){this.canvasContext.miterLimit=e},CanvasRendererBase.prototype.ctxFill=function(e){this.canvasContext.fill(e)},CanvasRendererBase.prototype.ctxFillRect=function(e,r,s,d){this.canvasContext.fillRect(e,r,s,d)},CanvasRendererBase.prototype.ctxStroke=function(){this.canvasContext.stroke()},CanvasRendererBase.prototype.reset=function(){if(!this.renderConfig.clearCanvas){this.canvasContext.restore();return}this.contextData.reset()},CanvasRendererBase.prototype.save=function(){this.canvasContext.save()},CanvasRendererBase.prototype.restore=function(e){if(!this.renderConfig.clearCanvas){this.canvasContext.restore();return}e&&(this.globalData.blendMode="source-over"),this.contextData.restore(e)},CanvasRendererBase.prototype.configAnimation=function(e){if(this.animationItem.wrapper){this.animationItem.container=createTag("canvas");var r=this.animationItem.container.style;r.width="100%",r.height="100%";var s="0px 0px 0px";r.transformOrigin=s,r.mozTransformOrigin=s,r.webkitTransformOrigin=s,r["-webkit-transform"]=s,r.contentVisibility=this.renderConfig.contentVisibility,this.animationItem.wrapper.appendChild(this.animationItem.container),this.canvasContext=this.animationItem.container.getContext("2d"),this.renderConfig.className&&this.animationItem.container.setAttribute("class",this.renderConfig.className),this.renderConfig.id&&this.animationItem.container.setAttribute("id",this.renderConfig.id)}else this.canvasContext=this.renderConfig.context;this.contextData.setContext(this.canvasContext),this.data=e,this.layers=e.layers,this.transformCanvas={w:e.w,h:e.h,sx:0,sy:0,tx:0,ty:0},this.setupGlobalData(e,document.body),this.globalData.canvasContext=this.canvasContext,this.globalData.renderer=this,this.globalData.isDashed=!1,this.globalData.progressiveLoad=this.renderConfig.progressiveLoad,this.globalData.transformCanvas=this.transformCanvas,this.elements=createSizedArray(e.layers.length),this.updateContainerSize()},CanvasRendererBase.prototype.updateContainerSize=function(e,r){this.reset();var s,d;e?(s=e,d=r,this.canvasContext.canvas.width=s,this.canvasContext.canvas.height=d):(this.animationItem.wrapper&&this.animationItem.container?(s=this.animationItem.wrapper.offsetWidth,d=this.animationItem.wrapper.offsetHeight):(s=this.canvasContext.canvas.width,d=this.canvasContext.canvas.height),this.canvasContext.canvas.width=s*this.renderConfig.dpr,this.canvasContext.canvas.height=d*this.renderConfig.dpr);var f,_;if(this.renderConfig.preserveAspectRatio.indexOf("meet")!==-1||this.renderConfig.preserveAspectRatio.indexOf("slice")!==-1){var C=this.renderConfig.preserveAspectRatio.split(" "),P=C[1]||"meet",x=C[0]||"xMidYMid",B=x.substr(0,4),_t=x.substr(4);f=s/d,_=this.transformCanvas.w/this.transformCanvas.h,_>f&&P==="meet"||_<f&&P==="slice"?(this.transformCanvas.sx=s/(this.transformCanvas.w/this.renderConfig.dpr),this.transformCanvas.sy=s/(this.transformCanvas.w/this.renderConfig.dpr)):(this.transformCanvas.sx=d/(this.transformCanvas.h/this.renderConfig.dpr),this.transformCanvas.sy=d/(this.transformCanvas.h/this.renderConfig.dpr)),B==="xMid"&&(_<f&&P==="meet"||_>f&&P==="slice")?this.transformCanvas.tx=(s-this.transformCanvas.w*(d/this.transformCanvas.h))/2*this.renderConfig.dpr:B==="xMax"&&(_<f&&P==="meet"||_>f&&P==="slice")?this.transformCanvas.tx=(s-this.transformCanvas.w*(d/this.transformCanvas.h))*this.renderConfig.dpr:this.transformCanvas.tx=0,_t==="YMid"&&(_>f&&P==="meet"||_<f&&P==="slice")?this.transformCanvas.ty=(d-this.transformCanvas.h*(s/this.transformCanvas.w))/2*this.renderConfig.dpr:_t==="YMax"&&(_>f&&P==="meet"||_<f&&P==="slice")?this.transformCanvas.ty=(d-this.transformCanvas.h*(s/this.transformCanvas.w))*this.renderConfig.dpr:this.transformCanvas.ty=0}else this.renderConfig.preserveAspectRatio==="none"?(this.transformCanvas.sx=s/(this.transformCanvas.w/this.renderConfig.dpr),this.transformCanvas.sy=d/(this.transformCanvas.h/this.renderConfig.dpr),this.transformCanvas.tx=0,this.transformCanvas.ty=0):(this.transformCanvas.sx=this.renderConfig.dpr,this.transformCanvas.sy=this.renderConfig.dpr,this.transformCanvas.tx=0,this.transformCanvas.ty=0);this.transformCanvas.props=[this.transformCanvas.sx,0,0,0,0,this.transformCanvas.sy,0,0,0,0,1,0,this.transformCanvas.tx,this.transformCanvas.ty,0,1],this.ctxTransform(this.transformCanvas.props),this.canvasContext.beginPath(),this.canvasContext.rect(0,0,this.transformCanvas.w,this.transformCanvas.h),this.canvasContext.closePath(),this.canvasContext.clip(),this.renderFrame(this.renderedFrame,!0)},CanvasRendererBase.prototype.destroy=function(){this.renderConfig.clearCanvas&&this.animationItem.wrapper&&(this.animationItem.wrapper.innerText="");var e,r=this.layers?this.layers.length:0;for(e=r-1;e>=0;e-=1)this.elements[e]&&this.elements[e].destroy&&this.elements[e].destroy();this.elements.length=0,this.globalData.canvasContext=null,this.animationItem.container=null,this.destroyed=!0},CanvasRendererBase.prototype.renderFrame=function(e,r){if(!(this.renderedFrame===e&&this.renderConfig.clearCanvas===!0&&!r||this.destroyed||e===-1)){this.renderedFrame=e,this.globalData.frameNum=e-this.animationItem._isFirstFrame,this.globalData.frameId+=1,this.globalData._mdf=!this.renderConfig.clearCanvas||r,this.globalData.projectInterface.currentFrame=e;var s,d=this.layers.length;for(this.completeLayers||this.checkLayers(e),s=d-1;s>=0;s-=1)(this.completeLayers||this.elements[s])&&this.elements[s].prepareFrame(e-this.layers[s].st);if(this.globalData._mdf){for(this.renderConfig.clearCanvas===!0?this.canvasContext.clearRect(0,0,this.transformCanvas.w,this.transformCanvas.h):this.save(),s=d-1;s>=0;s-=1)(this.completeLayers||this.elements[s])&&this.elements[s].renderFrame();this.renderConfig.clearCanvas!==!0&&this.restore()}}},CanvasRendererBase.prototype.buildItem=function(e){var r=this.elements;if(!(r[e]||this.layers[e].ty===99)){var s=this.createItem(this.layers[e],this,this.globalData);r[e]=s,s.initExpressions()}},CanvasRendererBase.prototype.checkPendingElements=function(){for(;this.pendingElements.length;){var e=this.pendingElements.pop();e.checkParenting()}},CanvasRendererBase.prototype.hide=function(){this.animationItem.container.style.display="none"},CanvasRendererBase.prototype.show=function(){this.animationItem.container.style.display="block"};function CanvasContext(){this.opacity=-1,this.transform=createTypedArray("float32",16),this.fillStyle="",this.strokeStyle="",this.lineWidth="",this.lineCap="",this.lineJoin="",this.miterLimit="",this.id=Math.random()}function CVContextData(){this.stack=[],this.cArrPos=0,this.cTr=new Matrix;var e,r=15;for(e=0;e<r;e+=1){var s=new CanvasContext;this.stack[e]=s}this._length=r,this.nativeContext=null,this.transformMat=new Matrix,this.currentOpacity=1,this.currentFillStyle="",this.appliedFillStyle="",this.currentStrokeStyle="",this.appliedStrokeStyle="",this.currentLineWidth="",this.appliedLineWidth="",this.currentLineCap="",this.appliedLineCap="",this.currentLineJoin="",this.appliedLineJoin="",this.appliedMiterLimit="",this.currentMiterLimit=""}CVContextData.prototype.duplicate=function(){var e=this._length*2,r=0;for(r=this._length;r<e;r+=1)this.stack[r]=new CanvasContext;this._length=e},CVContextData.prototype.reset=function(){this.cArrPos=0,this.cTr.reset(),this.stack[this.cArrPos].opacity=1},CVContextData.prototype.restore=function(e){this.cArrPos-=1;var r=this.stack[this.cArrPos],s=r.transform,d,f=this.cTr.props;for(d=0;d<16;d+=1)f[d]=s[d];if(e){this.nativeContext.restore();var _=this.stack[this.cArrPos+1];this.appliedFillStyle=_.fillStyle,this.appliedStrokeStyle=_.strokeStyle,this.appliedLineWidth=_.lineWidth,this.appliedLineCap=_.lineCap,this.appliedLineJoin=_.lineJoin,this.appliedMiterLimit=_.miterLimit}this.nativeContext.setTransform(s[0],s[1],s[4],s[5],s[12],s[13]),(e||r.opacity!==-1&&this.currentOpacity!==r.opacity)&&(this.nativeContext.globalAlpha=r.opacity,this.currentOpacity=r.opacity),this.currentFillStyle=r.fillStyle,this.currentStrokeStyle=r.strokeStyle,this.currentLineWidth=r.lineWidth,this.currentLineCap=r.lineCap,this.currentLineJoin=r.lineJoin,this.currentMiterLimit=r.miterLimit},CVContextData.prototype.save=function(e){e&&this.nativeContext.save();var r=this.cTr.props;this._length<=this.cArrPos&&this.duplicate();var s=this.stack[this.cArrPos],d;for(d=0;d<16;d+=1)s.transform[d]=r[d];this.cArrPos+=1;var f=this.stack[this.cArrPos];f.opacity=s.opacity,f.fillStyle=s.fillStyle,f.strokeStyle=s.strokeStyle,f.lineWidth=s.lineWidth,f.lineCap=s.lineCap,f.lineJoin=s.lineJoin,f.miterLimit=s.miterLimit},CVContextData.prototype.setOpacity=function(e){this.stack[this.cArrPos].opacity=e},CVContextData.prototype.setContext=function(e){this.nativeContext=e},CVContextData.prototype.fillStyle=function(e){this.stack[this.cArrPos].fillStyle!==e&&(this.currentFillStyle=e,this.stack[this.cArrPos].fillStyle=e)},CVContextData.prototype.strokeStyle=function(e){this.stack[this.cArrPos].strokeStyle!==e&&(this.currentStrokeStyle=e,this.stack[this.cArrPos].strokeStyle=e)},CVContextData.prototype.lineWidth=function(e){this.stack[this.cArrPos].lineWidth!==e&&(this.currentLineWidth=e,this.stack[this.cArrPos].lineWidth=e)},CVContextData.prototype.lineCap=function(e){this.stack[this.cArrPos].lineCap!==e&&(this.currentLineCap=e,this.stack[this.cArrPos].lineCap=e)},CVContextData.prototype.lineJoin=function(e){this.stack[this.cArrPos].lineJoin!==e&&(this.currentLineJoin=e,this.stack[this.cArrPos].lineJoin=e)},CVContextData.prototype.miterLimit=function(e){this.stack[this.cArrPos].miterLimit!==e&&(this.currentMiterLimit=e,this.stack[this.cArrPos].miterLimit=e)},CVContextData.prototype.transform=function(e){this.transformMat.cloneFromProps(e);var r=this.cTr;this.transformMat.multiply(r),r.cloneFromProps(this.transformMat.props);var s=r.props;this.nativeContext.setTransform(s[0],s[1],s[4],s[5],s[12],s[13])},CVContextData.prototype.opacity=function(e){var r=this.stack[this.cArrPos].opacity;r*=e<0?0:e,this.stack[this.cArrPos].opacity!==r&&(this.currentOpacity!==e&&(this.nativeContext.globalAlpha=e,this.currentOpacity=e),this.stack[this.cArrPos].opacity=r)},CVContextData.prototype.fill=function(e){this.appliedFillStyle!==this.currentFillStyle&&(this.appliedFillStyle=this.currentFillStyle,this.nativeContext.fillStyle=this.appliedFillStyle),this.nativeContext.fill(e)},CVContextData.prototype.fillRect=function(e,r,s,d){this.appliedFillStyle!==this.currentFillStyle&&(this.appliedFillStyle=this.currentFillStyle,this.nativeContext.fillStyle=this.appliedFillStyle),this.nativeContext.fillRect(e,r,s,d)},CVContextData.prototype.stroke=function(){this.appliedStrokeStyle!==this.currentStrokeStyle&&(this.appliedStrokeStyle=this.currentStrokeStyle,this.nativeContext.strokeStyle=this.appliedStrokeStyle),this.appliedLineWidth!==this.currentLineWidth&&(this.appliedLineWidth=this.currentLineWidth,this.nativeContext.lineWidth=this.appliedLineWidth),this.appliedLineCap!==this.currentLineCap&&(this.appliedLineCap=this.currentLineCap,this.nativeContext.lineCap=this.appliedLineCap),this.appliedLineJoin!==this.currentLineJoin&&(this.appliedLineJoin=this.currentLineJoin,this.nativeContext.lineJoin=this.appliedLineJoin),this.appliedMiterLimit!==this.currentMiterLimit&&(this.appliedMiterLimit=this.currentMiterLimit,this.nativeContext.miterLimit=this.appliedMiterLimit),this.nativeContext.stroke()};function CVCompElement(e,r,s){this.completeLayers=!1,this.layers=e.layers,this.pendingElements=[],this.elements=createSizedArray(this.layers.length),this.initElement(e,r,s),this.tm=e.tm?PropertyFactory.getProp(this,e.tm,0,r.frameRate,this):{_placeholder:!0}}extendPrototype([CanvasRendererBase,ICompElement,CVBaseElement],CVCompElement),CVCompElement.prototype.renderInnerContent=function(){var e=this.canvasContext;e.beginPath(),e.moveTo(0,0),e.lineTo(this.data.w,0),e.lineTo(this.data.w,this.data.h),e.lineTo(0,this.data.h),e.lineTo(0,0),e.clip();var r,s=this.layers.length;for(r=s-1;r>=0;r-=1)(this.completeLayers||this.elements[r])&&this.elements[r].renderFrame()},CVCompElement.prototype.destroy=function(){var e,r=this.layers.length;for(e=r-1;e>=0;e-=1)this.elements[e]&&this.elements[e].destroy();this.layers=null,this.elements=null},CVCompElement.prototype.createComp=function(e){return new CVCompElement(e,this.globalData,this)};function CanvasRenderer(e,r){this.animationItem=e,this.renderConfig={clearCanvas:r&&r.clearCanvas!==void 0?r.clearCanvas:!0,context:r&&r.context||null,progressiveLoad:r&&r.progressiveLoad||!1,preserveAspectRatio:r&&r.preserveAspectRatio||"xMidYMid meet",imagePreserveAspectRatio:r&&r.imagePreserveAspectRatio||"xMidYMid slice",contentVisibility:r&&r.contentVisibility||"visible",className:r&&r.className||"",id:r&&r.id||"",runExpressions:!r||r.runExpressions===void 0||r.runExpressions},this.renderConfig.dpr=r&&r.dpr||1,this.animationItem.wrapper&&(this.renderConfig.dpr=r&&r.dpr||window.devicePixelRatio||1),this.renderedFrame=-1,this.globalData={frameNum:-1,_mdf:!1,renderConfig:this.renderConfig,currentGlobalAlpha:-1},this.contextData=new CVContextData,this.elements=[],this.pendingElements=[],this.transformMat=new Matrix,this.completeLayers=!1,this.rendererType="canvas",this.renderConfig.clearCanvas&&(this.ctxTransform=this.contextData.transform.bind(this.contextData),this.ctxOpacity=this.contextData.opacity.bind(this.contextData),this.ctxFillStyle=this.contextData.fillStyle.bind(this.contextData),this.ctxStrokeStyle=this.contextData.strokeStyle.bind(this.contextData),this.ctxLineWidth=this.contextData.lineWidth.bind(this.contextData),this.ctxLineCap=this.contextData.lineCap.bind(this.contextData),this.ctxLineJoin=this.contextData.lineJoin.bind(this.contextData),this.ctxMiterLimit=this.contextData.miterLimit.bind(this.contextData),this.ctxFill=this.contextData.fill.bind(this.contextData),this.ctxFillRect=this.contextData.fillRect.bind(this.contextData),this.ctxStroke=this.contextData.stroke.bind(this.contextData),this.save=this.contextData.save.bind(this.contextData))}extendPrototype([CanvasRendererBase],CanvasRenderer),CanvasRenderer.prototype.createComp=function(e){return new CVCompElement(e,this.globalData,this)};function HBaseElement(){}HBaseElement.prototype={checkBlendMode:function(){},initRendererElement:function(){this.baseElement=createTag(this.data.tg||"div"),this.data.hasMask?(this.svgElement=createNS("svg"),this.layerElement=createNS("g"),this.maskedElement=this.layerElement,this.svgElement.appendChild(this.layerElement),this.baseElement.appendChild(this.svgElement)):this.layerElement=this.baseElement,styleDiv(this.baseElement)},createContainerElements:function(){this.renderableEffectsManager=new CVEffects(this),this.transformedElement=this.baseElement,this.maskedElement=this.layerElement,this.data.ln&&this.layerElement.setAttribute("id",this.data.ln),this.data.cl&&this.layerElement.setAttribute("class",this.data.cl),this.data.bm!==0&&this.setBlendMode()},renderElement:function(){var r=this.transformedElement?this.transformedElement.style:{};if(this.finalTransform._matMdf){var s=this.finalTransform.mat.toCSS();r.transform=s,r.webkitTransform=s}this.finalTransform._opMdf&&(r.opacity=this.finalTransform.mProp.o.v)},renderFrame:function(){this.data.hd||this.hidden||(this.renderTransform(),this.renderRenderable(),this.renderElement(),this.renderInnerContent(),this._isFirstFrame&&(this._isFirstFrame=!1))},destroy:function(){this.layerElement=null,this.transformedElement=null,this.matteElement&&(this.matteElement=null),this.maskManager&&(this.maskManager.destroy(),this.maskManager=null)},createRenderableComponents:function(){this.maskManager=new MaskElement(this.data,this,this.globalData)},addEffects:function(){},setMatte:function(){}},HBaseElement.prototype.getBaseElement=SVGBaseElement.prototype.getBaseElement,HBaseElement.prototype.destroyBaseElement=HBaseElement.prototype.destroy,HBaseElement.prototype.buildElementParenting=BaseRenderer.prototype.buildElementParenting;function HSolidElement(e,r,s){this.initElement(e,r,s)}extendPrototype([BaseElement,TransformElement,HBaseElement,HierarchyElement,FrameElement,RenderableDOMElement],HSolidElement),HSolidElement.prototype.createContent=function(){var e;this.data.hasMask?(e=createNS("rect"),e.setAttribute("width",this.data.sw),e.setAttribute("height",this.data.sh),e.setAttribute("fill",this.data.sc),this.svgElement.setAttribute("width",this.data.sw),this.svgElement.setAttribute("height",this.data.sh)):(e=createTag("div"),e.style.width=this.data.sw+"px",e.style.height=this.data.sh+"px",e.style.backgroundColor=this.data.sc),this.layerElement.appendChild(e)};function HShapeElement(e,r,s){this.shapes=[],this.shapesData=e.shapes,this.stylesList=[],this.shapeModifiers=[],this.itemsData=[],this.processedElements=[],this.animatedContents=[],this.shapesContainer=createNS("g"),this.initElement(e,r,s),this.prevViewData=[],this.currentBBox={x:999999,y:-999999,h:0,w:0}}extendPrototype([BaseElement,TransformElement,HSolidElement,SVGShapeElement,HBaseElement,HierarchyElement,FrameElement,RenderableElement],HShapeElement),HShapeElement.prototype._renderShapeFrame=HShapeElement.prototype.renderInnerContent,HShapeElement.prototype.createContent=function(){var e;if(this.baseElement.style.fontSize=0,this.data.hasMask)this.layerElement.appendChild(this.shapesContainer),e=this.svgElement;else{e=createNS("svg");var r=this.comp.data?this.comp.data:this.globalData.compSize;e.setAttribute("width",r.w),e.setAttribute("height",r.h),e.appendChild(this.shapesContainer),this.layerElement.appendChild(e)}this.searchShapes(this.shapesData,this.itemsData,this.prevViewData,this.shapesContainer,0,[],!0),this.filterUniqueShapes(),this.shapeCont=e},HShapeElement.prototype.getTransformedPoint=function(e,r){var s,d=e.length;for(s=0;s<d;s+=1)r=e[s].mProps.v.applyToPointArray(r[0],r[1],0);return r},HShapeElement.prototype.calculateShapeBoundingBox=function(e,r){var s=e.sh.v,d=e.transformers,f,_=s._length,C,P,x,B;if(!(_<=1)){for(f=0;f<_-1;f+=1)C=this.getTransformedPoint(d,s.v[f]),P=this.getTransformedPoint(d,s.o[f]),x=this.getTransformedPoint(d,s.i[f+1]),B=this.getTransformedPoint(d,s.v[f+1]),this.checkBounds(C,P,x,B,r);s.c&&(C=this.getTransformedPoint(d,s.v[f]),P=this.getTransformedPoint(d,s.o[f]),x=this.getTransformedPoint(d,s.i[0]),B=this.getTransformedPoint(d,s.v[0]),this.checkBounds(C,P,x,B,r))}},HShapeElement.prototype.checkBounds=function(e,r,s,d,f){this.getBoundsOfCurve(e,r,s,d);var _=this.shapeBoundingBox;f.x=bmMin(_.left,f.x),f.xMax=bmMax(_.right,f.xMax),f.y=bmMin(_.top,f.y),f.yMax=bmMax(_.bottom,f.yMax)},HShapeElement.prototype.shapeBoundingBox={left:0,right:0,top:0,bottom:0},HShapeElement.prototype.tempBoundingBox={x:0,xMax:0,y:0,yMax:0,width:0,height:0},HShapeElement.prototype.getBoundsOfCurve=function(e,r,s,d){for(var f=[[e[0],d[0]],[e[1],d[1]]],_,C,P,x,B,_t,ue,Wt=0;Wt<2;++Wt)C=6*e[Wt]-12*r[Wt]+6*s[Wt],_=-3*e[Wt]+9*r[Wt]-9*s[Wt]+3*d[Wt],P=3*r[Wt]-3*e[Wt],C|=0,_|=0,P|=0,_===0&&C===0||(_===0?(x=-P/C,x>0&&x<1&&f[Wt].push(this.calculateF(x,e,r,s,d,Wt))):(B=C*C-4*P*_,B>=0&&(_t=(-C+bmSqrt(B))/(2*_),_t>0&&_t<1&&f[Wt].push(this.calculateF(_t,e,r,s,d,Wt)),ue=(-C-bmSqrt(B))/(2*_),ue>0&&ue<1&&f[Wt].push(this.calculateF(ue,e,r,s,d,Wt)))));this.shapeBoundingBox.left=bmMin.apply(null,f[0]),this.shapeBoundingBox.top=bmMin.apply(null,f[1]),this.shapeBoundingBox.right=bmMax.apply(null,f[0]),this.shapeBoundingBox.bottom=bmMax.apply(null,f[1])},HShapeElement.prototype.calculateF=function(e,r,s,d,f,_){return bmPow(1-e,3)*r[_]+3*bmPow(1-e,2)*e*s[_]+3*(1-e)*bmPow(e,2)*d[_]+bmPow(e,3)*f[_]},HShapeElement.prototype.calculateBoundingBox=function(e,r){var s,d=e.length;for(s=0;s<d;s+=1)e[s]&&e[s].sh?this.calculateShapeBoundingBox(e[s],r):e[s]&&e[s].it?this.calculateBoundingBox(e[s].it,r):e[s]&&e[s].style&&e[s].w&&this.expandStrokeBoundingBox(e[s].w,r)},HShapeElement.prototype.expandStrokeBoundingBox=function(e,r){var s=0;if(e.keyframes){for(var d=0;d<e.keyframes.length;d+=1){var f=e.keyframes[d].s;f>s&&(s=f)}s*=e.mult}else s=e.v*e.mult;r.x-=s,r.xMax+=s,r.y-=s,r.yMax+=s},HShapeElement.prototype.currentBoxContains=function(e){return this.currentBBox.x<=e.x&&this.currentBBox.y<=e.y&&this.currentBBox.width+this.currentBBox.x>=e.x+e.width&&this.currentBBox.height+this.currentBBox.y>=e.y+e.height},HShapeElement.prototype.renderInnerContent=function(){if(this._renderShapeFrame(),!this.hidden&&(this._isFirstFrame||this._mdf)){var e=this.tempBoundingBox,r=999999;if(e.x=r,e.xMax=-r,e.y=r,e.yMax=-r,this.calculateBoundingBox(this.itemsData,e),e.width=e.xMax<e.x?0:e.xMax-e.x,e.height=e.yMax<e.y?0:e.yMax-e.y,this.currentBoxContains(e))return;var s=!1;if(this.currentBBox.w!==e.width&&(this.currentBBox.w=e.width,this.shapeCont.setAttribute("width",e.width),s=!0),this.currentBBox.h!==e.height&&(this.currentBBox.h=e.height,this.shapeCont.setAttribute("height",e.height),s=!0),s||this.currentBBox.x!==e.x||this.currentBBox.y!==e.y){this.currentBBox.w=e.width,this.currentBBox.h=e.height,this.currentBBox.x=e.x,this.currentBBox.y=e.y,this.shapeCont.setAttribute("viewBox",this.currentBBox.x+" "+this.currentBBox.y+" "+this.currentBBox.w+" "+this.currentBBox.h);var d=this.shapeCont.style,f="translate("+this.currentBBox.x+"px,"+this.currentBBox.y+"px)";d.transform=f,d.webkitTransform=f}}};function HTextElement(e,r,s){this.textSpans=[],this.textPaths=[],this.currentBBox={x:999999,y:-999999,h:0,w:0},this.renderType="svg",this.isMasked=!1,this.initElement(e,r,s)}extendPrototype([BaseElement,TransformElement,HBaseElement,HierarchyElement,FrameElement,RenderableDOMElement,ITextElement],HTextElement),HTextElement.prototype.createContent=function(){if(this.isMasked=this.checkMasks(),this.isMasked){this.renderType="svg",this.compW=this.comp.data.w,this.compH=this.comp.data.h,this.svgElement.setAttribute("width",this.compW),this.svgElement.setAttribute("height",this.compH);var e=createNS("g");this.maskedElement.appendChild(e),this.innerElem=e}else this.renderType="html",this.innerElem=this.layerElement;this.checkParenting()},HTextElement.prototype.buildNewText=function(){var e=this.textProperty.currentData;this.renderedLetters=createSizedArray(e.l?e.l.length:0);var r=this.innerElem.style,s=e.fc?this.buildColor(e.fc):"rgba(0,0,0,0)";r.fill=s,r.color=s,e.sc&&(r.stroke=this.buildColor(e.sc),r.strokeWidth=e.sw+"px");var d=this.globalData.fontManager.getFontByName(e.f);if(!this.globalData.fontManager.chars)if(r.fontSize=e.finalSize+"px",r.lineHeight=e.finalSize+"px",d.fClass)this.innerElem.className=d.fClass;else{r.fontFamily=d.fFamily;var f=e.fWeight,_=e.fStyle;r.fontStyle=_,r.fontWeight=f}var C,P,x=e.l;P=x.length;var B,_t,ue,Wt=this.mHelper,_n,_i="",Ei=0;for(C=0;C<P;C+=1){if(this.globalData.fontManager.chars?(this.textPaths[Ei]?B=this.textPaths[Ei]:(B=createNS("path"),B.setAttribute("stroke-linecap",lineCapEnum[1]),B.setAttribute("stroke-linejoin",lineJoinEnum[2]),B.setAttribute("stroke-miterlimit","4")),this.isMasked||(this.textSpans[Ei]?(_t=this.textSpans[Ei],ue=_t.children[0]):(_t=createTag("div"),_t.style.lineHeight=0,ue=createNS("svg"),ue.appendChild(B),styleDiv(_t)))):this.isMasked?B=this.textPaths[Ei]?this.textPaths[Ei]:createNS("text"):this.textSpans[Ei]?(_t=this.textSpans[Ei],B=this.textPaths[Ei]):(_t=createTag("span"),styleDiv(_t),B=createTag("span"),styleDiv(B),_t.appendChild(B)),this.globalData.fontManager.chars){var _a=this.globalData.fontManager.getCharData(e.finalText[C],d.fStyle,this.globalData.fontManager.getFontByName(e.f).fFamily),Di;if(_a?Di=_a.data:Di=null,Wt.reset(),Di&&Di.shapes&&Di.shapes.length&&(_n=Di.shapes[0].it,Wt.scale(e.finalSize/100,e.finalSize/100),_i=this.createPathShape(Wt,_n),B.setAttribute("d",_i)),this.isMasked)this.innerElem.appendChild(B);else{if(this.innerElem.appendChild(_t),Di&&Di.shapes){document.body.appendChild(ue);var _o=ue.getBBox();ue.setAttribute("width",_o.width+2),ue.setAttribute("height",_o.height+2),ue.setAttribute("viewBox",_o.x-1+" "+(_o.y-1)+" "+(_o.width+2)+" "+(_o.height+2));var _s=ue.style,_c="translate("+(_o.x-1)+"px,"+(_o.y-1)+"px)";_s.transform=_c,_s.webkitTransform=_c,x[C].yOffset=_o.y-1}else ue.setAttribute("width",1),ue.setAttribute("height",1);_t.appendChild(ue)}}else if(B.textContent=x[C].val,B.setAttributeNS("http://www.w3.org/XML/1998/namespace","xml:space","preserve"),this.isMasked)this.innerElem.appendChild(B);else{this.innerElem.appendChild(_t);var _m=B.style,Qm="translate3d(0,"+-e.finalSize/1.2+"px,0)";_m.transform=Qm,_m.webkitTransform=Qm}this.isMasked?this.textSpans[Ei]=B:this.textSpans[Ei]=_t,this.textSpans[Ei].style.display="block",this.textPaths[Ei]=B,Ei+=1}for(;Ei<this.textSpans.length;)this.textSpans[Ei].style.display="none",Ei+=1},HTextElement.prototype.renderInnerContent=function(){this.validateText();var e;if(this.data.singleShape){if(!this._isFirstFrame&&!this.lettersChangedFlag)return;if(this.isMasked&&this.finalTransform._matMdf){this.svgElement.setAttribute("viewBox",-this.finalTransform.mProp.p.v[0]+" "+-this.finalTransform.mProp.p.v[1]+" "+this.compW+" "+this.compH),e=this.svgElement.style;var r="translate("+-this.finalTransform.mProp.p.v[0]+"px,"+-this.finalTransform.mProp.p.v[1]+"px)";e.transform=r,e.webkitTransform=r}}if(this.textAnimator.getMeasures(this.textProperty.currentData,this.lettersChangedFlag),!(!this.lettersChangedFlag&&!this.textAnimator.lettersChangedFlag)){var s,d,f=0,_=this.textAnimator.renderedLetters,C=this.textProperty.currentData.l;d=C.length;var P,x,B;for(s=0;s<d;s+=1)C[s].n?f+=1:(x=this.textSpans[s],B=this.textPaths[s],P=_[f],f+=1,P._mdf.m&&(this.isMasked?x.setAttribute("transform",P.m):(x.style.webkitTransform=P.m,x.style.transform=P.m)),x.style.opacity=P.o,P.sw&&P._mdf.sw&&B.setAttribute("stroke-width",P.sw),P.sc&&P._mdf.sc&&B.setAttribute("stroke",P.sc),P.fc&&P._mdf.fc&&(B.setAttribute("fill",P.fc),B.style.color=P.fc));if(this.innerElem.getBBox&&!this.hidden&&(this._isFirstFrame||this._mdf)){var _t=this.innerElem.getBBox();this.currentBBox.w!==_t.width&&(this.currentBBox.w=_t.width,this.svgElement.setAttribute("width",_t.width)),this.currentBBox.h!==_t.height&&(this.currentBBox.h=_t.height,this.svgElement.setAttribute("height",_t.height));var ue=1;if(this.currentBBox.w!==_t.width+ue*2||this.currentBBox.h!==_t.height+ue*2||this.currentBBox.x!==_t.x-ue||this.currentBBox.y!==_t.y-ue){this.currentBBox.w=_t.width+ue*2,this.currentBBox.h=_t.height+ue*2,this.currentBBox.x=_t.x-ue,this.currentBBox.y=_t.y-ue,this.svgElement.setAttribute("viewBox",this.currentBBox.x+" "+this.currentBBox.y+" "+this.currentBBox.w+" "+this.currentBBox.h),e=this.svgElement.style;var Wt="translate("+this.currentBBox.x+"px,"+this.currentBBox.y+"px)";e.transform=Wt,e.webkitTransform=Wt}}}};function HCameraElement(e,r,s){this.initFrame(),this.initBaseData(e,r,s),this.initHierarchy();var d=PropertyFactory.getProp;if(this.pe=d(this,e.pe,0,0,this),e.ks.p.s?(this.px=d(this,e.ks.p.x,1,0,this),this.py=d(this,e.ks.p.y,1,0,this),this.pz=d(this,e.ks.p.z,1,0,this)):this.p=d(this,e.ks.p,1,0,this),e.ks.a&&(this.a=d(this,e.ks.a,1,0,this)),e.ks.or.k.length&&e.ks.or.k[0].to){var f,_=e.ks.or.k.length;for(f=0;f<_;f+=1)e.ks.or.k[f].to=null,e.ks.or.k[f].ti=null}this.or=d(this,e.ks.or,1,degToRads,this),this.or.sh=!0,this.rx=d(this,e.ks.rx,0,degToRads,this),this.ry=d(this,e.ks.ry,0,degToRads,this),this.rz=d(this,e.ks.rz,0,degToRads,this),this.mat=new Matrix,this._prevMat=new Matrix,this._isFirstFrame=!0,this.finalTransform={mProp:this}}extendPrototype([BaseElement,FrameElement,HierarchyElement],HCameraElement),HCameraElement.prototype.setup=function(){var e,r=this.comp.threeDElements.length,s,d,f;for(e=0;e<r;e+=1)if(s=this.comp.threeDElements[e],s.type==="3d"){d=s.perspectiveElem.style,f=s.container.style;var _=this.pe.v+"px",C="0px 0px 0px",P="matrix3d(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)";d.perspective=_,d.webkitPerspective=_,f.transformOrigin=C,f.mozTransformOrigin=C,f.webkitTransformOrigin=C,d.transform=P,d.webkitTransform=P}},HCameraElement.prototype.createElements=function(){},HCameraElement.prototype.hide=function(){},HCameraElement.prototype.renderFrame=function(){var e=this._isFirstFrame,r,s;if(this.hierarchy)for(s=this.hierarchy.length,r=0;r<s;r+=1)e=this.hierarchy[r].finalTransform.mProp._mdf||e;if(e||this.pe._mdf||this.p&&this.p._mdf||this.px&&(this.px._mdf||this.py._mdf||this.pz._mdf)||this.rx._mdf||this.ry._mdf||this.rz._mdf||this.or._mdf||this.a&&this.a._mdf){if(this.mat.reset(),this.hierarchy)for(s=this.hierarchy.length-1,r=s;r>=0;r-=1){var d=this.hierarchy[r].finalTransform.mProp;this.mat.translate(-d.p.v[0],-d.p.v[1],d.p.v[2]),this.mat.rotateX(-d.or.v[0]).rotateY(-d.or.v[1]).rotateZ(d.or.v[2]),this.mat.rotateX(-d.rx.v).rotateY(-d.ry.v).rotateZ(d.rz.v),this.mat.scale(1/d.s.v[0],1/d.s.v[1],1/d.s.v[2]),this.mat.translate(d.a.v[0],d.a.v[1],d.a.v[2])}if(this.p?this.mat.translate(-this.p.v[0],-this.p.v[1],this.p.v[2]):this.mat.translate(-this.px.v,-this.py.v,this.pz.v),this.a){var f;this.p?f=[this.p.v[0]-this.a.v[0],this.p.v[1]-this.a.v[1],this.p.v[2]-this.a.v[2]]:f=[this.px.v-this.a.v[0],this.py.v-this.a.v[1],this.pz.v-this.a.v[2]];var _=Math.sqrt(Math.pow(f[0],2)+Math.pow(f[1],2)+Math.pow(f[2],2)),C=[f[0]/_,f[1]/_,f[2]/_],P=Math.sqrt(C[2]*C[2]+C[0]*C[0]),x=Math.atan2(C[1],P),B=Math.atan2(C[0],-C[2]);this.mat.rotateY(B).rotateX(-x)}this.mat.rotateX(-this.rx.v).rotateY(-this.ry.v).rotateZ(this.rz.v),this.mat.rotateX(-this.or.v[0]).rotateY(-this.or.v[1]).rotateZ(this.or.v[2]),this.mat.translate(this.globalData.compSize.w/2,this.globalData.compSize.h/2,0),this.mat.translate(0,0,this.pe.v);var _t=!this._prevMat.equals(this.mat);if((_t||this.pe._mdf)&&this.comp.threeDElements){s=this.comp.threeDElements.length;var ue,Wt,_n;for(r=0;r<s;r+=1)if(ue=this.comp.threeDElements[r],ue.type==="3d"){if(_t){var _i=this.mat.toCSS();_n=ue.container.style,_n.transform=_i,_n.webkitTransform=_i}this.pe._mdf&&(Wt=ue.perspectiveElem.style,Wt.perspective=this.pe.v+"px",Wt.webkitPerspective=this.pe.v+"px")}this.mat.clone(this._prevMat)}}this._isFirstFrame=!1},HCameraElement.prototype.prepareFrame=function(e){this.prepareProperties(e,!0)},HCameraElement.prototype.destroy=function(){},HCameraElement.prototype.getBaseElement=function(){return null};function HImageElement(e,r,s){this.assetData=r.getAssetData(e.refId),this.initElement(e,r,s)}extendPrototype([BaseElement,TransformElement,HBaseElement,HSolidElement,HierarchyElement,FrameElement,RenderableElement],HImageElement),HImageElement.prototype.createContent=function(){var e=this.globalData.getAssetsPath(this.assetData),r=new Image;this.data.hasMask?(this.imageElem=createNS("image"),this.imageElem.setAttribute("width",this.assetData.w+"px"),this.imageElem.setAttribute("height",this.assetData.h+"px"),this.imageElem.setAttributeNS("http://www.w3.org/1999/xlink","href",e),this.layerElement.appendChild(this.imageElem),this.baseElement.setAttribute("width",this.assetData.w),this.baseElement.setAttribute("height",this.assetData.h)):this.layerElement.appendChild(r),r.crossOrigin="anonymous",r.src=e,this.data.ln&&this.baseElement.setAttribute("id",this.data.ln)};function HybridRendererBase(e,r){this.animationItem=e,this.layers=null,this.renderedFrame=-1,this.renderConfig={className:r&&r.className||"",imagePreserveAspectRatio:r&&r.imagePreserveAspectRatio||"xMidYMid slice",hideOnTransparent:!(r&&r.hideOnTransparent===!1),filterSize:{width:r&&r.filterSize&&r.filterSize.width||"400%",height:r&&r.filterSize&&r.filterSize.height||"400%",x:r&&r.filterSize&&r.filterSize.x||"-100%",y:r&&r.filterSize&&r.filterSize.y||"-100%"}},this.globalData={_mdf:!1,frameNum:-1,renderConfig:this.renderConfig},this.pendingElements=[],this.elements=[],this.threeDElements=[],this.destroyed=!1,this.camera=null,this.supports3d=!0,this.rendererType="html"}extendPrototype([BaseRenderer],HybridRendererBase),HybridRendererBase.prototype.buildItem=SVGRenderer.prototype.buildItem,HybridRendererBase.prototype.checkPendingElements=function(){for(;this.pendingElements.length;){var e=this.pendingElements.pop();e.checkParenting()}},HybridRendererBase.prototype.appendElementInPos=function(e,r){var s=e.getBaseElement();if(s){var d=this.layers[r];if(!d.ddd||!this.supports3d)if(this.threeDElements)this.addTo3dContainer(s,r);else{for(var f=0,_,C,P;f<r;)this.elements[f]&&this.elements[f]!==!0&&this.elements[f].getBaseElement&&(C=this.elements[f],P=this.layers[f].ddd?this.getThreeDContainerByPos(f):C.getBaseElement(),_=P||_),f+=1;_?(!d.ddd||!this.supports3d)&&this.layerElement.insertBefore(s,_):(!d.ddd||!this.supports3d)&&this.layerElement.appendChild(s)}else this.addTo3dContainer(s,r)}},HybridRendererBase.prototype.createShape=function(e){return this.supports3d?new HShapeElement(e,this.globalData,this):new SVGShapeElement(e,this.globalData,this)},HybridRendererBase.prototype.createText=function(e){return this.supports3d?new HTextElement(e,this.globalData,this):new SVGTextLottieElement(e,this.globalData,this)},HybridRendererBase.prototype.createCamera=function(e){return this.camera=new HCameraElement(e,this.globalData,this),this.camera},HybridRendererBase.prototype.createImage=function(e){return this.supports3d?new HImageElement(e,this.globalData,this):new IImageElement(e,this.globalData,this)},HybridRendererBase.prototype.createSolid=function(e){return this.supports3d?new HSolidElement(e,this.globalData,this):new ISolidElement(e,this.globalData,this)},HybridRendererBase.prototype.createNull=SVGRenderer.prototype.createNull,HybridRendererBase.prototype.getThreeDContainerByPos=function(e){for(var r=0,s=this.threeDElements.length;r<s;){if(this.threeDElements[r].startPos<=e&&this.threeDElements[r].endPos>=e)return this.threeDElements[r].perspectiveElem;r+=1}return null},HybridRendererBase.prototype.createThreeDContainer=function(e,r){var s=createTag("div"),d,f;styleDiv(s);var _=createTag("div");if(styleDiv(_),r==="3d"){d=s.style,d.width=this.globalData.compSize.w+"px",d.height=this.globalData.compSize.h+"px";var C="50% 50%";d.webkitTransformOrigin=C,d.mozTransformOrigin=C,d.transformOrigin=C,f=_.style;var P="matrix3d(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1)";f.transform=P,f.webkitTransform=P}s.appendChild(_);var x={container:_,perspectiveElem:s,startPos:e,endPos:e,type:r};return this.threeDElements.push(x),x},HybridRendererBase.prototype.build3dContainers=function(){var e,r=this.layers.length,s,d="";for(e=0;e<r;e+=1)this.layers[e].ddd&&this.layers[e].ty!==3?(d!=="3d"&&(d="3d",s=this.createThreeDContainer(e,"3d")),s.endPos=Math.max(s.endPos,e)):(d!=="2d"&&(d="2d",s=this.createThreeDContainer(e,"2d")),s.endPos=Math.max(s.endPos,e));for(r=this.threeDElements.length,e=r-1;e>=0;e-=1)this.resizerElem.appendChild(this.threeDElements[e].perspectiveElem)},HybridRendererBase.prototype.addTo3dContainer=function(e,r){for(var s=0,d=this.threeDElements.length;s<d;){if(r<=this.threeDElements[s].endPos){for(var f=this.threeDElements[s].startPos,_;f<r;)this.elements[f]&&this.elements[f].getBaseElement&&(_=this.elements[f].getBaseElement()),f+=1;_?this.threeDElements[s].container.insertBefore(e,_):this.threeDElements[s].container.appendChild(e);break}s+=1}},HybridRendererBase.prototype.configAnimation=function(e){var r=createTag("div"),s=this.animationItem.wrapper,d=r.style;d.width=e.w+"px",d.height=e.h+"px",this.resizerElem=r,styleDiv(r),d.transformStyle="flat",d.mozTransformStyle="flat",d.webkitTransformStyle="flat",this.renderConfig.className&&r.setAttribute("class",this.renderConfig.className),s.appendChild(r),d.overflow="hidden";var f=createNS("svg");f.setAttribute("width","1"),f.setAttribute("height","1"),styleDiv(f),this.resizerElem.appendChild(f);var _=createNS("defs");f.appendChild(_),this.data=e,this.setupGlobalData(e,f),this.globalData.defs=_,this.layers=e.layers,this.layerElement=this.resizerElem,this.build3dContainers(),this.updateContainerSize()},HybridRendererBase.prototype.destroy=function(){this.animationItem.wrapper&&(this.animationItem.wrapper.innerText=""),this.animationItem.container=null,this.globalData.defs=null;var e,r=this.layers?this.layers.length:0;for(e=0;e<r;e+=1)this.elements[e]&&this.elements[e].destroy&&this.elements[e].destroy();this.elements.length=0,this.destroyed=!0,this.animationItem=null},HybridRendererBase.prototype.updateContainerSize=function(){var e=this.animationItem.wrapper.offsetWidth,r=this.animationItem.wrapper.offsetHeight,s=e/r,d=this.globalData.compSize.w/this.globalData.compSize.h,f,_,C,P;d>s?(f=e/this.globalData.compSize.w,_=e/this.globalData.compSize.w,C=0,P=(r-this.globalData.compSize.h*(e/this.globalData.compSize.w))/2):(f=r/this.globalData.compSize.h,_=r/this.globalData.compSize.h,C=(e-this.globalData.compSize.w*(r/this.globalData.compSize.h))/2,P=0);var x=this.resizerElem.style;x.webkitTransform="matrix3d("+f+",0,0,0,0,"+_+",0,0,0,0,1,0,"+C+","+P+",0,1)",x.transform=x.webkitTransform},HybridRendererBase.prototype.renderFrame=SVGRenderer.prototype.renderFrame,HybridRendererBase.prototype.hide=function(){this.resizerElem.style.display="none"},HybridRendererBase.prototype.show=function(){this.resizerElem.style.display="block"},HybridRendererBase.prototype.initItems=function(){if(this.buildAllItems(),this.camera)this.camera.setup();else{var e=this.globalData.compSize.w,r=this.globalData.compSize.h,s,d=this.threeDElements.length;for(s=0;s<d;s+=1){var f=this.threeDElements[s].perspectiveElem.style;f.webkitPerspective=Math.sqrt(Math.pow(e,2)+Math.pow(r,2))+"px",f.perspective=f.webkitPerspective}}},HybridRendererBase.prototype.searchExtraCompositions=function(e){var r,s=e.length,d=createTag("div");for(r=0;r<s;r+=1)if(e[r].xt){var f=this.createComp(e[r],d,this.globalData.comp,null);f.initExpressions(),this.globalData.projectInterface.registerComposition(f)}};function HCompElement(e,r,s){this.layers=e.layers,this.supports3d=!e.hasMask,this.completeLayers=!1,this.pendingElements=[],this.elements=this.layers?createSizedArray(this.layers.length):[],this.initElement(e,r,s),this.tm=e.tm?PropertyFactory.getProp(this,e.tm,0,r.frameRate,this):{_placeholder:!0}}extendPrototype([HybridRendererBase,ICompElement,HBaseElement],HCompElement),HCompElement.prototype._createBaseContainerElements=HCompElement.prototype.createContainerElements,HCompElement.prototype.createContainerElements=function(){this._createBaseContainerElements(),this.data.hasMask?(this.svgElement.setAttribute("width",this.data.w),this.svgElement.setAttribute("height",this.data.h),this.transformedElement=this.baseElement):this.transformedElement=this.layerElement},HCompElement.prototype.addTo3dContainer=function(e,r){for(var s=0,d;s<r;)this.elements[s]&&this.elements[s].getBaseElement&&(d=this.elements[s].getBaseElement()),s+=1;d?this.layerElement.insertBefore(e,d):this.layerElement.appendChild(e)},HCompElement.prototype.createComp=function(e){return this.supports3d?new HCompElement(e,this.globalData,this):new SVGCompElement(e,this.globalData,this)};function HybridRenderer(e,r){this.animationItem=e,this.layers=null,this.renderedFrame=-1,this.renderConfig={className:r&&r.className||"",imagePreserveAspectRatio:r&&r.imagePreserveAspectRatio||"xMidYMid slice",hideOnTransparent:!(r&&r.hideOnTransparent===!1),filterSize:{width:r&&r.filterSize&&r.filterSize.width||"400%",height:r&&r.filterSize&&r.filterSize.height||"400%",x:r&&r.filterSize&&r.filterSize.x||"-100%",y:r&&r.filterSize&&r.filterSize.y||"-100%"},runExpressions:!r||r.runExpressions===void 0||r.runExpressions},this.globalData={_mdf:!1,frameNum:-1,renderConfig:this.renderConfig},this.pendingElements=[],this.elements=[],this.threeDElements=[],this.destroyed=!1,this.camera=null,this.supports3d=!0,this.rendererType="html"}extendPrototype([HybridRendererBase],HybridRenderer),HybridRenderer.prototype.createComp=function(e){return this.supports3d?new HCompElement(e,this.globalData,this):new SVGCompElement(e,this.globalData,this)};var CompExpressionInterface=function(){return function(e){function r(s){for(var d=0,f=e.layers.length;d<f;){if(e.layers[d].nm===s||e.layers[d].ind===s)return e.elements[d].layerInterface;d+=1}return null}return Object.defineProperty(r,"_name",{value:e.data.nm}),r.layer=r,r.pixelAspect=1,r.height=e.data.h||e.globalData.compSize.h,r.width=e.data.w||e.globalData.compSize.w,r.pixelAspect=1,r.frameDuration=1/e.globalData.frameRate,r.displayStartTime=0,r.numLayers=e.layers.length,r}}();function _typeof$2(e){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?_typeof$2=function(s){return typeof s}:_typeof$2=function(s){return s&&typeof Symbol=="function"&&s.constructor===Symbol&&s!==Symbol.prototype?"symbol":typeof s},_typeof$2(e)}function seedRandom(e,r){var s=this,d=256,f=6,_=52,C="random",P=r.pow(d,f),x=r.pow(2,_),B=x*2,_t=d-1,ue;function Wt(_s,_c,_m){var Qm=[];_c=_c===!0?{entropy:!0}:_c||{};var tE=_a(Ei(_c.entropy?[_s,_o(e)]:_s===null?Di():_s,3),Qm),aE=new _n(Qm),CE=function(){for(var gE=aE.g(f),cE=P,_E=0;gE<x;)gE=(gE+_E)*d,cE*=d,_E=aE.g(1);for(;gE>=B;)gE/=2,cE/=2,_E>>>=1;return(gE+_E)/cE};return CE.int32=function(){return aE.g(4)|0},CE.quick=function(){return aE.g(4)/4294967296},CE.double=CE,_a(_o(aE.S),e),(_c.pass||_m||function(lE,gE,cE,_E){return _E&&(_E.S&&_i(_E,aE),lE.state=function(){return _i(aE,{})}),cE?(r[C]=lE,gE):lE})(CE,tE,"global"in _c?_c.global:this==r,_c.state)}r["seed"+C]=Wt;function _n(_s){var _c,_m=_s.length,Qm=this,tE=0,aE=Qm.i=Qm.j=0,CE=Qm.S=[];for(_m||(_s=[_m++]);tE<d;)CE[tE]=tE++;for(tE=0;tE<d;tE++)CE[tE]=CE[aE=_t&aE+_s[tE%_m]+(_c=CE[tE])],CE[aE]=_c;Qm.g=function(lE){for(var gE,cE=0,_E=Qm.i,iE=Qm.j,rE=Qm.S;lE--;)gE=rE[_E=_t&_E+1],cE=cE*d+rE[_t&(rE[_E]=rE[iE=_t&iE+gE])+(rE[iE]=gE)];return Qm.i=_E,Qm.j=iE,cE}}function _i(_s,_c){return _c.i=_s.i,_c.j=_s.j,_c.S=_s.S.slice(),_c}function Ei(_s,_c){var _m=[],Qm=_typeof$2(_s),tE;if(_c&&Qm=="object")for(tE in _s)try{_m.push(Ei(_s[tE],_c-1))}catch{}return _m.length?_m:Qm=="string"?_s:_s+"\0"}function _a(_s,_c){for(var _m=_s+"",Qm,tE=0;tE<_m.length;)_c[_t&tE]=_t&(Qm^=_c[_t&tE]*19)+_m.charCodeAt(tE++);return _o(_c)}function Di(){try{var _s=new Uint8Array(d);return(s.crypto||s.msCrypto).getRandomValues(_s),_o(_s)}catch{var _c=s.navigator,_m=_c&&_c.plugins;return[+new Date,s,_m,s.screen,_o(e)]}}function _o(_s){return String.fromCharCode.apply(0,_s)}_a(r.random(),e)}function initialize$2(e){seedRandom([],e)}var propTypes={SHAPE:"shape"};function _typeof$1(e){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?_typeof$1=function(s){return typeof s}:_typeof$1=function(s){return s&&typeof Symbol=="function"&&s.constructor===Symbol&&s!==Symbol.prototype?"symbol":typeof s},_typeof$1(e)}var ExpressionManager=function(){var ob={},Math=BMMath,window=null,document=null,XMLHttpRequest=null,fetch=null,frames=null,_lottieGlobal={};initialize$2(BMMath);function resetFrame(){_lottieGlobal={}}function $bm_isInstanceOfArray(e){return e.constructor===Array||e.constructor===Float32Array}function isNumerable(e,r){return e==="number"||r instanceof Number||e==="boolean"||e==="string"}function $bm_neg(e){var r=_typeof$1(e);if(r==="number"||e instanceof Number||r==="boolean")return-e;if($bm_isInstanceOfArray(e)){var s,d=e.length,f=[];for(s=0;s<d;s+=1)f[s]=-e[s];return f}return e.propType?e.v:-e}var easeInBez=BezierFactory.getBezierEasing(.333,0,.833,.833,"easeIn").get,easeOutBez=BezierFactory.getBezierEasing(.167,.167,.667,1,"easeOut").get,easeInOutBez=BezierFactory.getBezierEasing(.33,0,.667,1,"easeInOut").get;function sum(e,r){var s=_typeof$1(e),d=_typeof$1(r);if(isNumerable(s,e)&&isNumerable(d,r)||s==="string"||d==="string")return e+r;if($bm_isInstanceOfArray(e)&&isNumerable(d,r))return e=e.slice(0),e[0]+=r,e;if(isNumerable(s,e)&&$bm_isInstanceOfArray(r))return r=r.slice(0),r[0]=e+r[0],r;if($bm_isInstanceOfArray(e)&&$bm_isInstanceOfArray(r)){for(var f=0,_=e.length,C=r.length,P=[];f<_||f<C;)(typeof e[f]=="number"||e[f]instanceof Number)&&(typeof r[f]=="number"||r[f]instanceof Number)?P[f]=e[f]+r[f]:P[f]=r[f]===void 0?e[f]:e[f]||r[f],f+=1;return P}return 0}var add=sum;function sub(e,r){var s=_typeof$1(e),d=_typeof$1(r);if(isNumerable(s,e)&&isNumerable(d,r))return s==="string"&&(e=parseInt(e,10)),d==="string"&&(r=parseInt(r,10)),e-r;if($bm_isInstanceOfArray(e)&&isNumerable(d,r))return e=e.slice(0),e[0]-=r,e;if(isNumerable(s,e)&&$bm_isInstanceOfArray(r))return r=r.slice(0),r[0]=e-r[0],r;if($bm_isInstanceOfArray(e)&&$bm_isInstanceOfArray(r)){for(var f=0,_=e.length,C=r.length,P=[];f<_||f<C;)(typeof e[f]=="number"||e[f]instanceof Number)&&(typeof r[f]=="number"||r[f]instanceof Number)?P[f]=e[f]-r[f]:P[f]=r[f]===void 0?e[f]:e[f]||r[f],f+=1;return P}return 0}function mul(e,r){var s=_typeof$1(e),d=_typeof$1(r),f;if(isNumerable(s,e)&&isNumerable(d,r))return e*r;var _,C;if($bm_isInstanceOfArray(e)&&isNumerable(d,r)){for(C=e.length,f=createTypedArray("float32",C),_=0;_<C;_+=1)f[_]=e[_]*r;return f}if(isNumerable(s,e)&&$bm_isInstanceOfArray(r)){for(C=r.length,f=createTypedArray("float32",C),_=0;_<C;_+=1)f[_]=e*r[_];return f}return 0}function div(e,r){var s=_typeof$1(e),d=_typeof$1(r),f;if(isNumerable(s,e)&&isNumerable(d,r))return e/r;var _,C;if($bm_isInstanceOfArray(e)&&isNumerable(d,r)){for(C=e.length,f=createTypedArray("float32",C),_=0;_<C;_+=1)f[_]=e[_]/r;return f}if(isNumerable(s,e)&&$bm_isInstanceOfArray(r)){for(C=r.length,f=createTypedArray("float32",C),_=0;_<C;_+=1)f[_]=e/r[_];return f}return 0}function mod(e,r){return typeof e=="string"&&(e=parseInt(e,10)),typeof r=="string"&&(r=parseInt(r,10)),e%r}var $bm_sum=sum,$bm_sub=sub,$bm_mul=mul,$bm_div=div,$bm_mod=mod;function clamp(e,r,s){if(r>s){var d=s;s=r,r=d}return Math.min(Math.max(e,r),s)}function radiansToDegrees(e){return e/degToRads}var radians_to_degrees=radiansToDegrees;function degreesToRadians(e){return e*degToRads}var degrees_to_radians=radiansToDegrees,helperLengthArray=[0,0,0,0,0,0];function length(e,r){if(typeof e=="number"||e instanceof Number)return r=r||0,Math.abs(e-r);r||(r=helperLengthArray);var s,d=Math.min(e.length,r.length),f=0;for(s=0;s<d;s+=1)f+=Math.pow(r[s]-e[s],2);return Math.sqrt(f)}function normalize(e){return div(e,length(e))}function rgbToHsl(e){var r=e[0],s=e[1],d=e[2],f=Math.max(r,s,d),_=Math.min(r,s,d),C,P,x=(f+_)/2;if(f===_)C=0,P=0;else{var B=f-_;switch(P=x>.5?B/(2-f-_):B/(f+_),f){case r:C=(s-d)/B+(s<d?6:0);break;case s:C=(d-r)/B+2;break;case d:C=(r-s)/B+4;break}C/=6}return[C,P,x,e[3]]}function hue2rgb(e,r,s){return s<0&&(s+=1),s>1&&(s-=1),s<1/6?e+(r-e)*6*s:s<1/2?r:s<2/3?e+(r-e)*(2/3-s)*6:e}function hslToRgb(e){var r=e[0],s=e[1],d=e[2],f,_,C;if(s===0)f=d,C=d,_=d;else{var P=d<.5?d*(1+s):d+s-d*s,x=2*d-P;f=hue2rgb(x,P,r+1/3),_=hue2rgb(x,P,r),C=hue2rgb(x,P,r-1/3)}return[f,_,C,e[3]]}function linear(e,r,s,d,f){if((d===void 0||f===void 0)&&(d=r,f=s,r=0,s=1),s<r){var _=s;s=r,r=_}if(e<=r)return d;if(e>=s)return f;var C=s===r?0:(e-r)/(s-r);if(!d.length)return d+(f-d)*C;var P,x=d.length,B=createTypedArray("float32",x);for(P=0;P<x;P+=1)B[P]=d[P]+(f[P]-d[P])*C;return B}function random(e,r){if(r===void 0&&(e===void 0?(e=0,r=1):(r=e,e=void 0)),r.length){var s,d=r.length;e||(e=createTypedArray("float32",d));var f=createTypedArray("float32",d),_=BMMath.random();for(s=0;s<d;s+=1)f[s]=e[s]+_*(r[s]-e[s]);return f}e===void 0&&(e=0);var C=BMMath.random();return e+C*(r-e)}function createPath(e,r,s,d){var f,_=e.length,C=shapePool.newElement();C.setPathData(!!d,_);var P=[0,0],x,B;for(f=0;f<_;f+=1)x=r&&r[f]?r[f]:P,B=s&&s[f]?s[f]:P,C.setTripleAt(e[f][0],e[f][1],B[0]+e[f][0],B[1]+e[f][1],x[0]+e[f][0],x[1]+e[f][1],f,!0);return C}function initiateExpression(elem,data,property){function noOp(e){return e}if(!elem.globalData.renderConfig.runExpressions)return noOp;var val=data.x,needsVelocity=/velocity(?![\w\d])/.test(val),_needsRandom=val.indexOf("random")!==-1,elemType=elem.data.ty,transform,$bm_transform,content,effect,thisProperty=property;thisProperty.valueAtTime=thisProperty.getValueAtTime,Object.defineProperty(thisProperty,"value",{get:function(){return thisProperty.v}}),elem.comp.frameDuration=1/elem.comp.globalData.frameRate,elem.comp.displayStartTime=0;var inPoint=elem.data.ip/elem.comp.globalData.frameRate,outPoint=elem.data.op/elem.comp.globalData.frameRate,width=elem.data.sw?elem.data.sw:0,height=elem.data.sh?elem.data.sh:0,name=elem.data.nm,loopIn,loop_in,loopOut,loop_out,smooth,toWorld,fromWorld,fromComp,toComp,fromCompToSurface,position,rotation,anchorPoint,scale,thisLayer,thisComp,mask,valueAtTime,velocityAtTime,scoped_bm_rt,expression_function=eval("[function _expression_function(){"+val+";scoped_bm_rt=$bm_rt}]")[0],numKeys=property.kf?data.k.length:0,active=!this.data||this.data.hd!==!0,wiggle=(function e(r,s){var d,f,_=this.pv.length?this.pv.length:1,C=createTypedArray("float32",_);r=5;var P=Math.floor(time*r);for(d=0,f=0;d<P;){for(f=0;f<_;f+=1)C[f]+=-s+s*2*BMMath.random();d+=1}var x=time*r,B=x-Math.floor(x),_t=createTypedArray("float32",_);if(_>1){for(f=0;f<_;f+=1)_t[f]=this.pv[f]+C[f]+(-s+s*2*BMMath.random())*B;return _t}return this.pv+C[0]+(-s+s*2*BMMath.random())*B}).bind(this);thisProperty.loopIn&&(loopIn=thisProperty.loopIn.bind(thisProperty),loop_in=loopIn),thisProperty.loopOut&&(loopOut=thisProperty.loopOut.bind(thisProperty),loop_out=loopOut),thisProperty.smooth&&(smooth=thisProperty.smooth.bind(thisProperty));function loopInDuration(e,r){return loopIn(e,r,!0)}function loopOutDuration(e,r){return loopOut(e,r,!0)}this.getValueAtTime&&(valueAtTime=this.getValueAtTime.bind(this)),this.getVelocityAtTime&&(velocityAtTime=this.getVelocityAtTime.bind(this));var comp=elem.comp.globalData.projectInterface.bind(elem.comp.globalData.projectInterface);function lookAt(e,r){var s=[r[0]-e[0],r[1]-e[1],r[2]-e[2]],d=Math.atan2(s[0],Math.sqrt(s[1]*s[1]+s[2]*s[2]))/degToRads,f=-Math.atan2(s[1],s[2])/degToRads;return[f,d,0]}function easeOut(e,r,s,d,f){return applyEase(easeOutBez,e,r,s,d,f)}function easeIn(e,r,s,d,f){return applyEase(easeInBez,e,r,s,d,f)}function ease(e,r,s,d,f){return applyEase(easeInOutBez,e,r,s,d,f)}function applyEase(e,r,s,d,f,_){f===void 0?(f=s,_=d):r=(r-s)/(d-s),r>1?r=1:r<0&&(r=0);var C=e(r);if($bm_isInstanceOfArray(f)){var P,x=f.length,B=createTypedArray("float32",x);for(P=0;P<x;P+=1)B[P]=(_[P]-f[P])*C+f[P];return B}return(_-f)*C+f}function nearestKey(e){var r,s=data.k.length,d,f;if(!data.k.length||typeof data.k[0]=="number")d=0,f=0;else if(d=-1,e*=elem.comp.globalData.frameRate,e<data.k[0].t)d=1,f=data.k[0].t;else{for(r=0;r<s-1;r+=1)if(e===data.k[r].t){d=r+1,f=data.k[r].t;break}else if(e>data.k[r].t&&e<data.k[r+1].t){e-data.k[r].t>data.k[r+1].t-e?(d=r+2,f=data.k[r+1].t):(d=r+1,f=data.k[r].t);break}d===-1&&(d=r+1,f=data.k[r].t)}var _={};return _.index=d,_.time=f/elem.comp.globalData.frameRate,_}function key(e){var r,s,d;if(!data.k.length||typeof data.k[0]=="number")throw new Error("The property has no keyframe at index "+e);e-=1,r={time:data.k[e].t/elem.comp.globalData.frameRate,value:[]};var f=Object.prototype.hasOwnProperty.call(data.k[e],"s")?data.k[e].s:data.k[e-1].e;for(d=f.length,s=0;s<d;s+=1)r[s]=f[s],r.value[s]=f[s];return r}function framesToTime(e,r){return r||(r=elem.comp.globalData.frameRate),e/r}function timeToFrames(e,r){return!e&&e!==0&&(e=time),r||(r=elem.comp.globalData.frameRate),e*r}function seedRandom(e){BMMath.seedrandom(randSeed+e)}function sourceRectAtTime(){return elem.sourceRectAtTime()}function substring(e,r){return typeof value=="string"?r===void 0?value.substring(e):value.substring(e,r):""}function substr(e,r){return typeof value=="string"?r===void 0?value.substr(e):value.substr(e,r):""}function posterizeTime(e){time=e===0?0:Math.floor(time*e)/e,value=valueAtTime(time)}var time,velocity,value,text,textIndex,textTotal,selectorValue,index=elem.data.ind,hasParent=!!(elem.hierarchy&&elem.hierarchy.length),parent,randSeed=Math.floor(Math.random()*1e6),globalData=elem.globalData;function executeExpression(e){return value=e,this.frameExpressionId===elem.globalData.frameId&&this.propType!=="textSelector"?value:(this.propType==="textSelector"&&(textIndex=this.textIndex,textTotal=this.textTotal,selectorValue=this.selectorValue),thisLayer||(text=elem.layerInterface.text,thisLayer=elem.layerInterface,thisComp=elem.comp.compInterface,toWorld=thisLayer.toWorld.bind(thisLayer),fromWorld=thisLayer.fromWorld.bind(thisLayer),fromComp=thisLayer.fromComp.bind(thisLayer),toComp=thisLayer.toComp.bind(thisLayer),mask=thisLayer.mask?thisLayer.mask.bind(thisLayer):null,fromCompToSurface=fromComp),transform||(transform=elem.layerInterface("ADBE Transform Group"),$bm_transform=transform,transform&&(anchorPoint=transform.anchorPoint)),elemType===4&&!content&&(content=thisLayer("ADBE Root Vectors Group")),effect||(effect=thisLayer(4)),hasParent=!!(elem.hierarchy&&elem.hierarchy.length),hasParent&&!parent&&(parent=elem.hierarchy[0].layerInterface),time=this.comp.renderedFrame/this.comp.globalData.frameRate,_needsRandom&&seedRandom(randSeed+time),needsVelocity&&(velocity=velocityAtTime(time)),expression_function(),this.frameExpressionId=elem.globalData.frameId,scoped_bm_rt=scoped_bm_rt.propType===propTypes.SHAPE?scoped_bm_rt.v:scoped_bm_rt,scoped_bm_rt)}return executeExpression.__preventDeadCodeRemoval=[$bm_transform,anchorPoint,time,velocity,inPoint,outPoint,width,height,name,loop_in,loop_out,smooth,toComp,fromCompToSurface,toWorld,fromWorld,mask,position,rotation,scale,thisComp,numKeys,active,wiggle,loopInDuration,loopOutDuration,comp,lookAt,easeOut,easeIn,ease,nearestKey,key,text,textIndex,textTotal,selectorValue,framesToTime,timeToFrames,sourceRectAtTime,substring,substr,posterizeTime,index,globalData],executeExpression}return ob.initiateExpression=initiateExpression,ob.__preventDeadCodeRemoval=[window,document,XMLHttpRequest,fetch,frames,$bm_neg,add,$bm_sum,$bm_sub,$bm_mul,$bm_div,$bm_mod,clamp,radians_to_degrees,degreesToRadians,degrees_to_radians,normalize,rgbToHsl,hslToRgb,linear,random,createPath,_lottieGlobal],ob.resetFrame=resetFrame,ob}(),Expressions=function(){var e={};e.initExpressions=r,e.resetFrame=ExpressionManager.resetFrame;function r(s){var d=0,f=[];function _(){d+=1}function C(){d-=1,d===0&&x()}function P(B){f.indexOf(B)===-1&&f.push(B)}function x(){var B,_t=f.length;for(B=0;B<_t;B+=1)f[B].release();f.length=0}s.renderer.compInterface=CompExpressionInterface(s.renderer),s.renderer.globalData.projectInterface.registerComposition(s.renderer),s.renderer.globalData.pushExpression=_,s.renderer.globalData.popExpression=C,s.renderer.globalData.registerExpressionProperty=P}return e}(),MaskManagerInterface=function(){function e(s,d){this._mask=s,this._data=d}Object.defineProperty(e.prototype,"maskPath",{get:function(){return this._mask.prop.k&&this._mask.prop.getValue(),this._mask.prop}}),Object.defineProperty(e.prototype,"maskOpacity",{get:function(){return this._mask.op.k&&this._mask.op.getValue(),this._mask.op.v*100}});var r=function(d){var f=createSizedArray(d.viewData.length),_,C=d.viewData.length;for(_=0;_<C;_+=1)f[_]=new e(d.viewData[_],d.masksProperties[_]);var P=function(B){for(_=0;_<C;){if(d.masksProperties[_].nm===B)return f[_];_+=1}return null};return P};return r}(),ExpressionPropertyInterface=function(){var e={pv:0,v:0,mult:1},r={pv:[0,0,0],v:[0,0,0],mult:1};function s(C,P,x){Object.defineProperty(C,"velocity",{get:function(){return P.getVelocityAtTime(P.comp.currentFrame)}}),C.numKeys=P.keyframes?P.keyframes.length:0,C.key=function(B){if(!C.numKeys)return 0;var _t="";"s"in P.keyframes[B-1]?_t=P.keyframes[B-1].s:"e"in P.keyframes[B-2]?_t=P.keyframes[B-2].e:_t=P.keyframes[B-2].s;var ue=x==="unidimensional"?new Number(_t):Object.assign({},_t);return ue.time=P.keyframes[B-1].t/P.elem.comp.globalData.frameRate,ue.value=x==="unidimensional"?_t[0]:_t,ue},C.valueAtTime=P.getValueAtTime,C.speedAtTime=P.getSpeedAtTime,C.velocityAtTime=P.getVelocityAtTime,C.propertyGroup=P.propertyGroup}function d(C){(!C||!("pv"in C))&&(C=e);var P=1/C.mult,x=C.pv*P,B=new Number(x);return B.value=x,s(B,C,"unidimensional"),function(){return C.k&&C.getValue(),x=C.v*P,B.value!==x&&(B=new Number(x),B.value=x,s(B,C,"unidimensional")),B}}function f(C){(!C||!("pv"in C))&&(C=r);var P=1/C.mult,x=C.data&&C.data.l||C.pv.length,B=createTypedArray("float32",x),_t=createTypedArray("float32",x);return B.value=_t,s(B,C,"multidimensional"),function(){C.k&&C.getValue();for(var ue=0;ue<x;ue+=1)_t[ue]=C.v[ue]*P,B[ue]=_t[ue];return B}}function _(){return e}return function(C){return C?C.propType==="unidimensional"?d(C):f(C):_}}(),TransformExpressionInterface=function(){return function(e){function r(C){switch(C){case"scale":case"Scale":case"ADBE Scale":case 6:return r.scale;case"rotation":case"Rotation":case"ADBE Rotation":case"ADBE Rotate Z":case 10:return r.rotation;case"ADBE Rotate X":return r.xRotation;case"ADBE Rotate Y":return r.yRotation;case"position":case"Position":case"ADBE Position":case 2:return r.position;case"ADBE Position_0":return r.xPosition;case"ADBE Position_1":return r.yPosition;case"ADBE Position_2":return r.zPosition;case"anchorPoint":case"AnchorPoint":case"Anchor Point":case"ADBE AnchorPoint":case 1:return r.anchorPoint;case"opacity":case"Opacity":case 11:return r.opacity;default:return null}}Object.defineProperty(r,"rotation",{get:ExpressionPropertyInterface(e.r||e.rz)}),Object.defineProperty(r,"zRotation",{get:ExpressionPropertyInterface(e.rz||e.r)}),Object.defineProperty(r,"xRotation",{get:ExpressionPropertyInterface(e.rx)}),Object.defineProperty(r,"yRotation",{get:ExpressionPropertyInterface(e.ry)}),Object.defineProperty(r,"scale",{get:ExpressionPropertyInterface(e.s)});var s,d,f,_;return e.p?_=ExpressionPropertyInterface(e.p):(s=ExpressionPropertyInterface(e.px),d=ExpressionPropertyInterface(e.py),e.pz&&(f=ExpressionPropertyInterface(e.pz))),Object.defineProperty(r,"position",{get:function(){return e.p?_():[s(),d(),f?f():0]}}),Object.defineProperty(r,"xPosition",{get:ExpressionPropertyInterface(e.px)}),Object.defineProperty(r,"yPosition",{get:ExpressionPropertyInterface(e.py)}),Object.defineProperty(r,"zPosition",{get:ExpressionPropertyInterface(e.pz)}),Object.defineProperty(r,"anchorPoint",{get:ExpressionPropertyInterface(e.a)}),Object.defineProperty(r,"opacity",{get:ExpressionPropertyInterface(e.o)}),Object.defineProperty(r,"skew",{get:ExpressionPropertyInterface(e.sk)}),Object.defineProperty(r,"skewAxis",{get:ExpressionPropertyInterface(e.sa)}),Object.defineProperty(r,"orientation",{get:ExpressionPropertyInterface(e.or)}),r}}(),LayerExpressionInterface=function(){function e(B){var _t=new Matrix;if(B!==void 0){var ue=this._elem.finalTransform.mProp.getValueAtTime(B);ue.clone(_t)}else{var Wt=this._elem.finalTransform.mProp;Wt.applyToMatrix(_t)}return _t}function r(B,_t){var ue=this.getMatrix(_t);return ue.props[12]=0,ue.props[13]=0,ue.props[14]=0,this.applyPoint(ue,B)}function s(B,_t){var ue=this.getMatrix(_t);return this.applyPoint(ue,B)}function d(B,_t){var ue=this.getMatrix(_t);return ue.props[12]=0,ue.props[13]=0,ue.props[14]=0,this.invertPoint(ue,B)}function f(B,_t){var ue=this.getMatrix(_t);return this.invertPoint(ue,B)}function _(B,_t){if(this._elem.hierarchy&&this._elem.hierarchy.length){var ue,Wt=this._elem.hierarchy.length;for(ue=0;ue<Wt;ue+=1)this._elem.hierarchy[ue].finalTransform.mProp.applyToMatrix(B)}return B.applyToPointArray(_t[0],_t[1],_t[2]||0)}function C(B,_t){if(this._elem.hierarchy&&this._elem.hierarchy.length){var ue,Wt=this._elem.hierarchy.length;for(ue=0;ue<Wt;ue+=1)this._elem.hierarchy[ue].finalTransform.mProp.applyToMatrix(B)}return B.inversePoint(_t)}function P(B){var _t=new Matrix;if(_t.reset(),this._elem.finalTransform.mProp.applyToMatrix(_t),this._elem.hierarchy&&this._elem.hierarchy.length){var ue,Wt=this._elem.hierarchy.length;for(ue=0;ue<Wt;ue+=1)this._elem.hierarchy[ue].finalTransform.mProp.applyToMatrix(_t);return _t.inversePoint(B)}return _t.inversePoint(B)}function x(){return[1,1,1,1]}return function(B){var _t;function ue(Ei){_n.mask=new MaskManagerInterface(Ei,B)}function Wt(Ei){_n.effect=Ei}function _n(Ei){switch(Ei){case"ADBE Root Vectors Group":case"Contents":case 2:return _n.shapeInterface;case 1:case 6:case"Transform":case"transform":case"ADBE Transform Group":return _t;case 4:case"ADBE Effect Parade":case"effects":case"Effects":return _n.effect;case"ADBE Text Properties":return _n.textInterface;default:return null}}_n.getMatrix=e,_n.invertPoint=C,_n.applyPoint=_,_n.toWorld=s,_n.toWorldVec=r,_n.fromWorld=f,_n.fromWorldVec=d,_n.toComp=s,_n.fromComp=P,_n.sampleImage=x,_n.sourceRectAtTime=B.sourceRectAtTime.bind(B),_n._elem=B,_t=TransformExpressionInterface(B.finalTransform.mProp);var _i=getDescriptor(_t,"anchorPoint");return Object.defineProperties(_n,{hasParent:{get:function(){return B.hierarchy.length}},parent:{get:function(){return B.hierarchy[0].layerInterface}},rotation:getDescriptor(_t,"rotation"),scale:getDescriptor(_t,"scale"),position:getDescriptor(_t,"position"),opacity:getDescriptor(_t,"opacity"),anchorPoint:_i,anchor_point:_i,transform:{get:function(){return _t}},active:{get:function(){return B.isInRange}}}),_n.startTime=B.data.st,_n.index=B.data.ind,_n.source=B.data.refId,_n.height=B.data.ty===0?B.data.h:100,_n.width=B.data.ty===0?B.data.w:100,_n.inPoint=B.data.ip/B.comp.globalData.frameRate,_n.outPoint=B.data.op/B.comp.globalData.frameRate,_n._name=B.data.nm,_n.registerMaskInterface=ue,_n.registerEffectsInterface=Wt,_n}}(),propertyGroupFactory=function(){return function(e,r){return function(s){return s=s===void 0?1:s,s<=0?e:r(s-1)}}}(),PropertyInterface=function(){return function(e,r){var s={_name:e};function d(f){return f=f===void 0?1:f,f<=0?s:r(f-1)}return d}}(),EffectsExpressionInterface=function(){var e={createEffectsInterface:r};function r(f,_){if(f.effectsManager){var C=[],P=f.data.ef,x,B=f.effectsManager.effectElements.length;for(x=0;x<B;x+=1)C.push(s(P[x],f.effectsManager.effectElements[x],_,f));var _t=f.data.ef||[],ue=function(_n){for(x=0,B=_t.length;x<B;){if(_n===_t[x].nm||_n===_t[x].mn||_n===_t[x].ix)return C[x];x+=1}return null};return Object.defineProperty(ue,"numProperties",{get:function(){return _t.length}}),ue}return null}function s(f,_,C,P){function x(_n){for(var _i=f.ef,Ei=0,_a=_i.length;Ei<_a;){if(_n===_i[Ei].nm||_n===_i[Ei].mn||_n===_i[Ei].ix)return _i[Ei].ty===5?_t[Ei]:_t[Ei]();Ei+=1}throw new Error}var B=propertyGroupFactory(x,C),_t=[],ue,Wt=f.ef.length;for(ue=0;ue<Wt;ue+=1)f.ef[ue].ty===5?_t.push(s(f.ef[ue],_.effectElements[ue],_.effectElements[ue].propertyGroup,P)):_t.push(d(_.effectElements[ue],f.ef[ue].ty,P,B));return f.mn==="ADBE Color Control"&&Object.defineProperty(x,"color",{get:function(){return _t[0]()}}),Object.defineProperties(x,{numProperties:{get:function(){return f.np}},_name:{value:f.nm},propertyGroup:{value:B}}),x.enabled=f.en!==0,x.active=x.enabled,x}function d(f,_,C,P){var x=ExpressionPropertyInterface(f.p);function B(){return _===10?C.comp.compInterface(f.p.v):x()}return f.p.setGroupProperty&&f.p.setGroupProperty(PropertyInterface("",P)),B}return e}(),ShapePathInterface=function(){return function(r,s,d){var f=s.sh;function _(P){return P==="Shape"||P==="shape"||P==="Path"||P==="path"||P==="ADBE Vector Shape"||P===2?_.path:null}var C=propertyGroupFactory(_,d);return f.setGroupProperty(PropertyInterface("Path",C)),Object.defineProperties(_,{path:{get:function(){return f.k&&f.getValue(),f}},shape:{get:function(){return f.k&&f.getValue(),f}},_name:{value:r.nm},ix:{value:r.ix},propertyIndex:{value:r.ix},mn:{value:r.mn},propertyGroup:{value:d}}),_}}(),ShapeExpressionInterface=function(){function e(_i,Ei,_a){var Di=[],_o,_s=_i?_i.length:0;for(_o=0;_o<_s;_o+=1)_i[_o].ty==="gr"?Di.push(s(_i[_o],Ei[_o],_a)):_i[_o].ty==="fl"?Di.push(d(_i[_o],Ei[_o],_a)):_i[_o].ty==="st"?Di.push(C(_i[_o],Ei[_o],_a)):_i[_o].ty==="tm"?Di.push(P(_i[_o],Ei[_o],_a)):_i[_o].ty==="tr"||(_i[_o].ty==="el"?Di.push(B(_i[_o],Ei[_o],_a)):_i[_o].ty==="sr"?Di.push(_t(_i[_o],Ei[_o],_a)):_i[_o].ty==="sh"?Di.push(ShapePathInterface(_i[_o],Ei[_o],_a)):_i[_o].ty==="rc"?Di.push(ue(_i[_o],Ei[_o],_a)):_i[_o].ty==="rd"?Di.push(Wt(_i[_o],Ei[_o],_a)):_i[_o].ty==="rp"?Di.push(_n(_i[_o],Ei[_o],_a)):_i[_o].ty==="gf"?Di.push(f(_i[_o],Ei[_o],_a)):Di.push(_(_i[_o],Ei[_o])));return Di}function r(_i,Ei,_a){var Di,_o=function(_m){for(var Qm=0,tE=Di.length;Qm<tE;){if(Di[Qm]._name===_m||Di[Qm].mn===_m||Di[Qm].propertyIndex===_m||Di[Qm].ix===_m||Di[Qm].ind===_m)return Di[Qm];Qm+=1}return typeof _m=="number"?Di[_m-1]:null};_o.propertyGroup=propertyGroupFactory(_o,_a),Di=e(_i.it,Ei.it,_o.propertyGroup),_o.numProperties=Di.length;var _s=x(_i.it[_i.it.length-1],Ei.it[Ei.it.length-1],_o.propertyGroup);return _o.transform=_s,_o.propertyIndex=_i.cix,_o._name=_i.nm,_o}function s(_i,Ei,_a){var Di=function(_m){switch(_m){case"ADBE Vectors Group":case"Contents":case 2:return Di.content;default:return Di.transform}};Di.propertyGroup=propertyGroupFactory(Di,_a);var _o=r(_i,Ei,Di.propertyGroup),_s=x(_i.it[_i.it.length-1],Ei.it[Ei.it.length-1],Di.propertyGroup);return Di.content=_o,Di.transform=_s,Object.defineProperty(Di,"_name",{get:function(){return _i.nm}}),Di.numProperties=_i.np,Di.propertyIndex=_i.ix,Di.nm=_i.nm,Di.mn=_i.mn,Di}function d(_i,Ei,_a){function Di(_o){return _o==="Color"||_o==="color"?Di.color:_o==="Opacity"||_o==="opacity"?Di.opacity:null}return Object.defineProperties(Di,{color:{get:ExpressionPropertyInterface(Ei.c)},opacity:{get:ExpressionPropertyInterface(Ei.o)},_name:{value:_i.nm},mn:{value:_i.mn}}),Ei.c.setGroupProperty(PropertyInterface("Color",_a)),Ei.o.setGroupProperty(PropertyInterface("Opacity",_a)),Di}function f(_i,Ei,_a){function Di(_o){return _o==="Start Point"||_o==="start point"?Di.startPoint:_o==="End Point"||_o==="end point"?Di.endPoint:_o==="Opacity"||_o==="opacity"?Di.opacity:null}return Object.defineProperties(Di,{startPoint:{get:ExpressionPropertyInterface(Ei.s)},endPoint:{get:ExpressionPropertyInterface(Ei.e)},opacity:{get:ExpressionPropertyInterface(Ei.o)},type:{get:function(){return"a"}},_name:{value:_i.nm},mn:{value:_i.mn}}),Ei.s.setGroupProperty(PropertyInterface("Start Point",_a)),Ei.e.setGroupProperty(PropertyInterface("End Point",_a)),Ei.o.setGroupProperty(PropertyInterface("Opacity",_a)),Di}function _(){function _i(){return null}return _i}function C(_i,Ei,_a){var Di=propertyGroupFactory(tE,_a),_o=propertyGroupFactory(Qm,Di);function _s(aE){Object.defineProperty(Qm,_i.d[aE].nm,{get:ExpressionPropertyInterface(Ei.d.dataProps[aE].p)})}var _c,_m=_i.d?_i.d.length:0,Qm={};for(_c=0;_c<_m;_c+=1)_s(_c),Ei.d.dataProps[_c].p.setGroupProperty(_o);function tE(aE){return aE==="Color"||aE==="color"?tE.color:aE==="Opacity"||aE==="opacity"?tE.opacity:aE==="Stroke Width"||aE==="stroke width"?tE.strokeWidth:null}return Object.defineProperties(tE,{color:{get:ExpressionPropertyInterface(Ei.c)},opacity:{get:ExpressionPropertyInterface(Ei.o)},strokeWidth:{get:ExpressionPropertyInterface(Ei.w)},dash:{get:function(){return Qm}},_name:{value:_i.nm},mn:{value:_i.mn}}),Ei.c.setGroupProperty(PropertyInterface("Color",Di)),Ei.o.setGroupProperty(PropertyInterface("Opacity",Di)),Ei.w.setGroupProperty(PropertyInterface("Stroke Width",Di)),tE}function P(_i,Ei,_a){function Di(_s){return _s===_i.e.ix||_s==="End"||_s==="end"?Di.end:_s===_i.s.ix?Di.start:_s===_i.o.ix?Di.offset:null}var _o=propertyGroupFactory(Di,_a);return Di.propertyIndex=_i.ix,Ei.s.setGroupProperty(PropertyInterface("Start",_o)),Ei.e.setGroupProperty(PropertyInterface("End",_o)),Ei.o.setGroupProperty(PropertyInterface("Offset",_o)),Di.propertyIndex=_i.ix,Di.propertyGroup=_a,Object.defineProperties(Di,{start:{get:ExpressionPropertyInterface(Ei.s)},end:{get:ExpressionPropertyInterface(Ei.e)},offset:{get:ExpressionPropertyInterface(Ei.o)},_name:{value:_i.nm}}),Di.mn=_i.mn,Di}function x(_i,Ei,_a){function Di(_s){return _i.a.ix===_s||_s==="Anchor Point"?Di.anchorPoint:_i.o.ix===_s||_s==="Opacity"?Di.opacity:_i.p.ix===_s||_s==="Position"?Di.position:_i.r.ix===_s||_s==="Rotation"||_s==="ADBE Vector Rotation"?Di.rotation:_i.s.ix===_s||_s==="Scale"?Di.scale:_i.sk&&_i.sk.ix===_s||_s==="Skew"?Di.skew:_i.sa&&_i.sa.ix===_s||_s==="Skew Axis"?Di.skewAxis:null}var _o=propertyGroupFactory(Di,_a);return Ei.transform.mProps.o.setGroupProperty(PropertyInterface("Opacity",_o)),Ei.transform.mProps.p.setGroupProperty(PropertyInterface("Position",_o)),Ei.transform.mProps.a.setGroupProperty(PropertyInterface("Anchor Point",_o)),Ei.transform.mProps.s.setGroupProperty(PropertyInterface("Scale",_o)),Ei.transform.mProps.r.setGroupProperty(PropertyInterface("Rotation",_o)),Ei.transform.mProps.sk&&(Ei.transform.mProps.sk.setGroupProperty(PropertyInterface("Skew",_o)),Ei.transform.mProps.sa.setGroupProperty(PropertyInterface("Skew Angle",_o))),Ei.transform.op.setGroupProperty(PropertyInterface("Opacity",_o)),Object.defineProperties(Di,{opacity:{get:ExpressionPropertyInterface(Ei.transform.mProps.o)},position:{get:ExpressionPropertyInterface(Ei.transform.mProps.p)},anchorPoint:{get:ExpressionPropertyInterface(Ei.transform.mProps.a)},scale:{get:ExpressionPropertyInterface(Ei.transform.mProps.s)},rotation:{get:ExpressionPropertyInterface(Ei.transform.mProps.r)},skew:{get:ExpressionPropertyInterface(Ei.transform.mProps.sk)},skewAxis:{get:ExpressionPropertyInterface(Ei.transform.mProps.sa)},_name:{value:_i.nm}}),Di.ty="tr",Di.mn=_i.mn,Di.propertyGroup=_a,Di}function B(_i,Ei,_a){function Di(_c){return _i.p.ix===_c?Di.position:_i.s.ix===_c?Di.size:null}var _o=propertyGroupFactory(Di,_a);Di.propertyIndex=_i.ix;var _s=Ei.sh.ty==="tm"?Ei.sh.prop:Ei.sh;return _s.s.setGroupProperty(PropertyInterface("Size",_o)),_s.p.setGroupProperty(PropertyInterface("Position",_o)),Object.defineProperties(Di,{size:{get:ExpressionPropertyInterface(_s.s)},position:{get:ExpressionPropertyInterface(_s.p)},_name:{value:_i.nm}}),Di.mn=_i.mn,Di}function _t(_i,Ei,_a){function Di(_c){return _i.p.ix===_c?Di.position:_i.r.ix===_c?Di.rotation:_i.pt.ix===_c?Di.points:_i.or.ix===_c||_c==="ADBE Vector Star Outer Radius"?Di.outerRadius:_i.os.ix===_c?Di.outerRoundness:_i.ir&&(_i.ir.ix===_c||_c==="ADBE Vector Star Inner Radius")?Di.innerRadius:_i.is&&_i.is.ix===_c?Di.innerRoundness:null}var _o=propertyGroupFactory(Di,_a),_s=Ei.sh.ty==="tm"?Ei.sh.prop:Ei.sh;return Di.propertyIndex=_i.ix,_s.or.setGroupProperty(PropertyInterface("Outer Radius",_o)),_s.os.setGroupProperty(PropertyInterface("Outer Roundness",_o)),_s.pt.setGroupProperty(PropertyInterface("Points",_o)),_s.p.setGroupProperty(PropertyInterface("Position",_o)),_s.r.setGroupProperty(PropertyInterface("Rotation",_o)),_i.ir&&(_s.ir.setGroupProperty(PropertyInterface("Inner Radius",_o)),_s.is.setGroupProperty(PropertyInterface("Inner Roundness",_o))),Object.defineProperties(Di,{position:{get:ExpressionPropertyInterface(_s.p)},rotation:{get:ExpressionPropertyInterface(_s.r)},points:{get:ExpressionPropertyInterface(_s.pt)},outerRadius:{get:ExpressionPropertyInterface(_s.or)},outerRoundness:{get:ExpressionPropertyInterface(_s.os)},innerRadius:{get:ExpressionPropertyInterface(_s.ir)},innerRoundness:{get:ExpressionPropertyInterface(_s.is)},_name:{value:_i.nm}}),Di.mn=_i.mn,Di}function ue(_i,Ei,_a){function Di(_c){return _i.p.ix===_c?Di.position:_i.r.ix===_c?Di.roundness:_i.s.ix===_c||_c==="Size"||_c==="ADBE Vector Rect Size"?Di.size:null}var _o=propertyGroupFactory(Di,_a),_s=Ei.sh.ty==="tm"?Ei.sh.prop:Ei.sh;return Di.propertyIndex=_i.ix,_s.p.setGroupProperty(PropertyInterface("Position",_o)),_s.s.setGroupProperty(PropertyInterface("Size",_o)),_s.r.setGroupProperty(PropertyInterface("Rotation",_o)),Object.defineProperties(Di,{position:{get:ExpressionPropertyInterface(_s.p)},roundness:{get:ExpressionPropertyInterface(_s.r)},size:{get:ExpressionPropertyInterface(_s.s)},_name:{value:_i.nm}}),Di.mn=_i.mn,Di}function Wt(_i,Ei,_a){function Di(_c){return _i.r.ix===_c||_c==="Round Corners 1"?Di.radius:null}var _o=propertyGroupFactory(Di,_a),_s=Ei;return Di.propertyIndex=_i.ix,_s.rd.setGroupProperty(PropertyInterface("Radius",_o)),Object.defineProperties(Di,{radius:{get:ExpressionPropertyInterface(_s.rd)},_name:{value:_i.nm}}),Di.mn=_i.mn,Di}function _n(_i,Ei,_a){function Di(_c){return _i.c.ix===_c||_c==="Copies"?Di.copies:_i.o.ix===_c||_c==="Offset"?Di.offset:null}var _o=propertyGroupFactory(Di,_a),_s=Ei;return Di.propertyIndex=_i.ix,_s.c.setGroupProperty(PropertyInterface("Copies",_o)),_s.o.setGroupProperty(PropertyInterface("Offset",_o)),Object.defineProperties(Di,{copies:{get:ExpressionPropertyInterface(_s.c)},offset:{get:ExpressionPropertyInterface(_s.o)},_name:{value:_i.nm}}),Di.mn=_i.mn,Di}return function(_i,Ei,_a){var Di;function _o(_c){if(typeof _c=="number")return _c=_c===void 0?1:_c,_c===0?_a:Di[_c-1];for(var _m=0,Qm=Di.length;_m<Qm;){if(Di[_m]._name===_c)return Di[_m];_m+=1}return null}function _s(){return _a}return _o.propertyGroup=propertyGroupFactory(_o,_s),Di=e(_i,Ei,_o.propertyGroup),_o.numProperties=Di.length,_o._name="Contents",_o}}(),TextExpressionInterface=function(){return function(e){var r;function s(d){switch(d){case"ADBE Text Document":return s.sourceText;default:return null}}return Object.defineProperty(s,"sourceText",{get:function(){e.textProperty.getValue();var f=e.textProperty.currentData.t;return(!r||f!==r.value)&&(r=new String(f),r.value=f||new String(f),Object.defineProperty(r,"style",{get:function(){return{fillColor:e.textProperty.currentData.fc}}})),r}}),s}}();function _typeof(e){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?_typeof=function(s){return typeof s}:_typeof=function(s){return s&&typeof Symbol=="function"&&s.constructor===Symbol&&s!==Symbol.prototype?"symbol":typeof s},_typeof(e)}var FootageInterface=function(){var e=function(d){var f="",_=d.getFootageData();function C(){return f="",_=d.getFootageData(),P}function P(x){if(_[x])return f=x,_=_[x],_typeof(_)==="object"?P:_;var B=x.indexOf(f);if(B!==-1){var _t=parseInt(x.substr(B+f.length),10);return _=_[_t],_typeof(_)==="object"?P:_}return""}return C},r=function(d){function f(_){return _==="Outline"?f.outlineInterface():null}return f._name="Outline",f.outlineInterface=e(d),f};return function(s){function d(f){return f==="Data"?d.dataInterface:null}return d._name="Data",d.dataInterface=r(s),d}}(),interfaces={layer:LayerExpressionInterface,effects:EffectsExpressionInterface,comp:CompExpressionInterface,shape:ShapeExpressionInterface,text:TextExpressionInterface,footage:FootageInterface};function getInterface(e){return interfaces[e]||null}var expressionHelpers=function(){function e(C,P,x){P.x&&(x.k=!0,x.x=!0,x.initiateExpression=ExpressionManager.initiateExpression,x.effectsSequence.push(x.initiateExpression(C,P,x).bind(x)))}function r(C){return C*=this.elem.globalData.frameRate,C-=this.offsetTime,C!==this._cachingAtTime.lastFrame&&(this._cachingAtTime.lastIndex=this._cachingAtTime.lastFrame<C?this._cachingAtTime.lastIndex:0,this._cachingAtTime.value=this.interpolateValue(C,this._cachingAtTime),this._cachingAtTime.lastFrame=C),this._cachingAtTime.value}function s(C){var P=-.01,x=this.getValueAtTime(C),B=this.getValueAtTime(C+P),_t=0;if(x.length){var ue;for(ue=0;ue<x.length;ue+=1)_t+=Math.pow(B[ue]-x[ue],2);_t=Math.sqrt(_t)*100}else _t=0;return _t}function d(C){if(this.vel!==void 0)return this.vel;var P=-.001,x=this.getValueAtTime(C),B=this.getValueAtTime(C+P),_t;if(x.length){_t=createTypedArray("float32",x.length);var ue;for(ue=0;ue<x.length;ue+=1)_t[ue]=(B[ue]-x[ue])/P}else _t=(B-x)/P;return _t}function f(){return this.pv}function _(C){this.propertyGroup=C}return{searchExpressions:e,getSpeedAtTime:s,getVelocityAtTime:d,getValueAtTime:r,getStaticValueAtTime:f,setGroupProperty:_}}();function addPropertyDecorator(){function e(Wt,_n,_i){if(!this.k||!this.keyframes)return this.pv;Wt=Wt?Wt.toLowerCase():"";var Ei=this.comp.renderedFrame,_a=this.keyframes,Di=_a[_a.length-1].t;if(Ei<=Di)return this.pv;var _o,_s;_i?(_n?_o=Math.abs(Di-this.elem.comp.globalData.frameRate*_n):_o=Math.max(0,Di-this.elem.data.ip),_s=Di-_o):((!_n||_n>_a.length-1)&&(_n=_a.length-1),_s=_a[_a.length-1-_n].t,_o=Di-_s);var _c,_m,Qm;if(Wt==="pingpong"){var tE=Math.floor((Ei-_s)/_o);if(tE%2!==0)return this.getValueAtTime((_o-(Ei-_s)%_o+_s)/this.comp.globalData.frameRate,0)}else if(Wt==="offset"){var aE=this.getValueAtTime(_s/this.comp.globalData.frameRate,0),CE=this.getValueAtTime(Di/this.comp.globalData.frameRate,0),lE=this.getValueAtTime(((Ei-_s)%_o+_s)/this.comp.globalData.frameRate,0),gE=Math.floor((Ei-_s)/_o);if(this.pv.length){for(Qm=new Array(aE.length),_m=Qm.length,_c=0;_c<_m;_c+=1)Qm[_c]=(CE[_c]-aE[_c])*gE+lE[_c];return Qm}return(CE-aE)*gE+lE}else if(Wt==="continue"){var cE=this.getValueAtTime(Di/this.comp.globalData.frameRate,0),_E=this.getValueAtTime((Di-.001)/this.comp.globalData.frameRate,0);if(this.pv.length){for(Qm=new Array(cE.length),_m=Qm.length,_c=0;_c<_m;_c+=1)Qm[_c]=cE[_c]+(cE[_c]-_E[_c])*((Ei-Di)/this.comp.globalData.frameRate)/5e-4;return Qm}return cE+(cE-_E)*((Ei-Di)/.001)}return this.getValueAtTime(((Ei-_s)%_o+_s)/this.comp.globalData.frameRate,0)}function r(Wt,_n,_i){if(!this.k)return this.pv;Wt=Wt?Wt.toLowerCase():"";var Ei=this.comp.renderedFrame,_a=this.keyframes,Di=_a[0].t;if(Ei>=Di)return this.pv;var _o,_s;_i?(_n?_o=Math.abs(this.elem.comp.globalData.frameRate*_n):_o=Math.max(0,this.elem.data.op-Di),_s=Di+_o):((!_n||_n>_a.length-1)&&(_n=_a.length-1),_s=_a[_n].t,_o=_s-Di);var _c,_m,Qm;if(Wt==="pingpong"){var tE=Math.floor((Di-Ei)/_o);if(tE%2===0)return this.getValueAtTime(((Di-Ei)%_o+Di)/this.comp.globalData.frameRate,0)}else if(Wt==="offset"){var aE=this.getValueAtTime(Di/this.comp.globalData.frameRate,0),CE=this.getValueAtTime(_s/this.comp.globalData.frameRate,0),lE=this.getValueAtTime((_o-(Di-Ei)%_o+Di)/this.comp.globalData.frameRate,0),gE=Math.floor((Di-Ei)/_o)+1;if(this.pv.length){for(Qm=new Array(aE.length),_m=Qm.length,_c=0;_c<_m;_c+=1)Qm[_c]=lE[_c]-(CE[_c]-aE[_c])*gE;return Qm}return lE-(CE-aE)*gE}else if(Wt==="continue"){var cE=this.getValueAtTime(Di/this.comp.globalData.frameRate,0),_E=this.getValueAtTime((Di+.001)/this.comp.globalData.frameRate,0);if(this.pv.length){for(Qm=new Array(cE.length),_m=Qm.length,_c=0;_c<_m;_c+=1)Qm[_c]=cE[_c]+(cE[_c]-_E[_c])*(Di-Ei)/.001;return Qm}return cE+(cE-_E)*(Di-Ei)/.001}return this.getValueAtTime((_o-((Di-Ei)%_o+Di))/this.comp.globalData.frameRate,0)}function s(Wt,_n){if(!this.k)return this.pv;if(Wt=(Wt||.4)*.5,_n=Math.floor(_n||5),_n<=1)return this.pv;var _i=this.comp.renderedFrame/this.comp.globalData.frameRate,Ei=_i-Wt,_a=_i+Wt,Di=_n>1?(_a-Ei)/(_n-1):1,_o=0,_s=0,_c;this.pv.length?_c=createTypedArray("float32",this.pv.length):_c=0;for(var _m;_o<_n;){if(_m=this.getValueAtTime(Ei+_o*Di),this.pv.length)for(_s=0;_s<this.pv.length;_s+=1)_c[_s]+=_m[_s];else _c+=_m;_o+=1}if(this.pv.length)for(_s=0;_s<this.pv.length;_s+=1)_c[_s]/=_n;else _c/=_n;return _c}function d(Wt){this._transformCachingAtTime||(this._transformCachingAtTime={v:new Matrix});var _n=this._transformCachingAtTime.v;if(_n.cloneFromProps(this.pre.props),this.appliedTransformations<1){var _i=this.a.getValueAtTime(Wt);_n.translate(-_i[0]*this.a.mult,-_i[1]*this.a.mult,_i[2]*this.a.mult)}if(this.appliedTransformations<2){var Ei=this.s.getValueAtTime(Wt);_n.scale(Ei[0]*this.s.mult,Ei[1]*this.s.mult,Ei[2]*this.s.mult)}if(this.sk&&this.appliedTransformations<3){var _a=this.sk.getValueAtTime(Wt),Di=this.sa.getValueAtTime(Wt);_n.skewFromAxis(-_a*this.sk.mult,Di*this.sa.mult)}if(this.r&&this.appliedTransformations<4){var _o=this.r.getValueAtTime(Wt);_n.rotate(-_o*this.r.mult)}else if(!this.r&&this.appliedTransformations<4){var _s=this.rz.getValueAtTime(Wt),_c=this.ry.getValueAtTime(Wt),_m=this.rx.getValueAtTime(Wt),Qm=this.or.getValueAtTime(Wt);_n.rotateZ(-_s*this.rz.mult).rotateY(_c*this.ry.mult).rotateX(_m*this.rx.mult).rotateZ(-Qm[2]*this.or.mult).rotateY(Qm[1]*this.or.mult).rotateX(Qm[0]*this.or.mult)}if(this.data.p&&this.data.p.s){var tE=this.px.getValueAtTime(Wt),aE=this.py.getValueAtTime(Wt);if(this.data.p.z){var CE=this.pz.getValueAtTime(Wt);_n.translate(tE*this.px.mult,aE*this.py.mult,-CE*this.pz.mult)}else _n.translate(tE*this.px.mult,aE*this.py.mult,0)}else{var lE=this.p.getValueAtTime(Wt);_n.translate(lE[0]*this.p.mult,lE[1]*this.p.mult,-lE[2]*this.p.mult)}return _n}function f(){return this.v.clone(new Matrix)}var _=TransformPropertyFactory.getTransformProperty;TransformPropertyFactory.getTransformProperty=function(Wt,_n,_i){var Ei=_(Wt,_n,_i);return Ei.dynamicProperties.length?Ei.getValueAtTime=d.bind(Ei):Ei.getValueAtTime=f.bind(Ei),Ei.setGroupProperty=expressionHelpers.setGroupProperty,Ei};var C=PropertyFactory.getProp;PropertyFactory.getProp=function(Wt,_n,_i,Ei,_a){var Di=C(Wt,_n,_i,Ei,_a);Di.kf?Di.getValueAtTime=expressionHelpers.getValueAtTime.bind(Di):Di.getValueAtTime=expressionHelpers.getStaticValueAtTime.bind(Di),Di.setGroupProperty=expressionHelpers.setGroupProperty,Di.loopOut=e,Di.loopIn=r,Di.smooth=s,Di.getVelocityAtTime=expressionHelpers.getVelocityAtTime.bind(Di),Di.getSpeedAtTime=expressionHelpers.getSpeedAtTime.bind(Di),Di.numKeys=_n.a===1?_n.k.length:0,Di.propertyIndex=_n.ix;var _o=0;return _i!==0&&(_o=createTypedArray("float32",_n.a===1?_n.k[0].s.length:_n.k.length)),Di._cachingAtTime={lastFrame:initialDefaultFrame,lastIndex:0,value:_o},expressionHelpers.searchExpressions(Wt,_n,Di),Di.k&&_a.addDynamicProperty(Di),Di};function P(Wt){return this._cachingAtTime||(this._cachingAtTime={shapeValue:shapePool.clone(this.pv),lastIndex:0,lastTime:initialDefaultFrame}),Wt*=this.elem.globalData.frameRate,Wt-=this.offsetTime,Wt!==this._cachingAtTime.lastTime&&(this._cachingAtTime.lastIndex=this._cachingAtTime.lastTime<Wt?this._caching.lastIndex:0,this._cachingAtTime.lastTime=Wt,this.interpolateShape(Wt,this._cachingAtTime.shapeValue,this._cachingAtTime)),this._cachingAtTime.shapeValue}var x=ShapePropertyFactory.getConstructorFunction(),B=ShapePropertyFactory.getKeyframedConstructorFunction();function _t(){}_t.prototype={vertices:function(_n,_i){this.k&&this.getValue();var Ei=this.v;_i!==void 0&&(Ei=this.getValueAtTime(_i,0));var _a,Di=Ei._length,_o=Ei[_n],_s=Ei.v,_c=createSizedArray(Di);for(_a=0;_a<Di;_a+=1)_n==="i"||_n==="o"?_c[_a]=[_o[_a][0]-_s[_a][0],_o[_a][1]-_s[_a][1]]:_c[_a]=[_o[_a][0],_o[_a][1]];return _c},points:function(_n){return this.vertices("v",_n)},inTangents:function(_n){return this.vertices("i",_n)},outTangents:function(_n){return this.vertices("o",_n)},isClosed:function(){return this.v.c},pointOnPath:function(_n,_i){var Ei=this.v;_i!==void 0&&(Ei=this.getValueAtTime(_i,0)),this._segmentsLength||(this._segmentsLength=bez.getSegmentsLength(Ei));for(var _a=this._segmentsLength,Di=_a.lengths,_o=_a.totalLength*_n,_s=0,_c=Di.length,_m=0,Qm;_s<_c;){if(_m+Di[_s].addedLength>_o){var tE=_s,aE=Ei.c&&_s===_c-1?0:_s+1,CE=(_o-_m)/Di[_s].addedLength;Qm=bez.getPointInSegment(Ei.v[tE],Ei.v[aE],Ei.o[tE],Ei.i[aE],CE,Di[_s]);break}else _m+=Di[_s].addedLength;_s+=1}return Qm||(Qm=Ei.c?[Ei.v[0][0],Ei.v[0][1]]:[Ei.v[Ei._length-1][0],Ei.v[Ei._length-1][1]]),Qm},vectorOnPath:function(_n,_i,Ei){_n==1?_n=this.v.c:_n==0&&(_n=.999);var _a=this.pointOnPath(_n,_i),Di=this.pointOnPath(_n+.001,_i),_o=Di[0]-_a[0],_s=Di[1]-_a[1],_c=Math.sqrt(Math.pow(_o,2)+Math.pow(_s,2));if(_c===0)return[0,0];var _m=Ei==="tangent"?[_o/_c,_s/_c]:[-_s/_c,_o/_c];return _m},tangentOnPath:function(_n,_i){return this.vectorOnPath(_n,_i,"tangent")},normalOnPath:function(_n,_i){return this.vectorOnPath(_n,_i,"normal")},setGroupProperty:expressionHelpers.setGroupProperty,getValueAtTime:expressionHelpers.getStaticValueAtTime},extendPrototype([_t],x),extendPrototype([_t],B),B.prototype.getValueAtTime=P,B.prototype.initiateExpression=ExpressionManager.initiateExpression;var ue=ShapePropertyFactory.getShapeProp;ShapePropertyFactory.getShapeProp=function(Wt,_n,_i,Ei,_a){var Di=ue(Wt,_n,_i,Ei,_a);return Di.propertyIndex=_n.ix,Di.lock=!1,_i===3?expressionHelpers.searchExpressions(Wt,_n.pt,Di):_i===4&&expressionHelpers.searchExpressions(Wt,_n.ks,Di),Di.k&&Wt.addDynamicProperty(Di),Di}}function initialize$1(){addPropertyDecorator()}function addDecorator(){function e(){return this.data.d.x?(this.calculateExpression=ExpressionManager.initiateExpression.bind(this)(this.elem,this.data.d,this),this.addEffect(this.getExpressionValue.bind(this)),!0):null}TextProperty.prototype.getExpressionValue=function(r,s){var d=this.calculateExpression(s);if(r.t!==d){var f={};return this.copyData(f,r),f.t=d.toString(),f.__complete=!1,f}return r},TextProperty.prototype.searchProperty=function(){var r=this.searchKeyframes(),s=this.searchExpressions();return this.kf=r||s,this.kf},TextProperty.prototype.searchExpressions=e}function initialize(){addDecorator()}function SVGComposableEffect(){}SVGComposableEffect.prototype={createMergeNode:function e(r,s){var d=createNS("feMerge");d.setAttribute("result",r);var f,_;for(_=0;_<s.length;_+=1)f=createNS("feMergeNode"),f.setAttribute("in",s[_]),d.appendChild(f),d.appendChild(f);return d}};var linearFilterValue="0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0 0 0";function SVGTintFilter(e,r,s,d,f){this.filterManager=r;var _=createNS("feColorMatrix");_.setAttribute("type","matrix"),_.setAttribute("color-interpolation-filters","linearRGB"),_.setAttribute("values",linearFilterValue+" 1 0"),this.linearFilter=_,_.setAttribute("result",d+"_tint_1"),e.appendChild(_),_=createNS("feColorMatrix"),_.setAttribute("type","matrix"),_.setAttribute("color-interpolation-filters","sRGB"),_.setAttribute("values","1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 1 0"),_.setAttribute("result",d+"_tint_2"),e.appendChild(_),this.matrixFilter=_;var C=this.createMergeNode(d,[f,d+"_tint_1",d+"_tint_2"]);e.appendChild(C)}extendPrototype([SVGComposableEffect],SVGTintFilter),SVGTintFilter.prototype.renderFrame=function(e){if(e||this.filterManager._mdf){var r=this.filterManager.effectElements[0].p.v,s=this.filterManager.effectElements[1].p.v,d=this.filterManager.effectElements[2].p.v/100;this.linearFilter.setAttribute("values",linearFilterValue+" "+d+" 0"),this.matrixFilter.setAttribute("values",s[0]-r[0]+" 0 0 0 "+r[0]+" "+(s[1]-r[1])+" 0 0 0 "+r[1]+" "+(s[2]-r[2])+" 0 0 0 "+r[2]+" 0 0 0 1 0")}};function SVGFillFilter(e,r,s,d){this.filterManager=r;var f=createNS("feColorMatrix");f.setAttribute("type","matrix"),f.setAttribute("color-interpolation-filters","sRGB"),f.setAttribute("values","1 0 0 0 0 0 1 0 0 0 0 0 1 0 0 0 0 0 1 0"),f.setAttribute("result",d),e.appendChild(f),this.matrixFilter=f}SVGFillFilter.prototype.renderFrame=function(e){if(e||this.filterManager._mdf){var r=this.filterManager.effectElements[2].p.v,s=this.filterManager.effectElements[6].p.v;this.matrixFilter.setAttribute("values","0 0 0 0 "+r[0]+" 0 0 0 0 "+r[1]+" 0 0 0 0 "+r[2]+" 0 0 0 "+s+" 0")}};function SVGStrokeEffect(e,r,s){this.initialized=!1,this.filterManager=r,this.elem=s,this.paths=[]}SVGStrokeEffect.prototype.initialize=function(){var e=this.elem.layerElement.children||this.elem.layerElement.childNodes,r,s,d,f;for(this.filterManager.effectElements[1].p.v===1?(f=this.elem.maskManager.masksProperties.length,d=0):(d=this.filterManager.effectElements[0].p.v-1,f=d+1),s=createNS("g"),s.setAttribute("fill","none"),s.setAttribute("stroke-linecap","round"),s.setAttribute("stroke-dashoffset",1),d;d<f;d+=1)r=createNS("path"),s.appendChild(r),this.paths.push({p:r,m:d});if(this.filterManager.effectElements[10].p.v===3){var _=createNS("mask"),C=createElementID();_.setAttribute("id",C),_.setAttribute("mask-type","alpha"),_.appendChild(s),this.elem.globalData.defs.appendChild(_);var P=createNS("g");for(P.setAttribute("mask","url("+getLocationHref()+"#"+C+")");e[0];)P.appendChild(e[0]);this.elem.layerElement.appendChild(P),this.masker=_,s.setAttribute("stroke","#fff")}else if(this.filterManager.effectElements[10].p.v===1||this.filterManager.effectElements[10].p.v===2){if(this.filterManager.effectElements[10].p.v===2)for(e=this.elem.layerElement.children||this.elem.layerElement.childNodes;e.length;)this.elem.layerElement.removeChild(e[0]);this.elem.layerElement.appendChild(s),this.elem.layerElement.removeAttribute("mask"),s.setAttribute("stroke","#fff")}this.initialized=!0,this.pathMasker=s},SVGStrokeEffect.prototype.renderFrame=function(e){this.initialized||this.initialize();var r,s=this.paths.length,d,f;for(r=0;r<s;r+=1)if(this.paths[r].m!==-1&&(d=this.elem.maskManager.viewData[this.paths[r].m],f=this.paths[r].p,(e||this.filterManager._mdf||d.prop._mdf)&&f.setAttribute("d",d.lastPath),e||this.filterManager.effectElements[9].p._mdf||this.filterManager.effectElements[4].p._mdf||this.filterManager.effectElements[7].p._mdf||this.filterManager.effectElements[8].p._mdf||d.prop._mdf)){var _;if(this.filterManager.effectElements[7].p.v!==0||this.filterManager.effectElements[8].p.v!==100){var C=Math.min(this.filterManager.effectElements[7].p.v,this.filterManager.effectElements[8].p.v)*.01,P=Math.max(this.filterManager.effectElements[7].p.v,this.filterManager.effectElements[8].p.v)*.01,x=f.getTotalLength();_="0 0 0 "+x*C+" ";var B=x*(P-C),_t=1+this.filterManager.effectElements[4].p.v*2*this.filterManager.effectElements[9].p.v*.01,ue=Math.floor(B/_t),Wt;for(Wt=0;Wt<ue;Wt+=1)_+="1 "+this.filterManager.effectElements[4].p.v*2*this.filterManager.effectElements[9].p.v*.01+" ";_+="0 "+x*10+" 0 0"}else _="1 "+this.filterManager.effectElements[4].p.v*2*this.filterManager.effectElements[9].p.v*.01;f.setAttribute("stroke-dasharray",_)}if((e||this.filterManager.effectElements[4].p._mdf)&&this.pathMasker.setAttribute("stroke-width",this.filterManager.effectElements[4].p.v*2),(e||this.filterManager.effectElements[6].p._mdf)&&this.pathMasker.setAttribute("opacity",this.filterManager.effectElements[6].p.v),(this.filterManager.effectElements[10].p.v===1||this.filterManager.effectElements[10].p.v===2)&&(e||this.filterManager.effectElements[3].p._mdf)){var _n=this.filterManager.effectElements[3].p.v;this.pathMasker.setAttribute("stroke","rgb("+bmFloor(_n[0]*255)+","+bmFloor(_n[1]*255)+","+bmFloor(_n[2]*255)+")")}};function SVGTritoneFilter(e,r,s,d){this.filterManager=r;var f=createNS("feColorMatrix");f.setAttribute("type","matrix"),f.setAttribute("color-interpolation-filters","linearRGB"),f.setAttribute("values","0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0 0 0 1 0"),e.appendChild(f);var _=createNS("feComponentTransfer");_.setAttribute("color-interpolation-filters","sRGB"),_.setAttribute("result",d),this.matrixFilter=_;var C=createNS("feFuncR");C.setAttribute("type","table"),_.appendChild(C),this.feFuncR=C;var P=createNS("feFuncG");P.setAttribute("type","table"),_.appendChild(P),this.feFuncG=P;var x=createNS("feFuncB");x.setAttribute("type","table"),_.appendChild(x),this.feFuncB=x,e.appendChild(_)}SVGTritoneFilter.prototype.renderFrame=function(e){if(e||this.filterManager._mdf){var r=this.filterManager.effectElements[0].p.v,s=this.filterManager.effectElements[1].p.v,d=this.filterManager.effectElements[2].p.v,f=d[0]+" "+s[0]+" "+r[0],_=d[1]+" "+s[1]+" "+r[1],C=d[2]+" "+s[2]+" "+r[2];this.feFuncR.setAttribute("tableValues",f),this.feFuncG.setAttribute("tableValues",_),this.feFuncB.setAttribute("tableValues",C)}};function SVGProLevelsFilter(e,r,s,d){this.filterManager=r;var f=this.filterManager.effectElements,_=createNS("feComponentTransfer");(f[10].p.k||f[10].p.v!==0||f[11].p.k||f[11].p.v!==1||f[12].p.k||f[12].p.v!==1||f[13].p.k||f[13].p.v!==0||f[14].p.k||f[14].p.v!==1)&&(this.feFuncR=this.createFeFunc("feFuncR",_)),(f[17].p.k||f[17].p.v!==0||f[18].p.k||f[18].p.v!==1||f[19].p.k||f[19].p.v!==1||f[20].p.k||f[20].p.v!==0||f[21].p.k||f[21].p.v!==1)&&(this.feFuncG=this.createFeFunc("feFuncG",_)),(f[24].p.k||f[24].p.v!==0||f[25].p.k||f[25].p.v!==1||f[26].p.k||f[26].p.v!==1||f[27].p.k||f[27].p.v!==0||f[28].p.k||f[28].p.v!==1)&&(this.feFuncB=this.createFeFunc("feFuncB",_)),(f[31].p.k||f[31].p.v!==0||f[32].p.k||f[32].p.v!==1||f[33].p.k||f[33].p.v!==1||f[34].p.k||f[34].p.v!==0||f[35].p.k||f[35].p.v!==1)&&(this.feFuncA=this.createFeFunc("feFuncA",_)),(this.feFuncR||this.feFuncG||this.feFuncB||this.feFuncA)&&(_.setAttribute("color-interpolation-filters","sRGB"),e.appendChild(_)),(f[3].p.k||f[3].p.v!==0||f[4].p.k||f[4].p.v!==1||f[5].p.k||f[5].p.v!==1||f[6].p.k||f[6].p.v!==0||f[7].p.k||f[7].p.v!==1)&&(_=createNS("feComponentTransfer"),_.setAttribute("color-interpolation-filters","sRGB"),_.setAttribute("result",d),e.appendChild(_),this.feFuncRComposed=this.createFeFunc("feFuncR",_),this.feFuncGComposed=this.createFeFunc("feFuncG",_),this.feFuncBComposed=this.createFeFunc("feFuncB",_))}SVGProLevelsFilter.prototype.createFeFunc=function(e,r){var s=createNS(e);return s.setAttribute("type","table"),r.appendChild(s),s},SVGProLevelsFilter.prototype.getTableValue=function(e,r,s,d,f){for(var _=0,C=256,P,x=Math.min(e,r),B=Math.max(e,r),_t=Array.call(null,{length:C}),ue,Wt=0,_n=f-d,_i=r-e;_<=256;)P=_/256,P<=x?ue=_i<0?f:d:P>=B?ue=_i<0?d:f:ue=d+_n*Math.pow((P-e)/_i,1/s),_t[Wt]=ue,Wt+=1,_+=256/(C-1);return _t.join(" ")},SVGProLevelsFilter.prototype.renderFrame=function(e){if(e||this.filterManager._mdf){var r,s=this.filterManager.effectElements;this.feFuncRComposed&&(e||s[3].p._mdf||s[4].p._mdf||s[5].p._mdf||s[6].p._mdf||s[7].p._mdf)&&(r=this.getTableValue(s[3].p.v,s[4].p.v,s[5].p.v,s[6].p.v,s[7].p.v),this.feFuncRComposed.setAttribute("tableValues",r),this.feFuncGComposed.setAttribute("tableValues",r),this.feFuncBComposed.setAttribute("tableValues",r)),this.feFuncR&&(e||s[10].p._mdf||s[11].p._mdf||s[12].p._mdf||s[13].p._mdf||s[14].p._mdf)&&(r=this.getTableValue(s[10].p.v,s[11].p.v,s[12].p.v,s[13].p.v,s[14].p.v),this.feFuncR.setAttribute("tableValues",r)),this.feFuncG&&(e||s[17].p._mdf||s[18].p._mdf||s[19].p._mdf||s[20].p._mdf||s[21].p._mdf)&&(r=this.getTableValue(s[17].p.v,s[18].p.v,s[19].p.v,s[20].p.v,s[21].p.v),this.feFuncG.setAttribute("tableValues",r)),this.feFuncB&&(e||s[24].p._mdf||s[25].p._mdf||s[26].p._mdf||s[27].p._mdf||s[28].p._mdf)&&(r=this.getTableValue(s[24].p.v,s[25].p.v,s[26].p.v,s[27].p.v,s[28].p.v),this.feFuncB.setAttribute("tableValues",r)),this.feFuncA&&(e||s[31].p._mdf||s[32].p._mdf||s[33].p._mdf||s[34].p._mdf||s[35].p._mdf)&&(r=this.getTableValue(s[31].p.v,s[32].p.v,s[33].p.v,s[34].p.v,s[35].p.v),this.feFuncA.setAttribute("tableValues",r))}};function SVGDropShadowEffect(e,r,s,d,f){var _=r.container.globalData.renderConfig.filterSize,C=r.data.fs||_;e.setAttribute("x",C.x||_.x),e.setAttribute("y",C.y||_.y),e.setAttribute("width",C.width||_.width),e.setAttribute("height",C.height||_.height),this.filterManager=r;var P=createNS("feGaussianBlur");P.setAttribute("in","SourceAlpha"),P.setAttribute("result",d+"_drop_shadow_1"),P.setAttribute("stdDeviation","0"),this.feGaussianBlur=P,e.appendChild(P);var x=createNS("feOffset");x.setAttribute("dx","25"),x.setAttribute("dy","0"),x.setAttribute("in",d+"_drop_shadow_1"),x.setAttribute("result",d+"_drop_shadow_2"),this.feOffset=x,e.appendChild(x);var B=createNS("feFlood");B.setAttribute("flood-color","#00ff00"),B.setAttribute("flood-opacity","1"),B.setAttribute("result",d+"_drop_shadow_3"),this.feFlood=B,e.appendChild(B);var _t=createNS("feComposite");_t.setAttribute("in",d+"_drop_shadow_3"),_t.setAttribute("in2",d+"_drop_shadow_2"),_t.setAttribute("operator","in"),_t.setAttribute("result",d+"_drop_shadow_4"),e.appendChild(_t);var ue=this.createMergeNode(d,[d+"_drop_shadow_4",f]);e.appendChild(ue)}extendPrototype([SVGComposableEffect],SVGDropShadowEffect),SVGDropShadowEffect.prototype.renderFrame=function(e){if(e||this.filterManager._mdf){if((e||this.filterManager.effectElements[4].p._mdf)&&this.feGaussianBlur.setAttribute("stdDeviation",this.filterManager.effectElements[4].p.v/4),e||this.filterManager.effectElements[0].p._mdf){var r=this.filterManager.effectElements[0].p.v;this.feFlood.setAttribute("flood-color",rgbToHex(Math.round(r[0]*255),Math.round(r[1]*255),Math.round(r[2]*255)))}if((e||this.filterManager.effectElements[1].p._mdf)&&this.feFlood.setAttribute("flood-opacity",this.filterManager.effectElements[1].p.v/255),e||this.filterManager.effectElements[2].p._mdf||this.filterManager.effectElements[3].p._mdf){var s=this.filterManager.effectElements[3].p.v,d=(this.filterManager.effectElements[2].p.v-90)*degToRads,f=s*Math.cos(d),_=s*Math.sin(d);this.feOffset.setAttribute("dx",f),this.feOffset.setAttribute("dy",_)}}};var _svgMatteSymbols=[];function SVGMatte3Effect(e,r,s){this.initialized=!1,this.filterManager=r,this.filterElem=e,this.elem=s,s.matteElement=createNS("g"),s.matteElement.appendChild(s.layerElement),s.matteElement.appendChild(s.transformedElement),s.baseElement=s.matteElement}SVGMatte3Effect.prototype.findSymbol=function(e){for(var r=0,s=_svgMatteSymbols.length;r<s;){if(_svgMatteSymbols[r]===e)return _svgMatteSymbols[r];r+=1}return null},SVGMatte3Effect.prototype.replaceInParent=function(e,r){var s=e.layerElement.parentNode;if(s){for(var d=s.children,f=0,_=d.length;f<_&&d[f]!==e.layerElement;)f+=1;var C;f<=_-2&&(C=d[f+1]);var P=createNS("use");P.setAttribute("href","#"+r),C?s.insertBefore(P,C):s.appendChild(P)}},SVGMatte3Effect.prototype.setElementAsMask=function(e,r){if(!this.findSymbol(r)){var s=createElementID(),d=createNS("mask");d.setAttribute("id",r.layerId),d.setAttribute("mask-type","alpha"),_svgMatteSymbols.push(r);var f=e.globalData.defs;f.appendChild(d);var _=createNS("symbol");_.setAttribute("id",s),this.replaceInParent(r,s),_.appendChild(r.layerElement),f.appendChild(_);var C=createNS("use");C.setAttribute("href","#"+s),d.appendChild(C),r.data.hd=!1,r.show()}e.setMatte(r.layerId)},SVGMatte3Effect.prototype.initialize=function(){for(var e=this.filterManager.effectElements[0].p.v,r=this.elem.comp.elements,s=0,d=r.length;s<d;)r[s]&&r[s].data.ind===e&&this.setElementAsMask(this.elem,r[s]),s+=1;this.initialized=!0},SVGMatte3Effect.prototype.renderFrame=function(){this.initialized||this.initialize()};function SVGGaussianBlurEffect(e,r,s,d){e.setAttribute("x","-100%"),e.setAttribute("y","-100%"),e.setAttribute("width","300%"),e.setAttribute("height","300%"),this.filterManager=r;var f=createNS("feGaussianBlur");f.setAttribute("result",d),e.appendChild(f),this.feGaussianBlur=f}SVGGaussianBlurEffect.prototype.renderFrame=function(e){if(e||this.filterManager._mdf){var r=.3,s=this.filterManager.effectElements[0].p.v*r,d=this.filterManager.effectElements[1].p.v,f=d==3?0:s,_=d==2?0:s;this.feGaussianBlur.setAttribute("stdDeviation",f+" "+_);var C=this.filterManager.effectElements[2].p.v==1?"wrap":"duplicate";this.feGaussianBlur.setAttribute("edgeMode",C)}};function TransformEffect(){}TransformEffect.prototype.init=function(e){this.effectsManager=e,this.type=effectTypes.TRANSFORM_EFFECT,this.matrix=new Matrix,this.opacity=-1,this._mdf=!1,this._opMdf=!1},TransformEffect.prototype.renderFrame=function(e){if(this._opMdf=!1,this._mdf=!1,e||this.effectsManager._mdf){var r=this.effectsManager.effectElements,s=r[0].p.v,d=r[1].p.v,f=r[2].p.v===1,_=r[3].p.v,C=f?_:r[4].p.v,P=r[5].p.v,x=r[6].p.v,B=r[7].p.v;this.matrix.reset(),this.matrix.translate(-s[0],-s[1],s[2]),this.matrix.scale(C*.01,_*.01,1),this.matrix.rotate(-B*degToRads),this.matrix.skewFromAxis(-P*degToRads,(x+90)*degToRads),this.matrix.translate(d[0],d[1],0),this._mdf=!0,this.opacity!==r[8].p.v&&(this.opacity=r[8].p.v,this._opMdf=!0)}};function SVGTransformEffect(e,r){this.init(r)}extendPrototype([TransformEffect],SVGTransformEffect);function CVTransformEffect(e){this.init(e)}return extendPrototype([TransformEffect],CVTransformEffect),registerRenderer("canvas",CanvasRenderer),registerRenderer("html",HybridRenderer),registerRenderer("svg",SVGRenderer),ShapeModifiers.registerModifier("tm",TrimModifier),ShapeModifiers.registerModifier("pb",PuckerAndBloatModifier),ShapeModifiers.registerModifier("rp",RepeaterModifier),ShapeModifiers.registerModifier("rd",RoundCornersModifier),ShapeModifiers.registerModifier("zz",ZigZagModifier),ShapeModifiers.registerModifier("op",OffsetPathModifier),setExpressionsPlugin(Expressions),setExpressionInterfaces(getInterface),initialize$1(),initialize(),registerEffect$1(20,SVGTintFilter,!0),registerEffect$1(21,SVGFillFilter,!0),registerEffect$1(22,SVGStrokeEffect,!1),registerEffect$1(23,SVGTritoneFilter,!0),registerEffect$1(24,SVGProLevelsFilter,!0),registerEffect$1(25,SVGDropShadowEffect,!0),registerEffect$1(28,SVGMatte3Effect,!1),registerEffect$1(29,SVGGaussianBlurEffect,!0),registerEffect$1(35,SVGTransformEffect,!1),registerEffect(35,CVTransformEffect),lottie})})(lottie$1,lottie$1.exports);var lottieExports=lottie$1.exports;const lottie=getDefaultExportFromCjs(lottieExports);function _iterableToArrayLimit(e,r){var s=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(s!=null){var d,f,_,C,P=[],x=!0,B=!1;try{if(_=(s=s.call(e)).next,r===0){if(Object(s)!==s)return;x=!1}else for(;!(x=(d=_.call(s)).done)&&(P.push(d.value),P.length!==r);x=!0);}catch(_t){B=!0,f=_t}finally{try{if(!x&&s.return!=null&&(C=s.return(),Object(C)!==C))return}finally{if(B)throw f}}return P}}function ownKeys(e,r){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(e);r&&(d=d.filter(function(f){return Object.getOwnPropertyDescriptor(e,f).enumerable})),s.push.apply(s,d)}return s}function _objectSpread2(e){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?ownKeys(Object(s),!0).forEach(function(d){_defineProperty(e,d,s[d])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):ownKeys(Object(s)).forEach(function(d){Object.defineProperty(e,d,Object.getOwnPropertyDescriptor(s,d))})}return e}function _defineProperty(e,r,s){return r=_toPropertyKey(r),r in e?Object.defineProperty(e,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[r]=s,e}function _objectWithoutPropertiesLoose$1(e,r){if(e==null)return{};var s={},d=Object.keys(e),f,_;for(_=0;_<d.length;_++)f=d[_],!(r.indexOf(f)>=0)&&(s[f]=e[f]);return s}function _objectWithoutProperties(e,r){if(e==null)return{};var s=_objectWithoutPropertiesLoose$1(e,r),d,f;if(Object.getOwnPropertySymbols){var _=Object.getOwnPropertySymbols(e);for(f=0;f<_.length;f++)d=_[f],!(r.indexOf(d)>=0)&&Object.prototype.propertyIsEnumerable.call(e,d)&&(s[d]=e[d])}return s}function _slicedToArray(e,r){return _arrayWithHoles(e)||_iterableToArrayLimit(e,r)||_unsupportedIterableToArray(e,r)||_nonIterableRest()}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _unsupportedIterableToArray(e,r){if(e){if(typeof e=="string")return _arrayLikeToArray(e,r);var s=Object.prototype.toString.call(e).slice(8,-1);if(s==="Object"&&e.constructor&&(s=e.constructor.name),s==="Map"||s==="Set")return Array.from(e);if(s==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return _arrayLikeToArray(e,r)}}function _arrayLikeToArray(e,r){(r==null||r>e.length)&&(r=e.length);for(var s=0,d=new Array(r);s<r;s++)d[s]=e[s];return d}function _nonIterableRest(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function _toPrimitive(e,r){if(typeof e!="object"||e===null)return e;var s=e[Symbol.toPrimitive];if(s!==void 0){var d=s.call(e,r||"default");if(typeof d!="object")return d;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(e)}function _toPropertyKey(e){var r=_toPrimitive(e,"string");return typeof r=="symbol"?r:String(r)}var _excluded$1=["animationData","loop","autoplay","initialSegment","onComplete","onLoopComplete","onEnterFrame","onSegmentStart","onConfigReady","onDataReady","onDataFailed","onLoadedImages","onDOMLoaded","onDestroy","lottieRef","renderer","name","assetsPath","rendererSettings"],useLottie=function e(r,s){var d=r.animationData,f=r.loop,_=r.autoplay,C=r.initialSegment,P=r.onComplete,x=r.onLoopComplete,B=r.onEnterFrame,_t=r.onSegmentStart,ue=r.onConfigReady,Wt=r.onDataReady,_n=r.onDataFailed,_i=r.onLoadedImages,Ei=r.onDOMLoaded,_a=r.onDestroy;r.lottieRef,r.renderer,r.name,r.assetsPath,r.rendererSettings;var Di=_objectWithoutProperties(r,_excluded$1),_o=reactExports.useState(!1),_s=_slicedToArray(_o,2),_c=_s[0],_m=_s[1],Qm=reactExports.useRef(),tE=reactExports.useRef(null),aE=function(){var IE;(IE=Qm.current)===null||IE===void 0||IE.play()},CE=function(){var IE;(IE=Qm.current)===null||IE===void 0||IE.stop()},lE=function(){var IE;(IE=Qm.current)===null||IE===void 0||IE.pause()},gE=function(IE){var DE;(DE=Qm.current)===null||DE===void 0||DE.setSpeed(IE)},cE=function(IE,DE){var GE;(GE=Qm.current)===null||GE===void 0||GE.goToAndPlay(IE,DE)},_E=function(IE,DE){var GE;(GE=Qm.current)===null||GE===void 0||GE.goToAndStop(IE,DE)},iE=function(IE){var DE;(DE=Qm.current)===null||DE===void 0||DE.setDirection(IE)},rE=function(IE,DE){var GE;(GE=Qm.current)===null||GE===void 0||GE.playSegments(IE,DE)},vf=function(IE){var DE;(DE=Qm.current)===null||DE===void 0||DE.setSubframe(IE)},Fg=function(IE){var DE;return(DE=Qm.current)===null||DE===void 0?void 0:DE.getDuration(IE)},_d=function(){var IE;(IE=Qm.current)===null||IE===void 0||IE.destroy(),Qm.current=void 0},_f=function(){var IE=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},DE;if(tE.current){(DE=Qm.current)===null||DE===void 0||DE.destroy();var GE=_objectSpread2(_objectSpread2(_objectSpread2({},r),IE),{},{container:tE.current});return Qm.current=lottie.loadAnimation(GE),_m(!!Qm.current),function(){var QE;(QE=Qm.current)===null||QE===void 0||QE.destroy(),Qm.current=void 0}}};reactExports.useEffect(function(){var dE=_f();return function(){return dE==null?void 0:dE()}},[d,f]),reactExports.useEffect(function(){Qm.current&&(Qm.current.autoplay=!!_)},[_]),reactExports.useEffect(function(){if(Qm.current){if(!C){Qm.current.resetSegments(!0);return}!Array.isArray(C)||!C.length||((Qm.current.currentRawFrame<C[0]||Qm.current.currentRawFrame>C[1])&&(Qm.current.currentRawFrame=C[0]),Qm.current.setSegment(C[0],C[1]))}},[C]),reactExports.useEffect(function(){var dE=[{name:"complete",handler:P},{name:"loopComplete",handler:x},{name:"enterFrame",handler:B},{name:"segmentStart",handler:_t},{name:"config_ready",handler:ue},{name:"data_ready",handler:Wt},{name:"data_failed",handler:_n},{name:"loaded_images",handler:_i},{name:"DOMLoaded",handler:Ei},{name:"destroy",handler:_a}],IE=dE.filter(function(GE){return GE.handler!=null});if(IE.length){var DE=IE.map(function(GE){var QE;return(QE=Qm.current)===null||QE===void 0||QE.addEventListener(GE.name,GE.handler),function(){var a_;(a_=Qm.current)===null||a_===void 0||a_.removeEventListener(GE.name,GE.handler)}});return function(){DE.forEach(function(GE){return GE()})}}},[P,x,B,_t,ue,Wt,_n,_i,Ei,_a]);var uE=React.createElement("div",_objectSpread2({style:s,ref:tE},Di));return{View:uE,play:aE,stop:CE,pause:lE,setSpeed:gE,goToAndStop:_E,goToAndPlay:cE,setDirection:iE,playSegments:rE,setSubframe:vf,getDuration:Fg,destroy:_d,animationContainerRef:tE,animationLoaded:_c,animationItem:Qm.current}};function getContainerVisibility(e){var r=e.getBoundingClientRect(),s=r.top,d=r.height,f=window.innerHeight-s,_=window.innerHeight+d;return f/_}function getContainerCursorPosition(e,r,s){var d=e.getBoundingClientRect(),f=d.top,_=d.left,C=d.width,P=d.height,x=(r-_)/C,B=(s-f)/P;return{x,y:B}}var useInitInteractivity=function e(r){var s=r.wrapperRef,d=r.animationItem,f=r.mode,_=r.actions;reactExports.useEffect(function(){var C=s.current;if(!(!C||!d||!_.length)){d.stop();var P=function(){var _t=null,ue=function(){var _n=getContainerVisibility(C),_i=_.find(function(_a){var Di=_a.visibility;return Di&&_n>=Di[0]&&_n<=Di[1]});if(_i){if(_i.type==="seek"&&_i.visibility&&_i.frames.length===2){var Ei=_i.frames[0]+Math.ceil((_n-_i.visibility[0])/(_i.visibility[1]-_i.visibility[0])*_i.frames[1]);//! goToAndStop must be relative to the start of the current segment
d.goToAndStop(Ei-d.firstFrame-1,!0)}_i.type==="loop"&&(_t===null||_t!==_i.frames||d.isPaused)&&(d.playSegments(_i.frames,!0),_t=_i.frames),_i.type==="play"&&d.isPaused&&(d.resetSegments(!0),d.play()),_i.type==="stop"&&d.goToAndStop(_i.frames[0]-d.firstFrame-1,!0)}};return document.addEventListener("scroll",ue),function(){document.removeEventListener("scroll",ue)}},x=function(){var _t=function(_i,Ei){var _a=_i,Di=Ei;if(_a!==-1&&Di!==-1){var _o=getContainerCursorPosition(C,_a,Di);_a=_o.x,Di=_o.y}var _s=_.find(function(Qm){var tE=Qm.position;return tE&&Array.isArray(tE.x)&&Array.isArray(tE.y)?_a>=tE.x[0]&&_a<=tE.x[1]&&Di>=tE.y[0]&&Di<=tE.y[1]:tE&&!Number.isNaN(tE.x)&&!Number.isNaN(tE.y)?_a===tE.x&&Di===tE.y:!1});if(_s){if(_s.type==="seek"&&_s.position&&Array.isArray(_s.position.x)&&Array.isArray(_s.position.y)&&_s.frames.length===2){var _c=(_a-_s.position.x[0])/(_s.position.x[1]-_s.position.x[0]),_m=(Di-_s.position.y[0])/(_s.position.y[1]-_s.position.y[0]);d.playSegments(_s.frames,!0),d.goToAndStop(Math.ceil((_c+_m)/2*(_s.frames[1]-_s.frames[0])),!0)}_s.type==="loop"&&d.playSegments(_s.frames,!0),_s.type==="play"&&(d.isPaused&&d.resetSegments(!1),d.playSegments(_s.frames)),_s.type==="stop"&&d.goToAndStop(_s.frames[0],!0)}},ue=function(_i){_t(_i.clientX,_i.clientY)},Wt=function(){_t(-1,-1)};return C.addEventListener("mousemove",ue),C.addEventListener("mouseout",Wt),function(){C.removeEventListener("mousemove",ue),C.removeEventListener("mouseout",Wt)}};switch(f){case"scroll":return P();case"cursor":return x()}}},[f,d])},useLottieInteractivity=function e(r){var s=r.actions,d=r.mode,f=r.lottieObj,_=f.animationItem,C=f.View,P=f.animationContainerRef;return useInitInteractivity({actions:s,animationItem:_,mode:d,wrapperRef:P}),C},_excluded=["style","interactivity"],Lottie=function e(r){var s,d,f,_=r.style,C=r.interactivity,P=_objectWithoutProperties(r,_excluded),x=useLottie(P,_),B=x.View,_t=x.play,ue=x.stop,Wt=x.pause,_n=x.setSpeed,_i=x.goToAndStop,Ei=x.goToAndPlay,_a=x.setDirection,Di=x.playSegments,_o=x.setSubframe,_s=x.getDuration,_c=x.destroy,_m=x.animationContainerRef,Qm=x.animationLoaded,tE=x.animationItem;return reactExports.useEffect(function(){r.lottieRef&&(r.lottieRef.current={play:_t,stop:ue,pause:Wt,setSpeed:_n,goToAndPlay:Ei,goToAndStop:_i,setDirection:_a,playSegments:Di,setSubframe:_o,getDuration:_s,destroy:_c,animationContainerRef:_m,animationLoaded:Qm,animationItem:tE})},[(s=r.lottieRef)===null||s===void 0?void 0:s.current]),useLottieInteractivity({lottieObj:{View:B,play:_t,stop:ue,pause:Wt,setSpeed:_n,goToAndStop:_i,goToAndPlay:Ei,setDirection:_a,playSegments:Di,setSubframe:_o,getDuration:_s,destroy:_c,animationContainerRef:_m,animationLoaded:Qm,animationItem:tE},actions:(d=C==null?void 0:C.actions)!==null&&d!==void 0?d:[],mode:(f=C==null?void 0:C.mode)!==null&&f!==void 0?f:"scroll"})};const v="5.7.6",fr=29.9700012207031,ip=0,op=140.000005702317,w=320,h=192,nm="lottiefiles.com",ddd=0,assets=[{id:"image_0",w:1,h:1,u:"",p:"data:image/png;base64,dataimage/pngbase640",e:1}],layers=[{ddd:0,ind:1,ty:4,nm:"Dot 3 Outlines",parent:11,sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:1,k:[{i:{x:.667,y:1},o:{x:.625,y:.017},t:49,s:[160.25,52.25,0],to:[0,-4.167,0],ti:[0,0,0]},{i:{x:.667,y:1},o:{x:.625,y:0},t:54,s:[160.25,27.25,0],to:[0,0,0],ti:[0,-4.167,0]},{i:{x:.833,y:.833},o:{x:.167,y:.167},t:59,s:[160.25,52.25,0],to:[0,0,0],ti:[0,0,0]},{i:{x:.667,y:1},o:{x:.625,y:.017},t:93,s:[160.25,52.25,0],to:[0,-4.167,0],ti:[0,0,0]},{i:{x:.667,y:1},o:{x:.625,y:0},t:98,s:[160.25,27.25,0],to:[0,0,0],ti:[0,-4.167,0]},{t:103.000004195276,s:[160.25,52.25,0]}],ix:2,l:2},a:{a:0,k:[12.25,12.25,0],ix:1,l:2},s:{a:0,k:[100,100,100],ix:6,l:2}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,-6.627],[6.627,0],[0,6.627],[-6.628,0]],o:[[0,6.627],[-6.628,0],[0,-6.627],[6.627,0]],v:[[12,0],[0,12],[-12,0],[0,-12]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.081047865924,.137433205399,.185762727027,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[12.25,12.25],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 1",np:2,cix:2,bm:0,ix:1,mn:"ADBE Vector Group",hd:!1}],ip:0,op:140.000005702317,st:0,bm:0},{ddd:0,ind:2,ty:4,nm:"Dot 2 Outlines",parent:11,sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:1,k:[{i:{x:.667,y:1},o:{x:.644,y:0},t:44,s:[116.25,52.25,0],to:[0,-4.167,0],ti:[0,0,0]},{i:{x:.667,y:1},o:{x:.633,y:0},t:49,s:[116.25,27.25,0],to:[0,0,0],ti:[0,-4.167,0]},{i:{x:.667,y:.667},o:{x:.333,y:.333},t:54,s:[116.25,52.25,0],to:[0,0,0],ti:[0,0,0]},{i:{x:.667,y:1},o:{x:.644,y:0},t:88,s:[116.25,52.25,0],to:[0,-4.167,0],ti:[0,0,0]},{i:{x:.667,y:1},o:{x:.633,y:0},t:93,s:[116.25,27.25,0],to:[0,0,0],ti:[0,-4.167,0]},{t:98.0000039916218,s:[116.25,52.25,0]}],ix:2,l:2},a:{a:0,k:[12.25,12.25,0],ix:1,l:2},s:{a:0,k:[100,100,100],ix:6,l:2}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,-6.627],[6.627,0],[0,6.627],[-6.628,0]],o:[[0,6.627],[-6.628,0],[0,-6.627],[6.627,0]],v:[[12,0],[0,12],[-12,0],[0,-12]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.081047865924,.137433205399,.185762727027,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[12.25,12.25],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 1",np:2,cix:2,bm:0,ix:1,mn:"ADBE Vector Group",hd:!1}],ip:0,op:140.000005702317,st:0,bm:0},{ddd:0,ind:3,ty:4,nm:"Dot 1 Outlines",parent:11,sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:1,k:[{i:{x:.811,y:1},o:{x:.614,y:.001},t:31,s:[72.499,63.5,0],to:[0,-5,0],ti:[0,0,0]},{i:{x:.667,y:1},o:{x:.766,y:.002},t:36,s:[72.499,33.5,0],to:[0,0,0],ti:[0,-4.167,0]},{i:{x:.678,y:1},o:{x:.681,y:0},t:46,s:[72.499,63.5,0],to:[0,4.167,0],ti:[0,0,0]},{i:{x:.667,y:1},o:{x:.532,y:0},t:50,s:[72.499,58.5,0],to:[0,0,0],ti:[0,-.833,0]},{i:{x:.667,y:.667},o:{x:.167,y:.167},t:54,s:[72.499,63.5,0],to:[0,0,0],ti:[0,0,0]},{i:{x:.811,y:1},o:{x:.614,y:.001},t:75,s:[72.499,63.5,0],to:[0,-5,0],ti:[0,0,0]},{i:{x:.667,y:1},o:{x:.766,y:.002},t:80,s:[72.499,33.5,0],to:[0,0,0],ti:[0,-4.167,0]},{i:{x:.678,y:1},o:{x:.681,y:0},t:90,s:[72.499,63.5,0],to:[0,4.167,0],ti:[0,0,0]},{i:{x:.667,y:1},o:{x:.532,y:0},t:94,s:[72.499,58.5,0],to:[0,0,0],ti:[0,-.833,0]},{t:98.0000039916218,s:[72.499,63.5,0]}],ix:2,l:2},a:{a:0,k:[12.5,23.5,0],ix:1,l:2},s:{a:1,k:[{i:{x:[.667,.667,.667],y:[1,1,1]},o:{x:[.333,.333,.333],y:[0,0,0]},t:25,s:[100,100,100]},{i:{x:[.667,.667,.667],y:[1,1,1]},o:{x:[.333,.333,.333],y:[0,0,0]},t:29,s:[100,40,100]},{i:{x:[.667,.667,.667],y:[1,1,1]},o:{x:[.333,.333,.333],y:[0,0,0]},t:34,s:[100,100,100]},{i:{x:[.667,.667,.667],y:[1,1,1]},o:{x:[.333,.333,.333],y:[0,0,0]},t:44,s:[100,100,100]},{i:{x:[.667,.667,.667],y:[1,1,1]},o:{x:[.333,.333,.333],y:[0,0,0]},t:46,s:[100,75,100]},{i:{x:[.667,.667,.667],y:[1,1,1]},o:{x:[.167,.167,.167],y:[0,0,0]},t:50,s:[100,100,100]},{i:{x:[.667,.667,.667],y:[1,1,1]},o:{x:[.333,.333,.333],y:[0,0,0]},t:69,s:[100,100,100]},{i:{x:[.667,.667,.667],y:[1,1,1]},o:{x:[.333,.333,.333],y:[0,0,0]},t:73,s:[100,40,100]},{i:{x:[.667,.667,.667],y:[1,1,1]},o:{x:[.333,.333,.333],y:[0,0,0]},t:78,s:[100,100,100]},{i:{x:[.667,.667,.667],y:[1,1,1]},o:{x:[.333,.333,.333],y:[0,0,0]},t:88,s:[100,100,100]},{i:{x:[.667,.667,.667],y:[1,1,1]},o:{x:[.333,.333,.333],y:[0,0,0]},t:90,s:[100,75,100]},{t:94.0000038286985,s:[100,100,100]}],ix:6,l:2}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,-6.627],[6.627,0],[0,6.627],[-6.627,0]],o:[[0,6.627],[-6.627,0],[0,-6.627],[6.627,0]],v:[[12,0],[0,12],[-12,0],[0,-12]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.081047865924,.137433205399,.185762727027,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[12.25,12.25],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 1",np:2,cix:2,bm:0,ix:1,mn:"ADBE Vector Group",hd:!1}],ip:0,op:140.000005702317,st:0,bm:0},{ddd:0,ind:4,ty:4,nm:"Dialog Box Outlines",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:1,k:[{i:{x:.667,y:1},o:{x:.333,y:0},t:4,s:[144.105,113.25,0],to:[6.667,-6.667,0],ti:[-6.667,6.667,0]},{i:{x:.667,y:.667},o:{x:.333,y:.333},t:8,s:[184.105,73.25,0],to:[0,0,0],ti:[0,0,0]},{i:{x:.667,y:1},o:{x:.167,y:0},t:116,s:[184.105,73.25,0],to:[-6.667,6.667,0],ti:[6.667,-6.667,0]},{t:118.000004806239,s:[144.105,113.25,0]}],ix:2,l:2},a:{a:0,k:[116.5,52.5,0],ix:1,l:2},s:{a:1,k:[{i:{x:[.667,.667,.667],y:[1,1,1]},o:{x:[.333,.333,.333],y:[0,0,0]},t:5.455,s:[0,0,100]},{i:{x:[.667,.667,.667],y:[1,1,1]},o:{x:[.333,.333,.333],y:[0,0,0]},t:10.909,s:[108,108,100]},{i:{x:[.667,.667,.667],y:[1,1,1]},o:{x:[.167,.167,.167],y:[0,0,0]},t:15,s:[100,100,100]},{i:{x:[.833,.833,.833],y:[1,1,1]},o:{x:[.167,.167,.167],y:[0,0,0]},t:116,s:[100,100,100]},{t:118.000004806239,s:[0,0,100]}],ix:6,l:2}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[28.719,0],[0,0],[0,28.719],[-28.719,0],[0,0],[0,-28.719]],o:[[0,0],[-28.719,0],[0,-28.719],[0,0],[28.719,0],[0,28.719]],v:[[64,52],[-64,52],[-116,0],[-64,-52],[64,-52],[116,0]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.858770333084,.866351617551,.873935415231,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[116.25,52.25],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 1",np:2,cix:2,bm:0,ix:1,mn:"ADBE Vector Group",hd:!1}],ip:0,op:140.000005702317,st:0,bm:0},{ddd:0,ind:5,ty:4,nm:"Dialog Box Tail 2 Outlines",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:1,k:[{i:{x:.667,y:1},o:{x:.333,y:0},t:2,s:[40.396,151.25,0],to:[3.333,-3.333,0],ti:[-3.333,3.333,0]},{i:{x:.667,y:.667},o:{x:.333,y:.333},t:6,s:[60.396,131.25,0],to:[0,0,0],ti:[0,0,0]},{i:{x:.667,y:1},o:{x:.167,y:0},t:117,s:[60.396,131.25,0],to:[-3.333,3.333,0],ti:[3.333,-3.333,0]},{t:119.000004846969,s:[40.396,151.25,0]}],ix:2,l:2},a:{a:0,k:[16.5,16.5,0],ix:1,l:2},s:{a:1,k:[{i:{x:[.667,.667,.667],y:[1,1,1]},o:{x:[.333,.333,.333],y:[0,0,0]},t:2.728,s:[0,0,100]},{i:{x:[.667,.667,.667],y:[1,1,1]},o:{x:[.333,.333,.333],y:[0,0,0]},t:8.181,s:[125,125,100]},{i:{x:[.667,.667,.667],y:[1,1,1]},o:{x:[.167,.167,.167],y:[0,0,0]},t:10.909,s:[100,100,100]},{i:{x:[.833,.833,.833],y:[1,1,1]},o:{x:[.167,.167,.167],y:[0,0,0]},t:117,s:[100,100,100]},{t:119.000004846969,s:[0,0,100]}],ix:6,l:2}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,-8.837],[8.836,0],[0,8.837],[-8.836,0]],o:[[0,8.837],[-8.836,0],[0,-8.837],[8.836,0]],v:[[16,0],[0,16],[-16,0],[0,-16]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.858770333084,.866351617551,.873935415231,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[16.25,16.25],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 1",np:2,cix:2,bm:0,ix:1,mn:"ADBE Vector Group",hd:!1}],ip:0,op:140.000005702317,st:0,bm:0},{ddd:0,ind:6,ty:4,nm:"Dialog Box Tail 1 Outlines",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:1,k:[{i:{x:.667,y:1},o:{x:.333,y:0},t:0,s:[12.396,179.25,0],to:[3.333,-3.333,0],ti:[-3.333,3.333,0]},{i:{x:.667,y:.667},o:{x:.333,y:.333},t:4,s:[32.396,159.25,0],to:[0,0,0],ti:[0,0,0]},{i:{x:.667,y:1},o:{x:.167,y:0},t:118,s:[32.396,159.25,0],to:[-3.333,3.333,0],ti:[3.333,-3.333,0]},{t:120.0000048877,s:[12.396,179.25,0]}],ix:2,l:2},a:{a:0,k:[12.5,12.5,0],ix:1,l:2},s:{a:1,k:[{i:{x:[.667,.667,.667],y:[1,1,1]},o:{x:[.333,.333,.333],y:[0,0,0]},t:0,s:[0,0,100]},{i:{x:[.667,.667,.667],y:[1,1,1]},o:{x:[.333,.333,.333],y:[0,0,0]},t:5.455,s:[125,125,100]},{i:{x:[.667,.667,.667],y:[1,1,1]},o:{x:[.167,.167,.167],y:[0,0,0]},t:8.181,s:[100,100,100]},{i:{x:[.667,.667,.667],y:[1,1,1]},o:{x:[.167,.167,.167],y:[0,0,0]},t:118,s:[100,100,100]},{t:120.0000048877,s:[0,0,100]}],ix:6,l:2}},ao:0,shapes:[{ty:"gr",it:[{ind:0,ty:"sh",ix:1,ks:{a:0,k:{i:[[0,-6.627],[6.627,0],[0,6.627],[-6.627,0]],o:[[0,6.627],[-6.627,0],[0,-6.627],[6.627,0]],v:[[12,0],[0,12],[-12,0],[0,-12]],c:!0},ix:2},nm:"Path 1",mn:"ADBE Vector Shape - Group",hd:!1},{ty:"fl",c:{a:0,k:[.858770333084,.866351617551,.873935415231,1],ix:4},o:{a:0,k:100,ix:5},r:1,bm:0,nm:"Fill 1",mn:"ADBE Vector Graphic - Fill",hd:!1},{ty:"tr",p:{a:0,k:[12.25,12.25],ix:2},a:{a:0,k:[0,0],ix:1},s:{a:0,k:[100,100],ix:3},r:{a:0,k:0,ix:6},o:{a:0,k:100,ix:7},sk:{a:0,k:0,ix:4},sa:{a:0,k:0,ix:5},nm:"Transform"}],nm:"Group 1",np:2,cix:2,bm:0,ix:1,mn:"ADBE Vector Group",hd:!1}],ip:0,op:140.000005702317,st:0,bm:0},{ddd:0,ind:7,ty:2,nm:"Backup",refId:"image_0",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:0,k:[0,192,0],ix:2,l:2},a:{a:0,k:[0,0,0],ix:1,l:2},s:{a:0,k:[100,100,100],ix:6,l:2}},ao:0,ip:0,op:140.000005702317,st:0,bm:0},{ddd:0,ind:11,ty:3,nm:"Dialog Box",sr:1,ks:{o:{a:0,k:100,ix:11},r:{a:0,k:0,ix:10},p:{a:1,k:[{i:{x:.667,y:1},o:{x:.333,y:0},t:4,s:[144.105,113.25,0],to:[6.667,-6.667,0],ti:[-6.667,6.667,0]},{i:{x:.667,y:.667},o:{x:.333,y:.333},t:8,s:[184.105,73.25,0],to:[0,0,0],ti:[0,0,0]},{i:{x:.667,y:1},o:{x:.167,y:0},t:116,s:[184.105,73.25,0],to:[-6.667,6.667,0],ti:[6.667,-6.667,0]},{t:118.000004806239,s:[144.105,113.25,0]}],ix:2,l:2},a:{a:0,k:[116.5,52.5,0],ix:1,l:2},s:{a:1,k:[{i:{x:[.667,.667,.667],y:[1,1,1]},o:{x:[.333,.333,.333],y:[0,0,0]},t:5.455,s:[0,0,100]},{i:{x:[.667,.667,.667],y:[1,1,1]},o:{x:[.333,.333,.333],y:[0,0,0]},t:10.909,s:[108,108,100]},{i:{x:[.667,.667,.667],y:[1,1,1]},o:{x:[.167,.167,.167],y:[0,0,0]},t:15,s:[100,100,100]},{i:{x:[.833,.833,.833],y:[1,1,1]},o:{x:[.167,.167,.167],y:[0,0,0]},t:116,s:[100,100,100]},{t:118.000004806239,s:[0,0,100]}],ix:6,l:2}},ao:0,ip:0,op:140.000005702317,st:0,bm:0}],markers=[],typingAnimation={v,fr,ip,op,w,h,nm,ddd,assets,layers,markers},index="";function styleInject(e,r){r===void 0&&(r={});var s=r.insertAt;if(!(!e||typeof document>"u")){var d=document.head||document.getElementsByTagName("head")[0],f=document.createElement("style");f.type="text/css",s==="top"&&d.firstChild?d.insertBefore(f,d.firstChild):d.appendChild(f),f.styleSheet?f.styleSheet.cssText=e:f.appendChild(document.createTextNode(e))}}var css_248z=`.styles-module_wrapper__1I_qj {
  z-index: 1;
  display: flex;
  align-items: center;
  position: fixed;
  padding: 0px 60px 0px 60px;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  background-color: black;
  box-sizing: border-box;
}

.styles-module_content__2jwZj {
  margin: auto;
  padding: 0;
  width: 90%;
  height: 100%;
  max-height: 100%;
  text-align: center;
}

.styles-module_slide__1zrfk {
  height: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
}

.styles-module_image__2hdkJ {
  max-height: 100%;
  max-width: 100%;
  user-select: none;
  -moz-user-select: none;
  -webkit-user-select: none;
}

.styles-module_close__2I1sI {
  color: white;
  position: absolute;
  top: 15px;
  right: 15px;
  font-size: 40px;
  font-weight: bold;
  opacity: 0.2;
  cursor: pointer;
}

.styles-module_close__2I1sI:hover {
  opacity: 1;
}

.styles-module_navigation__1pqAE {
  height: 80%;
  color: white;
  cursor: pointer;
  position: absolute;
  font-size: 60px;
  line-height: 60px;
  font-weight: bold;
  display: flex;
  align-items: center;
  opacity: 0.2;
  padding: 0 15px;
  user-select: none;
  -moz-user-select: none;
  -webkit-user-select: none;
}

.styles-module_navigation__1pqAE:hover {
  opacity: 1;
}

@media (hover: none) {
  .styles-module_navigation__1pqAE:hover {
    opacity: 0.2;
  }
}

.styles-module_prev__KqFRp {
  left: 0;
}

.styles-module_next__1uQwZ {
  right: 0;
}

@media (max-width: 900px) {
  .styles-module_wrapper__1I_qj {
    padding: 0;
  }
}
`,styles$4={wrapper:"styles-module_wrapper__1I_qj",content:"styles-module_content__2jwZj",slide:"styles-module_slide__1zrfk",image:"styles-module_image__2hdkJ",close:"styles-module_close__2I1sI",navigation:"styles-module_navigation__1pqAE",prev:"styles-module_prev__KqFRp",next:"styles-module_next__1uQwZ"};styleInject(css_248z);const ReactSimpleImageViewer=e=>{var r;const[s,d]=reactExports.useState((r=e.currentIndex)!==null&&r!==void 0?r:0),f=reactExports.useCallback(x=>{let B=(s+x)%e.src.length;B<0&&(B=e.src.length-1),d(B)},[s]),_=reactExports.useCallback(x=>{var B;if(!x.target||!e.closeOnClickOutside)return;const _t=x.target.id==="ReactSimpleImageViewer",ue=x.target.classList.contains("react-simple-image-viewer__slide");(_t||ue)&&(x.stopPropagation(),(B=e.onClose)===null||B===void 0||B.call(e))},[e.onClose]),C=reactExports.useCallback(x=>{var B;x.key==="Escape"&&((B=e.onClose)===null||B===void 0||B.call(e)),["ArrowLeft","h"].includes(x.key)&&f(-1),["ArrowRight","l"].includes(x.key)&&f(1)},[e.onClose,f]),P=reactExports.useCallback(x=>{x.wheelDeltaY>0?f(-1):f(1)},[f]);return reactExports.useEffect(()=>(document.addEventListener("keydown",C),e.disableScroll||document.addEventListener("wheel",P),()=>{document.removeEventListener("keydown",C),e.disableScroll||document.removeEventListener("wheel",P)}),[C,P]),React.createElement("div",{id:"ReactSimpleImageViewer",className:`${styles$4.wrapper} react-simple-image-viewer__modal`,onKeyDown:C,onClick:_,style:e.backgroundStyle},React.createElement("span",{className:`${styles$4.close} react-simple-image-viewer__close`,onClick:()=>{var x;return(x=e.onClose)===null||x===void 0?void 0:x.call(e)}},e.closeComponent||"Ã—"),e.src.length>1&&React.createElement("span",{className:`${styles$4.navigation} ${styles$4.prev} react-simple-image-viewer__previous`,onClick:()=>f(-1)},e.leftArrowComponent||"â®"),e.src.length>1&&React.createElement("span",{className:`${styles$4.navigation} ${styles$4.next} react-simple-image-viewer__next`,onClick:()=>f(1)},e.rightArrowComponent||"â¯"),React.createElement("div",{className:`${styles$4.content} react-simple-image-viewer__modal-content`,onClick:_},React.createElement("div",{className:`${styles$4.slide} react-simple-image-viewer__slide`},React.createElement("img",{className:styles$4.image,src:e.src[s],alt:""}))))},loader="/assets/Loader-cbc659e7.png";let selectedChatCompare;const ChatBoxContent=({socket:e,socketConnected:r})=>{const s=useSelector(rE=>rE.chat.selectedChat),d=useSelector(rE=>rE.auth.user),[f,_]=reactExports.useState(""),C=reactExports.useRef(null),[P,x]=reactExports.useState(!1),[B,_t]=reactExports.useState(!1),[ue,Wt]=reactExports.useState([]),[_n,_i]=reactExports.useState(!1),[Ei,_a]=reactExports.useState(""),[Di,_o]=reactExports.useState(null),[_s,_c]=reactExports.useState(!1),[_m,Qm]=reactExports.useState([]),tE=useDispatch();reactExports.useEffect(()=>{_a(""),aE(),selectedChatCompare=s},[s]),reactExports.useEffect(()=>{e&&(e.on("message recieved",rE=>{selectedChatCompare&&selectedChatCompare._id===rE.chat._id&&(Wt([...ue,rE]),tE(setFetchUserChatsAgain(!0)))}),e.on("typing",rE=>{_(rE),_t(!0)}),e.on("stop typing",()=>_t(!1)))}),reactExports.useEffect(()=>{var rE;(rE=C.current)==null||rE.scrollIntoView({behavior:"smooth"})},[ue,B]);const aE=async()=>{if(s)try{_i(!0);const rE=await getAllMessagesFromChat(s._id);Wt(rE.messages),_i(!1),e&&e.emit("join room",s._id)}catch{Q.dismiss(),Q.error("Error fetching messages",TOAST_ACTION)}},CE=async()=>{try{e.emit("stop typing",s==null?void 0:s._id),_a("");let rE;if(Di){_o(null);const vf=new FormData;vf.append("image",Di),vf.append("chat",s==null?void 0:s._id),Ei&&vf.append("content",Ei),rE=s&&await sendMessageWithImg(vf)}else rE=s&&await sendMessage(Ei,s._id);if(tE(setFetchUserChatsAgain(!0)),rE&&rE.message){const vf=rE.message;rE&&e.emit("new message",{...vf,chat:s}),rE&&rE.message&&Wt(Fg=>[...Fg,vf])}}catch{Q.dismiss(),Q.error("Error sending message",TOAST_ACTION)}};let lE;const gE=rE=>{if(_a(rE),!r)return;P||(x(!0),e.emit("typing",s==null?void 0:s._id));const vf=3e3;clearTimeout(lE),lE=setTimeout(()=>{e.emit("stop typing",s==null?void 0:s._id),x(!1)},vf)},cE=async rE=>{var Fg;const vf=(Fg=rE.target.files)==null?void 0:Fg[0];if(vf){if(!vf.type.startsWith("image/")){Q.dismiss(),Q.error("Only image files are allowed",TOAST_ACTION);return}_o(vf)}},_E=()=>{_c(!1)},iE=reactExports.useCallback(rE=>{Qm([rE]),_c(!0)},[]);return jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children:_n?jsxRuntimeExports.jsx("div",{className:"flex items-center justify-center h-full",children:jsxRuntimeExports.jsx("img",{src:loader,alt:"loader",className:"animate-spin w-20 h-20"})}):jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs("div",{className:"overflow-y-scroll flex flex-col h-full mt-4 no-scrollbar gap-2 w-full",children:[Object.entries(groupByDate(ue)).map(([rE,vf])=>jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("div",{className:"flex justify-center mt-8 mb-4",children:jsxRuntimeExports.jsx("h1",{className:"bg-socioverse-100 rounded-xl px-2 py-1 text-xs font-thin text-blue-gray-900",children:rE})}),jsxRuntimeExports.jsx("div",{className:"flex flex-col gap-2",children:vf.map(Fg=>jsxRuntimeExports.jsx("div",{className:classnames("flex md:mx-4 mx-1 text-sm p-2",{"justify-end":Fg.sender._id===(d==null?void 0:d._id)},{"justify-start":Fg.sender._id!==(d==null?void 0:d._id)}),children:jsxRuntimeExports.jsxs("div",{className:"flex items-start justify-between gap-2",children:[(s==null?void 0:s.isGroupChat)&&d&&Fg.sender._id!==d._id&&jsxRuntimeExports.jsx("img",{className:"inline-block h-8 w-8 md:h-12 md:w-12 rounded-full",src:Fg.sender.dp?Fg.sender.dp:CONSTANTS_COMMON.DEFAULT_IMG,alt:"user dp"}),jsxRuntimeExports.jsxs("div",{className:classnames("inline rounded-xl shadow-lg max-w-[25rem] break-words",{"bg-gray-100 text-black":Fg.sender._id!==(d==null?void 0:d._id)},{"bg-blue-gray-500/80 text-white":Fg.sender._id===(d==null?void 0:d._id)}),children:[(s==null?void 0:s.isGroupChat)&&d&&Fg.sender._id!==d._id&&jsxRuntimeExports.jsxs("h6",{className:"text-[0.65rem] font-thin text-left px-1 pt-1",children:["~ ",Fg.sender.name]}),jsxRuntimeExports.jsxs("div",{className:classnames("flex flex-col",{"p-4":!(s!=null&&s.isGroupChat)||Fg.sender._id===(d==null?void 0:d._id)},{"px-4 pb-2":(s==null?void 0:s.isGroupChat)&&d&&Fg.sender._id!==(d==null?void 0:d._id)}),children:[Fg.image&&jsxRuntimeExports.jsx("img",{src:Fg.image,alt:"image",className:"mb-2 rounded-lg cursor-pointer",onClick:()=>iE(Fg.image)}),jsxRuntimeExports.jsx("h1",{className:"text-sm my-1 font-normal text-left",children:Fg.content&&Fg.content}),jsxRuntimeExports.jsx("h6",{className:"text-[0.65rem] font-thin opacity-80 text-right",children:hooks(Fg.createdAt).format("LT")})]})]})]})},`message+${rE}+${Fg._id}`))})]},`date+${rE}`)),jsxRuntimeExports.jsx("div",{ref:C,className:"h-10 md:mx-4 mx-1",children:B&&(s==null?void 0:s._id)===f&&jsxRuntimeExports.jsx("div",{className:"w-24",children:jsxRuntimeExports.jsx(Lottie,{animationData:typingAnimation,loop:!0})})})]}),Di&&jsxRuntimeExports.jsxs("div",{className:"md:mx-4 mx-1 relative h-36 w-36 overflow-hidden",children:[jsxRuntimeExports.jsx("img",{src:URL.createObjectURL(Di),alt:"img",className:"h-full w-full rounded-lg object-cover"}),jsxRuntimeExports.jsx(AiOutlineCloseCircle,{className:"text-xl cursor-pointer text-white hover:scale-105 absolute top-0 right-0 ",onClick:()=>_o(null)})]}),jsxRuntimeExports.jsxs("div",{className:" md:mx-4 mx-1 md:mb-4 mb-2 flex items-center justify-between z-0",children:[jsxRuntimeExports.jsx(InputEmojiWithRef,{value:Ei,onChange:gE,cleanOnEnter:!0,onEnter:CE,placeholder:"Enter a message...",theme:"auto",fontSize:14,fontFamily:"sans-serif",keepOpened:!0,searchMention:async rE=>["no user"].filter(vf=>vf.includes(rE))}),jsxRuntimeExports.jsxs("div",{className:"mx-auto",children:[jsxRuntimeExports.jsx("input",{type:"file",accept:"image/*",id:"image-input",className:"hidden",onChange:cE}),jsxRuntimeExports.jsx("label",{htmlFor:"image-input",children:jsxRuntimeExports.jsx(ImAttachment,{className:"text-2xl text-[#858585] cursor-pointer hover:text-[#128b7e]"})})]})]}),_s&&jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsx("div",{className:"hidden lg:block",children:jsxRuntimeExports.jsx(ReactSimpleImageViewer,{src:_m,currentIndex:0,disableScroll:!1,closeOnClickOutside:!0,onClose:_E,backgroundStyle:{backgroundColor:"rgba(0,0,0,0.8)",padding:"8rem 4rem 4rem 4rem"}})}),jsxRuntimeExports.jsx("div",{className:"block lg:hidden",children:jsxRuntimeExports.jsx(ReactSimpleImageViewer,{src:_m,currentIndex:0,disableScroll:!1,closeOnClickOutside:!0,onClose:_E,backgroundStyle:{backgroundColor:"rgba(0,0,0,0.8)"}})})]})]})})};var AgoraRTC_NProduction={exports:{}};(function(e,r){(function(s,d){e.exports=d()})(commonjsGlobal,function(){function s(l,i){return i.forEach(function(o){o&&typeof o!="string"&&!Array.isArray(o)&&Object.keys(o).forEach(function(p){if(p!=="default"&&!(p in l)){var g=Object.getOwnPropertyDescriptor(o,p);Object.defineProperty(l,p,g.get?g:{enumerable:!0,get:function(){return o[p]}})}})}),Object.freeze(l)}let d=!0,f=!0;function _(l,i,o){const p=l.match(i);return p&&p.length>=o&&parseInt(p[o],10)}function C(l,i,o){if(!l.RTCPeerConnection)return;const p=l.RTCPeerConnection.prototype,g=p.addEventListener;p.addEventListener=function(A,j){if(A!==i)return g.apply(this,arguments);const H=z=>{const $=o(z);$&&(j.handleEvent?j.handleEvent($):j($))};return this._eventMap=this._eventMap||{},this._eventMap[i]||(this._eventMap[i]=new Map),this._eventMap[i].set(j,H),g.apply(this,[A,H])};const b=p.removeEventListener;p.removeEventListener=function(A,j){if(A!==i||!this._eventMap||!this._eventMap[i])return b.apply(this,arguments);if(!this._eventMap[i].has(j))return b.apply(this,arguments);const H=this._eventMap[i].get(j);return this._eventMap[i].delete(j),this._eventMap[i].size===0&&delete this._eventMap[i],Object.keys(this._eventMap).length===0&&delete this._eventMap,b.apply(this,[A,H])},Object.defineProperty(p,"on"+i,{get(){return this["_on"+i]},set(A){this["_on"+i]&&(this.removeEventListener(i,this["_on"+i]),delete this["_on"+i]),A&&this.addEventListener(i,this["_on"+i]=A)},enumerable:!0,configurable:!0})}function P(l){return typeof l!="boolean"?new Error("Argument type: "+typeof l+". Please use a boolean."):(d=l,l?"adapter.js logging disabled":"adapter.js logging enabled")}function x(l){return typeof l!="boolean"?new Error("Argument type: "+typeof l+". Please use a boolean."):(f=!l,"adapter.js deprecation warnings "+(l?"disabled":"enabled"))}function B(){if(typeof window=="object"){if(d)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function _t(l,i){f&&console.warn(l+" is deprecated, please use "+i+" instead.")}function ue(l){return Object.prototype.toString.call(l)==="[object Object]"}function Wt(l){return ue(l)?Object.keys(l).reduce(function(i,o){const p=ue(l[o]),g=p?Wt(l[o]):l[o],b=p&&!Object.keys(g).length;return g===void 0||b?i:Object.assign(i,{[o]:g})},{}):l}function _n(l,i,o){i&&!o.has(i.id)&&(o.set(i.id,i),Object.keys(i).forEach(p=>{p.endsWith("Id")?_n(l,l.get(i[p]),o):p.endsWith("Ids")&&i[p].forEach(g=>{_n(l,l.get(g),o)})}))}function _i(l,i,o){const p=o?"outbound-rtp":"inbound-rtp",g=new Map;if(i===null)return g;const b=[];return l.forEach(A=>{A.type==="track"&&A.trackIdentifier===i.id&&b.push(A)}),b.forEach(A=>{l.forEach(j=>{j.type===p&&j.trackId===A.id&&_n(l,j,g)})}),g}const Ei=B;function _a(l,i){const o=l&&l.navigator;if(!o.mediaDevices)return;const p=function(A){if(typeof A!="object"||A.mandatory||A.optional)return A;const j={};return Object.keys(A).forEach(H=>{if(H==="require"||H==="advanced"||H==="mediaSource")return;const z=typeof A[H]=="object"?A[H]:{ideal:A[H]};z.exact!==void 0&&typeof z.exact=="number"&&(z.min=z.max=z.exact);const $=function(Vt,_r){return Vt?Vt+_r.charAt(0).toUpperCase()+_r.slice(1):_r==="deviceId"?"sourceId":_r};if(z.ideal!==void 0){j.optional=j.optional||[];let Vt={};typeof z.ideal=="number"?(Vt[$("min",H)]=z.ideal,j.optional.push(Vt),Vt={},Vt[$("max",H)]=z.ideal,j.optional.push(Vt)):(Vt[$("",H)]=z.ideal,j.optional.push(Vt))}z.exact!==void 0&&typeof z.exact!="number"?(j.mandatory=j.mandatory||{},j.mandatory[$("",H)]=z.exact):["min","max"].forEach(Vt=>{z[Vt]!==void 0&&(j.mandatory=j.mandatory||{},j.mandatory[$(Vt,H)]=z[Vt])})}),A.advanced&&(j.optional=(j.optional||[]).concat(A.advanced)),j},g=function(A,j){if(i.version>=61)return j(A);if((A=JSON.parse(JSON.stringify(A)))&&typeof A.audio=="object"){const H=function(z,$,Vt){$ in z&&!(Vt in z)&&(z[Vt]=z[$],delete z[$])};H((A=JSON.parse(JSON.stringify(A))).audio,"autoGainControl","googAutoGainControl"),H(A.audio,"noiseSuppression","googNoiseSuppression"),A.audio=p(A.audio)}if(A&&typeof A.video=="object"){let H=A.video.facingMode;H=H&&(typeof H=="object"?H:{ideal:H});const z=i.version<66;if(H&&(H.exact==="user"||H.exact==="environment"||H.ideal==="user"||H.ideal==="environment")&&(!o.mediaDevices.getSupportedConstraints||!o.mediaDevices.getSupportedConstraints().facingMode||z)){let $;if(delete A.video.facingMode,H.exact==="environment"||H.ideal==="environment"?$=["back","rear"]:H.exact!=="user"&&H.ideal!=="user"||($=["front"]),$)return o.mediaDevices.enumerateDevices().then(Vt=>{let _r=(Vt=Vt.filter(Fi=>Fi.kind==="videoinput")).find(Fi=>$.some(_l=>Fi.label.toLowerCase().includes(_l)));return!_r&&Vt.length&&$.includes("back")&&(_r=Vt[Vt.length-1]),_r&&(A.video.deviceId=H.exact?{exact:_r.deviceId}:{ideal:_r.deviceId}),A.video=p(A.video),Ei("chrome: "+JSON.stringify(A)),j(A)})}A.video=p(A.video)}return Ei("chrome: "+JSON.stringify(A)),j(A)},b=function(A){return i.version>=64?A:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[A.name]||A.name,message:A.message,constraint:A.constraint||A.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(o.getUserMedia=(function(A,j,H){g(A,z=>{o.webkitGetUserMedia(z,j,$=>{H&&H(b($))})})}).bind(o),o.mediaDevices.getUserMedia){const A=o.mediaDevices.getUserMedia.bind(o.mediaDevices);o.mediaDevices.getUserMedia=function(j){return g(j,H=>A(H).then(z=>{if(H.audio&&!z.getAudioTracks().length||H.video&&!z.getVideoTracks().length)throw z.getTracks().forEach($=>{$.stop()}),new DOMException("","NotFoundError");return z},z=>Promise.reject(b(z))))}}}function Di(l){l.MediaStream=l.MediaStream||l.webkitMediaStream}function _o(l){if(typeof l=="object"&&l.RTCPeerConnection&&!("ontrack"in l.RTCPeerConnection.prototype)){Object.defineProperty(l.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(o){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=o)},enumerable:!0,configurable:!0});const i=l.RTCPeerConnection.prototype.setRemoteDescription;l.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=o=>{o.stream.addEventListener("addtrack",p=>{let g;g=l.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(A=>A.track&&A.track.id===p.track.id):{track:p.track};const b=new Event("track");b.track=p.track,b.receiver=g,b.transceiver={receiver:g},b.streams=[o.stream],this.dispatchEvent(b)}),o.stream.getTracks().forEach(p=>{let g;g=l.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(A=>A.track&&A.track.id===p.id):{track:p};const b=new Event("track");b.track=p,b.receiver=g,b.transceiver={receiver:g},b.streams=[o.stream],this.dispatchEvent(b)})},this.addEventListener("addstream",this._ontrackpoly)),i.apply(this,arguments)}}else C(l,"track",i=>(i.transceiver||Object.defineProperty(i,"transceiver",{value:{receiver:i.receiver}}),i))}function _s(l){if(typeof l=="object"&&l.RTCPeerConnection&&!("getSenders"in l.RTCPeerConnection.prototype)&&"createDTMFSender"in l.RTCPeerConnection.prototype){const i=function(g,b){return{track:b,get dtmf(){return this._dtmf===void 0&&(b.kind==="audio"?this._dtmf=g.createDTMFSender(b):this._dtmf=null),this._dtmf},_pc:g}};if(!l.RTCPeerConnection.prototype.getSenders){l.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const g=l.RTCPeerConnection.prototype.addTrack;l.RTCPeerConnection.prototype.addTrack=function(A,j){let H=g.apply(this,arguments);return H||(H=i(this,A),this._senders.push(H)),H};const b=l.RTCPeerConnection.prototype.removeTrack;l.RTCPeerConnection.prototype.removeTrack=function(A){b.apply(this,arguments);const j=this._senders.indexOf(A);j!==-1&&this._senders.splice(j,1)}}const o=l.RTCPeerConnection.prototype.addStream;l.RTCPeerConnection.prototype.addStream=function(g){this._senders=this._senders||[],o.apply(this,[g]),g.getTracks().forEach(b=>{this._senders.push(i(this,b))})};const p=l.RTCPeerConnection.prototype.removeStream;l.RTCPeerConnection.prototype.removeStream=function(g){this._senders=this._senders||[],p.apply(this,[g]),g.getTracks().forEach(b=>{const A=this._senders.find(j=>j.track===b);A&&this._senders.splice(this._senders.indexOf(A),1)})}}else if(typeof l=="object"&&l.RTCPeerConnection&&"getSenders"in l.RTCPeerConnection.prototype&&"createDTMFSender"in l.RTCPeerConnection.prototype&&l.RTCRtpSender&&!("dtmf"in l.RTCRtpSender.prototype)){const i=l.RTCPeerConnection.prototype.getSenders;l.RTCPeerConnection.prototype.getSenders=function(){const o=i.apply(this,[]);return o.forEach(p=>p._pc=this),o},Object.defineProperty(l.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function _c(l){if(!l.RTCPeerConnection)return;const i=l.RTCPeerConnection.prototype.getStats;l.RTCPeerConnection.prototype.getStats=function(){const[o,p,g]=arguments;if(arguments.length>0&&typeof o=="function")return i.apply(this,arguments);if(i.length===0&&(arguments.length===0||typeof o!="function"))return i.apply(this,[]);const b=function(j){const H={};return j.result().forEach(z=>{const $={id:z.id,timestamp:z.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[z.type]||z.type};z.names().forEach(Vt=>{$[Vt]=z.stat(Vt)}),H[$.id]=$}),H},A=function(j){return new Map(Object.keys(j).map(H=>[H,j[H]]))};if(arguments.length>=2){const j=function(H){p(A(b(H)))};return i.apply(this,[j,o])}return new Promise((j,H)=>{i.apply(this,[function(z){j(A(b(z)))},H])}).then(p,g)}}function _m(l){if(!(typeof l=="object"&&l.RTCPeerConnection&&l.RTCRtpSender&&l.RTCRtpReceiver))return;if(!("getStats"in l.RTCRtpSender.prototype)){const o=l.RTCPeerConnection.prototype.getSenders;o&&(l.RTCPeerConnection.prototype.getSenders=function(){const g=o.apply(this,[]);return g.forEach(b=>b._pc=this),g});const p=l.RTCPeerConnection.prototype.addTrack;p&&(l.RTCPeerConnection.prototype.addTrack=function(){const g=p.apply(this,arguments);return g._pc=this,g}),l.RTCRtpSender.prototype.getStats=function(){const g=this;return this._pc.getStats().then(b=>_i(b,g.track,!0))}}if(!("getStats"in l.RTCRtpReceiver.prototype)){const o=l.RTCPeerConnection.prototype.getReceivers;o&&(l.RTCPeerConnection.prototype.getReceivers=function(){const p=o.apply(this,[]);return p.forEach(g=>g._pc=this),p}),C(l,"track",p=>(p.receiver._pc=p.srcElement,p)),l.RTCRtpReceiver.prototype.getStats=function(){const p=this;return this._pc.getStats().then(g=>_i(g,p.track,!1))}}if(!("getStats"in l.RTCRtpSender.prototype)||!("getStats"in l.RTCRtpReceiver.prototype))return;const i=l.RTCPeerConnection.prototype.getStats;l.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof l.MediaStreamTrack){const o=arguments[0];let p,g,b;return this.getSenders().forEach(A=>{A.track===o&&(p?b=!0:p=A)}),this.getReceivers().forEach(A=>(A.track===o&&(g?b=!0:g=A),A.track===o)),b||p&&g?Promise.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):p?p.getStats():g?g.getStats():Promise.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return i.apply(this,arguments)}}function Qm(l){l.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(b=>this._shimmedLocalStreams[b][0])};const i=l.RTCPeerConnection.prototype.addTrack;l.RTCPeerConnection.prototype.addTrack=function(b,A){if(!A)return i.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const j=i.apply(this,arguments);return this._shimmedLocalStreams[A.id]?this._shimmedLocalStreams[A.id].indexOf(j)===-1&&this._shimmedLocalStreams[A.id].push(j):this._shimmedLocalStreams[A.id]=[A,j],j};const o=l.RTCPeerConnection.prototype.addStream;l.RTCPeerConnection.prototype.addStream=function(b){this._shimmedLocalStreams=this._shimmedLocalStreams||{},b.getTracks().forEach(H=>{if(this.getSenders().find(z=>z.track===H))throw new DOMException("Track already exists.","InvalidAccessError")});const A=this.getSenders();o.apply(this,arguments);const j=this.getSenders().filter(H=>A.indexOf(H)===-1);this._shimmedLocalStreams[b.id]=[b].concat(j)};const p=l.RTCPeerConnection.prototype.removeStream;l.RTCPeerConnection.prototype.removeStream=function(b){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[b.id],p.apply(this,arguments)};const g=l.RTCPeerConnection.prototype.removeTrack;l.RTCPeerConnection.prototype.removeTrack=function(b){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},b&&Object.keys(this._shimmedLocalStreams).forEach(A=>{const j=this._shimmedLocalStreams[A].indexOf(b);j!==-1&&this._shimmedLocalStreams[A].splice(j,1),this._shimmedLocalStreams[A].length===1&&delete this._shimmedLocalStreams[A]}),g.apply(this,arguments)}}function tE(l,i){if(!l.RTCPeerConnection)return;if(l.RTCPeerConnection.prototype.addTrack&&i.version>=65)return Qm(l);const o=l.RTCPeerConnection.prototype.getLocalStreams;l.RTCPeerConnection.prototype.getLocalStreams=function(){const H=o.apply(this);return this._reverseStreams=this._reverseStreams||{},H.map(z=>this._reverseStreams[z.id])};const p=l.RTCPeerConnection.prototype.addStream;l.RTCPeerConnection.prototype.addStream=function(H){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},H.getTracks().forEach(z=>{if(this.getSenders().find($=>$.track===z))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[H.id]){const z=new l.MediaStream(H.getTracks());this._streams[H.id]=z,this._reverseStreams[z.id]=H,H=z}p.apply(this,[H])};const g=l.RTCPeerConnection.prototype.removeStream;function b(H,z){let $=z.sdp;return Object.keys(H._reverseStreams||[]).forEach(Vt=>{const _r=H._reverseStreams[Vt],Fi=H._streams[_r.id];$=$.replace(new RegExp(Fi.id,"g"),_r.id)}),new RTCSessionDescription({type:z.type,sdp:$})}l.RTCPeerConnection.prototype.removeStream=function(H){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},g.apply(this,[this._streams[H.id]||H]),delete this._reverseStreams[this._streams[H.id]?this._streams[H.id].id:H.id],delete this._streams[H.id]},l.RTCPeerConnection.prototype.addTrack=function(H,z){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const $=[].slice.call(arguments,1);if($.length!==1||!$[0].getTracks().find(_r=>_r===H))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(_r=>_r.track===H))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const Vt=this._streams[z.id];if(Vt)Vt.addTrack(H),Promise.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const _r=new l.MediaStream([H]);this._streams[z.id]=_r,this._reverseStreams[_r.id]=z,this.addStream(_r)}return this.getSenders().find(_r=>_r.track===H)},["createOffer","createAnswer"].forEach(function(H){const z=l.RTCPeerConnection.prototype[H],$={[H](){const Vt=arguments;return arguments.length&&typeof arguments[0]=="function"?z.apply(this,[_r=>{const Fi=b(this,_r);Vt[0].apply(null,[Fi])},_r=>{Vt[1]&&Vt[1].apply(null,_r)},arguments[2]]):z.apply(this,arguments).then(_r=>b(this,_r))}};l.RTCPeerConnection.prototype[H]=$[H]});const A=l.RTCPeerConnection.prototype.setLocalDescription;l.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(H,z){let $=z.sdp;return Object.keys(H._reverseStreams||[]).forEach(Vt=>{const _r=H._reverseStreams[Vt],Fi=H._streams[_r.id];$=$.replace(new RegExp(_r.id,"g"),Fi.id)}),new RTCSessionDescription({type:z.type,sdp:$})}(this,arguments[0]),A.apply(this,arguments)):A.apply(this,arguments)};const j=Object.getOwnPropertyDescriptor(l.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(l.RTCPeerConnection.prototype,"localDescription",{get(){const H=j.get.apply(this);return H.type===""?H:b(this,H)}}),l.RTCPeerConnection.prototype.removeTrack=function(H){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!H._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(H._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let z;this._streams=this._streams||{},Object.keys(this._streams).forEach($=>{this._streams[$].getTracks().find(Vt=>H.track===Vt)&&(z=this._streams[$])}),z&&(z.getTracks().length===1?this.removeStream(this._reverseStreams[z.id]):z.removeTrack(H.track),this.dispatchEvent(new Event("negotiationneeded")))}}function aE(l,i){!l.RTCPeerConnection&&l.webkitRTCPeerConnection&&(l.RTCPeerConnection=l.webkitRTCPeerConnection),l.RTCPeerConnection&&i.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(o){const p=l.RTCPeerConnection.prototype[o],g={[o](){return arguments[0]=new(o==="addIceCandidate"?l.RTCIceCandidate:l.RTCSessionDescription)(arguments[0]),p.apply(this,arguments)}};l.RTCPeerConnection.prototype[o]=g[o]})}function CE(l,i){C(l,"negotiationneeded",o=>{const p=o.target;if(!(i.version<72||p.getConfiguration&&p.getConfiguration().sdpSemantics==="plan-b")||p.signalingState==="stable")return o})}var lE=Object.freeze({__proto__:null,fixNegotiationNeeded:CE,shimAddTrackRemoveTrack:tE,shimAddTrackRemoveTrackWithNative:Qm,shimGetDisplayMedia:function(l,i){l.navigator.mediaDevices&&"getDisplayMedia"in l.navigator.mediaDevices||l.navigator.mediaDevices&&(typeof i=="function"?l.navigator.mediaDevices.getDisplayMedia=function(o){return i(o).then(p=>{const g=o.video&&o.video.width,b=o.video&&o.video.height,A=o.video&&o.video.frameRate;return o.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:p,maxFrameRate:A||3}},g&&(o.video.mandatory.maxWidth=g),b&&(o.video.mandatory.maxHeight=b),l.navigator.mediaDevices.getUserMedia(o)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:_s,shimGetStats:_c,shimGetUserMedia:_a,shimMediaStream:Di,shimOnTrack:_o,shimPeerConnection:aE,shimSenderReceiverGetStats:_m});function gE(l,i){const o=l&&l.navigator,p=l&&l.MediaStreamTrack;if(o.getUserMedia=function(g,b,A){_t("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),o.mediaDevices.getUserMedia(g).then(b,A)},!(i.version>55&&"autoGainControl"in o.mediaDevices.getSupportedConstraints())){const g=function(A,j,H){j in A&&!(H in A)&&(A[H]=A[j],delete A[j])},b=o.mediaDevices.getUserMedia.bind(o.mediaDevices);if(o.mediaDevices.getUserMedia=function(A){return typeof A=="object"&&typeof A.audio=="object"&&(A=JSON.parse(JSON.stringify(A)),g(A.audio,"autoGainControl","mozAutoGainControl"),g(A.audio,"noiseSuppression","mozNoiseSuppression")),b(A)},p&&p.prototype.getSettings){const A=p.prototype.getSettings;p.prototype.getSettings=function(){const j=A.apply(this,arguments);return g(j,"mozAutoGainControl","autoGainControl"),g(j,"mozNoiseSuppression","noiseSuppression"),j}}if(p&&p.prototype.applyConstraints){const A=p.prototype.applyConstraints;p.prototype.applyConstraints=function(j){return this.kind==="audio"&&typeof j=="object"&&(j=JSON.parse(JSON.stringify(j)),g(j,"autoGainControl","mozAutoGainControl"),g(j,"noiseSuppression","mozNoiseSuppression")),A.apply(this,[j])}}}}function cE(l){typeof l=="object"&&l.RTCTrackEvent&&"receiver"in l.RTCTrackEvent.prototype&&!("transceiver"in l.RTCTrackEvent.prototype)&&Object.defineProperty(l.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function _E(l,i){if(typeof l!="object"||!l.RTCPeerConnection&&!l.mozRTCPeerConnection)return;!l.RTCPeerConnection&&l.mozRTCPeerConnection&&(l.RTCPeerConnection=l.mozRTCPeerConnection),i.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(g){const b=l.RTCPeerConnection.prototype[g],A={[g](){return arguments[0]=new(g==="addIceCandidate"?l.RTCIceCandidate:l.RTCSessionDescription)(arguments[0]),b.apply(this,arguments)}};l.RTCPeerConnection.prototype[g]=A[g]});const o={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},p=l.RTCPeerConnection.prototype.getStats;l.RTCPeerConnection.prototype.getStats=function(){const[g,b,A]=arguments;return p.apply(this,[g||null]).then(j=>{if(i.version<53&&!b)try{j.forEach(H=>{H.type=o[H.type]||H.type})}catch(H){if(H.name!=="TypeError")throw H;j.forEach((z,$)=>{j.set($,Object.assign({},z,{type:o[z.type]||z.type}))})}return j}).then(b,A)}}function iE(l){if(typeof l!="object"||!l.RTCPeerConnection||!l.RTCRtpSender||l.RTCRtpSender&&"getStats"in l.RTCRtpSender.prototype)return;const i=l.RTCPeerConnection.prototype.getSenders;i&&(l.RTCPeerConnection.prototype.getSenders=function(){const p=i.apply(this,[]);return p.forEach(g=>g._pc=this),p});const o=l.RTCPeerConnection.prototype.addTrack;o&&(l.RTCPeerConnection.prototype.addTrack=function(){const p=o.apply(this,arguments);return p._pc=this,p}),l.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):Promise.resolve(new Map)}}function rE(l){if(typeof l!="object"||!l.RTCPeerConnection||!l.RTCRtpSender||l.RTCRtpSender&&"getStats"in l.RTCRtpReceiver.prototype)return;const i=l.RTCPeerConnection.prototype.getReceivers;i&&(l.RTCPeerConnection.prototype.getReceivers=function(){const o=i.apply(this,[]);return o.forEach(p=>p._pc=this),o}),C(l,"track",o=>(o.receiver._pc=o.srcElement,o)),l.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function vf(l){l.RTCPeerConnection&&!("removeStream"in l.RTCPeerConnection.prototype)&&(l.RTCPeerConnection.prototype.removeStream=function(i){_t("removeStream","removeTrack"),this.getSenders().forEach(o=>{o.track&&i.getTracks().includes(o.track)&&this.removeTrack(o)})})}function Fg(l){l.DataChannel&&!l.RTCDataChannel&&(l.RTCDataChannel=l.DataChannel)}function _d(l){if(typeof l!="object"||!l.RTCPeerConnection)return;const i=l.RTCPeerConnection.prototype.addTransceiver;i&&(l.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let o=arguments[1]&&arguments[1].sendEncodings;o===void 0&&(o=[]),o=[...o];const p=o.length>0;p&&o.forEach(b=>{if("rid"in b&&!/^[a-z0-9]{0,16}$/i.test(b.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in b&&!(parseFloat(b.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in b&&!(parseFloat(b.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const g=i.apply(this,arguments);if(p){const{sender:b}=g,A=b.getParameters();(!("encodings"in A)||A.encodings.length===1&&Object.keys(A.encodings[0]).length===0)&&(A.encodings=o,b.sendEncodings=o,this.setParametersPromises.push(b.setParameters(A).then(()=>{delete b.sendEncodings}).catch(()=>{delete b.sendEncodings})))}return g})}function _f(l){if(typeof l!="object"||!l.RTCRtpSender)return;const i=l.RTCRtpSender.prototype.getParameters;i&&(l.RTCRtpSender.prototype.getParameters=function(){const o=i.apply(this,arguments);return"encodings"in o||(o.encodings=[].concat(this.sendEncodings||[{}])),o})}function uE(l){if(typeof l!="object"||!l.RTCPeerConnection)return;const i=l.RTCPeerConnection.prototype.createOffer;l.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>i.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):i.apply(this,arguments)}}function dE(l){if(typeof l!="object"||!l.RTCPeerConnection)return;const i=l.RTCPeerConnection.prototype.createAnswer;l.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?Promise.all(this.setParametersPromises).then(()=>i.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):i.apply(this,arguments)}}var IE=Object.freeze({__proto__:null,shimAddTransceiver:_d,shimCreateAnswer:dE,shimCreateOffer:uE,shimGetDisplayMedia:function(l,i){l.navigator.mediaDevices&&"getDisplayMedia"in l.navigator.mediaDevices||l.navigator.mediaDevices&&(l.navigator.mediaDevices.getDisplayMedia=function(o){if(!o||!o.video){const p=new DOMException("getDisplayMedia without video constraints is undefined");return p.name="NotFoundError",p.code=8,Promise.reject(p)}return o.video===!0?o.video={mediaSource:i}:o.video.mediaSource=i,l.navigator.mediaDevices.getUserMedia(o)})},shimGetParameters:_f,shimGetUserMedia:gE,shimOnTrack:cE,shimPeerConnection:_E,shimRTCDataChannel:Fg,shimReceiverGetStats:rE,shimRemoveStream:vf,shimSenderGetStats:iE});function DE(l){if(typeof l=="object"&&l.RTCPeerConnection){if("getLocalStreams"in l.RTCPeerConnection.prototype||(l.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in l.RTCPeerConnection.prototype)){const i=l.RTCPeerConnection.prototype.addTrack;l.RTCPeerConnection.prototype.addStream=function(o){this._localStreams||(this._localStreams=[]),this._localStreams.includes(o)||this._localStreams.push(o),o.getAudioTracks().forEach(p=>i.call(this,p,o)),o.getVideoTracks().forEach(p=>i.call(this,p,o))},l.RTCPeerConnection.prototype.addTrack=function(o,...p){return p&&p.forEach(g=>{this._localStreams?this._localStreams.includes(g)||this._localStreams.push(g):this._localStreams=[g]}),i.apply(this,arguments)}}"removeStream"in l.RTCPeerConnection.prototype||(l.RTCPeerConnection.prototype.removeStream=function(i){this._localStreams||(this._localStreams=[]);const o=this._localStreams.indexOf(i);if(o===-1)return;this._localStreams.splice(o,1);const p=i.getTracks();this.getSenders().forEach(g=>{p.includes(g.track)&&this.removeTrack(g)})})}}function GE(l){if(typeof l=="object"&&l.RTCPeerConnection&&("getRemoteStreams"in l.RTCPeerConnection.prototype||(l.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in l.RTCPeerConnection.prototype))){Object.defineProperty(l.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(o){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=o),this.addEventListener("track",this._onaddstreampoly=p=>{p.streams.forEach(g=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(g))return;this._remoteStreams.push(g);const b=new Event("addstream");b.stream=g,this.dispatchEvent(b)})})}});const i=l.RTCPeerConnection.prototype.setRemoteDescription;l.RTCPeerConnection.prototype.setRemoteDescription=function(){const o=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(p){p.streams.forEach(g=>{if(o._remoteStreams||(o._remoteStreams=[]),o._remoteStreams.indexOf(g)>=0)return;o._remoteStreams.push(g);const b=new Event("addstream");b.stream=g,o.dispatchEvent(b)})}),i.apply(o,arguments)}}}function QE(l){if(typeof l!="object"||!l.RTCPeerConnection)return;const i=l.RTCPeerConnection.prototype,o=i.createOffer,p=i.createAnswer,g=i.setLocalDescription,b=i.setRemoteDescription,A=i.addIceCandidate;i.createOffer=function(H,z){const $=arguments.length>=2?arguments[2]:arguments[0],Vt=o.apply(this,[$]);return z?(Vt.then(H,z),Promise.resolve()):Vt},i.createAnswer=function(H,z){const $=arguments.length>=2?arguments[2]:arguments[0],Vt=p.apply(this,[$]);return z?(Vt.then(H,z),Promise.resolve()):Vt};let j=function(H,z,$){const Vt=g.apply(this,[H]);return $?(Vt.then(z,$),Promise.resolve()):Vt};i.setLocalDescription=j,j=function(H,z,$){const Vt=b.apply(this,[H]);return $?(Vt.then(z,$),Promise.resolve()):Vt},i.setRemoteDescription=j,j=function(H,z,$){const Vt=A.apply(this,[H]);return $?(Vt.then(z,$),Promise.resolve()):Vt},i.addIceCandidate=j}function a_(l){const i=l&&l.navigator;if(i.mediaDevices&&i.mediaDevices.getUserMedia){const o=i.mediaDevices,p=o.getUserMedia.bind(o);i.mediaDevices.getUserMedia=g=>p(m0(g))}!i.getUserMedia&&i.mediaDevices&&i.mediaDevices.getUserMedia&&(i.getUserMedia=(function(o,p,g){i.mediaDevices.getUserMedia(o).then(p,g)}).bind(i))}function m0(l){return l&&l.video!==void 0?Object.assign({},l,{video:Wt(l.video)}):l}function W0(l){if(!l.RTCPeerConnection)return;const i=l.RTCPeerConnection;l.RTCPeerConnection=function(o,p){if(o&&o.iceServers){const g=[];for(let b=0;b<o.iceServers.length;b++){let A=o.iceServers[b];!A.hasOwnProperty("urls")&&A.hasOwnProperty("url")?(_t("RTCIceServer.url","RTCIceServer.urls"),A=JSON.parse(JSON.stringify(A)),A.urls=A.url,delete A.url,g.push(A)):g.push(o.iceServers[b])}o.iceServers=g}return new i(o,p)},l.RTCPeerConnection.prototype=i.prototype,"generateCertificate"in i&&Object.defineProperty(l.RTCPeerConnection,"generateCertificate",{get:()=>i.generateCertificate})}function mS(l){typeof l=="object"&&l.RTCTrackEvent&&"receiver"in l.RTCTrackEvent.prototype&&!("transceiver"in l.RTCTrackEvent.prototype)&&Object.defineProperty(l.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function M0(l){const i=l.RTCPeerConnection.prototype.createOffer;l.RTCPeerConnection.prototype.createOffer=function(o){if(o){o.offerToReceiveAudio!==void 0&&(o.offerToReceiveAudio=!!o.offerToReceiveAudio);const p=this.getTransceivers().find(b=>b.receiver.track.kind==="audio");o.offerToReceiveAudio===!1&&p?p.direction==="sendrecv"?p.setDirection?p.setDirection("sendonly"):p.direction="sendonly":p.direction==="recvonly"&&(p.setDirection?p.setDirection("inactive"):p.direction="inactive"):o.offerToReceiveAudio!==!0||p||this.addTransceiver("audio",{direction:"recvonly"}),o.offerToReceiveVideo!==void 0&&(o.offerToReceiveVideo=!!o.offerToReceiveVideo);const g=this.getTransceivers().find(b=>b.receiver.track.kind==="video");o.offerToReceiveVideo===!1&&g?g.direction==="sendrecv"?g.setDirection?g.setDirection("sendonly"):g.direction="sendonly":g.direction==="recvonly"&&(g.setDirection?g.setDirection("inactive"):g.direction="inactive"):o.offerToReceiveVideo!==!0||g||this.addTransceiver("video",{direction:"recvonly"})}return i.apply(this,arguments)}}function s0(l){typeof l!="object"||l.AudioContext||(l.AudioContext=l.webkitAudioContext)}var Y0=Object.freeze({__proto__:null,shimAudioContext:s0,shimCallbacksAPI:QE,shimConstraints:m0,shimCreateOfferLegacy:M0,shimGetUserMedia:a_,shimLocalStreamsAPI:DE,shimRTCIceServerUrls:W0,shimRemoteStreamsAPI:GE,shimTrackEventTransceiver:mS}),o_=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof commonjsGlobal<"u"?commonjsGlobal:typeof self<"u"?self:{};function LE(l){return l&&l.__esModule&&Object.prototype.hasOwnProperty.call(l,"default")?l.default:l}var R_={exports:{}};(function(l){const i={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};i.localCName=i.generateIdentifier(),i.splitLines=function(o){return o.trim().split(`
`).map(p=>p.trim())},i.splitSections=function(o){return o.split(`
m=`).map((p,g)=>(g>0?"m="+p:p).trim()+`\r
`)},i.getDescription=function(o){const p=i.splitSections(o);return p&&p[0]},i.getMediaSections=function(o){const p=i.splitSections(o);return p.shift(),p},i.matchPrefix=function(o,p){return i.splitLines(o).filter(g=>g.indexOf(p)===0)},i.parseCandidate=function(o){let p;p=o.indexOf("a=candidate:")===0?o.substring(12).split(" "):o.substring(10).split(" ");const g={foundation:p[0],component:{1:"rtp",2:"rtcp"}[p[1]]||p[1],protocol:p[2].toLowerCase(),priority:parseInt(p[3],10),ip:p[4],address:p[4],port:parseInt(p[5],10),type:p[7]};for(let b=8;b<p.length;b+=2)switch(p[b]){case"raddr":g.relatedAddress=p[b+1];break;case"rport":g.relatedPort=parseInt(p[b+1],10);break;case"tcptype":g.tcpType=p[b+1];break;case"ufrag":g.ufrag=p[b+1],g.usernameFragment=p[b+1];break;default:g[p[b]]===void 0&&(g[p[b]]=p[b+1])}return g},i.writeCandidate=function(o){const p=[];p.push(o.foundation);const g=o.component;g==="rtp"?p.push(1):g==="rtcp"?p.push(2):p.push(g),p.push(o.protocol.toUpperCase()),p.push(o.priority),p.push(o.address||o.ip),p.push(o.port);const b=o.type;return p.push("typ"),p.push(b),b!=="host"&&o.relatedAddress&&o.relatedPort&&(p.push("raddr"),p.push(o.relatedAddress),p.push("rport"),p.push(o.relatedPort)),o.tcpType&&o.protocol.toLowerCase()==="tcp"&&(p.push("tcptype"),p.push(o.tcpType)),(o.usernameFragment||o.ufrag)&&(p.push("ufrag"),p.push(o.usernameFragment||o.ufrag)),"candidate:"+p.join(" ")},i.parseIceOptions=function(o){return o.substring(14).split(" ")},i.parseRtpMap=function(o){let p=o.substring(9).split(" ");const g={payloadType:parseInt(p.shift(),10)};return p=p[0].split("/"),g.name=p[0],g.clockRate=parseInt(p[1],10),g.channels=p.length===3?parseInt(p[2],10):1,g.numChannels=g.channels,g},i.writeRtpMap=function(o){let p=o.payloadType;o.preferredPayloadType!==void 0&&(p=o.preferredPayloadType);const g=o.channels||o.numChannels||1;return"a=rtpmap:"+p+" "+o.name+"/"+o.clockRate+(g!==1?"/"+g:"")+`\r
`},i.parseExtmap=function(o){const p=o.substring(9).split(" ");return{id:parseInt(p[0],10),direction:p[0].indexOf("/")>0?p[0].split("/")[1]:"sendrecv",uri:p[1],attributes:p.slice(2).join(" ")}},i.writeExtmap=function(o){return"a=extmap:"+(o.id||o.preferredId)+(o.direction&&o.direction!=="sendrecv"?"/"+o.direction:"")+" "+o.uri+(o.attributes?" "+o.attributes:"")+`\r
`},i.parseFmtp=function(o){const p={};let g;const b=o.substring(o.indexOf(" ")+1).split(";");for(let A=0;A<b.length;A++)g=b[A].trim().split("="),p[g[0].trim()]=g[1];return p},i.writeFmtp=function(o){let p="",g=o.payloadType;if(o.preferredPayloadType!==void 0&&(g=o.preferredPayloadType),o.parameters&&Object.keys(o.parameters).length){const b=[];Object.keys(o.parameters).forEach(A=>{o.parameters[A]!==void 0?b.push(A+"="+o.parameters[A]):b.push(A)}),p+="a=fmtp:"+g+" "+b.join(";")+`\r
`}return p},i.parseRtcpFb=function(o){const p=o.substring(o.indexOf(" ")+1).split(" ");return{type:p.shift(),parameter:p.join(" ")}},i.writeRtcpFb=function(o){let p="",g=o.payloadType;return o.preferredPayloadType!==void 0&&(g=o.preferredPayloadType),o.rtcpFeedback&&o.rtcpFeedback.length&&o.rtcpFeedback.forEach(b=>{p+="a=rtcp-fb:"+g+" "+b.type+(b.parameter&&b.parameter.length?" "+b.parameter:"")+`\r
`}),p},i.parseSsrcMedia=function(o){const p=o.indexOf(" "),g={ssrc:parseInt(o.substring(7,p),10)},b=o.indexOf(":",p);return b>-1?(g.attribute=o.substring(p+1,b),g.value=o.substring(b+1)):g.attribute=o.substring(p+1),g},i.parseSsrcGroup=function(o){const p=o.substring(13).split(" ");return{semantics:p.shift(),ssrcs:p.map(g=>parseInt(g,10))}},i.getMid=function(o){const p=i.matchPrefix(o,"a=mid:")[0];if(p)return p.substring(6)},i.parseFingerprint=function(o){const p=o.substring(14).split(" ");return{algorithm:p[0].toLowerCase(),value:p[1].toUpperCase()}},i.getDtlsParameters=function(o,p){return{role:"auto",fingerprints:i.matchPrefix(o+p,"a=fingerprint:").map(i.parseFingerprint)}},i.writeDtlsParameters=function(o,p){let g="a=setup:"+p+`\r
`;return o.fingerprints.forEach(b=>{g+="a=fingerprint:"+b.algorithm+" "+b.value+`\r
`}),g},i.parseCryptoLine=function(o){const p=o.substring(9).split(" ");return{tag:parseInt(p[0],10),cryptoSuite:p[1],keyParams:p[2],sessionParams:p.slice(3)}},i.writeCryptoLine=function(o){return"a=crypto:"+o.tag+" "+o.cryptoSuite+" "+(typeof o.keyParams=="object"?i.writeCryptoKeyParams(o.keyParams):o.keyParams)+(o.sessionParams?" "+o.sessionParams.join(" "):"")+`\r
`},i.parseCryptoKeyParams=function(o){if(o.indexOf("inline:")!==0)return null;const p=o.substring(7).split("|");return{keyMethod:"inline",keySalt:p[0],lifeTime:p[1],mkiValue:p[2]?p[2].split(":")[0]:void 0,mkiLength:p[2]?p[2].split(":")[1]:void 0}},i.writeCryptoKeyParams=function(o){return o.keyMethod+":"+o.keySalt+(o.lifeTime?"|"+o.lifeTime:"")+(o.mkiValue&&o.mkiLength?"|"+o.mkiValue+":"+o.mkiLength:"")},i.getCryptoParameters=function(o,p){return i.matchPrefix(o+p,"a=crypto:").map(i.parseCryptoLine)},i.getIceParameters=function(o,p){const g=i.matchPrefix(o+p,"a=ice-ufrag:")[0],b=i.matchPrefix(o+p,"a=ice-pwd:")[0];return g&&b?{usernameFragment:g.substring(12),password:b.substring(10)}:null},i.writeIceParameters=function(o){let p="a=ice-ufrag:"+o.usernameFragment+`\r
a=ice-pwd:`+o.password+`\r
`;return o.iceLite&&(p+=`a=ice-lite\r
`),p},i.parseRtpParameters=function(o){const p={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},g=i.splitLines(o)[0].split(" ");p.profile=g[2];for(let A=3;A<g.length;A++){const j=g[A],H=i.matchPrefix(o,"a=rtpmap:"+j+" ")[0];if(H){const z=i.parseRtpMap(H),$=i.matchPrefix(o,"a=fmtp:"+j+" ");switch(z.parameters=$.length?i.parseFmtp($[0]):{},z.rtcpFeedback=i.matchPrefix(o,"a=rtcp-fb:"+j+" ").map(i.parseRtcpFb),p.codecs.push(z),z.name.toUpperCase()){case"RED":case"ULPFEC":p.fecMechanisms.push(z.name.toUpperCase())}}}i.matchPrefix(o,"a=extmap:").forEach(A=>{p.headerExtensions.push(i.parseExtmap(A))});const b=i.matchPrefix(o,"a=rtcp-fb:* ").map(i.parseRtcpFb);return p.codecs.forEach(A=>{b.forEach(j=>{A.rtcpFeedback.find(H=>H.type===j.type&&H.parameter===j.parameter)||A.rtcpFeedback.push(j)})}),p},i.writeRtpDescription=function(o,p){let g="";g+="m="+o+" ",g+=p.codecs.length>0?"9":"0",g+=" "+(p.profile||"UDP/TLS/RTP/SAVPF")+" ",g+=p.codecs.map(A=>A.preferredPayloadType!==void 0?A.preferredPayloadType:A.payloadType).join(" ")+`\r
`,g+=`c=IN IP4 0.0.0.0\r
`,g+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,p.codecs.forEach(A=>{g+=i.writeRtpMap(A),g+=i.writeFmtp(A),g+=i.writeRtcpFb(A)});let b=0;return p.codecs.forEach(A=>{A.maxptime>b&&(b=A.maxptime)}),b>0&&(g+="a=maxptime:"+b+`\r
`),p.headerExtensions&&p.headerExtensions.forEach(A=>{g+=i.writeExtmap(A)}),g},i.parseRtpEncodingParameters=function(o){const p=[],g=i.parseRtpParameters(o),b=g.fecMechanisms.indexOf("RED")!==-1,A=g.fecMechanisms.indexOf("ULPFEC")!==-1,j=i.matchPrefix(o,"a=ssrc:").map(_r=>i.parseSsrcMedia(_r)).filter(_r=>_r.attribute==="cname"),H=j.length>0&&j[0].ssrc;let z;const $=i.matchPrefix(o,"a=ssrc-group:FID").map(_r=>_r.substring(17).split(" ").map(Fi=>parseInt(Fi,10)));$.length>0&&$[0].length>1&&$[0][0]===H&&(z=$[0][1]),g.codecs.forEach(_r=>{if(_r.name.toUpperCase()==="RTX"&&_r.parameters.apt){let Fi={ssrc:H,codecPayloadType:parseInt(_r.parameters.apt,10)};H&&z&&(Fi.rtx={ssrc:z}),p.push(Fi),b&&(Fi=JSON.parse(JSON.stringify(Fi)),Fi.fec={ssrc:H,mechanism:A?"red+ulpfec":"red"},p.push(Fi))}}),p.length===0&&H&&p.push({ssrc:H});let Vt=i.matchPrefix(o,"b=");return Vt.length&&(Vt=Vt[0].indexOf("b=TIAS:")===0?parseInt(Vt[0].substring(7),10):Vt[0].indexOf("b=AS:")===0?1e3*parseInt(Vt[0].substring(5),10)*.95-16e3:void 0,p.forEach(_r=>{_r.maxBitrate=Vt})),p},i.parseRtcpParameters=function(o){const p={},g=i.matchPrefix(o,"a=ssrc:").map(j=>i.parseSsrcMedia(j)).filter(j=>j.attribute==="cname")[0];g&&(p.cname=g.value,p.ssrc=g.ssrc);const b=i.matchPrefix(o,"a=rtcp-rsize");p.reducedSize=b.length>0,p.compound=b.length===0;const A=i.matchPrefix(o,"a=rtcp-mux");return p.mux=A.length>0,p},i.writeRtcpParameters=function(o){let p="";return o.reducedSize&&(p+=`a=rtcp-rsize\r
`),o.mux&&(p+=`a=rtcp-mux\r
`),o.ssrc!==void 0&&o.cname&&(p+="a=ssrc:"+o.ssrc+" cname:"+o.cname+`\r
`),p},i.parseMsid=function(o){let p;const g=i.matchPrefix(o,"a=msid:");if(g.length===1)return p=g[0].substring(7).split(" "),{stream:p[0],track:p[1]};const b=i.matchPrefix(o,"a=ssrc:").map(A=>i.parseSsrcMedia(A)).filter(A=>A.attribute==="msid");return b.length>0?(p=b[0].value.split(" "),{stream:p[0],track:p[1]}):void 0},i.parseSctpDescription=function(o){const p=i.parseMLine(o),g=i.matchPrefix(o,"a=max-message-size:");let b;g.length>0&&(b=parseInt(g[0].substring(19),10)),isNaN(b)&&(b=65536);const A=i.matchPrefix(o,"a=sctp-port:");if(A.length>0)return{port:parseInt(A[0].substring(12),10),protocol:p.fmt,maxMessageSize:b};const j=i.matchPrefix(o,"a=sctpmap:");if(j.length>0){const H=j[0].substring(10).split(" ");return{port:parseInt(H[0],10),protocol:H[1],maxMessageSize:b}}},i.writeSctpDescription=function(o,p){let g=[];return g=o.protocol!=="DTLS/SCTP"?["m="+o.kind+" 9 "+o.protocol+" "+p.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+p.port+`\r
`]:["m="+o.kind+" 9 "+o.protocol+" "+p.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+p.port+" "+p.protocol+` 65535\r
`],p.maxMessageSize!==void 0&&g.push("a=max-message-size:"+p.maxMessageSize+`\r
`),g.join("")},i.generateSessionId=function(){return Math.random().toString().substr(2,22)},i.writeSessionBoilerplate=function(o,p,g){let b;const A=p!==void 0?p:2;return b=o||i.generateSessionId(),`v=0\r
o=`+(g||"thisisadapterortc")+" "+b+" "+A+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},i.getDirection=function(o,p){const g=i.splitLines(o);for(let b=0;b<g.length;b++)switch(g[b]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return g[b].substring(2)}return p?i.getDirection(p):"sendrecv"},i.getKind=function(o){return i.splitLines(o)[0].split(" ")[0].substring(2)},i.isRejected=function(o){return o.split(" ",2)[1]==="0"},i.parseMLine=function(o){const p=i.splitLines(o)[0].substring(2).split(" ");return{kind:p[0],port:parseInt(p[1],10),protocol:p[2],fmt:p.slice(3).join(" ")}},i.parseOLine=function(o){const p=i.matchPrefix(o,"o=")[0].substring(2).split(" ");return{username:p[0],sessionId:p[1],sessionVersion:parseInt(p[2],10),netType:p[3],addressType:p[4],address:p[5]}},i.isValidSDP=function(o){if(typeof o!="string"||o.length===0)return!1;const p=i.splitLines(o);for(let g=0;g<p.length;g++)if(p[g].length<2||p[g].charAt(1)!=="=")return!1;return!0},l.exports=i})(R_);var KE=R_.exports,f_=LE(KE),F_=s({__proto__:null,default:f_},[KE]);function T0(l){if(!l.RTCIceCandidate||l.RTCIceCandidate&&"foundation"in l.RTCIceCandidate.prototype)return;const i=l.RTCIceCandidate;l.RTCIceCandidate=function(o){if(typeof o=="object"&&o.candidate&&o.candidate.indexOf("a=")===0&&((o=JSON.parse(JSON.stringify(o))).candidate=o.candidate.substr(2)),o.candidate&&o.candidate.length){const p=new i(o),g=f_.parseCandidate(o.candidate),b=Object.assign(p,g);return b.toJSON=function(){return{candidate:b.candidate,sdpMid:b.sdpMid,sdpMLineIndex:b.sdpMLineIndex,usernameFragment:b.usernameFragment}},b}return new i(o)},l.RTCIceCandidate.prototype=i.prototype,C(l,"icecandidate",o=>(o.candidate&&Object.defineProperty(o,"candidate",{value:new l.RTCIceCandidate(o.candidate),writable:"false"}),o))}function Mb(l){!l.RTCIceCandidate||l.RTCIceCandidate&&"relayProtocol"in l.RTCIceCandidate.prototype||C(l,"icecandidate",i=>{if(i.candidate){const o=f_.parseCandidate(i.candidate.candidate);o.type==="relay"&&(i.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[o.priority>>24])}return i})}function A0(l,i){if(!l.RTCPeerConnection)return;"sctp"in l.RTCPeerConnection.prototype||Object.defineProperty(l.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});const o=function(j){if(!j||!j.sdp)return!1;const H=f_.splitSections(j.sdp);return H.shift(),H.some(z=>{const $=f_.parseMLine(z);return $&&$.kind==="application"&&$.protocol.indexOf("SCTP")!==-1})},p=function(j){const H=j.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(H===null||H.length<2)return-1;const z=parseInt(H[1],10);return z!=z?-1:z},g=function(j){let H=65536;return i.browser==="firefox"&&(H=i.version<57?j===-1?16384:2147483637:i.version<60?i.version===57?65535:65536:2147483637),H},b=function(j,H){let z=65536;i.browser==="firefox"&&i.version===57&&(z=65535);const $=f_.matchPrefix(j.sdp,"a=max-message-size:");return $.length>0?z=parseInt($[0].substr(19),10):i.browser==="firefox"&&H!==-1&&(z=2147483637),z},A=l.RTCPeerConnection.prototype.setRemoteDescription;l.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,i.browser==="chrome"&&i.version>=76){const{sdpSemantics:j}=this.getConfiguration();j==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(o(arguments[0])){const j=p(arguments[0]),H=g(j),z=b(arguments[0],j);let $;$=H===0&&z===0?Number.POSITIVE_INFINITY:H===0||z===0?Math.max(H,z):Math.min(H,z);const Vt={};Object.defineProperty(Vt,"maxMessageSize",{get:()=>$}),this._sctp=Vt}return A.apply(this,arguments)}}function jS(l){if(!l.RTCPeerConnection||!("createDataChannel"in l.RTCPeerConnection.prototype))return;function i(p,g){const b=p.send;p.send=function(){const A=arguments[0],j=A.length||A.size||A.byteLength;if(p.readyState==="open"&&g.sctp&&j>g.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+g.sctp.maxMessageSize+" bytes)");return b.apply(p,arguments)}}const o=l.RTCPeerConnection.prototype.createDataChannel;l.RTCPeerConnection.prototype.createDataChannel=function(){const p=o.apply(this,arguments);return i(p,this),p},C(l,"datachannel",p=>(i(p.channel,p.target),p))}function eT(l){if(!l.RTCPeerConnection||"connectionState"in l.RTCPeerConnection.prototype)return;const i=l.RTCPeerConnection.prototype;Object.defineProperty(i,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(i,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(o){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),o&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=o)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(o=>{const p=i[o];i[o]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=g=>{const b=g.target;if(b._lastConnectionState!==b.connectionState){b._lastConnectionState=b.connectionState;const A=new Event("connectionstatechange",g);b.dispatchEvent(A)}return g},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),p.apply(this,arguments)}})}function gS(l,i){if(!l.RTCPeerConnection||i.browser==="chrome"&&i.version>=71||i.browser==="safari"&&i.version>=605)return;const o=l.RTCPeerConnection.prototype.setRemoteDescription;l.RTCPeerConnection.prototype.setRemoteDescription=function(p){if(p&&p.sdp&&p.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const g=p.sdp.split(`
`).filter(b=>b.trim()!=="a=extmap-allow-mixed").join(`
`);l.RTCSessionDescription&&p instanceof l.RTCSessionDescription?arguments[0]=new l.RTCSessionDescription({type:p.type,sdp:g}):p.sdp=g}return o.apply(this,arguments)}}function VS(l,i){if(!l.RTCPeerConnection||!l.RTCPeerConnection.prototype)return;const o=l.RTCPeerConnection.prototype.addIceCandidate;o&&o.length!==0&&(l.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(i.browser==="chrome"&&i.version<78||i.browser==="firefox"&&i.version<68||i.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?Promise.resolve():o.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())})}function rS(l,i){if(!l.RTCPeerConnection||!l.RTCPeerConnection.prototype)return;const o=l.RTCPeerConnection.prototype.setLocalDescription;o&&o.length!==0&&(l.RTCPeerConnection.prototype.setLocalDescription=function(){let p=arguments[0]||{};if(typeof p!="object"||p.type&&p.sdp)return o.apply(this,arguments);if(p={type:p.type,sdp:p.sdp},!p.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":p.type="offer";break;default:p.type="answer"}return p.sdp||p.type!=="offer"&&p.type!=="answer"?o.apply(this,[p]):(p.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(g=>o.apply(this,[g]))})}var GT=Object.freeze({__proto__:null,removeExtmapAllowMixed:gS,shimAddIceCandidateNullOrEmpty:VS,shimConnectionState:eT,shimMaxMessageSize:A0,shimParameterlessSetLocalDescription:rS,shimRTCIceCandidate:T0,shimRTCIceCandidateRelayProtocol:Mb,shimSendThrowTypeError:jS});(function({window:l}={},i={shimChrome:!0,shimFirefox:!0,shimSafari:!0}){const o=B,p=function(b){const A={browser:null,version:null};if(b===void 0||!b.navigator)return A.browser="Not a browser.",A;const{navigator:j}=b;if(j.mozGetUserMedia)A.browser="firefox",A.version=_(j.userAgent,/Firefox\/(\d+)\./,1);else if(j.webkitGetUserMedia||b.isSecureContext===!1&&b.webkitRTCPeerConnection)A.browser="chrome",A.version=_(j.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!b.RTCPeerConnection||!j.userAgent.match(/AppleWebKit\/(\d+)\./))return A.browser="Not a supported browser.",A;A.browser="safari",A.version=_(j.userAgent,/AppleWebKit\/(\d+)\./,1),A.supportsUnifiedPlan=b.RTCRtpTransceiver&&"currentDirection"in b.RTCRtpTransceiver.prototype}return A}(l),g={browserDetails:p,commonShim:GT,extractVersion:_,disableLog:P,disableWarnings:x,sdp:F_};switch(p.browser){case"chrome":if(!lE||!aE||!i.shimChrome)return o("Chrome shim is not included in this adapter release."),g;if(p.version===null)return o("Chrome shim can not determine version, not shimming."),g;o("adapter.js shimming chrome."),g.browserShim=lE,VS(l,p),rS(l),_a(l,p),Di(l),aE(l,p),_o(l),tE(l,p),_s(l),_c(l),_m(l),CE(l,p),T0(l),Mb(l),eT(l),A0(l,p),jS(l),gS(l,p);break;case"firefox":if(!IE||!_E||!i.shimFirefox)return o("Firefox shim is not included in this adapter release."),g;o("adapter.js shimming firefox."),g.browserShim=IE,VS(l,p),rS(l),gE(l,p),_E(l,p),cE(l),vf(l),iE(l),rE(l),Fg(l),_d(l),_f(l),uE(l),dE(l),T0(l),eT(l),A0(l,p),jS(l);break;case"safari":if(!Y0||!i.shimSafari)return o("Safari shim is not included in this adapter release."),g;o("adapter.js shimming safari."),g.browserShim=Y0,VS(l,p),rS(l),W0(l),M0(l),QE(l),DE(l),GE(l),mS(l),a_(l),s0(l),T0(l),Mb(l),A0(l,p),jS(l),gS(l,p);break;default:o("Unsupported browser!")}})({window:typeof window>"u"?void 0:window});var t0=function(l){try{return!!l()}catch{return!0}},qT=!t0(function(){var l=(function(){}).bind();return typeof l!="function"||l.hasOwnProperty("prototype")}),xR=qT,F2=Function.prototype,AP=F2.call,j8=xR&&F2.bind.bind(AP,AP),C0=xR?j8:function(l){return function(){return AP.apply(l,arguments)}},mT=C0({}.isPrototypeOf),b1=function(l){return l&&l.Math==Math&&l},J0=b1(typeof globalThis=="object"&&globalThis)||b1(typeof window=="object"&&window)||b1(typeof self=="object"&&self)||b1(typeof o_=="object"&&o_)||function(){return this}()||o_||Function("return this")(),V8=qT,j2=Function.prototype,V2=j2.apply,B2=j2.call,OP=typeof Reflect=="object"&&Reflect.apply||(V8?B2.bind(V2):function(){return B2.apply(V2,arguments)}),G2=C0,B8=G2({}.toString),G8=G2("".slice),rR=function(l){return G8(B8(l),8,-1)},q8=rR,W8=C0,NP=function(l){if(q8(l)==="Function")return W8(l)},PP=typeof document=="object"&&document.all,S1={all:PP,IS_HTMLDDA:PP===void 0&&PP!==void 0},H8=S1.all,U0=S1.IS_HTMLDDA?function(l){return typeof l=="function"||l===H8}:function(l){return typeof l=="function"},mO={},TT=!t0(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!=7}),z8=qT,T1=Function.prototype.call,iS=z8?T1.bind(T1):function(){return T1.apply(T1,arguments)},kP={},q2={}.propertyIsEnumerable,W2=Object.getOwnPropertyDescriptor,K8=W2&&!q2.call({1:2},1);kP.f=K8?function(l){var i=W2(this,l);return!!i&&i.enumerable}:q2;var iR,C1,MR=function(l,i){return{enumerable:!(1&l),configurable:!(2&l),writable:!(4&l),value:i}},Y8=t0,J8=rR,DP=Object,X8=C0("".split),LP=Y8(function(){return!DP("z").propertyIsEnumerable(0)})?function(l){return J8(l)=="String"?X8(l,""):DP(l)}:DP,R1=function(l){return l==null},Q8=R1,$8=TypeError,gO=function(l){if(Q8(l))throw $8("Can't call method on "+l);return l},Z8=LP,tW=gO,UR=function(l){return Z8(tW(l))},H2=U0,eW=S1.all,nT=S1.IS_HTMLDDA?function(l){return typeof l=="object"?l!==null:H2(l)||l===eW}:function(l){return typeof l=="object"?l!==null:H2(l)},FR={},xP=FR,MP=J0,nW=U0,z2=function(l){return nW(l)?l:void 0},TS=function(l,i){return arguments.length<2?z2(xP[l])||z2(MP[l]):xP[l]&&xP[l][i]||MP[l]&&MP[l][i]},jR=typeof navigator<"u"&&String(navigator.userAgent)||"",K2=J0,UP=jR,Y2=K2.process,J2=K2.Deno,X2=Y2&&Y2.versions||J2&&J2.version,Q2=X2&&X2.v8;Q2&&(C1=(iR=Q2.split("."))[0]>0&&iR[0]<4?1:+(iR[0]+iR[1])),!C1&&UP&&(!(iR=UP.match(/Edge\/(\d+)/))||iR[1]>=74)&&(iR=UP.match(/Chrome\/(\d+)/))&&(C1=+iR[1]);var VR=C1,$2=VR,rW=t0,iW=J0.String,_I=!!Object.getOwnPropertySymbols&&!rW(function(){var l=Symbol();return!iW(l)||!(Object(l)instanceof Symbol)||!Symbol.sham&&$2&&$2<41}),Z2=_I&&!Symbol.sham&&typeof Symbol.iterator=="symbol",sW=TS,oW=U0,aW=mT,cW=Object,EO=Z2?function(l){return typeof l=="symbol"}:function(l){var i=sW("Symbol");return oW(i)&&aW(i.prototype,cW(l))},uW=String,yI=function(l){try{return uW(l)}catch{return"Object"}},lW=U0,dW=yI,hW=TypeError,rT=function(l){if(lW(l))return l;throw hW(dW(l)+" is not a function")},pW=rT,fW=R1,FP=function(l,i){var o=l[i];return fW(o)?void 0:pW(o)},jP=iS,VP=U0,BP=nT,mW=TypeError,tU={exports:{}},eU=J0,gW=Object.defineProperty,EW=function(l,i){try{gW(eU,l,{value:i,configurable:!0,writable:!0})}catch{eU[l]=i}return i},nU="__core-js_shared__",GP=J0[nU]||EW(nU,{}),rU=GP;(tU.exports=function(l,i){return rU[l]||(rU[l]=i!==void 0?i:{})})("versions",[]).push({version:"3.31.1",mode:"pure",copyright:"Â© 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.31.1/LICENSE",source:"https://github.com/zloirock/core-js"});var bI=tU.exports,vW=gO,_W=Object,BR=function(l){return _W(vW(l))},yW=BR,bW=C0({}.hasOwnProperty),sS=Object.hasOwn||function(l,i){return bW(yW(l),i)},SW=C0,TW=0,CW=Math.random(),RW=SW(1 .toString),qP=function(l){return"Symbol("+(l===void 0?"":l)+")_"+RW(++TW+CW,36)},IW=bI,iU=sS,wW=qP,AW=_I,OW=Z2,SI=J0.Symbol,WP=IW("wks"),NW=OW?SI.for||SI:SI&&SI.withoutSetter||wW,g0=function(l){return iU(WP,l)||(WP[l]=AW&&iU(SI,l)?SI[l]:NW("Symbol."+l)),WP[l]},PW=iS,sU=nT,oU=EO,kW=FP,DW=function(l,i){var o,p;if(i==="string"&&VP(o=l.toString)&&!BP(p=jP(o,l))||VP(o=l.valueOf)&&!BP(p=jP(o,l))||i!=="string"&&VP(o=l.toString)&&!BP(p=jP(o,l)))return p;throw mW("Can't convert object to primitive value")},LW=TypeError,xW=g0("toPrimitive"),MW=function(l,i){if(!sU(l)||oU(l))return l;var o,p=kW(l,xW);if(p){if(i===void 0&&(i="default"),o=PW(p,l,i),!sU(o)||oU(o))return o;throw LW("Can't convert object to primitive value")}return i===void 0&&(i="number"),DW(l,i)},UW=EO,I1=function(l){var i=MW(l,"string");return UW(i)?i:i+""},aU=nT,HP=J0.document,FW=aU(HP)&&aU(HP.createElement),zP=function(l){return FW?HP.createElement(l):{}},jW=zP,cU=!TT&&!t0(function(){return Object.defineProperty(jW("div"),"a",{get:function(){return 7}}).a!=7}),VW=TT,BW=iS,GW=kP,qW=MR,WW=UR,HW=I1,zW=sS,KW=cU,uU=Object.getOwnPropertyDescriptor;mO.f=VW?uU:function(l,i){if(l=WW(l),i=HW(i),KW)try{return uU(l,i)}catch{}if(zW(l,i))return qW(!BW(GW.f,l,i),l[i])};var YW=t0,JW=U0,XW=/#|\.prototype\./,vO=function(l,i){var o=$W[QW(l)];return o==tH||o!=ZW&&(JW(i)?YW(i):!!i)},QW=vO.normalize=function(l){return String(l).replace(XW,".").toLowerCase()},$W=vO.data={},ZW=vO.NATIVE="N",tH=vO.POLYFILL="P",lU=vO,eH=rT,nH=qT,rH=NP(NP.bind),_O=function(l,i){return eH(l),i===void 0?l:nH?rH(l,i):function(){return l.apply(i,arguments)}},iT={},dU=TT&&t0(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!=42}),iH=nT,sH=String,oH=TypeError,gT=function(l){if(iH(l))return l;throw oH(sH(l)+" is not an object")},aH=TT,cH=cU,uH=dU,w1=gT,hU=I1,lH=TypeError,KP=Object.defineProperty,dH=Object.getOwnPropertyDescriptor,YP="enumerable",JP="configurable",XP="writable";iT.f=aH?uH?function(l,i,o){if(w1(l),i=hU(i),w1(o),typeof l=="function"&&i==="prototype"&&"value"in o&&XP in o&&!o[XP]){var p=dH(l,i);p&&p[XP]&&(l[i]=o.value,o={configurable:JP in o?o[JP]:p[JP],enumerable:YP in o?o[YP]:p[YP],writable:!1})}return KP(l,i,o)}:KP:function(l,i,o){if(w1(l),i=hU(i),w1(o),cH)try{return KP(l,i,o)}catch{}if("get"in o||"set"in o)throw lH("Accessors not supported");return"value"in o&&(l[i]=o.value),l};var hH=iT,pH=MR,sR=TT?function(l,i,o){return hH.f(l,i,pH(1,o))}:function(l,i,o){return l[i]=o,l},A1=J0,fH=OP,mH=NP,gH=U0,EH=mO.f,vH=lU,TI=FR,_H=_O,CI=sR,pU=sS,yH=function(l){var i=function(o,p,g){if(this instanceof i){switch(arguments.length){case 0:return new l;case 1:return new l(o);case 2:return new l(o,p)}return new l(o,p,g)}return fH(l,this,arguments)};return i.prototype=l.prototype,i},Y_=function(l,i){var o,p,g,b,A,j,H,z,$,Vt=l.target,_r=l.global,Fi=l.stat,_l=l.proto,_u=_r?A1:Fi?A1[Vt]:(A1[Vt]||{}).prototype,_h=_r?TI:TI[Vt]||CI(TI,Vt,{})[Vt],_g=_h.prototype;for(b in i)p=!(o=vH(_r?b:Vt+(Fi?".":"#")+b,l.forced))&&_u&&pU(_u,b),j=_h[b],p&&(H=l.dontCallGetSet?($=EH(_u,b))&&$.value:_u[b]),A=p&&H?H:i[b],p&&typeof j==typeof A||(z=l.bind&&p?_H(A,A1):l.wrap&&p?yH(A):_l&&gH(A)?mH(A):A,(l.sham||A&&A.sham||j&&j.sham)&&CI(z,"sham",!0),CI(_h,b,z),_l&&(pU(TI,g=Vt+"Prototype")||CI(TI,g,{}),CI(TI[g],b,A),l.real&&_g&&(o||!_g[b])&&CI(_g,b,A)))},bH=Math.ceil,SH=Math.floor,TH=Math.trunc||function(l){var i=+l;return(i>0?SH:bH)(i)},QP=function(l){var i=+l;return i!=i||i===0?0:TH(i)},CH=QP,RH=Math.max,IH=Math.min,fU=function(l,i){var o=CH(l);return o<0?RH(o+i,0):IH(o,i)},wH=QP,AH=Math.min,OH=function(l){return l>0?AH(wH(l),9007199254740991):0},GR=function(l){return OH(l.length)},NH=UR,PH=fU,kH=GR,mU=function(l){return function(i,o,p){var g,b=NH(i),A=kH(b),j=PH(p,A);if(l&&o!=o){for(;A>j;)if((g=b[j++])!=g)return!0}else for(;A>j;j++)if((l||j in b)&&b[j]===o)return l||j||0;return!l&&-1}},gU={includes:mU(!0),indexOf:mU(!1)},DH=gU.includes;Y_({target:"Array",proto:!0,forced:t0(function(){return!Array(1).includes()})},{includes:function(l){return DH(this,l,arguments.length>1?arguments[1]:void 0)}});var LH=FR,qR=function(l){return LH[l+"Prototype"]},xH=qR("Array").includes,MH=nT,UH=rR,FH=g0("match"),jH=function(l){var i;return MH(l)&&((i=l[FH])!==void 0?!!i:UH(l)=="RegExp")},VH=TypeError,EU={};EU[g0("toStringTag")]="z";var $P=String(EU)==="[object z]",BH=$P,GH=U0,O1=rR,qH=g0("toStringTag"),WH=Object,HH=O1(function(){return arguments}())=="Arguments",WR=BH?O1:function(l){var i,o,p;return l===void 0?"Undefined":l===null?"Null":typeof(o=function(g,b){try{return g[b]}catch{}}(i=WH(l),qH))=="string"?o:HH?O1(i):(p=O1(i))=="Object"&&GH(i.callee)?"Arguments":p},zH=WR,KH=String,WT=function(l){if(zH(l)==="Symbol")throw TypeError("Cannot convert a Symbol value to a string");return KH(l)},YH=g0("match"),JH=Y_,XH=function(l){if(jH(l))throw VH("The method doesn't accept regular expressions");return l},QH=gO,vU=WT,$H=function(l){var i=/./;try{"/./"[l](i)}catch{try{return i[YH]=!1,"/./"[l](i)}catch{}}return!1},ZH=C0("".indexOf);JH({target:"String",proto:!0,forced:!$H("includes")},{includes:function(l){return!!~ZH(vU(QH(this)),vU(XH(l)),arguments.length>1?arguments[1]:void 0)}});var _z=qR("String").includes,_U=mT,tK=xH,eK=_z,ZP=Array.prototype,_k=String.prototype,VE=LE(function(l){var i=l.includes;return l===ZP||_U(ZP,l)&&i===ZP.includes?tK:typeof l=="string"||l===_k||_U(_k,l)&&i===_k.includes?eK:i}),yU={exports:{}},nK=Y_,rK=TT,bU=iT.f;nK({target:"Object",stat:!0,forced:Object.defineProperty!==bU,sham:!rK},{defineProperty:bU});var SU=FR.Object,iK=yU.exports=function(l,i,o){return SU.defineProperty(l,i,o)};SU.defineProperty.sham&&(iK.sham=!0);var sK=LE(yU.exports),oK=rR,tD=Array.isArray||function(l){return oK(l)=="Array"},aK=TypeError,cK=I1,uK=iT,lK=MR,TU=function(l,i,o){var p=cK(i);p in l?uK.f(l,p,lK(0,o)):l[p]=o},dK=U0,sD=GP,hK=C0(Function.toString);dK(sD.inspectSource)||(sD.inspectSource=function(l){return hK(l)});var CU=sD.inspectSource,pK=C0,fK=t0,RU=U0,mK=WR,gK=CU,IU=function(){},EK=[],wU=TS("Reflect","construct"),uD=/^\s*(?:class|function)\b/,vK=pK(uD.exec),_K=!uD.exec(IU),yO=function(l){if(!RU(l))return!1;try{return wU(IU,EK,l),!0}catch{return!1}},AU=function(l){if(!RU(l))return!1;switch(mK(l)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return _K||!!vK(uD,gK(l))}catch{return!0}};AU.sham=!0;var OU=!wU||fK(function(){var l;return yO(yO.call)||!yO(Object)||!yO(function(){l=!0})||l})?AU:yO,NU=tD,yK=OU,bK=nT,SK=g0("species"),PU=Array,TK=function(l){var i;return NU(l)&&(i=l.constructor,(yK(i)&&(i===PU||NU(i.prototype))||bK(i)&&(i=i[SK])===null)&&(i=void 0)),i===void 0?PU:i},kU=function(l,i){return new(TK(l))(i===0?0:i)},CK=t0,RK=VR,IK=g0("species"),wK=Y_,AK=t0,OK=tD,NK=nT,PK=BR,kK=GR,DU=function(l){if(l>9007199254740991)throw aK("Maximum allowed index exceeded");return l},LU=TU,DK=kU,LK=function(l){return RK>=51||!CK(function(){var i=[];return(i.constructor={})[IK]=function(){return{foo:1}},i[l](Boolean).foo!==1})},xK=VR,xU=g0("isConcatSpreadable"),MK=xK>=51||!AK(function(){var l=[];return l[xU]=!1,l.concat()[0]!==l}),UK=function(l){if(!NK(l))return!1;var i=l[xU];return i!==void 0?!!i:OK(l)};wK({target:"Array",proto:!0,arity:1,forced:!MK||!LK("concat")},{concat:function(l){var i,o,p,g,b,A=PK(this),j=DK(A,0),H=0;for(i=-1,p=arguments.length;i<p;i++)if(UK(b=i===-1?A:arguments[i]))for(g=kK(b),DU(H+g),o=0;o<g;o++,H++)o in b&&LU(j,H,b[o]);else DU(H+1),LU(j,H++,b);return j.length=H,j}});var ED={},N1={},vD=sS,FK=UR,jK=gU.indexOf,VK=N1,MU=C0([].push),UU=function(l,i){var o,p=FK(l),g=0,b=[];for(o in p)!vD(VK,o)&&vD(p,o)&&MU(b,o);for(;i.length>g;)vD(p,o=i[g++])&&(~jK(b,o)||MU(b,o));return b},_D=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],BK=UU,GK=_D,FU=Object.keys||function(l){return BK(l,GK)},qK=TT,WK=dU,HK=iT,zK=gT,KK=UR,YK=FU;ED.f=qK&&!WK?Object.defineProperties:function(l,i){zK(l);for(var o,p=KK(i),g=YK(i),b=g.length,A=0;b>A;)HK.f(l,o=g[A++],p[o]);return l};var P1,jU=TS("document","documentElement"),JK=qP,VU=bI("keys"),k1=function(l){return VU[l]||(VU[l]=JK(l))},XK=gT,QK=ED,BU=_D,$K=N1,ZK=jU,t7=zP,yD="prototype",SD="script",GU=k1("IE_PROTO"),TD=function(){},qU=function(l){return"<"+SD+">"+l+"</"+SD+">"},WU=function(l){l.write(qU("")),l.close();var i=l.parentWindow.Object;return l=null,i},D1=function(){try{P1=new ActiveXObject("htmlfile")}catch{}var l,i,o;D1=typeof document<"u"?document.domain&&P1?WU(P1):(i=t7("iframe"),o="java"+SD+":",i.style.display="none",ZK.appendChild(i),i.src=String(o),(l=i.contentWindow.document).open(),l.write(qU("document.F=Object")),l.close(),l.F):WU(P1);for(var p=BU.length;p--;)delete D1[yD][BU[p]];return D1()};$K[GU]=!0;var L1=Object.create||function(l,i){var o;return l!==null?(TD[yD]=XK(l),o=new TD,TD[yD]=null,o[GU]=l):o=D1(),i===void 0?o:QK.f(o,i)},x1={},e7=UU,n7=_D.concat("length","prototype");x1.f=Object.getOwnPropertyNames||function(l){return e7(l,n7)};var HU={},zU=fU,r7=GR,i7=TU,s7=Array,o7=Math.max,KU=function(l,i,o){for(var p=r7(l),g=zU(i,p),b=zU(o===void 0?p:o,p),A=s7(o7(b-g,0)),j=0;g<b;g++,j++)i7(A,j,l[g]);return A.length=j,A},a7=rR,c7=UR,YU=x1.f,u7=KU,JU=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];HU.f=function(l){return JU&&a7(l)=="Window"?function(i){try{return YU(i)}catch{return u7(JU)}}(l):YU(c7(l))};var M1={};M1.f=Object.getOwnPropertySymbols;var l7=sR,bO=function(l,i,o,p){return p&&p.enumerable?l[i]=o:l7(l,i,o),l},d7=iT,XU=function(l,i,o){return d7.f(l,i,o)},RI={},h7=g0;RI.f=h7;var U1,SO,F1,QU=FR,p7=sS,f7=RI,m7=iT.f,I0=function(l){var i=QU.Symbol||(QU.Symbol={});p7(i,l)||m7(i,l,{value:f7.f(l)})},g7=iS,E7=TS,v7=g0,_7=bO,$U=function(){var l=E7("Symbol"),i=l&&l.prototype,o=i&&i.valueOf,p=v7("toPrimitive");i&&!i[p]&&_7(i,p,function(g){return g7(o,this)},{arity:1})},y7=WR,b7=$P?{}.toString:function(){return"[object "+y7(this)+"]"},S7=$P,T7=iT.f,C7=sR,R7=sS,I7=b7,ZU=g0("toStringTag"),II=function(l,i,o,p){if(l){var g=o?l:l.prototype;R7(g,ZU)||T7(g,ZU,{configurable:!0,value:i}),p&&!S7&&C7(g,"toString",I7)}},w7=U0,tF=J0.WeakMap,A7=w7(tF)&&/native code/.test(String(tF)),eF=J0,O7=nT,N7=sR,CD=sS,RD=GP,P7=k1,k7=N1,nF="Object already initialized",ID=eF.TypeError,D7=eF.WeakMap;if(A7||RD.state){var CT=RD.state||(RD.state=new D7);CT.get=CT.get,CT.has=CT.has,CT.set=CT.set,U1=function(l,i){if(CT.has(l))throw ID(nF);return i.facade=l,CT.set(l,i),i},SO=function(l){return CT.get(l)||{}},F1=function(l){return CT.has(l)}}else{var wI=P7("state");k7[wI]=!0,U1=function(l,i){if(CD(l,wI))throw ID(nF);return i.facade=l,N7(l,wI,i),i},SO=function(l){return CD(l,wI)?l[wI]:{}},F1=function(l){return CD(l,wI)}}var j1={set:U1,get:SO,has:F1,enforce:function(l){return F1(l)?SO(l):U1(l,{})},getterFor:function(l){return function(i){var o;if(!O7(i)||(o=SO(i)).type!==l)throw ID("Incompatible receiver, "+l+" required");return o}}},L7=_O,x7=LP,M7=BR,U7=GR,F7=kU,rF=C0([].push),oR=function(l){var i=l==1,o=l==2,p=l==3,g=l==4,b=l==6,A=l==7,j=l==5||b;return function(H,z,$,Vt){for(var _r,Fi,_l=M7(H),_u=x7(_l),_h=L7(z,$),_g=U7(_u),eE=0,oE=Vt||F7,SE=i?oE(H,_g):o||A?oE(H,0):void 0;_g>eE;eE++)if((j||eE in _u)&&(Fi=_h(_r=_u[eE],eE,_l),l))if(i)SE[eE]=Fi;else if(Fi)switch(l){case 3:return!0;case 5:return _r;case 6:return eE;case 2:rF(SE,_r)}else switch(l){case 4:return!1;case 7:rF(SE,_r)}return b?-1:p||g?g:SE}},j7={forEach:oR(0),map:oR(1),filter:oR(2),some:oR(3),every:oR(4),find:oR(5),findIndex:oR(6),filterReject:oR(7)},V1=Y_,wD=J0,AD=iS,V7=C0,AI=TT,OI=_I,B7=t0,X0=sS,G7=mT,OD=gT,B1=UR,ND=I1,q7=WT,PD=MR,TO=L1,iF=FU,W7=x1,sF=HU,H7=M1,oF=mO,aF=iT,z7=ED,cF=kP,uF=bO,K7=XU,DD=bI,lF=N1,dF=qP,Y7=g0,J7=RI,X7=I0,Q7=$U,$7=II,hF=j1,G1=j7.forEach,CS=k1("hidden"),q1="Symbol",CO="prototype",Z7=hF.set,pF=hF.getterFor(q1),ET=Object[CO],HR=wD.Symbol,W1=HR&&HR[CO],t9=wD.TypeError,LD=wD.QObject,fF=oF.f,zR=aF.f,mF=sF.f,e9=cF.f,gF=V7([].push),HT=DD("symbols"),RO=DD("op-symbols"),n9=DD("wks"),xD=!LD||!LD[CO]||!LD[CO].findChild,MD=AI&&B7(function(){return TO(zR({},"a",{get:function(){return zR(this,"a",{value:7}).a}})).a!=7})?function(l,i,o){var p=fF(ET,i);p&&delete ET[i],zR(l,i,o),p&&l!==ET&&zR(ET,i,p)}:zR,UD=function(l,i){var o=HT[l]=TO(W1);return Z7(o,{type:q1,tag:l,description:i}),AI||(o.description=i),o},H1=function(l,i,o){l===ET&&H1(RO,i,o),OD(l);var p=ND(i);return OD(o),X0(HT,p)?(o.enumerable?(X0(l,CS)&&l[CS][p]&&(l[CS][p]=!1),o=TO(o,{enumerable:PD(0,!1)})):(X0(l,CS)||zR(l,CS,PD(1,{})),l[CS][p]=!0),MD(l,p,o)):zR(l,p,o)},FD=function(l,i){OD(l);var o=B1(i),p=iF(o).concat(yF(o));return G1(p,function(g){AI&&!AD(EF,o,g)||H1(l,g,o[g])}),l},EF=function(l){var i=ND(l),o=AD(e9,this,i);return!(this===ET&&X0(HT,i)&&!X0(RO,i))&&(!(o||!X0(this,i)||!X0(HT,i)||X0(this,CS)&&this[CS][i])||o)},vF=function(l,i){var o=B1(l),p=ND(i);if(o!==ET||!X0(HT,p)||X0(RO,p)){var g=fF(o,p);return!g||!X0(HT,p)||X0(o,CS)&&o[CS][p]||(g.enumerable=!0),g}},_F=function(l){var i=mF(B1(l)),o=[];return G1(i,function(p){X0(HT,p)||X0(lF,p)||gF(o,p)}),o},yF=function(l){var i=l===ET,o=mF(i?RO:B1(l)),p=[];return G1(o,function(g){!X0(HT,g)||i&&!X0(ET,g)||gF(p,HT[g])}),p};OI||(HR=function(){if(G7(W1,this))throw t9("Symbol is not a constructor");var l=arguments.length&&arguments[0]!==void 0?q7(arguments[0]):void 0,i=dF(l),o=function(p){this===ET&&AD(o,RO,p),X0(this,CS)&&X0(this[CS],i)&&(this[CS][i]=!1),MD(this,i,PD(1,p))};return AI&&xD&&MD(ET,i,{configurable:!0,set:o}),UD(i,l)},uF(W1=HR[CO],"toString",function(){return pF(this).tag}),uF(HR,"withoutSetter",function(l){return UD(dF(l),l)}),cF.f=EF,aF.f=H1,z7.f=FD,oF.f=vF,W7.f=sF.f=_F,H7.f=yF,J7.f=function(l){return UD(Y7(l),l)},AI&&K7(W1,"description",{configurable:!0,get:function(){return pF(this).description}})),V1({global:!0,constructor:!0,wrap:!0,forced:!OI,sham:!OI},{Symbol:HR}),G1(iF(n9),function(l){X7(l)}),V1({target:q1,stat:!0,forced:!OI},{useSetter:function(){xD=!0},useSimple:function(){xD=!1}}),V1({target:"Object",stat:!0,forced:!OI,sham:!AI},{create:function(l,i){return i===void 0?TO(l):FD(TO(l),i)},defineProperty:H1,defineProperties:FD,getOwnPropertyDescriptor:vF}),V1({target:"Object",stat:!0,forced:!OI},{getOwnPropertyNames:_F}),Q7(),$7(HR,q1),lF[CS]=!0;var bF=_I&&!!Symbol.for&&!!Symbol.keyFor,r9=Y_,i9=TS,s9=sS,o9=WT,SF=bI,a9=bF,VD=SF("string-to-symbol-registry"),c9=SF("symbol-to-string-registry");r9({target:"Symbol",stat:!0,forced:!a9},{for:function(l){var i=o9(l);if(s9(VD,i))return VD[i];var o=i9("Symbol")(i);return VD[i]=o,c9[o]=i,o}});var u9=Y_,l9=sS,d9=EO,h9=yI,p9=bF,TF=bI("symbol-to-string-registry");u9({target:"Symbol",stat:!0,forced:!p9},{keyFor:function(l){if(!d9(l))throw TypeError(h9(l)+" is not a symbol");if(l9(TF,l))return TF[l]}});var CF=C0([].slice),RF=tD,f9=U0,IF=rR,m9=WT,wF=C0([].push),g9=Y_,AF=TS,OF=OP,E9=iS,IO=C0,NF=t0,PF=U0,kF=EO,DF=CF,v9=function(l){if(f9(l))return l;if(RF(l)){for(var i=l.length,o=[],p=0;p<i;p++){var g=l[p];typeof g=="string"?wF(o,g):typeof g!="number"&&IF(g)!="Number"&&IF(g)!="String"||wF(o,m9(g))}var b=o.length,A=!0;return function(j,H){if(A)return A=!1,H;if(RF(this))return H;for(var z=0;z<b;z++)if(o[z]===j)return H}}},_9=_I,y9=String,aR=AF("JSON","stringify"),z1=IO(/./.exec),LF=IO("".charAt),b9=IO("".charCodeAt),S9=IO("".replace),T9=IO(1 .toString),C9=/[\uD800-\uDFFF]/g,xF=/^[\uD800-\uDBFF]$/,MF=/^[\uDC00-\uDFFF]$/,UF=!_9||NF(function(){var l=AF("Symbol")();return aR([l])!="[null]"||aR({a:l})!="{}"||aR(Object(l))!="{}"}),FF=NF(function(){return aR("\uDF06\uD834")!=='"\\udf06\\ud834"'||aR("\uDEAD")!=='"\\udead"'}),R9=function(l,i){var o=DF(arguments),p=v9(i);if(PF(p)||l!==void 0&&!kF(l))return o[1]=function(g,b){if(PF(p)&&(b=E9(p,this,y9(g),b)),!kF(b))return b},OF(aR,null,o)},I9=function(l,i,o){var p=LF(o,i-1),g=LF(o,i+1);return z1(xF,l)&&!z1(MF,g)||z1(MF,l)&&!z1(xF,p)?"\\u"+T9(b9(l,0),16):l};aR&&g9({target:"JSON",stat:!0,arity:3,forced:UF||FF},{stringify:function(l,i,o){var p=DF(arguments),g=OF(UF?R9:aR,null,p);return FF&&typeof g=="string"?S9(g,C9,I9):g}});var jF=M1,w9=BR;Y_({target:"Object",stat:!0,forced:!_I||t0(function(){jF.f(1)})},{getOwnPropertySymbols:function(l){var i=jF.f;return i?i(w9(l)):[]}}),I0("asyncIterator"),I0("hasInstance"),I0("isConcatSpreadable"),I0("iterator"),I0("match"),I0("matchAll"),I0("replace"),I0("search"),I0("species"),I0("split");var A9=$U;I0("toPrimitive"),A9();var O9=TS,N9=II;I0("toStringTag"),N9(O9("Symbol"),"Symbol"),I0("unscopables"),II(J0.JSON,"JSON",!0);var KR,VF,BF,P9=FR.Symbol,NI={},BD=TT,k9=sS,GF=Function.prototype,D9=BD&&Object.getOwnPropertyDescriptor,GD=k9(GF,"name"),qF={EXISTS:GD,PROPER:GD&&(function(){}).name==="something",CONFIGURABLE:GD&&(!BD||BD&&D9(GF,"name").configurable)},L9=!t0(function(){function l(){}return l.prototype.constructor=null,Object.getPrototypeOf(new l)!==l.prototype}),x9=sS,M9=U0,U9=BR,F9=L9,WF=k1("IE_PROTO"),WD=Object,j9=WD.prototype,HD=F9?WD.getPrototypeOf:function(l){var i=U9(l);if(x9(i,WF))return i[WF];var o=i.constructor;return M9(o)&&i instanceof o?o.prototype:i instanceof WD?j9:null},V9=t0,B9=U0,G9=nT,q9=L1,HF=HD,W9=bO,zD=g0("iterator"),zF=!1;[].keys&&("next"in(BF=[].keys())?(VF=HF(HF(BF)))!==Object.prototype&&(KR=VF):zF=!0);var H9=!G9(KR)||V9(function(){var l={};return KR[zD].call(l)!==l});B9((KR=H9?{}:q9(KR))[zD])||W9(KR,zD,function(){return this});var KF={IteratorPrototype:KR,BUGGY_SAFARI_ITERATORS:zF},z9=KF.IteratorPrototype,K9=L1,Y9=MR,J9=II,X9=NI,Q9=function(){return this},$9=C0,Z9=rT,tY=U0,eY=String,nY=TypeError,rY=function(l,i,o){try{return $9(Z9(Object.getOwnPropertyDescriptor(l,i)[o]))}catch{}},iY=gT,sY=function(l){if(typeof l=="object"||tY(l))return l;throw nY("Can't set "+eY(l)+" as a prototype")},oY=Object.setPrototypeOf||("__proto__"in{}?function(){var l,i=!1,o={};try{(l=rY(Object.prototype,"__proto__","set"))(o,[]),i=o instanceof Array}catch{}return function(p,g){return iY(p),sY(g),i?l(p,g):p.__proto__=g,p}}():void 0),aY=Y_,cY=iS,uY=qF,lY=function(l,i,o,p){var g=i+" Iterator";return l.prototype=K9(z9,{next:Y9(+!p,o)}),J9(l,g,!1,!0),X9[g]=Q9,l},dY=HD,hY=II,YF=bO,JF=NI,pY=KF,fY=uY.PROPER,K1=pY.BUGGY_SAFARI_ITERATORS,KD=g0("iterator"),XF="keys",Y1="values",QF="entries",mY=function(){return this},$F=function(l,i,o,p,g,b,A){lY(o,i,p);var j,H,z,$=function(_g){if(_g===g&&_u)return _u;if(!K1&&_g in Fi)return Fi[_g];switch(_g){case XF:case Y1:case QF:return function(){return new o(this,_g)}}return function(){return new o(this)}},Vt=i+" Iterator",_r=!1,Fi=l.prototype,_l=Fi[KD]||Fi["@@iterator"]||g&&Fi[g],_u=!K1&&_l||$(g),_h=i=="Array"&&Fi.entries||_l;if(_h&&(j=dY(_h.call(new l)))!==Object.prototype&&j.next&&(hY(j,Vt,!0,!0),JF[Vt]=mY),fY&&g==Y1&&_l&&_l.name!==Y1&&(_r=!0,_u=function(){return cY(_l,this)}),g)if(H={values:$(Y1),keys:b?_u:$(XF),entries:$(QF)},A)for(z in H)(K1||_r||!(z in Fi))&&YF(Fi,z,H[z]);else aY({target:i,proto:!0,forced:K1||_r},H);return A&&Fi[KD]!==_u&&YF(Fi,KD,_u,{name:g}),JF[i]=_u,H},ZF=function(l,i){return{value:l,done:i}},gY=UR,_j=NI,$j=j1;iT.f;var EY=$F,t3=ZF,e3="Array Iterator",vY=$j.set,_Y=$j.getterFor(e3);EY(Array,"Array",function(l,i){vY(this,{type:e3,target:gY(l),index:0,kind:i})},function(){var l=_Y(this),i=l.target,o=l.kind,p=l.index++;return!i||p>=i.length?(l.target=void 0,t3(void 0,!0)):t3(o=="keys"?p:o=="values"?i[p]:[p,i[p]],!1)},"values"),_j.Arguments=_j.Array;var yY={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},bY=J0,SY=WR,TY=sR,n3=NI,r3=g0("toStringTag");for(var YD in yY){var i3=bY[YD],JD=i3&&i3.prototype;JD&&SY(JD)!==r3&&TY(JD,r3,YD),n3[YD]=n3.Array}var CY=P9,RY=g0,IY=iT.f,s3=RY("metadata"),o3=Function.prototype;o3[s3]===void 0&&IY(o3,s3,{value:null}),I0("dispose"),I0("metadata");var wY=CY;I0("asyncDispose");var AY=C0,XD=TS("Symbol"),OY=XD.keyFor,NY=AY(XD.prototype.valueOf),a3=XD.isRegisteredSymbol||function(l){try{return OY(NY(l))!==void 0}catch{return!1}};Y_({target:"Symbol",stat:!0},{isRegisteredSymbol:a3});for(var PY=bI,c3=TS,kY=C0,DY=EO,LY=g0,J1=c3("Symbol"),u3=J1.isWellKnownSymbol,l3=c3("Object","getOwnPropertyNames"),xY=kY(J1.prototype.valueOf),d3=PY("wks"),QD=0,h3=l3(J1),MY=h3.length;QD<MY;QD++)try{var p3=h3[QD];DY(J1[p3])&&LY(p3)}catch{}var f3=function(l){if(u3&&u3(l))return!0;try{for(var i=xY(l),o=0,p=l3(d3),g=p.length;o<g;o++)if(d3[p[o]]==i)return!0}catch{}return!1};Y_({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:f3}),I0("matcher"),I0("observable"),Y_({target:"Symbol",stat:!0,name:"isRegisteredSymbol"},{isRegistered:a3}),Y_({target:"Symbol",stat:!0,name:"isWellKnownSymbol",forced:!0},{isWellKnown:f3}),I0("metadataKey"),I0("patternMatch"),I0("replaceAll");var PI=LE(wY),$D=C0,UY=QP,FY=WT,jY=gO,VY=$D("".charAt),m3=$D("".charCodeAt),BY=$D("".slice),g3=function(l){return function(i,o){var p,g,b=FY(jY(i)),A=UY(o),j=b.length;return A<0||A>=j?l?"":void 0:(p=m3(b,A))<55296||p>56319||A+1===j||(g=m3(b,A+1))<56320||g>57343?l?VY(b,A):p:l?BY(b,A,A+2):g-56320+(p-55296<<10)+65536}},GY={codeAt:g3(!1),charAt:g3(!0)}.charAt,qY=WT,E3=j1,WY=$F,v3=ZF,_3="String Iterator",HY=E3.set,zY=E3.getterFor(_3);WY(String,"String",function(l){HY(this,{type:_3,string:qY(l),index:0})},function(){var l,i=zY(this),o=i.string,p=i.index;return p>=o.length?v3(void 0,!0):(l=GY(o,p),i.index+=l.length,v3(l,!1))});var y3=LE(RI.f("iterator"));function wO(l){return wO=typeof PI=="function"&&typeof y3=="symbol"?function(i){return typeof i}:function(i){return i&&typeof PI=="function"&&i.constructor===PI&&i!==PI.prototype?"symbol":typeof i},wO(l)}var KY=LE(RI.f("toPrimitive"));function YY(l){var i=function(o,p){if(wO(o)!=="object"||o===null)return o;var g=o[KY];if(g!==void 0){var b=g.call(o,p||"default");if(wO(b)!=="object")return b;throw new TypeError("@@toPrimitive must return a primitive value.")}return(p==="string"?String:Number)(o)}(l,"string");return wO(i)==="symbol"?i:String(i)}function _e(l,i,o){return(i=YY(i))in l?sK(l,i,{value:o,enumerable:!0,configurable:!0,writable:!0}):l[i]=o,l}var JY=qR("Array").keys,XY=WR,QY=sS,$Y=mT,ZY=JY,ZD=Array.prototype,tJ={DOMTokenList:!0,NodeList:!0},RS=LE(function(l){var i=l.keys;return l===ZD||$Y(ZD,l)&&i===ZD.keys||QY(tJ,XY(l))?ZY:i}),b3=yI,eJ=TypeError,S3=KU,nJ=Math.floor,tL=function(l,i){var o=l.length,p=nJ(o/2);return o<8?rJ(l,i):iJ(l,tL(S3(l,0,p),i),tL(S3(l,p),i),i)},rJ=function(l,i){for(var o,p,g=l.length,b=1;b<g;){for(p=b,o=l[b];p&&i(l[p-1],o)>0;)l[p]=l[--p];p!==b++&&(l[p]=o)}return l},iJ=function(l,i,o,p){for(var g=i.length,b=o.length,A=0,j=0;A<g||j<b;)l[A+j]=A<g&&j<b?p(i[A],o[j])<=0?i[A++]:o[j++]:A<g?i[A++]:o[j++];return l},sJ=tL,oJ=t0,T3=function(l,i){var o=[][l];return!!o&&oJ(function(){o.call(null,i||function(){return 1},1)})},C3=jR.match(/firefox\/(\d+)/i),aJ=!!C3&&+C3[1],cJ=/MSIE|Trident/.test(jR),R3=jR.match(/AppleWebKit\/(\d+)\./),uJ=!!R3&&+R3[1],lJ=Y_,I3=C0,dJ=rT,hJ=BR,w3=GR,pJ=function(l,i){if(!delete l[i])throw eJ("Cannot delete property "+b3(i)+" of "+b3(l))},A3=WT,eL=t0,fJ=sJ,mJ=T3,O3=aJ,gJ=cJ,N3=VR,P3=uJ,cR=[],k3=I3(cR.sort),EJ=I3(cR.push),vJ=eL(function(){cR.sort(void 0)}),_J=eL(function(){cR.sort(null)}),yJ=mJ("sort"),D3=!eL(function(){if(N3)return N3<70;if(!(O3&&O3>3)){if(gJ)return!0;if(P3)return P3<603;var l,i,o,p,g="";for(l=65;l<76;l++){switch(i=String.fromCharCode(l),l){case 66:case 69:case 70:case 72:o=3;break;case 68:case 71:o=4;break;default:o=2}for(p=0;p<47;p++)cR.push({k:i+p,v:o})}for(cR.sort(function(b,A){return A.v-b.v}),p=0;p<cR.length;p++)i=cR[p].k.charAt(0),g.charAt(g.length-1)!==i&&(g+=i);return g!=="DGBEFHACIJK"}});lJ({target:"Array",proto:!0,forced:vJ||!_J||!yJ||!D3},{sort:function(l){l!==void 0&&dJ(l);var i=hJ(this);if(D3)return l===void 0?k3(i):k3(i,l);var o,p,g=[],b=w3(i);for(p=0;p<b;p++)p in i&&EJ(g,i[p]);for(fJ(g,function(A){return function(j,H){return H===void 0?-1:j===void 0?1:A!==void 0?+A(j,H)||0:A3(j)>A3(H)?1:-1}}(l)),o=w3(g),p=0;p<o;)i[p]=g[p++];for(;p<b;)pJ(i,p++);return i}});var bJ=qR("Array").sort,SJ=mT,TJ=bJ,nL=Array.prototype,AO=LE(function(l){var i=l.sort;return l===nL||SJ(nL,l)&&i===nL.sort?TJ:i}),CJ=TS,RJ=x1,IJ=M1,wJ=gT,AJ=C0([].concat),OJ=CJ("Reflect","ownKeys")||function(l){var i=RJ.f(wJ(l)),o=IJ.f;return o?AJ(i,o(l)):i},L3=sS,NJ=OJ,PJ=mO,kJ=iT,DJ=nT,LJ=sR,x3=Error,xJ=C0("".replace),MJ=String(x3("zxcasd").stack),M3=/\n\s*at [^:]*:[^\n]*/,UJ=M3.test(MJ),FJ=MR,jJ=!t0(function(){var l=Error("a");return!("stack"in l)||(Object.defineProperty(l,"stack",FJ(1,7)),l.stack!==7)}),VJ=sR,BJ=function(l,i){if(UJ&&typeof l=="string"&&!x3.prepareStackTrace)for(;i--;)l=xJ(l,M3,"");return l},GJ=jJ,U3=Error.captureStackTrace,qJ=NI,WJ=g0("iterator"),HJ=Array.prototype,zJ=WR,F3=FP,KJ=R1,YJ=NI,JJ=g0("iterator"),j3=function(l){if(!KJ(l))return F3(l,JJ)||F3(l,"@@iterator")||YJ[zJ(l)]},XJ=iS,QJ=rT,$J=gT,ZJ=yI,tX=j3,eX=TypeError,nX=iS,V3=gT,rX=FP,iX=_O,sX=iS,oX=gT,aX=yI,cX=function(l){return l!==void 0&&(qJ.Array===l||HJ[WJ]===l)},uX=GR,B3=mT,lX=function(l,i){var o=arguments.length<2?tX(l):i;if(QJ(o))return $J(XJ(o,l));throw eX(ZJ(l)+" is not iterable")},dX=j3,G3=function(l,i,o){var p,g;V3(l);try{if(!(p=rX(l,"return"))){if(i==="throw")throw o;return o}p=nX(p,l)}catch(b){g=!0,p=b}if(i==="throw")throw o;if(g)throw p;return V3(p),o},hX=TypeError,X1=function(l,i){this.stopped=l,this.result=i},q3=X1.prototype,OO=function(l,i,o){var p,g,b,A,j,H,z,$=o&&o.that,Vt=!(!o||!o.AS_ENTRIES),_r=!(!o||!o.IS_RECORD),Fi=!(!o||!o.IS_ITERATOR),_l=!(!o||!o.INTERRUPTED),_u=iX(i,$),_h=function(eE){return p&&G3(p,"normal",eE),new X1(!0,eE)},_g=function(eE){return Vt?(oX(eE),_l?_u(eE[0],eE[1],_h):_u(eE[0],eE[1])):_l?_u(eE,_h):_u(eE)};if(_r)p=l.iterator;else if(Fi)p=l;else{if(!(g=dX(l)))throw hX(aX(l)+" is not iterable");if(cX(g)){for(b=0,A=uX(l);A>b;b++)if((j=_g(l[b]))&&B3(q3,j))return j;return new X1(!1)}p=lX(l,g)}for(H=_r?l.next:p.next;!(z=sX(H,p)).done;){try{j=_g(z.value)}catch(eE){G3(p,"throw",eE)}if(typeof j=="object"&&j&&B3(q3,j))return j}return new X1(!1)},pX=WT,fX=Y_,mX=mT,gX=HD,Q1=oY,EX=function(l,i,o){for(var p=NJ(i),g=kJ.f,b=PJ.f,A=0;A<p.length;A++){var j=p[A];L3(l,j)||o&&L3(o,j)||g(l,j,b(i,j))}},W3=L1,rL=sR,iL=MR,vX=function(l,i){DJ(i)&&"cause"in i&&LJ(l,"cause",i.cause)},_X=function(l,i,o,p){GJ&&(U3?U3(l,i):VJ(l,"stack",BJ(o,p)))},yX=OO,bX=function(l,i){return l===void 0?arguments.length<2?"":i:pX(l)},SX=g0("toStringTag"),$1=Error,TX=[].push,kI=function(l,i){var o,p=mX(sL,this);Q1?o=Q1($1(),p?gX(this):sL):(o=p?this:W3(sL),rL(o,SX,"Error")),i!==void 0&&rL(o,"message",bX(i)),_X(o,kI,o.stack,1),arguments.length>2&&vX(o,arguments[2]);var g=[];return yX(l,TX,{that:g}),rL(o,"errors",g),o};Q1?Q1(kI,$1):EX(kI,$1,{name:!0});var sL=kI.prototype=W3($1.prototype,{constructor:iL(1,kI),message:iL(1,""),name:iL(1,"AggregateError")});fX({global:!0,constructor:!0,arity:2},{AggregateError:kI});var NO,DI,H3,oL,PO=typeof process<"u"&&rR(process)=="process",CX=TS,RX=XU,IX=TT,z3=g0("species"),wX=mT,AX=TypeError,OX=OU,NX=yI,PX=TypeError,K3=gT,kX=function(l){if(OX(l))return l;throw PX(NX(l)+" is not a constructor")},DX=R1,LX=g0("species"),Y3=function(l,i){var o,p=K3(l).constructor;return p===void 0||DX(o=K3(p)[LX])?i:kX(o)},xX=TypeError,J3=/(?:ipad|iphone|ipod).*applewebkit/i.test(jR),BS=J0,MX=OP,UX=_O,X3=U0,FX=sS,Q3=t0,$3=jU,jX=CF,Z3=zP,VX=function(l,i){if(l<i)throw xX("Not enough arguments");return l},BX=J3,GX=PO,aL=BS.setImmediate,cL=BS.clearImmediate,qX=BS.process,uL=BS.Dispatch,WX=BS.Function,tV=BS.MessageChannel,HX=BS.String,lL=0,kO={},eV="onreadystatechange";Q3(function(){NO=BS.location});var dL=function(l){if(FX(kO,l)){var i=kO[l];delete kO[l],i()}},hL=function(l){return function(){dL(l)}},nV=function(l){dL(l.data)},rV=function(l){BS.postMessage(HX(l),NO.protocol+"//"+NO.host)};aL&&cL||(aL=function(l){VX(arguments.length,1);var i=X3(l)?l:WX(l),o=jX(arguments,1);return kO[++lL]=function(){MX(i,void 0,o)},DI(lL),lL},cL=function(l){delete kO[l]},GX?DI=function(l){qX.nextTick(hL(l))}:uL&&uL.now?DI=function(l){uL.now(hL(l))}:tV&&!BX?(oL=(H3=new tV).port2,H3.port1.onmessage=nV,DI=UX(oL.postMessage,oL)):BS.addEventListener&&X3(BS.postMessage)&&!BS.importScripts&&NO&&NO.protocol!=="file:"&&!Q3(rV)?(DI=rV,BS.addEventListener("message",nV,!1)):DI=eV in Z3("script")?function(l){$3.appendChild(Z3("script"))[eV]=function(){$3.removeChild(this),dL(l)}}:function(l){setTimeout(hL(l),0)});var iV={set:aL,clear:cL},sV=function(){this.head=null,this.tail=null};sV.prototype={add:function(l){var i={item:l,next:null},o=this.tail;o?o.next=i:this.head=i,this.tail=i},get:function(){var l=this.head;if(l)return(this.head=l.next)===null&&(this.tail=null),l.item}};var LI,pL,fL,mL,oV,aV=sV,zX=/ipad|iphone|ipod/i.test(jR)&&typeof Pebble<"u",KX=/web0s(?!.*chrome)/i.test(jR),YR=J0,cV=_O,YX=mO.f,gL=iV.set,JX=aV,XX=J3,QX=zX,$X=KX,EL=PO,uV=YR.MutationObserver||YR.WebKitMutationObserver,lV=YR.document,dV=YR.process,Z1=YR.Promise,hV=YX(YR,"queueMicrotask"),vL=hV&&hV.value;if(!vL){var tN=new JX,eN=function(){var l,i;for(EL&&(l=dV.domain)&&l.exit();i=tN.get();)try{i()}catch(o){throw tN.head&&LI(),o}l&&l.enter()};XX||EL||$X||!uV||!lV?!QX&&Z1&&Z1.resolve?((mL=Z1.resolve(void 0)).constructor=Z1,oV=cV(mL.then,mL),LI=function(){oV(eN)}):EL?LI=function(){dV.nextTick(eN)}:(gL=cV(gL,YR),LI=function(){gL(eN)}):(pL=!0,fL=lV.createTextNode(""),new uV(eN).observe(fL,{characterData:!0}),LI=function(){fL.data=pL=!pL}),vL=function(l){tN.head||LI(),tN.add(l)}}var ZX=vL,xI=function(l){try{return{error:!1,value:l()}}catch(i){return{error:!0,value:i}}},JR=J0.Promise,pV=typeof Deno=="object"&&Deno&&typeof Deno.version=="object",tQ=!pV&&!PO&&typeof window=="object"&&typeof document=="object",eQ=J0,DO=JR,nQ=U0,rQ=lU,iQ=CU,sQ=g0,oQ=tQ,aQ=pV,_L=VR,fV=DO&&DO.prototype,cQ=sQ("species"),mV=!1,gV=nQ(eQ.PromiseRejectionEvent),uQ=rQ("Promise",function(){var l=iQ(DO),i=l!==String(DO);if(!i&&_L===66||!fV.catch||!fV.finally)return!0;if(!_L||_L<51||!/native code/.test(l)){var o=new DO(function(g){g(1)}),p=function(g){g(function(){},function(){})};if((o.constructor={})[cQ]=p,!(mV=o.then(function(){})instanceof p))return!0}return!i&&(oQ||aQ)&&!gV}),LO={CONSTRUCTOR:uQ,REJECTION_EVENT:gV,SUBCLASSING:mV},RT={},EV=rT,lQ=TypeError,dQ=function(l){var i,o;this.promise=new l(function(p,g){if(i!==void 0||o!==void 0)throw lQ("Bad Promise constructor");i=p,o=g}),this.resolve=EV(i),this.reject=EV(o)};RT.f=function(l){return new dQ(l)};var yL,vV,hQ=Y_,nN=PO,uR=J0,xO=iS,pQ=bO,fQ=II,mQ=function(l){var i=CX(l);IX&&i&&!i[z3]&&RX(i,z3,{configurable:!0,get:function(){return this}})},gQ=rT,bL=U0,EQ=nT,vQ=function(l,i){if(wX(i,l))return l;throw AX("Incorrect invocation")},_Q=Y3,_V=iV.set,SL=ZX,yQ=function(l,i){try{arguments.length==1?console.error(l):console.error(l,i)}catch{}},bQ=xI,SQ=aV,yV=j1,TL=JR,bV=LO,SV=RT,rN="Promise",TV=bV.CONSTRUCTOR,TQ=bV.REJECTION_EVENT,CL=yV.getterFor(rN),CQ=yV.set,RQ=TL&&TL.prototype,MO=TL,RL=RQ,CV=uR.TypeError,IL=uR.document,wL=uR.process,AL=SV.f,IQ=AL,wQ=!!(IL&&IL.createEvent&&uR.dispatchEvent),RV="unhandledrejection",IV=function(l){var i;return!(!EQ(l)||!bL(i=l.then))&&i},wV=function(l,i){var o,p,g,b=i.value,A=i.state==1,j=A?l.ok:l.fail,H=l.resolve,z=l.reject,$=l.domain;try{j?(A||(i.rejection===2&&OQ(i),i.rejection=1),j===!0?o=b:($&&$.enter(),o=j(b),$&&($.exit(),g=!0)),o===l.promise?z(CV("Promise-chain cycle")):(p=IV(o))?xO(p,o,H,z):H(o)):z(b)}catch(Vt){$&&!g&&$.exit(),z(Vt)}},AV=function(l,i){l.notified||(l.notified=!0,SL(function(){for(var o,p=l.reactions;o=p.get();)wV(o,l);l.notified=!1,i&&!l.rejection&&AQ(l)}))},OV=function(l,i,o){var p,g;wQ?((p=IL.createEvent("Event")).promise=i,p.reason=o,p.initEvent(l,!1,!0),uR.dispatchEvent(p)):p={promise:i,reason:o},!TQ&&(g=uR["on"+l])?g(p):l===RV&&yQ("Unhandled promise rejection",o)},AQ=function(l){xO(_V,uR,function(){var i,o=l.facade,p=l.value;if(NV(l)&&(i=bQ(function(){nN?wL.emit("unhandledRejection",p,o):OV(RV,o,p)}),l.rejection=nN||NV(l)?2:1,i.error))throw i.value})},NV=function(l){return l.rejection!==1&&!l.parent},OQ=function(l){xO(_V,uR,function(){var i=l.facade;nN?wL.emit("rejectionHandled",i):OV("rejectionhandled",i,l.value)})},MI=function(l,i,o){return function(p){l(i,p,o)}},UI=function(l,i,o){l.done||(l.done=!0,o&&(l=o),l.value=i,l.state=2,AV(l,!0))},OL=function(l,i,o){if(!l.done){l.done=!0,o&&(l=o);try{if(l.facade===i)throw CV("Promise can't be resolved itself");var p=IV(i);p?SL(function(){var g={done:!1};try{xO(p,i,MI(OL,g,l),MI(UI,g,l))}catch(b){UI(g,b,l)}}):(l.value=i,l.state=1,AV(l,!1))}catch(g){UI({done:!1},g,l)}}};TV&&(RL=(MO=function(l){vQ(this,RL),gQ(l),xO(yL,this);var i=CL(this);try{l(MI(OL,i),MI(UI,i))}catch(o){UI(i,o)}}).prototype,(yL=function(l){CQ(this,{type:rN,done:!1,notified:!1,parent:!1,reactions:new SQ,rejection:!1,state:0,value:void 0})}).prototype=pQ(RL,"then",function(l,i){var o=CL(this),p=AL(_Q(this,MO));return o.parent=!0,p.ok=!bL(l)||l,p.fail=bL(i)&&i,p.domain=nN?wL.domain:void 0,o.state==0?o.reactions.add(p):SL(function(){wV(p,o)}),p.promise}),vV=function(){var l=new yL,i=CL(l);this.promise=l,this.resolve=MI(OL,i),this.reject=MI(UI,i)},SV.f=AL=function(l){return l===MO||l===void 0?new vV(l):IQ(l)}),hQ({global:!0,constructor:!0,wrap:!0,forced:TV},{Promise:MO}),fQ(MO,rN,!1,!0),mQ(rN);var PV=g0("iterator"),kV=!1;try{var NQ=0,DV={next:function(){return{done:!!NQ++}},return:function(){kV=!0}};DV[PV]=function(){return this},Array.from(DV,function(){throw 2})}catch{}var PQ=JR,kQ=function(l,i){if(!i&&!kV)return!1;var o=!1;try{var p={};p[PV]=function(){return{next:function(){return{done:o=!0}}}},l(p)}catch{}return o},iN=LO.CONSTRUCTOR||!kQ(function(l){PQ.all(l).then(void 0,function(){})}),DQ=iS,LQ=rT,xQ=RT,MQ=xI,UQ=OO;Y_({target:"Promise",stat:!0,forced:iN},{all:function(l){var i=this,o=xQ.f(i),p=o.resolve,g=o.reject,b=MQ(function(){var A=LQ(i.resolve),j=[],H=0,z=1;UQ(l,function($){var Vt=H++,_r=!1;z++,DQ(A,i,$).then(function(Fi){_r||(_r=!0,j[Vt]=Fi,--z||p(j))},g)}),--z||p(j)});return b.error&&g(b.value),o.promise}});var FQ=Y_,jQ=LO.CONSTRUCTOR;JR&&JR.prototype,FQ({target:"Promise",proto:!0,forced:jQ,real:!0},{catch:function(l){return this.then(void 0,l)}});var VQ=iS,BQ=rT,GQ=RT,qQ=xI,WQ=OO;Y_({target:"Promise",stat:!0,forced:iN},{race:function(l){var i=this,o=GQ.f(i),p=o.reject,g=qQ(function(){var b=BQ(i.resolve);WQ(l,function(A){VQ(b,i,A).then(o.resolve,p)})});return g.error&&p(g.value),o.promise}});var HQ=iS,zQ=RT;Y_({target:"Promise",stat:!0,forced:LO.CONSTRUCTOR},{reject:function(l){var i=zQ.f(this);return HQ(i.reject,void 0,l),i.promise}});var KQ=gT,YQ=nT,JQ=RT,LV=function(l,i){if(KQ(l),YQ(i)&&i.constructor===l)return i;var o=JQ.f(l);return(0,o.resolve)(i),o.promise},XQ=Y_,QQ=JR,$Q=LO.CONSTRUCTOR,ZQ=LV,t$=TS("Promise"),e$=!$Q;XQ({target:"Promise",stat:!0,forced:!0},{resolve:function(l){return ZQ(e$&&this===t$?QQ:this,l)}});var n$=iS,r$=rT,i$=RT,s$=xI,o$=OO;Y_({target:"Promise",stat:!0,forced:iN},{allSettled:function(l){var i=this,o=i$.f(i),p=o.resolve,g=o.reject,b=s$(function(){var A=r$(i.resolve),j=[],H=0,z=1;o$(l,function($){var Vt=H++,_r=!1;z++,n$(A,i,$).then(function(Fi){_r||(_r=!0,j[Vt]={status:"fulfilled",value:Fi},--z||p(j))},function(Fi){_r||(_r=!0,j[Vt]={status:"rejected",reason:Fi},--z||p(j))})}),--z||p(j)});return b.error&&g(b.value),o.promise}});var a$=iS,c$=rT,u$=TS,l$=RT,d$=xI,h$=OO,xV="No one promise resolved";Y_({target:"Promise",stat:!0,forced:iN},{any:function(l){var i=this,o=u$("AggregateError"),p=l$.f(i),g=p.resolve,b=p.reject,A=d$(function(){var j=c$(i.resolve),H=[],z=0,$=1,Vt=!1;h$(l,function(_r){var Fi=z++,_l=!1;$++,a$(j,i,_r).then(function(_u){_l||Vt||(Vt=!0,g(_u))},function(_u){_l||Vt||(_l=!0,H[Fi]=_u,--$||b(new o(H,xV)))})}),--$||b(new o(H,xV))});return A.error&&b(A.value),p.promise}});var p$=Y_,NL=JR,f$=t0,m$=TS,g$=U0,E$=Y3,MV=LV,v$=NL&&NL.prototype;p$({target:"Promise",proto:!0,real:!0,forced:!!NL&&f$(function(){v$.finally.call({then:function(){}},function(){})})},{finally:function(l){var i=E$(this,m$("Promise")),o=g$(l);return this.then(o?function(p){return MV(i,l()).then(function(){return p})}:l,o?function(p){return MV(i,l()).then(function(){throw p})}:l)}});var UV=FR.Promise,pE=LE(UV);const _$=()=>{};function UO(){const l={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:_$};return l.promise=new pE((i,o)=>{l.resolve=p=>{l.isFinished||(l.isResolved=!0,l.isFinished=!0,i(p),l.value=p)},l.reject=p=>{l.isFinished||(l.isRejected=!0,l.isFinished=!0,o(p))}}),l}const sN=new Map,oN=new Map,IT=new Map;var l0,m_;(function(l){l.WIN_10="Windows 10",l.WIN_81="Windows 8.1",l.WIN_8="Windows 8",l.WIN_7="Windows 7",l.WIN_VISTA="Windows Vista",l.WIN_SERVER_2003="Windows Server 2003",l.WIN_XP="Windows XP",l.WIN_2000="Windows 2000",l.ANDROID="Android",l.HARMONY_OS="HarmonyOS",l.OPEN_BSD="Open BSD",l.SUN_OS="Sun OS",l.LINUX="Linux",l.IOS="iOS",l.MAC_OS="Mac OS",l.QNX="QNX",l.UNIX="UNIX",l.BEOS="BeOS",l.OS_2="OS/2",l.SEARCH_BOT="Search Bot"})(l0||(l0={})),function(l){l.CHROME="Chrome",l.SAFARI="Safari",l.EDGE="Edge",l.FIREFOX="Firefox",l.OPERA="OPR",l.QQ="QQBrowser",l.WECHAT="MicroMessenger"}(m_||(m_={}));var PL={exports:{}};(function(l,i){(function(o,p){var g="function",b="undefined",A="object",j="string",H="major",z="model",$="name",Vt="type",_r="vendor",Fi="version",_l="architecture",_u="console",_h="mobile",_g="tablet",eE="smarttv",oE="wearable",SE="embedded",vE="Amazon",fE="Apple",mE="ASUS",EE="BlackBerry",PE="Browser",OE="Chrome",$E="Firefox",s_="Google",B_="Huawei",r0="LG",P_="Microsoft",yS="Motorola",RE="Opera",AE="Samsung",UE="Sharp",YE="Sony",h_="Xiaomi",NE="Zebra",ga="Facebook",Eg="Chromium OS",sE="Mac OS",wE=function(z_){for(var i0={},k_=0;k_<z_.length;k_++)i0[z_[k_].toUpperCase()]=z_[k_];return i0},XE=function(z_,i0){return typeof z_===j&&O_(i0).indexOf(O_(z_))!==-1},O_=function(z_){return z_.toLowerCase()},x0=function(z_,i0){if(typeof z_===j)return z_=z_.replace(/^\s\s*/,""),typeof i0===b?z_:z_.substring(0,350)},bS=function(z_,i0){for(var k_,SS,BT,K_,p_,fS,LR=0;LR<i0.length&&!p_;){var ST=i0[LR],F8=i0[LR+1];for(k_=SS=0;k_<ST.length&&!p_&&ST[k_];)if(p_=ST[k_++].exec(z_))for(BT=0;BT<F8.length;BT++)fS=p_[++SS],typeof(K_=F8[BT])===A&&K_.length>0?K_.length===2?typeof K_[1]==g?this[K_[0]]=K_[1].call(this,fS):this[K_[0]]=K_[1]:K_.length===3?typeof K_[1]!==g||K_[1].exec&&K_[1].test?this[K_[0]]=fS?fS.replace(K_[1],K_[2]):p:this[K_[0]]=fS?K_[1].call(this,fS,K_[2]):p:K_.length===4&&(this[K_[0]]=fS?K_[3].call(this,fS.replace(K_[1],K_[2])):p):this[K_]=fS||p;LR+=2}},nR=function(z_,i0){for(var k_ in i0)if(typeof i0[k_]===A&&i0[k_].length>0){for(var SS=0;SS<i0[k_].length;SS++)if(XE(i0[k_][SS],z_))return k_==="?"?p:k_}else if(XE(i0[k_],z_))return k_==="?"?p:k_;return z_},IP={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},wP={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[Fi,[$,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[Fi,[$,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[$,Fi],[/opios[\/ ]+([\w\.]+)/i],[Fi,[$,RE+" Mini"]],[/\bopr\/([\w\.]+)/i],[Fi,[$,RE]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(weibo)__([\d\.]+)/i],[$,Fi],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[Fi,[$,"UC"+PE]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i],[Fi,[$,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[Fi,[$,"WeChat"]],[/konqueror\/([\w\.]+)/i],[Fi,[$,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[Fi,[$,"IE"]],[/yabrowser\/([\w\.]+)/i],[Fi,[$,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[$,/(.+)/,"$1 Secure "+PE],Fi],[/\bfocus\/([\w\.]+)/i],[Fi,[$,$E+" Focus"]],[/\bopt\/([\w\.]+)/i],[Fi,[$,RE+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[Fi,[$,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[Fi,[$,"Dolphin"]],[/coast\/([\w\.]+)/i],[Fi,[$,RE+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[Fi,[$,"MIUI "+PE]],[/fxios\/([-\w\.]+)/i],[Fi,[$,$E]],[/\bqihu|(qi?ho?o?|360)browser/i],[[$,"360 "+PE]],[/(oculus|samsung|sailfish|huawei)browser\/([\w\.]+)/i],[[$,/(.+)/,"$1 "+PE],Fi],[/(comodo_dragon)\/([\w\.]+)/i],[[$,/_/g," "],Fi],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[$,Fi],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i,/\[(linkedin)app\]/i],[$],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[$,ga],Fi],[/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[$,Fi],[/\bgsa\/([\w\.]+) .*safari\//i],[Fi,[$,"GSA"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[Fi,[$,OE+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[$,OE+" WebView"],Fi],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[Fi,[$,"Android "+PE]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[$,Fi],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[Fi,[$,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[Fi,$],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[$,[Fi,nR,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[$,Fi],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[$,"Netscape"],Fi],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[Fi,[$,$E+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[$,Fi],[/(cobalt)\/([\w\.]+)/i],[$,[Fi,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[_l,"amd64"]],[/(ia32(?=;))/i],[[_l,O_]],[/((?:i[346]|x)86)[;\)]/i],[[_l,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[_l,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[_l,"armhf"]],[/windows (ce|mobile); ppc;/i],[[_l,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[_l,/ower/,"",O_]],[/(sun4\w)[;\)]/i],[[_l,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[_l,O_]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[z,[_r,AE],[Vt,_g]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[z,[_r,AE],[Vt,_h]],[/\((ip(?:hone|od)[\w ]*);/i],[z,[_r,fE],[Vt,_h]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[z,[_r,fE],[Vt,_g]],[/(macintosh);/i],[z,[_r,fE]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[z,[_r,UE],[Vt,_h]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[z,[_r,B_],[Vt,_g]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[z,[_r,B_],[Vt,_h]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[z,/_/g," "],[_r,h_],[Vt,_h]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[z,/_/g," "],[_r,h_],[Vt,_g]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[z,[_r,"OPPO"],[Vt,_h]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[z,[_r,"Vivo"],[Vt,_h]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[z,[_r,"Realme"],[Vt,_h]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[z,[_r,yS],[Vt,_h]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[z,[_r,yS],[Vt,_g]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[z,[_r,r0],[Vt,_g]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[z,[_r,r0],[Vt,_h]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[z,[_r,"Lenovo"],[Vt,_g]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[z,/_/g," "],[_r,"Nokia"],[Vt,_h]],[/(pixel c)\b/i],[z,[_r,s_],[Vt,_g]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[z,[_r,s_],[Vt,_h]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[z,[_r,YE],[Vt,_h]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[z,"Xperia Tablet"],[_r,YE],[Vt,_g]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[z,[_r,"OnePlus"],[Vt,_h]],[/(alexa)webm/i,/(kf[a-z]{2}wi)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[z,[_r,vE],[Vt,_g]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[z,/(.+)/g,"Fire Phone $1"],[_r,vE],[Vt,_h]],[/(playbook);[-\w\),; ]+(rim)/i],[z,_r,[Vt,_g]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[z,[_r,EE],[Vt,_h]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[z,[_r,mE],[Vt,_g]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[z,[_r,mE],[Vt,_h]],[/(nexus 9)/i],[z,[_r,"HTC"],[Vt,_g]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[_r,[z,/_/g," "],[Vt,_h]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[z,[_r,"Acer"],[Vt,_g]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[z,[_r,"Meizu"],[Vt,_h]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[_r,z,[Vt,_h]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[_r,z,[Vt,_g]],[/(surface duo)/i],[z,[_r,P_],[Vt,_g]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[z,[_r,"Fairphone"],[Vt,_h]],[/(u304aa)/i],[z,[_r,"AT&T"],[Vt,_h]],[/\bsie-(\w*)/i],[z,[_r,"Siemens"],[Vt,_h]],[/\b(rct\w+) b/i],[z,[_r,"RCA"],[Vt,_g]],[/\b(venue[\d ]{2,7}) b/i],[z,[_r,"Dell"],[Vt,_g]],[/\b(q(?:mv|ta)\w+) b/i],[z,[_r,"Verizon"],[Vt,_g]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[z,[_r,"Barnes & Noble"],[Vt,_g]],[/\b(tm\d{3}\w+) b/i],[z,[_r,"NuVision"],[Vt,_g]],[/\b(k88) b/i],[z,[_r,"ZTE"],[Vt,_g]],[/\b(nx\d{3}j) b/i],[z,[_r,"ZTE"],[Vt,_h]],[/\b(gen\d{3}) b.+49h/i],[z,[_r,"Swiss"],[Vt,_h]],[/\b(zur\d{3}) b/i],[z,[_r,"Swiss"],[Vt,_g]],[/\b((zeki)?tb.*\b) b/i],[z,[_r,"Zeki"],[Vt,_g]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[_r,"Dragon Touch"],z,[Vt,_g]],[/\b(ns-?\w{0,9}) b/i],[z,[_r,"Insignia"],[Vt,_g]],[/\b((nxa|next)-?\w{0,9}) b/i],[z,[_r,"NextBook"],[Vt,_g]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[_r,"Voice"],z,[Vt,_h]],[/\b(lvtel\-)?(v1[12]) b/i],[[_r,"LvTel"],z,[Vt,_h]],[/\b(ph-1) /i],[z,[_r,"Essential"],[Vt,_h]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[z,[_r,"Envizen"],[Vt,_g]],[/\b(trio[-\w\. ]+) b/i],[z,[_r,"MachSpeed"],[Vt,_g]],[/\btu_(1491) b/i],[z,[_r,"Rotor"],[Vt,_g]],[/(shield[\w ]+) b/i],[z,[_r,"Nvidia"],[Vt,_g]],[/(sprint) (\w+)/i],[_r,z,[Vt,_h]],[/(kin\.[onetw]{3})/i],[[z,/\./g," "],[_r,P_],[Vt,_h]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[z,[_r,NE],[Vt,_g]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[z,[_r,NE],[Vt,_h]],[/smart-tv.+(samsung)/i],[_r,[Vt,eE]],[/hbbtv.+maple;(\d+)/i],[[z,/^/,"SmartTV"],[_r,AE],[Vt,eE]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[_r,r0],[Vt,eE]],[/(apple) ?tv/i],[_r,[z,fE+" TV"],[Vt,eE]],[/crkey/i],[[z,OE+"cast"],[_r,s_],[Vt,eE]],[/droid.+aft(\w)( bui|\))/i],[z,[_r,vE],[Vt,eE]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[z,[_r,UE],[Vt,eE]],[/(bravia[\w ]+)( bui|\))/i],[z,[_r,YE],[Vt,eE]],[/(mitv-\w{5}) bui/i],[z,[_r,h_],[Vt,eE]],[/Hbbtv.*(technisat) (.*);/i],[_r,z,[Vt,eE]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[_r,x0],[z,x0],[Vt,eE]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[Vt,eE]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[_r,z,[Vt,_u]],[/droid.+; (shield) bui/i],[z,[_r,"Nvidia"],[Vt,_u]],[/(playstation [345portablevi]+)/i],[z,[_r,YE],[Vt,_u]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[z,[_r,P_],[Vt,_u]],[/((pebble))app/i],[_r,z,[Vt,oE]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[z,[_r,fE],[Vt,oE]],[/droid.+; (glass) \d/i],[z,[_r,s_],[Vt,oE]],[/droid.+; (wt63?0{2,3})\)/i],[z,[_r,NE],[Vt,oE]],[/(quest( 2| pro)?)/i],[z,[_r,ga],[Vt,oE]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[_r,[Vt,SE]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[z,[Vt,_h]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[z,[Vt,_g]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[Vt,_g]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[Vt,_h]],[/(android[-\w\. ]{0,9});.+buil/i],[z,[_r,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[Fi,[$,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[Fi,[$,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i],[$,Fi],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[Fi,$]],os:[[/microsoft (windows) (vista|xp)/i],[$,Fi],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[$,[Fi,nR,IP]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[$,"Windows"],[Fi,nR,IP]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[Fi,/_/g,"."],[$,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[$,sE],[Fi,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[Fi,$],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[$,Fi],[/\(bb(10);/i],[Fi,[$,EE]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[Fi,[$,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[Fi,[$,$E+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[Fi,[$,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[Fi,[$,"watchOS"]],[/crkey\/([\d\.]+)/i],[Fi,[$,OE+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[$,Eg],Fi],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[$,Fi],[/(sunos) ?([\w\.\d]*)/i],[[$,"Solaris"],Fi],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\w\.]*)/i],[$,Fi]]},tT=function(z_,i0){if(typeof z_===A&&(i0=z_,z_=p),!(this instanceof tT))return new tT(z_,i0).getResult();var k_=typeof o!==b&&o.navigator?o.navigator:p,SS=z_||(k_&&k_.userAgent?k_.userAgent:""),BT=k_&&k_.userAgentData?k_.userAgentData:p,K_=i0?function(p_,fS){var LR={};for(var ST in p_)fS[ST]&&fS[ST].length%2==0?LR[ST]=fS[ST].concat(p_[ST]):LR[ST]=p_[ST];return LR}(wP,i0):wP;return this.getBrowser=function(){var p_={};return p_[$]=p,p_[Fi]=p,bS.call(p_,SS,K_.browser),p_[H]=function(fS){return typeof fS===j?fS.replace(/[^\d\.]/g,"").split(".")[0]:p}(p_[Fi]),k_&&k_.brave&&typeof k_.brave.isBrave==g&&(p_[$]="Brave"),p_},this.getCPU=function(){var p_={};return p_[_l]=p,bS.call(p_,SS,K_.cpu),p_},this.getDevice=function(){var p_={};return p_[_r]=p,p_[z]=p,p_[Vt]=p,bS.call(p_,SS,K_.device),!p_[Vt]&&BT&&BT.mobile&&(p_[Vt]=_h),p_[z]=="Macintosh"&&k_&&typeof k_.standalone!==b&&k_.maxTouchPoints&&k_.maxTouchPoints>2&&(p_[z]="iPad",p_[Vt]=_g),p_},this.getEngine=function(){var p_={};return p_[$]=p,p_[Fi]=p,bS.call(p_,SS,K_.engine),p_},this.getOS=function(){var p_={};return p_[$]=p,p_[Fi]=p,bS.call(p_,SS,K_.os),!p_[$]&&BT&&BT.platform!="Unknown"&&(p_[$]=BT.platform.replace(/chrome os/i,Eg).replace(/macos/i,sE)),p_},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return SS},this.setUA=function(p_){return SS=typeof p_===j&&p_.length>350?x0(p_,350):p_,this},this.setUA(SS),this};tT.VERSION="0.7.34",tT.BROWSER=wE([$,Fi,H]),tT.CPU=wE([_l]),tT.DEVICE=wE([z,_r,Vt,_u,_h,eE,_g,oE,SE]),tT.ENGINE=tT.OS=wE([$,Fi]),l.exports&&(i=l.exports=tT),i.UAParser=tT;var DR=typeof o!==b&&(o.jQuery||o.Zepto);if(DR&&!DR.ua){var fO=new tT;DR.ua=fO.getResult(),DR.ua.get=function(){return fO.getUA()},DR.ua.set=function(z_){fO.setUA(z_);var i0=fO.getResult();for(var k_ in i0)DR.ua[k_]=i0[k_]}}})(typeof window=="object"?window:o_)})(PL,PL.exports);const kL=new(LE(PL.exports));let zT=kL.getResult(),DL=null;function l_(l){if(!DL){l&&kL.setUA(l),zT=kL.getResult();const i=function(b){if(b.engine.name==="Blink"&&b.browser.name!=="WeChat")return m_.CHROME;switch(b.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return m_.CHROME;case"Safari":case"Mobile Safari":return m_.SAFARI;case"Edge":return m_.EDGE;case"Firefox":return m_.FIREFOX;case"QQBrowser":return m_.QQ;case"Opera":return m_.OPERA;case"WeChat":return m_.WECHAT;default:return b.browser.name||""}}(zT),o=function(b){let A;return A=b.engine.name==="Blink"?b.engine.version||"":b.browser.version||"",A.split(".")[0]}(zT),p=function(b){return b.os.name==="Windows"?b.os.version?b.os.name+" "+b.os.version:b.os.name:b.os.name||""}(zT),g=zT.os.version;if(!(i&&o&&p&&g))return{name:i,version:o,os:p,osVersion:g};DL={name:i,version:o,os:p,osVersion:g}}return DL}function aN(){return l_().os}function FV(){const l=l_();return"".concat(l.os," ").concat(l.osVersion)}function cN(){const l=l_();return!!(zT.engine.name==="WebKit"&&l.os===l0.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&l.name!==m_.SAFARI||z0()&&l.name!==m_.SAFARI)}function y$(){const l=l_();if(cN()){if(l.os===l0.MAC_OS)return!0;if(l.os===l0.IOS){const i=zT.os.version&&zT.os.version.split(".");if(i&&Number(i[0])===14&&i[1]&&Number(i[1])>=3||i&&Number(i[0])>14)return!0}}return!1}function b$(){return zT.engine.name==="WebKit"}function LL(){return l_().name===m_.CHROME}function H0(){return l_().name===m_.SAFARI}function N_(){return l_().name===m_.FIREFOX}function z0(){return l_().os===l0.IOS}function xL(l){const i=l_();return!(i.name!==m_.CHROME||!i.osVersion)&&Number(i.version)>=l}function jV(l){const i=l_();return!(i.name!==m_.EDGE||!i.osVersion)&&Number(i.version)>=l}function VV(l){const i=l_();return!(i.name!==m_.OPERA||!i.osVersion)&&Number(i.version)>=l}function BV(){const l=l_();return!(l.name!==m_.CHROME||!l.osVersion)&&Number(l.version)<=90}function GV(){const l=l_();if(l.os!==l0.IOS||!l.osVersion)return!1;const i=l.osVersion.split(".");return Number(i[0])<14||Number(i[0])===14&&Number(i[1])<=6}function FI(){const l=l_();if(l.os!==l0.IOS||!l.osVersion)return!1;const i=l.osVersion.split(".");return Number(i[0])===15}function ML(){const l=l_();if(l.os!==l0.IOS||!l.osVersion)return!1;const i=l.osVersion.split(".");return Number(i[0])===16}function qV(){const l=l_();if(l.os!==l0.IOS||!l.osVersion)return!1;const i=l.osVersion.split(".");return Number(i[0])===15&&Number(i[1])>=1}function wT(){return H0()&&navigator.maxTouchPoints>0}function WV(){return l_().name===m_.WECHAT}function HV(){return window.navigator.appVersion&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)!==null&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function lR(){const l=l_();return l.name===m_.EDGE||l.name===m_.SAFARI?!1:!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function uN(){return aN()===l0.ANDROID}function FO(){const l=l_();return uN()&&(l.name===m_.CHROME||l.name===m_.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}var _p;(function(l){l.UNEXPECTED_ERROR="UNEXPECTED_ERROR",l.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",l.TIMEOUT="TIMEOUT",l.INVALID_PARAMS="INVALID_PARAMS",l.NOT_READABLE="NOT_READABLE",l.NOT_SUPPORTED="NOT_SUPPORTED",l.INVALID_OPERATION="INVALID_OPERATION",l.OPERATION_ABORTED="OPERATION_ABORTED",l.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",l.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",l.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",l.DATACHANNEL_FAILED="DATACHANNEL_FAILED",l.NETWORK_ERROR="NETWORK_ERROR",l.NETWORK_TIMEOUT="NETWORK_TIMEOUT",l.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",l.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",l.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",l.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",l.ELECTRON_IS_NULL="ELECTRON_IS_NULL",l.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",l.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",l.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",l.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",l.PERMISSION_DENIED="PERMISSION_DENIED",l.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",l.TRACK_IS_DISABLED="TRACK_IS_DISABLED",l.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",l.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",l.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",l.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",l.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",l.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",l.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",l.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",l.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",l.UID_CONFLICT="UID_CONFLICT",l.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",l.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",l.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",l.INVALID_TRACK="INVALID_TRACK",l.SENDER_NOT_FOUND="SENDER_NOT_FOUND",l.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",l.SET_ANSWER_FAILED="SET_ANSWER_FAILED",l.ICE_FAILED="ICE_FAILED",l.PC_CLOSED="PC_CLOSED",l.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",l.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",l.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",l.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",l.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",l.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",l.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",l.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",l.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",l.INVALID_REMOTE_USER="INVALID_REMOTE_USER",l.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",l.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",l.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",l.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",l.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",l.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",l.WS_ABORT="WS_ABORT",l.WS_DISCONNECT="WS_DISCONNECT",l.WS_ERR="WS_ERR",l.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",l.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",l.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",l.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",l.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",l.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",l.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",l.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",l.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",l.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",l.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",l.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",l.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",l.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",l.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",l.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",l.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",l.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",l.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",l.INVALID_PLUGIN="INVALID_PLUGIN",l.DISCONNECT_P2P="DISCONNECT_P2P",l.INIT_WEBSOCKET_TIMEOUT="INIT_WEBSOCKET_TIMEOUT",l.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",l.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",l.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",l.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",l.PROHIBITED_OPERATION="PROHIBITED_OPERATION",l.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED"})(_p||(_p={}));let yE=class extends Error{constructor(l){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",o=arguments.length>2?arguments[2]:void 0;super(i),_e(this,"code",void 0),_e(this,"message",void 0),_e(this,"data",void 0),_e(this,"name","AgoraRTCException"),this.code=l,this.message="AgoraRTCError ".concat(this.code,": ").concat(i),this.data=o}toString(){return this.data?"data: ".concat(JSON.stringify(this.data),`
`).concat(this.stack):"".concat(this.stack)}print(){let l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error",i=arguments.length>1?arguments[1]:void 0;return l==="error"&&(i||console).error(this.toString()),l==="warning"&&(i||console).warn(this.toString()),this}throw(l){throw this.print("error",l),this}};function XR(l,i){if(typeof l!="boolean")throw new yE(_p.INVALID_PARAMS,"Invalid ".concat(i,": The value is of the boolean type."))}function d0(l,i,o){if(!VE(o).call(o,l))throw new yE(_p.INVALID_PARAMS,"".concat(i," can only be set as ").concat(JSON.stringify(o)))}function b_(l,i){let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,p=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1e4;if(l<o||l>p||(!(arguments.length>4&&arguments[4]!==void 0)||arguments[4])&&!function(g){return typeof g=="number"&&g%1==0}(l))throw new yE(_p.INVALID_PARAMS,"invalid ".concat(i,": the value range is [").concat(o,", ").concat(p,"]. integer only"))}function UL(l,i){if(typeof l!="number"){if(!(l.min||l.max||l.ideal||l.exact))throw new yE(_p.INVALID_PARAMS,"".concat(i," is not a valid ConstrainLong"));l.min!==void 0&&b_(l.min,"".concat(i,".min"),0,1/0),l.max!==void 0&&b_(l.max,"".concat(i,".max"),1,1/0),l.exact!==void 0&&b_(l.exact,"".concat(i,".exact"),1,1/0),l.ideal!==void 0&&b_(l.ideal,"".concat(i,".ideal"),1,1/0)}else b_(l,i,1,1/0)}function O0(l,i){let o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,p=arguments.length>3&&arguments[3]!==void 0?arguments[3]:255,g=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(l==null)throw new yE(_p.INVALID_PARAMS,"".concat(i||"param"," cannot be empty"));if(!zV(l,o,p,g))throw new yE(_p.INVALID_PARAMS,"Invalid ".concat(i||"string param",": Length of the string: [").concat(o,",").concat(p,"].").concat(g?" ASCII characters only.":""))}function KT(l,i){if(!Array.isArray(l))throw new yE(_p.INVALID_PARAMS,"".concat(i," should be an array"))}function M_(l){return l==null}function zV(l){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:255,p=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];return typeof l=="string"&&l.length<=o&&l.length>=i&&(!p||function(g){if(typeof g!="string")return!1;for(let b=0;b<g.length;b+=1){const A=g.charCodeAt(b);if(A<0||A>255)return!1}return!0}(l))}function KV(l,i,o){if("getBigUint64"in DataView.prototype)return l.getBigUint64(i,o);const p=l.getUint32(i,o),g=l.getUint32(i+4,o),b=+!!o,A=+!o;return BigInt(p*A+g*b)<<BigInt(32)|BigInt(p*b+g*A)}function YV(l,i,o,p){if("setBigUint64"in DataView.prototype)return l.setBigUint64(i,o,p);const g=Number(o>>BigInt(32)),b=Number(o&BigInt(4294967295));p?(l.setUint32(i+4,g,p),l.setUint32(i,b,p)):(l.setUint32(i,g,p),l.setUint32(i+4,b,p))}var jI,lN;(function(l){l.COVERED="COVERED",l.POSITION="POSITION",l.SIZE="SIZE",l.STYLE="STYLE"})(jI||(jI={})),function(l){l.UNMOUNTED="UNMOUNTED",l.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT"}(lN||(lN={}));const JV=new class{constructor(){_e(this,"_clientSize",null),_e(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),_e(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),_e(this,"getStyle",l=>window.getComputedStyle(l,null)),_e(this,"checkCssVisibleProperty",l=>{var i;let o=!0;const p=this.getStyle(l),{display:g,visibility:b,opacity:A,filter:j}=p;return(g==="none"||VE(i=["hidden","collapse"]).call(i,b)||Number(A)<.1)&&(o=!1),o?(j&&j.split(" ").filter(H=>{var z;const $=H.split("(")[0];return VE(z=["brightness","blur","opacity"]).call(z,$)}).map(H=>{const[z,$]=H.split(/\(|\)/);return[z,Number($.match(/^[0-9\.]+/))]}).forEach(H=>{const[z,$]=H;switch(z){case"brightness":($<.1||$>3)&&(o=!1);break;case"blur":$>3&&(o=!1);break;case"opacity":$<.1&&(o=!1)}}),o):!1}),_e(this,"checkPropertyUpToAllParentNodes",(l,i)=>{let o=!0,p=!0;const g=A=>i(A);let b=l;for(;b&&p;)g(b)||(o=!1,p=!1),b=b.parentElement,b||(p=!1);return o}),_e(this,"checkActualCssVisibleIncludeInherit",l=>this.checkPropertyUpToAllParentNodes(l,this.checkCssVisibleProperty)),_e(this,"getSizeAboutClient",l=>{const{width:i,height:o,left:p,right:g,top:b,bottom:A}=l.getBoundingClientRect(),j=this.getClientWidth(),H=this.getClientHeight();return{width:i,height:o,left:p,right:g,top:b,bottom:A,clientWidth:j,clientHeight:H,clientMin:Math.min(j,H)}}),_e(this,"checkActualSize",()=>{const{width:l,height:i,clientMin:o}=this._clientSize;return this.checkSizeIsVisible(l,i,o)}),_e(this,"elementFromPoint",(l,i)=>document.elementFromPoint?document.elementFromPoint(l,i):null),_e(this,"checkCoverForAPoint",(l,i,o)=>{const p=this.elementFromPoint(l,i);return p!==null&&p!==o}),_e(this,"getPointPositionList",()=>{const{width:l,height:i,left:o,top:p}=this._clientSize,g=l/6,b=i/6,A=[],j=10**6;for(let H=0;H<5;H++)for(let z=0;z<5;z++){const $=(o*j+(H===0?.1:H===4?(g*H*j-1e5)/j:g*H)*j)/j,Vt=(p*j+(z===0?.1:z===4?(b*z*j-1e5)/j:b*z)*j)/j;A.push({x:$,y:Vt})}return[...A]}),_e(this,"checkElementCover",l=>this.getPointPositionList().map(i=>this.checkCoverForAPoint(i.x,i.y,l)).filter(i=>!!i).length>6),_e(this,"checkSizeIsVisible",(l,i,o)=>(l>50||o/l<=10)&&(i>50||o/i<=10)),_e(this,"checkSizeOfPartInClient",()=>{const{left:l,right:i,top:o,bottom:p,clientHeight:g,clientWidth:b,clientMin:A}=this._clientSize;let j,H,z,$;if(l<0)j=0;else{if(!(l<b))return!1;j=l}if(i<0)return!1;if(H=i<b?i:b,o<0)z=0;else{if(!(o<g))return!1;z=o}if(p<0)return!1;$=p<g?p:g;const Vt=H-j,_r=$-z;return this.checkSizeIsVisible(Vt,_r,A)}),_e(this,"returnHiddenResult",l=>(this._clientSize=null,{visible:!1,reason:l})),_e(this,"checkOneElementVisible",l=>{if(l instanceof HTMLElement){if(this.checkElementIsMountedOnDom(l)){if(this.checkActualCssVisibleIncludeInherit(l)){if(this._clientSize=this.getSizeAboutClient(l),this.checkElementCover(l))return this.returnHiddenResult(jI.COVERED);{const i=this.checkActualSize(),o=this.checkSizeOfPartInClient();return i&&!o?this.returnHiddenResult(jI.POSITION):i?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(jI.SIZE)}}return this.returnHiddenResult(jI.STYLE)}return this.returnHiddenResult(lN.UNMOUNTED)}return this.returnHiddenResult(lN.INVALID_HTML_ELEMENT)}),_e(this,"checkElementIsMountedOnDom",l=>this.checkPropertyUpToAllParentNodes(l,i=>i.nodeName.toUpperCase()!=="HTML"?i.parentElement!==null:!!document.documentElement))}};function FL(l){return new TextEncoder().encode(l)}const XV=function(l,i){const o=new Uint8Array(l.byteLength+i.byteLength);return o.set(new Uint8Array(l),0),o.set(new Uint8Array(i),l.byteLength),o},S$=async l=>{const i=function(b){const A=window.atob(b),j=new Uint8Array(new ArrayBuffer(A.length));for(let H=0;H<A.length;H+=1)j[H]=A.charCodeAt(H);return j}(`MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu
STM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+
HvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy
xQiYDz3vqa6bP29adwIDAQAB`),o=await window.crypto.subtle.importKey("spki",i,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),p=FL(l),g=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},o,p);return function(b){let A="";for(let j=0;j<b.length;j+=1)A+=String.fromCharCode(b[j]);return window.btoa(A)}(new Uint8Array(g))},T$=async l=>function(i,o){let p="";return new Uint8Array(i).forEach(g=>{p+=g.toString(o).padStart(2,"0")}),p}(await crypto.subtle.digest("SHA-256",FL(l)),16);class D_{constructor(){_e(this,"_events",{}),_e(this,"addListener",this.on)}getListeners(i){return this._events[i]?this._events[i].map(o=>o.listener):[]}on(i,o){this._events[i]||(this._events[i]=[]);const p=this._events[i];this._indexOfListener(p,o)===-1&&p.push({listener:o,once:!1})}once(i,o){this._events[i]||(this._events[i]=[]);const p=this._events[i];this._indexOfListener(p,o)===-1&&p.push({listener:o,once:!0})}off(i,o){if(!this._events[i])return;const p=this._events[i],g=this._indexOfListener(p,o);g!==-1&&p.splice(g,1),this._events[i].length===0&&delete this._events[i]}removeAllListeners(i){i?delete this._events[i]:this._events={}}emit(i){this._events[i]||(this._events[i]=[]);const o=this._events[i].map(A=>A);for(var p=arguments.length,g=new Array(p>1?p-1:0),b=1;b<p;b++)g[b-1]=arguments[b];for(let A=0;A<o.length;A+=1){const j=o[A];j.once&&this.off(i,j.listener),j.listener.apply(this,g||[])}}safeEmit(i){for(var o=arguments.length,p=new Array(o>1?o-1:0),g=1;g<o;g++)p[g-1]=arguments[g];[...this._events[i]||[]].forEach(b=>{b.once&&this.off(i,b.listener);try{b.listener.apply(this,p)}catch(A){console.error("safeEmit event:".concat(i," error ").concat(A==null?void 0:A.toString()))}})}_indexOfListener(i,o){let p=i.length;for(;p--;)if(i[p].listener===o)return p;return-1}}let jO=null;function QV(){if(jO)return jO;if(window.electron)return jO=window.electron;if(!window.require)return null;try{return jO=window.require("electron"),jO}catch{return null}}var e0,x_,jL,e_,n_,h0,K0,YT;function $V(l){return b_(l.timeout,"config.timeout",0,1e5),b_(l.timeoutFactor,"config.timeoutFactor",0,100,!1),b_(l.maxRetryCount,"config.maxRetryConfig",0,1/0),b_(l.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}function VI(l){if(!Array.isArray(l)||l.length<1)return!1;try{l.forEach(i=>{if(!i.urls)throw Error()})}catch{return!1}return!0}function ZV(l){return O0(l.turnServerURL,"turnServerURL"),O0(l.username,"username"),O0(l.password,"password"),l.udpport&&b_(l.udpport,"udpport",1,99999,!0),l.forceturn&&XR(l.forceturn,"forceturn"),l.security&&XR(l.security,"security"),l.tcpport&&b_(l.tcpport,"tcpport",1,99999,!0),!0}function _B(l){return l.level!==void 0&&d0(l.level,"level",[1,2,3]),l.delay!==void 0&&b_(l.delay,"delay",0,3e3,!0),!0}function U_(l,i){for(var o=arguments.length,p=new Array(o>2?o-2:0),g=2;g<o;g++)p[g-2]=arguments[g];return l.getListeners(i).length===0?pE.reject(new yE(_p.UNEXPECTED_ERROR,"can not emit promise")):new pE((b,A)=>{l.emit(i,...p,b,A)})}function S_(l,i){if(l.getListeners(i).length===0)return pE.resolve();for(var o=arguments.length,p=new Array(o>2?o-2:0),g=2;g<o;g++)p[g-2]=arguments[g];return U_(l,i,...p)}function oS(l,i){if(l.getListeners(i).length===0)return null;for(var o=arguments.length,p=new Array(o>2?o-2:0),g=2;g<o;g++)p[g-2]=arguments[g];return JT(l,i,...p)}function JT(l,i){let o=null,p=null;for(var g=arguments.length,b=new Array(g>2?g-2:0),A=2;A<g;A++)b[A-2]=arguments[A];if(l.emit(i,...b,j=>{o=j},j=>{p=j}),p!==null)throw p;if(o===null)throw new yE(_p.UNEXPECTED_ERROR,"handler is not sync");return o}(function(l){l.CREATE_CLIENT="createClient",l.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",l.SET_AREA="setArea",l.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",l.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",l.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",l.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",l.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",l.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",l.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",l.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",l.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",l.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",l.START_PROXY_SERVER="Client.startProxyServer",l.STOP_PROXY_SERVER="Client.stopProxyServer",l.SET_PROXY_SERVER="Client.setProxyServer",l.SET_TURN_SERVER="Client.setTurnServer",l.SET_CLIENT_ROLE="Client.setClientRole",l.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",l.ENABLE_DUAL_STREAM="Client.enableDualStream",l.DISABLE_DUAL_STREAM="Client.disableDualStream",l.JOIN="Client.join",l.LEAVE="Client.leave",l.PUBLISH="Client.publish",l.UNPUBLISH="Client.unpublish",l.SUBSCRIBE="Client.subscribe",l.MASS_SUBSCRIBE="Client.massSubscribe",l.MASS_UNSUBSCRIBE="Client.massUnsubscribe",l.UNSUBSCRIBE="Client.unsubscribe",l.RENEW_TOKEN="Client.renewToken",l.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",l.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",l.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",l.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",l.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",l.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",l.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",l.DATACHANNEL_FAILBACK="Client._datachannelFailback",l.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",l.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",l.START_LIVE_STREAMING="Client.startLiveStreaming",l.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",l.STOP_LIVE_STREAMING="Client.stopLiveStreaming",l.ADD_INJECT_STREAM_URL="Client.addInjectStreamUrl",l.REMOVE_INJECT_STREAM_URL="Client.removeInjectStreamUrl",l.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",l.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",l.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",l.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",l.SET_CONFIG_DISTRIBUTE="_configDistribute",l.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",l.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",l.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",l.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",l.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",l.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",l.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",l.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",l.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",l.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",l.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",l.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",l.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",l.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",l.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",l.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",l.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",l.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",l.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",l.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",l.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",l.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",l.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",l.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",l.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",l.STREAM_TYPE_CHANGE="streamTypeChange",l.CONNECTION_STATE_CHANGE="connectionStateChange",l.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",l.IMAGE_MODERATION_UPLOAD="imageModerationUpload"})(e0||(e0={})),function(l){l.TRACER="tracer"}(x_||(x_={})),function(l){l[l.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",l[l.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",l[l.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY"}(jL||(jL={})),function(l){l.LEAVE="LEAVE",l.NETWORK_ERROR="NETWORK_ERROR",l.SERVER_ERROR="SERVER_ERROR",l.UID_BANNED="UID_BANNED",l.IP_BANNED="IP_BANNED",l.CHANNEL_BANNED="CHANNEL_BANNED",l.FALLBACK="FALLBACK",l.LICENSE_MISSING="LICENSE_MISSING",l.LICENSE_EXPIRED="LICENSE_EXPIRED",l.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",l.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",l.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",l.LICENSE_ILLEGAL="LICENSE_ILLEGAL",l.TOKEN_EXPIRE="TOKEN_EXPIRE"}(e_||(e_={})),function(l){l.CONNECTION_STATE_CHANGE="connection-state-change",l.MEDIA_RECONNECT_START="media-reconnect-start",l.MEDIA_RECONNECT_END="media-reconnect-end",l.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",l.USER_JOINED="user-joined",l.USER_LEAVED="user-left",l.USER_PUBLISHED="user-published",l.USER_UNPUBLISHED="user-unpublished",l.USER_INFO_UPDATED="user-info-updated",l.CLIENT_BANNED="client-banned",l.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",l.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",l.VOLUME_INDICATOR="volume-indicator",l.CRYPT_ERROR="crypt-error",l.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",l.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",l.NETWORK_QUALITY="network-quality",l.STREAM_TYPE_CHANGED="stream-type-changed",l.STREAM_FALLBACK="stream-fallback",l.RECEIVE_METADATA="receive-metadata",l.STREAM_MESSAGE="stream-message",l.LIVE_STREAMING_ERROR="live-streaming-error",l.LIVE_STREAMING_WARNING="live-streaming-warning",l.INJECT_STREAM_STATUS="stream-inject-status",l.EXCEPTION="exception",l.ERROR="error",l.P2P_LOST="p2p_lost",l.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",l.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",l.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",l.PUBLISHED_USER_LIST="published-user-list",l.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",l.CONTENT_INSPECT_ERROR="content-inspect-error",l.CONTENT_INSPECT_RESULT="content-inspect-result",l.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change"}(n_||(n_={})),function(l){l.NETWORK_ERROR="NETWORK_ERROR",l.SERVER_ERROR="SERVER_ERROR",l.MULTI_IP="MULTI_IP",l.TIMEOUT="TIMEOUT",l.OFFLINE="OFFLINE",l.LEAVE="LEAVE",l.P2P_FAILED="P2P_FAILED",l.FALLBACK="FALLBACK"}(h0||(h0={})),function(l){l.ONLINE="ONLINE",l.OFFLINE="OFFLINE"}(K0||(K0={})),function(l){l.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",l.ONLINE="ONLINE",l.OFFLINE="OFFLINE"}(YT||(YT={}));const X_=new class extends D_{set networkState(l){this.emit(YT.NETWORK_STATE_CHANGE,l,this._networkState),l===K0.ONLINE?this.emit(YT.ONLINE):l===K0.OFFLINE&&(this.onlineWaiter=new pE(i=>{this.once(YT.ONLINE,()=>{this.onlineWaiter=void 0,i(K0.ONLINE)})}),this.emit(YT.OFFLINE)),this._networkState=l}get networkState(){return this._networkState}get isOnline(){return this._networkState===K0.ONLINE}constructor(){super(),_e(this,"_moduleName","network-indicator"),_e(this,"_networkState",K0.ONLINE),_e(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=K0.ONLINE}),window.addEventListener("offline",()=>{this.networkState=K0.OFFLINE})}};function tG(l,i){var o=Object.keys(l);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(l);i&&(p=p.filter(function(g){return Object.getOwnPropertyDescriptor(l,g).enumerable})),o.push.apply(o,p)}return o}function QR(l){for(var i=1;i<arguments.length;i++){var o=arguments[i]!=null?arguments[i]:{};i%2?tG(Object(o),!0).forEach(function(p){_e(l,p,o[p])}):Object.getOwnPropertyDescriptors?Object.defineProperties(l,Object.getOwnPropertyDescriptors(o)):tG(Object(o)).forEach(function(p){Object.defineProperty(l,p,Object.getOwnPropertyDescriptor(o,p))})}return l}function VL(l,i){const o=l.indexOf(i);o!==-1&&l.splice(o,1)}function BI(l){const i=[];return l.forEach(o=>{i.indexOf(o)===-1&&i.push(o)}),i}function sT(l){pE!==void 0?pE.resolve().then(l):setTimeout(l,0)}function Q_(l){return JSON.parse(JSON.stringify(l))}function $R(l){try{return Q_(l)}catch{return l}}const eG={};function VO(l,i){eG[i]||(eG[i]=!0,l())}function dN(l){const i=window.atob(l),o=new Uint8Array(new ArrayBuffer(i.length));for(let p=0;p<i.length;p+=1)o[p]=i.charCodeAt(p);return o}function hN(l){let i="";for(let o=0;o<l.length;o+=1)i+=String.fromCharCode(l[o]);return window.btoa(i)}function AT(l){return window.TextEncoder?new TextEncoder().encode(l).length:l.length}function nG(l){let i=0;return/DingTalk/i.test(navigator.userAgent)&&l.realFormData&&(l=l.realFormData),l.forEach(o=>{i+=typeof o=="string"?AT(o):o.size}),i+138}function C$(l){const i=new yE(_p.TIMEOUT,"timeout");return new pE((o,p)=>{window.setTimeout(()=>p(i),l)})}function w0(l){return new pE(i=>{window.setTimeout(i,l)})}function T_(){let l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:7,i=arguments.length>1?arguments[1]:void 0;const o=Math.random().toString(16).substr(2,l).toLowerCase();return o.length===l?"".concat(i).concat(o):"".concat(i).concat(o)+T_(l-o.length,"")}function BL(){return T_(32,"").toUpperCase()}const pN=()=>{},rG=new class{constructor(){_e(this,"fnMap",new Map)}throttleByKey(l,i,o,p){for(var g=arguments.length,b=new Array(g>4?g-4:0),A=4;A<g;A++)b[A-4]=arguments[A];if(this.fnMap.has(i)){const j=this.fnMap.get(i);if(j.threshold!==o){j.fn(...j.args),clearTimeout(j.timer);const H=window.setTimeout(()=>{const z=this.fnMap.get(i);z&&z.fn(...z.args),this.fnMap.delete(i)},o);this.fnMap.set(i,{fn:l,threshold:o,timer:H,args:b,skipFn:p})}else j.skipFn&&j.skipFn(...j.args),this.fnMap.set(i,QR(QR({},j),{},{fn:l,args:b,skipFn:p}))}else{const j=window.setTimeout(()=>{const H=this.fnMap.get(i);H&&H.fn(...H.args),this.fnMap.delete(i)},o);this.fnMap.set(i,{fn:l,threshold:o,timer:j,args:b,skipFn:p})}}},iG=rG.throttleByKey.bind(rG);function sG(l){return typeof l=="object"&&l!==null&&!(l instanceof RegExp)}function GL(l,i){if(!sG(l)||!sG(i)||Array.isArray(l)&&!Array.isArray(i)||!Array.isArray(l)&&Array.isArray(i))return i;if(Array.isArray(i)&&Array.isArray(l)){const o=[...l];for(let p=0;p<i.length;p++)o[p]=GL(l[p],i[p]);return o}{const o=QR({},l);for(const p in i)Object.prototype.hasOwnProperty.call(i,p)&&(Object.prototype.hasOwnProperty.call(l,p)?o[p]=GL(l[p],i[p]):o[p]=i[p]);return o}}let R$=1,fN=console;class E0{static setLogger(i){fN=i}constructor(i){_e(this,"lockingPromise",pE.resolve()),_e(this,"locks",0),_e(this,"name",""),_e(this,"lockId",void 0),this.lockId=R$++,i&&(this.name=i),fN.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is created."))}get isLocked(){return this.locks>0}lock(i){let o;this.locks+=1,fN.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is locked, current queue ").concat(this.locks,". ").concat(typeof i=="string"?i:""));const p=new pE(b=>{o=()=>{this.locks-=1,fN.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is not locked, current queue ").concat(this.locks,". ").concat(typeof i=="string"?i:"")),b()}}),g=this.lockingPromise.then(()=>o);return this.lockingPromise=this.lockingPromise.then(()=>p),g}}function GI(l,i){return function(o,p,g){const b=g.value;if(typeof b!="function")throw new Error("Cannot use mutex on object property.");return g.value=async function(){const A=this[i];if(!A)throw new Error("mutex property key ".concat(i," doesn't exist on ").concat(l));const j=await A.lock("From ".concat(l,".").concat(p));try{for(var H=arguments.length,z=new Array(H),$=0;$<H;$++)z[$]=arguments[$];return await b.apply(this,z)}finally{j()}},g}}const $_={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function mN(l,i){const o=Math.floor(i.timeout*Math.pow(i.timeoutFactor,l));return Math.min(i.maxRetryTimeout,o)}function vT(l,i,o,p){const g=Object.assign({},$_,p);let b=g.timeout;const A=async()=>{await function(z){return new pE($=>{window.setTimeout($,z)})}(b),b*=g.timeoutFactor,b=Math.min(g.maxRetryTimeout,b)};let j=!1;const H=new pE(async(z,$)=>{i=i||(()=>!1),o=o||(()=>!0);for(let Vt=0;Vt<g.maxRetryCount;Vt+=1){if(j)return $(new yE(_p.OPERATION_ABORTED));try{const _r=await l();if(!i(_r,Vt)||Vt+1===g.maxRetryCount)return z(_r);await A()}catch(_r){if(!o(_r,Vt)||Vt+1===g.maxRetryCount)return $(_r);await A()}}});return H.cancel=()=>j=!0,H}var I$=rT,w$=BR,A$=LP,O$=GR,N$=TypeError,oG=function(l){return function(i,o,p,g){I$(o);var b=w$(i),A=A$(b),j=O$(b),H=l?j-1:0,z=l?-1:1;if(p<2)for(;;){if(H in A){g=A[H],H+=z;break}if(H+=z,l?H<0:j<=H)throw N$("Reduce of empty array with no initial value")}for(;l?H>=0:j>H;H+=z)H in A&&(g=o(g,A[H],H,b));return g}},P$={left:oG(!1),right:oG(!0)}.left;Y_({target:"Array",proto:!0,forced:!PO&&VR>79&&VR<83||!T3("reduce")},{reduce:function(l){var i=arguments.length;return P$(this,l,i,i>1?arguments[1]:void 0)}});var k$=qR("Array").reduce,D$=mT,L$=k$,qL=Array.prototype,ZR=LE(function(l){var i=l.reduce;return l===qL||D$(qL,l)&&i===qL.reduce?L$:i});let WL=class{constructor(l){_e(this,"input",[]),_e(this,"size",void 0),this.size=l}add(l){this.input.push(l),this.input.length>this.size&&this.input.splice(0,1)}mean(){var l;return this.input.length===0?0:ZR(l=this.input).call(l,(i,o)=>i+o)/this.input.length}};var HL,zL={exports:{}},aG=function(l,i){return function(){for(var o=new Array(arguments.length),p=0;p<o.length;p++)o[p]=arguments[p];return l.apply(i,o)}},x$=aG,KL=Object.prototype.toString,YL=(HL=Object.create(null),function(l){var i=KL.call(l);return HL[i]||(HL[i]=i.slice(8,-1).toLowerCase())});function tI(l){return l=l.toLowerCase(),function(i){return YL(i)===l}}function JL(l){return Array.isArray(l)}function gN(l){return l===void 0}var cG=tI("ArrayBuffer");function uG(l){return l!==null&&typeof l=="object"}function EN(l){if(YL(l)!=="object")return!1;var i=Object.getPrototypeOf(l);return i===null||i===Object.prototype}var M$=tI("Date"),U$=tI("File"),F$=tI("Blob"),j$=tI("FileList");function XL(l){return KL.call(l)==="[object Function]"}var V$=tI("URLSearchParams");function QL(l,i){if(l!=null)if(typeof l!="object"&&(l=[l]),JL(l))for(var o=0,p=l.length;o<p;o++)i.call(null,l[o],o,l);else for(var g in l)Object.prototype.hasOwnProperty.call(l,g)&&i.call(null,l[g],g,l)}var $L,B$=($L=typeof Uint8Array<"u"&&Object.getPrototypeOf(Uint8Array),function(l){return $L&&l instanceof $L}),tS={isArray:JL,isArrayBuffer:cG,isBuffer:function(l){return l!==null&&!gN(l)&&l.constructor!==null&&!gN(l.constructor)&&typeof l.constructor.isBuffer=="function"&&l.constructor.isBuffer(l)},isFormData:function(l){var i="[object FormData]";return l&&(typeof FormData=="function"&&l instanceof FormData||KL.call(l)===i||XL(l.toString)&&l.toString()===i)},isArrayBufferView:function(l){return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(l):l&&l.buffer&&cG(l.buffer)},isString:function(l){return typeof l=="string"},isNumber:function(l){return typeof l=="number"},isObject:uG,isPlainObject:EN,isUndefined:gN,isDate:M$,isFile:U$,isBlob:F$,isFunction:XL,isStream:function(l){return uG(l)&&XL(l.pipe)},isURLSearchParams:V$,isStandardBrowserEnv:function(){return(typeof navigator>"u"||navigator.product!=="ReactNative"&&navigator.product!=="NativeScript"&&navigator.product!=="NS")&&typeof window<"u"&&typeof document<"u"},forEach:QL,merge:function l(){var i={};function o(b,A){EN(i[A])&&EN(b)?i[A]=l(i[A],b):EN(b)?i[A]=l({},b):JL(b)?i[A]=b.slice():i[A]=b}for(var p=0,g=arguments.length;p<g;p++)QL(arguments[p],o);return i},extend:function(l,i,o){return QL(i,function(p,g){l[g]=o&&typeof p=="function"?x$(p,o):p}),l},trim:function(l){return l.trim?l.trim():l.replace(/^\s+|\s+$/g,"")},stripBOM:function(l){return l.charCodeAt(0)===65279&&(l=l.slice(1)),l},inherits:function(l,i,o,p){l.prototype=Object.create(i.prototype,p),l.prototype.constructor=l,o&&Object.assign(l.prototype,o)},toFlatObject:function(l,i,o){var p,g,b,A={};i=i||{};do{for(g=(p=Object.getOwnPropertyNames(l)).length;g-- >0;)A[b=p[g]]||(i[b]=l[b],A[b]=!0);l=Object.getPrototypeOf(l)}while(l&&(!o||o(l,i))&&l!==Object.prototype);return i},kindOf:YL,kindOfTest:tI,endsWith:function(l,i,o){l=String(l),(o===void 0||o>l.length)&&(o=l.length),o-=i.length;var p=l.indexOf(i,o);return p!==-1&&p===o},toArray:function(l){if(!l)return null;var i=l.length;if(gN(i))return null;for(var o=new Array(i);i-- >0;)o[i]=l[i];return o},isTypedArray:B$,isFileList:j$},qI=tS;function lG(l){return encodeURIComponent(l).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var dG=function(l,i,o){if(!i)return l;var p;if(o)p=o(i);else if(qI.isURLSearchParams(i))p=i.toString();else{var g=[];qI.forEach(i,function(A,j){A!=null&&(qI.isArray(A)?j+="[]":A=[A],qI.forEach(A,function(H){qI.isDate(H)?H=H.toISOString():qI.isObject(H)&&(H=JSON.stringify(H)),g.push(lG(j)+"="+lG(H))}))}),p=g.join("&")}if(p){var b=l.indexOf("#");b!==-1&&(l=l.slice(0,b)),l+=(l.indexOf("?")===-1?"?":"&")+p}return l},G$=tS;function vN(){this.handlers=[]}vN.prototype.use=function(l,i,o){return this.handlers.push({fulfilled:l,rejected:i,synchronous:!!o&&o.synchronous,runWhen:o?o.runWhen:null}),this.handlers.length-1},vN.prototype.eject=function(l){this.handlers[l]&&(this.handlers[l]=null)},vN.prototype.forEach=function(l){G$.forEach(this.handlers,function(i){i!==null&&l(i)})};var hG,pG,q$=vN,W$=tS;function WI(){if(pG)return hG;pG=1;var l=tS;function i(g,b,A,j,H){Error.call(this),this.message=g,this.name="AxiosError",b&&(this.code=b),A&&(this.config=A),j&&(this.request=j),H&&(this.response=H)}l.inherits(i,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}}});var o=i.prototype,p={};return["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED"].forEach(function(g){p[g]={value:g}}),Object.defineProperties(i,p),Object.defineProperty(o,"isAxiosError",{value:!0}),i.from=function(g,b,A,j,H,z){var $=Object.create(o);return l.toFlatObject(g,$,function(Vt){return Vt!==Error.prototype}),i.call($,g.message,b,A,j,H),$.name=g.name,z&&Object.assign($,z),$},hG=i}var ZL,fG,mG,gG,_x,EG,vG={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1};function _G(){if(fG)return ZL;fG=1;var l=tS;return ZL=function(i,o){o=o||new FormData;var p=[];function g(b){return b===null?"":l.isDate(b)?b.toISOString():l.isArrayBuffer(b)||l.isTypedArray(b)?typeof Blob=="function"?new Blob([b]):Buffer.from(b):b}return function b(A,j){if(l.isPlainObject(A)||l.isArray(A)){if(p.indexOf(A)!==-1)throw Error("Circular reference detected in "+j);p.push(A),l.forEach(A,function(H,z){if(!l.isUndefined(H)){var $,Vt=j?j+"."+z:z;if(H&&!j&&typeof H=="object"){if(l.endsWith(z,"{}"))H=JSON.stringify(H);else if(l.endsWith(z,"[]")&&($=l.toArray(H)))return void $.forEach(function(_r){!l.isUndefined(_r)&&o.append(Vt,g(_r))})}b(H,Vt)}}),p.pop()}else o.append(j,g(A))}(i),o},ZL}function H$(){if(gG)return mG;gG=1;var l=WI();return mG=function(i,o,p){var g=p.config.validateStatus;p.status&&g&&!g(p.status)?o(new l("Request failed with status code "+p.status,[l.ERR_BAD_REQUEST,l.ERR_BAD_RESPONSE][Math.floor(p.status/100)-4],p.config,p.request,p)):i(p)}}function z$(){if(EG)return _x;EG=1;var l=tS;return _x=l.isStandardBrowserEnv()?{write:function(i,o,p,g,b,A){var j=[];j.push(i+"="+encodeURIComponent(o)),l.isNumber(p)&&j.push("expires="+new Date(p).toGMTString()),l.isString(g)&&j.push("path="+g),l.isString(b)&&j.push("domain="+b),A===!0&&j.push("secure"),document.cookie=j.join("; ")},read:function(i){var o=document.cookie.match(new RegExp("(^|;\\s*)("+i+")=([^;]*)"));return o?decodeURIComponent(o[3]):null},remove:function(i){this.write(i,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}},_x}var tM,yG,bG,SG,TG,CG,RG,IG,eM,wG,AG,OG,K$=function(l){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(l)},Y$=function(l,i){return i?l.replace(/\/+$/,"")+"/"+i.replace(/^\/+/,""):l},NG=function(l,i){return l&&!K$(i)?Y$(l,i):i};function J$(){if(yG)return tM;yG=1;var l=tS,i=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];return tM=function(o){var p,g,b,A={};return o&&l.forEach(o.split(`
`),function(j){if(b=j.indexOf(":"),p=l.trim(j.substr(0,b)).toLowerCase(),g=l.trim(j.substr(b+1)),p){if(A[p]&&i.indexOf(p)>=0)return;A[p]=p==="set-cookie"?(A[p]?A[p]:[]).concat([g]):A[p]?A[p]+", "+g:g}}),A},tM}function X$(){if(SG)return bG;SG=1;var l=tS;return bG=l.isStandardBrowserEnv()?function(){var i,o=/(msie|trident)/i.test(navigator.userAgent),p=document.createElement("a");function g(b){var A=b;return o&&(p.setAttribute("href",A),A=p.href),p.setAttribute("href",A),{href:p.href,protocol:p.protocol?p.protocol.replace(/:$/,""):"",host:p.host,search:p.search?p.search.replace(/^\?/,""):"",hash:p.hash?p.hash.replace(/^#/,""):"",hostname:p.hostname,port:p.port,pathname:p.pathname.charAt(0)==="/"?p.pathname:"/"+p.pathname}}return i=g(window.location.href),function(b){var A=l.isString(b)?g(b):b;return A.protocol===i.protocol&&A.host===i.host}}():function(){return!0}}function _N(){if(CG)return TG;CG=1;var l=WI();function i(o){l.call(this,o??"canceled",l.ERR_CANCELED),this.name="CanceledError"}return tS.inherits(i,l,{__CANCEL__:!0}),TG=i}function Q$(){return IG||(IG=1,RG=function(l){var i=/^([-+\w]{1,25})(:?\/\/|:)/.exec(l);return i&&i[1]||""}),RG}function $$(){if(wG)return eM;wG=1;var l=tS,i=H$(),o=z$(),p=dG,g=NG,b=J$(),A=X$(),j=vG,H=WI(),z=_N(),$=Q$();return eM=function(Vt){return new Promise(function(_r,Fi){var _l,_u=Vt.data,_h=Vt.headers,_g=Vt.responseType;function eE(){Vt.cancelToken&&Vt.cancelToken.unsubscribe(_l),Vt.signal&&Vt.signal.removeEventListener("abort",_l)}l.isFormData(_u)&&l.isStandardBrowserEnv()&&delete _h["Content-Type"];var oE=new XMLHttpRequest;if(Vt.auth){var SE=Vt.auth.username||"",vE=Vt.auth.password?unescape(encodeURIComponent(Vt.auth.password)):"";_h.Authorization="Basic "+btoa(SE+":"+vE)}var fE=g(Vt.baseURL,Vt.url);function mE(){if(oE){var OE="getAllResponseHeaders"in oE?b(oE.getAllResponseHeaders()):null,$E={data:_g&&_g!=="text"&&_g!=="json"?oE.response:oE.responseText,status:oE.status,statusText:oE.statusText,headers:OE,config:Vt,request:oE};i(function(s_){_r(s_),eE()},function(s_){Fi(s_),eE()},$E),oE=null}}if(oE.open(Vt.method.toUpperCase(),p(fE,Vt.params,Vt.paramsSerializer),!0),oE.timeout=Vt.timeout,"onloadend"in oE?oE.onloadend=mE:oE.onreadystatechange=function(){oE&&oE.readyState===4&&(oE.status!==0||oE.responseURL&&oE.responseURL.indexOf("file:")===0)&&setTimeout(mE)},oE.onabort=function(){oE&&(Fi(new H("Request aborted",H.ECONNABORTED,Vt,oE)),oE=null)},oE.onerror=function(){Fi(new H("Network Error",H.ERR_NETWORK,Vt,oE,oE)),oE=null},oE.ontimeout=function(){var OE=Vt.timeout?"timeout of "+Vt.timeout+"ms exceeded":"timeout exceeded",$E=Vt.transitional||j;Vt.timeoutErrorMessage&&(OE=Vt.timeoutErrorMessage),Fi(new H(OE,$E.clarifyTimeoutError?H.ETIMEDOUT:H.ECONNABORTED,Vt,oE)),oE=null},l.isStandardBrowserEnv()){var EE=(Vt.withCredentials||A(fE))&&Vt.xsrfCookieName?o.read(Vt.xsrfCookieName):void 0;EE&&(_h[Vt.xsrfHeaderName]=EE)}"setRequestHeader"in oE&&l.forEach(_h,function(OE,$E){_u===void 0&&$E.toLowerCase()==="content-type"?delete _h[$E]:oE.setRequestHeader($E,OE)}),l.isUndefined(Vt.withCredentials)||(oE.withCredentials=!!Vt.withCredentials),_g&&_g!=="json"&&(oE.responseType=Vt.responseType),typeof Vt.onDownloadProgress=="function"&&oE.addEventListener("progress",Vt.onDownloadProgress),typeof Vt.onUploadProgress=="function"&&oE.upload&&oE.upload.addEventListener("progress",Vt.onUploadProgress),(Vt.cancelToken||Vt.signal)&&(_l=function(OE){oE&&(Fi(!OE||OE&&OE.type?new z:OE),oE.abort(),oE=null)},Vt.cancelToken&&Vt.cancelToken.subscribe(_l),Vt.signal&&(Vt.signal.aborted?_l():Vt.signal.addEventListener("abort",_l))),_u||(_u=null);var PE=$(fE);PE&&["http","https","file"].indexOf(PE)===-1?Fi(new H("Unsupported protocol "+PE+":",H.ERR_BAD_REQUEST,Vt)):oE.send(_u)})},eM}var Q0=tS,PG=function(l,i){W$.forEach(l,function(o,p){p!==i&&p.toUpperCase()===i.toUpperCase()&&(l[i]=o,delete l[p])})},kG=WI(),Z$=vG,tZ=_G(),eZ={"Content-Type":"application/x-www-form-urlencoded"};function DG(l,i){!Q0.isUndefined(l)&&Q0.isUndefined(l["Content-Type"])&&(l["Content-Type"]=i)}var LG,yN={transitional:Z$,adapter:((typeof XMLHttpRequest<"u"||typeof process<"u"&&Object.prototype.toString.call(process)==="[object process]")&&(LG=$$()),LG),transformRequest:[function(l,i){if(PG(i,"Accept"),PG(i,"Content-Type"),Q0.isFormData(l)||Q0.isArrayBuffer(l)||Q0.isBuffer(l)||Q0.isStream(l)||Q0.isFile(l)||Q0.isBlob(l))return l;if(Q0.isArrayBufferView(l))return l.buffer;if(Q0.isURLSearchParams(l))return DG(i,"application/x-www-form-urlencoded;charset=utf-8"),l.toString();var o,p=Q0.isObject(l),g=i&&i["Content-Type"];if((o=Q0.isFileList(l))||p&&g==="multipart/form-data"){var b=this.env&&this.env.FormData;return tZ(o?{"files[]":l}:l,b&&new b)}return p||g==="application/json"?(DG(i,"application/json"),function(A,j,H){if(Q0.isString(A))try{return(j||JSON.parse)(A),Q0.trim(A)}catch(z){if(z.name!=="SyntaxError")throw z}return(H||JSON.stringify)(A)}(l)):l}],transformResponse:[function(l){var i=this.transitional||yN.transitional,o=i&&i.silentJSONParsing,p=i&&i.forcedJSONParsing,g=!o&&this.responseType==="json";if(g||p&&Q0.isString(l)&&l.length)try{return JSON.parse(l)}catch(b){if(g)throw b.name==="SyntaxError"?kG.from(b,kG.ERR_BAD_RESPONSE,this,null,this.response):b}return l}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:OG?AG:(OG=1,AG=null)},validateStatus:function(l){return l>=200&&l<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};Q0.forEach(["delete","get","head"],function(l){yN.headers[l]={}}),Q0.forEach(["post","put","patch"],function(l){yN.headers[l]=Q0.merge(eZ)});var xG,MG,nM=yN,nZ=tS,rZ=nM;function UG(){return MG?xG:(MG=1,xG=function(l){return!(!l||!l.__CANCEL__)})}var FG=tS,rM=function(l,i,o){var p=this||rZ;return nZ.forEach(o,function(g){l=g.call(p,l,i)}),l},iZ=UG(),sZ=nM,oZ=_N();function iM(l){if(l.cancelToken&&l.cancelToken.throwIfRequested(),l.signal&&l.signal.aborted)throw new oZ}var jG,VG,GS=tS,BG=function(l,i){i=i||{};var o={};function p(z,$){return GS.isPlainObject(z)&&GS.isPlainObject($)?GS.merge(z,$):GS.isPlainObject($)?GS.merge({},$):GS.isArray($)?$.slice():$}function g(z){return GS.isUndefined(i[z])?GS.isUndefined(l[z])?void 0:p(void 0,l[z]):p(l[z],i[z])}function b(z){if(!GS.isUndefined(i[z]))return p(void 0,i[z])}function A(z){return GS.isUndefined(i[z])?GS.isUndefined(l[z])?void 0:p(void 0,l[z]):p(void 0,i[z])}function j(z){return z in i?p(l[z],i[z]):z in l?p(void 0,l[z]):void 0}var H={url:b,method:b,data:b,baseURL:A,transformRequest:A,transformResponse:A,paramsSerializer:A,timeout:A,timeoutMessage:A,withCredentials:A,adapter:A,responseType:A,xsrfCookieName:A,xsrfHeaderName:A,onUploadProgress:A,onDownloadProgress:A,decompress:A,maxContentLength:A,maxBodyLength:A,beforeRedirect:A,transport:A,httpAgent:A,httpsAgent:A,cancelToken:A,socketPath:A,responseEncoding:A,validateStatus:j};return GS.forEach(Object.keys(l).concat(Object.keys(i)),function(z){var $=H[z]||g,Vt=$(z);GS.isUndefined(Vt)&&$!==j||(o[z]=Vt)}),o};function GG(){return VG?jG:(VG=1,jG={version:"0.27.2"})}var aZ=GG().version,dR=WI(),sM={};["object","boolean","number","function","string","symbol"].forEach(function(l,i){sM[l]=function(o){return typeof o===l||"a"+(i<1?"n ":" ")+l}});var qG={};sM.transitional=function(l,i,o){function p(g,b){return"[Axios v"+aZ+"] Transitional option '"+g+"'"+b+(o?". "+o:"")}return function(g,b,A){if(l===!1)throw new dR(p(b," has been removed"+(i?" in "+i:"")),dR.ERR_DEPRECATED);return i&&!qG[b]&&(qG[b]=!0,console.warn(p(b," has been deprecated since v"+i+" and will be removed in the near future"))),!l||l(g,b,A)}};var WG,HG,zG,KG,YG,JG,cZ={assertOptions:function(l,i,o){if(typeof l!="object")throw new dR("options must be an object",dR.ERR_BAD_OPTION_VALUE);for(var p=Object.keys(l),g=p.length;g-- >0;){var b=p[g],A=i[b];if(A){var j=l[b],H=j===void 0||A(j,b,l);if(H!==!0)throw new dR("option "+b+" must be "+H,dR.ERR_BAD_OPTION_VALUE)}else if(o!==!0)throw new dR("Unknown option "+b,dR.ERR_BAD_OPTION)}},validators:sM},XG=tS,uZ=dG,QG=q$,$G=function(l){return iM(l),l.headers=l.headers||{},l.data=rM.call(l,l.data,l.headers,l.transformRequest),l.headers=FG.merge(l.headers.common||{},l.headers[l.method]||{},l.headers),FG.forEach(["delete","get","head","post","put","patch","common"],function(i){delete l.headers[i]}),(l.adapter||sZ.adapter)(l).then(function(i){return iM(l),i.data=rM.call(l,i.data,i.headers,l.transformResponse),i},function(i){return iZ(i)||(iM(l),i&&i.response&&(i.response.data=rM.call(l,i.response.data,i.response.headers,l.transformResponse))),Promise.reject(i)})},bN=BG,lZ=NG,ZG=cZ,HI=ZG.validators;function zI(l){this.defaults=l,this.interceptors={request:new QG,response:new QG}}zI.prototype.request=function(l,i){typeof l=="string"?(i=i||{}).url=l:i=l||{},(i=bN(this.defaults,i)).method?i.method=i.method.toLowerCase():this.defaults.method?i.method=this.defaults.method.toLowerCase():i.method="get";var o=i.transitional;o!==void 0&&ZG.assertOptions(o,{silentJSONParsing:HI.transitional(HI.boolean),forcedJSONParsing:HI.transitional(HI.boolean),clarifyTimeoutError:HI.transitional(HI.boolean)},!1);var p=[],g=!0;this.interceptors.request.forEach(function(Vt){typeof Vt.runWhen=="function"&&Vt.runWhen(i)===!1||(g=g&&Vt.synchronous,p.unshift(Vt.fulfilled,Vt.rejected))});var b,A=[];if(this.interceptors.response.forEach(function(Vt){A.push(Vt.fulfilled,Vt.rejected)}),!g){var j=[$G,void 0];for(Array.prototype.unshift.apply(j,p),j=j.concat(A),b=Promise.resolve(i);j.length;)b=b.then(j.shift(),j.shift());return b}for(var H=i;p.length;){var z=p.shift(),$=p.shift();try{H=z(H)}catch(Vt){$(Vt);break}}try{b=$G(H)}catch(Vt){return Promise.reject(Vt)}for(;A.length;)b=b.then(A.shift(),A.shift());return b},zI.prototype.getUri=function(l){l=bN(this.defaults,l);var i=lZ(l.baseURL,l.url);return uZ(i,l.params,l.paramsSerializer)},XG.forEach(["delete","get","head","options"],function(l){zI.prototype[l]=function(i,o){return this.request(bN(o||{},{method:l,url:i,data:(o||{}).data}))}}),XG.forEach(["post","put","patch"],function(l){function i(o){return function(p,g,b){return this.request(bN(b||{},{method:l,headers:o?{"Content-Type":"multipart/form-data"}:{},url:p,data:g}))}}zI.prototype[l]=i(),zI.prototype[l+"Form"]=i(!0)});var t6=tS,dZ=aG,SN=zI,hZ=BG,IS=function l(i){var o=new SN(i),p=dZ(SN.prototype.request,o);return t6.extend(p,SN.prototype,o),t6.extend(p,o),p.create=function(g){return l(hZ(i,g))},p}(nM);IS.Axios=SN,IS.CanceledError=_N(),IS.CancelToken=function(){if(HG)return WG;HG=1;var l=_N();function i(o){if(typeof o!="function")throw new TypeError("executor must be a function.");var p;this.promise=new Promise(function(b){p=b});var g=this;this.promise.then(function(b){if(g._listeners){var A,j=g._listeners.length;for(A=0;A<j;A++)g._listeners[A](b);g._listeners=null}}),this.promise.then=function(b){var A,j=new Promise(function(H){g.subscribe(H),A=H}).then(b);return j.cancel=function(){g.unsubscribe(A)},j},o(function(b){g.reason||(g.reason=new l(b),p(g.reason))})}return i.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},i.prototype.subscribe=function(o){this.reason?o(this.reason):this._listeners?this._listeners.push(o):this._listeners=[o]},i.prototype.unsubscribe=function(o){if(this._listeners){var p=this._listeners.indexOf(o);p!==-1&&this._listeners.splice(p,1)}},i.source=function(){var o;return{token:new i(function(p){o=p}),cancel:o}},WG=i}(),IS.isCancel=UG(),IS.VERSION=GG().version,IS.toFormData=_G(),IS.AxiosError=WI(),IS.Cancel=IS.CanceledError,IS.all=function(l){return Promise.all(l)},IS.spread=KG?zG:(KG=1,zG=function(l){return function(i){return l.apply(null,i)}}),IS.isAxiosError=function(){if(JG)return YG;JG=1;var l=tS;return YG=function(i){return l.isObject(i)&&i.isAxiosError===!0}}(),zL.exports=IS,zL.exports.default=IS;var aS=LE(zL.exports);function e6(l,i){var o=Object.keys(l);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(l);i&&(p=p.filter(function(g){return Object.getOwnPropertyDescriptor(l,g).enumerable})),o.push.apply(o,p)}return o}function n6(l){for(var i=1;i<arguments.length;i++){var o=arguments[i]!=null?arguments[i]:{};i%2?e6(Object(o),!0).forEach(function(p){_e(l,p,o[p])}):Object.getOwnPropertyDescriptors?Object.defineProperties(l,Object.getOwnPropertyDescriptors(o)):e6(Object(o)).forEach(function(p){Object.defineProperty(l,p,Object.getOwnPropertyDescriptor(o,p))})}return l}let TN,CN=0,oM=0;function aM(l,i,o,p){return new pE((g,b)=>{i.responseType=i.responseType||"json",i.data&&!o?(i.data=JSON.stringify(i.data),CN+=AT(i.data)):o&&(i.data.size?CN+=i.data.size:i.data instanceof FormData?CN+=nG(i.data):CN+=AT(JSON.stringify(i.data))),i.headers=i.headers||{},i.headers["Content-Type"]=i.headers["Content-Type"]||"application/json",i.method="POST",i.url=l,aS.request(i).then(A=>{typeof A.data=="string"?oM+=AT(A.data):A.data instanceof ArrayBuffer||A.data instanceof Uint8Array?oM+=A.data.byteLength:oM+=AT(JSON.stringify(A.data)),p&&g({data:A.data,headers:A.headers}),g(A.data)}).catch(A=>{aS.isCancel(A)?b(new yE(_p.OPERATION_ABORTED,"cancel token canceled")):A.code==="ECONNABORTED"?b(new yE(_p.NETWORK_TIMEOUT,A.message)):A.response?b(new yE(_p.NETWORK_RESPONSE_ERROR,A.response.status)):b(new yE(_p.NETWORK_ERROR,A.message))})})}async function pZ(l,i){const o=new Blob([i.data],{type:"buffer"});return await aM(l,n6(n6({},i),{},{data:o,headers:{"Content-Type":"application/octet-stream"}}),!0)}const fZ=()=>(TN||TN||(TN=(window.location.protocol.split(":")[0]||"").toUpperCase(),TN))==="HTTPS",r6=()=>window.isSecureContext!==void 0;function i6(l,i){var o=Object.keys(l);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(l);i&&(p=p.filter(function(g){return Object.getOwnPropertyDescriptor(l,g).enumerable})),o.push.apply(o,p)}return o}function BE(l){for(var i=1;i<arguments.length;i++){var o=arguments[i]!=null?arguments[i]:{};i%2?i6(Object(o),!0).forEach(function(p){_e(l,p,o[p])}):Object.getOwnPropertyDescriptors?Object.defineProperties(l,Object.getOwnPropertyDescriptors(o)):i6(Object(o)).forEach(function(p){Object.defineProperty(l,p,Object.getOwnPropertyDescriptor(o,p))})}return l}var r_;(function(l){l.SET_SESSION_ID="SET_SESSION_ID",l.SET_P2P_ID="SET_P2P_id",l.SET_DC_ID="SET_DC_id",l.SET_UID="SET_UID",l.SET_PUB_ID="SET_PUB_ID",l.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",l.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",l.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",l.AVOID_JOIN_START="AVOID_JOIN_START",l.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",l.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",l.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",l.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",l.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",l.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",l.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",l.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",l.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",l.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",l.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",l.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",l.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",l.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",l.RESET_KEY_METRICS="RESET_KEY_METRICS",l.SET_USE_DATACHANNEL="SET_USE_DATACHANNEL",l.SET_USE_P2P="SET_USE_P2P"})(r_||(r_={}));class mZ{constructor(i,o,p,g){_e(this,"state",void 0),this.state={codec:i,audioCodec:o,mode:p,clientId:g,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,avoidJoinStart:0,keyMetrics:{publish:[],subscribe:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useDataChannel:!1,useP2P:!1}}dispatch(i){this.state=function(o,p){switch(p.type){case r_.SET_SESSION_ID:return BE(BE({},o),{},{sessionId:p.sessionId});case r_.SET_P2P_ID:return BE(BE({},o),{},{p2pId:p.p2pId});case r_.SET_UID:return BE(BE({},o),{},{uid:p.uid});case r_.SET_PUB_ID:return BE(BE({},o),{},{pubId:p.pubId});case r_.KEY_METRIC_CLIENT_CREATED:return BE(BE({},o),{},{keyMetrics:BE(BE({},o.keyMetrics),{},{clientCreated:p.metric})});case r_.KEY_METRIC_JOIN_START:return BE(BE({},o),{},{keyMetrics:BE(BE({},o.keyMetrics),{},{joinStart:p.metric})});case r_.AVOID_JOIN_START:return BE(BE({},o),{},{avoidJoinStart:p.avoidJoinStart});case r_.KEY_METRIC_JOIN_END:return BE(BE({},o),{},{keyMetrics:BE(BE({},o.keyMetrics),{},{joinEnd:p.metric})});case r_.KEY_METRIC_REQUEST_AP_START:return BE(BE({},o),{},{keyMetrics:BE(BE({},o.keyMetrics),{},{requestAPStart:p.metric})});case r_.KEY_METRIC_REQUEST_AP_END:return BE(BE({},o),{},{keyMetrics:BE(BE({},o.keyMetrics),{},{requestAPEnd:p.metric})});case r_.KEY_METRIC_JOIN_GATEWAY_START:return BE(BE({},o),{},{keyMetrics:BE(BE({},o.keyMetrics),{},{joinGatewayStart:p.metric})});case r_.KEY_METRIC_JOIN_GATEWAY_END:return BE(BE({},o),{},{keyMetrics:BE(BE({},o.keyMetrics),{},{joinGatewayEnd:p.metric})});case r_.KEY_METRIC_PEER_CONNECTION_START:return BE(BE({},o),{},{keyMetrics:BE(BE({},o.keyMetrics),{},{peerConnectionStart:p.metric})});case r_.KEY_METRIC_PEER_CONNECTION_END:return BE(BE({},o),{},{keyMetrics:BE(BE({},o.keyMetrics),{},{peerConnectionEnd:p.metric})});case r_.KEY_METRIC_DESCRIPTION_START:return BE(BE({},o),{},{keyMetrics:BE(BE({},o.keyMetrics),{},{descriptionStart:p.metric})});case r_.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return BE(BE({},o),{},{keyMetrics:BE(BE({},o.keyMetrics),{},{signalChannelOpen:p.metric})});case r_.KEY_METRIC_ICE_CONNECTION_END:return BE(BE({},o),{},{keyMetrics:BE(BE({},o.keyMetrics),{},{iceConnectionEnd:p.metric})});case r_.KEY_METRIC_PUBLISH:{const g=o.keyMetrics.publish,b=g.findIndex(A=>A.trackId===p.metric.trackId);return b!==-1?(g[b]=BE(BE({},g[b]),p.metric),BE(BE({},o),{},{keyMetrics:BE(BE({},o.keyMetrics),{},{publish:[...g]})})):BE(BE({},o),{},{keyMetrics:BE(BE({},o.keyMetrics),{},{publish:[...o.keyMetrics.publish,p.metric]})})}case r_.KEY_METRIC_SUBSCRIBE:{const g=o.keyMetrics.subscribe,b=g.findIndex(A=>A.userId===p.metric.userId&&A.type===p.metric.type);return b!==-1?(g[b]=BE(BE({},g[b]),p.metric),BE(BE({},o),{},{keyMetrics:BE(BE({},o.keyMetrics),{},{subscribe:[...g]})})):BE(BE({},o),{},{keyMetrics:BE(BE({},o.keyMetrics),{},{subscribe:[...o.keyMetrics.subscribe,p.metric]})})}case r_.SET_CLOUD_PROXY_SERVER_MODE:return o.cloudProxyServerMode=p.mode,o;case r_.RECORD_JOIN_CHANNEL_SERVICE:return typeof p.index!="number"?o.joinChannelServiceRecords=[...o.joinChannelServiceRecords,p.record]:(o.joinChannelServiceRecords[p.index]=BE(BE({},o.joinChannelServiceRecords[p.index]),p.record),o.joinChannelServiceRecords=[...o.joinChannelServiceRecords]),o;case r_.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return o.joinChannelServiceRecords=[],o;case r_.RESET_KEY_METRICS:return o.keyMetrics={publish:[],subscribe:[]},o;case r_.SET_USE_DATACHANNEL:return BE(BE({},o),{},{useDataChannel:p.val});case r_.SET_USE_P2P:return BE(BE({},o),{},{useP2P:p.val});default:return o}}(this.state,i)}set sessionId(i){this.dispatch({type:r_.SET_SESSION_ID,sessionId:i})}get sessionId(){return this.state.sessionId}set codec(i){this.state.codec=i}get codec(){return this.state.codec}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(i){this.dispatch({type:r_.SET_P2P_ID,p2pId:i})}get p2pId(){return this.state.p2pId}set dcId(i){this.dispatch({type:r_.SET_DC_ID,dcId:i})}get dcId(){return this.state.dcId}set uid(i){this.dispatch({type:r_.SET_UID,uid:i})}get uid(){return this.state.uid}set pubId(i){this.dispatch({type:r_.SET_PUB_ID,pubId:i})}get pubId(){return this.state.pubId}set cloudProxyServerMode(i){this.dispatch({type:r_.SET_CLOUD_PROXY_SERVER_MODE,mode:i})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useDataChannel(i){this.dispatch({type:r_.SET_USE_DATACHANNEL,val:i})}get useDataChannel(){return this.state.useDataChannel}set useP2P(i){this.dispatch({type:r_.SET_USE_P2P,val:i})}get useP2P(){return this.state.useP2P}clientCreated(){this.dispatch({type:r_.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:r_.KEY_METRIC_JOIN_START,metric:Date.now()})}joinEnd(){this.dispatch({type:r_.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:r_.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:r_.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:r_.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:r_.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:r_.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:r_.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}descriptionStart(){this.dispatch({type:r_.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:r_.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:r_.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(i,o,p,g){this.dispatch({type:r_.KEY_METRIC_PUBLISH,metric:BE(BE({trackId:i,type:o},p&&{publishStart:p}),g&&{publishEnd:g})})}subscribe(i,o,p,g,b,A,j){this.dispatch({type:r_.KEY_METRIC_SUBSCRIBE,metric:BE(BE(BE(BE(BE({userId:i,type:o},p&&{subscribeStart:p}),g&&{subscribeEnd:g}),b&&{firstFrame:b}),A&&{streamAdded:A}),j&&{firstDecoded:j})})}massSubscribe(i,o,p,g){i.forEach(b=>{this.dispatch({type:r_.KEY_METRIC_SUBSCRIBE,metric:BE(BE(BE({userId:b.userId,type:b.type},o&&{subscribeStart:o}),p&&{subscribeEnd:p}),g&&{firstFrame:g})})})}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(i,o){i.service==="gateway"&&Array.isArray(i.urls)&&(i.urls=i.urls.map(p=>p.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return typeof o!="number"?(this.dispatch({type:r_.RECORD_JOIN_CHANNEL_SERVICE,record:BE(BE({},i),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(o<0||o>=this.state.joinChannelServiceRecords.length||this.dispatch({type:r_.RECORD_JOIN_CHANNEL_SERVICE,record:i,index:o}),o)}catch{return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:r_.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:r_.RESET_KEY_METRICS})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch{return[]}}get avoidJoinStart(){return this.state.avoidJoinStart}set avoidJoinStart(i){this.dispatch({type:r_.AVOID_JOIN_START,avoidJoinStart:i})}}const qS=function(l){if(l.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return l;const i=l.match(/([0-9]+\.[0-9]+\.[0-9]+)\-alpha\.([0-9]+)/);if(i&&i[1]&&i[2]){const p=i[1],g=i[2];return"".concat(p,".").concat(g)}const o=l.match(/([0-9]+\.[0-9]+\.[0-9]+)\-special\.([0-9]+)/);if(o&&o[1]&&o[2]){const p=o[1],g=o[2];return"".concat(p,".").concat(100*(Number(g)+1))}return"4.0.0.999"}("4.19.3"),cM=function(){try{return JSON.parse("true")===!0}catch{return!0}}(),uM="v4.19.3-0-gb2ca8ca7(11/2/2023, 2:57:33 PM)",$0={PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",ENABLE_EVENT_REPORT:!0,GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,UPLOAD_LOG:!1,NOT_REPORT_EVENT:[],SUBSCRIBE_TWCC:!1,PUBLISH_TWCC:!1,PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],WORKER_DOMAIN:"edge.agora.io",TURN_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,PRELOAD_MEDIA_COUNT:0,USE_PUB_RTX:!1,USE_SUB_RTX:!1,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:100,PROFILE_SWITCH_INTERVAL:2e3,UNSUPPORTED_VIDEO_CODEC:[],ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!0,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,DISABLE_FEC:void 0,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,ICE_RESTART_INTERVAL:1e4,NEW_ICE_RESTART:!1,ENABLE_USER_LICENSE_CHECK:!0,SIGNAL_CHANNEL:0,TRANSMITTER_INITIAL_RTT:30,TRANSMITTER_INITIAL_RTO:30,TRANSMITTER_MAX_BATCH_ACK_COUNT:2,TRANSMITTER_MAX_RTO:500,DATACHANNEL_COMPRESS:!1,FINGERPRINT:null,DC_JOIN_WITH_FAILBACK:5e3,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,AP_AREA:!0,SVC:[],ENABLE_ENCODED_TRANSFORM:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,RTM2_FLAG:void 0,AP_RTM:!1,ENABLE_DATASTREAM_2:!1,DATASTREAM_MAX_RETRANSMITS:10,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,ENABLE_INSTANT_VIDEO:!1,ENABLE_NTP_REPORT:!1,USE_XR:!1,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:1e4,P2P:!1,SHOW_P2P_LOG:!1,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[]};function y_(l,i,o){var p,g;VE(p=Object.keys($0)).call(p,l)&&(!o&&VE(g=Object.keys(hR)).call(g,l)||($0[l]=i))}function nE(l){return $0[l]}const hR={};var eI,s6;(function(l){l.h264="h264",l.h265="h265",l.vp8="vp8",l.vp9="vp9",l.av1="av1"})(eI||(eI={})),function(l){l.opus="opus",l.pcma="pcma",l.pcmu="pcmu",l.g722="g722"}(s6||(s6={}));const RN=new class extends D_{reportLogUploadError(l){this.emit("REPORT_LOG_UPLOAD",l)}};class gZ{constructor(i){_e(this,"logger",void 0),_e(this,"prefixLists",[]),this.logger=i}debug(){for(var i=arguments.length,o=new Array(i),p=0;p<i;p++)o[p]=arguments[p];this.logger.debug(...this.prefixLists,...o)}info(){for(var i=arguments.length,o=new Array(i),p=0;p<i;p++)o[p]=arguments[p];this.logger.info(...this.prefixLists,...o)}warning(){for(var i=arguments.length,o=new Array(i),p=0;p<i;p++)o[p]=arguments[p];this.logger.warning(...this.prefixLists,...o)}error(){for(var i=arguments.length,o=new Array(i),p=0;p<i;p++)o[p]=arguments[p];this.logger.error(...this.prefixLists,...o)}prefix(i){return this.prefixLists.push(i),this}popPrefix(){return this.prefixLists.pop(),this}}function lM(){const l=new Date;return l.toTimeString().split(" ")[0]+":"+l.getMilliseconds()}function o6(){const l=new Date,i=/((\d+:){2}\d+)/.exec(new Date().toUTCString());return i?(i==null?void 0:i[0])+":"+l.getUTCMilliseconds():l.toTimeString().split(" ")[0]+":"+l.getMilliseconds()}const WS={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},IN=Date.now(),BO=l=>{for(const i in WS)if(Object.prototype.hasOwnProperty.call(WS,i)&&WS[i]===l)return i;return"DEFAULT"},Gi=new class{constructor(){_e(this,"proxyServerURL",void 0),_e(this,"logLevel",WS.DEBUG),_e(this,"uploadState","collecting"),_e(this,"uploadLogWaitingList",[]),_e(this,"uploadLogUploadingList",[]),_e(this,"uploadErrorCount",0),_e(this,"currentLogID",0),_e(this,"url",void 0),_e(this,"extLog",(l,i)=>{this.appendLogToWaitingList(l,...i)})}debug(){for(var l=arguments.length,i=new Array(l),o=0;o<l;o++)i[o]=arguments[o];const p=[WS.DEBUG].concat(i);this.log.apply(this,p)}info(){for(var l=arguments.length,i=new Array(l),o=0;o<l;o++)i[o]=arguments[o];const p=[WS.INFO].concat(i);this.log.apply(this,p)}warning(){for(var l=arguments.length,i=new Array(l),o=0;o<l;o++)i[o]=arguments[o];const p=[WS.WARNING].concat(i);this.log.apply(this,p)}warn(){this.warning(...arguments)}error(){for(var l=arguments.length,i=new Array(l),o=0;o<l;o++)i[o]=arguments[o];const p=[WS.ERROR].concat(i);this.log.apply(this,p)}upload(){for(var l=arguments.length,i=new Array(l),o=0;o<l;o++)i[o]=arguments[o];const p=[WS.DEBUG].concat(i);this.uploadLog.apply(this,p)}setLogLevel(l){l=Math.min(Math.max(0,l),4),this.logLevel=l}enableLogUpload(){y_("UPLOAD_LOG",!0)}disableLogUpload(){y_("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(l){this.proxyServerURL=l}prefix(l){return new gZ(this).prefix(l)}log(){for(var l=arguments.length,i=new Array(l),o=0;o<l;o++)i[o]=arguments[o];if(Date.now()-IN<100)return void setTimeout(()=>{this.log(...i)},Date.now()-IN);const p=Math.max(0,Math.min(4,i[0]));if(i[0]=lM()+" Agora-SDK [".concat(BO(p),"]:"),this.appendLogToWaitingList(p,...i),p<this.logLevel)return;const g=lM()+" %cAgora-SDK [".concat(BO(p),"]:");let b=[];if(!nE("USE_NEW_LOG"))switch(p){case WS.DEBUG:b=[g,"color: #64B5F6;"].concat(i.slice(1)),console.log.apply(console,b);break;case WS.INFO:b=[g,"color: #1E88E5; font-weight: bold;"].concat(i.slice(1)),console.log.apply(console,b);break;case WS.WARNING:b=[g,"color: #FB8C00; font-weight: bold;"].concat(i.slice(1)),console.warn.apply(console,b);break;case WS.ERROR:b=[g,"color: #B00020; font-weight: bold;"].concat(i.slice(1)),console.error.apply(console,b)}}uploadLog(){for(var l=arguments.length,i=new Array(l),o=0;o<l;o++)i[o]=arguments[o];if(Date.now()-IN<100)return void setTimeout(()=>{this.uploadLog(...i)},Date.now()-IN);const p=Math.max(0,Math.min(4,i[0]));i[0]=lM()+" Agora-SDK [".concat(BO(p),"]:"),this.appendLogToWaitingList(p,...i)}appendLogToWaitingList(l){if(!nE("UPLOAD_LOG"))return;for(var i=arguments.length,o=new Array(i>1?i-1:0),p=1;p<i;p++)o[p-1]=arguments[p];Array.isArray(o[0])?o[0][0]=o6()+" Agora-SDK [".concat(BO(l),"]:"):o[0]=o6()+" Agora-SDK [".concat(BO(l),"]:");let g="";o.forEach(b=>{typeof b=="object"&&(b=JSON.stringify(b)),g+="".concat(b," ")}),this.uploadLogWaitingList.push({payload_str:g,log_level:l,log_item_id:this.currentLogID++}),this.uploadState==="uploading"&&this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}async uploadLogs(){const l=this.uploadLogUploadingList,i={sdk_version:qS,process_id:nE("PROCESS_ID"),payload:JSON.stringify(l)};return vT(async()=>{const o=await aS.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat(nE("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(nE("LOG_UPLOAD_SERVER"),"/upload/v1")),i,{responseType:"text"});if(o.data!=="OK"){const p=new Error("unexpected upload log response");throw p.response=o,p}},()=>(this.uploadLogUploadingList=[],!1),o=>(o.response?RN.reportLogUploadError({status:o.response.status,data:o.response.data,headers:o.response.headers,message:o.message}):o.request?RN.reportLogUploadError({status:o.request.status,message:o.message}):RN.reportLogUploadError({status:-1,message:o.message}),!0),{timeout:nE("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:nE("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){this.uploadLogUploadingList.length===0&&this.uploadLogWaitingList.length===0||(this.uploadLogUploadingList.length===0&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,nE("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),nE("UPLOAD_LOG_INTERVAL"))}).catch(l=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),nE("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout(()=>this.uploadLogInterval(),nE("UPLOAD_LOG_RETRY_INTERVAL_V1"))}))}};var a6,c6;function EZ(l){return O0(l.reportId,"params.reportId",0,100,!1),O0(l.category,"params.category",0,100,!1),O0(l.event,"params.event",0,100,!1),O0(l.label,"params.label",0,100,!1),b_(l.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(function(l){l.FREE="free",l.UPLOADING="uploading"})(a6||(a6={})),function(l){l[l.MISC=0]="MISC",l[l.INTERNAL_EVENT=1]="INTERNAL_EVENT",l[l.PUBLIC_EVENT=2]="PUBLIC_EVENT",l[l.WEB_EVENT=3]="WEB_EVENT",l[l.INTERNAL_API=4]="INTERNAL_API",l[l.WEB_API=5]="WEB_API",l[l.PUBLIC_API=6]="PUBLIC_API"}(c6||(c6={}));const vZ={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};var p0,L_,u6,l6;function d6(l,i){var o=Object.keys(l);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(l);i&&(p=p.filter(function(g){return Object.getOwnPropertyDescriptor(l,g).enumerable})),o.push.apply(o,p)}return o}function _v(l){for(var i=1;i<arguments.length;i++){var o=arguments[i]!=null?arguments[i]:{};i%2?d6(Object(o),!0).forEach(function(p){_e(l,p,o[p])}):Object.getOwnPropertyDescriptors?Object.defineProperties(l,Object.getOwnPropertyDescriptors(o)):d6(Object(o)).forEach(function(p){Object.defineProperty(l,p,Object.getOwnPropertyDescriptor(o,p))})}return l}(function(l){l.PUBLISH="publish",l.SUBSCRIBE="subscribe",l.WS_COMPRESSOR_INIT="ws_compressor_init",l.SESSION_INIT="session_init",l.JOIN_CHOOSE_SERVER="join_choose_server",l.REQ_USER_ACCOUNT="req_user_account",l.JOIN_GATEWAY="join_gateway",l.REJOIN_GATEWAY="rejoin_gateway",l.STREAM_SWITCH="stream_switch",l.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",l.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",l.FIRST_VIDEO_RECEIVED="first_video_received",l.FIRST_AUDIO_RECEIVED="first_audio_received",l.FIRST_VIDEO_DECODE="first_video_decode",l.FIRST_AUDIO_DECODE="first_audio_decode",l.ON_ADD_AUDIO_STREAM="on_add_audio_stream",l.ON_ADD_VIDEO_STREAM="on_add_video_stream",l.ON_UPDATE_STREAM="on_update_stream",l.ON_REMOVE_STREAM="on_remove_stream",l.USER_ANALYTICS="req_user_analytics",l.PC_STATS="pc_stats"})(p0||(p0={})),function(l){l.SESSION="io.agora.pb.Wrtc.Session",l.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",l.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",l.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",l.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",l.PUBLISH="io.agora.pb.Wrtc.Publish",l.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",l.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",l.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",l.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",l.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",l.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",l.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",l.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",l.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",l.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",l.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",l.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",l.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",l.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",l.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",l.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",l.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",l.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",l.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",l.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",l.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",l.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",l.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",l.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",l.PC_STATS="io.agora.pb.Wrtc.PCStats"}(L_||(L_={})),function(l){l[l.WORKER_EVENT=156]="WORKER_EVENT",l[l.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"}(u6||(u6={})),function(l){l[l.SESSION=26]="SESSION",l[l.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",l[l.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",l[l.JOIN_GATEWAY=28]="JOIN_GATEWAY",l[l.PUBLISH=30]="PUBLISH",l[l.SUBSCRIBE=29]="SUBSCRIBE",l[l.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",l[l.STREAM_SWITCH=32]="STREAM_SWITCH",l[l.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",l[l.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",l[l.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",l[l.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",l[l.API_INVOKE=41]="API_INVOKE",l[l.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",l[l.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",l[l.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",l[l.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",l[l.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",l[l.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",l[l.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",l[l.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",l[l.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",l[l.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",l[l.WORKER_EVENT=156]="WORKER_EVENT",l[l.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",l[l.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",l[l.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",l[l.USER_ANALYTICS=1e4]="USER_ANALYTICS",l[l.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED"}(l6||(l6={}));class GO{constructor(){_e(this,"baseInfoMap",new Map),_e(this,"proxyServer",void 0),_e(this,"eventUploadTimer",void 0),_e(this,"setSessionIdTimer",void 0),_e(this,"url",void 0),_e(this,"backupUrl",void 0),_e(this,"_appId",void 0),_e(this,"keyEventUploadPendingItems",[]),_e(this,"normalEventUploadPendingItems",[]),_e(this,"apiInvokeUploadPendingItems",[]),_e(this,"apiInvokeCount",0),_e(this,"ltsList",[]),_e(this,"lastSendNormalEventTime",Date.now()),_e(this,"customReportCounterTimer",void 0),_e(this,"customReportCount",0),_e(this,"extApiInvoke",async i=>{for(const o of i){const p=_v(_v({},o),{},{sid:null,invokeId:++this.apiInvokeCount,tag:x_.TRACER});this.sendApiInvoke(p)}}),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),nE("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),nE("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(i){return this.baseInfoMap.get(i)}adjustSessionStartTime(i){if(!this.baseInfoMap.has(i)&&!this.baseInfoMap.get(i))return void Gi.error("adjust session ".concat(i," start time, sid is not exist or info is undefined"));const o=this.baseInfoMap.get(i),p=Date.now(),g=o.startTime;o.startTime=p,Gi.debug("rewrite session ".concat(i," startTime: ").concat(p," , ").concat(p-g,"ms")),this.baseInfoMap.set(i,o)}setAppId(i){this._appId=i}reportApiInvoke(i,o,p){o.timeout=o.timeout||6e4,o.reportResult=o.reportResult===void 0||o.reportResult;const g=Date.now();this.apiInvokeCount+=1;const b=this.apiInvokeCount,A=()=>({tag:o.tag,invokeId:b,sid:i,name:o.name,apiInvokeTime:g,options:o.options,states:o.states||null}),j=!!nE("SHOW_REPORT_INVOKER_LOG");j&&Gi.info("".concat(o.name," start"),o.options);let H=!1;w0(o.timeout).then(()=>{H||(this.sendApiInvoke(_v(_v({},A()),{},{error:_p.API_INVOKE_TIMEOUT,success:!1})),Gi.debug("".concat(o.name," timeout")))});const z=new yE(_p.UNEXPECTED_ERROR,"".concat(o.name,": this api invoke is end"));return{onSuccess:$=>{const Vt=()=>{if(H)throw z;return H=!0,this.sendApiInvoke(_v(_v({},A()),{},{success:!0},o.reportResult&&{result:$})),j&&Gi.info("".concat(o.name," onSuccess")),$};return p?iG(Vt,o.name+"Success",p,()=>H=!0):Vt()},onError:$=>{const Vt=()=>{if(H)throw $;H=!0,this.sendApiInvoke(_v(_v({},A()),{},{success:!1,error:$})),j&&Gi.info("".concat(o.name," onFailure"),$.toString())};return p?iG(Vt,o.name+"Error",p,()=>H=!0):Vt()}}}sessionInit(i,o){if(this.baseInfoMap.has(i))return;const p=Date.now(),g=this.createBaseInfo(i,p);g.cname=o.cname;const b=Object.assign({},{willUploadConsoleLog:nE("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:cM?"global":"oversea",areas:nE("AREAS")&&nE("AREAS").join(",")},o.extend),A=Date.now(),j=_v(_v({},g),{},{eventType:p0.SESSION_INIT,appid:o.appid,browser:navigator.userAgent,build:uM,lts:A,elapse:A-p,extend:JSON.stringify(b),mode:o.mode,process:nE("PROCESS_ID"),appType:nE("APP_TYPE"),success:!0,version:qS});this.send({type:L_.SESSION,data:j},!0)}joinChooseServer(i,o){const p=this.baseInfoMap.get(i);if(!p)return;const g=p.info,b=Date.now(),A=_v(_v({},g),{},{eventType:p0.JOIN_CHOOSE_SERVER,lts:b,eventElapse:b-o.lts,chooseServerAddr:o.csAddr,errorCode:o.ec,elapse:b-p.startTime,success:o.succ,chooseServerAddrList:JSON.stringify(o.serverList),uid:o.uid?parseInt(o.uid):null,cid:o.cid?parseInt(o.cid):null,chooseServerIp:o.csIp||"",opid:o.opid,unilbsServerIds:o.unilbsServerIds,extend:o.extend||void 0,isHttp3:o.isHttp3});this.send({type:L_.JOIN_CHOOSE_SERVER,data:A},!0)}reqUserAccount(i,o){const p=this.baseInfoMap.get(i);if(!p)return;const g=p.info,b=Date.now(),A=_v(_v({},g),{},{eventType:p0.REQ_USER_ACCOUNT,lts:b,success:o.success,serverAddress:o.serverAddr,stringUid:o.stringUid,uid:o.uid,errorCode:o.errorCode,elapse:b-p.startTime,eventElapse:b-o.lts,extend:JSON.stringify(o.extend)});this.send({type:L_.REQ_USER_ACCOUNT,data:A},!0)}joinGateway(i,o){const p=this.baseInfoMap.get(i);if(!p)return;const g=p.info;o.vid&&(g.vid=o.vid),g.uid=o.uid,g.cid=o.cid;const b=Date.now(),{firstSuccess:A,avoidJoinStartTime:j,isProxy:H,addr:z}=o,$=b-(A&&j?j:p.startTime),Vt=_v(_v({},g),{},{eventType:p0.JOIN_GATEWAY,lts:b,gatewayAddr:o.addr,success:o.succ,errorCode:o.ec,elapse:$,eventElapse:b-o.lts,firstSuccess:A,signalChannel:o.signalChannel}),_r=Vt.success?1:0;if(o.succ&&(p.lastJoinSuccessTime=b),A)this.send({type:L_.JOIN_GATEWAY,data:Vt},!0);else{let Fi;if(z)if(H){const _u=z.match(/h=(\d{1,3}-){3}\d{1,3}/g),_h=z.match(/p=[0-9]{1,6}/g);Fi={isSuccess:_r,gatewayIp:_u&&_u.length?_u[0].split("=")[1].replace(/-/g,"."):"",port:_h&&_h.length?_h[0].split("=")[1]:"",isProxy:H?1:0}}else{const _u=z.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),_h=z.match(/(:|p=)[0-9]{1,6}/g);Fi={isSuccess:_r,gatewayIp:_u&&_u.length?_u[0].split("//")[1].replace(/-/g,"."):"",port:_h&&_h.length?_h[0].split(/:|p=/g)[1]:"",isProxy:H?1:0}}else Fi={isSuccess:_r,gatewayIp:"",port:"",isProxy:H?1:0};delete Vt.success,delete Vt.eventType,delete Vt.firstSuccess,Vt.vid=Number(Vt.vid);const _l=Object.assign({},Vt,Fi,{eventType:p0.REJOIN_GATEWAY});this.send({type:L_.RE_JOIN_GATEWAY,data:_l},!0)}}joinChannelTimeout(i,o){const p=this.baseInfoMap.get(i);if(!p)return;const g=Date.now(),b=_v(_v({},p.info),{},{lts:g,timeout:o,elapse:g-p.startTime});this.send({type:L_.JOIN_CHANNEL_TIMEOUT,data:b},!0)}publish(i,o){const p=this.baseInfoMap.get(i);if(!p)return;const g=p.info,b=Date.now(),A=_v(_v({},g),{},{eventType:p0.PUBLISH,lts:b,eventElapse:o.eventElapse,elapse:b-p.startTime,success:o.succ,errorCode:o.ec,videoName:o.videoName,audioName:o.audioName,screenName:o.screenName,screenshare:o.screenshare,audio:o.audio,video:o.video,p2pid:o.p2pid,publishRequestid:o.publishRequestid});this.send({type:L_.PUBLISH,data:A},!0)}subscribe(i,o,p){const g=this.baseInfoMap.get(i);if(!g)return;const b=g.info,A=Date.now(),j=_v(_v({},b),{},{eventType:p0.SUBSCRIBE,lts:A,eventElapse:o.eventElapse,elapse:A-g.startTime,success:o.succ,errorCode:o.ec,video:o.video,audio:o.audio,subscribeRequestid:o.subscribeRequestid,p2pid:o.p2pid},p&&{extend:JSON.stringify({isMassSubscribe:!0})});typeof o.peerid=="string"?j.peerSuid=o.peerid:j.peer=o.peerid,this.send({type:L_.SUBSCRIBE,data:j},!0)}wsCompressorInit(i){var o;const p=[...RS(o=this.baseInfoMap).call(o)],g=p.length?p[0]:"UnableToGetSid",b=this.baseInfoMap.get(g);if(!b)return;const A=b.info,j=Date.now(),H=_v(_v({},A),{},{eventType:p0.WS_COMPRESSOR_INIT,lts:j,eventElapse:i.eventElapse,elapse:j-b.startTime,status:i.status?1:2});this.send({type:L_.WS_COMPRESSOR_INIT,data:H},!0)}firstRemoteVideoDecode(i,o,p,g){const b=this.baseInfoMap.get(i);if(!b)return;const A=b.info,j=Date.now(),H=_v(_v(_v({},A),g),{},{elapse:j-b.startTime,eventType:o,lts:j,firstDecodeFrame:Math.max(j-b.startTime,0),apEnd:Math.max(g.apEnd-b.startTime,0),apStart:Math.max(g.apStart-b.startTime,0),joinGwEnd:Math.max(g.joinGwEnd-b.startTime,0),joinGwStart:Math.max(g.joinGwStart-b.startTime,0),pcEnd:Math.max(g.pcEnd-b.startTime,0),pcStart:Math.max(g.pcStart-b.startTime,0),subscriberEnd:Math.max(g.subscriberEnd-b.startTime,0),subscriberStart:Math.max(g.subscriberStart-b.startTime,0),videoAddNotify:Math.max(g.videoAddNotify-b.startTime,0)});this.send({type:p,data:H},!0)}firstRemoteFrame(i,o,p,g){const b=this.baseInfoMap.get(i);if(!b)return;const A=b.info,j=Date.now(),H=_v(_v(_v({},A),g),{},{elapse:j-b.startTime,eventType:o,lts:j});this.send({type:p,data:H},!0)}pcStats(i,o){const p=this.baseInfoMap.get(i);if(!p)return;const g=p.info,b=Date.now(),A=_v(_v(_v({},g),o),{},{vid:g.vid===void 0?0:Number(g.vid),elapse:b-p.startTime,eventType:p0.PC_STATS,lts:b});this.send({type:L_.PC_STATS,data:A},!0)}updateRemoteRTPCapabilities(i,o){this.reportApiInvoke(i,{name:"Client.updateRemoteRTPCapabilities",options:o,tag:x_.TRACER}).onSuccess()}onGatewayStream(i,o,p,g){const b=this.baseInfoMap.get(i);if(!b)return;const A=b.info,j=Date.now(),H=_v(_v(_v({},A),g),{},{eventType:o,lts:j});this.send({type:p,data:H},!0)}streamSwitch(i,o){const p=this.baseInfoMap.get(i);if(!p)return;const g=p.info,b=Date.now(),A=_v(_v({},g),{},{eventType:p0.STREAM_SWITCH,lts:b,isDual:o.isdual,elapse:b-p.startTime,success:o.succ});this.send({type:L_.STREAM_SWITCH,data:A},!0)}requestProxyAppCenter(i,o){const p=this.baseInfoMap.get(i);if(!p)return;const g=p.info,b=Date.now(),A=_v(_v({},g),{},{eventType:p0.REQUEST_PROXY_APPCENTER,lts:b,eventElapse:b-o.lts,elapse:b-p.startTime,APAddr:o.APAddr,workerManagerList:o.workerManagerList,response:o.response,errorCode:o.ec,success:o.succ});this.send({type:L_.REQUEST_PROXY_APPCENTER,data:A},!0)}requestProxyWorkerManager(i,o){const p=this.baseInfoMap.get(i);if(!p)return;const g=p.info,b=Date.now(),A=_v(_v({},g),{},{eventType:p0.REQUEST_PROXY_WORKER_MANAGER,lts:b,eventElapse:b-o.lts,elapse:b-p.startTime,workerManagerAddr:o.workerManagerAddr,response:o.response,errorCode:o.ec,success:o.succ});this.send({type:L_.REQUEST_PROXY_WORKER_MANAGER,data:A},!0)}setProxyServer(i){this.proxyServer=i,i?Gi.debug("reportProxyServerurl: ".concat(i)):Gi.debug("disable reportProxyServerurl: ".concat(i))}peerPublishStatus(i,o){const p=this.baseInfoMap.get(i);if(!p)return;const g=p.info,b=Date.now(),A=_v(_v({},g),{},{subscribeElapse:o.subscribeElapse,peer:o.peer,peerPublishDuration:Math.max(o.audioPublishDuration,o.videoPublishDuration),audiotag:o.audioPublishDuration>0?1:-1,videotag:o.videoPublishDuration>0?1:-1,lts:b,elapse:b-p.startTime,joinChannelSuccessElapse:b-(p.lastJoinSuccessTime||b),peerPublishDurationVideo:o.videoPublishDuration,peerPublishDurationAudio:o.audioPublishDuration});this.send({type:L_.PEER_PUBLISH_STATUS,data:A},!0)}workerEvent(i,o){const p=this.baseInfoMap.get(i);if(!p)return;const g=p.info,b=Date.now();(function(j,H,z){const $=j[H];if(!$||typeof $!="string")return[j];j[H]="";const Vt=AT(JSON.stringify(j));let _r=0;const Fi=[];let _l=0;for(let _u=0;_u<$.length;_u++)_l+=$.charCodeAt(_u)<=127?1:3,_l<=z-Vt||(Fi[Fi.length]=QR(QR({},j),{},{[H]:$.substring(_r,_u)}),_r=_u,_l=$.charCodeAt(_u)<=127?1:3);return _r!==$.length-1&&(Fi[Fi.length]=QR(QR({},j),{},{[H]:$.substring(_r)})),Fi})(_v(_v(_v({},g),o),{},{elapse:b-p.startTime,lts:b,productType:"WebRTC"}),"payload",1300).forEach(j=>this.send({type:L_.WORKER_EVENT,data:j},!0))}apworkerEvent(i,o){const p=this.baseInfoMap.get(i);if(!p)return;const g=p.info,b=Date.now(),A=_v(_v(_v({},g),o),{},{elapse:b-p.startTime,lts:b});this.send({type:L_.AP_WORKER_EVENT,data:A},!0)}joinWebProxyAP(i,o){const p=this.baseInfoMap.get(i);if(!p)return;const g=p.info,b=Date.now(),A=_v(_v(_v({},g),o),{},{elapse:b-p.startTime,lts:b,extend:o.extend||void 0});this.send({type:L_.JOIN_WEB_PROXY_AP,data:A},!0)}WebSocketQuit(i,o){const p=this.baseInfoMap.get(i);if(!p)return;const g=p.info,b=Date.now(),A=_v(_v(_v({},g),o),{},{elapse:b-p.startTime,lts:b});this.send({type:L_.WEBSOCKET_QUIT,data:A},!0)}async sendCustomReportMessage(i,o){if(this.customReportCount+=o.length,this.customReportCount>nE("CUSTOM_REPORT_LIMIT"))throw new yE(_p.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval(()=>{this.customReportCount=0},5e3));const p=Date.now(),g=o.map(b=>({type:L_.USER_ANALYTICS,data:_v(_v({sid:i},b),{},{lts:p})}));try{nE("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(g):await this.postDataToStatsCollector(g)}catch(b){throw Gi.error("send custom report message failed",b.toString()),new yE(_p.CUSTOM_REPORT_SEND_FAILED,b.message)}}sendApiInvoke(i){const o=nE("NOT_REPORT_EVENT");if(i.tag&&VE(o)&&VE(o).call(o,i.tag))return!1;if(i.sid===null)return this.apiInvokeUploadPendingItems.push(i),!1;const p=this.baseInfoMap.get(i.sid);if(!p)return this.apiInvokeUploadPendingItems.push(i),!1;const{cname:g,uid:b,cid:A}=p.info;let j;if(i.lts=i.lts||Date.now(),i.error)if(i.error instanceof yE){const{code:z,message:$}=i.error;j=z||$||i.error.toString()}else j=i.error.toString();const H={invokeId:i.invokeId,sid:i.sid,cname:g,cid:A,uid:b,lts:i.lts,success:i.success,elapse:i.lts-p.startTime,execElapse:i.lts-i.apiInvokeTime,apiName:i.name,options:i.options?JSON.stringify(i.options):void 0,execStates:i.states?JSON.stringify(i.states):void 0,execResult:i.result?JSON.stringify(i.result):void 0,errorCode:i.error?j:void 0,errorMsg:i.error?JSON.stringify(i.error):void 0};return this.send({type:L_.API_INVOKE,data:H},!1),!0}appendSessionId(){GO.__CLIENT_LIST__.forEach(i=>{if(i._sessionId){const o=this.apiInvokeUploadPendingItems.length;for(let p=0;p<o;p++){const g=this.apiInvokeUploadPendingItems.shift();g&&(g.sid=i._sessionId,this.sendApiInvoke(Object.assign({},g)))}}})}send(i,o){if(o)return this.keyEventUploadPendingItems.push(i),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(i),this.normalEventUploadPendingItems.length>nE("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(i,o){const p=[],g=[];for(;i.length;){const A=i.shift();p.length<20?p.push(A):g.push(A)}i.push(...g);for(const A of[...p]){var b;this.ltsList.indexOf(A.data.lts)!==-1?(A.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(A.data.lts)):(this.ltsList.push(A.data.lts),AO(b=this.ltsList).call(b,(j,H)=>j-H))}return o||(this.lastSendNormalEventTime=Date.now()),nE("ENABLE_EVENT_REPORT")&&p.length&&(nE("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(p):this.postDataToStatsCollector(p)).catch((A=>j=>{nE("EVENT_REPORT_RETRY")&&(o?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(A):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(A),this.normalEventUploadPendingItems.length>nE("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-nE("NORMAL_EVENT_QUEUE_CAPACITY")),Gi.warning("report: drop normal events"))))})(p)),i}async postDataToStatsCollector2(i){X_.networkState===K0.OFFLINE&&await pE.race([X_.onlineWaiter,w0(2*$_.maxRetryTimeout)]);const o=b=>{let A=new Uint8Array;return b.forEach(j=>{const H=FL(JSON.stringify(j.data)),z=new ArrayBuffer(5),$=(_r=>{let Fi=0;return Object.entries(L_).forEach(_l=>{let[_u,_h]=_l;_h===_r.type&&(Fi=EventNameToID[_u])}),Fi})(j),Vt=new DataView(z);Vt.setUint16(0,H.byteLength,!0),Vt.setUint8(2,255&$),Vt.setUint8(3,$>>>8&255),Vt.setUint8(4,$>>>16&255),A=XV(A,new Uint8Array(z)),A=XV(A,H)}),A},p="event";let g=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(nE("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(p):"https://".concat(nE("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(p);for(let b=0;b<2;b+=1){b===1&&(g=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(nE("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(p):"https://".concat(nE("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(p));try{await aM(g,{timeout:1e4,data:o(i),headers:_v(_v({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(A){if(b===1)throw A;continue}return}}async postDataToStatsCollector(i){let o=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const p={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:i.map(A=>JSON.stringify(A)),vid:(A=>{const j=A&&A.data.sid&&this.baseInfoMap.get(A.data.sid);return j&&j.info.vid&&+j.info.vid||0})(i[0])};X_.networkState===K0.OFFLINE&&await pE.race([X_.onlineWaiter,w0(2*$_.maxRetryTimeout)]);const g=o?"/events/proto-raws":"/events/messages";let b=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(nE("EVENT_REPORT_DOMAIN"),"&p=").concat(nE("STATS_COLLECTOR_PORT"),"&d=").concat(g):"https://".concat(nE("EVENT_REPORT_DOMAIN"),":").concat(nE("STATS_COLLECTOR_PORT")).concat(g));for(let A=0;A<2;A+=1){A===1&&(b=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(nE("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(nE("STATS_COLLECTOR_PORT"),"&d=").concat(g):"https://".concat(nE("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(nE("STATS_COLLECTOR_PORT")).concat(g)));try{o?await pZ(b,{timeout:1e4,data:p}):await aM(b,{timeout:1e4,data:p})}catch(j){if(A===1)throw j;continue}return}}createBaseInfo(i,o){const p=Object.assign({},vZ);return p.sid=i,this.baseInfoMap.set(i,{info:p,startTime:o}),p}reportResourceTiming(i,o){const p=performance.getEntriesByName(i),g=p[p.length-1];g&&this.reportApiInvoke(o,{name:"Client.resourceTiming",options:g,tag:x_.TRACER}).onSuccess()}}function HE(){let l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function(i,o,p){const g=p.value;if(typeof g=="function"){const b=l.className||i.__className__||(i.constructor.name==="AgoraRTCClient"?"Client":i.constructor.name);p.value=function(){for(var A=arguments.length,j=new Array(A),H=0;H<A;H++)j[H]=arguments[H];let z=j;if(l.argsMap)try{z=l.argsMap(this,...j)}catch(Vt){Gi.warning(Vt),z=[]}try{JSON.stringify(z)}catch{Gi.warning("arguments for method ".concat(b,".").concat(String(o)," not serializable for apiInvoke.")),z=[]}const $=(l.report||jE).reportApiInvoke(this._sessionId||null,{name:"".concat(b,".").concat(String(o)),options:z,tag:x_.TRACER,reportResult:l.reportResult},l.throttleTime);try{const Vt=g.apply(this,j);return Vt instanceof pE?Vt.then(_r=>($.onSuccess(l.reportResult&&_r),_r)).catch(_r=>{throw $.onError(_r),_r}):($.onSuccess(l.reportResult&&Vt),Vt)}catch(Vt){throw $.onError(Vt),Vt}}}return p}}_e(GO,"__CLIENT_LIST__",[]);const jE=new GO;RN.on("REPORT_LOG_UPLOAD",l=>{l.networkState=X_.networkState,jE.reportApiInvoke(null,{name:"logUploadError",options:l,tag:x_.TRACER})});const _Z=["CHINA","GLOBAL"],wS=function(){const l="us".concat("erna","me"),i="pa".concat("sswo","rd"),o=["t","s","t"];o.splice(1,0,"e");const p=o.join(""),g=[];for(let j=0;j<6;j++)g.push("1");const b=g.join(""),A={};return A[l]=p,A[i]=b,Object.assign(A,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=wS,cM||($0.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],$0.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],$0.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],$0.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],$0.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],$0.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],$0.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",$0.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",$0.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",$0.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",$0.AREAS=["NORTH_AMERICA","OVERSEA"]);const h6=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],pR=[];function nI(l,i){return!!i&&pR.some(o=>o.uid===l&&o.channelName===i)}GO.__CLIENT_LIST__=pR;var dM,cS,KI,qO,AS,F0,qE,t_,kE,FE,uS,JE,p6,YI,zE,o0,fR,yZ=qR("Array").values,bZ=WR,SZ=sS,TZ=mT,CZ=yZ,hM=Array.prototype,RZ={DOMTokenList:!0,NodeList:!0},OT=LE(function(l){var i=l.values;return l===hM||TZ(hM,l)&&i===hM.values||SZ(RZ,bZ(l))?CZ:i});function bE(l,i,o,p){var g,b=arguments.length,A=b<3?i:p===null?p=Object.getOwnPropertyDescriptor(i,o):p;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")A=Reflect.decorate(l,i,o,p);else for(var j=l.length-1;j>=0;j--)(g=l[j])&&(A=(b<3?g(A):b>3?g(i,o,A):g(i,o))||A);return b>3&&A&&Object.defineProperty(i,o,A),A}function kc(l,i){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(l,i)}(function(l){l.L1T1="L1T1",l.L1T2="L1T2",l.L1T3="L1T3",l.L2T1_KEY="L2T1_KEY",l.L2T2_KEY="L2T2_KEY",l.L2T3_KEY="L2T3_KEY",l.L3T1_KEY="L3T1_KEY",l.L3T2_KEY="L3T2_KEY",l.L3T3_KEY="L3T3_KEY"})(dM||(dM={})),function(l){l.CERTIFICATE="certificate",l.CODEC="codec",l.CANDIDATE_PAIR="candidate-pair",l.LOCAL_CANDIDATE="local-candidate",l.REMOTE_CANDIDATE="remote-candidate",l.INBOUND="inbound-rtp",l.TRACK="track",l.OUTBOUND="outbound-rtp",l.PC="peer-connection",l.REMOTE_INBOUND="remote-inbound-rtp",l.REMOTE_OUTBOUND="remote-outbound-rtp",l.TRANSPORT="transport",l.CSRC="csrc",l.DATA_CHANNEL="data-channel",l.STREAM="stream",l.SENDER="sender",l.RECEIVER="receiver"}(cS||(cS={})),function(l){l[l.ACCESS_POINT=101]="ACCESS_POINT",l[l.UNILBS=201]="UNILBS",l[l.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR"}(KI||(KI={})),function(l){l[l.IIIEGAL_APPID=1]="IIIEGAL_APPID",l[l.IIIEGAL_UID=2]="IIIEGAL_UID",l[l.INTERNAL_ERROR=3]="INTERNAL_ERROR"}(qO||(qO={})),function(l){l[l.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",l[l.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",l[l.INTERNAL_ERROR=8]="INTERNAL_ERROR",l[l.NO_AUTHORIZED=9]="NO_AUTHORIZED",l[l.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",l[l.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",l[l.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",l[l.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",l[l.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",l[l.USER_OVERLOAD=16]="USER_OVERLOAD",l[l.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",l[l.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND"}(AS||(AS={})),function(l){l[l.NO_FLAG_SET=100]="NO_FLAG_SET",l[l.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",l[l.INVALID_FALG_SET=102]="INVALID_FALG_SET",l[l.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",l[l.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",l[l.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",l[l.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",l[l.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",l[l.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",l[l.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",l[l.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",l[l.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",l[l.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",l[l.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",l[l.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",l[l.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",l[l.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",l[l.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",l[l.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV"}(F0||(F0={})),function(l){l[l.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",l[l.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",l[l.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",l[l.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",l[l.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",l[l.K_TICKET_INVALID=7]="K_TICKET_INVALID",l[l.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",l[l.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",l[l.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",l[l.K_UID_BANNED=14]="K_UID_BANNED",l[l.K_IP_BANNED=15]="K_IP_BANNED",l[l.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",l[l.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",l[l.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",l[l.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",l[l.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",l[l.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",l[l.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",l[l.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",l[l.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",l[l.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",l[l.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",l[l.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",l[l.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",l[l.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",l[l.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",l[l.ERR_INVALID_UID=117]="ERR_INVALID_UID",l[l.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",l[l.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",l[l.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",l[l.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",l[l.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",l[l.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",l[l.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",l[l.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",l[l.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",l[l.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",l[l.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",l[l.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",l[l.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",l[l.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",l[l.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",l[l.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",l[l.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",l[l.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",l[l.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",l[l.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",l[l.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",l[l.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",l[l.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",l[l.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",l[l.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",l[l.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",l[l.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",l[l.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",l[l.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",l[l.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",l[l.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",l[l.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",l[l.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",l[l.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",l[l.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",l[l.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",l[l.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY"}(qE||(qE={})),function(l){l.CONNECTING="connecting",l.CONNECTED="connected",l.RECONNECTING="reconnecting",l.CLOSED="closed"}(t_||(t_={})),function(l){l.WS_CONNECTED="ws_connected",l.WS_RECONNECTING="ws_reconnecting",l.WS_CLOSED="ws_closed",l.WS_RECONNECT_WAITTING_FINISH="ws_reconnect_waitting_finish",l.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",l.ON_BINARY_DATA="on_binary_data",l.REQUEST_RECOVER="request_recover",l.REQUEST_JOIN_INFO="request_join_info",l.REQUEST_REJOIN_INFO="req_rejoin_info",l.IS_P2P_DISCONNECTED="is_p2p_dis",l.DISCONNECT_P2P="dis_p2p",l.ABORT_P2P_EXECUTION="abort_p2p_execution",l.NEED_RENEW_SESSION="need-sid",l.REPORT_JOIN_GATEWAY="report_join_gateway",l.REQUEST_TIMEOUT="request_timeout",l.REQUEST_SUCCESS="request_success",l.JOIN_RESPONSE="join_response",l.DATACHANNEL_PRECONNECT="datachannel_preconnect",l.DATACHANNEL_CONNECTING="datachannel_connecting",l.DATACHANNEL_FAILBACK="datachannel_failback",l.P2P_START="p2p_start",l.P2P_CONNECTION="p2p_connection",l.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",l.P2P_SUBSCRIBE="p2p_subscribe",l.P2P_UNSUBSCRIBE="p2p_unsubscribe",l.P2P_EXCHANGE_SDP="p2p_exchange_sdp",l.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",l.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream"}(kE||(kE={})),function(l){l.PING="ping",l.PING_BACK="ping_back",l.JOIN="join_v3",l.REJOIN="rejoin_v3",l.LEAVE="leave",l.SET_CLIENT_ROLE="set_client_role",l.PUBLISH="publish",l.PUBLISH_DATASTREAM="publish_datastream",l.UNPUBLISH="unpublish",l.UNPUBLISH_DATASTREAM="unpublish_datastream",l.SUBSCRIBE="subscribe",l.SUBSCRIBE_DATASTREAM="subscribe_datastream",l.SUBSCRIBE_STREAMS="subscribe_streams",l.UNSUBSCRIBE="unsubscribe",l.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",l.UNSUBSCRIBE_STREAMS="unsubscribe_streams",l.SUBSCRIBE_CHANGE="subscribe_change",l.TRAFFIC_STATS="traffic_stats",l.RENEW_TOKEN="renew_token",l.SWITCH_VIDEO_STREAM="switch_video_stream",l.DEFAULT_VIDEO_STREAM="default_video_stream",l.SET_FALLBACK_OPTION="set_fallback_option",l.GATEWAY_INFO="gateway_info",l.CONTROL="control",l.SEND_METADATA="send_metadata",l.DATA_STREAM="data_stream",l.PICK_SVC_LAYER="pick_svc_layer",l.RESTART_ICE="restart_ice",l.CONNECT_PC="connect_pc",l.SET_VIDEO_PROFILE="set_video_profile",l.SET_PARAMETER="set_parameter",l.SET_RTM2_FLAG="set_rtm2_flag"}(FE||(FE={})),function(l){l.PUBLISH_STATS="publish_stats",l.PUBLISH_RELATED_STATS="publish_related_stats",l.SUBSCRIBE_STATS="subscribe_stats",l.SUBSCRIBE_RELATED_STATS="subscribe_related_stats",l.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",l.DENOISER_STATS="denoiser_stats",l.TRANSPORT_STATS="transport_stats",l.EXTENSION_USAGE_STATS="extension_usage_stats"}(uS||(uS={})),function(l){l.ON_USER_ONLINE="on_user_online",l.ON_USER_OFFLINE="on_user_offline",l.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",l.ON_PUBLISH_STREAM="on_publish_stream",l.ON_UPLINK_STATS="on_uplink_stats",l.ON_P2P_LOST="on_p2p_lost",l.ON_REMOVE_STREAM="on_remove_stream",l.ON_ADD_AUDIO_STREAM="on_add_audio_stream",l.ON_ADD_VIDEO_STREAM="on_add_video_stream",l.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",l.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",l.ON_USER_BANNED="on_user_banned",l.ON_USER_LICENSE_BANNED="on_user_license_banned",l.ON_NOTIFICATION="on_notification",l.ON_CRYPT_ERROR="on_crypt_error",l.MUTE_AUDIO="mute_audio",l.MUTE_VIDEO="mute_video",l.UNMUTE_AUDIO="unmute_audio",l.UNMUTE_VIDEO="unmute_video",l.ON_P2P_OK="on_p2p_ok",l.RECEIVE_METADATA="receive_metadata",l.ON_DATA_STREAM="on_data_stream",l.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",l.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",l.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",l.ENABLE_LOCAL_VIDEO="enable_local_video",l.DISABLE_LOCAL_VIDEO="disable_local_video",l.ENABLE_LOCAL_AUDIO="enable_local_audio",l.DISABLE_LOCAL_AUDIO="disable_local_audio",l.ON_PUBLISHED_USER_LIST="on_published_user_list"}(JE||(JE={})),function(l){l.CONNECTION_STATE_CHANGE="CONNECTION_STATE_CHANGE",l.NEED_ANSWER="NEED_ANSWER",l.NEED_RENEGOTIATE="NEED_RENEGOTIATE",l.P2P_LOST="P2P_LOST",l.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",l.NEED_UNPUB="NEED_UNPUB",l.NEED_UNSUB="NEED_UNSUB",l.NEED_UPLOAD="NEED_UPLOAD",l.NEED_CONTROL="NEED_CONTROL",l.START_RECONNECT="START_RECONNECT",l.END_RECONNECT="END_RECONNECT",l.NEED_SIGNAL_RTT="NEED_SIGNAL_RTT"}(p6||(p6={})),function(l){l.SEND_ONLY="SEND_ONLY",l.RECEIVE_ONLY="RECEIVE_ONLY"}(YI||(YI={})),function(l){l.CONNECTED="websocket:connected",l.RECONNECTING="websocket:reconnecting",l.WILL_RECONNECT="websocket:will_reconnect",l.CLOSED="websocket:closed",l.FAILED="websocket:failed",l.ON_MESSAGE="websocket:on_message",l.REQUEST_NEW_URLS="websocket:request_new_urls",l.RECONNECT_WAITTING_FINISH="websocket:reconnect_waitting_finish",l.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",l.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire"}(zE||(zE={}));class hE extends yE{constructor(i){super(i,arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",arguments.length>2?arguments[2]:void 0),_e(this,"name","AgoraRTCException")}print(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error";return super.print(i,Gi)}throw(){super.throw(Gi)}}function pM(l){if(typeof l!="string"||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(l))throw Gi.error("Invalid Channel Name ".concat(l)),new hE(_p.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function fM(l){if(i=l,!(typeof i=="number"&&Math.floor(i)===i&&0<=i&&i<=4294967295||zV(l,1,255)))throw new hE(_p.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");var i;typeof l=="string"&&Gi.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}(function(l){l.TRANSCODE="mix_streaming",l.RAW="raw_streaming",l.INJECT="inject_streaming"})(o0||(o0={})),function(l){l[l.INJECT_STREAM_STATUS_START_SUCCESS=0]="INJECT_STREAM_STATUS_START_SUCCESS",l[l.INJECT_STREAM_STATUS_START_ALREADY_EXISTS=1]="INJECT_STREAM_STATUS_START_ALREADY_EXISTS",l[l.INJECT_STREAM_STATUS_START_UNAUTHORIZED=2]="INJECT_STREAM_STATUS_START_UNAUTHORIZED",l[l.INJECT_STREAM_STATUS_START_TIMEOUT=3]="INJECT_STREAM_STATUS_START_TIMEOUT",l[l.INJECT_STREAM_STATUS_START_FAILED=4]="INJECT_STREAM_STATUS_START_FAILED",l[l.INJECT_STREAM_STATUS_STOP_SUCCESS=5]="INJECT_STREAM_STATUS_STOP_SUCCESS",l[l.INJECT_STREAM_STATUS_STOP_NOT_FOUND=6]="INJECT_STREAM_STATUS_STOP_NOT_FOUND",l[l.INJECT_STREAM_STATUS_STOP_UNAUTHORIZED=7]="INJECT_STREAM_STATUS_STOP_UNAUTHORIZED",l[l.INJECT_STREAM_STATUS_STOP_TIMEOUT=8]="INJECT_STREAM_STATUS_STOP_TIMEOUT",l[l.INJECT_STREAM_STATUS_STOP_FAILED=9]="INJECT_STREAM_STATUS_STOP_FAILED",l[l.INJECT_STREAM_STATUS_BROKEN=10]="INJECT_STREAM_STATUS_BROKEN"}(fR||(fR={}));const IZ={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},mM={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function gM(l,i){O0(l.url,"".concat(i,".url"),1,1e3,!1),M_(l.x)||b_(l.x,"".concat(i,".x"),0,1e4),M_(l.y)||b_(l.y,"".concat(i,".y"),0,1e4),M_(l.width)||b_(l.width,"".concat(i,".width"),0,1e4),M_(l.height)||b_(l.height,"".concat(i,".height"),0,1e4),M_(l.zOrder)||b_(l.zOrder,"".concat(i,".zOrder"),0,255),M_(l.alpha)||b_(l.alpha,"".concat(i,".alpha"),0,1,!1)}const wZ={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""},AZ={audioBitrate:48,audioChannels:2,audioVolume:100,audioSampleRate:48e3,height:0,width:0,videoBitrate:400,videoFramerate:15,videoGop:30};var oT,JI,J_,f6,j0,_T,Z0,mR,v_,j_,rI,n0,wN,c_;function m6(l){if(!l.channelName)throw new hE(_p.INVALID_PARAMS,"invalid channelName in info");if(typeof l.uid!="number")throw new hE(_p.INVALID_PARAMS,"invalid uid in info, uid must be a number");return l.token&&O0(l.token,"info.token",1,2047),fM(l.uid),pM(l.channelName),!0}(function(l){l.WARNING="@live_uap-warning",l.ERROR="@line_uap-error",l.PUBLISH_STREAM_STATUS="@live_uap-publish-status",l.INJECT_STREAM_STATUS="@live_uap-inject-status",l.WORKER_STATUS="@live_uap-worker-status",l.REQUEST_NEW_ADDRESS="@live_uap-request-address"})(oT||(oT={})),function(l){l.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager"}(JI||(JI={})),function(l){l[l.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",l[l.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",l[l.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",l[l.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",l[l.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",l[l.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",l[l.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",l[l.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",l[l.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",l[l.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",l[l.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",l[l.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",l[l.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",l[l.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",l[l.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",l[l.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",l[l.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",l[l.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",l[l.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",l[l.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",l[l.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN"}(J_||(J_={})),function(l){l.CONNECT_FAILED="connect failed",l.CONNECT_TIMEOUT="connect timeout",l.WS_DISCONNECTED="websocket disconnected",l.REQUEST_TIMEOUT="request timeout",l.REQUEST_FAILED="request failed",l.WAIT_STATUS_TIMEOUT="wait status timeout",l.WAIT_STATUS_ERROR="wait status error",l.BAD_STATE="bad state",l.WS_ABORT="ws abort",l.AP_REQUEST_TIMEOUT="AP request timeout",l.AP_JSON_PARSE_ERROR="AP json parse error",l.AP_REQUEST_ERROR="AP request error",l.AP_REQUEST_ABORT="AP request abort"}(f6||(f6={})),function(l){l[l.SetSdkProfile=0]="SetSdkProfile",l[l.SetSourceChannel=1]="SetSourceChannel",l[l.SetSourceUserId=2]="SetSourceUserId",l[l.SetDestChannel=3]="SetDestChannel",l[l.StartPacketTransfer=4]="StartPacketTransfer",l[l.StopPacketTransfer=5]="StopPacketTransfer",l[l.UpdateDestChannel=6]="UpdateDestChannel",l[l.Reconnect=7]="Reconnect",l[l.SetVideoProfile=8]="SetVideoProfile"}(j0||(j0={})),function(l){l.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",l.NETWORK_CONNECTED="NETWORK_CONNECTED",l.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",l.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",l.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",l.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",l.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",l.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",l.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",l.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE"}(_T||(_T={})),function(l){l.RELAY_STATE_IDLE="RELAY_STATE_IDLE",l.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",l.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",l.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE"}(Z0||(Z0={})),function(l){l.RELAY_OK="RELAY_OK",l.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",l.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",l.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED"}(mR||(mR={})),function(l){l.High="high",l.Low="low",l.Audio="audio",l.Screen="screen",l.ScreenLow="screen_low"}(v_||(v_={})),function(l){l.DISCONNECT="disconnect",l.CONNECTION_STATE_CHANGE="connection-state-change",l.NETWORK_QUALITY="network-quality",l.STREAM_TYPE_CHANGE="stream-type-change",l.IS_P2P_DISCONNECTED="is-p2p-dis",l.DISCONNECT_P2P="dis-p2p",l.REQUEST_NEW_GATEWAY_LIST="req-gate-url",l.NEED_RENEW_SESSION="need-sid",l.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",l.JOIN_RESPONSE="join-response",l.REQUEST_DC_CONNECTION_PARAMS="request-dc-connection-params",l.RESET_CONNECTION_EVENTS="reset-connection-events",l.DATACHANNEL_PRECONNECT="datachannel_preconnect",l.DATACHANNEL_FAILBACK="datachannel_failback",l.RESET_SIGNAL="reset-signal"}(j_||(j_={})),function(l){l.P2P_DISCONNECTED="P2P_DISCONNECTED",l.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",l.TIMEOUT="TIMEOUT",l.UNKNOWN_REASON="UNKNOWN_REASON"}(rI||(rI={})),function(l){l[l.Nothing=0]="Nothing",l[l.Audio=1]="Audio",l[l.LwoVideo=2]="LwoVideo",l[l.Video=4]="Video",l[l.Data=8]="Data",l[l.DataStream0=256]="DataStream0",l[l.DataStream1=512]="DataStream1",l[l.DataStream2=1024]="DataStream2",l[l.DataStream3=2048]="DataStream3",l[l.DataStream4=4096]="DataStream4",l[l.DataStream5=8192]="DataStream5",l[l.DataStream6=16384]="DataStream6",l[l.DataStream7=32768]="DataStream7"}(n0||(n0={})),function(l){l[l.websocket=0]="websocket",l[l.datachannel=1]="datachannel"}(wN||(wN={})),function(l){l.CHINA="CHINA",l.ASIA="ASIA",l.NORTH_AMERICA="NORTH_AMERICA",l.EUROPE="EUROPE",l.JAPAN="JAPAN",l.INDIA="INDIA",l.KOREA="KOREA",l.HKMC="HKMC",l.US="US",l.OCEANIA="OCEANIA",l.SOUTH_AMERICA="SOUTH_AMERICA",l.AFRICA="AFRICA",l.OVERSEA="OVERSEA",l.GLOBAL="GLOBAL",l.EXTENSIONS="EXTENSIONS"}(c_||(c_={}));const g6=[c_.AFRICA,c_.ASIA,c_.CHINA,c_.EUROPE,c_.GLOBAL,c_.INDIA,c_.JAPAN,c_.NORTH_AMERICA,c_.OCEANIA,c_.OVERSEA,c_.SOUTH_AMERICA];var R0;(function(l){l.CHINA="CN",l.ASIA="AS",l.NORTH_AMERICA="NA",l.EUROPE="EU",l.JAPAN="JP",l.INDIA="IN",l.KOREA="KR",l.HKMC="HK",l.US="US",l.OCEANIA="OC",l.SOUTH_AMERICA="SA",l.AFRICA="AF",l.OVERSEA="OVERSEA",l.GLOBAL="GLOBAL",l.EXTENSIONS="GLOBAL"})(R0||(R0={}));const AN={CHINA:{},ASIA:{CODE:R0.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:R0.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:R0.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:R0.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","	uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:R0.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:R0.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:R0.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:R0.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:R0.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:R0.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:R0.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:R0.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:R0.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};var WO,E6,ME,N0,yT,TE,u_,WE,v6,OS,NS,a0,NT,W_,bT,_6,ES,HS,gR,w_,PT,y6;cM&&(AN.CHINA={CODE:R0.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]}),function(l){l.UPDATE_BITRATE_LIMIT="update_bitrate_limit"}(WO||(WO={}));class b6 extends D_{constructor(i,o){super(),_e(this,"onICEConnectionStateChange",void 0),_e(this,"onConnectionStateChange",void 0),_e(this,"onDTLSTransportStateChange",void 0),_e(this,"onDTLSTransportError",void 0),_e(this,"onICETransportStateChange",void 0),_e(this,"onFirstAudioReceived",void 0),_e(this,"onFirstVideoReceived",void 0),_e(this,"onFirstAudioDecoded",void 0),_e(this,"onFirstVideoDecoded",void 0),_e(this,"onFirstVideoDecodedTimeout",void 0),_e(this,"onSelectedLocalCandidateChanged",void 0),_e(this,"onSelectedRemoteCandidateChanged",void 0)}}class ON extends b6{constructor(i,o){super(i,o)}}(function(l){l.SEND="sendonly",l.RECV="recvonly",l.SENDRECV="sendrecv",l.INACTIVE="inactive"})(E6||(E6={})),function(l){l.VIDEO="video",l.AUDIO="audio"}(ME||(ME={})),function(l){l[l.UDP=0]="UDP",l[l.TCP=1]="TCP",l[l.RELAY=2]="RELAY"}(N0||(N0={})),function(l){l[l.FIRST_CONNECTION=0]="FIRST_CONNECTION",l[l.TCP_RESTART=1]="TCP_RESTART",l[l.RELAY_RESTART=2]="RELAY_RESTART",l[l.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",l[l.OLD_RESTART=11]="OLD_RESTART",l[l.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED"}(yT||(yT={})),function(l){l.LocalVideoTrack="videoTrack",l.LocalAudioTrack="audioTrack",l.LocalVideoLowTrack="videoLowTrack"}(TE||(TE={})),function(l){l.New="new",l.Connected="connected",l.Reconnecting="reconnecting",l.Disconnected="disconnected"}(u_||(u_={})),function(l){l.StateChange="stateChange",l.IceConnectionStateChange="iceConnectionStateChange",l.RequestMuteLocal="requestMuteLocal",l.RequestUnmuteLocal="requestUnmuteLocal",l.RequestRePublish="requestRePublish",l.RequestRePublishDataChannel="requestRePublishDataChannel",l.RequestReSubscribe="requestReSubscribe",l.RequestUploadStats="requestUploadStats",l.MediaReconnectStart="MediaReconnectStart",l.MediaReconnectEnd="MediaReconnectEnd",l.NeedSignalRTT="NeedSignalRTT",l.RequestRestartICE="RequestRestartIce",l.PeerConnectionStateChange="PeerConnectionStateChange",l.RequestReconnect="RequestReconnect",l.RequestReconnectPC="RequestReconnectPC",l.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",l.P2PLost="P2PLost",l.UpdateVideoEncoder="UpdateVideoEncoder",l.ConnectionTypeChange="ConnectionTypeChange",l.RequestLowStreamParameter="RequestLowStreamParameter",l.QueryClientConnectionState="QueryClientConnectionState",l.LocalCandidate="LocalCandidate",l.RequestP2PMuteLocal="requestP2PMuteLocal",l.RequestP2PPublish="RequestP2PPublish",l.RequestP2PUnPublish="RequestP2PUnPublish",l.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",l.RequestP2PMuteRemote="RequestP2PMuteRemote",l.RequestP2PRestartICE="RequestP2PRestartICE"}(WE||(WE={})),function(l){l.MUTE_LOCAL_VIDEO="mute_local_video",l.MUTE_LOCAL_AUDIO="mute_local_audio",l.UNMUTE_LOCAL_VIDEO="unmute_local_video",l.UNMUTE_LOCAL_AUDIO="unmute_local_audio",l.MUTE_REMOTE_VIDEO="mute_remote_video",l.MUTE_REMOTE_AUDIO="mute_remote_audio",l.UNMUTE_REMOTE_VIDEO="unmute_remote_video",l.UNMUTE_REMOTE_AUDIO="unmute_remote_audio"}(v6||(v6={})),function(l){l.CONNECTING="CONNECTING",l.RECONNECTING="RECONNECTING",l.CONNECTED="CONNECTED",l.CLOSED="CLOSED"}(OS||(OS={})),function(l){l[l.CONNECT_AP=0]="CONNECT_AP",l[l.AP_CONNECTED=1]="AP_CONNECTED",l[l.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",l[l.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",l[l.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",l[l.CONNECT_WORKER=5]="CONNECT_WORKER",l[l.WORKER_CONNECTED=6]="WORKER_CONNECTED",l[l.CLOSED=7]="CLOSED"}(NS||(NS={})),function(l){l.CONNECTION_STATE_CHANGE="connection-state-change",l.STATE_CHANGE="state-change",l.INSPECT_RESULT="inspect-result",l.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",l.REQUEST_NEW_WORKER_URL="request-new-worker-url"}(a0||(a0={})),function(l){l.NETWORK_ERROR="NETWORK_ERROR",l.SERVER_ERROR="SERVER_ERROR",l.MULTI_IP="MULTI_IP",l.TIMEOUT="TIMEOUT",l.OFFLINE="OFFLINE",l.LEAVE="LEAVE",l.P2P_FAILED="P2P_FAILED",l.FALLBACK="FALLBACK"}(NT||(NT={})),function(l){l.CONNECTED="transmitter:connected",l.RECONNECTING="transmitter:reconnecting",l.WILL_RECONNECT="transmitter:will_reconnect",l.CLOSED="transmitter:closed",l.FAILED="transmitter:failed",l.ON_MESSAGE="transmitter:on_message",l.REQUEST_NEW_URLS="transmitter:request_new_urls",l.RECONNECT_WAITTING_FINISH="transmitter:reconnect_waitting_finish",l.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",l.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",l.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",l.FAILBACK="transmitter:failback"}(W_||(W_={})),function(l){l.CAMERA_CHANGED="camera-changed",l.MICROPHONE_CHANGED="microphone-changed",l.PLAYBACK_DEVICE_CHANGED="playback-device-changed",l.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",l.AUTOPLAY_FAILED="autoplay-failed",l.SECURITY_POLICY_VIOLATION="security-policy-violation"}(bT||(bT={})),function(l){l[l.APP_TYPE_INVALID_VALUE=-1]="APP_TYPE_INVALID_VALUE",l[l.APP_TYPE_NATIVE=0]="APP_TYPE_NATIVE",l[l.APP_TYPE_NATIVE_COCOS=1]="APP_TYPE_NATIVE_COCOS",l[l.APP_TYPE_NATIVE_UNITY=2]="APP_TYPE_NATIVE_UNITY",l[l.APP_TYPE_NATIVE_ELECTRON=3]="APP_TYPE_NATIVE_ELECTRON",l[l.APP_TYPE_NATIVE_FLUTTER=4]="APP_TYPE_NATIVE_FLUTTER",l[l.APP_TYPE_NATIVE_UNREAL=5]="APP_TYPE_NATIVE_UNREAL",l[l.APP_TYPE_NATIVE_XAMARIN=6]="APP_TYPE_NATIVE_XAMARIN",l[l.APP_TYPE_NATIVE_API_CLOUD=7]="APP_TYPE_NATIVE_API_CLOUD",l[l.APP_TYPE_NATIVE_REACT_NATIVE=8]="APP_TYPE_NATIVE_REACT_NATIVE",l[l.APP_TYPE_NATIVE_PYTHON=9]="APP_TYPE_NATIVE_PYTHON",l[l.APP_TYPE_NATIVE_COCOS_CREATOR=10]="APP_TYPE_NATIVE_COCOS_CREATOR",l[l.APP_TYPE_NATIVE_RUST=11]="APP_TYPE_NATIVE_RUST",l[l.APP_TYPE_NATIVE_C_SHARP=12]="APP_TYPE_NATIVE_C_SHARP",l[l.APP_TYPE_NATIVE_CEF=13]="APP_TYPE_NATIVE_CEF",l[l.APP_TYPE_NATIVE_UNI_APP=14]="APP_TYPE_NATIVE_UNI_APP",l[l.APP_TYPE_WEBRTC=1e3]="APP_TYPE_WEBRTC",l[l.APP_TYPE_WEBRTC_REACT=1001]="APP_TYPE_WEBRTC_REACT",l[l.APP_TYPE_WEBRTC_VUE=1002]="APP_TYPE_WEBRTC_VUE",l[l.APP_TYPE_WEBRTC_ANGULAR=1003]="APP_TYPE_WEBRTC_ANGULAR"}(_6||(_6={})),function(l){l.CONNECTING="CONNECTING",l.RECONNECTING="RECONNECTING",l.CONNECTED="CONNECTED",l.CLOSED="CLOSED"}(ES||(ES={})),function(l){l.CONNECTION_STATE_CHANGE="connection-state-change",l.STATE_CHANGE="state-change",l.INSPECT_RESULT="inspect-result",l.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",l.REQUEST_NEW_WORKER_URL="request-new-worker-url"}(HS||(HS={})),function(l){l[l.CONNECT_AP=0]="CONNECT_AP",l[l.AP_CONNECTED=1]="AP_CONNECTED",l[l.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",l[l.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",l[l.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",l[l.CONNECT_WORKER=5]="CONNECT_WORKER",l[l.WORKER_CONNECTED=6]="WORKER_CONNECTED",l[l.CLOSED=7]="CLOSED"}(gR||(gR={})),function(l){l.CALL="call",l.CANDIDATE="candidate",l.PUBLISH="publish",l.UNPUBLISH="unpublish",l.SUBSCRIBE="subscribe",l.UNSUBSCRIBE="unsubscribe",l.CONTROL="control",l.RESTART_ICE="restart_ice",l.ACK="ack",l.JOIN="join",l.EXCHANGE_SDP="exchange_sdp",l.DO_SUBSCRIBE="do_subscribe",l.DO_UNSUBSCRIBE="do_unsubscribe"}(w_||(w_={})),function(l){l.MUTE_LOCAL_AUDIO="mute_local_audio",l.MUTE_LOCAL_VIDEO="mute_local_video",l.UNMUTE_LOCAL_AUDIO="unmute_local_audio",l.UNMUTE_LOCAL_VIDEO="unmute_local_video"}(PT||(PT={})),function(l){l[l.SUCCESS=1]="SUCCESS",l[l.FAILED=0]="FAILED"}(y6||(y6={}));const OZ={[KI.ACCESS_POINT]:{[F0.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[F0.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[F0.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[F0.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[F0.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[F0.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[F0.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[F0.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[F0.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[F0.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[F0.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[F0.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[F0.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[F0.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[F0.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[F0.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[F0.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[F0.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[KI.UNILBS]:{[AS.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[AS.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[AS.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[AS.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[AS.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[AS.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[AS.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[AS.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[AS.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[AS.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[AS.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[AS.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[KI.STRING_UID_ALLOCATOR]:{[qO.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[qO.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[qO.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function NN(l){const i=OZ[Math.floor(l/1e4)];if(!i)return{desc:"unkonw error",retry:!1};const o=i[l%1e4];if(!o){if(Math.floor(l/1e4)===KI.ACCESS_POINT){const p=l%1e4;if(p.toString()[0]==="1")return{desc:l.toString(),retry:!1};if(p.toString()[0]==="2")return{desc:l.toString(),retry:!0}}return{desc:"unkonw error",retry:!1}}return o}const NZ={[qE.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[qE.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[qE.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[qE.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[qE.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[qE.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[qE.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[qE.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[qE.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[qE.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[qE.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[qE.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[qE.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[qE.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[qE.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[qE.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[qE.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[qE.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[qE.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[qE.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[qE.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[qE.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[qE.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[qE.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[qE.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[qE.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[qE.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[qE.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[qE.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[qE.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[qE.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[qE.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[qE.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[qE.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[qE.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[qE.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[qE.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[qE.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[qE.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[qE.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[qE.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[qE.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[qE.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[qE.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[qE.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[qE.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[qE.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[qE.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[qE.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[qE.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[qE.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[qE.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[qE.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[qE.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[qE.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[qE.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[qE.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[qE.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[qE.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[qE.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[qE.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[qE.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[qE.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function iI(l){return NZ[l]||{desc:"UNKNOW_ERROR_".concat(l),action:"failed"}}function S6(l,i){var o=Object.keys(l);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(l);i&&(p=p.filter(function(g){return Object.getOwnPropertyDescriptor(l,g).enumerable})),o.push.apply(o,p)}return o}function EM(l){for(var i=1;i<arguments.length;i++){var o=arguments[i]!=null?arguments[i]:{};i%2?S6(Object(o),!0).forEach(function(p){_e(l,p,o[p])}):Object.getOwnPropertyDescriptors?Object.defineProperties(l,Object.getOwnPropertyDescriptors(o)):S6(Object(o)).forEach(function(p){Object.defineProperty(l,p,Object.getOwnPropertyDescriptor(o,p))})}return l}function T6(l){return l.every(i=>i.readyState===WebSocket.CLOSED||i.readyState===WebSocket.CLOSING)}function C6(l,i){if(typeof l=="string")return l;const{proxy:o,host:p,port:g}=l;if(i){const b=nE("JOIN_GATEWAY_FALLBACK_PORT")||443;return b===443?"wss://".concat(p,"/ws/?p=").concat(Number(g)+150):"wss://".concat(p,":").concat(b,"/ws/?p=").concat(Number(g)+150)}return o?"wss://".concat(o,"/ws/?h=").concat(p,"&p=").concat(g):"wss://".concat(p,":").concat(g)}const PZ=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,kZ=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,DZ=/wss:\/\/(.+):([0-9]+)\/?/,LZ=/wss:\/\/(.[^\/]+)\/?/;let xZ=0;class MZ{constructor(i,o){_e(this,"id",0),_e(this,"store",void 0),_e(this,"recordIndex",void 0),_e(this,"websockets",[]),_e(this,"try443PortDuration",2e3),_e(this,"forceCloseWSDuration",5e3),_e(this,"try443PortTimeout",null),_e(this,"forceCloseTimeout",null),_e(this,"isTry443PortFailed",!1),_e(this,"isNormalPortFailed",!1),_e(this,"useDoubleDomain",!1),_e(this,"useProxy",!1),_e(this,"startTime",Date.now()),this.id=++xZ,this.try443PortDuration=nE("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=i||5e3,this.store=o}closeAllWebsockets(){this.websockets.forEach(i=>{i.onopen=null,i.onclose=null,i.onmessage=null,i.close()}),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout)}logger(){var i;const o=Date.now()-this.startTime;for(var p=arguments.length,g=new Array(p),b=0;b<p;b++)g[b]=arguments[b];Gi.debug("[choose-best-ws ".concat((i=this.store)===null||i===void 0?void 0:i.clientId," ").concat(this.id,"] ").concat(o,"ms:"),...g)}createWebSocket(i,o,p){this.logger("createWebSocket:",i,{isTry443Port:o,hasTimeoutDetection:p});const g=nE("GATEWAY_DOMAINS"),b=Date.now(),A=[],j=g.find($=>{var Vt;return VE(Vt=i.host).call(Vt,$)});j||(this.useDoubleDomain=!1);const H=[];if(this.useDoubleDomain)g.forEach($=>{H.push(C6(EM(EM({},i),{},{host:i.host.replace(j,$)}),o))});else{const $=EM({},i);if(o&&j){const Vt=g.find(_r=>_r!==j);Vt&&($.host=$.host.replace(j,Vt))}H.push(C6($,o))}try{H.forEach($=>{const Vt=new WebSocket($);Vt.binaryType="arraybuffer",A.push(Vt),this.logger("ws is connecting:",Vt.url)})}catch($){if(this.logger("ws create failed"),A.forEach(Vt=>Vt.close()),A.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(i,o,p);if(!o&&Number(i.port)!==443)return this.createWebSocket(i,!0,p);throw new hE(_p.WS_ERR,"init websocket failed! Error: ".concat($.toString()))}const z=UO();return this.store&&this.store.recordJoinChannelService({urls:A.map($=>$.url),service:"gateway"},this.recordIndex),A.forEach($=>{$.onopen=()=>{this.logger("onopen: ws ".concat($.url," open cost ").concat(Date.now()-b,"ms")),this.websockets.forEach(Vt=>{Vt!==$&&(Vt.onopen=null,Vt.onclose=null,Vt.onmessage=null,Vt.close(),this.logger("close backup websocket: ".concat(Vt.url)))}),this.websockets.length=0,z.resolve($)},$.onclose=Vt=>{this.logger("onclose: ws ".concat($.url," closed cost ").concat(Date.now()-b,"ms state: ").concat($.readyState)),o?this.isTry443PortFailed=T6(A):this.isNormalPortFailed=T6(A),this.logger("443: ".concat(this.useProxy?"not try":this.isTry443PortFailed?"failed":"trying"," 47xx: ").concat(this.isNormalPortFailed?"failed":"trying")),(o&&this.isTry443PortFailed||!o&&(this.isTry443PortFailed||this.useProxy)&&this.isNormalPortFailed)&&(this.logger("onclose: all websocket is closed, ".concat(Vt.reason)),z.reject({code:Vt.code,reason:rI.A_ROUND_WS_FAILED}))},$.onmessage=Vt=>this.logger("".concat($.url," onmessage: ").concat(Vt.data))}),this.websockets.push(...A),p||(()=>{const $=()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",z.isResolved),this.websockets.forEach(Vt=>Vt.readyState!==WebSocket.OPEN&&Vt.close())};if(o||this.useProxy)return this.logger("add 5s timeout at ".concat(o?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout($,this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout(()=>{if(this.logger("2s timeout, isWebsocket created: ",z.isResolved),z.isResolved)return $();l_().os===l0.MAC_OS&&N_()&&$(),this.createWebSocket(i,!0,!0).then(Vt=>z.resolve(Vt)).catch(Vt=>{this.isNormalPortFailed&&z.reject(Vt),this.logger("try 443 port to create ws failed")}),this.forceCloseTimeout=window.setTimeout($,this.forceCloseWSDuration)},this.try443PortDuration)})(),z.promise}chooseBestWebsocket(i,o,p,g){return this.useDoubleDomain=!!o,typeof i=="string"&&(i=function(b){let A,j,H;return[,A,j,H]=b.match(PZ)||[],A||([,j,H]=b.match(kZ)||[]),j&&H||([,j,H]=b.match(DZ)||[]),j&&H||([,j]=b.match(LZ)||[]),j||Gi.warning("un-destructible url: ",b),{proxy:A,host:j,port:H||"443"}}(i)),this.recordIndex=g,this.useProxy=!!i.proxy,p&&this.useProxy&&(Gi.warn("cannot use 443 only when use proxy"),p=!1),this.createWebSocket(i,!!p,!1).finally(()=>this.clearTimeout())}}function R6(l,i){var o=Object.keys(l);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(l);i&&(p=p.filter(function(g){return Object.getOwnPropertyDescriptor(l,g).enumerable})),o.push.apply(o,p)}return o}class I6 extends D_{get url(){return this.websocket&&this.websocket.url||null}get reconnectMode(){return this._reconnectMode}set reconnectMode(i){var o;VE(o=["tryNext","recover"]).call(o,i)&&this.resetReconnectCount(i),this._reconnectMode=i}get state(){return this._state}set state(i){i!==this._state&&(this._state=i,this._state==="reconnecting"?this.emit(zE.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(zE.CONNECTED):this._state==="closed"?this.emit(zE.CLOSED):this._state==="failed"&&this.emit(zE.FAILED))}resetReconnectCount(i){Gi.debug("websocket reset reconnect count, reason: "+i),this.reconnectCount=0}constructor(i,o){let p=arguments.length>2&&arguments[2]!==void 0&&arguments[2],g=arguments.length>3&&arguments[3]!==void 0&&arguments[3],b=arguments.length>4&&arguments[4]!==void 0&&arguments[4],A=arguments.length>5?arguments[5]:void 0;super(),_e(this,"connectionID",0),_e(this,"currentURLIndex",0),_e(this,"urls",[]),_e(this,"_reconnectMode","tryNext"),_e(this,"reconnectReason",void 0),_e(this,"_initMutex",new E0("websocket")),_e(this,"name",void 0),_e(this,"_state","closed"),_e(this,"reconnectInterrupter",void 0),_e(this,"websocket",void 0),_e(this,"retryConfig",void 0),_e(this,"reconnectCount",0),_e(this,"forceCloseTimeout",5e3),_e(this,"onlineReconnectListener",void 0),_e(this,"useCompress",void 0),_e(this,"tryDoubleDomain",!1),_e(this,"use443PortOnly",!1),_e(this,"wsInflateLength",0),_e(this,"wsDeflateLength",0),_e(this,"closeEstablishingWs",()=>{}),_e(this,"store",void 0),_e(this,"joinGatewayRecordIndex",void 0),this.store=A,this.name=i,this.retryConfig=function(Vt){for(var _r=1;_r<arguments.length;_r++){var Fi=arguments[_r]!=null?arguments[_r]:{};_r%2?R6(Object(Fi),!0).forEach(function(_l){_e(Vt,_l,Fi[_l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(Vt,Object.getOwnPropertyDescriptors(Fi)):R6(Object(Fi)).forEach(function(_l){Object.defineProperty(Vt,_l,Object.getOwnPropertyDescriptor(Fi,_l))})}return Vt}({},o),this.useCompress=p,this.tryDoubleDomain=g,this.use443PortOnly=b;const{timeout:j,timeoutFactor:H}=o,z=Math.max(300,Math.floor(3*j/5)),$=Math.max(1.2,Math.floor(8*H)/10);K0.ONLINE&&(this.retryConfig.timeout=z,this.retryConfig.timeoutFactor=$),X_.on(YT.NETWORK_STATE_CHANGE,(Vt,_r)=>{Vt!==_r&&(this.resetReconnectCount("network state change: ".concat(_r," -> ").concat(Vt)),Vt===K0.ONLINE?(this.retryConfig.timeout=z,this.retryConfig.timeoutFactor=$):(this.retryConfig.timeout=j,this.retryConfig.timeoutFactor=H))})}getConnection(){return this.websocket||void 0}async init(i){let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const p=await this._initMutex.lock();this.forceCloseTimeout=o,this.urls=i,this.state="connecting";try{const g=UO(),b=this.urls[this.currentURLIndex];this.createWebSocketConnection(b).then(g.resolve).catch(g.reject),this.once(zE.CLOSED,()=>{g.reject(new yE(_p.WS_DISCONNECT))}),this.once(zE.CONNECTED,g.resolve),await g.promise}catch{}finally{p()}}close(i,o){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;const p=this.websocket;o?setTimeout(()=>p.close(),500):p.close(),this.websocket=void 0}this.state=i?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(i,o){if(!this.websocket)return void Gi.warning("[".concat(this.name,"] can not reconnect, no websocket"));i!==void 0&&(this.reconnectMode=i),Gi.debug("[".concat(this.name,"] reconnect is triggered initiative")),typeof this.joinGatewayRecordIndex=="number"&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(o)]},this.joinGatewayRecordIndex);const p=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),p&&p.bind(this.websocket)({code:9999,reason:o})}sendMessage(i){let o=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new yE(_p.WS_ABORT,"websocket is not ready");try{o||(i=JSON.stringify(i)),this.websocket.send(i)}catch(p){throw new yE(_p.WS_ERR,"send websocket message error"+p.toString())}}setWsInflateData(i){this.wsDeflateLength=this.wsDeflateLength+i.originLength,this.wsInflateLength=this.wsInflateLength+i.compressedLength}getWsInflateData(){const i=this.wsInflateLength,o=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:i,wsDeflateLength:o}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(i){var o;const p=UO();this.connectionID+=1,this.joinGatewayRecordIndex=void 0;const g=$=>{var Vt;(Vt=this.store)===null||Vt===void 0||Vt.signalChannelOpen(),Gi.debug("[".concat(this.name,"] websocket opened:"),$),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),p.resolve()},b=async $=>{var Vt;if(Gi.debug("[".concat(this.name,"] websocket close ").concat((Vt=this.websocket)===null||Vt===void 0?void 0:Vt.url,", code: ").concat($.code,", reason: ").concat($.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount>=this.retryConfig.maxRetryCount)p.reject(new yE(_p.WS_DISCONNECT,"websocket close: ".concat($.code))),this.close();else{this.state==="connected"&&(this.reconnectReason=$.reason,this.state="reconnecting");const _r=oS(this,zE.WILL_RECONNECT,this.reconnectMode,$.reason)||this.reconnectMode,Fi=await this.reconnectWithAction(_r);if(this.state==="closed")return void Gi.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!Fi)return p.reject(new yE(_p.WS_DISCONNECT,"websocket reconnect failed: ".concat($.code))),this.close(!0);p.resolve()}},A=$=>{this.emit(zE.ON_MESSAGE,$)},j=$=>{Gi.warn("[".concat(this.connectionID,"] ws open error ").concat($))};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),nE("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(i=nE("GATEWAY_WSS_ADDRESS")),Gi.debug("[".concat(this.name,"] start connect, url:"),i);const H=(o=this.store)===null||o===void 0?void 0:o.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var z;const $=await this.chooseBestWebsocketConnection(i);this.websocket=$,g&&g(this.websocket.url),this.websocket.onclose=b,this.websocket.onmessage=A,this.websocket.onerror=j,(z=this.store)===null||z===void 0||z.recordJoinChannelService({endTs:Date.now(),status:"success"},H),this.joinGatewayRecordIndex=H}catch($){const Vt=this.state==="closed",_r=$ instanceof yE,Fi=_r&&$.code===_p.WS_ABORT,_l=_r&&$.code===_p.WS_ERR,_u=_r?$.message:$&&($.reason||$.toString());Gi.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(_u)),this.store&&this.store.recordJoinChannelService({endTs:Date.now(),status:Fi?"aborted":"error",errors:[$]},H),Vt||_l?(p.reject(Vt?new yE(_p.WS_DISCONNECT,"websocket is closed: ".concat(_u)):new yE(_p.WS_ERR,"init websocket failed: ".concat(_u))),_l&&Gi.error("[".concat(this.name,"] init websocket failed: ").concat(_u))):b&&b($)}return p.promise}async reconnectWithAction(i){let o=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount||this.urls.length===0||this.state==="closed")return!1;Gi.warning("[choose-best-ws] action: =>",i),this.onlineReconnectListener||X_.isOnline||!X_.onlineWaiter||(this.onlineReconnectListener=X_.onlineWaiter.then(()=>{this.onlineReconnectListener=void 0}));let p=!0;if(this.reconnectInterrupter=()=>p=!1,o){const A=mN(this.reconnectCount,this.retryConfig);Gi.debug("[".concat(this.name,"] wait ").concat(A,"ms to reconnect websocket, mode: ").concat(i)),await pE.race([w0(A),this.onlineReconnectListener||new pE(()=>{})])}if(this._state==="closed"||!p)return!1;this.reconnectCount+=1;const g=async(A,j)=>{this.emit(zE.RECONNECT_CREATE_CONNECTION,j),await this.createWebSocketConnection(A)};try{if(i==="retry")this.emit(zE.RECONNECT_WAITTING_FINISH,i),await g(this.urls[this.currentURLIndex],i);else if(i==="tryNext"){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return this.reconnectWithAction("recover",!1);Gi.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex)),this.emit(zE.RECONNECT_WAITTING_FINISH,i),await g(this.urls[this.currentURLIndex],i)}else i==="recover"&&(Gi.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.emit(zE.RECONNECT_WAITTING_FINISH,i),this.urls=await U_(this,zE.REQUEST_NEW_URLS),this.currentURLIndex=0,await g(this.urls[this.currentURLIndex],i))}catch(A){var b;Gi.error("[".concat(this.name,"] reconnect failed ").concat(A&&A.toString()));const j=A==null||(b=A.data)===null||b===void 0?void 0:b.desc;return Array.isArray(j)&&VE(j).call(j,"dynamic key expired")?(this.emit(zE.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):this.reconnectWithAction(i,o)}return!0}}class HO extends I6{constructor(i,o){super(i,o,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(i,o){const p=UO(),g=function(A,j){return new MZ(A,j)}(this.forceCloseTimeout,this.store);this.closeEstablishingWs=()=>{Gi.debug("[choose-best-ws] close establishing websockets"),g.closeAllWebsockets(),p.reject(new yE(_p.WS_ABORT,"choose best websocket aborted"))};const b=nE("GATEWAY_DOMAINS");return Gi.debug("[choose-best-ws] currentDomain: ",i,", domains: ",b,"total: ".concat(this.urls.length),"current: ".concat(this.currentURLIndex+1)),g.chooseBestWebsocket(i,this.tryDoubleDomain,this.use443PortOnly,o).then(p.resolve).catch(p.reject),p.promise.finally(()=>{this.closeEstablishingWs=void 0})}}class zO extends I6{constructor(i,o){super(i,o,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(i,o){return new pE((p,g)=>{let b=!1;const A=[];this.closeEstablishingWs=()=>{Gi.debug("[choose-best-ws] close establishing websockets"),A.forEach(_l=>{_l.onclose=null,_l.onopen=null,_l.onmessage=null,_l.close()}),g(new yE(_p.WS_ABORT,"choose best websocket aborted"))};const j=nE("GATEWAY_DOMAINS");let H;const z=i.indexOf("?h="),$=j.find(_l=>z!==-1?VE(i).call(i,_l,z):VE(i).call(i,_l));Gi.debug("[choose-best-ws] currentDomain: ",$,", domains: ",j);let Vt=!this.tryDoubleDomain||!$;if(!Vt&&$){var _r;const _l=Date.now();try{j.forEach(_u=>{const _h=z===-1?i.replace($,_u):i.substr(0,z)+i.substr(z).replace($,_u),_g=new WebSocket(_h);_g.binaryType="arraybuffer",A.push(_g),Gi.debug("[choose-best-ws] ws is connecting:",_g.url)})}catch{for(Gi.debug("[choose-best-ws] ws create failed, fallback to single url"),A.forEach(_h=>_h.close());A.length;)A.pop();Vt=!0}(_r=this.store)===null||_r===void 0||_r.recordJoinChannelService({urls:A.map(_u=>_u.url),service:"gateway"},o),A.forEach(_u=>{_u.onopen=()=>{if(b)return;const _h=Date.now()-_l;Gi.debug("[choose-best-ws] ws open cost ".concat(_h,"ms")),A.filter(_g=>_g!==_u).forEach(_g=>{Gi.debug("[choose-best-ws]close backup websocket: ".concat(_g.url)),_g.close()}),b=!0,p(_u)},_u.onclose=_h=>{H=_h,!b&&(A.find(_g=>!(_g.readyState===WebSocket.CLOSED||_g.readyState===WebSocket.CLOSING))||(Gi.debug("[choose-best-ws] all websocket is closed"),b=!0,g(H)))},_u.onmessage=_h=>{Gi.debug("[choose-best-ws]".concat(_u.url," onmessage: ").concat(_h.data))}}),w0(this.forceCloseTimeout).then(()=>{A.forEach(_u=>{_u.readyState!==WebSocket.OPEN&&_u.close()})})}if(Vt){var Fi;let _l;Gi.debug("[choose-best-ws] use single url: ",i),(Fi=this.store)===null||Fi===void 0||Fi.recordJoinChannelService({urls:[i],service:"gateway"},o);try{_l=new WebSocket(i),A.push(_l),_l.binaryType="arraybuffer"}catch(_u){const _h=new yE(_p.WS_ERR,"init websocket failed! Error: ".concat(_u.toString()));return Gi.error("[".concat(this.name,"]").concat(_h)),void g(_h)}_l.onopen=()=>{p(_l)},_l.onclose=_u=>{g(_u)},_l.onmessage=_u=>{Gi.debug("[choose-best-ws]".concat(_l.url," onmessage: ").concat(_u.data))},w0(this.forceCloseTimeout).then(()=>{_l&&_l.readyState!==WebSocket.OPEN&&_l.close()})}}).then(p=>(this.closeEstablishingWs=void 0,p)).catch(p=>{throw this.closeEstablishingWs=void 0,p})}}class w6 extends D_{get connectionState(){return this._connectionState}set connectionState(i){i!==this._connectionState&&(this._connectionState=i,i===t_.CONNECTED?this.emit(kE.WS_CONNECTED):i===t_.RECONNECTING?this.emit(kE.WS_RECONNECTING,this._websocketReconnectReason):i===t_.CLOSED&&this.emit(kE.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(i,o){super(),_e(this,"_disconnectedReason",void 0),_e(this,"_websocketReconnectReason",void 0),_e(this,"_connectionState",t_.CLOSED),_e(this,"reconnectToken",void 0),_e(this,"websocket",void 0),_e(this,"openConnectionTime",void 0),_e(this,"clientId",void 0),_e(this,"lastMsgTime",Date.now()),_e(this,"uploadCache",[]),_e(this,"uploadCacheInterval",void 0),_e(this,"rttRolling",new WL(5)),_e(this,"pingpongTimer",void 0),_e(this,"wsInflateDataTimer",void 0),_e(this,"pingpongTimeoutCount",0),_e(this,"joinResponse",void 0),_e(this,"multiIpOption",void 0),_e(this,"initError",void 0),_e(this,"spec",void 0),_e(this,"store",void 0),_e(this,"onWebsocketMessage",p=>{if(p.data instanceof ArrayBuffer)return void this.emit(kE.ON_BINARY_DATA,p.data);const g=JSON.parse(p.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(g,"_id")){const b="res-@".concat(g._id);this.emit(b,g._result,g._message)}else if(Object.prototype.hasOwnProperty.call(g,"_type")){if(this.emit(g._type,g._message),g._type===JE.ON_NOTIFICATION&&this.handleNotification(g._message),g._type===JE.ON_USER_BANNED)switch(g._message.error_code){case 14:this.close(e_.UID_BANNED);break;case 15:this.close(e_.IP_BANNED);break;case 16:this.close(e_.CHANNEL_BANNED)}if(g._type===JE.ON_USER_LICENSE_BANNED)switch(g._message.error_code){case qE.ERR_LICENSE_MISSING:this.close(e_.LICENSE_MISSING);break;case qE.ERR_LICENSE_EXPIRED:this.close(e_.LICENSE_EXPIRED);break;case qE.ERR_LICENSE_MINUTES_EXCEEDED:this.close(e_.LICENSE_MINUTES_EXCEEDED);break;case qE.ERR_LICENSE_PERIOD_INVALID:this.close(e_.LICENSE_PERIOD_INVALID);break;case qE.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(e_.LICENSE_MULTIPLE_SDK_SERVICE);break;case qE.ERR_LICENSE_ILLEGAL:this.close(e_.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=i.clientId,this.spec=i,this.store=o,this.websocket=new HO("gateway-".concat(this.clientId),this.spec.retryConfig,!0,nE("JOIN_GATEWAY_USE_DUAL_DOMAIN"),nE("JOIN_GATEWAY_USE_443PORT_ONLY"),o),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===t_.CONNECTED&&this.reconnect("retry",h0.OFFLINE)})}async request(i,o,p,g){const b=T_(6,""),A={_id:b,_type:i,_message:o},j=this.websocket.connectionID,H=()=>new pE((_l,_u)=>{if(this.connectionState===t_.CONNECTED)return _l();const _h=()=>{this.off(kE.WS_CLOSED,_g),_l()},_g=()=>{this.off(kE.WS_CONNECTED,_h),_u(new hE(_p.WS_ABORT))};this.once(kE.WS_CONNECTED,_h),this.once(kE.WS_CLOSED,_g),i!==FE.PUBLISH&&i!==FE.SUBSCRIBE&&i!==FE.UNSUBSCRIBE&&i!==FE.UNPUBLISH&&i!==FE.CONTROL&&i!==FE.RESTART_ICE||this.once(kE.DISCONNECT_P2P,()=>{_u(new hE(_p.DISCONNECT_P2P))}),i!==FE.PUBLISH&&i!==FE.RESTART_ICE||this.once(kE.ABORT_P2P_EXECUTION,()=>{_u(new hE(_p.DISCONNECT_P2P))})});if(this.connectionState!==t_.CONNECTING&&this.connectionState!==t_.RECONNECTING||i===FE.JOIN||i===FE.REJOIN||await H(),this.websocket.sendMessage(A,!0),g)return;const z=new pE((_l,_u)=>{let _h=!1;const _g=(oE,SE)=>{_h=!0,_l({isSuccess:oE==="success",message:SE||{}}),this.off(kE.WS_CLOSED,eE),this.off(kE.WS_RECONNECTING,eE),this.emit(kE.REQUEST_SUCCESS,i,o)};this.once("res-@".concat(b),_g);const eE=()=>{_u(new hE(_p.WS_ABORT,"type: ".concat(i))),this.off(kE.WS_CLOSED,eE),this.off(kE.WS_RECONNECTING,eE),this.off("res-@".concat(b),_g)};this.once(kE.WS_CLOSED,eE),this.once(kE.WS_RECONNECTING,eE),w0(nE("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==j||_h||(Gi.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(i)),this.emit(kE.REQUEST_TIMEOUT,i,o))})});let $=null;try{$=await z}catch(_l){if(this.connectionState===t_.CLOSED||i===FE.LEAVE)throw new hE(_p.WS_ABORT);return!this.spec.forceWaitGatewayResponse||p?_l.throw():i===FE.JOIN||i===FE.REJOIN?null:(await H(),await this.request(i,o))}if($.isSuccess)return $.message;const Vt=Number($.message.error_code||$.message.code),_r=iI(Vt),Fi=new hE(_p.UNEXPECTED_RESPONSE,"".concat(_r.desc,": ").concat($.message.error_str),{code:Vt,data:$.message});return _r.action==="success"?$.message:(Gi.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(i,", error_code: ").concat(Vt,", message: ").concat(_r.desc,", action: ").concat(_r.action)),Vt===qE.ERR_TOO_MANY_BROADCASTERS?((i===FE.JOIN||i===FE.REJOIN)&&(this.initError=Fi,this.close()),Fi.throw()):_r.action==="failed"?Fi.throw():_r.action==="quit"?(this.initError=Fi,this.close(),Fi.throw()):(Vt===qE.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=$.message.option,Gi.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",h0.MULTI_IP)):this.reconnect(_r.action,h0.SERVER_ERROR),i===FE.JOIN||i===FE.REJOIN?null:await this.request(i,o)))}waitMessage(i,o){return new pE(p=>{const g=b=>{(!o||o(b))&&(this.off(i,g),p(b))};this.on(i,g)})}upload(i,o){const p={_type:i,_message:o};try{this.websocket.sendMessage(p)}catch{const b=nE("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(p),this.uploadCache.length>b&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==t_.CONNECTED)return;const A=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(A._type,A._message)},nE("UPLOAD_CACHE_INTERVAL")||2e3))}}send(i,o){const p={_type:i,_message:o};this.websocket.sendMessage(p)}init(i,o){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new pE((p,g)=>{this.once(kE.WS_CONNECTED,()=>p(this.joinResponse)),this.once(kE.WS_CLOSED,()=>g(this.initError||new hE(_p.WS_ABORT))),this.connectionState=t_.CONNECTING,this.websocket.init(i).catch(g),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(i){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=i||e_.LEAVE,this.connectionState=t_.CLOSED,Gi.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),i===e_.FALLBACK&&(this.websocket.removeAllListeners(),this.websocket=new HO("gateway-".concat(this.clientId),this.spec.retryConfig,!0,nE("JOIN_GATEWAY_USE_DUAL_DOMAIN"),nE("JOIN_GATEWAY_USE_443PORT_ONLY"),this.store),this.handleWebsocketEvents())}async join(){if(!this.joinResponse){this.emit(kE.ABORT_P2P_EXECUTION);const i=await U_(this,kE.REQUEST_JOIN_INFO),o=await this.request(FE.JOIN,i);if(!o)return this.emit(kE.REPORT_JOIN_GATEWAY,rI.TIMEOUT,this.url||""),!1;this.joinResponse=o,this.emit(kE.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=t_.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new hE(_p.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const i=JT(this,kE.REQUEST_REJOIN_INFO);i.token=this.reconnectToken;const o=await this.request(FE.REJOIN,i);return!!o&&(this.connectionState=t_.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),o.peers&&o.peers.forEach(p=>{this.emit(JE.ON_USER_ONLINE,{uid:p.uid}),p.audio&&this.emit(JE.ON_ADD_AUDIO_STREAM,{uid:p.uid,uint_id:p.uint_id,audio:!0,ssrcId:p.audio_ssrc}),p.video&&this.emit(JE.ON_ADD_VIDEO_STREAM,{uid:p.uid,uint_id:p.uint_id,video:!0,ssrcId:p.video_ssrc}),p.audio_mute?this.emit(JE.MUTE_AUDIO,{uid:p.uid}):this.emit(JE.UNMUTE_AUDIO,{uid:p.uid}),p.video_mute?this.emit(JE.MUTE_VIDEO,{uid:p.uid}):this.emit(JE.UNMUTE_VIDEO,{uid:p.uid}),p.audio_enable_local?this.emit(JE.ENABLE_LOCAL_AUDIO,{uid:p.uid}):this.emit(JE.DISABLE_LOCAL_AUDIO,{uid:p.uid}),p.video_enable_local?this.emit(JE.ENABLE_LOCAL_VIDEO,{uid:p.uid}):this.emit(JE.DISABLE_LOCAL_VIDEO,{uid:p.uid}),p.audio||p.video||this.emit(JE.ON_REMOVE_STREAM,{uid:p.uid,uint_id:p.uint_id})}),!0)}reconnect(i,o){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(i,o)}handleNotification(i){Gi.debug("[".concat(this.clientId,"] receive notification: "),i);const o=iI(i.code);if(o.action!=="success"){if(o.action!=="failed")return o.action==="quit"?(o.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(e_.UID_BANNED),void this.close()):void this.reconnect(o.action,h0.SERVER_ERROR);Gi.error("[".concat(this.clientId,"] ignore error: "),o.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const i=nE("PING_PONG_TIME_OUT"),o=Date.now();this.pingpongTimeoutCount>=i&&(Gi.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(o-this.lastMsgTime,"ms")),o-this.lastMsgTime>nE("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",h0.TIMEOUT):this.request(FE.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const p=Date.now()-o;this.rttRolling.add(p),nE("REPORT_STATS")&&this.send(FE.PING_BACK,{pingpongElapse:p})}).catch(p=>{})}handleWsInflateData(){const{wsInflateLength:i,wsDeflateLength:o}=this.websocket.getWsInflateData();i!==0&&o!==0&&this.upload(uS.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:o,ws_inflate_length:i})}handleWebsocketEvents(){this.websocket.on(zE.RECONNECT_WAITTING_FINISH,i=>{this.emit(kE.WS_RECONNECT_WAITTING_FINISH,i)}),this.websocket.on(zE.RECONNECT_CREATE_CONNECTION,i=>{this.emit(kE.WS_RECONNECT_CREATE_CONNECTION,i)}),this.websocket.on(zE.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(zE.CLOSED,()=>{this.connectionState=t_.CLOSED}),this.websocket.on(zE.FAILED,()=>{this._disconnectedReason=e_.NETWORK_ERROR,this.connectionState=t_.CLOSED}),this.websocket.on(zE.RECONNECTING,i=>{this._websocketReconnectReason=i,this.joinResponse=void 0,this.connectionState===t_.CONNECTED?this.connectionState=t_.RECONNECTING:this.connectionState=t_.CONNECTING}),this.websocket.on(zE.WILL_RECONNECT,(i,o,p)=>{const g=JT(this,kE.IS_P2P_DISCONNECTED),b=g||i!=="retry";g&&i==="retry"&&(Gi.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),i="tryNext",o=rI.P2P_DISCONNECTED),b&&(Gi.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(i)),this.emit(kE.REPORT_JOIN_GATEWAY,o||rI.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(kE.NEED_RENEW_SESSION),this.emit(kE.DISCONNECT_P2P)),p(i)}),this.websocket.on(zE.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(i=>{Gi.warning("[".concat(this.clientId,"] rejoin failed ").concat(i)),this.reconnect("tryNext",h0.SERVER_ERROR)}):this.join().catch(i=>{if(this.emit(kE.REPORT_JOIN_GATEWAY,i.message||i.code||rI.UNKNOWN_REASON,this.url||""),i instanceof hE&&i.code===_p.UNEXPECTED_RESPONSE&&i.data.code===qE.ERR_NO_AUTHORIZED)return Gi.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",h0.SERVER_ERROR);Gi.error("[".concat(this.clientId,"] join gateway request failed"),i.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",h0.SERVER_ERROR):(this.initError=i,this.close())})}),this.websocket.on(zE.REQUEST_NEW_URLS,(i,o)=>{U_(this,kE.REQUEST_RECOVER,this.multiIpOption).then(i).catch(o)}),this.websocket.on(zE.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(JE.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}var A6=`	
\v\f\r Â áš€â€€â€â€‚â€ƒâ€„â€…â€†â€‡â€ˆâ€‰â€Šâ€¯âŸã€€\u2028\u2029\uFEFF`,UZ=gO,FZ=WT,vM=A6,O6=C0("".replace),jZ=RegExp("^["+vM+"]+"),VZ=RegExp("(^|[^"+vM+"])["+vM+"]+$"),_M=function(l){return function(i){var o=FZ(UZ(i));return 1&l&&(o=O6(o,jZ,"")),2&l&&(o=O6(o,VZ,"$1")),o}},BZ={start:_M(1),end:_M(2),trim:_M(3)},GZ=qF.PROPER,qZ=t0,N6=A6,WZ=BZ.trim;Y_({target:"String",proto:!0,forced:function(l){return qZ(function(){return!!N6[l]()||"â€‹Â…á Ž"[l]()!=="â€‹Â…á Ž"||GZ&&N6[l].name!==l})}("trim")},{trim:function(){return WZ(this)}});var v0,_0,HZ=qR("String").trim,zZ=mT,KZ=HZ,yM=String.prototype,bM=LE(function(l){var i=l.trim;return typeof l=="string"||l===yM||zZ(yM,l)&&i===yM.trim?KZ:i});function XI(l,i,o){return{sampleRate:l,stereo:i,bitrate:o}}function i_(l,i,o,p,g){return{width:l,height:i,frameRate:o,bitrateMin:p,bitrateMax:g}}function aT(l,i,o,p,g){return{width:{max:l},height:{max:i},frameRate:o,bitrateMin:p,bitrateMax:g}}function SM(l,i){return{numSpatialLayers:l,numTemporalLayers:i}}(function(l){l[l.CHOOSE_SERVER=11]="CHOOSE_SERVER",l[l.CLOUD_PROXY=18]="CLOUD_PROXY",l[l.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",l[l.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK"})(v0||(v0={})),function(l){l.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",l.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",l.IOS_INTERRUPTION_START="ios-interruption-start",l.IOS_INTERRUPTION_END="ios-interruption-end",l.STATE_CHANGE="state-change"}(_0||(_0={}));const YZ={"90p":i_(160,90),"90p_1":i_(160,90),"120p":i_(160,120,15,30,65),"120p_1":i_(160,120,15,30,65),"120p_3":i_(120,120,15,30,50),"120p_4":i_(212,120),"180p":i_(320,180,15,30,140),"180p_1":i_(320,180,15,30,140),"180p_3":i_(180,180,15,30,100),"180p_4":i_(240,180,15,30,120),"240p":i_(320,240,15,40,200),"240p_1":i_(320,240,15,40,200),"240p_3":i_(240,240,15,40,140),"240p_4":i_(424,240,15,40,220),"360p":i_(640,360,15,80,400),"360p_1":i_(640,360,15,80,400),"360p_3":i_(360,360,15,80,260),"360p_4":i_(640,360,30,80,600),"360p_6":i_(360,360,30,80,400),"360p_7":i_(480,360,15,80,320),"360p_8":i_(480,360,30,80,490),"360p_9":i_(640,360,15,80,800),"360p_10":i_(640,360,24,80,800),"360p_11":i_(640,360,24,80,1e3),"480p":i_(640,480,15,100,500),"480p_1":i_(640,480,15,100,500),"480p_2":i_(640,480,30,100,1e3),"480p_3":i_(480,480,15,100,400),"480p_4":i_(640,480,30,100,750),"480p_6":i_(480,480,30,100,600),"480p_8":i_(848,480,15,100,610),"480p_9":i_(848,480,30,100,930),"480p_10":i_(640,480,10,100,400),"720p":i_(1280,720,15,120,1130),"720p_auto":i_(1280,720,30,900,3e3),"720p_1":i_(1280,720,15,120,1130),"720p_2":i_(1280,720,30,120,2e3),"720p_3":i_(1280,720,30,120,1710),"720p_5":i_(960,720,15,120,910),"720p_6":i_(960,720,30,120,1380),"1080p":i_(1920,1080,15,120,2080),"1080p_1":i_(1920,1080,15,120,2080),"1080p_2":i_(1920,1080,30,120,3e3),"1080p_3":i_(1920,1080,30,120,3150),"1080p_5":i_(1920,1080,60,120,4780),"1440p":i_(2560,1440,30,120,4850),"1440p_1":i_(2560,1440,30,120,4850),"1440p_2":i_(2560,1440,60,120,7350),"4k":i_(3840,2160,30,120,8910),"4k_1":i_(3840,2160,30,120,8910),"4k_3":i_(3840,2160,60,120,13500)},PN=[{scaleResolutionDownBy:2,width:1280,height:720,frameRate:30,bitrateMin:300,bitrateMax:900},{scaleResolutionDownBy:1.333333,width:1280,height:720,frameRate:30,bitrateMin:600,bitrateMax:2e3},{scaleResolutionDownBy:1,width:1280,height:720,frameRate:30,bitrateMin:900,bitrateMax:3e3}],JZ={"480p":aT(640,480,5),"480p_1":aT(640,480,5),"480p_2":aT(640,480,30),"480p_3":aT(640,480,15),"720p":aT(1280,720,5),"720p_auto":i_(1280,720,30,900,3e3),"720p_1":aT(1280,720,5),"720p_2":aT(1280,720,30),"720p_3":aT(1280,720,15),"1080p":aT(1920,1080,5),"1080p_1":aT(1920,1080,5),"1080p_2":aT(1920,1080,30),"1080p_3":aT(1920,1080,15)},XZ={"1SL1TL":SM(1,1),"3SL3TL":SM(3,3),"2SL3TL":SM(2,3)};function kT(l){return l||(l="480p_1"),typeof l=="string"?Object.assign({},YZ[l]):l}function TM(l){return typeof l=="string"?Object.assign({},JZ[l]):l}function kN(l){return typeof l=="string"?Object.assign({},XZ[l]):l}const QZ={speech_low_quality:XI(16e3,!1),speech_standard:XI(32e3,!1,18),music_standard:XI(48e3,!1),standard_stereo:XI(48e3,!0,56),high_quality:XI(48e3,!1,128),high_quality_stereo:XI(48e3,!0,192)};function DN(l){return typeof l=="string"?Object.assign({},QZ[l]):l}const QI=[];function P6(l){return d0(l,"mediaSource",["screen","window","application"]),!0}var xE,A_,ER,LN,CM,$I,vR,sI,lS,xN;(function(l){l.NEED_RENEGOTIATE="@need_renegotiate",l.NEED_REPLACE_TRACK="@need_replace_track",l.NEED_CLOSE="@need_close",l.NEED_ENABLE_TRACK="@need_enable_track",l.NEED_DISABLE_TRACK="@need_disable_track",l.NEED_SESSION_ID="@need_sid",l.SET_OPTIMIZATION_MODE="@set_optimization_mode",l.GET_STATS="@get_stats",l.GET_RTC_STATS="@get_rtc_stats",l.GET_LOW_VIDEO_TRACK="@get_low_video_track",l.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",l.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",l.NEED_MUTE_TRACK="@need_mute_track",l.NEED_UNMUTE_TRACK="@need_unmute_track"})(xE||(xE={})),function(l){l.SCREEN_TRACK="screen_track",l.CUSTOM_TRACK="custome_track",l.LOW_STREAM="low_stream"}(A_||(A_={})),function(l){l[l.HIGH_STREAM=0]="HIGH_STREAM",l[l.LOW_STREAM=1]="LOW_STREAM"}(ER||(ER={})),function(l){l[l.HIGH_STREAM=0]="HIGH_STREAM",l[l.LOW_STREAM=1]="LOW_STREAM"}(LN||(LN={})),function(l){l[l.DISABLE=0]="DISABLE",l[l.LOW_STREAM=1]="LOW_STREAM",l[l.AUDIO_ONLY=2]="AUDIO_ONLY"}(CM||(CM={})),function(l){l.TRANSCEIVER_UPDATED="transceiver-updated"}($I||($I={})),function(l){l.SOURCE_STATE_CHANGE="source-state-change",l.TRACK_ENDED="track-ended",l.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",l.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",l.CLOSED="closed"}(vR||(vR={})),function(l){l.FIRST_FRAME_DECODED="first-frame-decoded",l.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status"}(sI||(sI={})),function(l){l.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",l.RECEIVE_TRACK_BUFFER="receive_track_buffer",l.ON_AUDIO_BUFFER="on_audio_buffer",l.UPDATE_SOURCE="update_source"}(lS||(lS={})),function(l){l.UPDATE_TRACK_SOURCE="update-track-source"}(xN||(xN={}));const RM={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},IM={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},k6={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},$Z={uplinkNetworkQuality:0,downlinkNetworkQuality:0},D6={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};var V0,dS,oI,XT,B0;(function(l){l.ON_TRACK="on_track",l.ON_NODE="on_node"})(V0||(V0={})),function(l){l.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",l.REQUEST_CONSTRAINTS="request_constraints"}(dS||(dS={})),function(l){l.IDLE="IDLE",l.INITING="INITING",l.INITEND="INITEND"}(oI||(oI={})),function(l){l.STATE_CHANGE="state_change",l.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",l.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",l.CAMERA_DEVICE_CHANGED="cameraDeviceChanged"}(XT||(XT={})),function(l){l.NONE="none",l.INIT="init",l.CANPLAY="canplay",l.PLAYING="playing",l.PAUSED="paused",l.SUSPEND="suspend",l.STALLED="stalled",l.WAITING="waiting",l.ERROR="error",l.DESTROYED="destroyed",l.ABORT="abort",l.ENDED="ended",l.EMPTIED="emptied",l.LOADEDDATA="loadeddata"}(B0||(B0={}));const wM={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};var ZI;(function(l){l.OPEN="open",l.MESSAGE="message",l.CLOSE="close",l.CLOSING="closing",l.ERROR="error"})(ZI||(ZI={}));class L6 extends D_{constructor(i,o){super(),_e(this,"_ID",void 0),_e(this,"_rtpTransceiver",void 0),_e(this,"_lowRtpTransceiver",void 0),_e(this,"_hints",[]),_e(this,"_isClosed",!1),_e(this,"_originMediaStreamTrack",void 0),_e(this,"_mediaStreamTrack",void 0),_e(this,"_external",{}),this._ID=o||T_(8,"track-"),this._originMediaStreamTrack=i,this._mediaStreamTrack=i,function(p){VE(QI).call(QI,p)||QI.push(p)}(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(i){if(!i){const o=jE.reportApiInvoke(null,{name:e0.GET_MEDIA_STREAM_TRACK,options:[],tag:x_.TRACER});this._mediaStreamTrack&&typeof this._mediaStreamTrack.label=="string"?o.onSuccess(this._mediaStreamTrack.label):o.onSuccess("")}return this._mediaStreamTrack}getRTCRtpTransceiver(i){return i===ER.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(i){const o=QI.indexOf(i);o!==-1&&QI.splice(o,1)}(this),this.emit(vR.CLOSED)}_updateRtpTransceiver(i,o){if(o===ER.LOW_STREAM){if(this._lowRtpTransceiver===i)return;this._lowRtpTransceiver=i}else{if(this._rtpTransceiver===i)return;this._rtpTransceiver=i}this.emit($I.TRANSCEIVER_UPDATED,i,o)}}class P0 extends L6{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}set processorContext(i){this._processorContext=i}constructor(i,o){super(i,o),_e(this,"_enabled",!0),_e(this,"_muted",!1),_e(this,"_isExternalTrack",!1),_e(this,"_isClosed",!1),_e(this,"_enabledMutex",void 0),_e(this,"processor",void 0),_e(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new E0("".concat(this.getTrackId())),i.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var i,o;return(i=(o=this._originMediaStreamTrack)===null||o===void 0?void 0:o.label)!==null&&i!==void 0?i:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,Gi.debug("[".concat(this.getTrackId(),"] close")),this.emit(xE.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(i,o){let p=arguments.length>2&&arguments[2]!==void 0&&arguments[2];this._isExternalTrack=p,i!==this._originMediaStreamTrack&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),o&&this._originMediaStreamTrack.stop()),i.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=i,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await S_(this,xE.NEED_REPLACE_TRACK,this),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){Gi.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(vR.TRACK_ENDED)}stateCheck(i,o){if(Gi.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(i,": ").concat(o,"]")),XR(o,i),this._enabled&&this._muted&&i==="enabled"&&o===!1)throw new yE(_p.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",Gi);if(!this._enabled&&!this._muted&&i==="muted"&&o===!0)throw new yE(_p.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",Gi)}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}function x6(l,i){var o=Object.keys(l);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(l);i&&(p=p.filter(function(g){return Object.getOwnPropertyDescriptor(l,g).enumerable})),o.push.apply(o,p)}return o}const M6=window.AudioContext||window.webkitAudioContext;let PS=null;const __=new class extends D_{constructor(){super(...arguments),_e(this,"prevState",void 0),_e(this,"curState",void 0),_e(this,"currentTime",void 0),_e(this,"currentTimeStuckAt",void 0),_e(this,"interruptDetectorTrack",void 0),_e(this,"onLocalAudioTrackMute",()=>{Gi.info("ios15-interruption-start"),this.emit(_0.IOS_15_16_INTERRUPTION_START)}),_e(this,"onLocalAudioTrackUnmute",async()=>{Gi.info("ios15-interruption-end"),this.curState!=="running"||this.duringInterruption?Gi.info("ios15-interruption-end-canceled"):(PS&&await PS.suspend(),this.emit(_0.IOS_15_16_INTERRUPTION_END))})}get duringInterruption(){return this.prevState==="running"&&this.curState==="interrupted"}bindInterruptDetectorTrack(l){Gi.debug("webaudio bindInterruptDetectorTrack ".concat(l.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=l,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(l){Gi.debug("webaudio unbindInterruptDetectorTrack ".concat(l.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===l&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function ZZ(){if(!M6)return void Gi.error("your browser is not support web audio");Gi.info("create audio context");const l=function(i){for(var o=1;o<arguments.length;o++){var p=arguments[o]!=null?arguments[o]:{};o%2?x6(Object(p),!0).forEach(function(g){_e(i,g,p[g])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(p)):x6(Object(p)).forEach(function(g){Object.defineProperty(i,g,Object.getOwnPropertyDescriptor(p,g))})}return i}({},nE("WEBAUDIO_INIT_OPTIONS"));Gi.debug("audio context init option:",JSON.stringify(l)),PS=new M6(l),__.curState=PS.state,PS.onstatechange=()=>{__.prevState=__.curState,__.curState=PS?PS.state:void 0;const{prevState:i,curState:o}=__,p=o==="running",g=o==="interrupted",b=i==="running",A=i==="suspended",j=i==="interrupted",H=l_().osVersion;(z0()||wT())&&b&&g&&(Gi.info("ios".concat(H,"-interruption-start")),__.emit(_0.IOS_INTERRUPTION_START)),(z0()||wT())&&(A||j)&&p&&(Gi.info("ios".concat(H,"-interruption-end")),__.emit(_0.IOS_INTERRUPTION_END)),i!==o&&(Gi.debug("AudioContext State Change","".concat(i,"=>").concat(o)),__.emit(_0.STATE_CHANGE))},setInterval(()=>{var i;const o=(i=PS)===null||i===void 0?void 0:i.currentTime;__.currentTime!==o?(__.currentTimeStuckAt&&(Gi.debug("AudioContext current time resume at ".concat(o)),__.currentTimeStuckAt=void 0),__.currentTime=o):(o!==__.currentTimeStuckAt&&(jE.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:o},tag:x_.TRACER}).onSuccess(),Gi.warning("AudioContext current time stuck at ".concat(o))),__.currentTimeStuckAt=o)},5e3),async function(i){const o=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];let p,g=!1,b=!1,A=!1;function j(_h){i.state==="running"?H(!1):z0()||wT()?i.state==="suspended"&&(H(!0),_h&&i.resume().then($,$)):i.state!=="closed"&&(H(!0),_h&&i.resume().then($,$))}function H(_h){if(g!==_h){g=_h;for(let _g=0,eE=o;_g<eE.length;_g+=1){const oE=eE[_g];_h?window.addEventListener(oE,Vt,{capture:!0,passive:!0}):window.removeEventListener(oE,Vt,{capture:!0,passive:!0})}}}function z(){j(!0)}function $(){j(!1)}function Vt(){j(!0)}function _r(_h){if(!A)if(p.paused)if(_h){let _g;Fi(!1),A=!0;try{_g=p.play(),_g?_g.then(_l,_l):(p.addEventListener("playing",_l),p.addEventListener("abort",_l),p.addEventListener("error",_l))}catch{_l()}}else Fi(!0);else Fi(!1)}function Fi(_h){if(b!==_h){b=_h;for(let _g=0,eE=o;_g<eE.length;_g++){const oE=eE[_g];_h?window.addEventListener(oE,_u,{capture:!0,passive:!0}):window.removeEventListener(oE,_u,{capture:!0,passive:!0})}}}function _l(){p.removeEventListener("playing",_l),p.removeEventListener("abort",_l),p.removeEventListener("error",_l),A=!1,_r(!1)}function _u(){_r(!0)}if(z0()){const _h=i.createMediaStreamDestination(),_g=document.createElement("div");_g.innerHTML="<audio x-webkit-airplay='deny'></audio>",p=_g.children.item(0),p.controls=!1,p.disableRemotePlayback=!0,p.preload="auto",p.srcObject=_h.stream,_r(!0)}__.on(_0.STATE_CHANGE,z),j(!1)}(PS)}function _w(){if(!PS){if(ZZ(),!PS)throw new yE(_p.NOT_SUPPORTED,"can not create audio context");return PS}return PS}function U6(){return!!PS}function aI(l){if(function(){if(AM!==null)return AM;const p=_w(),g=p.createBufferSource(),b=p.createGain(),A=p.createGain();g.connect(b),g.connect(A),g.disconnect(b);let j=!1;try{g.disconnect(b)}catch{j=!0}return g.disconnect(),AM=j,j}())return;const i=l.connect,o=l.disconnect;l.connect=(p,g,b)=>{var A;return l._inputNodes||(l._inputNodes=[]),VE(A=l._inputNodes).call(A,p)||(p instanceof AudioNode?(l._inputNodes.push(p),i.call(l,p,g,b)):i.call(l,p,g)),l},l.disconnect=(p,g,b)=>{o.call(l),p?VL(l._inputNodes,p):l._inputNodes=[];for(const A of l._inputNodes)i.call(l,A)}}let AM=null;function OM(l,i){let o=!1;const p=1/i;if(nE("DISABLE_WEBAUDIO")){const g=window.setInterval(()=>{o?window.clearInterval(g):l(performance.now()/1e3)},1e3*p)}else{const g=_w();let b=g.createGain();b.gain.value=0,b.connect(g.destination);const A=()=>{if(o)return void(b=null);const j=g.createOscillator();j.onended=A,j.connect(b),j.start(0),j.stop(g.currentTime+p),l(g.currentTime)};A()}return()=>{o=!0}}const G0={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1};function I_(){return G0}class F6{constructor(){_e(this,"context",void 0),_e(this,"analyserNode",void 0),_e(this,"sourceNode",void 0),this.context=_w(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(i){if(i!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=i,i==null||i.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||z0()||wT()||this.context.state!=="running"&&this.context.resume(),!this.analyserNode))return 0;const i=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(i);else{const p=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(p);for(let g=0;g<i.length;++g)i[g]=p[g]/128-1}const o=ZR(i).call(i,(p,g)=>p+g*g,0)/i.length;return Math.max(10*Math.log10(o)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var i,o;(i=this.sourceNode)===null||i===void 0||i.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,(o=this.sourceNode)===null||o===void 0||o.connect(this.analyserNode)}catch{Gi.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class j6 extends D_{get processSourceNode(){return this.sourceNode}set processedNode(i){var o;if(!this.isDestroyed&&this._processedNode!==i){try{var p;(p=this.sourceNode)===null||p===void 0||p.disconnect(this.outputNode)}catch{}(o=this._processedNode)===null||o===void 0||o.disconnect(),this._processedNode=i,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),_e(this,"outputNode",void 0),_e(this,"outputTrack",void 0),_e(this,"isPlayed",!1),_e(this,"context",void 0),_e(this,"audioBufferNode",void 0),_e(this,"destNode",void 0),_e(this,"audioOutputLevel",0),_e(this,"volumeLevelAnalyser",void 0),_e(this,"_processedNode",void 0),_e(this,"playNode",void 0),_e(this,"isDestroyed",!1),_e(this,"onNoAudioInput",void 0),_e(this,"isNoAudioInput",!1),_e(this,"_noAudioInputCount",0),this.context=_w(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),aI(this.outputNode),this.volumeLevelAnalyser=new F6}startGetAudioBuffer(i){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(i),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=o=>{this.emit(lS.ON_AUDIO_BUFFER,function(p){for(let g=0;g<p.outputBuffer.numberOfChannels;g+=1){const b=p.outputBuffer.getChannelData(g);for(let A=0;A<b.length;A+=1)b[A]=0}return p.inputBuffer}(o))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!I_().webAudioMediaStreamDest)throw new yE(_p.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(i){this.context.state!=="running"&&sT(()=>{__.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=i||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(i>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;z0()||wT()?this.context.state==="suspended"&&this.context.resume():this.context.state!=="running"&&this.context.resume();const o=this.volumeLevelAnalyser.getAnalyserNode();let p;o.getFloatTimeDomainData?(p=new Float32Array(o.fftSize),o.getFloatTimeDomainData(p)):(p=new Uint8Array(o.fftSize),o.getByteTimeDomainData(p));let g=!1;for(let b=0;b<p.length;b++)p[b]!==0&&(g=!0);return g?(this.isNoAudioInput=!1,!0):(await w0(200),await this.checkHasAudioInput(i?i+1:1)&&g)}getAudioVolume(){return this.outputNode.gain.value}setVolume(i){this.outputNode.gain.setValueAtTime(i,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var i,o;(i=this.processedNode)===null||i===void 0||i.disconnect(),(o=this.sourceNode)===null||o===void 0||o.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var i;this.processedNode?(i=this.processedNode)===null||i===void 0||i.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class NM extends j6{get isFreeze(){return!1}constructor(i,o,p){var g;if(super(),_e(this,"sourceNode",void 0),_e(this,"track",void 0),_e(this,"clonedTrack",void 0),_e(this,"audioElement",void 0),_e(this,"isCurrentTrackCloned",!1),_e(this,"isRemoteTrack",!1),_e(this,"originVolumeLevelAnalyser",void 0),_e(this,"rebuildWebAudio",async()=>{if(Gi.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void Gi.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then(()=>Gi.info("resume success")),Gi.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();const j=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?j.stop():this.isCurrentTrackCloned=!0;const H=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(H),aI(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();const z=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(z,this.context.currentTime),aI(this.outputNode),this.emit(lS.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=H,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()}),i.kind!=="audio")throw new yE(_p.UNEXPECTED_ERROR);this.track=i;const b=new MediaStream([this.track]);if(this.isRemoteTrack=!!o,this.sourceNode=this.context.createMediaStreamSource(b),aI(this.sourceNode),p){const j=p.clone();j.enabled=!0,this.clonedTrack=j,Gi.debug("create an unmuted track ".concat(j.id," from the original track ").concat(p.id," to get the volume"));const H=this.context.createMediaStreamSource(new MediaStream([j]));aI(H),this.originVolumeLevelAnalyser=new F6,this.originVolumeLevelAnalyser.updateSource(H)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=b;const A=l_();o&&A.os===l0.IOS&&Number((g=A.osVersion)===null||g===void 0?void 0:g.split(".")[0])<15&&(__.on(_0.STATE_CHANGE,()=>{this.context.state==="suspended"?document.body.addEventListener("click",this.rebuildWebAudio,!0):this.context.state==="running"&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(j=>{j||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(i){this.sourceNode.disconnect(),this.track=i,this.isCurrentTrackCloned=!1;const o=new MediaStream([i]);this.sourceNode=this.context.createMediaStreamSource(o),aI(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(lS.UPDATE_SOURCE),this.audioElement.srcObject=o}destroy(){var i;this.audioElement.srcObject=null,this.audioElement.remove(),__.off("state-change",this.rebuildWebAudio),(i=this.originVolumeLevelAnalyser)===null||i===void 0||i.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(i){return this.context.createMediaStreamSource(new MediaStream([i]))}updateOriginTrack(i){const o=i.clone();o.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=o),Gi.debug("create an unmuted track ".concat(o.id," from the original track ").concat(i.id," to get the volume"));const p=this.context.createMediaStreamSource(new MediaStream([o]));aI(p),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(p)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}async function V6(l,i,o){const p=(b,A)=>b?typeof b!="number"?b.max||b.exact||b.ideal||b.min||A:b:A,g={audio:!!o&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:l,maxHeight:p(i.height,1080),maxWidth:p(i.width,1920)}}};return i.frameRate&&typeof i.frameRate!="number"?(g.video.mandatory.maxFrameRate=i.frameRate.max,g.video.mandatory.minFrameRate=i.frameRate.min):typeof i.frameRate=="number"&&(g.video.mandatory.maxFrameRate=i.frameRate),await navigator.mediaDevices.getUserMedia(g)}async function ttt(l,i){const o=await B6(l.mediaSource),{sourceId:p,audio:g}=await function(b){let A=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return new pE((j,H)=>{const z=document.createElement("div");z.innerText="share screen",z.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const $=document.createElement("div");$.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const Vt=document.createElement("div");Vt.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",Vt.setAttribute("style","height: 12%;");const _r=document.createElement("div");_r.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const Fi=document.createElement("div");Fi.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");const _l=document.createElement("button");_l.innerHTML="cancel",_l.setAttribute("style","width: 85px;"),_l.onclick=()=>{document.body.removeChild(_g);const eE=new Error("NotAllowedError");eE.name="NotAllowedError",H(eE)};let _u=A;const _h=document.createElement("div");if(A){const eE=document.createElement("input");eE.setAttribute("type","checkbox");const oE=document.createElement("span");eE.setAttribute("style","margin-right: 6px;"),oE.innerText="Share audio",eE.checked=_u,eE.onchange=()=>{_u=eE.checked},_h.appendChild(eE),_h.appendChild(oE)}Fi.appendChild(_h),Fi.appendChild(_l),$.appendChild(Vt),$.appendChild(_r),$.appendChild(Fi);const _g=document.createElement("div");_g.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),_g.appendChild(z),_g.appendChild($),document.body.appendChild(_g),b.map(eE=>{if(eE.id){const oE=document.createElement("div");oE.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let SE=eE.thumbnail;try{const{width:vE}=SE.getSize();vE>1920&&(SE=SE.resize({width:1920}))}catch(vE){throw vE&&vE.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),vE}oE.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+SE.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+eE.name.replace(/[\u00A0-\u9999<>\&]/g,function(vE){return"&#"+vE.charCodeAt(0)+";"})+"</span>",oE.onclick=()=>{document.body.removeChild(_g),j({sourceId:eE.id,audio:_u})},_r.appendChild(oE)}})})}(o,i);return await V6(p,l,g)}async function B6(l){let i=["window","screen"];l!=="application"&&l!=="window"||(i=["window"]),l==="screen"&&(i=["screen"]);const o=QV();if(!o)throw console.error("failed to fetch electron, please mount it to window"),new yE(_p.ELECTRON_IS_NULL);let p=null;try{var g;p=((g=o.desktopCapturer)===null||g===void 0?void 0:g.getSources({types:i}))||o.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:i})}catch{p=null}p&&p.then||(p=new pE((b,A)=>{o.desktopCapturer.getSources({types:i},(j,H)=>{j?A(j):b(H)})}));try{return await p}catch(b){throw new yE(_p.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,b.toString())}}function G6(l,i){var o=Object.keys(l);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(l);i&&(p=p.filter(function(g){return Object.getOwnPropertyDescriptor(l,g).enumerable})),o.push.apply(o,p)}return o}const PM=new E0("safari");let q6=!1,W6=!1;async function kS(l,i){let o=0,p=null;for(;o<2;)try{p=await ett(l,i,o>0);break}catch(g){if(g instanceof yE)throw Gi.error("[".concat(i,"] ").concat(g.toString())),g;const b=MN(g.name||g.code||g,g.message);if(b.code===_p.MEDIA_OPTION_INVALID){Gi.debug("[".concat(i,"] detect media option invalid, retry")),o+=1,await w0(500);continue}throw Gi.error("[".concat(i,"] ").concat(b.toString())),b}if(!p)throw new yE(_p.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return p}async function ett(l,i,o){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new yE(_p.NOT_SUPPORTED,"can not find getUserMedia");o&&(l.video&&(delete l.video.width,delete l.video.height),l.screen&&(delete l.screen.width,delete l.screen.height));const p=I_(),g=new MediaStream;if(l.audioSource&&g.addTrack(l.audioSource),l.videoSource&&g.addTrack(l.videoSource),!l.audio&&!l.video&&!l.screen)return Gi.debug("Using Video Source/ Audio Source"),g;if(l.screen)if(QV())l.screen.sourceId?_A(g,await V6(l.screen.sourceId,l.screen,l.screenAudio)):_A(g,await ttt(l.screen,l.screenAudio));else if(LL()&&l.screen.extensionId&&l.screen.mandatory){if(!p.getStreamFromExtension)throw new yE(_p.NOT_SUPPORTED,"This browser does not support screen sharing");Gi.debug("[".concat(i,'] Screen access on chrome stable, looking for extension"'));const _r=await(A=l.screen.extensionId,j=i,new pE((Fi,_l)=>{try{chrome.runtime.sendMessage(A,{getStream:!0},_u=>{if(!_u||!_u.streamId)return Gi.error("[".concat(j,"] No response from Chrome Plugin. Plugin not installed properly"),_u),void _l(new yE(_p.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));Fi(_u.streamId)})}catch(_u){Gi.error("[".concat(j,"] AgoraRTC screensharing plugin is not accessible(").concat(A,")"),_u.toString()),_l(new yE(_p.CHROME_PLUGIN_NOT_INSTALL))}}));l.screen.mandatory.chromeMediaSourceId=_r,_A(g,await navigator.mediaDevices.getUserMedia({video:{mandatory:l.screen.mandatory}}))}else if(p.getDisplayMedia){var b;l.screen.mediaSource&&P6(l.screen.mediaSource);const _r={width:l.screen.width,height:l.screen.height,frameRate:l.screen.frameRate,displaySurface:(b=l.screen.displaySurface)!==null&&b!==void 0?b:l.screen.mediaSource==="screen"?"monitor":l.screen.mediaSource},{selfBrowserSurface:Fi,surfaceSwitching:_l,systemAudio:_u}=l.screen,_h={selfBrowserSurface:Fi,surfaceSwitching:_l,systemAudio:_u};!Fi&&delete _h.selfBrowserSurface,!_l&&delete _h.surfaceSwitching,!_u&&delete _h.systemAudio,Gi.debug("[".concat(i,"] getDisplayMedia:"),JSON.stringify({video:_r,audio:!!l.screenAudio,controls:_h}));const _g=await navigator.mediaDevices.getDisplayMedia(function(eE){for(var oE=1;oE<arguments.length;oE++){var SE=arguments[oE]!=null?arguments[oE]:{};oE%2?G6(Object(SE),!0).forEach(function(vE){_e(eE,vE,SE[vE])}):Object.getOwnPropertyDescriptors?Object.defineProperties(eE,Object.getOwnPropertyDescriptors(SE)):G6(Object(SE)).forEach(function(vE){Object.defineProperty(eE,vE,Object.getOwnPropertyDescriptor(SE,vE))})}return eE}({video:_r,audio:!!l.screenAudio},_h));_A(g,_g)}else{if(!N_())throw Gi.error("[".concat(i,"] This browser does not support screenSharing")),new yE(_p.NOT_SUPPORTED,"This browser does not support screen sharing");{l.screen.mediaSource&&P6(l.screen.mediaSource);const _r={video:{mediaSource:l.screen.mediaSource,width:l.screen.width,height:l.screen.height,frameRate:l.screen.frameRate}};Gi.debug("[".concat(i,"] getUserMedia: ").concat(JSON.stringify(_r))),_A(g,await navigator.mediaDevices.getUserMedia(_r))}}var A,j;if(!l.video&&!l.audio)return g;let H={video:l.video,audio:l.audio},z=nE("MEDIA_DEVICE_CONSTRAINTS");if(z)try{typeof z=="string"&&(z=JSON.parse(z)),H=GL(H,z)}catch{}Gi.debug("[".concat(i,"] GetUserMedia"),JSON.stringify(H)),l_();let $,Vt=null;(H0()||z0()||cN())&&(Vt=await PM.lock());try{$=await navigator.mediaDevices.getUserMedia(H)}catch(_r){throw Vt&&Vt(),_r}return H.audio&&(q6=!0),H.video&&(W6=!0),_A(g,$),Vt&&Vt(),g}function MN(l,i){switch(l){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new yE(_p.MEDIA_OPTION_INVALID,"".concat(l,": ").concat(i));case"NotFoundError":case"DevicesNotFoundError":return new yE(_p.DEVICE_NOT_FOUND,"".concat(l,": ").concat(i));case"NotSupportedError":return new yE(_p.NOT_SUPPORTED,"".concat(l,": ").concat(i));case"NotReadableError":return new yE(_p.NOT_READABLE,"".concat(l,": ").concat(i));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new yE(_p.PERMISSION_DENIED,"".concat(l,": ").concat(i));case"ConstraintNotSatisfiedError":return new yE(_p.CONSTRAINT_NOT_SATISFIED,"".concat(l,": ").concat(i));default:return Gi.error("getUserMedia unexpected error",l),new yE(_p.UNEXPECTED_ERROR,"".concat(l,": ").concat(i))}}function _A(l,i){const o=l.getVideoTracks()[0],p=l.getAudioTracks()[0],g=i.getVideoTracks()[0],b=i.getAudioTracks()[0];b&&(p&&l.removeTrack(p),l.addTrack(b)),g&&(o&&l.removeTrack(o),l.addTrack(g))}const DS=new class extends D_{get state(){return this._state}set state(l){l!==this._state&&(this.emit(XT.STATE_CHANGE,l),this._state=l)}constructor(){super(),_e(this,"_state",oI.IDLE),_e(this,"isAccessMicrophonePermission",!1),_e(this,"isAccessCameraPermission",!1),_e(this,"lastAccessMicrophonePermission",!1),_e(this,"lastAccessCameraPermission",!1),_e(this,"checkdeviceMatched",!1),_e(this,"deviceInfoMap",new Map),this.init().then(()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{(nE("ENUMERATE_DEVICES_INTERVAL")||(uN()||aN()===l0.HARMONY_OS)&&lR())&&this.updateDevicesInfo()},nE("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(l=>Gi.error(l.toString()))}async enumerateDevices(l,i){let o=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new yE(_p.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();const p=await navigator.mediaDevices.enumerateDevices(),g=this.checkMediaDeviceInfoIsOk(p);let b=!this.isAccessMicrophonePermission&&l,A=!this.isAccessCameraPermission&&i;g.audio&&(b=!1),g.video&&(A=!1);let j=null,H=null,z=null;if(!o&&(b||A)){if(PM.isLocked&&(Gi.debug("[device manager] wait GUM lock"),(await PM.lock())(),Gi.debug("[device manager] GUM unlock")),q6&&(b=!1,this.isAccessMicrophonePermission=!0),W6&&(A=!1,this.isAccessCameraPermission=!0),Gi.debug("[device manager] check media device permissions",l,i,b,A),b&&A){try{z=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch($){const Vt=MN($.name||$.code||$,$.message);if(Vt.code===_p.PERMISSION_DENIED)throw Vt;Gi.warning("getUserMedia failed in getDevices",Vt)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(b){try{j=await navigator.mediaDevices.getUserMedia({audio:l})}catch($){const Vt=MN($.name||$.code||$,$.message);if(Vt.code===_p.PERMISSION_DENIED)throw Vt;Gi.warning("getUserMedia failed in getDevices",Vt)}this.isAccessMicrophonePermission=!0}else if(A){try{H=await navigator.mediaDevices.getUserMedia({video:i})}catch($){const Vt=MN($.name||$.code||$,$.message);if(Vt.code===_p.PERMISSION_DENIED)throw Vt;Gi.warning("getUserMedia failed in getDevices",Vt)}this.isAccessCameraPermission=!0}Gi.debug("[device manager] mic permission",l,"cam permission",i)}try{const $=await navigator.mediaDevices.enumerateDevices();return j&&j.getTracks().forEach(Vt=>Vt.stop()),H&&H.getTracks().forEach(Vt=>Vt.stop()),z&&z.getTracks().forEach(Vt=>Vt.stop()),j=null,H=null,z=null,$}catch($){return j&&j.getTracks().forEach(Vt=>Vt.stop()),H&&H.getTracks().forEach(Vt=>Vt.stop()),z&&z.getTracks().forEach(Vt=>Vt.stop()),j=null,H=null,z=null,new yE(_p.ENUMERATE_DEVICES_FAILED,$.toString()).throw()}}async getRecordingDevices(){let l=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,l)).filter(i=>i.kind==="audioinput")}async getCamerasDevices(){let l=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!1,!0,l)).filter(i=>i.kind==="videoinput")}async getSpeakers(){let l=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,l)).filter(i=>i.kind==="audiooutput")}searchDeviceIdByName(l){let i=null;return this.deviceInfoMap.forEach(o=>{o.device.label===l&&(i=o.device.deviceId)}),i}async getDeviceById(l){const i=(await this.enumerateDevices(!0,!0,!0)).find(o=>o.deviceId===l);if(!i)throw new yE(_p.DEVICE_NOT_FOUND,"deviceId: ".concat(l));return i}async init(){this.state=oI.INITING;try{await this.updateDevicesInfo(),this.state=oI.INITEND}catch(l){throw Gi.warning("Device Detection functionality cannot start properly.",l.toString()),this.state=oI.IDLE,!(typeof isSecureContext=="boolean"?isSecureContext:location.protocol==="https:"||location.protocol==="file:"||location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="::1")&&new yE(_p.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),l}}async updateDevicesInfo(){const l=await this.enumerateDevices(!0,!0,!0),i=Date.now(),o=[];if(l[0]&&l[0].label&&this.checkdeviceMatched===!1){this.checkdeviceMatched=!0;const g=l.find(A=>A.kind==="audioinput"&&A.deviceId==="default"),b=l.find(A=>A.kind==="audiooutput"&&A.deviceId==="default");g&&b?b.groupId===g.groupId?Gi.debug("[device-check] default input ".concat(g.label," and output ").concat(b.label," is the same group")):Gi.warning("[device-check] default input ".concat(g.label," and output ").concat(b.label," is not the same group")):Gi.debug("[device-check] default input or output not found")}const p=this.checkMediaDeviceInfoIsOk(l);if(l.forEach(g=>{if(!g.deviceId)return;const b=this.deviceInfoMap.get("".concat(g.kind,"_").concat(g.deviceId));if((b?b.state:"INACTIVE")!=="ACTIVE"){const A={initAt:i,updateAt:i,device:g,state:"ACTIVE"};this.deviceInfoMap.set("".concat(g.kind,"_").concat(g.deviceId),A),o.push(A)}b&&(b.updateAt=i)}),this.deviceInfoMap.forEach((g,b)=>{g.state==="ACTIVE"&&g.updateAt!==i&&(g.state="INACTIVE",o.push(g))}),this.state!==oI.INITEND)return p.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(p.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));o.forEach(g=>{switch(g.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(XT.RECORDING_DEVICE_CHANGED,g);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(XT.CAMERA_DEVICE_CHANGED,g);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(XT.PLAYOUT_DEVICE_CHANGED,g)}}),p.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),p.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(l){const i=l.filter(g=>g.kind==="audioinput"),o=l.filter(g=>g.kind==="videoinput"),p={audio:!1,video:!1};for(const g of i)if(g.label&&g.deviceId){p.audio=!0;break}for(const g of o)if(g.label&&g.deviceId){p.video=!0;break}return p}};let kM=!1;const LS=new class extends D_{constructor(){super(...arguments),_e(this,"onAutoplayFailed",void 0),_e(this,"onAudioAutoplayFailed",void 0)}};function H6(){if(l_(),!kM){const l=i=>{i.preventDefault(),kM=!1,FO()?document.body.removeEventListener("click",l,!0):(document.body.removeEventListener("touchstart",l,!0),document.body.removeEventListener("mousedown",l,!0))};kM=!0,FO()?document.body.addEventListener("click",l,!0):(document.body.addEventListener("touchstart",l,!0),document.body.addEventListener("mousedown",l,!0)),Gi.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),LS.onAutoplayFailed?LS.onAutoplayFailed():LS.onAudioAutoplayFailed?Gi.warning(`AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.

  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`):Gi.warning(`We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.

  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.

  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`),LS.emit("autoplay-failed")}}function z6(l,i){var o=Object.keys(l);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(l);i&&(p=p.filter(function(g){return Object.getOwnPropertyDescriptor(l,g).enumerable})),o.push.apply(o,p)}return o}function K6(l){for(var i=1;i<arguments.length;i++){var o=arguments[i]!=null?arguments[i]:{};i%2?z6(Object(o),!0).forEach(function(p){_e(l,p,o[p])}):Object.getOwnPropertyDescriptors?Object.defineProperties(l,Object.getOwnPropertyDescriptors(o)):z6(Object(o)).forEach(function(p){Object.defineProperty(l,p,Object.getOwnPropertyDescriptor(o,p))})}return l}function Y6(l,i,o,p){if(!l)return;const g=jE.getBaseInfoBySessionId(l);if(!g)return;const b=g.info,A=Date.now(),j=K6(K6({},b),{},{vid:b.vid===void 0?0:Number(b.vid),lts:A,elapse:A-g.startTime,cbRegistered:LS.onAutoplayFailed||LS.onAudioAutoplayFailed?1:-1,errorMsg:o,mediaType:i,trackId:p,extend:void 0});jE.send({type:L_.AUTOPLAY_FAILED,data:j},!0)}const ntt=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],vS=new class{constructor(){_e(this,"onAutoplayFailed",void 0),_e(this,"elementMap",new Map),_e(this,"elementStateMap",new Map),_e(this,"elementsNeedToResume",[]),_e(this,"sinkIdMap",new Map),_e(this,"autoResumeAfterInterruption",()=>{Array.from(this.elementMap.entries()).forEach(l=>{let[i,o]=l;const p=this.elementStateMap.get(i),g=o.srcObject.getAudioTracks()[0];FI()?g&&g.readyState==="live"&&__.curState==="running"&&(Gi.debug("auto resume after interruption for iOS 15"),o.pause(),o.play()):p&&p==="paused"&&g&&g.readyState==="live"&&__.curState==="running"&&(Gi.debug("auto resume after interruption for iOS"),o.play())})}),_e(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{Array.from(this.elementMap.entries()).forEach(l=>{let[i,o]=l;const p=o.srcObject.getAudioTracks()[0];p&&p.readyState==="live"&&(Gi.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),o.pause(),o.play())})}),this.autoResumeAudioElement(),__.on(_0.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),__.on(_0.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),__.on(_0.STATE_CHANGE,()=>{z0()&&__.prevState==="suspended"&&__.curState==="running"&&this.autoResumeAfterInterruption()})}async setSinkID(l,i){const o=this.elementMap.get(l);if(this.sinkIdMap.set(l,i),o)try{await o.setSinkId(i)}catch(p){throw new yE(_p.PERMISSION_DENIED,"can not set sink id: "+p.toString())}}play(l,i,o,p){if(this.elementMap.has(i))return;const g=document.createElement("audio");g.autoplay=!0,g.srcObject=new MediaStream([l]),this.bindAudioElementEvents(i,g),this.elementMap.set(i,g),this.elementStateMap.set(i,B0.INIT),this.setVolume(i,o);const b=this.sinkIdMap.get(i);if(b)try{g.setSinkId(b).catch(j=>{Gi.warning("[".concat(i,"] set sink id failed"),j.toString())})}catch(j){Gi.warning("[".concat(i,"] set sink id failed"),j.toString())}const A=g.play();A&&A.then&&A.catch(j=>{p&&Y6(p,"audio",j.message,i),Gi.warning("audio element play warning",j.toString()),this.elementMap.has(i)&&j.name==="NotAllowedError"&&(Gi.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(g),sT(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),H6()}))})}updateTrack(l,i){const o=this.elementMap.get(l);o&&(o.srcObject=new MediaStream([i]))}isPlaying(l){return this.elementMap.has(l)&&this.elementStateMap.get(l)==="playing"}setVolume(l,i){const o=this.elementMap.get(l);o&&(i=Math.max(0,Math.min(100,i)),o.volume=i/100)}stop(l){const i=this.elementMap.get(l);if(this.sinkIdMap.delete(l),!i)return;const o=this.elementsNeedToResume.indexOf(i);this.elementsNeedToResume.splice(o,1),i.srcObject=null,i.remove(),this.elementMap.delete(l),this.elementStateMap.delete(l)}bindAudioElementEvents(l,i){ntt.forEach(o=>{i.addEventListener(o,p=>{const g=this.elementStateMap.get(l),b=p.type==="pause"?"paused":p.type;if(Gi.debug("[".concat(l,"] audio-element-status change ").concat(g," => ").concat(b)),p.type==="error"){const A=i==null?void 0:i.error;A&&Gi.error("[".concat(l,"] media error, code: ").concat(A.code,", message: ").concat(A.message))}this.elementStateMap.set(l,b)})})}getPlayerState(l){return this.elementStateMap.get(l)||"uninit"}autoResumeAudioElement(){const l=()=>{this.elementsNeedToResume.forEach(i=>{i.play().then(o=>{Gi.debug("Auto resume audio element success")}).catch(o=>{Gi.warning("Auto resume audio element failed!",o)})}),this.elementsNeedToResume=[]};new pE(i=>{document.body?i():window.addEventListener("load",()=>i())}).then(()=>{FO()?document.body.addEventListener("click",l,!0):(document.body.addEventListener("touchstart",l,!0),document.body.addEventListener("mousedown",l,!0))})}};function H_(){return function(l,i,o){const p=o.value;return typeof p=="function"&&(o.value=function(){this._isClosed&&new yE(_p.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",Gi);for(var g=arguments.length,b=new Array(g),A=0;A<g;A++)b[A]=arguments[A];const j=p.apply(this,b);return j instanceof pE?new pE((H,z)=>{j.then(H).catch(z)}):j}),o}}function J6(l,i){var o=Object.keys(l);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(l);i&&(p=p.filter(function(g){return Object.getOwnPropertyDescriptor(l,g).enumerable})),o.push.apply(o,p)}return o}function UN(l){for(var i=1;i<arguments.length;i++){var o=arguments[i]!=null?arguments[i]:{};i%2?J6(Object(o),!0).forEach(function(p){_e(l,p,o[p])}):Object.getOwnPropertyDescriptors?Object.defineProperties(l,Object.getOwnPropertyDescriptors(o)):J6(Object(o)).forEach(function(p){Object.defineProperty(l,p,Object.getOwnPropertyDescriptor(o,p))})}return l}class X6 extends D_{constructor(i){super(),_e(this,"name","VideoProcessorDestination"),_e(this,"ID","0"),_e(this,"_source",void 0),_e(this,"videoContext",void 0),_e(this,"inputTrack",void 0),this.videoContext=i}get kind(){return"video"}get enabled(){return!0}pipe(){throw new yE(_p.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new yE(_p.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(i){if(i.context!==this.videoContext)throw new Error(`ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.
Probably you are making pipeline like this:
videoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).`);i.track&&i.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=i.track,this.emit(V0.ON_TRACK,i.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(V0.ON_TRACK,void 0)}}class Q6 extends D_{set chained(i){this._chained=i}get chained(){return this._chained}constructor(i,o){super(),_e(this,"constraintsMap",new Map),_e(this,"statsRegistry",[]),_e(this,"usageRegistry",[]),_e(this,"trackId",void 0),_e(this,"direction",void 0),_e(this,"_chained",!1),this.trackId=i,this.direction=o}async getConstraints(){return await U_(this,dS.REQUEST_CONSTRAINTS)}async requestApplyConstraints(i,o){var p;return Gi.info("processor ".concat(o.name," requestApplyConstraints for ").concat(this.trackId)),i&&this.constraintsMap.set(o,i),S_(this,dS.REQUEST_UPDATE_CONSTRAINTS,Array.from(OT(p=this.constraintsMap).call(p)))}async requestRevertConstraints(i){var o;if(this.constraintsMap.has(i))return Gi.info("processor ".concat(i.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(i),S_(this,dS.REQUEST_UPDATE_CONSTRAINTS,Array.from(OT(o=this.constraintsMap).call(o)))}registerStats(i,o,p){this.statsRegistry.find(g=>g.processorID===i.ID&&g.processorName===i.name&&g.type===o)||this.statsRegistry.push({processorName:i.name,processorID:i.ID,type:o,cb:p})}unregisterStats(i,o){const p=this.statsRegistry.findIndex(g=>g.processorID===i.ID&&g.processorName===i.name&&g.type===o);p!==-1&&this.statsRegistry.splice(p,1)}gatherStats(){const i=[];for(const{processorID:o,processorName:p,type:g,cb:b}of this.statsRegistry)try{const A=b();i.push({processorID:o,processorName:p,type:g,stats:A})}catch(A){Gi.error(new yE(_p.UNEXPECTED_ERROR,A.message))}return i}registerUsage(i,o){this.usageRegistry.find(p=>p.processorID===i.ID&&p.processorName===i.name)||this.usageRegistry.push({processorID:i.ID,processorName:i.name,cb:o})}unregisterUsage(i){const o=this.usageRegistry.findIndex(p=>p.processorID===i.ID&&p.processorName===i.name);o!==-1&&this.usageRegistry.splice(o,1)}async gatherUsage(){const i=[];if(!this.chained)return[];for(const{cb:o}of this.usageRegistry)try{let p=o();p instanceof pE&&(p=await p),i.push(UN(UN({},p),{},{direction:this.direction}))}catch(p){Gi.error("gather extension usage error",p)}return i}getDirection(){return this.direction}}class FN extends D_{constructor(i){super(),_e(this,"name","AudioProcessorDestination"),_e(this,"ID","0"),_e(this,"inputTrack",void 0),_e(this,"inputNode",void 0),_e(this,"audioProcessorContext",void 0),_e(this,"_source",void 0),this.audioProcessorContext=i}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new yE(_p.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new yE(_p.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(V0.ON_TRACK,void 0),this.emit(V0.ON_NODE,void 0)}updateInput(i){if(i.context!==this.audioProcessorContext)throw new Error(`ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.
        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).`);i.track&&this.inputTrack!==i.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=i.track,this.emit(V0.ON_TRACK,this.inputTrack)),i.node&&this.inputNode!==i.node&&(this.audioProcessorContext.chained=!0,this.inputNode=i.node,this.emit(V0.ON_NODE,this.inputNode))}}class jN extends D_{set chained(i){this._chained=i}get chained(){return this._chained}constructor(i,o,p){super(),_e(this,"constraintsMap",new Map),_e(this,"statsRegistry",[]),_e(this,"audioContext",void 0),_e(this,"trackId",void 0),_e(this,"direction",void 0),_e(this,"usageRegistry",[]),_e(this,"_chained",!1),this.audioContext=i,this.trackId=o,this.direction=p}async getConstraints(){return U_(this,dS.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(i,o){var p;return Gi.info("processor ".concat(o.name," requestApplyConstraints for ").concat(this.trackId)),i&&this.constraintsMap.set(o,i),S_(this,dS.REQUEST_UPDATE_CONSTRAINTS,Array.from(OT(p=this.constraintsMap).call(p)))}async requestRevertConstraints(i){var o;if(this.constraintsMap.has(i))return this.constraintsMap.delete(i),S_(this,dS.REQUEST_UPDATE_CONSTRAINTS,Array.from(OT(o=this.constraintsMap).call(o)))}registerStats(i,o,p){this.statsRegistry.find(g=>g.processorID===i.ID&&g.processorName===i.name&&g.type===o)||this.statsRegistry.push({processorName:i.name,processorID:i.ID,type:o,cb:p})}unregisterStats(i,o){const p=this.statsRegistry.findIndex(g=>g.processorID===i.ID&&g.processorName===i.name&&g.type===o);p!==-1&&this.statsRegistry.splice(p,1)}gatherStats(){const i=[];for(const{processorID:o,processorName:p,type:g,cb:b}of this.statsRegistry)try{const A=b();i.push({processorID:o,processorName:p,type:g,stats:A})}catch(A){Gi.error(new yE(_p.UNEXPECTED_ERROR,A.message))}return i}registerUsage(i,o){this.usageRegistry.find(p=>p.processorID===i.ID&&p.processorName===i.name)||this.usageRegistry.push({processorID:i.ID,processorName:i.name,cb:o})}unregisterUsage(i){const o=this.usageRegistry.findIndex(p=>p.processorID===i.ID&&p.processorName===i.name);o!==-1&&this.usageRegistry.splice(o,1)}async gatherUsage(){const i=[];if(!this.chained)return[];for(const{cb:o}of this.usageRegistry)try{let p=o();p instanceof pE&&(p=await p),i.push(UN(UN({},p),{},{direction:this.direction}))}catch(p){Gi.error("gather extension usage error",p)}return i}getDirection(){return this.direction}}class DM extends D_{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),_e(this,"context",void 0),_e(this,"processSourceNode",void 0),_e(this,"outputTrack",void 0),_e(this,"processedNode",void 0),_e(this,"clonedTrack",void 0),_e(this,"outputNode",void 0),this.outputNode=new rtt}setVolume(){}createOutputTrack(){throw new yE(_p.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class rtt{disconnect(){}connect(){}}let tO=null;class itt{constructor(){_e(this,"state","open"),_e(this,"trigger",void 0),_e(this,"tasks",[]),Gi.debug("[macro-task-queue] is created."),this.trigger=window.setTimeout(()=>{this.state="closed",Gi.debug("[macro-task-queue] will be closed, all remaining tasks will execute. [".concat(this.tasks.map(i=>i.key),"]")),this.trigger=void 0,this.tasks.forEach(i=>{let{func:o}=i;return o()}),this.tasks.length=0,Gi.debug("[macro-task-queue] is closed.")})}enqueue(i,o){this.state!=="closed"&&(this.tasks.push({key:i,func:o}),Gi.debug("[macro-task-queue] is queued, current queue ".concat(this.tasks.length,". ").concat(typeof i=="string"?i:"")))}runTask(i){if(this.state==="closed")return;const o=this.tasks.findIndex(p=>p.key===i);if(o!==-1){const p=this.tasks.splice(o,1);Gi.debug("[macro-task-queue] is unqueued, current queue ".concat(this.tasks.length,". ").concat(typeof i=="string"?i:"")),p[0].func()}}release(){this.trigger&&(this.state="closed",clearTimeout(this.trigger),this.trigger=void 0,this.tasks.length=0,Gi.debug("[macro-task-queue] is closed."))}}function LM(l){return function(i,o,p){var g;const b=(g=p.value)!==null&&g!==void 0?g:p.get,A=function(){tO&&tO.state==="open"&&tO.runTask(l);for(var j=arguments.length,H=new Array(j),z=0;z<j;z++)H[z]=arguments[z];return b==null?void 0:b.apply(this,...H)};return p.value?p.value=A:p.get=A,p}}function $6(l,i){var o=Object.keys(l);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(l);i&&(p=p.filter(function(g){return Object.getOwnPropertyDescriptor(l,g).enumerable})),o.push.apply(o,p)}return o}function xM(l){for(var i=1;i<arguments.length;i++){var o=arguments[i]!=null?arguments[i]:{};i%2?$6(Object(o),!0).forEach(function(p){_e(l,p,o[p])}):Object.getOwnPropertyDescriptors?Object.defineProperties(l,Object.getOwnPropertyDescriptors(o)):$6(Object(o)).forEach(function(p){Object.defineProperty(l,p,Object.getOwnPropertyDescriptor(o,p))})}return l}class g_ extends P0{get _source(){return this._trackSource}set _source(i){this._trackSource=i}get processorContext(){return this._processorContext}set processorContext(i){this._processorContext=i}get processorDestination(){return this._processorDestination}set processorDestination(i){this._processorDestination=i}get isPlaying(){return this._useAudioElement?vS.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(i,o,p,g,b){super(i,p),_e(this,"trackMediaType","audio"),_e(this,"_encoderConfig",void 0),_e(this,"_trackSource",void 0),_e(this,"_enabled",!0),_e(this,"_volume",100),_e(this,"_useAudioElement",!1),_e(this,"_bypassWebAudio",!1),_e(this,"processor",void 0),_e(this,"_processorContext",void 0),_e(this,"_processorDestination",void 0),_e(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=o,this._getOriginVolumeLevel=!!g;const A=()=>{this.processorContext=new jN(this._source.context,this.getTrackId(),"local"),this.processorDestination=new FN(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(lS.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})},j=b&&H0()&&!U6();nE("DISABLE_WEBAUDIO")?(this._source=new DM,this._useAudioElement=!0,this._bypassWebAudio=!0):j?this._source=new DM:(this._source=new NM(i,!1,this._getOriginVolumeLevel?i:void 0),nE("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")||(this._useAudioElement=!0)),A(),!nE("DISABLE_WEBAUDIO")&&j&&(tO||(tO=new itt),tO).enqueue("INIT_WEBAUDIO",()=>{this._source=new NM(i,!1,this._getOriginVolumeLevel?i:void 0),nE("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")||(this._useAudioElement=!0),A(),this.emit(xN.UPDATE_TRACK_SOURCE)})}setVolume(i){b_(i,"volume",0,1e3),this._volume=i,this._source.setVolume(i/100),this._useAudioElement&&vS.setVolume(this.getTrackId(),i);try{if(this._bypassWebAudio)return void Gi.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));const o=this._source.createOutputTrack();this._mediaStreamTrack!==o&&(this._mediaStreamTrack=o,S_(this,xE.NEED_REPLACE_TRACK,this).then(()=>{Gi.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(p=>{Gi.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),p)}))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(i){if(!this._useAudioElement)throw new yE(_p.NOT_SUPPORTED,"your browser does not support setting the audio output device");await vS.setSinkID(this.getTrackId(),i)}async setEnabled(i,o,p){return this._setEnabled(i,o,p)}async _setEnabled(i,o,p){if(!p){if(i===this._enabled)return;this.stateCheck("enabled",i)}if(Gi.info("[".concat(this.getTrackId(),"] start setEnabled"),i),i){this._originMediaStreamTrack.enabled=!0;try{p||(this._enabled=!0),await S_(this,xE.NEED_ENABLE_TRACK,this),Gi.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(i," success"))}catch(g){throw p||(this._enabled=!1),Gi.error("[".concat(this.getTrackId(),"] setEnabled to true error"),g.toString()),g}}else{this._originMediaStreamTrack.enabled=!1,p||(this._enabled=!1);try{await S_(this,xE.NEED_DISABLE_TRACK,this)}catch(g){throw p||(this._enabled=!0),Gi.error("[".concat(this.getTrackId(),"] setEnabled to false error"),g.toString()),g}}}async setMuted(i){i!==this._muted&&(this.stateCheck("muted",i),this._muted=i,this._originMediaStreamTrack.enabled=!i,Gi.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(i)),i?await S_(this,xE.NEED_MUTE_TRACK,this):await S_(this,xE.NEED_UNMUTE_TRACK,this))}getStats(){return VO(()=>{Gi.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),oS(this,xE.GET_STATS)||xM({},RM)}setAudioFrameCallback(i){let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!i)return this._source.removeAllListeners(lS.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(o),this._source.removeAllListeners(lS.ON_AUDIO_BUFFER),this._source.on(lS.ON_AUDIO_BUFFER,p=>i(p))}play(){Gi.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(Gi.debug("[".concat(this.getTrackId(),"] start audio playback in element")),vS.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){Gi.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?vS.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let i=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];Gi.debug("[".concat(this.getTrackId(),"] update player source track")),i&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&vS.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(i,o){this._originMediaStreamTrack!==i&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),o&&this._originMediaStreamTrack.stop()),i.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=i,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this.processor.updateInput({track:i,context:this.processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await S_(this,xE.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(i))}renewMediaStreamTrack(i){return pE.resolve(void 0)}pipe(i){if(this._bypassWebAudio)throw new yE(_p.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===i)return i;if(i._source)throw new yE(_p.INVALID_OPERATION,"Processor ".concat(i.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=i,this.processor._source=this,i.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),i}unpipe(){var i;if(!this.processor)return;const o=this.processor;(i=this._source.processSourceNode)===null||i===void 0||i.disconnect(),this.processor._source=!1,this.processor=void 0,o.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(V0.ON_TRACK,async i=>{i?i!==this._mediaStreamTrack&&(this._mediaStreamTrack=i,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(i),await S_(this,xE.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await S_(this,xE.NEED_REPLACE_TRACK,this))}),this.processorDestination.on(V0.ON_NODE,i=>{this._source.processedNode=i})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(V0.ON_TRACK),this.processorDestination.removeAllListeners(V0.ON_NODE)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(dS.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(dS.REQUEST_CONSTRAINTS)}}bE([LM("INIT_WEBAUDIO"),kc("design:type",Object),kc("design:paramtypes",[Object])],g_.prototype,"_source",null),bE([LM("INIT_WEBAUDIO"),kc("design:type",jN),kc("design:paramtypes",[jN])],g_.prototype,"processorContext",null),bE([LM("INIT_WEBAUDIO"),kc("design:type",FN),kc("design:paramtypes",[FN])],g_.prototype,"processorDestination",null),bE([HE({argsMap:(l,i)=>[l.getTrackId(),i],throttleTime:300}),kc("design:type",Function),kc("design:paramtypes",[Number]),kc("design:returntype",void 0)],g_.prototype,"setVolume",null),bE([HE({argsMap:(l,i)=>[l.getTrackId(),i]}),H_(),kc("design:type",Function),kc("design:paramtypes",[String]),kc("design:returntype",pE)],g_.prototype,"setPlaybackDevice",null),bE([GI("LocalAudioTrack","_enabledMutex"),HE({argsMap:(l,i)=>[l.getTrackId(),i]}),H_(),kc("design:type",Function),kc("design:paramtypes",[Boolean,Object,Boolean]),kc("design:returntype",pE)],g_.prototype,"setEnabled",null),bE([GI("LocalAudioTrack","_enabledMutex"),HE({argsMap:(l,i)=>[l.getTrackId(),i]}),H_(),kc("design:type",Function),kc("design:paramtypes",[Boolean]),kc("design:returntype",pE)],g_.prototype,"setMuted",null),bE([H_(),kc("design:type",Function),kc("design:paramtypes",[]),kc("design:returntype",Object)],g_.prototype,"getStats",null),bE([H_(),kc("design:type",Function),kc("design:paramtypes",[Object,Number]),kc("design:returntype",void 0)],g_.prototype,"setAudioFrameCallback",null),bE([HE({argsMap:l=>[l.getTrackId()]}),H_(),kc("design:type",Function),kc("design:paramtypes",[]),kc("design:returntype",void 0)],g_.prototype,"play",null),bE([HE({argsMap:l=>[l.getTrackId()]}),H_(),kc("design:type",Function),kc("design:paramtypes",[]),kc("design:returntype",void 0)],g_.prototype,"stop",null),bE([HE({argsMap:l=>[l.getTrackId()]}),kc("design:type",Function),kc("design:paramtypes",[]),kc("design:returntype",void 0)],g_.prototype,"close",null),bE([HE({argsMap:(l,i)=>[l.getTrackId(),i.name]}),kc("design:type",Function),kc("design:paramtypes",[Object]),kc("design:returntype",Object)],g_.prototype,"pipe",null),bE([HE({argsMap:l=>[l.getTrackId()]}),kc("design:type",Function),kc("design:paramtypes",[]),kc("design:returntype",void 0)],g_.prototype,"unpipe",null);class _R extends g_{get __className__(){return"MicrophoneAudioTrack"}constructor(i,o,p,g){super(i,o.encoderConfig?DN(o.encoderConfig):{},g,nE("GET_VOLUME_OF_MUTED_AUDIO_TRACK"),!0),_e(this,"_config",void 0),_e(this,"_deviceName","default"),_e(this,"_constraints",void 0),_e(this,"_originalConstraints",void 0),_e(this,"_enabled",!0),this._config=o,this._constraints=p,this._originalConstraints=p,this._deviceName=i.label,typeof o.bypassWebAudio=="boolean"&&(this._bypassWebAudio=o.bypassWebAudio),(FI()||ML())&&__.bindInterruptDetectorTrack(this),this.on(xN.UPDATE_TRACK_SOURCE,()=>{this.bindProcessorContextEvents()}),U6()&&this.bindProcessorContextEvents()}async setDevice(i){if(Gi.info("[".concat(this.getTrackId(),"] start set device to ").concat(i)),this._enabled)try{const o=await DS.getDeviceById(i),p={};p.audio=xM({},this._constraints),p.audio.deviceId={exact:i},this._originMediaStreamTrack.stop();let g=null;try{g=await kS(p,this.getTrackId())}catch(b){throw Gi.error("[".concat(this.getTrackId(),"] setDevice failed"),b.toString()),g=await kS({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(g.getAudioTracks()[0],!1),b}await this._updateOriginMediaStreamTrack(g.getAudioTracks()[0],!1),this._deviceName=o.label,this._config.microphoneId=i,this._constraints.deviceId={exact:i}}catch(o){throw Gi.error("[".concat(this.getTrackId(),"] setDevice error"),o.toString()),o}else try{const o=await DS.getDeviceById(i);this._deviceName=o.label,this._config.microphoneId=i,this._constraints.deviceId={exact:i}}catch(o){throw Gi.error("[".concat(this.getTrackId(),"] setDevice error"),o.toString()),o}Gi.info("[".concat(this.getTrackId(),"] set device to ").concat(i," success"))}async setEnabled(i,o,p){if(o)return Gi.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(i);if(!p){if(i===this._enabled)return;this.stateCheck("enabled",i)}if(Gi.info("[".concat(this.getTrackId(),"] start setEnabled"),i),!i){var g;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),(g=this._source.clonedTrack)===null||g===void 0||g.stop(),p||(this._enabled=!1);try{await S_(this,xE.NEED_DISABLE_TRACK,this)}catch(j){throw Gi.error("[".concat(this.getTrackId(),"] setEnabled false failed"),j.toString()),j}return}const b=xM({},this._constraints),A=DS.searchDeviceIdByName(this._deviceName);A&&!b.deviceId&&(b.deviceId=A);try{p||(this._enabled=!0);const j=await kS({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(j.getAudioTracks()[0],!1),await S_(this,xE.NEED_ENABLE_TRACK,this)}catch(j){throw p||(this._enabled=!1),Gi.error("[".concat(this.getTrackId(),"] setEnabled true failed"),j.toString()),j}Gi.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),(FI()||ML())&&__.unbindInterruptDetectorTrack(this)}onTrackEnded(){if((z0()||wT())&&this._enabled&&!this._isClosed&&__.duringInterruption){const i=async()=>{__.off(_0.IOS_INTERRUPTION_END,i),this._enabled&&!this._isClosed&&(Gi.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};__.on(_0.IOS_INTERRUPTION_END,i)}else Gi.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(vR.TRACK_ENDED)}async renewMediaStreamTrack(i){const o=i||this._constraints,p=DS.searchDeviceIdByName(this._deviceName);if(p&&!o.deviceId&&(o.deviceId=p),this._constraints=o,this._enabled){this._originMediaStreamTrack.stop();const g=await kS({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(g.getAudioTracks()[0],!0)}}bindProcessorContextEvents(){this.processorContext.on(dS.REQUEST_UPDATE_CONSTRAINTS,async(i,o,p)=>{try{const g=Object.assign({},this._originalConstraints,...i);await this.renewMediaStreamTrack(g),o()}catch(g){p(g)}}),this.processorContext.on(dS.REQUEST_CONSTRAINTS,async i=>{i(this._originMediaStreamTrack.getSettings())})}}bE([HE({argsMap:(l,i)=>[l.getTrackId(),i]}),H_(),kc("design:type",Function),kc("design:paramtypes",[String]),kc("design:returntype",pE)],_R.prototype,"setDevice",null),bE([GI("MicrophoneAudioTrack","_enabledMutex"),HE({argsMap:(l,i,o)=>[l.getTrackId(),i,o]}),H_(),kc("design:type",Function),kc("design:paramtypes",[Boolean,Boolean,Boolean]),kc("design:returntype",pE)],_R.prototype,"setEnabled",null),bE([HE({argsMap:l=>[l.getTrackId()]}),kc("design:type",Function),kc("design:paramtypes",[]),kc("design:returntype",void 0)],_R.prototype,"close",null);class yR extends g_{get __className__(){return"BufferSourceAudioTrack"}constructor(i,o,p,g){super(o.createOutputTrack(),p,g),_e(this,"source",void 0),_e(this,"_bufferSource",void 0),this.source=i,this._bufferSource=o,this._bufferSource.on(lS.AUDIO_SOURCE_STATE_CHANGE,b=>{this.safeEmit(vR.SOURCE_STATE_CHANGE,b)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(i){i&&this._bufferSource.updateOptions(i),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(i){this._bufferSource.seekAudioBuffer(i)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(i){b_(i,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(i)}}bE([HE({argsMap:(l,i)=>[l.getTrackId(),i,l.duration]}),H_(),kc("design:type",Function),kc("design:paramtypes",[Object]),kc("design:returntype",void 0)],yR.prototype,"startProcessAudioBuffer",null),bE([HE({argsMap:l=>[l.getTrackId()]}),H_(),kc("design:type",Function),kc("design:paramtypes",[]),kc("design:returntype",void 0)],yR.prototype,"pauseProcessAudioBuffer",null),bE([HE({argsMap:l=>[l.getTrackId()]}),H_(),kc("design:type",Function),kc("design:paramtypes",[Number]),kc("design:returntype",void 0)],yR.prototype,"seekAudioBuffer",null),bE([HE({argsMap:l=>[l.getTrackId()]}),H_(),kc("design:type",Function),kc("design:paramtypes",[]),kc("design:returntype",void 0)],yR.prototype,"resumeProcessAudioBuffer",null),bE([HE({argsMap:l=>[l.getTrackId()]}),H_(),kc("design:type",Function),kc("design:paramtypes",[]),kc("design:returntype",void 0)],yR.prototype,"stopProcessAudioBuffer",null),bE([HE({argsMap:l=>[l.getTrackId()]}),kc("design:type",Function),kc("design:paramtypes",[]),kc("design:returntype",void 0)],yR.prototype,"close",null),bE([HE({argsMap:l=>[l.getTrackId()]}),H_(),kc("design:type",Function),kc("design:paramtypes",[Number]),kc("design:returntype",void 0)],yR.prototype,"setAudioBufferPlaybackSpeed",null);class Z_ extends g_{get __className__(){return"MixingAudioTrack"}get isActive(){for(const i of this.trackList)if(i._enabled&&!i._isClosed&&!i.muted)return!0;return!1}constructor(){const i=_w().createMediaStreamDestination();super(i.stream.getAudioTracks()[0],void 0,T_(8,"track-mix-")),_e(this,"trackList",void 0),_e(this,"destNode",void 0);try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=i,this.trackList=[]}hasAudioTrack(i){return this.trackList.indexOf(i)!==-1}addAudioTrack(i){this.trackList.indexOf(i)===-1?(Gi.debug("add ".concat(i.getTrackId()," to mixing track")),i._source.outputNode.connect(this.destNode),this.trackList.push(i),this.updateEncoderConfig()):Gi.debug("track ".concat(i.getTrackId()," is already added"))}removeAudioTrack(i){if(this.trackList.indexOf(i)!==-1){Gi.debug("remove ".concat(i.getTrackId()," from mixing track"));try{i._source.outputNode.disconnect(this.destNode)}catch{}VL(this.trackList,i),this.updateEncoderConfig()}}updateEncoderConfig(){const i={};this.trackList.forEach(o=>{o._encoderConfig&&((o._encoderConfig.bitrate||0)>(i.bitrate||0)&&(i.bitrate=o._encoderConfig.bitrate),(o._encoderConfig.sampleRate||0)>(i.sampleRate||0)&&(i.sampleRate=o._encoderConfig.sampleRate),(o._encoderConfig.sampleSize||0)>(i.sampleSize||0)&&(i.sampleSize=o._encoderConfig.sampleSize),o._encoderConfig.stereo&&(i.stereo=!0))}),this._encoderConfig=i}_updateRtpTransceiver(i){this._rtpTransceiver!==i&&(this._rtpTransceiver=i,this.trackList.forEach(o=>{o instanceof Z_?o.emit($I.TRANSCEIVER_UPDATED,i):o._updateRtpTransceiver(i)}))}}function VN(l){const i={};l.facingMode&&(i.facingMode=l.facingMode),l.cameraId&&(i.deviceId={exact:l.cameraId});const o=kT(l.encoderConfig);return o.width!=null&&(i.width=o.width),o.height!=null&&(i.height=o.height),!HV()&&o.frameRate&&(i.frameRate=o.frameRate),l_().name===m_.EDGE&&typeof i.frameRate=="object"&&(i.frameRate.max=60),N_()&&(i.frameRate={ideal:30,max:30}),i}function Z6(l){const i={};if(HV()||(l.AGC!==void 0&&(i.autoGainControl=l.AGC),l.AEC!==void 0&&(i.echoCancellation=l.AEC),l.ANS!==void 0&&(i.noiseSuppression=l.ANS,LL()&&l.ANS&&(i.googHighpassFilter=l.ANS))),l.encoderConfig){const o=DN(l.encoderConfig);i.channelCount=o.stereo?2:1,i.sampleRate=o.sampleRate,i.sampleSize=o.sampleSize}return l.microphoneId&&(i.deviceId={exact:l.microphoneId}),uN()&&(i.sampleRate=void 0),i}class stt extends j6{set currentState(i){i!==this._currentState&&(this._currentState=i,this.safeEmit(lS.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(i){let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),_e(this,"audioBuffer",void 0),_e(this,"sourceNode",void 0),_e(this,"startPlayTime",0),_e(this,"startPlayOffset",0),_e(this,"pausePlayTime",0),_e(this,"options",void 0),_e(this,"currentLoopCount",0),_e(this,"currentPlaybackSpeed",100),_e(this,"_currentState","stopped"),this.audioBuffer=i,this.options=o,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?this.currentState==="stopped"?0:this.currentState==="paused"?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(i){this.currentState==="stopped"?(this.options=i,this.startPlayOffset=this.options.startPlayTime||0):Gi.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&this.currentState==="playing"&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(i){this.sourceNode&&(this.sourceNode.onended=null,this.currentState==="playing"&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),this.currentState==="playing"?(this.startPlayOffset=i,this.startSourceNode()):this.currentState==="paused"&&(this.pausePlayTime=i))}resumeProcessAudioBuffer(){this.currentState==="paused"&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(i){this.sourceNode&&(this.currentState==="playing"&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=i/100),this.currentPlaybackSpeed=i}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){const i=this.context.createBufferSource();return i.buffer=this.audioBuffer,i.loop=!!this.options.loop,i.connect(this.outputNode),i.playbackRate.value=this.currentPlaybackSpeed/100,i}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}const t4=new Map;async function ott(l,i){let o=null;if(typeof l=="string"){const g=t4.get(l);if(g)return Gi.debug("use cached audio resource: ",l),g;try{o=(await vT(()=>aS.get(l,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(b){throw new yE(_p.FETCH_AUDIO_FILE_FAILED,b.toString())}}else o=await new pE((b,A)=>{const j=new FileReader;j.onload=H=>{H.target?b(H.target.result):A(new yE(_p.READ_LOCAL_AUDIO_FILE_ERROR))},j.onerror=()=>{A(new yE(_p.READ_LOCAL_AUDIO_FILE_ERROR))},j.readAsArrayBuffer(l)});const p=await function(g){const b=_w();return new pE((A,j)=>{b.decodeAudioData(g,H=>{A(H)},H=>{j(new yE(_p.DECODE_AUDIO_FILE_FAILED,H.toString()))})})}(o);return typeof l=="string"&&i&&t4.set(l,p),p}const MM=l=>{const i=document.createElement("canvas");return i.width=2,i.height=2,new pE((o,p)=>{i.toBlob(async g=>{if(i.remove(),g){const b=await e4(g);o({buffer:b,width:i.width,height:i.height})}else p(new yE(_p.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},l,1)})},e4=async l=>{const i=await l.arrayBuffer();return new Uint8Array(i)},QT=new class extends D_{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),_e(this,"_lastHiddenTime",0),_e(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),Gi.debug("document visibility went ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}};function n4(l,i){var o=Object.keys(l);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(l);i&&(p=p.filter(function(g){return Object.getOwnPropertyDescriptor(l,g).enumerable})),o.push.apply(o,p)}return o}function r4(l){for(var i=1;i<arguments.length;i++){var o=arguments[i]!=null?arguments[i]:{};i%2?n4(Object(o),!0).forEach(function(p){_e(l,p,o[p])}):Object.getOwnPropertyDescriptors?Object.defineProperties(l,Object.getOwnPropertyDescriptors(o)):n4(Object(o)).forEach(function(p){Object.defineProperty(l,p,Object.getOwnPropertyDescriptor(o,p))})}return l}class UM{get videoElementStatus(){return this._videoElementStatus}set videoElementStatus(i){i!==this._videoElementStatus&&(Gi.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(i)),this._videoElementStatus=i)}constructor(i){_e(this,"trackId",void 0),_e(this,"config",void 0),_e(this,"onFirstVideoFrameDecoded",void 0),_e(this,"freezeTimeCounterList",[]),_e(this,"renderFreezeAccTime",0),_e(this,"isKeepLastFrame",!1),_e(this,"timeUpdatedCount",0),_e(this,"freezeTime",0),_e(this,"playbackTime",0),_e(this,"lastTimeUpdatedTime",0),_e(this,"autoplayFailed",!1),_e(this,"videoTrack",void 0),_e(this,"videoElement",void 0),_e(this,"cacheVideoElement",void 0),_e(this,"videoElementCheckInterval",void 0),_e(this,"_videoElementStatus",B0.NONE),_e(this,"isGettingVideoDimensions",!1),_e(this,"startGetVideoDimensions",()=>{const o=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return Gi.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(o,500)};!this.isGettingVideoDimensions&&o()}),_e(this,"autoResumeAfterInterruption",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&__.curState==="running"&&(Gi.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(FV())),qV()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),_e(this,"handleVideoEvents",o=>{switch(o.type){case"play":case"playing":this.startGetVideoDimensions(),this.videoElementStatus=B0.PLAYING;break;case"loadeddata":if(this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch{}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=B0.CANPLAY;break;case"stalled":this.videoElementStatus=B0.STALLED;break;case"suspend":this.videoElementStatus=B0.SUSPEND;break;case"pause":this.videoElementStatus=B0.PAUSED,z0()||wT()||H0()&&this.autoplayFailed||!this.videoTrack||this.videoTrack.readyState!=="live"||(Gi.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=B0.WAITING;break;case"abort":this.videoElementStatus=B0.ABORT;break;case"ended":this.videoElementStatus=B0.ENDED;break;case"emptied":this.videoElementStatus=B0.EMPTIED;break;case"error":{this.videoElementStatus=B0.ERROR;const p=this.videoElement.error;p&&Gi.error("[".concat(this.trackId,"] media error, code: ").concat(p.code,", message: ").concat(p.message));break}case"timeupdate":{const p=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=p);const g=p-this.lastTimeUpdatedTime,b=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=p,QT.lastVisibleTime<QT.lastHiddenTime||b<QT.lastHiddenTime||b<QT.lastVisibleTime)return;for(g>nE("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=g),this.playbackTime+=g;this.playbackTime>=6e3;){this.playbackTime-=6e3;const A=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(A),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}}),_e(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&(Gi.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(FV())),qV()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),this.trackId=i.trackId,this.config=i,i.element instanceof HTMLVideoElement?this.videoElement=i.element:this.videoElement=document.createElement("video"),__.on(_0.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),__.on(_0.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var i;return(i=this.videoElement.parentElement)!==null&&i!==void 0?i:void 0}updateConfig(i){this.config=i,this.trackId=i.trackId,i.element!==this.videoElement&&(this.destroy(),this.videoElement=i.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(i){this.videoTrack!==i&&(this.videoTrack=i,this.initVideoElement())}play(i){const o=this.videoElement.play();o&&o.catch&&o.catch(g=>{i&&Y6(i,"video",g.message,this.trackId),g.name==="NotAllowedError"?(Gi.warning("detected video element autoplay failed",g),this.autoplayFailed=!0,this.handleAutoPlayFailed()):Gi.warning("[".concat(this.trackId,"] play warning: "),g)});const p=l_();if((p.name==="Safari"&&Number(p.version)===15||FI())&&o&&o.then){const g=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};o.then(g).catch(g)}}getCurrentFrame(){const i=document.createElement("canvas");i.width=this.videoElement.videoWidth,i.height=this.videoElement.videoHeight;const o=i.getContext("2d");if(!o)return Gi.error("create canvas context failed!"),new ImageData(2,2);o.drawImage(this.videoElement,0,0,i.width,i.height);const p=o.getImageData(0,0,i.width,i.height);return i.remove(),p}async getCurrentFrameToUint8Array(i){let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const p=document.createElement("canvas");p.width=this.videoElement.videoWidth,p.height=this.videoElement.videoHeight;const g=p.getContext("2d");return g?(g.drawImage(this.videoElement,0,0,p.width,p.height),new pE((b,A)=>{p.toBlob(async j=>{if(p.remove(),j){const H=await e4(j);b({buffer:H,width:p.width,height:p.height})}else A(new yE(_p.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},i,o<0?.1:o>1?1:o)})):await MM(i)}destroy(){__.off(_0.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),__.off(_0.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[]}initVideoElement(){if(this.videoElementStatus=B0.INIT,!this.videoElementCheckInterval&&(i4.forEach(b=>{this.videoElement.addEventListener(b,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{(function(b){return b!==document.body&&document.body.contains(b)})(this.videoElement)||(this.videoElementStatus=B0.DESTROYED)},1e3),nE("ENABLE_VIDEO_FRAME_CALLBACK"))){var i,o;let b;const A=(j,H)=>{if(this.videoElementStatus===B0.PLAYING){if(b){const Vt=H.presentationTime-b.presentationTime;Vt>nE("VIDEO_FREEZE_DURATION")&&QT.lastVisibleTime>=QT.lastHiddenTime&&b.timestamp>QT.lastVisibleTime&&b.timestamp>QT.lastHiddenTime&&(this.renderFreezeAccTime+=Vt)}b=r4(r4({},H),{},{timestamp:j})}var z,$;nE("ENABLE_VIDEO_FRAME_CALLBACK")&&((z=($=this.videoElement).requestVideoFrameCallback)===null||z===void 0||z.call($,A))};(i=(o=this.videoElement).requestVideoFrameCallback)===null||i===void 0||i.call(o,A)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),uN()&&(this.videoElement.poster="noposter");const p=l_();p.name==="Safari"&&Number(p.version)===15||FI()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,N_()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,N_()&&this.videoElement.load());const g=this.videoElement.play();g!==void 0&&g.catch(b=>{Gi.debug("[".concat(this.trackId,"] playback interrupted"),b.toString())})}resetVideoElement(){i4.forEach(i=>{this.videoElement&&this.videoElement.removeEventListener(i,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=B0.NONE}handleAutoPlayFailed(){const i=o=>{o.preventDefault(),this.videoElement.play().then(()=>{Gi.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(p=>{Gi.error(p)}),this.autoplayFailed=!1,FO()?document.body.removeEventListener("click",i,!0):(document.body.removeEventListener("touchstart",i,!0),document.body.removeEventListener("mousedown",i,!0))};FO()?document.body.addEventListener("click",i,!0):(document.body.addEventListener("touchstart",i,!0),document.body.addEventListener("mousedown",i,!0)),H6()}}const i4=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class s4 extends UM{constructor(i){super(i),_e(this,"container",void 0),_e(this,"slot",void 0),this.slot=i.element,this.updateConfig(i)}updateConfig(i){this.config=i,this.trackId=i.trackId;const o=i.element;o!==this.slot&&(this.destroy(),this.slot=o),this.createElements()}updateVideoTrack(i){this.videoTrack!==i&&(this.videoTrack=i,this.createElements())}play(i){var o;(o=this.container)!==null&&o!==void 0&&o.contains(this.videoElement)&&super.play(i)}getCurrentFrame(){var i;return(i=this.container)!==null&&i!==void 0&&i.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(i){var o;let p=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return(o=this.container)!==null&&o!==void 0&&o.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(i,p):await MM(i)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{this.container.remove(),this.slot.removeChild(this.container)}catch{}this.container=void 0}}createElements(){this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",nE("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),this.slot.appendChild(this.container)}mountedVideoElement(){var i;!this.container||(i=this.container)!==null&&i!==void 0&&i.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var i;if((i=this.container)!==null&&i!==void 0&&i.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=document.createElement("video")}}resetVideoElement(){var i;(i=this.container)!==null&&i!==void 0&&i.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}function o4(l){return new pE((i,o)=>{let p=!1;const g=document.createElement("video");g.setAttribute("autoplay",""),g.setAttribute("muted",""),g.muted=!0,g.autoplay=!0,g.setAttribute("playsinline",""),g.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(g);const b=z0()?"canplay":"playing";g.addEventListener(b,()=>{const A=g.videoWidth,j=g.videoHeight;!A&&N_()||(p=!0,g.srcObject=null,g.remove(),i([A,j]))}),g.srcObject=new MediaStream([l]),g.play().catch(pN),setTimeout(()=>{p||(g.srcObject=null,g.remove(),i([g.videoWidth,g.videoHeight]))},4e3)})}const att=async(l,i,o)=>{const p=function(A){const j=[];for(let H=0;H<A.length;H+=2)j.push(parseInt(A.slice(H,H+2),16));return Uint8Array.from(j)}(function(A){const j="0123456789abcdef";function H(PE){let OE,$E="";for(OE=0;OE<=3;OE++)$E+=j.charAt(PE>>8*OE+4&15)+j.charAt(PE>>8*OE&15);return $E}function z(PE,OE){const $E=(65535&PE)+(65535&OE);return(PE>>16)+(OE>>16)+($E>>16)<<16|65535&$E}function $(PE,OE,$E,s_,B_,r0){return z(function(P_,yS){return P_<<yS|P_>>>32-yS}(z(z(OE,PE),z(s_,r0)),B_),$E)}function Vt(PE,OE,$E,s_,B_,r0,P_){return $(OE&$E|~OE&s_,PE,OE,B_,r0,P_)}function _r(PE,OE,$E,s_,B_,r0,P_){return $(OE&s_|$E&~s_,PE,OE,B_,r0,P_)}function Fi(PE,OE,$E,s_,B_,r0,P_){return $(OE^$E^s_,PE,OE,B_,r0,P_)}function _l(PE,OE,$E,s_,B_,r0,P_){return $($E^(OE|~s_),PE,OE,B_,r0,P_)}const _u=function(PE){let OE;const $E=1+(PE.length+8>>6),s_=new Array(16*$E);for(OE=0;OE<16*$E;OE++)s_[OE]=0;for(OE=0;OE<PE.length;OE++)s_[OE>>2]|=PE.charCodeAt(OE)<<OE%4*8;return s_[OE>>2]|=128<<OE%4*8,s_[16*$E-2]=8*PE.length,s_}(A);let _h,_g,eE,oE,SE,vE=1732584193,fE=-271733879,mE=-1732584194,EE=271733878;for(_h=0;_h<_u.length;_h+=16)_g=vE,eE=fE,oE=mE,SE=EE,vE=Vt(vE,fE,mE,EE,_u[_h+0],7,-680876936),EE=Vt(EE,vE,fE,mE,_u[_h+1],12,-389564586),mE=Vt(mE,EE,vE,fE,_u[_h+2],17,606105819),fE=Vt(fE,mE,EE,vE,_u[_h+3],22,-1044525330),vE=Vt(vE,fE,mE,EE,_u[_h+4],7,-176418897),EE=Vt(EE,vE,fE,mE,_u[_h+5],12,1200080426),mE=Vt(mE,EE,vE,fE,_u[_h+6],17,-1473231341),fE=Vt(fE,mE,EE,vE,_u[_h+7],22,-45705983),vE=Vt(vE,fE,mE,EE,_u[_h+8],7,1770035416),EE=Vt(EE,vE,fE,mE,_u[_h+9],12,-1958414417),mE=Vt(mE,EE,vE,fE,_u[_h+10],17,-42063),fE=Vt(fE,mE,EE,vE,_u[_h+11],22,-1990404162),vE=Vt(vE,fE,mE,EE,_u[_h+12],7,1804603682),EE=Vt(EE,vE,fE,mE,_u[_h+13],12,-40341101),mE=Vt(mE,EE,vE,fE,_u[_h+14],17,-1502002290),fE=Vt(fE,mE,EE,vE,_u[_h+15],22,1236535329),vE=_r(vE,fE,mE,EE,_u[_h+1],5,-165796510),EE=_r(EE,vE,fE,mE,_u[_h+6],9,-1069501632),mE=_r(mE,EE,vE,fE,_u[_h+11],14,643717713),fE=_r(fE,mE,EE,vE,_u[_h+0],20,-373897302),vE=_r(vE,fE,mE,EE,_u[_h+5],5,-701558691),EE=_r(EE,vE,fE,mE,_u[_h+10],9,38016083),mE=_r(mE,EE,vE,fE,_u[_h+15],14,-660478335),fE=_r(fE,mE,EE,vE,_u[_h+4],20,-405537848),vE=_r(vE,fE,mE,EE,_u[_h+9],5,568446438),EE=_r(EE,vE,fE,mE,_u[_h+14],9,-1019803690),mE=_r(mE,EE,vE,fE,_u[_h+3],14,-187363961),fE=_r(fE,mE,EE,vE,_u[_h+8],20,1163531501),vE=_r(vE,fE,mE,EE,_u[_h+13],5,-1444681467),EE=_r(EE,vE,fE,mE,_u[_h+2],9,-51403784),mE=_r(mE,EE,vE,fE,_u[_h+7],14,1735328473),fE=_r(fE,mE,EE,vE,_u[_h+12],20,-1926607734),vE=Fi(vE,fE,mE,EE,_u[_h+5],4,-378558),EE=Fi(EE,vE,fE,mE,_u[_h+8],11,-2022574463),mE=Fi(mE,EE,vE,fE,_u[_h+11],16,1839030562),fE=Fi(fE,mE,EE,vE,_u[_h+14],23,-35309556),vE=Fi(vE,fE,mE,EE,_u[_h+1],4,-1530992060),EE=Fi(EE,vE,fE,mE,_u[_h+4],11,1272893353),mE=Fi(mE,EE,vE,fE,_u[_h+7],16,-155497632),fE=Fi(fE,mE,EE,vE,_u[_h+10],23,-1094730640),vE=Fi(vE,fE,mE,EE,_u[_h+13],4,681279174),EE=Fi(EE,vE,fE,mE,_u[_h+0],11,-358537222),mE=Fi(mE,EE,vE,fE,_u[_h+3],16,-722521979),fE=Fi(fE,mE,EE,vE,_u[_h+6],23,76029189),vE=Fi(vE,fE,mE,EE,_u[_h+9],4,-640364487),EE=Fi(EE,vE,fE,mE,_u[_h+12],11,-421815835),mE=Fi(mE,EE,vE,fE,_u[_h+15],16,530742520),fE=Fi(fE,mE,EE,vE,_u[_h+2],23,-995338651),vE=_l(vE,fE,mE,EE,_u[_h+0],6,-198630844),EE=_l(EE,vE,fE,mE,_u[_h+7],10,1126891415),mE=_l(mE,EE,vE,fE,_u[_h+14],15,-1416354905),fE=_l(fE,mE,EE,vE,_u[_h+5],21,-57434055),vE=_l(vE,fE,mE,EE,_u[_h+12],6,1700485571),EE=_l(EE,vE,fE,mE,_u[_h+3],10,-1894986606),mE=_l(mE,EE,vE,fE,_u[_h+10],15,-1051523),fE=_l(fE,mE,EE,vE,_u[_h+1],21,-2054922799),vE=_l(vE,fE,mE,EE,_u[_h+8],6,1873313359),EE=_l(EE,vE,fE,mE,_u[_h+15],10,-30611744),mE=_l(mE,EE,vE,fE,_u[_h+6],15,-1560198380),fE=_l(fE,mE,EE,vE,_u[_h+13],21,1309151649),vE=_l(vE,fE,mE,EE,_u[_h+4],6,-145523070),EE=_l(EE,vE,fE,mE,_u[_h+11],10,-1120210379),mE=_l(mE,EE,vE,fE,_u[_h+2],15,718787259),fE=_l(fE,mE,EE,vE,_u[_h+9],21,-343485551),vE=z(vE,_g),fE=z(fE,eE),mE=z(mE,oE),EE=z(EE,SE);return H(vE)+H(fE)+H(mE)+H(EE)}(""+i+o)).slice(0,16),g=p.slice(0,12),b=await window.crypto.subtle.importKey("raw",p,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:g},b,l))},a4=async(l,i,o)=>await att(l.buffer,i,o);function c4(l,i){var o=Object.keys(l);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(l);i&&(p=p.filter(function(g){return Object.getOwnPropertyDescriptor(l,g).enumerable})),o.push.apply(o,p)}return o}function xS(l){for(var i=1;i<arguments.length;i++){var o=arguments[i]!=null?arguments[i]:{};i%2?c4(Object(o),!0).forEach(function(p){_e(l,p,o[p])}):Object.getOwnPropertyDescriptors?Object.defineProperties(l,Object.getOwnPropertyDescriptors(o)):c4(Object(o)).forEach(function(p){Object.defineProperty(l,p,Object.getOwnPropertyDescriptor(o,p))})}return l}class ZE extends P0{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==B0.PLAYING)}get processorContext(){return this._processorContext}set processorContext(i){this._processorContext=i}get __className__(){return"LocalVideoTrack"}constructor(i,o,p,g,b,A){if(super(i,b),_e(this,"trackMediaType","video"),_e(this,"_player",void 0),_e(this,"isUseScaleResolutionDownBy",!1),_e(this,"_videoVisibleTimer",null),_e(this,"_statsTimer",null),_e(this,"_previousVideoVisibleStatus",void 0),_e(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),_e(this,"_encoderConfig",void 0),_e(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),_e(this,"_optimizationMode",void 0),_e(this,"_videoHeight",void 0),_e(this,"_videoWidth",void 0),_e(this,"_forceBitrateLimit",void 0),_e(this,"_enabled",!0),_e(this,"processorDestination",void 0),_e(this,"_processorContext",void 0),H0()){const{width:j,height:H}=i.getSettings();this._videoWidth=j,this._videoHeight=H}else this.updateMediaStreamTrackResolution();if(this._encoderConfig=o,this._scalabilityMode=p,this._optimizationMode=g,this._hints=A||[],this._hints.indexOf(A_.SCREEN_TRACK)===-1)this.updateBitrateFromProfile();else if(function(j,H,z){const $=l_();return!($.name!==j||!$.osVersion)&&(z?Number($.version)>=H&&Number($.version)<=z:Number($.version)===H)}(m_.CHROME,115)&&aN().indexOf("Windows")!==-1){const j=function(H,z){if("VideoFrame"in window&&"TransformStream"in window&&I_().supportWebRTCInsertableStream){const $=new MediaStreamTrackProcessor(H),Vt=new MediaStreamTrackGenerator({kind:"video"});let _r,Fi,_l=Date.now();const _u=()=>{_h&&(clearInterval(_h),_h=void 0),_r&&(_r.close(),_r=void 0),H.stop(),Fi=void 0,Vt.removeEventListener("ended",_u)};let _h=window.setInterval(()=>{if(Fi&&_r&&Date.now()-_l>(z??1e3))try{Vt.readyState==="live"?Fi.enqueue(_r.clone()):_u()}catch{_u()}},z??1e3);const _g=new TransformStream({transform:(eE,oE)=>{Vt.readyState==="live"?(Fi=oE,_l=Date.now(),_r===void 0?(_r=eE,oE.enqueue(eE.clone())):(oE.enqueue(_r),_r=eE)):eE.close()}});return Vt.addEventListener("ended",_u),$.readable.pipeThrough(_g).pipeTo(Vt.writable),Vt}}(i);j&&(Gi.info("local screen video track begin to inject frame"),this._mediaStreamTrack=j)}o&&this._hints.indexOf(A_.CUSTOM_TRACK)!==-1&&this.setEncoderConfiguration(o),this.processorContext=new Q6(this.getTrackId(),"local"),this.processorDestination=new X6(this.processorContext),this.bindProcessorDestinationEvents()}play(i){let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof i=="string"){const g=document.getElementById(i);g?i=g:(Gi.warning("[".concat(this.getTrackId(),'] can not find "#').concat(i,'" element, use document.body')),i=document.body)}Gi.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(i instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(o));const p=xS(xS(xS({},this._getDefaultPlayerConfig()),o),{},{trackId:this.getTrackId(),element:i});this._player?this._player.updateConfig(p):(i instanceof HTMLVideoElement?this._player=new UM(p):this._player=new s4(p),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const g=this.getVideoElementVisibleStatus();this.safeEmit(vR.VIDEO_ELEMENT_VISIBLE_STATUS,g)}catch{}},nE("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._statsTimer&&(this.isUseScaleResolutionDownBy=!1,window.clearInterval(this._statsTimer),this._statsTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,Gi.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(i,o){if(!o){if(i===this._enabled)return;this.stateCheck("enabled",i)}if(Gi.info("[".concat(this.getTrackId(),"] start setEnabled"),i),!i){this._originMediaStreamTrack.enabled=!1;try{await S_(this,xE.NEED_DISABLE_TRACK,this)}catch(p){throw Gi.error("[".concat(this.getTrackId(),"] setEnabled to false error"),p.toString()),p}return o||(this._enabled=!1),void Gi.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await S_(this,xE.NEED_ENABLE_TRACK,this)}catch(p){throw Gi.error("[".concat(this.getTrackId(),"] setEnabled to true error"),p.toString()),p}Gi.info("[".concat(this.getTrackId(),"] setEnabled to true success")),o||(this._enabled=!0)}async setMuted(i){i!==this._muted&&(this.stateCheck("muted",i),this._muted=i,this._originMediaStreamTrack.enabled=!i,Gi.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(i)),i?await S_(this,xE.NEED_MUTE_TRACK,this):await S_(this,xE.NEED_UNMUTE_TRACK,this))}async setEncoderConfiguration(i,o){if(!this._enabled)throw new yE(_p.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(i==="720p_auto"?this.startMonitorStats():this._statsTimer&&(window.clearInterval(this._statsTimer),this._statsTimer=null),i=kT(i),this._forceBitrateLimit&&(i.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:i.bitrateMax,i.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:i.bitrateMin),i.width||i.height||i.frameRate){const p=VN({encoderConfig:i});(H0()||z0()||wT())&&(p.deviceId=void 0),Gi.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(i),JSON.stringify(p));try{await this._originMediaStreamTrack.applyConstraints(p),this.updateMediaStreamTrackResolution()}catch(g){const b=new yE(_p.UNEXPECTED_ERROR,g.toString());throw Gi.error("[".concat(this.getTrackId(),"] applyConstraints error"),b.toString()),b}}this._encoderConfig=i,this._hints.indexOf(A_.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await S_(this,xE.NEED_UPDATE_VIDEO_ENCODER,this)}catch(p){return p.throw(Gi)}}getStats(){return VO(()=>{Gi.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),oS(this,xE.GET_STATS)||xS({},IM)}async setBeautyEffect(i){Gi.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(i){let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(i,o):await MM(i)}async setBitrateLimit(i){if(Gi.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(i))),i){this._forceBitrateLimit=i,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<i.max_bitrate?this._encoderConfig.bitrateMax:i.max_bitrate:this._encoderConfig.bitrateMax=i.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=i.min_bitrate);try{await S_(this,xE.NEED_UPDATE_VIDEO_ENCODER,this)}catch(o){return o.throw(Gi)}}}async setOptimizationMode(i){if(i!=="motion"&&i!=="detail"&&i!=="balanced")return void Gi.error(_p.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");const o=this._optimizationMode;try{this._optimizationMode=i,await S_(this,xE.SET_OPTIMIZATION_MODE,this)}catch(p){throw this._optimizationMode=o,Gi.error("[".concat(this.getTrackId(),"] set optimization mode failed"),p.toString()),p}Gi.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(i,")"))}setScalabiltyMode(i){if(i.numSpatialLayers===1&&i.numTemporalLayers!==1)return Gi.error(_p.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=i,Gi.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(i,")"))}updateMediaStreamTrackResolution(){o4(this._originMediaStreamTrack).then(i=>{let[o,p]=i;this._videoHeight=p,this._videoWidth=o}).catch(pN)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}async setSenderConfiguration(i){if(!this._enabled)throw new yE(_p.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");Gi.debug("[".concat(this.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(i)),i=kT(i),this._forceBitrateLimit&&(i.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:i.bitrateMax,i.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:i.bitrateMin),this._encoderConfig=i,this._hints.indexOf(A_.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await S_(this,xE.NEED_UPDATE_VIDEO_ENCODER,this)}catch(o){return o.throw(Gi)}}updateBitrateFromProfile(){if(!this._encoderConfig)return;const{width:i,height:o,frameRate:p}=this.getMediaStreamTrackSettings();if(!i||!o||!p)return;const[g,b]=function(A,j,H,z){let $;const Vt=200*Math.pow(H/15,.6)*Math.pow(A*j/640/360,.75),_r=Vt;if(z==="STANDARD_BITRATE")$=4*Vt;else{if(z!=="COMPATIABLE_BITRATE")return;$=2*Vt}return[Math.floor($),Math.floor(_r)]}(i,o,p,nE("BITRATE_ADAPTER_TYPE"))||[void 0,void 0];this._encoderConfig.bitrateMin||this._encoderConfig.bitrateMax||(this._encoderConfig.bitrateMin=b,this._encoderConfig.bitrateMax=g,Gi.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(i,", h: ").concat(o,", fps: ").concat(p,"] => [brMax: ").concat(g,", brMin: ").concat(b,"]")))}getVideoElementVisibleStatus(){try{var i,o;const p=this==null||(i=this._player)===null||i===void 0?void 0:i.getContainerElement(),g={track:this,element:this==null||(o=this._player)===null||o===void 0?void 0:o.getVideoElement(),slot:p==null?void 0:p.parentElement},{element:b,slot:A}=g;if(this.isPlaying&&b instanceof HTMLVideoElement&&A instanceof HTMLElement){const j=JV.checkOneElementVisible(b),H=Object.assign({},j);if(H.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=H.visible;const z=jE.reportApiInvoke(null,{tag:x_.TRACER,name:e0.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});H.visible?z.onSuccess("Video is visible"):z.onSuccess("Invisible because of ".concat(H.reason))}return H}return}catch(p){throw new yE(_p.GET_VIDEO_ELEMENT_VISIBLE_ERROR,p.message)}}async renewMediaStreamTrack(i){}pipe(i){if(this.processor===i)return i;if(i._source)throw new yE(_p.INVALID_OPERATION,"Processor ".concat(i.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=i,this.processor._source=this,i.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),i}unpipe(){if(!this.processor)return;const i=this.processor;this.processor._source=void 0,this.processor=void 0,i.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(i){let o=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],p=this._encoderConfig;i&&(p=xS(xS({},p),kT(i))),p=$R(p);const g=T_(8,"track-video-cloned-"),b=new ZE(o?this._mediaStreamTrack.clone():this._mediaStreamTrack,p,$R(this._scalabilityMode),this._optimizationMode,g,$R(this._hints));return i&&p&&b.setEncoderConfiguration(p),Gi.debug("clone video track from ".concat(this.getTrackId()," to ").concat(g,", clone ").concat(o)),b}async replaceTrack(i,o){if(!(i instanceof MediaStreamTrack))throw new yE(_p.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if(i.kind!=="video")throw new yE(_p.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(i,o,!0),this.updateMediaStreamTrackResolution()}startMonitorStats(){if(!H0()&&!z0())return;this._statsTimer&&window.clearInterval(this._statsTimer);let i=2,o=PN[i],p=-1,g=Date.now();const b=A=>{A>2||A<0||(g=Date.now(),o=PN[A],this.setSenderConfiguration(o))};this.isUseScaleResolutionDownBy=!0,this._statsTimer=window.setInterval(()=>{const A=this.getStats(),j=oS(this,xE.GET_RTC_STATS);if(A.sendPackets>0&&j){p===-1&&(p=Date.now());const H=Date.now();if(H-p<1e3||H-g<nE("PROFILE_SWITCH_INTERVAL"))return;const z=A.sendFrameRate,$=.6*o.frameRate,Vt=.9*o.frameRate;typeof z=="number"&&z>0&&z<$?i>0&&(i--,b(i),Gi.debug("[".concat(this.getTrackId(),"] step down for fps ").concat(z,", switchProfile to ").concat(i))):j.OutgoingAvailableBandwidth<o.bitrateMin?i>0&&(i--,b(i),Gi.debug("[".concat(this.getTrackId(),"] step down for OutgoingAvailableBandwidth ").concat(j.OutgoingAvailableBandwidth,", bitrateMin ").concat(o.bitrateMin,", switchProfile to ").concat(i))):typeof z=="number"&&z>Vt&&i<PN.length-1&&j.OutgoingAvailableBandwidth>1.2*PN[i+1].bitrateMin&&(i++,b(i),Gi.debug("[".concat(this.getTrackId(),"] step up for fps ").concat(z,", OutgoingAvailableBandwidth ").concat(j.OutgoingAvailableBandwidth,", switchProfile to ").concat(i)))}},nE("CHECK_LOCAL_STATS_INTERVAL"))}bindProcessorDestinationEvents(){this.processorDestination.on(V0.ON_TRACK,async i=>{i?i!==this._mediaStreamTrack&&(this._mediaStreamTrack=i,this._updatePlayerSource(),await S_(this,xE.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await S_(this,xE.NEED_REPLACE_TRACK,this))})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(V0.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(dS.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(dS.REQUEST_CONSTRAINTS)}}bE([HE({argsMap:(l,i,o)=>[l.getTrackId(),typeof i=="string"?i:i instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",o]}),H_(),kc("design:type",Function),kc("design:paramtypes",[Object,Object]),kc("design:returntype",void 0)],ZE.prototype,"play",null),bE([HE({argsMap:l=>[l.getTrackId()]}),kc("design:type",Function),kc("design:paramtypes",[]),kc("design:returntype",void 0)],ZE.prototype,"stop",null),bE([GI("LocalVideoTrack","_enabledMutex"),HE({argsMap:(l,i)=>[l.getTrackId(),i]}),H_(),kc("design:type",Function),kc("design:paramtypes",[Boolean,Boolean]),kc("design:returntype",pE)],ZE.prototype,"setEnabled",null),bE([GI("LocalVideoTrack","_enabledMutex"),HE({argsMap:(l,i)=>[l.getTrackId(),i]}),H_(),kc("design:type",Function),kc("design:paramtypes",[Boolean]),kc("design:returntype",pE)],ZE.prototype,"setMuted",null),bE([HE({argsMap:(l,i)=>[l.getTrackId(),i]}),H_(),kc("design:type",Function),kc("design:paramtypes",[Object,Boolean]),kc("design:returntype",pE)],ZE.prototype,"setEncoderConfiguration",null),bE([H_(),kc("design:type",Function),kc("design:paramtypes",[]),kc("design:returntype",Object)],ZE.prototype,"getStats",null),bE([HE({argsMap:(l,i,o)=>[l.getTrackId(),i,o]}),H_(),kc("design:type",Function),kc("design:paramtypes",[Boolean,Object]),kc("design:returntype",pE)],ZE.prototype,"setBeautyEffect",null),bE([H_(),kc("design:type",Function),kc("design:paramtypes",[]),kc("design:returntype",ImageData)],ZE.prototype,"getCurrentFrameData",null),bE([H_(),kc("design:type",Function),kc("design:paramtypes",[String,Number]),kc("design:returntype",pE)],ZE.prototype,"getCurrentFrameImage",null),bE([H_(),kc("design:type",Function),kc("design:paramtypes",[Object]),kc("design:returntype",pE)],ZE.prototype,"setBitrateLimit",null),bE([H_(),kc("design:type",Function),kc("design:paramtypes",[String]),kc("design:returntype",pE)],ZE.prototype,"setOptimizationMode",null),bE([H_(),kc("design:type",Function),kc("design:paramtypes",[Object]),kc("design:returntype",void 0)],ZE.prototype,"setScalabiltyMode",null),bE([H_(),kc("design:type",Function),kc("design:paramtypes",[]),kc("design:returntype",void 0)],ZE.prototype,"updateMediaStreamTrackResolution",null),bE([HE({argsMap:(l,i)=>[l.getTrackId(),i.name]}),kc("design:type",Function),kc("design:paramtypes",[Object]),kc("design:returntype",Object)],ZE.prototype,"pipe",null),bE([HE({argsMap:l=>[l.getTrackId()]}),kc("design:type",Function),kc("design:paramtypes",[]),kc("design:returntype",void 0)],ZE.prototype,"unpipe",null),bE([HE({argsMap:l=>[l.getTrackId()]}),kc("design:type",Function),kc("design:paramtypes",[]),kc("design:returntype",void 0)],ZE.prototype,"close",null),bE([HE({argsMap:(l,i,o)=>[l.getTrackId(),i.label,o]}),kc("design:type",Function),kc("design:paramtypes",[MediaStreamTrack,Boolean]),kc("design:returntype",pE)],ZE.prototype,"replaceTrack",null),bE([HE(),kc("design:type",Function),kc("design:paramtypes",[]),kc("design:returntype",void 0)],ZE.prototype,"startMonitorStats",null);class bR extends ZE{get __className__(){return"CameraVideoTrack"}constructor(i,o,p,g,b,A){super(i,kT(o.encoderConfig),g,b,A),_e(this,"_config",void 0),_e(this,"_originalConstraints",void 0),_e(this,"_constraints",void 0),_e(this,"_enabled",!0),_e(this,"_deviceName","default"),_e(this,"tryResumeVideoForIOS15_16WeChat",async()=>{(FI()||ML())&&!function(){const j=l_();if(j.os!==l0.IOS||!j.osVersion)return!1;const H=j.osVersion.split(".");return Number(H[0])===15&&Number(H[1])>=2}()&&WV()&&this._enabled&&!this._isClosed&&(Gi.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())}),this._config=o,this._originalConstraints=p,this._constraints=p,this._deviceName=i.label,this._encoderConfig=kT(this._config.encoderConfig),__.on(_0.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),__.on(_0.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(i){return typeof i=="string"?this._setDeviceById(i):i.deviceId?this._setDeviceById(i.deviceId):i.facingMode?this._setDeviceByFacingModel(i.facingMode):void 0}async _setDeviceById(i){if(Gi.info("[".concat(this.getTrackId(),"] set device to ").concat(i)),this._enabled)try{const o=await DS.getDeviceById(i),p={};p.video=xS({},this._constraints),p.video.deviceId={exact:i},p.video.facingMode=void 0,this._originMediaStreamTrack.stop();let g=null;try{g=await kS(p,this.getTrackId())}catch(b){throw Gi.error("[".concat(this.getTrackId(),"] setDevice failed"),b.toString()),g=await kS({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(g.getVideoTracks()[0],!1),b}await this._updateOriginMediaStreamTrack(g.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=o.label,this._config.cameraId=i,this._constraints.deviceId={exact:i}}catch(o){throw Gi.error("[".concat(this.getTrackId(),"] setDevice error"),o.toString()),o}else try{const o=await DS.getDeviceById(i);this._deviceName=o.label,this._config.cameraId=i,this._constraints.deviceId={exact:i}}catch(o){throw Gi.error("[".concat(this.getTrackId(),"] setDevice error"),o.toString()),o}Gi.info("[".concat(this.getTrackId(),"] setDevice success"))}async _setDeviceByFacingModel(i){Gi.info("[".concat(this.getTrackId(),"] set facingMode ").concat(i));const o={video:xS(xS({},this._constraints),{},{deviceId:void 0,facingMode:{exact:i}})};if(this._enabled){this._originMediaStreamTrack.stop();let p=null;try{p=await kS(o,this.getTrackId())}catch(g){throw Gi.error("[".concat(this.getTrackId(),"] setDeviceByFacingModel failed"),g.toString()),p=await kS({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(p.getVideoTracks()[0],!1),g}await this._updateOriginMediaStreamTrack(p.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution()}this._deviceName="",this._config.facingMode=i,this._config.cameraId=void 0,this._constraints=xS({},o.video),Gi.info("[".concat(this.getTrackId(),"] setDeviceByFacingModel success"))}async setEnabled(i,o){if(!o){if(i===this._enabled)return;this.stateCheck("enabled",i)}if(Gi.info("[".concat(this.getTrackId(),"] start setEnabled"),i),i){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{const p=await kS({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(p.getVideoTracks()[0],!1)}await S_(this,xE.NEED_ENABLE_TRACK,this)}catch(p){throw Gi.error("[".concat(this.getTrackId(),"] setEnabled true error"),p.toString()),p}this.updateMediaStreamTrackResolution(),Gi.info("[".concat(this.getTrackId(),"] setEnabled to true success")),o||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),o||(this._enabled=!1);try{await S_(this,xE.NEED_DISABLE_TRACK,this)}catch(p){throw Gi.error("[".concat(this.getTrackId(),"] setEnabled to false error"),p.toString()),p}Gi.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(i,o){if(!this._enabled)throw new yE(_p.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");i==="720p_auto"?this.startMonitorStats():this._statsTimer&&(window.clearInterval(this._statsTimer),this._statsTimer=null),i=kT(i),this._forceBitrateLimit&&(i.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:i.bitrateMax,i.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:i.bitrateMin);const p=Q_(this._config);p.encoderConfig=i;const g=VN(p);(H0()||z0()||wT())&&(g.deviceId=void 0),Gi.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(i),JSON.stringify(g));try{await this._originMediaStreamTrack.applyConstraints(g),this.updateMediaStreamTrackResolution()}catch(b){const A=new yE(_p.UNEXPECTED_ERROR,b.toString());throw Gi.error("[".concat(this.getTrackId(),"] applyConstraints error"),A.toString()),A}this._config=p,this._constraints=g,this._originalConstraints=g,this._encoderConfig=i,this._hints.indexOf(A_.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await S_(this,xE.NEED_UPDATE_VIDEO_ENCODER,this)}catch(b){return b.throw(Gi)}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((z0()||wT())&&this._enabled&&!this._isClosed&&__.duringInterruption){const i=async()=>{__.off(_0.IOS_INTERRUPTION_END,i),this._enabled&&!this._isClosed&&(Gi.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};__.on(_0.IOS_INTERRUPTION_END,i)}else Gi.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(vR.TRACK_ENDED)}async renewMediaStreamTrack(i){const o=i||this._constraints,p=DS.searchDeviceIdByName(this._deviceName);if(p&&!o.deviceId&&(o.deviceId={exact:p}),this._enabled){const g=await kS({video:o},this.getTrackId());this._constraints=o,await this._updateOriginMediaStreamTrack(g.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),__.off(_0.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),__.off(_0.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(i){let o=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],p=this._encoderConfig;i&&(p=xS(xS({},p),kT(i))),p=$R(p);const g=T_(8,"track-cam-cloned-"),b=new bR(o?this._mediaStreamTrack.clone():this._mediaStreamTrack,$R(xS(xS({},this._config),{},{encoderConfig:p})),$R(this._constraints),$R(this._scalabilityMode),this._optimizationMode,g);return i&&p&&b.setEncoderConfiguration(p),Gi.debug("clone track from ".concat(this.getTrackId()," to ").concat(g,", clone ").concat(o)),b}bindProcessorContextEvents(){this.processorContext.on(dS.REQUEST_UPDATE_CONSTRAINTS,async(i,o,p)=>{try{const g=Object.assign({},this._originalConstraints,...i);await this.renewMediaStreamTrack(g),o()}catch(g){p(g)}}),this.processorContext.on(dS.REQUEST_CONSTRAINTS,async i=>{i(this._originMediaStreamTrack.getSettings())})}}function u4(l,i){var o=Object.keys(l);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(l);i&&(p=p.filter(function(g){return Object.getOwnPropertyDescriptor(l,g).enumerable})),o.push.apply(o,p)}return o}function BN(l){for(var i=1;i<arguments.length;i++){var o=arguments[i]!=null?arguments[i]:{};i%2?u4(Object(o),!0).forEach(function(p){_e(l,p,o[p])}):Object.getOwnPropertyDescriptors?Object.defineProperties(l,Object.getOwnPropertyDescriptors(o)):u4(Object(o)).forEach(function(p){Object.defineProperty(l,p,Object.getOwnPropertyDescriptor(o,p))})}return l}function FM(l,i,o,p){o.optimizationMode&&(p&&p.width&&p.height?(o.encoderConfig=BN(BN({},p),{},{bitrateMin:p.bitrateMin,bitrateMax:p.bitrateMax}),o.optimizationMode!=="motion"&&o.optimizationMode!=="detail"||(i.contentHint=o.optimizationMode,i.contentHint===o.optimizationMode?Gi.debug("[".concat(l,"] set content hint to"),o.optimizationMode):Gi.debug("[".concat(l,"] set content hint failed")))):Gi.warning("[".concat(l,"] can not apply optimization mode bitrate config, no encoderConfig")))}function l4(l,i){var o=Object.keys(l);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(l);i&&(p=p.filter(function(g){return Object.getOwnPropertyDescriptor(l,g).enumerable})),o.push.apply(o,p)}return o}function GN(l){for(var i=1;i<arguments.length;i++){var o=arguments[i]!=null?arguments[i]:{};i%2?l4(Object(o),!0).forEach(function(p){_e(l,p,o[p])}):Object.getOwnPropertyDescriptors?Object.defineProperties(l,Object.getOwnPropertyDescriptors(o)):l4(Object(o)).forEach(function(p){Object.defineProperty(l,p,Object.getOwnPropertyDescriptor(o,p))})}return l}bE([HE({argsMap:(l,i)=>[l.getTrackId(),i]}),H_(),kc("design:type",Function),kc("design:paramtypes",[Object]),kc("design:returntype",pE)],bR.prototype,"setDevice",null),bE([GI("CameraVideoTrack","_enabledMutex"),HE({argsMap:(l,i)=>[l.getTrackId(),i]}),H_(),kc("design:type",Function),kc("design:paramtypes",[Boolean,Boolean]),kc("design:returntype",pE)],bR.prototype,"setEnabled",null),bE([HE({argsMap:(l,i)=>[l.getTrackId(),i]}),H_(),kc("design:type",Function),kc("design:paramtypes",[Object,Boolean]),kc("design:returntype",pE)],bR.prototype,"setEncoderConfiguration",null),bE([HE({argsMap:l=>[l.getTrackId()]}),kc("design:type",Function),kc("design:paramtypes",[]),kc("design:returntype",void 0)],bR.prototype,"close",null);class d4 extends L6{getUserId(){return this._userId}constructor(i,o,p,g){super(i,"track-".concat(i.kind,"-").concat(o,"-").concat(g.clientId,"_").concat(T_(5,""))),_e(this,"_userId",void 0),_e(this,"_uintId",void 0),_e(this,"_isDestroyed",!1),_e(this,"store",void 0),_e(this,"processor",void 0),this._userId=o,this._uintId=p,this.store=g}_updateOriginMediaStreamTrack(i){this._originMediaStreamTrack=i,this._mediaStreamTrack=i,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,Gi.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}class DT extends d4{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==B0.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(i,o,p,g){super(i,o,p,g),_e(this,"_videoVisibleTimer",null),_e(this,"_previousVideoVisibleStatus",void 0),_e(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),_e(this,"trackMediaType","video"),_e(this,"_videoWidth",void 0),_e(this,"_videoHeight",void 0),_e(this,"_player",void 0),_e(this,"processorDestination",void 0),_e(this,"processorContext",void 0),this.updateMediaStreamTrackResolution(),this.processorContext=new Q6(this.getTrackId(),"remote"),this.processorDestination=new X6(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return VO(()=>{Gi.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),oS(this,xE.GET_STATS)||GN({},D6)}play(i){let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof i=="string"){const g=document.getElementById(i);g?i=g:(Gi.warning("[".concat(this.getTrackId(),'] can not find "#').concat(i,'" element, use document.body')),i=document.body)}Gi.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(i instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(o));const p=GN(GN({fit:"cover"},o),{},{trackId:this.getTrackId(),element:i});this._player?this._player.updateConfig(p):(i instanceof HTMLVideoElement?this._player=new UM(p):this._player=new s4(p),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(sI.FIRST_FRAME_DECODED)}),this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const g=this.getVideoElementVisibleStatus();this.safeEmit(sI.VIDEO_ELEMENT_VISIBLE_STATUS,g)}catch{}},nE("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,Gi.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){o4(this._originMediaStreamTrack).then(i=>{let[o,p]=i;this._videoHeight=p,this._videoWidth=o}).catch(pN)}_updatePlayerSource(){Gi.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var i,o;const p=this==null||(i=this._player)===null||i===void 0?void 0:i.getContainerElement(),g={track:this,element:this==null||(o=this._player)===null||o===void 0?void 0:o.getVideoElement(),slot:p==null?void 0:p.parentElement},{element:b,slot:A}=g;if(this.isPlaying&&b instanceof HTMLVideoElement&&A instanceof HTMLElement){const j=JV.checkOneElementVisible(b),H=Object.assign({},j);if(H.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=H.visible;const z=jE.reportApiInvoke(null,{tag:x_.TRACER,name:e0.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});H.visible?z.onSuccess("Video is visible"):z.onSuccess("Invisible because of ".concat(H.reason))}return H}return}catch(p){throw new yE(_p.GET_VIDEO_ELEMENT_VISIBLE_ERROR,p.message)}}pipe(i){if(this.processor===i)return i;if(i._source)throw new yE(_p.INVALID_OPERATION,"Processor ".concat(i.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=i,this.processor._source=this,i.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),i}unpipe(){if(!this.processor)return;const i=this.processor;this.processor._source=void 0,this.processor=void 0,i.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(V0.ON_TRACK,async i=>{i?i!==this._mediaStreamTrack&&(this._mediaStreamTrack=i,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(V0.ON_TRACK)}_destroy(){super._destroy(),this.unbindProcessorDestinationEvents()}}bE([HE({argsMap:(l,i,o)=>[l.getTrackId(),typeof i=="string"?i:i instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",o]}),kc("design:type",Function),kc("design:paramtypes",[Object,Object]),kc("design:returntype",void 0)],DT.prototype,"play",null),bE([HE({argsMap:l=>[l.getTrackId()]}),kc("design:type",Function),kc("design:paramtypes",[]),kc("design:returntype",void 0)],DT.prototype,"stop",null),bE([HE({argsMap:(l,i)=>[l.getTrackId(),i.name]}),kc("design:type",Function),kc("design:paramtypes",[Object]),kc("design:returntype",Object)],DT.prototype,"pipe",null),bE([HE({argsMap:l=>[l.getTrackId()]}),kc("design:type",Function),kc("design:paramtypes",[]),kc("design:returntype",void 0)],DT.prototype,"unpipe",null);class cT extends d4{get isPlaying(){return this._useAudioElement?vS.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(i,o,p,g){super(i,o,p,g),_e(this,"trackMediaType","audio"),_e(this,"_source",void 0),_e(this,"_useAudioElement",!0),_e(this,"_volume",100),_e(this,"processorContext",void 0),_e(this,"processorDestination",void 0),_e(this,"_played",!1),_e(this,"_bypassWebAudio",!1),nE("DISABLE_WEBAUDIO")?(this._source=new DM,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new NM(i,!0),nE("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(lS.RECEIVE_TRACK_BUFFER,()=>{this.safeEmit(sI.FIRST_FRAME_DECODED)}),this.processorContext=new jN(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new FN(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(lS.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(i){let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!i)return this._source.removeAllListeners(lS.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(o),this._source.removeAllListeners(lS.ON_AUDIO_BUFFER),this._source.on(lS.ON_AUDIO_BUFFER,p=>i(p))}setVolume(i){this._volume=i,this._useAudioElement?vS.setVolume(this.getTrackId(),i):this._source.setVolume(i/100)}async setPlaybackDevice(i){if(!this._useAudioElement)throw new yE(_p.NOT_SUPPORTED,"your browser does not support setting the audio output device");await vS.setSinkID(this.getTrackId(),i)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return VO(()=>{Gi.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),oS(this,xE.GET_STATS)||GN({},k6)}play(){Gi.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(Gi.debug("[".concat(this.getTrackId(),"] use audio element to play")),vS.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){Gi.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?vS.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let i=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];Gi.debug("[".concat(this.getTrackId(),"] update player source track")),i&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&vS.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(i){if(this._bypassWebAudio)throw new yE(_p.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===i)return i;if(i._source)throw new yE(_p.INVALID_OPERATION,"Processor ".concat(i.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=i,this.processor._source=this,i.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),i}unpipe(){var i;if(this._bypassWebAudio)throw new yE(_p.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;const o=this.processor;(i=this._source.processSourceNode)===null||i===void 0||i.disconnect(),this.processor._source=!1,this.processor=void 0,o.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(V0.ON_TRACK,async i=>{i?i!==this._mediaStreamTrack&&(this._mediaStreamTrack=i,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(i)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}),this.processorDestination.on(V0.ON_NODE,i=>{this._source.processedNode=i;const o=!i;this._useAudioElement!==o&&(this._played?(this.stop(),this._useAudioElement=o,this.play()):this._useAudioElement=o)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(V0.ON_TRACK),this.processorDestination.removeAllListeners(V0.ON_NODE)}}bE([HE({argsMap:(l,i)=>[l.getTrackId(),i],throttleTime:300}),kc("design:type",Function),kc("design:paramtypes",[Number]),kc("design:returntype",void 0)],cT.prototype,"setVolume",null),bE([HE({argsMap:(l,i)=>[l.getTrackId(),i]}),kc("design:type",Function),kc("design:paramtypes",[String]),kc("design:returntype",pE)],cT.prototype,"setPlaybackDevice",null),bE([HE({argsMap:l=>[l.getTrackId()]}),kc("design:type",Function),kc("design:paramtypes",[]),kc("design:returntype",void 0)],cT.prototype,"play",null),bE([HE({argsMap:l=>[l.getTrackId()]}),kc("design:type",Function),kc("design:paramtypes",[]),kc("design:returntype",void 0)],cT.prototype,"stop",null),bE([HE({argsMap:(l,i)=>[l.getTrackId(),i.name]}),kc("design:type",Function),kc("design:paramtypes",[Object]),kc("design:returntype",Object)],cT.prototype,"pipe",null),bE([HE({argsMap:l=>[l.getTrackId()]}),kc("design:type",Function),kc("design:paramtypes",[]),kc("design:returntype",void 0)],cT.prototype,"unpipe",null);function eO(l){let i=l.length;for(;--i>=0;)l[i]=0}const jM=256,h4=286,KO=30,YO=15,VM=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),qN=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),ctt=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),p4=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),$T=new Array(576);eO($T);const JO=new Array(60);eO(JO);const XO=new Array(512);eO(XO);const QO=new Array(256);eO(QO);const BM=new Array(29);eO(BM);const WN=new Array(KO);function GM(l,i,o,p,g){this.static_tree=l,this.extra_bits=i,this.extra_base=o,this.elems=p,this.max_length=g,this.has_stree=l&&l.length}let f4,m4,g4;function qM(l,i){this.dyn_tree=l,this.max_code=0,this.stat_desc=i}eO(WN);const E4=l=>l<256?XO[l]:XO[256+(l>>>7)],$O=(l,i)=>{l.pending_buf[l.pending++]=255&i,l.pending_buf[l.pending++]=i>>>8&255},MS=(l,i,o)=>{l.bi_valid>16-o?(l.bi_buf|=i<<l.bi_valid&65535,$O(l,l.bi_buf),l.bi_buf=i>>16-l.bi_valid,l.bi_valid+=o-16):(l.bi_buf|=i<<l.bi_valid&65535,l.bi_valid+=o)},LT=(l,i,o)=>{MS(l,o[2*i],o[2*i+1])},v4=(l,i)=>{let o=0;do o|=1&l,l>>>=1,o<<=1;while(--i>0);return o>>>1},_4=(l,i,o)=>{const p=new Array(16);let g,b,A=0;for(g=1;g<=YO;g++)A=A+o[g-1]<<1,p[g]=A;for(b=0;b<=i;b++){let j=l[2*b+1];j!==0&&(l[2*b]=v4(p[j]++,j))}},y4=l=>{let i;for(i=0;i<h4;i++)l.dyn_ltree[2*i]=0;for(i=0;i<KO;i++)l.dyn_dtree[2*i]=0;for(i=0;i<19;i++)l.bl_tree[2*i]=0;l.dyn_ltree[512]=1,l.opt_len=l.static_len=0,l.sym_next=l.matches=0},b4=l=>{l.bi_valid>8?$O(l,l.bi_buf):l.bi_valid>0&&(l.pending_buf[l.pending++]=l.bi_buf),l.bi_buf=0,l.bi_valid=0},S4=(l,i,o,p)=>{const g=2*i,b=2*o;return l[g]<l[b]||l[g]===l[b]&&p[i]<=p[o]},WM=(l,i,o)=>{const p=l.heap[o];let g=o<<1;for(;g<=l.heap_len&&(g<l.heap_len&&S4(i,l.heap[g+1],l.heap[g],l.depth)&&g++,!S4(i,p,l.heap[g],l.depth));)l.heap[o]=l.heap[g],o=g,g<<=1;l.heap[o]=p},T4=(l,i,o)=>{let p,g,b,A,j=0;if(l.sym_next!==0)do p=255&l.pending_buf[l.sym_buf+j++],p+=(255&l.pending_buf[l.sym_buf+j++])<<8,g=l.pending_buf[l.sym_buf+j++],p===0?LT(l,g,i):(b=QO[g],LT(l,b+jM+1,i),A=VM[b],A!==0&&(g-=BM[b],MS(l,g,A)),p--,b=E4(p),LT(l,b,o),A=qN[b],A!==0&&(p-=WN[b],MS(l,p,A)));while(j<l.sym_next);LT(l,256,i)},HM=(l,i)=>{const o=i.dyn_tree,p=i.stat_desc.static_tree,g=i.stat_desc.has_stree,b=i.stat_desc.elems;let A,j,H,z=-1;for(l.heap_len=0,l.heap_max=573,A=0;A<b;A++)o[2*A]!==0?(l.heap[++l.heap_len]=z=A,l.depth[A]=0):o[2*A+1]=0;for(;l.heap_len<2;)H=l.heap[++l.heap_len]=z<2?++z:0,o[2*H]=1,l.depth[H]=0,l.opt_len--,g&&(l.static_len-=p[2*H+1]);for(i.max_code=z,A=l.heap_len>>1;A>=1;A--)WM(l,o,A);H=b;do A=l.heap[1],l.heap[1]=l.heap[l.heap_len--],WM(l,o,1),j=l.heap[1],l.heap[--l.heap_max]=A,l.heap[--l.heap_max]=j,o[2*H]=o[2*A]+o[2*j],l.depth[H]=(l.depth[A]>=l.depth[j]?l.depth[A]:l.depth[j])+1,o[2*A+1]=o[2*j+1]=H,l.heap[1]=H++,WM(l,o,1);while(l.heap_len>=2);l.heap[--l.heap_max]=l.heap[1],(($,Vt)=>{const _r=Vt.dyn_tree,Fi=Vt.max_code,_l=Vt.stat_desc.static_tree,_u=Vt.stat_desc.has_stree,_h=Vt.stat_desc.extra_bits,_g=Vt.stat_desc.extra_base,eE=Vt.stat_desc.max_length;let oE,SE,vE,fE,mE,EE,PE=0;for(fE=0;fE<=YO;fE++)$.bl_count[fE]=0;for(_r[2*$.heap[$.heap_max]+1]=0,oE=$.heap_max+1;oE<573;oE++)SE=$.heap[oE],fE=_r[2*_r[2*SE+1]+1]+1,fE>eE&&(fE=eE,PE++),_r[2*SE+1]=fE,SE>Fi||($.bl_count[fE]++,mE=0,SE>=_g&&(mE=_h[SE-_g]),EE=_r[2*SE],$.opt_len+=EE*(fE+mE),_u&&($.static_len+=EE*(_l[2*SE+1]+mE)));if(PE!==0){do{for(fE=eE-1;$.bl_count[fE]===0;)fE--;$.bl_count[fE]--,$.bl_count[fE+1]+=2,$.bl_count[eE]--,PE-=2}while(PE>0);for(fE=eE;fE!==0;fE--)for(SE=$.bl_count[fE];SE!==0;)vE=$.heap[--oE],vE>Fi||(_r[2*vE+1]!==fE&&($.opt_len+=(fE-_r[2*vE+1])*_r[2*vE],_r[2*vE+1]=fE),SE--)}})(l,i),_4(o,z,l.bl_count)},C4=(l,i,o)=>{let p,g,b=-1,A=i[1],j=0,H=7,z=4;for(A===0&&(H=138,z=3),i[2*(o+1)+1]=65535,p=0;p<=o;p++)g=A,A=i[2*(p+1)+1],++j<H&&g===A||(j<z?l.bl_tree[2*g]+=j:g!==0?(g!==b&&l.bl_tree[2*g]++,l.bl_tree[32]++):j<=10?l.bl_tree[34]++:l.bl_tree[36]++,j=0,b=g,A===0?(H=138,z=3):g===A?(H=6,z=3):(H=7,z=4))},R4=(l,i,o)=>{let p,g,b=-1,A=i[1],j=0,H=7,z=4;for(A===0&&(H=138,z=3),p=0;p<=o;p++)if(g=A,A=i[2*(p+1)+1],!(++j<H&&g===A)){if(j<z)do LT(l,g,l.bl_tree);while(--j!=0);else g!==0?(g!==b&&(LT(l,g,l.bl_tree),j--),LT(l,16,l.bl_tree),MS(l,j-3,2)):j<=10?(LT(l,17,l.bl_tree),MS(l,j-3,3)):(LT(l,18,l.bl_tree),MS(l,j-11,7));j=0,b=g,A===0?(H=138,z=3):g===A?(H=6,z=3):(H=7,z=4)}};let I4=!1;const w4=(l,i,o,p)=>{MS(l,0+(p?1:0),3),b4(l),$O(l,o),$O(l,~o),o&&l.pending_buf.set(l.window.subarray(i,i+o),l.pending),l.pending+=o};var utt=l=>{I4||((()=>{let i,o,p,g,b;const A=new Array(16);for(p=0,g=0;g<28;g++)for(BM[g]=p,i=0;i<1<<VM[g];i++)QO[p++]=g;for(QO[p-1]=g,b=0,g=0;g<16;g++)for(WN[g]=b,i=0;i<1<<qN[g];i++)XO[b++]=g;for(b>>=7;g<KO;g++)for(WN[g]=b<<7,i=0;i<1<<qN[g]-7;i++)XO[256+b++]=g;for(o=0;o<=YO;o++)A[o]=0;for(i=0;i<=143;)$T[2*i+1]=8,i++,A[8]++;for(;i<=255;)$T[2*i+1]=9,i++,A[9]++;for(;i<=279;)$T[2*i+1]=7,i++,A[7]++;for(;i<=287;)$T[2*i+1]=8,i++,A[8]++;for(_4($T,287,A),i=0;i<KO;i++)JO[2*i+1]=5,JO[2*i]=v4(i,5);f4=new GM($T,VM,257,h4,YO),m4=new GM(JO,qN,0,KO,YO),g4=new GM(new Array(0),ctt,0,19,7)})(),I4=!0),l.l_desc=new qM(l.dyn_ltree,f4),l.d_desc=new qM(l.dyn_dtree,m4),l.bl_desc=new qM(l.bl_tree,g4),l.bi_buf=0,l.bi_valid=0,y4(l)},ltt=(l,i,o,p)=>{let g,b,A=0;l.level>0?(l.strm.data_type===2&&(l.strm.data_type=(j=>{let H,z=4093624447;for(H=0;H<=31;H++,z>>>=1)if(1&z&&j.dyn_ltree[2*H]!==0)return 0;if(j.dyn_ltree[18]!==0||j.dyn_ltree[20]!==0||j.dyn_ltree[26]!==0)return 1;for(H=32;H<jM;H++)if(j.dyn_ltree[2*H]!==0)return 1;return 0})(l)),HM(l,l.l_desc),HM(l,l.d_desc),A=(j=>{let H;for(C4(j,j.dyn_ltree,j.l_desc.max_code),C4(j,j.dyn_dtree,j.d_desc.max_code),HM(j,j.bl_desc),H=18;H>=3&&j.bl_tree[2*p4[H]+1]===0;H--);return j.opt_len+=3*(H+1)+5+5+4,H})(l),g=l.opt_len+3+7>>>3,b=l.static_len+3+7>>>3,b<=g&&(g=b)):g=b=o+5,o+4<=g&&i!==-1?w4(l,i,o,p):l.strategy===4||b===g?(MS(l,2+(p?1:0),3),T4(l,$T,JO)):(MS(l,4+(p?1:0),3),((j,H,z,$)=>{let Vt;for(MS(j,H-257,5),MS(j,z-1,5),MS(j,$-4,4),Vt=0;Vt<$;Vt++)MS(j,j.bl_tree[2*p4[Vt]+1],3);R4(j,j.dyn_ltree,H-1),R4(j,j.dyn_dtree,z-1)})(l,l.l_desc.max_code+1,l.d_desc.max_code+1,A+1),T4(l,l.dyn_ltree,l.dyn_dtree)),y4(l),p&&b4(l)},dtt=(l,i,o)=>(l.pending_buf[l.sym_buf+l.sym_next++]=i,l.pending_buf[l.sym_buf+l.sym_next++]=i>>8,l.pending_buf[l.sym_buf+l.sym_next++]=o,i===0?l.dyn_ltree[2*o]++:(l.matches++,i--,l.dyn_ltree[2*(QO[o]+jM+1)]++,l.dyn_dtree[2*E4(i)]++),l.sym_next===l.sym_end),htt={_tr_init:utt,_tr_stored_block:w4,_tr_flush_block:ltt,_tr_tally:dtt,_tr_align:l=>{MS(l,2,3),LT(l,256,$T),(i=>{i.bi_valid===16?($O(i,i.bi_buf),i.bi_buf=0,i.bi_valid=0):i.bi_valid>=8&&(i.pending_buf[i.pending++]=255&i.bi_buf,i.bi_buf>>=8,i.bi_valid-=8)})(l)}},ZO=(l,i,o,p)=>{let g=65535&l|0,b=l>>>16&65535|0,A=0;for(;o!==0;){A=o>2e3?2e3:o,o-=A;do g=g+i[p++]|0,b=b+g|0;while(--A);g%=65521,b%=65521}return g|b<<16|0};const ptt=new Uint32Array((()=>{let l,i=[];for(var o=0;o<256;o++){l=o;for(var p=0;p<8;p++)l=1&l?3988292384^l>>>1:l>>>1;i[o]=l}return i})());var _b=(l,i,o,p)=>{const g=ptt,b=p+o;l^=-1;for(let A=p;A<b;A++)l=l>>>8^g[255&(l^i[A])];return-1^l},cI={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},nO={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:ftt,_tr_stored_block:zM,_tr_flush_block:mtt,_tr_tally:SR,_tr_align:gtt}=htt,{Z_NO_FLUSH:TR,Z_PARTIAL_FLUSH:Ett,Z_FULL_FLUSH:vtt,Z_FINISH:uT,Z_BLOCK:A4,Z_OK:eS,Z_STREAM_END:O4,Z_STREAM_ERROR:xT,Z_DATA_ERROR:_tt,Z_BUF_ERROR:KM,Z_DEFAULT_COMPRESSION:ytt,Z_FILTERED:btt,Z_HUFFMAN_ONLY:HN,Z_RLE:Stt,Z_FIXED:Ttt,Z_DEFAULT_STRATEGY:Ctt,Z_UNKNOWN:Rtt,Z_DEFLATED:zN}=nO,YM=286,Itt=30,wtt=19,Att=2*YM+1,Ott=15,uI=258,MT=262,rO=42,lI=113,t1=666,dI=(l,i)=>(l.msg=cI[i],i),N4=l=>2*l-(l>4?9:0),CR=l=>{let i=l.length;for(;--i>=0;)l[i]=0},Ntt=l=>{let i,o,p,g=l.w_size;i=l.hash_size,p=i;do o=l.head[--p],l.head[p]=o>=g?o-g:0;while(--i);i=g,p=i;do o=l.prev[--p],l.prev[p]=o>=g?o-g:0;while(--i)};let RR=(l,i,o)=>(i<<l.hash_shift^o)&l.hash_mask;const zS=l=>{const i=l.state;let o=i.pending;o>l.avail_out&&(o=l.avail_out),o!==0&&(l.output.set(i.pending_buf.subarray(i.pending_out,i.pending_out+o),l.next_out),l.next_out+=o,i.pending_out+=o,l.total_out+=o,l.avail_out-=o,i.pending-=o,i.pending===0&&(i.pending_out=0))},KS=(l,i)=>{mtt(l,l.block_start>=0?l.block_start:-1,l.strstart-l.block_start,i),l.block_start=l.strstart,zS(l.strm)},G_=(l,i)=>{l.pending_buf[l.pending++]=i},e1=(l,i)=>{l.pending_buf[l.pending++]=i>>>8&255,l.pending_buf[l.pending++]=255&i},JM=(l,i,o,p)=>{let g=l.avail_in;return g>p&&(g=p),g===0?0:(l.avail_in-=g,i.set(l.input.subarray(l.next_in,l.next_in+g),o),l.state.wrap===1?l.adler=ZO(l.adler,i,g,o):l.state.wrap===2&&(l.adler=_b(l.adler,i,g,o)),l.next_in+=g,l.total_in+=g,g)},P4=(l,i)=>{let o,p,g=l.max_chain_length,b=l.strstart,A=l.prev_length,j=l.nice_match;const H=l.strstart>l.w_size-MT?l.strstart-(l.w_size-MT):0,z=l.window,$=l.w_mask,Vt=l.prev,_r=l.strstart+uI;let Fi=z[b+A-1],_l=z[b+A];l.prev_length>=l.good_match&&(g>>=2),j>l.lookahead&&(j=l.lookahead);do if(o=i,z[o+A]===_l&&z[o+A-1]===Fi&&z[o]===z[b]&&z[++o]===z[b+1]){b+=2,o++;do;while(z[++b]===z[++o]&&z[++b]===z[++o]&&z[++b]===z[++o]&&z[++b]===z[++o]&&z[++b]===z[++o]&&z[++b]===z[++o]&&z[++b]===z[++o]&&z[++b]===z[++o]&&b<_r);if(p=uI-(_r-b),b=_r-uI,p>A){if(l.match_start=i,A=p,p>=j)break;Fi=z[b+A-1],_l=z[b+A]}}while((i=Vt[i&$])>H&&--g!=0);return A<=l.lookahead?A:l.lookahead},iO=l=>{const i=l.w_size;let o,p,g;do{if(p=l.window_size-l.lookahead-l.strstart,l.strstart>=i+(i-MT)&&(l.window.set(l.window.subarray(i,i+i-p),0),l.match_start-=i,l.strstart-=i,l.block_start-=i,l.insert>l.strstart&&(l.insert=l.strstart),Ntt(l),p+=i),l.strm.avail_in===0)break;if(o=JM(l.strm,l.window,l.strstart+l.lookahead,p),l.lookahead+=o,l.lookahead+l.insert>=3)for(g=l.strstart-l.insert,l.ins_h=l.window[g],l.ins_h=RR(l,l.ins_h,l.window[g+1]);l.insert&&(l.ins_h=RR(l,l.ins_h,l.window[g+3-1]),l.prev[g&l.w_mask]=l.head[l.ins_h],l.head[l.ins_h]=g,g++,l.insert--,!(l.lookahead+l.insert<3)););}while(l.lookahead<MT&&l.strm.avail_in!==0)},k4=(l,i)=>{let o,p,g,b=l.pending_buf_size-5>l.w_size?l.w_size:l.pending_buf_size-5,A=0,j=l.strm.avail_in;do{if(o=65535,g=l.bi_valid+42>>3,l.strm.avail_out<g||(g=l.strm.avail_out-g,p=l.strstart-l.block_start,o>p+l.strm.avail_in&&(o=p+l.strm.avail_in),o>g&&(o=g),o<b&&(o===0&&i!==uT||i===TR||o!==p+l.strm.avail_in)))break;A=i===uT&&o===p+l.strm.avail_in?1:0,zM(l,0,0,A),l.pending_buf[l.pending-4]=o,l.pending_buf[l.pending-3]=o>>8,l.pending_buf[l.pending-2]=~o,l.pending_buf[l.pending-1]=~o>>8,zS(l.strm),p&&(p>o&&(p=o),l.strm.output.set(l.window.subarray(l.block_start,l.block_start+p),l.strm.next_out),l.strm.next_out+=p,l.strm.avail_out-=p,l.strm.total_out+=p,l.block_start+=p,o-=p),o&&(JM(l.strm,l.strm.output,l.strm.next_out,o),l.strm.next_out+=o,l.strm.avail_out-=o,l.strm.total_out+=o)}while(A===0);return j-=l.strm.avail_in,j&&(j>=l.w_size?(l.matches=2,l.window.set(l.strm.input.subarray(l.strm.next_in-l.w_size,l.strm.next_in),0),l.strstart=l.w_size,l.insert=l.strstart):(l.window_size-l.strstart<=j&&(l.strstart-=l.w_size,l.window.set(l.window.subarray(l.w_size,l.w_size+l.strstart),0),l.matches<2&&l.matches++,l.insert>l.strstart&&(l.insert=l.strstart)),l.window.set(l.strm.input.subarray(l.strm.next_in-j,l.strm.next_in),l.strstart),l.strstart+=j,l.insert+=j>l.w_size-l.insert?l.w_size-l.insert:j),l.block_start=l.strstart),l.high_water<l.strstart&&(l.high_water=l.strstart),A?4:i!==TR&&i!==uT&&l.strm.avail_in===0&&l.strstart===l.block_start?2:(g=l.window_size-l.strstart,l.strm.avail_in>g&&l.block_start>=l.w_size&&(l.block_start-=l.w_size,l.strstart-=l.w_size,l.window.set(l.window.subarray(l.w_size,l.w_size+l.strstart),0),l.matches<2&&l.matches++,g+=l.w_size,l.insert>l.strstart&&(l.insert=l.strstart)),g>l.strm.avail_in&&(g=l.strm.avail_in),g&&(JM(l.strm,l.window,l.strstart,g),l.strstart+=g,l.insert+=g>l.w_size-l.insert?l.w_size-l.insert:g),l.high_water<l.strstart&&(l.high_water=l.strstart),g=l.bi_valid+42>>3,g=l.pending_buf_size-g>65535?65535:l.pending_buf_size-g,b=g>l.w_size?l.w_size:g,p=l.strstart-l.block_start,(p>=b||(p||i===uT)&&i!==TR&&l.strm.avail_in===0&&p<=g)&&(o=p>g?g:p,A=i===uT&&l.strm.avail_in===0&&o===p?1:0,zM(l,l.block_start,o,A),l.block_start+=o,zS(l.strm)),A?3:1)},XM=(l,i)=>{let o,p;for(;;){if(l.lookahead<MT){if(iO(l),l.lookahead<MT&&i===TR)return 1;if(l.lookahead===0)break}if(o=0,l.lookahead>=3&&(l.ins_h=RR(l,l.ins_h,l.window[l.strstart+3-1]),o=l.prev[l.strstart&l.w_mask]=l.head[l.ins_h],l.head[l.ins_h]=l.strstart),o!==0&&l.strstart-o<=l.w_size-MT&&(l.match_length=P4(l,o)),l.match_length>=3)if(p=SR(l,l.strstart-l.match_start,l.match_length-3),l.lookahead-=l.match_length,l.match_length<=l.max_lazy_match&&l.lookahead>=3){l.match_length--;do l.strstart++,l.ins_h=RR(l,l.ins_h,l.window[l.strstart+3-1]),o=l.prev[l.strstart&l.w_mask]=l.head[l.ins_h],l.head[l.ins_h]=l.strstart;while(--l.match_length!=0);l.strstart++}else l.strstart+=l.match_length,l.match_length=0,l.ins_h=l.window[l.strstart],l.ins_h=RR(l,l.ins_h,l.window[l.strstart+1]);else p=SR(l,0,l.window[l.strstart]),l.lookahead--,l.strstart++;if(p&&(KS(l,!1),l.strm.avail_out===0))return 1}return l.insert=l.strstart<2?l.strstart:2,i===uT?(KS(l,!0),l.strm.avail_out===0?3:4):l.sym_next&&(KS(l,!1),l.strm.avail_out===0)?1:2},sO=(l,i)=>{let o,p,g;for(;;){if(l.lookahead<MT){if(iO(l),l.lookahead<MT&&i===TR)return 1;if(l.lookahead===0)break}if(o=0,l.lookahead>=3&&(l.ins_h=RR(l,l.ins_h,l.window[l.strstart+3-1]),o=l.prev[l.strstart&l.w_mask]=l.head[l.ins_h],l.head[l.ins_h]=l.strstart),l.prev_length=l.match_length,l.prev_match=l.match_start,l.match_length=2,o!==0&&l.prev_length<l.max_lazy_match&&l.strstart-o<=l.w_size-MT&&(l.match_length=P4(l,o),l.match_length<=5&&(l.strategy===btt||l.match_length===3&&l.strstart-l.match_start>4096)&&(l.match_length=2)),l.prev_length>=3&&l.match_length<=l.prev_length){g=l.strstart+l.lookahead-3,p=SR(l,l.strstart-1-l.prev_match,l.prev_length-3),l.lookahead-=l.prev_length-1,l.prev_length-=2;do++l.strstart<=g&&(l.ins_h=RR(l,l.ins_h,l.window[l.strstart+3-1]),o=l.prev[l.strstart&l.w_mask]=l.head[l.ins_h],l.head[l.ins_h]=l.strstart);while(--l.prev_length!=0);if(l.match_available=0,l.match_length=2,l.strstart++,p&&(KS(l,!1),l.strm.avail_out===0))return 1}else if(l.match_available){if(p=SR(l,0,l.window[l.strstart-1]),p&&KS(l,!1),l.strstart++,l.lookahead--,l.strm.avail_out===0)return 1}else l.match_available=1,l.strstart++,l.lookahead--}return l.match_available&&(p=SR(l,0,l.window[l.strstart-1]),l.match_available=0),l.insert=l.strstart<2?l.strstart:2,i===uT?(KS(l,!0),l.strm.avail_out===0?3:4):l.sym_next&&(KS(l,!1),l.strm.avail_out===0)?1:2};function UT(l,i,o,p,g){this.good_length=l,this.max_lazy=i,this.nice_length=o,this.max_chain=p,this.func=g}const n1=[new UT(0,0,0,0,k4),new UT(4,4,8,4,XM),new UT(4,5,16,8,XM),new UT(4,6,32,32,XM),new UT(4,4,16,16,sO),new UT(8,16,32,32,sO),new UT(8,16,128,128,sO),new UT(8,32,128,256,sO),new UT(32,128,258,1024,sO),new UT(32,258,258,4096,sO)];function Ptt(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=zN,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*Att),this.dyn_dtree=new Uint16Array(2*(2*Itt+1)),this.bl_tree=new Uint16Array(2*(2*wtt+1)),CR(this.dyn_ltree),CR(this.dyn_dtree),CR(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(Ott+1),this.heap=new Uint16Array(2*YM+1),CR(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*YM+1),CR(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const r1=l=>{if(!l)return 1;const i=l.state;return!i||i.strm!==l||i.status!==rO&&i.status!==57&&i.status!==69&&i.status!==73&&i.status!==91&&i.status!==103&&i.status!==lI&&i.status!==t1?1:0},D4=l=>{if(r1(l))return dI(l,xT);l.total_in=l.total_out=0,l.data_type=Rtt;const i=l.state;return i.pending=0,i.pending_out=0,i.wrap<0&&(i.wrap=-i.wrap),i.status=i.wrap===2?57:i.wrap?rO:lI,l.adler=i.wrap===2?0:1,i.last_flush=-2,ftt(i),eS},L4=l=>{const i=D4(l);var o;return i===eS&&((o=l.state).window_size=2*o.w_size,CR(o.head),o.max_lazy_match=n1[o.level].max_lazy,o.good_match=n1[o.level].good_length,o.nice_match=n1[o.level].nice_length,o.max_chain_length=n1[o.level].max_chain,o.strstart=0,o.block_start=0,o.lookahead=0,o.insert=0,o.match_length=o.prev_length=2,o.match_available=0,o.ins_h=0),i},x4=(l,i,o,p,g,b)=>{if(!l)return xT;let A=1;if(i===ytt&&(i=6),p<0?(A=0,p=-p):p>15&&(A=2,p-=16),g<1||g>9||o!==zN||p<8||p>15||i<0||i>9||b<0||b>Ttt||p===8&&A!==1)return dI(l,xT);p===8&&(p=9);const j=new Ptt;return l.state=j,j.strm=l,j.status=rO,j.wrap=A,j.gzhead=null,j.w_bits=p,j.w_size=1<<j.w_bits,j.w_mask=j.w_size-1,j.hash_bits=g+7,j.hash_size=1<<j.hash_bits,j.hash_mask=j.hash_size-1,j.hash_shift=~~((j.hash_bits+3-1)/3),j.window=new Uint8Array(2*j.w_size),j.head=new Uint16Array(j.hash_size),j.prev=new Uint16Array(j.w_size),j.lit_bufsize=1<<g+6,j.pending_buf_size=4*j.lit_bufsize,j.pending_buf=new Uint8Array(j.pending_buf_size),j.sym_buf=j.lit_bufsize,j.sym_end=3*(j.lit_bufsize-1),j.level=i,j.strategy=b,j.method=o,L4(l)};var ktt=(l,i)=>{if(r1(l)||i>A4||i<0)return l?dI(l,xT):xT;const o=l.state;if(!l.output||l.avail_in!==0&&!l.input||o.status===t1&&i!==uT)return dI(l,l.avail_out===0?KM:xT);const p=o.last_flush;if(o.last_flush=i,o.pending!==0){if(zS(l),l.avail_out===0)return o.last_flush=-1,eS}else if(l.avail_in===0&&N4(i)<=N4(p)&&i!==uT)return dI(l,KM);if(o.status===t1&&l.avail_in!==0)return dI(l,KM);if(o.status===rO&&o.wrap===0&&(o.status=lI),o.status===rO){let g=zN+(o.w_bits-8<<4)<<8,b=-1;if(b=o.strategy>=HN||o.level<2?0:o.level<6?1:o.level===6?2:3,g|=b<<6,o.strstart!==0&&(g|=32),g+=31-g%31,e1(o,g),o.strstart!==0&&(e1(o,l.adler>>>16),e1(o,65535&l.adler)),l.adler=1,o.status=lI,zS(l),o.pending!==0)return o.last_flush=-1,eS}if(o.status===57){if(l.adler=0,G_(o,31),G_(o,139),G_(o,8),o.gzhead)G_(o,(o.gzhead.text?1:0)+(o.gzhead.hcrc?2:0)+(o.gzhead.extra?4:0)+(o.gzhead.name?8:0)+(o.gzhead.comment?16:0)),G_(o,255&o.gzhead.time),G_(o,o.gzhead.time>>8&255),G_(o,o.gzhead.time>>16&255),G_(o,o.gzhead.time>>24&255),G_(o,o.level===9?2:o.strategy>=HN||o.level<2?4:0),G_(o,255&o.gzhead.os),o.gzhead.extra&&o.gzhead.extra.length&&(G_(o,255&o.gzhead.extra.length),G_(o,o.gzhead.extra.length>>8&255)),o.gzhead.hcrc&&(l.adler=_b(l.adler,o.pending_buf,o.pending,0)),o.gzindex=0,o.status=69;else if(G_(o,0),G_(o,0),G_(o,0),G_(o,0),G_(o,0),G_(o,o.level===9?2:o.strategy>=HN||o.level<2?4:0),G_(o,3),o.status=lI,zS(l),o.pending!==0)return o.last_flush=-1,eS}if(o.status===69){if(o.gzhead.extra){let g=o.pending,b=(65535&o.gzhead.extra.length)-o.gzindex;for(;o.pending+b>o.pending_buf_size;){let j=o.pending_buf_size-o.pending;if(o.pending_buf.set(o.gzhead.extra.subarray(o.gzindex,o.gzindex+j),o.pending),o.pending=o.pending_buf_size,o.gzhead.hcrc&&o.pending>g&&(l.adler=_b(l.adler,o.pending_buf,o.pending-g,g)),o.gzindex+=j,zS(l),o.pending!==0)return o.last_flush=-1,eS;g=0,b-=j}let A=new Uint8Array(o.gzhead.extra);o.pending_buf.set(A.subarray(o.gzindex,o.gzindex+b),o.pending),o.pending+=b,o.gzhead.hcrc&&o.pending>g&&(l.adler=_b(l.adler,o.pending_buf,o.pending-g,g)),o.gzindex=0}o.status=73}if(o.status===73){if(o.gzhead.name){let g,b=o.pending;do{if(o.pending===o.pending_buf_size){if(o.gzhead.hcrc&&o.pending>b&&(l.adler=_b(l.adler,o.pending_buf,o.pending-b,b)),zS(l),o.pending!==0)return o.last_flush=-1,eS;b=0}g=o.gzindex<o.gzhead.name.length?255&o.gzhead.name.charCodeAt(o.gzindex++):0,G_(o,g)}while(g!==0);o.gzhead.hcrc&&o.pending>b&&(l.adler=_b(l.adler,o.pending_buf,o.pending-b,b)),o.gzindex=0}o.status=91}if(o.status===91){if(o.gzhead.comment){let g,b=o.pending;do{if(o.pending===o.pending_buf_size){if(o.gzhead.hcrc&&o.pending>b&&(l.adler=_b(l.adler,o.pending_buf,o.pending-b,b)),zS(l),o.pending!==0)return o.last_flush=-1,eS;b=0}g=o.gzindex<o.gzhead.comment.length?255&o.gzhead.comment.charCodeAt(o.gzindex++):0,G_(o,g)}while(g!==0);o.gzhead.hcrc&&o.pending>b&&(l.adler=_b(l.adler,o.pending_buf,o.pending-b,b))}o.status=103}if(o.status===103){if(o.gzhead.hcrc){if(o.pending+2>o.pending_buf_size&&(zS(l),o.pending!==0))return o.last_flush=-1,eS;G_(o,255&l.adler),G_(o,l.adler>>8&255),l.adler=0}if(o.status=lI,zS(l),o.pending!==0)return o.last_flush=-1,eS}if(l.avail_in!==0||o.lookahead!==0||i!==TR&&o.status!==t1){let g=o.level===0?k4(o,i):o.strategy===HN?((b,A)=>{let j;for(;;){if(b.lookahead===0&&(iO(b),b.lookahead===0)){if(A===TR)return 1;break}if(b.match_length=0,j=SR(b,0,b.window[b.strstart]),b.lookahead--,b.strstart++,j&&(KS(b,!1),b.strm.avail_out===0))return 1}return b.insert=0,A===uT?(KS(b,!0),b.strm.avail_out===0?3:4):b.sym_next&&(KS(b,!1),b.strm.avail_out===0)?1:2})(o,i):o.strategy===Stt?((b,A)=>{let j,H,z,$;const Vt=b.window;for(;;){if(b.lookahead<=uI){if(iO(b),b.lookahead<=uI&&A===TR)return 1;if(b.lookahead===0)break}if(b.match_length=0,b.lookahead>=3&&b.strstart>0&&(z=b.strstart-1,H=Vt[z],H===Vt[++z]&&H===Vt[++z]&&H===Vt[++z])){$=b.strstart+uI;do;while(H===Vt[++z]&&H===Vt[++z]&&H===Vt[++z]&&H===Vt[++z]&&H===Vt[++z]&&H===Vt[++z]&&H===Vt[++z]&&H===Vt[++z]&&z<$);b.match_length=uI-($-z),b.match_length>b.lookahead&&(b.match_length=b.lookahead)}if(b.match_length>=3?(j=SR(b,1,b.match_length-3),b.lookahead-=b.match_length,b.strstart+=b.match_length,b.match_length=0):(j=SR(b,0,b.window[b.strstart]),b.lookahead--,b.strstart++),j&&(KS(b,!1),b.strm.avail_out===0))return 1}return b.insert=0,A===uT?(KS(b,!0),b.strm.avail_out===0?3:4):b.sym_next&&(KS(b,!1),b.strm.avail_out===0)?1:2})(o,i):n1[o.level].func(o,i);if(g!==3&&g!==4||(o.status=t1),g===1||g===3)return l.avail_out===0&&(o.last_flush=-1),eS;if(g===2&&(i===Ett?gtt(o):i!==A4&&(zM(o,0,0,!1),i===vtt&&(CR(o.head),o.lookahead===0&&(o.strstart=0,o.block_start=0,o.insert=0))),zS(l),l.avail_out===0))return o.last_flush=-1,eS}return i!==uT?eS:o.wrap<=0?O4:(o.wrap===2?(G_(o,255&l.adler),G_(o,l.adler>>8&255),G_(o,l.adler>>16&255),G_(o,l.adler>>24&255),G_(o,255&l.total_in),G_(o,l.total_in>>8&255),G_(o,l.total_in>>16&255),G_(o,l.total_in>>24&255)):(e1(o,l.adler>>>16),e1(o,65535&l.adler)),zS(l),o.wrap>0&&(o.wrap=-o.wrap),o.pending!==0?eS:O4)},Dtt=(l,i)=>{let o=i.length;if(r1(l))return xT;const p=l.state,g=p.wrap;if(g===2||g===1&&p.status!==rO||p.lookahead)return xT;if(g===1&&(l.adler=ZO(l.adler,i,o,0)),p.wrap=0,o>=p.w_size){g===0&&(CR(p.head),p.strstart=0,p.block_start=0,p.insert=0);let H=new Uint8Array(p.w_size);H.set(i.subarray(o-p.w_size,o),0),i=H,o=p.w_size}const b=l.avail_in,A=l.next_in,j=l.input;for(l.avail_in=o,l.next_in=0,l.input=i,iO(p);p.lookahead>=3;){let H=p.strstart,z=p.lookahead-2;do p.ins_h=RR(p,p.ins_h,p.window[H+3-1]),p.prev[H&p.w_mask]=p.head[p.ins_h],p.head[p.ins_h]=H,H++;while(--z);p.strstart=H,p.lookahead=2,iO(p)}return p.strstart+=p.lookahead,p.block_start=p.strstart,p.insert=p.lookahead,p.lookahead=0,p.match_length=p.prev_length=2,p.match_available=0,l.next_in=A,l.input=j,l.avail_in=b,p.wrap=g,eS},i1={deflateInit:(l,i)=>x4(l,i,zN,15,8,Ctt),deflateInit2:x4,deflateReset:L4,deflateResetKeep:D4,deflateSetHeader:(l,i)=>r1(l)||l.state.wrap!==2?xT:(l.state.gzhead=i,eS),deflate:ktt,deflateEnd:l=>{if(r1(l))return xT;const i=l.state.status;return l.state=null,i===lI?dI(l,_tt):eS},deflateSetDictionary:Dtt,deflateInfo:"pako deflate (from Nodeca project)"};const Ltt=(l,i)=>Object.prototype.hasOwnProperty.call(l,i);var KN={assign:function(l){const i=Array.prototype.slice.call(arguments,1);for(;i.length;){const o=i.shift();if(o){if(typeof o!="object")throw new TypeError(o+"must be non-object");for(const p in o)Ltt(o,p)&&(l[p]=o[p])}}return l},flattenChunks:l=>{let i=0;for(let p=0,g=l.length;p<g;p++)i+=l[p].length;const o=new Uint8Array(i);for(let p=0,g=0,b=l.length;p<b;p++){let A=l[p];o.set(A,g),g+=A.length}return o}};let M4=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{M4=!1}const s1=new Uint8Array(256);for(let l=0;l<256;l++)s1[l]=l>=252?6:l>=248?5:l>=240?4:l>=224?3:l>=192?2:1;s1[254]=s1[254]=1;var o1={string2buf:l=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(l);let i,o,p,g,b,A=l.length,j=0;for(g=0;g<A;g++)o=l.charCodeAt(g),(64512&o)==55296&&g+1<A&&(p=l.charCodeAt(g+1),(64512&p)==56320&&(o=65536+(o-55296<<10)+(p-56320),g++)),j+=o<128?1:o<2048?2:o<65536?3:4;for(i=new Uint8Array(j),b=0,g=0;b<j;g++)o=l.charCodeAt(g),(64512&o)==55296&&g+1<A&&(p=l.charCodeAt(g+1),(64512&p)==56320&&(o=65536+(o-55296<<10)+(p-56320),g++)),o<128?i[b++]=o:o<2048?(i[b++]=192|o>>>6,i[b++]=128|63&o):o<65536?(i[b++]=224|o>>>12,i[b++]=128|o>>>6&63,i[b++]=128|63&o):(i[b++]=240|o>>>18,i[b++]=128|o>>>12&63,i[b++]=128|o>>>6&63,i[b++]=128|63&o);return i},buf2string:(l,i)=>{const o=i||l.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(l.subarray(0,i));let p,g;const b=new Array(2*o);for(g=0,p=0;p<o;){let A=l[p++];if(A<128){b[g++]=A;continue}let j=s1[A];if(j>4)b[g++]=65533,p+=j-1;else{for(A&=j===2?31:j===3?15:7;j>1&&p<o;)A=A<<6|63&l[p++],j--;j>1?b[g++]=65533:A<65536?b[g++]=A:(A-=65536,b[g++]=55296|A>>10&1023,b[g++]=56320|1023&A)}}return((A,j)=>{if(j<65534&&A.subarray&&M4)return String.fromCharCode.apply(null,A.length===j?A:A.subarray(0,j));let H="";for(let z=0;z<j;z++)H+=String.fromCharCode(A[z]);return H})(b,g)},utf8border:(l,i)=>{(i=i||l.length)>l.length&&(i=l.length);let o=i-1;for(;o>=0&&(192&l[o])==128;)o--;return o<0||o===0?i:o+s1[l[o]]>i?o:i}},U4=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const F4=Object.prototype.toString,{Z_NO_FLUSH:xtt,Z_SYNC_FLUSH:Mtt,Z_FULL_FLUSH:Utt,Z_FINISH:Ftt,Z_OK:YN,Z_STREAM_END:jtt,Z_DEFAULT_COMPRESSION:Vtt,Z_DEFAULT_STRATEGY:Btt,Z_DEFLATED:Gtt}=nO;function a1(l){this.options=KN.assign({level:Vtt,method:Gtt,chunkSize:16384,windowBits:15,memLevel:8,strategy:Btt},l||{});let i=this.options;i.raw&&i.windowBits>0?i.windowBits=-i.windowBits:i.gzip&&i.windowBits>0&&i.windowBits<16&&(i.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new U4,this.strm.avail_out=0;let o=i1.deflateInit2(this.strm,i.level,i.method,i.windowBits,i.memLevel,i.strategy);if(o!==YN)throw new Error(cI[o]);if(i.header&&i1.deflateSetHeader(this.strm,i.header),i.dictionary){let p;if(p=typeof i.dictionary=="string"?o1.string2buf(i.dictionary):F4.call(i.dictionary)==="[object ArrayBuffer]"?new Uint8Array(i.dictionary):i.dictionary,o=i1.deflateSetDictionary(this.strm,p),o!==YN)throw new Error(cI[o]);this._dict_set=!0}}function QM(l,i){const o=new a1(i);if(o.push(l,!0),o.err)throw o.msg||cI[o.err];return o.result}a1.prototype.push=function(l,i){const o=this.strm,p=this.options.chunkSize;let g,b;if(this.ended)return!1;for(b=i===~~i?i:i===!0?Ftt:xtt,typeof l=="string"?o.input=o1.string2buf(l):F4.call(l)==="[object ArrayBuffer]"?o.input=new Uint8Array(l):o.input=l,o.next_in=0,o.avail_in=o.input.length;;)if(o.avail_out===0&&(o.output=new Uint8Array(p),o.next_out=0,o.avail_out=p),(b===Mtt||b===Utt)&&o.avail_out<=6)this.onData(o.output.subarray(0,o.next_out)),o.avail_out=0;else{if(g=i1.deflate(o,b),g===jtt)return o.next_out>0&&this.onData(o.output.subarray(0,o.next_out)),g=i1.deflateEnd(this.strm),this.onEnd(g),this.ended=!0,g===YN;if(o.avail_out!==0){if(b>0&&o.next_out>0)this.onData(o.output.subarray(0,o.next_out)),o.avail_out=0;else if(o.avail_in===0)break}else this.onData(o.output)}return!0},a1.prototype.onData=function(l){this.chunks.push(l)},a1.prototype.onEnd=function(l){l===YN&&(this.result=KN.flattenChunks(this.chunks)),this.chunks=[],this.err=l,this.msg=this.strm.msg};var qtt={Deflate:a1,deflate:QM,deflateRaw:function(l,i){return(i=i||{}).raw=!0,QM(l,i)},gzip:function(l,i){return(i=i||{}).gzip=!0,QM(l,i)},constants:nO};const JN=16209;var Wtt=function(l,i){let o,p,g,b,A,j,H,z,$,Vt,_r,Fi,_l,_u,_h,_g,eE,oE,SE,vE,fE,mE,EE,PE;const OE=l.state;o=l.next_in,EE=l.input,p=o+(l.avail_in-5),g=l.next_out,PE=l.output,b=g-(i-l.avail_out),A=g+(l.avail_out-257),j=OE.dmax,H=OE.wsize,z=OE.whave,$=OE.wnext,Vt=OE.window,_r=OE.hold,Fi=OE.bits,_l=OE.lencode,_u=OE.distcode,_h=(1<<OE.lenbits)-1,_g=(1<<OE.distbits)-1;t:do{Fi<15&&(_r+=EE[o++]<<Fi,Fi+=8,_r+=EE[o++]<<Fi,Fi+=8),eE=_l[_r&_h];e:for(;;){if(oE=eE>>>24,_r>>>=oE,Fi-=oE,oE=eE>>>16&255,oE===0)PE[g++]=65535&eE;else{if(!(16&oE)){if(!(64&oE)){eE=_l[(65535&eE)+(_r&(1<<oE)-1)];continue e}if(32&oE){OE.mode=16191;break t}l.msg="invalid literal/length code",OE.mode=JN;break t}SE=65535&eE,oE&=15,oE&&(Fi<oE&&(_r+=EE[o++]<<Fi,Fi+=8),SE+=_r&(1<<oE)-1,_r>>>=oE,Fi-=oE),Fi<15&&(_r+=EE[o++]<<Fi,Fi+=8,_r+=EE[o++]<<Fi,Fi+=8),eE=_u[_r&_g];n:for(;;){if(oE=eE>>>24,_r>>>=oE,Fi-=oE,oE=eE>>>16&255,!(16&oE)){if(!(64&oE)){eE=_u[(65535&eE)+(_r&(1<<oE)-1)];continue n}l.msg="invalid distance code",OE.mode=JN;break t}if(vE=65535&eE,oE&=15,Fi<oE&&(_r+=EE[o++]<<Fi,Fi+=8,Fi<oE&&(_r+=EE[o++]<<Fi,Fi+=8)),vE+=_r&(1<<oE)-1,vE>j){l.msg="invalid distance too far back",OE.mode=JN;break t}if(_r>>>=oE,Fi-=oE,oE=g-b,vE>oE){if(oE=vE-oE,oE>z&&OE.sane){l.msg="invalid distance too far back",OE.mode=JN;break t}if(fE=0,mE=Vt,$===0){if(fE+=H-oE,oE<SE){SE-=oE;do PE[g++]=Vt[fE++];while(--oE);fE=g-vE,mE=PE}}else if($<oE){if(fE+=H+$-oE,oE-=$,oE<SE){SE-=oE;do PE[g++]=Vt[fE++];while(--oE);if(fE=0,$<SE){oE=$,SE-=oE;do PE[g++]=Vt[fE++];while(--oE);fE=g-vE,mE=PE}}}else if(fE+=$-oE,oE<SE){SE-=oE;do PE[g++]=Vt[fE++];while(--oE);fE=g-vE,mE=PE}for(;SE>2;)PE[g++]=mE[fE++],PE[g++]=mE[fE++],PE[g++]=mE[fE++],SE-=3;SE&&(PE[g++]=mE[fE++],SE>1&&(PE[g++]=mE[fE++]))}else{fE=g-vE;do PE[g++]=PE[fE++],PE[g++]=PE[fE++],PE[g++]=PE[fE++],SE-=3;while(SE>2);SE&&(PE[g++]=PE[fE++],SE>1&&(PE[g++]=PE[fE++]))}break}}break}}while(o<p&&g<A);SE=Fi>>3,o-=SE,Fi-=SE<<3,_r&=(1<<Fi)-1,l.next_in=o,l.next_out=g,l.avail_in=o<p?p-o+5:5-(o-p),l.avail_out=g<A?A-g+257:257-(g-A),OE.hold=_r,OE.bits=Fi};const XN=15,Htt=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),ztt=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),Ktt=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),Ytt=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var c1=(l,i,o,p,g,b,A,j)=>{const H=j.bits;let z,$,Vt,_r,Fi,_l,_u=0,_h=0,_g=0,eE=0,oE=0,SE=0,vE=0,fE=0,mE=0,EE=0,PE=null;const OE=new Uint16Array(16),$E=new Uint16Array(16);let s_,B_,r0,P_=null;for(_u=0;_u<=XN;_u++)OE[_u]=0;for(_h=0;_h<p;_h++)OE[i[o+_h]]++;for(oE=H,eE=XN;eE>=1&&OE[eE]===0;eE--);if(oE>eE&&(oE=eE),eE===0)return g[b++]=20971520,g[b++]=20971520,j.bits=1,0;for(_g=1;_g<eE&&OE[_g]===0;_g++);for(oE<_g&&(oE=_g),fE=1,_u=1;_u<=XN;_u++)if(fE<<=1,fE-=OE[_u],fE<0)return-1;if(fE>0&&(l===0||eE!==1))return-1;for($E[1]=0,_u=1;_u<XN;_u++)$E[_u+1]=$E[_u]+OE[_u];for(_h=0;_h<p;_h++)i[o+_h]!==0&&(A[$E[i[o+_h]]++]=_h);if(l===0?(PE=P_=A,_l=20):l===1?(PE=Htt,P_=ztt,_l=257):(PE=Ktt,P_=Ytt,_l=0),EE=0,_h=0,_u=_g,Fi=b,SE=oE,vE=0,Vt=-1,mE=1<<oE,_r=mE-1,l===1&&mE>852||l===2&&mE>592)return 1;for(;;){s_=_u-vE,A[_h]+1<_l?(B_=0,r0=A[_h]):A[_h]>=_l?(B_=P_[A[_h]-_l],r0=PE[A[_h]-_l]):(B_=96,r0=0),z=1<<_u-vE,$=1<<SE,_g=$;do $-=z,g[Fi+(EE>>vE)+$]=s_<<24|B_<<16|r0|0;while($!==0);for(z=1<<_u-1;EE&z;)z>>=1;if(z!==0?(EE&=z-1,EE+=z):EE=0,_h++,--OE[_u]==0){if(_u===eE)break;_u=i[o+A[_h]]}if(_u>oE&&(EE&_r)!==Vt){for(vE===0&&(vE=oE),Fi+=_g,SE=_u-vE,fE=1<<SE;SE+vE<eE&&(fE-=OE[SE+vE],!(fE<=0));)SE++,fE<<=1;if(mE+=1<<SE,l===1&&mE>852||l===2&&mE>592)return 1;Vt=EE&_r,g[Vt]=oE<<24|SE<<16|Fi-b|0}}return EE!==0&&(g[Fi+EE]=_u-vE<<24|64<<16|0),j.bits=oE,0};const{Z_FINISH:j4,Z_BLOCK:Jtt,Z_TREES:QN,Z_OK:hI,Z_STREAM_END:Xtt,Z_NEED_DICT:Qtt,Z_STREAM_ERROR:lT,Z_DATA_ERROR:V4,Z_MEM_ERROR:B4,Z_BUF_ERROR:$tt,Z_DEFLATED:G4}=nO,$N=16180,ZN=16190,ZT=16191,$M=16192,ZM=16194,tP=16199,eP=16200,t2=16206,y0=16209,q4=l=>(l>>>24&255)+(l>>>8&65280)+((65280&l)<<8)+((255&l)<<24);function Ztt(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const pI=l=>{if(!l)return 1;const i=l.state;return!i||i.strm!==l||i.mode<$N||i.mode>16211?1:0},W4=l=>{if(pI(l))return lT;const i=l.state;return l.total_in=l.total_out=i.total=0,l.msg="",i.wrap&&(l.adler=1&i.wrap),i.mode=$N,i.last=0,i.havedict=0,i.flags=-1,i.dmax=32768,i.head=null,i.hold=0,i.bits=0,i.lencode=i.lendyn=new Int32Array(852),i.distcode=i.distdyn=new Int32Array(592),i.sane=1,i.back=-1,hI},H4=l=>{if(pI(l))return lT;const i=l.state;return i.wsize=0,i.whave=0,i.wnext=0,W4(l)},z4=(l,i)=>{let o;if(pI(l))return lT;const p=l.state;return i<0?(o=0,i=-i):(o=5+(i>>4),i<48&&(i&=15)),i&&(i<8||i>15)?lT:(p.window!==null&&p.wbits!==i&&(p.window=null),p.wrap=o,p.wbits=i,H4(l))},K4=(l,i)=>{if(!l)return lT;const o=new Ztt;l.state=o,o.strm=l,o.window=null,o.mode=$N;const p=z4(l,i);return p!==hI&&(l.state=null),p};let e2,n2,Y4=!0;const tet=l=>{if(Y4){e2=new Int32Array(512),n2=new Int32Array(32);let i=0;for(;i<144;)l.lens[i++]=8;for(;i<256;)l.lens[i++]=9;for(;i<280;)l.lens[i++]=7;for(;i<288;)l.lens[i++]=8;for(c1(1,l.lens,0,288,e2,0,l.work,{bits:9}),i=0;i<32;)l.lens[i++]=5;c1(2,l.lens,0,32,n2,0,l.work,{bits:5}),Y4=!1}l.lencode=e2,l.lenbits=9,l.distcode=n2,l.distbits=5},J4=(l,i,o,p)=>{let g;const b=l.state;return b.window===null&&(b.wsize=1<<b.wbits,b.wnext=0,b.whave=0,b.window=new Uint8Array(b.wsize)),p>=b.wsize?(b.window.set(i.subarray(o-b.wsize,o),0),b.wnext=0,b.whave=b.wsize):(g=b.wsize-b.wnext,g>p&&(g=p),b.window.set(i.subarray(o-p,o-p+g),b.wnext),(p-=g)?(b.window.set(i.subarray(o-p,o),0),b.wnext=p,b.whave=b.wsize):(b.wnext+=g,b.wnext===b.wsize&&(b.wnext=0),b.whave<b.wsize&&(b.whave+=g))),0};var eet=(l,i)=>{let o,p,g,b,A,j,H,z,$,Vt,_r,Fi,_l,_u,_h,_g,eE,oE,SE,vE,fE,mE,EE=0;const PE=new Uint8Array(4);let OE,$E;const s_=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(pI(l)||!l.output||!l.input&&l.avail_in!==0)return lT;o=l.state,o.mode===ZT&&(o.mode=$M),A=l.next_out,g=l.output,H=l.avail_out,b=l.next_in,p=l.input,j=l.avail_in,z=o.hold,$=o.bits,Vt=j,_r=H,mE=hI;t:for(;;)switch(o.mode){case $N:if(o.wrap===0){o.mode=$M;break}for(;$<16;){if(j===0)break t;j--,z+=p[b++]<<$,$+=8}if(2&o.wrap&&z===35615){o.wbits===0&&(o.wbits=15),o.check=0,PE[0]=255&z,PE[1]=z>>>8&255,o.check=_b(o.check,PE,2,0),z=0,$=0,o.mode=16181;break}if(o.head&&(o.head.done=!1),!(1&o.wrap)||(((255&z)<<8)+(z>>8))%31){l.msg="incorrect header check",o.mode=y0;break}if((15&z)!==G4){l.msg="unknown compression method",o.mode=y0;break}if(z>>>=4,$-=4,fE=8+(15&z),o.wbits===0&&(o.wbits=fE),fE>15||fE>o.wbits){l.msg="invalid window size",o.mode=y0;break}o.dmax=1<<o.wbits,o.flags=0,l.adler=o.check=1,o.mode=512&z?16189:ZT,z=0,$=0;break;case 16181:for(;$<16;){if(j===0)break t;j--,z+=p[b++]<<$,$+=8}if(o.flags=z,(255&o.flags)!==G4){l.msg="unknown compression method",o.mode=y0;break}if(57344&o.flags){l.msg="unknown header flags set",o.mode=y0;break}o.head&&(o.head.text=z>>8&1),512&o.flags&&4&o.wrap&&(PE[0]=255&z,PE[1]=z>>>8&255,o.check=_b(o.check,PE,2,0)),z=0,$=0,o.mode=16182;case 16182:for(;$<32;){if(j===0)break t;j--,z+=p[b++]<<$,$+=8}o.head&&(o.head.time=z),512&o.flags&&4&o.wrap&&(PE[0]=255&z,PE[1]=z>>>8&255,PE[2]=z>>>16&255,PE[3]=z>>>24&255,o.check=_b(o.check,PE,4,0)),z=0,$=0,o.mode=16183;case 16183:for(;$<16;){if(j===0)break t;j--,z+=p[b++]<<$,$+=8}o.head&&(o.head.xflags=255&z,o.head.os=z>>8),512&o.flags&&4&o.wrap&&(PE[0]=255&z,PE[1]=z>>>8&255,o.check=_b(o.check,PE,2,0)),z=0,$=0,o.mode=16184;case 16184:if(1024&o.flags){for(;$<16;){if(j===0)break t;j--,z+=p[b++]<<$,$+=8}o.length=z,o.head&&(o.head.extra_len=z),512&o.flags&&4&o.wrap&&(PE[0]=255&z,PE[1]=z>>>8&255,o.check=_b(o.check,PE,2,0)),z=0,$=0}else o.head&&(o.head.extra=null);o.mode=16185;case 16185:if(1024&o.flags&&(Fi=o.length,Fi>j&&(Fi=j),Fi&&(o.head&&(fE=o.head.extra_len-o.length,o.head.extra||(o.head.extra=new Uint8Array(o.head.extra_len)),o.head.extra.set(p.subarray(b,b+Fi),fE)),512&o.flags&&4&o.wrap&&(o.check=_b(o.check,p,Fi,b)),j-=Fi,b+=Fi,o.length-=Fi),o.length))break t;o.length=0,o.mode=16186;case 16186:if(2048&o.flags){if(j===0)break t;Fi=0;do fE=p[b+Fi++],o.head&&fE&&o.length<65536&&(o.head.name+=String.fromCharCode(fE));while(fE&&Fi<j);if(512&o.flags&&4&o.wrap&&(o.check=_b(o.check,p,Fi,b)),j-=Fi,b+=Fi,fE)break t}else o.head&&(o.head.name=null);o.length=0,o.mode=16187;case 16187:if(4096&o.flags){if(j===0)break t;Fi=0;do fE=p[b+Fi++],o.head&&fE&&o.length<65536&&(o.head.comment+=String.fromCharCode(fE));while(fE&&Fi<j);if(512&o.flags&&4&o.wrap&&(o.check=_b(o.check,p,Fi,b)),j-=Fi,b+=Fi,fE)break t}else o.head&&(o.head.comment=null);o.mode=16188;case 16188:if(512&o.flags){for(;$<16;){if(j===0)break t;j--,z+=p[b++]<<$,$+=8}if(4&o.wrap&&z!==(65535&o.check)){l.msg="header crc mismatch",o.mode=y0;break}z=0,$=0}o.head&&(o.head.hcrc=o.flags>>9&1,o.head.done=!0),l.adler=o.check=0,o.mode=ZT;break;case 16189:for(;$<32;){if(j===0)break t;j--,z+=p[b++]<<$,$+=8}l.adler=o.check=q4(z),z=0,$=0,o.mode=ZN;case ZN:if(o.havedict===0)return l.next_out=A,l.avail_out=H,l.next_in=b,l.avail_in=j,o.hold=z,o.bits=$,Qtt;l.adler=o.check=1,o.mode=ZT;case ZT:if(i===Jtt||i===QN)break t;case $M:if(o.last){z>>>=7&$,$-=7&$,o.mode=t2;break}for(;$<3;){if(j===0)break t;j--,z+=p[b++]<<$,$+=8}switch(o.last=1&z,z>>>=1,$-=1,3&z){case 0:o.mode=16193;break;case 1:if(tet(o),o.mode=tP,i===QN){z>>>=2,$-=2;break t}break;case 2:o.mode=16196;break;case 3:l.msg="invalid block type",o.mode=y0}z>>>=2,$-=2;break;case 16193:for(z>>>=7&$,$-=7&$;$<32;){if(j===0)break t;j--,z+=p[b++]<<$,$+=8}if((65535&z)!=(z>>>16^65535)){l.msg="invalid stored block lengths",o.mode=y0;break}if(o.length=65535&z,z=0,$=0,o.mode=ZM,i===QN)break t;case ZM:o.mode=16195;case 16195:if(Fi=o.length,Fi){if(Fi>j&&(Fi=j),Fi>H&&(Fi=H),Fi===0)break t;g.set(p.subarray(b,b+Fi),A),j-=Fi,b+=Fi,H-=Fi,A+=Fi,o.length-=Fi;break}o.mode=ZT;break;case 16196:for(;$<14;){if(j===0)break t;j--,z+=p[b++]<<$,$+=8}if(o.nlen=257+(31&z),z>>>=5,$-=5,o.ndist=1+(31&z),z>>>=5,$-=5,o.ncode=4+(15&z),z>>>=4,$-=4,o.nlen>286||o.ndist>30){l.msg="too many length or distance symbols",o.mode=y0;break}o.have=0,o.mode=16197;case 16197:for(;o.have<o.ncode;){for(;$<3;){if(j===0)break t;j--,z+=p[b++]<<$,$+=8}o.lens[s_[o.have++]]=7&z,z>>>=3,$-=3}for(;o.have<19;)o.lens[s_[o.have++]]=0;if(o.lencode=o.lendyn,o.lenbits=7,OE={bits:o.lenbits},mE=c1(0,o.lens,0,19,o.lencode,0,o.work,OE),o.lenbits=OE.bits,mE){l.msg="invalid code lengths set",o.mode=y0;break}o.have=0,o.mode=16198;case 16198:for(;o.have<o.nlen+o.ndist;){for(;EE=o.lencode[z&(1<<o.lenbits)-1],_h=EE>>>24,_g=EE>>>16&255,eE=65535&EE,!(_h<=$);){if(j===0)break t;j--,z+=p[b++]<<$,$+=8}if(eE<16)z>>>=_h,$-=_h,o.lens[o.have++]=eE;else{if(eE===16){for($E=_h+2;$<$E;){if(j===0)break t;j--,z+=p[b++]<<$,$+=8}if(z>>>=_h,$-=_h,o.have===0){l.msg="invalid bit length repeat",o.mode=y0;break}fE=o.lens[o.have-1],Fi=3+(3&z),z>>>=2,$-=2}else if(eE===17){for($E=_h+3;$<$E;){if(j===0)break t;j--,z+=p[b++]<<$,$+=8}z>>>=_h,$-=_h,fE=0,Fi=3+(7&z),z>>>=3,$-=3}else{for($E=_h+7;$<$E;){if(j===0)break t;j--,z+=p[b++]<<$,$+=8}z>>>=_h,$-=_h,fE=0,Fi=11+(127&z),z>>>=7,$-=7}if(o.have+Fi>o.nlen+o.ndist){l.msg="invalid bit length repeat",o.mode=y0;break}for(;Fi--;)o.lens[o.have++]=fE}}if(o.mode===y0)break;if(o.lens[256]===0){l.msg="invalid code -- missing end-of-block",o.mode=y0;break}if(o.lenbits=9,OE={bits:o.lenbits},mE=c1(1,o.lens,0,o.nlen,o.lencode,0,o.work,OE),o.lenbits=OE.bits,mE){l.msg="invalid literal/lengths set",o.mode=y0;break}if(o.distbits=6,o.distcode=o.distdyn,OE={bits:o.distbits},mE=c1(2,o.lens,o.nlen,o.ndist,o.distcode,0,o.work,OE),o.distbits=OE.bits,mE){l.msg="invalid distances set",o.mode=y0;break}if(o.mode=tP,i===QN)break t;case tP:o.mode=eP;case eP:if(j>=6&&H>=258){l.next_out=A,l.avail_out=H,l.next_in=b,l.avail_in=j,o.hold=z,o.bits=$,Wtt(l,_r),A=l.next_out,g=l.output,H=l.avail_out,b=l.next_in,p=l.input,j=l.avail_in,z=o.hold,$=o.bits,o.mode===ZT&&(o.back=-1);break}for(o.back=0;EE=o.lencode[z&(1<<o.lenbits)-1],_h=EE>>>24,_g=EE>>>16&255,eE=65535&EE,!(_h<=$);){if(j===0)break t;j--,z+=p[b++]<<$,$+=8}if(_g&&!(240&_g)){for(oE=_h,SE=_g,vE=eE;EE=o.lencode[vE+((z&(1<<oE+SE)-1)>>oE)],_h=EE>>>24,_g=EE>>>16&255,eE=65535&EE,!(oE+_h<=$);){if(j===0)break t;j--,z+=p[b++]<<$,$+=8}z>>>=oE,$-=oE,o.back+=oE}if(z>>>=_h,$-=_h,o.back+=_h,o.length=eE,_g===0){o.mode=16205;break}if(32&_g){o.back=-1,o.mode=ZT;break}if(64&_g){l.msg="invalid literal/length code",o.mode=y0;break}o.extra=15&_g,o.mode=16201;case 16201:if(o.extra){for($E=o.extra;$<$E;){if(j===0)break t;j--,z+=p[b++]<<$,$+=8}o.length+=z&(1<<o.extra)-1,z>>>=o.extra,$-=o.extra,o.back+=o.extra}o.was=o.length,o.mode=16202;case 16202:for(;EE=o.distcode[z&(1<<o.distbits)-1],_h=EE>>>24,_g=EE>>>16&255,eE=65535&EE,!(_h<=$);){if(j===0)break t;j--,z+=p[b++]<<$,$+=8}if(!(240&_g)){for(oE=_h,SE=_g,vE=eE;EE=o.distcode[vE+((z&(1<<oE+SE)-1)>>oE)],_h=EE>>>24,_g=EE>>>16&255,eE=65535&EE,!(oE+_h<=$);){if(j===0)break t;j--,z+=p[b++]<<$,$+=8}z>>>=oE,$-=oE,o.back+=oE}if(z>>>=_h,$-=_h,o.back+=_h,64&_g){l.msg="invalid distance code",o.mode=y0;break}o.offset=eE,o.extra=15&_g,o.mode=16203;case 16203:if(o.extra){for($E=o.extra;$<$E;){if(j===0)break t;j--,z+=p[b++]<<$,$+=8}o.offset+=z&(1<<o.extra)-1,z>>>=o.extra,$-=o.extra,o.back+=o.extra}if(o.offset>o.dmax){l.msg="invalid distance too far back",o.mode=y0;break}o.mode=16204;case 16204:if(H===0)break t;if(Fi=_r-H,o.offset>Fi){if(Fi=o.offset-Fi,Fi>o.whave&&o.sane){l.msg="invalid distance too far back",o.mode=y0;break}Fi>o.wnext?(Fi-=o.wnext,_l=o.wsize-Fi):_l=o.wnext-Fi,Fi>o.length&&(Fi=o.length),_u=o.window}else _u=g,_l=A-o.offset,Fi=o.length;Fi>H&&(Fi=H),H-=Fi,o.length-=Fi;do g[A++]=_u[_l++];while(--Fi);o.length===0&&(o.mode=eP);break;case 16205:if(H===0)break t;g[A++]=o.length,H--,o.mode=eP;break;case t2:if(o.wrap){for(;$<32;){if(j===0)break t;j--,z|=p[b++]<<$,$+=8}if(_r-=H,l.total_out+=_r,o.total+=_r,4&o.wrap&&_r&&(l.adler=o.check=o.flags?_b(o.check,g,_r,A-_r):ZO(o.check,g,_r,A-_r)),_r=H,4&o.wrap&&(o.flags?z:q4(z))!==o.check){l.msg="incorrect data check",o.mode=y0;break}z=0,$=0}o.mode=16207;case 16207:if(o.wrap&&o.flags){for(;$<32;){if(j===0)break t;j--,z+=p[b++]<<$,$+=8}if(4&o.wrap&&z!==(4294967295&o.total)){l.msg="incorrect length check",o.mode=y0;break}z=0,$=0}o.mode=16208;case 16208:mE=Xtt;break t;case y0:mE=V4;break t;case 16210:return B4;default:return lT}return l.next_out=A,l.avail_out=H,l.next_in=b,l.avail_in=j,o.hold=z,o.bits=$,(o.wsize||_r!==l.avail_out&&o.mode<y0&&(o.mode<t2||i!==j4))&&J4(l,l.output,l.next_out,_r-l.avail_out),Vt-=l.avail_in,_r-=l.avail_out,l.total_in+=Vt,l.total_out+=_r,o.total+=_r,4&o.wrap&&_r&&(l.adler=o.check=o.flags?_b(o.check,g,_r,l.next_out-_r):ZO(o.check,g,_r,l.next_out-_r)),l.data_type=o.bits+(o.last?64:0)+(o.mode===ZT?128:0)+(o.mode===tP||o.mode===ZM?256:0),(Vt===0&&_r===0||i===j4)&&mE===hI&&(mE=$tt),mE},_C={inflateReset:H4,inflateReset2:z4,inflateResetKeep:W4,inflateInit:l=>K4(l,15),inflateInit2:K4,inflate:eet,inflateEnd:l=>{if(pI(l))return lT;let i=l.state;return i.window&&(i.window=null),l.state=null,hI},inflateGetHeader:(l,i)=>{if(pI(l))return lT;const o=l.state;return 2&o.wrap?(o.head=i,i.done=!1,hI):lT},inflateSetDictionary:(l,i)=>{const o=i.length;let p,g,b;return pI(l)?lT:(p=l.state,p.wrap!==0&&p.mode!==ZN?lT:p.mode===ZN&&(g=1,g=ZO(g,i,o,0),g!==p.check)?V4:(b=J4(l,i,o,o),b?(p.mode=16210,B4):(p.havedict=1,hI)))},inflateInfo:"pako inflate (from Nodeca project)"},net=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const X4=Object.prototype.toString,{Z_NO_FLUSH:ret,Z_FINISH:iet,Z_OK:u1,Z_STREAM_END:r2,Z_NEED_DICT:i2,Z_STREAM_ERROR:set,Z_DATA_ERROR:Q4,Z_MEM_ERROR:oet}=nO;function l1(l){this.options=KN.assign({chunkSize:65536,windowBits:15,to:""},l||{});const i=this.options;i.raw&&i.windowBits>=0&&i.windowBits<16&&(i.windowBits=-i.windowBits,i.windowBits===0&&(i.windowBits=-15)),!(i.windowBits>=0&&i.windowBits<16)||l&&l.windowBits||(i.windowBits+=32),i.windowBits>15&&i.windowBits<48&&!(15&i.windowBits)&&(i.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new U4,this.strm.avail_out=0;let o=_C.inflateInit2(this.strm,i.windowBits);if(o!==u1)throw new Error(cI[o]);if(this.header=new net,_C.inflateGetHeader(this.strm,this.header),i.dictionary&&(typeof i.dictionary=="string"?i.dictionary=o1.string2buf(i.dictionary):X4.call(i.dictionary)==="[object ArrayBuffer]"&&(i.dictionary=new Uint8Array(i.dictionary)),i.raw&&(o=_C.inflateSetDictionary(this.strm,i.dictionary),o!==u1)))throw new Error(cI[o])}function s2(l,i){const o=new l1(i);if(o.push(l),o.err)throw o.msg||cI[o.err];return o.result}l1.prototype.push=function(l,i){const o=this.strm,p=this.options.chunkSize,g=this.options.dictionary;let b,A,j;if(this.ended)return!1;for(A=i===~~i?i:i===!0?iet:ret,X4.call(l)==="[object ArrayBuffer]"?o.input=new Uint8Array(l):o.input=l,o.next_in=0,o.avail_in=o.input.length;;){for(o.avail_out===0&&(o.output=new Uint8Array(p),o.next_out=0,o.avail_out=p),b=_C.inflate(o,A),b===i2&&g&&(b=_C.inflateSetDictionary(o,g),b===u1?b=_C.inflate(o,A):b===Q4&&(b=i2));o.avail_in>0&&b===r2&&o.state.wrap>0&&l[o.next_in]!==0;)_C.inflateReset(o),b=_C.inflate(o,A);switch(b){case set:case Q4:case i2:case oet:return this.onEnd(b),this.ended=!0,!1}if(j=o.avail_out,o.next_out&&(o.avail_out===0||b===r2))if(this.options.to==="string"){let H=o1.utf8border(o.output,o.next_out),z=o.next_out-H,$=o1.buf2string(o.output,H);o.next_out=z,o.avail_out=p-z,z&&o.output.set(o.output.subarray(H,H+z),0),this.onData($)}else this.onData(o.output.length===o.next_out?o.output:o.output.subarray(0,o.next_out));if(b!==u1||j!==0){if(b===r2)return b=_C.inflateEnd(this.strm),this.onEnd(b),this.ended=!0,!0;if(o.avail_in===0)break}}return!0},l1.prototype.onData=function(l){this.chunks.push(l)},l1.prototype.onEnd=function(l){l===u1&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=KN.flattenChunks(this.chunks)),this.chunks=[],this.err=l,this.msg=this.strm.msg};var aet={Inflate:l1,inflate:s2,inflateRaw:function(l,i){return(i=i||{}).raw=!0,s2(l,i)},ungzip:s2,constants:nO};const{Deflate:mnt,deflate:cet,deflateRaw:gnt,gzip:Ent}=qtt,{Inflate:vnt,inflate:uet,inflateRaw:_nt,ungzip:ynt}=aet;var o2,det=cet,het=uet;(function(l){l[l.ONE_BYTE=0]="ONE_BYTE",l[l.TWO_BYTE=1]="TWO_BYTE"})(o2||(o2={}));class pet{constructor(){_e(this,"_sequence",0),_e(this,"_startTime",Date.now()),_e(this,"isUseOneByte",!0)}get startTime(){const i=Date.now()-this._startTime;return i<Math.pow(2,16)?i:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(i){const o={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:i};if(i.byteLength>128){const j=new Uint8Array(4);j.set([1,0,0,0]);const H={id:0,length:4,data:j.buffer},z={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[H]};o.commonPacketHeader.extension=1,o.extension=z,o.payload=this.compress(i),o.commonPacketHeader.length=8+(o.extension.length+2)+o.payload.byteLength}else o.commonPacketHeader.length=8+o.payload.byteLength;const p=new ArrayBuffer(o.commonPacketHeader.length),g=new Uint8Array(p),b=new DataView(p);let A=0;if(b.setUint16(A,o.commonPacketHeader.extension<<15|o.commonPacketHeader.reserved<<14|o.commonPacketHeader.length,!0),A+=2,b.setUint32(A,o.commonPacketHeader.sequence,!0),A+=4,b.setUint16(A,o.commonStreamHeader,!0),A+=2,o.extension){const j=this.serializeExtension(o.extension);g.set(new Uint8Array(j),A),A+=j.byteLength}if(g.set(new Uint8Array(o.payload),A),A+=o.payload.byteLength,A!==o.commonPacketHeader.length)throw Error("serialize error!");return p}deserialize(i){if(i.byteLength<4)return new ArrayBuffer(0);const o=new DataView(i);let p=0;const g=o.getUint16(p,!0);p+=2;const b=(32768&g)>>15;o.getUint16(p+2,!0),o.getUint16(p,!0);let A,j;if(p+=4,o.getUint16(p,!0),p+=2,b){j=this.deserializeExtension(i.slice(p)),p+=2+j.length,A=i.slice(p);let H=!1;if(j.datas.length>0){const z=j.datas.find($=>$.id===0);z&&(H=(1&new DataView(z.data).getUint32(0,!0))==1)}A=H?this.decompress(A):A}else A=i.slice(8);return A}serializeExtension(i){const{profile:o,length:p,datas:g}=i,b=new ArrayBuffer(p+2),A=new Uint8Array(b),j=new DataView(b);let H=0;if(j.setUint8(H++,o),j.setUint8(H++,p),g.forEach(z=>{o?(j.setUint8(H++,z.id),j.setUint8(H++,z.length),A.set(new Uint8Array(z.data),H),H+=z.data.byteLength):(j.setUint8(H++,z.id|z.length<<4),A.set(new Uint8Array(z.data),H),H+=z.data.byteLength)}),H!==p+2)throw Error("serialize extension error, is ".concat(H,"!==").concat(p+2));return b}deserializeExtension(i){const o=new DataView(i);let p=0;const g=o.getUint8(p);p++;const b=o.getUint8(p);p++;const A=g===o2.TWO_BYTE,j=[],H=new DataView(i,2);let z=0;for(;z<b;){let $=0,Vt=0,_r=new ArrayBuffer(0);A?($=H.getUint8(z),z++,Vt=H.getUint8(z),z++):($=15&H.getUint8(z),Vt=H.getUint8(z)>>4,z++),Vt>0&&(_r=H.buffer.slice(z+2,z+2+Vt),z+=_r.byteLength),j.push({id:$,length:Vt,data:_r})}if(z!==b)throw Error("parse error");return{profile:g,length:b,datas:j}}decompress(i){return het(new Uint8Array(i))}compress(i){return det(new Uint8Array(i))}}class $4 extends D_{constructor(i,o){super(),_e(this,"_version",1),_e(this,"_type",3),_e(this,"_config",void 0),_e(this,"_originDataChannel",void 0),_e(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),_e(this,"_dataStreamPacketHandler",void 0),_e(this,"_datachannelEventMap",new Map),this._config=i,o&&(this._originDataChannel=o,this._bandDataChannelEvents(o)),this._initPacketHeader(),this._dataStreamPacketHandler=new pet}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return nE("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var i,o;return(i=(o=this._originDataChannel)===null||o===void 0?void 0:o.readyState)!==null&&i!==void 0?i:"connecting"}get _originDataChannelId(){var i,o;return(i=(o=this._originDataChannel)===null||o===void 0?void 0:o.id)!==null&&i!==void 0?i:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}async _waitTillOpen(){return new pE((i,o)=>{if(this._originDataChannel){this._originDataChannel.readyState==="open"&&i();const p=setTimeout(()=>{var g;o(new yE(_p.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat((g=this._originDataChannel)===null||g===void 0?void 0:g.id)))},1e4);this._originDataChannel.onopen=()=>{clearTimeout(p),this._originDataChannel&&this._bandDataChannelEvents(this._originDataChannel),i()},this._originDataChannel.onerror=()=>{throw clearTimeout(p),new yE(_p.DATACHANNEL_CONNECTION_TIMEOUT)}}else o(new yE(_p.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))})}_updateOriginDataChannel(i){this._originDataChannel=i,this._bandDataChannelEvents(i)}_initPacketHeader(){const i=new DataView(this._dataStreamPacketHeader);i.setUint16(0,this._version),i.setUint8(2,this._type),i.setUint8(3,this._config.id)}_bandDataChannelEvents(i){this._unbindDataChannelEvents(i),[ZI.OPEN,ZI.CLOSE,ZI.ERROR].forEach(o=>{const p=()=>{this.emit(o)};this._datachannelEventMap.set(o,p),i.addEventListener(o,p)})}_unbindDataChannelEvents(i){Array.from(this._datachannelEventMap.entries()).forEach(o=>{let[p,g]=o;i.removeEventListener(p,g)}),this._datachannelEventMap.clear()}}class fet extends $4{constructor(i){super(i),_e(this,"_messageListener",void 0),this._messageListener=o=>{if(o.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);const p=o.data.slice(0,this._dataStreamPacketHeader.byteLength);if(new DataView(p).getUint8(3)!==this.id)return;let g=o.data.slice(this._dataStreamPacketHeader.byteLength);g=this._dataStreamPacketHandler.deserialize(g),this.emit(ZI.MESSAGE,g)}}_updateOriginDataChannel(i){super._updateOriginDataChannel(i),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}}class Z4 extends $4{send(i){if(this._originDataChannel){let o=i;o=this._dataStreamPacketHandler.serialize(i);const p=new Uint8Array(this._dataStreamPacketHeader.byteLength+o.byteLength);p.set(new Uint8Array(this._dataStreamPacketHeader),0),p.set(new Uint8Array(o),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(p.buffer)}}}class met extends D_{constructor(){super(...arguments),_e(this,"resultStorage",new Map)}setLocalAudioStats(i,o,p){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",i,this.checkAudioInputLevel(p,o)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",i,this.checkSendAudioBitrate(p,o))}setLocalVideoStats(i,o,p){this.record("SEND_VIDEO_BITRATE_TOO_LOW",i,this.checkSendVideoBitrate(p,o)),this.record("FRAMERATE_INPUT_TOO_LOW",i,this.checkFramerateInput(p,o)),this.record("FRAMERATE_SENT_TOO_LOW",i,this.checkFramerateSent(p))}setRemoteAudioStats(i,o){const p=i.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",p,this.checkAudioOutputLevel(o))}setRemoteVideoStats(i,o){const p=i.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",p,this.checkVideoDecode(o))}record(i,o,p){if(nE("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(i)||this.resultStorage.set(i,{result:[],isPrevNormal:!0});const g=this.resultStorage.get(i);if(g&&(g.result.push(p),g.result.length>=5)){var b;const A=VE(b=g.result).call(b,!0);g.isPrevNormal&&!A&&this.emit("exception",t5[i],i,o),!g.isPrevNormal&&A&&this.emit("exception",t5[i]+2e3,i+"_RECOVER",o),g.isPrevNormal=A,g.result=[]}}checkAudioOutputLevel(i){return!(i.receiveBitrate>0&&i.receiveLevel===0)}checkAudioInputLevel(i,o){return o instanceof Z_&&!o.isActive||!!o.muted||i.sendVolumeLevel!==0}checkFramerateInput(i,o){let p=null;o._encoderConfig&&o._encoderConfig.frameRate&&(p=US(o._encoderConfig.frameRate));const g=i.captureFrameRate;return!p||!g||!(p>10&&g<5||p<10&&p>=5&&g<=1)}checkFramerateSent(i){return!(i.captureFrameRate&&i.sendFrameRate&&i.captureFrameRate>5&&i.sendFrameRate<=1)}checkSendVideoBitrate(i,o){return!!o.muted||i.sendBitrate!==0}checkSendAudioBitrate(i,o){return o instanceof Z_&&!o.isActive||!!o.muted||i.sendBitrate!==0}checkVideoDecode(i){return i.receiveBitrate===0||i.decodeFrameRate!==0}}const t5={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003},k0=new class{markSubscribeStart(l,i){performance.mark("agora-web-sdk/".concat(l,"/subscribe-").concat(i))}markPublishStart(l,i){performance.mark("agora-web-sdk/".concat(l,"/publish-").concat(i))}measureFromSubscribeStart(l,i){const o=performance.getEntriesByName("agora-web-sdk/".concat(l,"/subscribe-").concat(i));if(o.length>0){const p=o[o.length-1];return Math.round(performance.now()-p.startTime)}return 0}measureFromPublishStart(l,i){const o=performance.getEntriesByName("agora-web-sdk/".concat(l,"/publish-").concat(i));if(o.length>0){const p=o[o.length-1];return Math.round(performance.now()-p.startTime)}return 0}};function e5(l,i){var o=Object.keys(l);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(l);i&&(p=p.filter(function(g){return Object.getOwnPropertyDescriptor(l,g).enumerable})),o.push.apply(o,p)}return o}function fI(l){for(var i=1;i<arguments.length;i++){var o=arguments[i]!=null?arguments[i]:{};i%2?e5(Object(o),!0).forEach(function(p){_e(l,p,o[p])}):Object.getOwnPropertyDescriptors?Object.defineProperties(l,Object.getOwnPropertyDescriptors(o)):e5(Object(o)).forEach(function(p){Object.defineProperty(l,p,Object.getOwnPropertyDescriptor(o,p))})}return l}class oO{constructor(i){_e(this,"store",void 0),_e(this,"onStatsException",void 0),_e(this,"onUploadPublishDuration",void 0),_e(this,"onStatsChanged",void 0),_e(this,"localStats",new Map),_e(this,"remoteStats",new Map),_e(this,"updateStatsInterval",void 0),_e(this,"trafficStats",void 0),_e(this,"trafficStatsPeerList",[]),_e(this,"uplinkStats",void 0),_e(this,"exceptionMonitor",void 0),_e(this,"p2pChannel",void 0),_e(this,"scalabilityMode",dM.L1T1),_e(this,"updateStats",()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))}),this.store=i,this.updateStatsInterval=window.setInterval(this.updateStats,1e3),this.exceptionMonitor=new met,this.exceptionMonitor.on("exception",(o,p,g)=>{this.onStatsException&&this.onStatsException(o,p,g)})}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(TE.LocalAudioTrack)||fI({},RM)}getLocalVideoTrackStats(){return this.localStats.get(TE.LocalVideoTrack)||fI({},IM)}getRemoteAudioTrackStats(i){const o=(b,A)=>{if(!this.trafficStats)return A;const j=this.trafficStats.peer_delay.find(H=>H.peer_uid===b);return j&&(A.publishDuration=j.B_ppad+(Date.now()-this.trafficStats.timestamp)),A},p={};if(i){var g;const b=(g=this.remoteStats.get(i))===null||g===void 0?void 0:g.audioStats;b&&(p[i]=o(i,b))}else Array.from(this.remoteStats.entries()).forEach(b=>{let[A,{audioStats:j}]=b;j&&(p[A]=o(A,j))});return p}getRemoteNetworkQualityStats(i){const o={};if(i){var p;const g=(p=this.remoteStats.get(i))===null||p===void 0?void 0:p.networkStats;g&&(o[i]=g)}else Array.from(this.remoteStats.entries()).forEach(g=>{let[b,{networkStats:A}]=g;A&&(o[b]=A)});return o}getRemoteVideoTrackStats(i){const o=(b,A)=>{if(!this.trafficStats)return A;const j=this.trafficStats.peer_delay.find(H=>H.peer_uid===b);return j&&(A.publishDuration=j.B_ppvd+(Date.now()-this.trafficStats.timestamp)),A},p={};if(i){var g;const b=(g=this.remoteStats.get(i))===null||g===void 0?void 0:g.videoStats;b&&(p[i]=o(i,b))}else Array.from(this.remoteStats.entries()).forEach(b=>{let[A,{videoStats:j}]=b;j&&(p[A]=o(A,j))});return p}getRTCStats(){let i=0,o=0,p=0,g=0;const b=this.localStats.get(TE.LocalAudioTrack);b&&(i+=b.sendBytes,o+=b.sendBitrate);const A=this.localStats.get(TE.LocalVideoTrack);A&&(i+=A.sendBytes,o+=A.sendBitrate);const j=this.localStats.get(TE.LocalVideoLowTrack);j&&(i+=j.sendBytes,o+=j.sendBitrate),this.remoteStats.forEach(z=>{let{audioStats:$,videoStats:Vt}=z;$&&(p+=$.receiveBytes,g+=$.receiveBitrate),Vt&&(p+=Vt.receiveBytes,g+=Vt.receiveBitrate)});let H=1;return this.trafficStats&&(H+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:H,SendBitrate:o,SendBytes:i,RecvBytes:p,RecvBitrate:g,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(i){this.localStats.set(i,void 0)}removeLocalStats(i){i?this.localStats.delete(i):this.localStats.clear()}addRemoteStats(i){this.remoteStats.set(i,{})}removeRemoteStats(i){i?this.remoteStats.delete(i):this.remoteStats.clear()}addP2PChannel(i){this.p2pChannel=i}updateTrafficStats(i){i.peer_delay=i.peer_delay.filter(o=>o.B_ppad!==void 0||o.B_ppvd!==void 0),i.peer_delay.filter(o=>this.trafficStatsPeerList.indexOf(o.peer_uid)===-1).forEach(o=>{var p;const g=(p=this.p2pChannel)===null||p===void 0?void 0:p.getRemoteMedia(o.peer_uid),b=g!=null&&g.videoSSRC?k0.measureFromSubscribeStart(this.store.clientId,g.videoSSRC):0,A=g!=null&&g.audioSSRC?k0.measureFromSubscribeStart(this.store.clientId,g.audioSSRC):0;o.B_ppad!==void 0&&o.B_ppvd!==void 0&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(o.peer_uid,o.B_ppad,o.B_ppvd,b>A?b:A),this.trafficStatsPeerList.push(o.peer_uid))}),this.trafficStats=i}updateUplinkStats(i){this.uplinkStats&&this.uplinkStats.B_fir!==i.B_fir&&Gi.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(i.B_fir)),this.uplinkStats=i}static isRemoteVideoFreeze(i,o,p){if(!i)return!1;const g=!!p&&o.framesDecodeFreezeTime>p.framesDecodeFreezeTime,b=!p||o.framesDecodeCount>p.framesDecodeCount;return g||!b}static isRemoteAudioFreeze(i){return!!i&&i._isFreeze()}isLocalVideoFreeze(i){return!(!i.inputFrame||!i.sentFrame)&&i.inputFrame.frameRate>5&&i.sentFrame.frameRate<3}updateLocalStats(i){Array.from(this.localStats.entries()).forEach(o=>{let[p,g]=o;switch(p){case TE.LocalVideoTrack:case TE.LocalVideoLowTrack:{const A=g,j=fI({},IM),H=i.getStats(),z=i.getLocalMedia(p);if(H){const $=H.videoSend.find(Vt=>Vt.ssrc===(z==null?void 0:z.ssrcs[0].ssrcId));if($){const Vt=i.getLocalVideoSize(),_r=i.getEncoderConfig(TE.LocalVideoTrack);$.codec!=="H264"&&$.codec!=="H265"&&$.codec!=="VP8"&&$.codec!=="VP9"&&$.codec!=="AV1X"&&$.codec!=="AV1"||(j.codecType=$.codec),j.sendBytes=$.bytes,j.sendBitrate=A?8*Math.max(0,j.sendBytes-A.sendBytes):0,$.inputFrame?(j.captureFrameRate=$.inputFrame.frameRate,j.captureResolutionHeight=$.inputFrame.height,j.captureResolutionWidth=$.inputFrame.width):Vt&&(j.captureResolutionWidth=Vt.width,j.captureResolutionHeight=Vt.height),$.sentFrame?(j.sendFrameRate=$.sentFrame.frameRate,j.sendResolutionHeight=$.sentFrame.height,j.sendResolutionWidth=$.sentFrame.width):Vt&&(j.sendResolutionWidth=Vt.width,j.sendResolutionHeight=Vt.height),$.avgEncodeMs&&(j.encodeDelay=$.avgEncodeMs),_r&&_r.bitrateMax&&(j.targetSendBitrate=1e3*_r.bitrateMax),j.sendPackets=$.packets,j.sendPacketsLost=$.packetsLost,j.sendJitterMs=$.jitterMs,j.sendRttMs=$.rttMs,j.totalDuration=A?A.totalDuration+1:1,j.totalFreezeTime=A?A.totalFreezeTime:0,this.isLocalVideoFreeze($)&&(j.totalFreezeTime+=1),$.scalabilityMode&&this.scalabilityMode!==$.scalabilityMode&&(Gi.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat($.scalabilityMode)),this.scalabilityMode=$.scalabilityMode)}this.trafficStats&&(j.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var b;this.localStats.set(p,j),((A==null?void 0:A.sendResolutionWidth)!==j.sendResolutionWidth||(A==null?void 0:A.sendResolutionHeight)!==j.sendResolutionHeight)&&((b=this.onStatsChanged)===null||b===void 0||b.call(this,"resolution",{width:j.sendResolutionWidth,height:j.sendResolutionHeight})),j&&z&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,z.track,j);break}case TE.LocalAudioTrack:{const A=g,j=fI({},RM),H=i.getStats(),z=i.getLocalMedia(p);if(H){const $=H.audioSend.find(Vt=>Vt.ssrc===(z==null?void 0:z.ssrcs[0].ssrcId));if($){if($.codec!=="opus"&&$.codec!=="aac"&&$.codec!=="PCMU"&&$.codec!=="PCMA"&&$.codec!=="G722"||(j.codecType=$.codec),$.inputLevel)j.sendVolumeLevel=Math.round(32767*$.inputLevel);else{const Vt=i.getLocalAudioVolume();Vt&&(j.sendVolumeLevel=Math.round(32767*Vt))}j.sendBytes=$.bytes,j.sendPackets=$.packets,j.sendPacketsLost=$.packetsLost,j.sendJitterMs=$.jitterMs,j.sendRttMs=$.rttMs,j.sendBitrate=A?8*Math.max(0,j.sendBytes-A.sendBytes):0}}this.trafficStats&&(j.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set(TE.LocalAudioTrack,j),j&&z&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,z.track,j);break}}})}updateRemoteStats(i){Array.from(this.remoteStats.entries()).forEach(o=>{let[p,{videoStats:g,audioStats:b,videoPcStats:A}]=o;const j=b,H=g,z=A,$=fI({},k6),Vt=fI({},D6),_r=fI({},$Z),{audioTrack:Fi,videoTrack:_l,audioSSRC:_u,videoSSRC:_h}=i.getRemoteMedia(p),_g=i.getStats(),eE=_g==null?void 0:_g.audioRecv.find(vE=>vE.ssrc===_u),oE=_g==null?void 0:_g.videoRecv.find(vE=>vE.ssrc===_h),SE=this.trafficStats&&this.trafficStats.peer_delay.find(vE=>vE.peer_uid===p);if(eE&&(eE.codec!=="opus"&&eE.codec!=="aac"&&eE.codec!=="PCMU"&&eE.codec!=="PCMA"&&eE.codec!=="G722"||($.codecType=eE.codec),eE.outputLevel?$.receiveLevel=Math.round(32767*eE.outputLevel):Fi&&($.receiveLevel=Math.round(32767*Fi.getVolumeLevel())),$.receiveBytes=eE.bytes,$.receivePackets=eE.packets,$.receivePacketsLost=eE.packetsLost,$.packetLossRate=$.receivePacketsLost/($.receivePackets+$.receivePacketsLost),$.receiveBitrate=j?8*Math.max(0,$.receiveBytes-j.receiveBytes):0,$.totalDuration=j?j.totalDuration+1:1,$.totalFreezeTime=j?j.totalFreezeTime:0,$.freezeRate=$.totalFreezeTime/$.totalDuration,$.receiveDelay=eE.jitterBufferMs,$.totalDuration>10&&oO.isRemoteAudioFreeze(Fi)&&($.totalFreezeTime+=1)),oE){oE.codec!=="H264"&&oE.codec!=="H265"&&oE.codec!=="VP8"&&oE.codec!=="VP9"&&oE.codec!=="AV1X"&&oE.codec!=="AV1"||(Vt.codecType=oE.codec),Vt.receiveBytes=oE.bytes,Vt.receiveBitrate=H?8*Math.max(0,Vt.receiveBytes-H.receiveBytes):0,Vt.decodeFrameRate=oE.decodeFrameRate<0?0:oE.decodeFrameRate,Vt.renderFrameRate=oE.decodeFrameRate<0?0:oE.decodeFrameRate,oE.outputFrame&&(Vt.renderFrameRate=oE.outputFrame.frameRate),oE.receivedFrame?(Vt.receiveFrameRate=oE.receivedFrame.frameRate,Vt.receiveResolutionHeight=oE.receivedFrame.height,Vt.receiveResolutionWidth=oE.receivedFrame.width):_l&&(Vt.receiveResolutionHeight=_l._videoHeight||0,Vt.receiveResolutionWidth=_l._videoWidth||0),oE.framesRateFirefox!==void 0&&(Vt.receiveFrameRate=Math.round(oE.framesRateFirefox)),Vt.receivePackets=oE.packets,Vt.receivePacketsLost=oE.packetsLost,Vt.packetLossRate=Vt.receivePacketsLost/(Vt.receivePackets+Vt.receivePacketsLost),Vt.totalDuration=H?H.totalDuration+1:1,Vt.totalFreezeTime=H?H.totalFreezeTime:0,Vt.receiveDelay=oE.jitterBufferMs||0;const vE=!!_h&&i.getRemoteVideoIsReady(_h);_l&&vE&&oO.isRemoteVideoFreeze(_l,oE,z)&&(Vt.totalFreezeTime+=1),Vt.freezeRate=Vt.totalFreezeTime/Vt.totalDuration}SE&&($.end2EndDelay=SE.B_ad,Vt.end2EndDelay=SE.B_vd,$.transportDelay=SE.B_ed,Vt.transportDelay=SE.B_ed,$.currentPacketLossRate=SE.B_ealr4/100,Vt.currentPacketLossRate=SE.B_evlr4/100,_r.uplinkNetworkQuality=SE.B_punq?SE.B_punq:0,_r.downlinkNetworkQuality=SE.B_pdnq?SE.B_pdnq:0),this.remoteStats.set(p,{audioStats:$,videoStats:Vt,videoPcStats:oE,networkStats:_r}),Fi&&this.exceptionMonitor.setRemoteAudioStats(Fi,$),_l&&this.exceptionMonitor.setRemoteVideoStats(_l,Vt)})}}function n5(l,i){var o=Object.keys(l);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(l);i&&(p=p.filter(function(g){return Object.getOwnPropertyDescriptor(l,g).enumerable})),o.push.apply(o,p)}return o}function nP(l){for(var i=1;i<arguments.length;i++){var o=arguments[i]!=null?arguments[i]:{};i%2?n5(Object(o),!0).forEach(function(p){_e(l,p,o[p])}):Object.getOwnPropertyDescriptors?Object.defineProperties(l,Object.getOwnPropertyDescriptors(o)):n5(Object(o)).forEach(function(p){Object.defineProperty(l,p,Object.getOwnPropertyDescriptor(o,p))})}return l}function d1(l){return l.match(/^[\.\:\d]+$/)?"".concat(l.replace(/[^\d]/g,"-"),".").concat(nE("TURN_DOMAIN")):(Gi.info("Cannot recognized as IP address ".concat(l,". Used As Host instead")),l)}function r5(l,i){var o,p;const g=nE("GATEWAY_DOMAINS");let b=g[1]&&i.indexOf(g[1])!==-1?1:0;l.addresses=l.addresses||[];const A=l.addresses.map(H=>H.domain_prefix?{address:"".concat(H.domain_prefix,".").concat(g[b++%g.length],":").concat(H.port)}:H.ip.match(/^[\.\:\d]+$/)?{ip:H.ip,port:H.port,address:"".concat(H.ip.replace(/[^\d]/g,"-"),".").concat(g[b++%g.length],":").concat(H.port)}:(Gi.info("Cannot recognized as IP address ".concat(H.ip,". Used As Host instead")),{ip:H.ip,port:H.port,address:"".concat(H.ip,":").concat(H.port)}));if((o=l.detail)!==null&&o!==void 0&&o[18]&&typeof((p=l.detail)===null||p===void 0?void 0:p[18])=="string"){const H=l.detail[18],z=H==null?void 0:H.split(";");for(let $=0;$<z.length;$++){var j;const Vt=bM(j=z[$]).call(j);A[$]&&Vt&&(A[$].ip6=Vt)}}return{gatewayAddrs:A,uid:l.uid,cid:l.cid,cert:l.cert,vid:l.detail&&l.detail[8],uni_lbs_ip:l.detail&&l.detail[1],res:l,csIp:l.detail&&l.detail[502]}}function US(l){return typeof l=="number"?l:l.exact||l.ideal||l.max||l.min||0}function rP(l){const i=l._encoderConfig;if(!i)return{};const o={resolution:i.width&&i.height?"".concat(US(i.width),"x").concat(US(i.height)):void 0,maxVideoBW:i.bitrateMax,minVideoBW:i.bitrateMin};return typeof i.frameRate=="number"?(o.maxFrameRate=i.frameRate,o.minFrameRate=i.frameRate):i.frameRate&&(o.maxFrameRate=i.frameRate.max||i.frameRate.ideal||i.frameRate.exact||i.frameRate.min,o.minFrameRate=i.frameRate.min||i.frameRate.ideal||i.frameRate.exact||i.frameRate.max),o}function i5(l){const i={connectionType:0,googRtt:l.rtt};switch(l.selectedCandidatePair.localCandidate.candidateType){case"relay":{const o=l.selectedCandidatePair.localCandidate.relayProtocol;o==="udp"&&(i.connectionType=1),o==="tcp"&&(i.connectionType=3),o==="tls"&&(i.connectionType=4);break}case"srflx":i.connectionType=2}return i}function s5(l){return l>=0&&l<.17?1:l>=.17&&l<.36?2:l>=.36&&l<.59?3:l>=.59&&l<=1?4:l>1?5:0}function a2(l,i){let o,p,g;switch(i){case v0.CHOOSE_SERVER:p=4096,g="choose server";break;case v0.CLOUD_PROXY:p=1048576,g="proxy";break;case v0.CLOUD_PROXY_5:p=4194304,g="proxy5";break;case v0.CLOUD_PROXY_FALLBACK:p=4194310,g="proxy fallback";break;default:throw new hE(_p.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:l.detail&&l.detail[502],retry:!1})}if(l.response_body.forEach(b=>{b.buffer&&b.buffer.flag===p&&(o={code:b.buffer.code,addresses:(b.buffer.edges_services||[]).map(A=>nP(nP({},A),{},{ticket:b.buffer.cert})),server_ts:l.enter_ts,uid:b.buffer.uid,cid:b.buffer.cid,cname:b.buffer.cname,detail:nP(nP({},b.buffer.detail),l.detail),flag:b.buffer.flag,opid:l.opid,cert:b.buffer.cert})}),!o)throw new hE(_p.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(g," from multi unilbs response"),{csIp:l.detail&&l.detail[502]});return o}async function get(l,i){return await pE.all(l.addresses.map(async o=>({address:d1(o.ip),tcpport:o.port,udpport:o.port,username:i&&nE("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?i.toString():wS.username,password:i&&nE("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await T$(i.toString()):wS.password})))}function c2(l,i){const o=i._videoHeight||i.getMediaStreamTrack(!0).getSettings().height;return o?Math.max(o/US(l.height),1):(Gi.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function IR(l){let{candidateType:i,relayProtocol:o,type:p,address:g,port:b,protocol:A}=l;return p==="local-candidate"?{candidateType:i,relayProtocol:o,protocol:A}:{candidateType:i,relayProtocol:o,address:g,port:b,protocol:A}}function o5(l,i){var o=Object.keys(l);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(l);i&&(p=p.filter(function(g){return Object.getOwnPropertyDescriptor(l,g).enumerable})),o.push.apply(o,p)}return o}class Eet extends D_{get url(){return this._url?this._url:null}get reconnectMode(){return this._reconnectMode}set reconnectMode(i){var o;VE(o=["tryNext","recover"]).call(o,i)&&this.resetReconnectCount(i),this._reconnectMode=i}get state(){return this._state}set state(i){i!==this._state&&(this._state=i,this._state==="reconnecting"?this.emit(W_.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(W_.CONNECTED):this._state==="closed"?this.emit(W_.CLOSED):this._state==="failed"&&this.emit(W_.FAILED))}constructor(i,o,p,g){super(),_e(this,"connectionID",0),_e(this,"currentURLIndex",0),_e(this,"reconnectReason",void 0),_e(this,"_reconnectMode","tryNext"),_e(this,"_name",void 0),_e(this,"_state","closed"),_e(this,"_retryConfig",void 0),_e(this,"_reconnectCount",0),_e(this,"_forceCloseTimeout",5e3),_e(this,"_onlineReconnectListener",void 0),_e(this,"_closeEstablishingTransmitter",()=>{}),_e(this,"_store",void 0),_e(this,"_joinChannelServiceRecordIndex",void 0),_e(this,"_useCompress",void 0),_e(this,"_inflateLength",0),_e(this,"_deflateLength",0),this._store=g,this._name=i,this._retryConfig=function(b){for(var A=1;A<arguments.length;A++){var j=arguments[A]!=null?arguments[A]:{};A%2?o5(Object(j),!0).forEach(function(H){_e(b,H,j[H])}):Object.getOwnPropertyDescriptors?Object.defineProperties(b,Object.getOwnPropertyDescriptors(j)):o5(Object(j)).forEach(function(H){Object.defineProperty(b,H,Object.getOwnPropertyDescriptor(j,H))})}return b}({},o),this._useCompress=p}resetReconnectCount(i){Gi.debug("".concat(this._name," reset reconnect count, reason: ").concat(i)),this._reconnectCount=0}close(i,o){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this._reconnectInterrupter&&this._reconnectInterrupter(),this._transmitter){this._transmitter.onclose=null,this._transmitter.onopen=null,this._transmitter.onmessage=null;const p=this._transmitter;o?setTimeout(()=>p.close(),500):p.close(),this._transmitter=void 0}this.state=i?"failed":"closed",this._closeEstablishingTransmitter&&this._closeEstablishingTransmitter()}reconnect(i,o){if(!this._transmitter)return void Gi.warning("[".concat(this._name,"] can not reconnect, no websocket"));var p;i!==void 0&&(this.reconnectMode=i),Gi.debug("[".concat(this._name,"] reconnect is triggered initiative")),typeof this._joinChannelServiceRecordIndex=="number"&&((p=this._store)===null||p===void 0||p.recordJoinChannelService({status:"error",errors:[new Error(o)]},this._joinChannelServiceRecordIndex));const g=this._transmitter.onclose;this._transmitter.onclose=null,this._transmitter.close(),g&&g.bind(this._transmitter)({code:9999,reason:o})}getInflateData(){const i=this._inflateLength,o=this._deflateLength;return this.clearInflateData(),{inflateLength:i,deflateLength:o}}setInflateData(i){this._deflateLength=this._deflateLength+i.originLength,this._inflateLength=this._inflateLength+i.compressedLength}clearInflateData(){this._inflateLength=0,this._deflateLength=0}}var YS;(function(l){l[l.Default=0]="Default",l[l.Ack=1]="Ack"})(YS||(YS={}));class vet{constructor(i,o,p){_e(this,"version",1),_e(this,"initialRTO",void 0),_e(this,"maxBatchAckCount",void 0),_e(this,"maxRTO",void 0),_e(this,"initialRTT",void 0),_e(this,"ID",void 0),_e(this,"rtt",void 0),_e(this,"packetNumber",1),_e(this,"rtoRatioMap",new Map),_e(this,"timeoutMap",new Map),_e(this,"unorderedPacketQueue",[]),_e(this,"batchAckPacketQueue",[]),_e(this,"lastOrderedPacketNumber",0),_e(this,"batchAckTimer",void 0),_e(this,"sendImpl",void 0),_e(this,"receiveImpl",void 0),this.sendImpl=i,this.receiveImpl=o,this.ID=T_(7,"transmitter-"),this.initialRTO=(p==null?void 0:p.initialRTO)!==void 0?p.initialRTO:nE("TRANSMITTER_INITIAL_RTO"),this.initialRTT=(p==null?void 0:p.initialRTT)!==void 0?p.initialRTT:nE("TRANSMITTER_INITIAL_RTT"),this.rtt=(p==null?void 0:p.initialRTT)!==void 0?p.initialRTT:nE("TRANSMITTER_INITIAL_RTT"),this.maxBatchAckCount=(p==null?void 0:p.maxBatchAckCount)!==void 0?p.maxBatchAckCount:nE("TRANSMITTER_MAX_BATCH_ACK_COUNT"),this.maxRTO=(p==null?void 0:p.maxRTO)!==void 0?p.maxRTO:nE("TRANSMITTER_MAX_RTO")}packetize(i,o){return{type:YS.Default,version:this.version,packetNumber:o,payload:i}}serialize(i){switch(i.type){case YS.Default:{let o;typeof i.payload=="string"?o=new TextEncoder().encode(i.payload):o=i.payload;const p=new ArrayBuffer(o.length+15),g=new DataView(p);return g.setUint16(0,i.version),g.setUint8(2,i.type),g.setUint32(3,i.packetNumber),YV(g,7,BigInt(i.sendTs)),new Uint8Array(g.buffer).set(o,15),p}case YS.Ack:{const o=new ArrayBuffer(16),p=new DataView(o);return p.setUint16(0,i.version),p.setUint8(2,i.type),p.setUint32(3,i.maxAckPacketNumber),p.setUint8(7,i.shift),YV(p,8,BigInt(i.ackSendTs)),o}}}deserialize(i){const o=new DataView(i),p=o.getUint16(0),g=o.getUint8(2);switch(g){case YS.Default:{const b=o.getUint32(3),A=KV(o,7),j=i.slice(15),H=new TextDecoder().decode(j);return{version:p,type:g,packetNumber:b,sendTs:Number(A),payload:H}}case YS.Ack:{const b=o.getUint32(3),A=o.getUint8(7),j=KV(o,8);return{version:p,type:g,maxAckPacketNumber:b,shift:A,ackSendTs:Number(j)}}default:throw Gi.error("[".concat(this.ID,"] Unrecognized packet type ").concat(g)),new Error("Unrecognized packet type ".concat(g))}}sendMessage(i){const o=this.packetize(i,this.packetNumber);this.packetNumber=this.packetNumber===4294967295?1:this.packetNumber+1;const p=this.calculateRTO(o),g=window.setTimeout(()=>{this.resendMessage(o)},p);this.timeoutMap.set(o.packetNumber,g),this.sendPacket(o)}onData(i){const o=this.deserialize(i);o.type===YS.Default?this.ack(o):o.type===YS.Ack&&(this.updateRTT(o,Math.round(performance.now())),this.clearRTO(o))}close(){this.rtt=this.initialRTT,this.packetNumber=1,Array.from(this.timeoutMap.entries()).forEach(i=>{let[o,p]=i;window.clearTimeout(p)}),this.timeoutMap=new Map,this.rtoRatioMap=new Map,this.unorderedPacketQueue=[],this.batchAckPacketQueue=[],this.lastOrderedPacketNumber=0,this.batchAckTimer!==void 0&&window.clearTimeout(this.batchAckTimer)}resendMessage(i){const o=this.calculateRTO(i),p=window.setTimeout(()=>{this.resendMessage(i)},o);this.timeoutMap.set(i.packetNumber,p),this.sendPacket(i)}calculateRTO(i){const o=this.rtoRatioMap.get(i.packetNumber);if(o===void 0)return this.rtoRatioMap.set(i.packetNumber,1),this.initialRTO;{const p=9*this.rtt/8*o;return this.rtoRatioMap.set(i.packetNumber,o+1),p>this.maxRTO?this.maxRTO:p}}updateRTT(i,o){const p=i.ackSendTs;this.rtt=this.rtt*(7/8)+(o-p-this.rtt)/8}ack(i){if(i.packetNumber===this.lastOrderedPacketNumber+1)for(this.batchAckPacketQueue.length>=this.maxBatchAckCount&&this.batchAck(),this.batchAckTimer?this.batchAckPacketQueue.push(i):(this.batchAckPacketQueue.push(i),this.batchAckTimer=window.setTimeout(()=>{this.batchAck()},this.rtt/8)),this.lastOrderedPacketNumber+=1,this.receiveImpl(i.payload);;){const o=this.unorderedPacketQueue[0];if(!o){this.unorderedPacketQueue.shift();break}this.batchAckTimer&&this.batchAck(),this.receiveImpl(o.payload),this.unorderedPacketQueue.shift(),this.lastOrderedPacketNumber+=1}else if(i.packetNumber<=this.lastOrderedPacketNumber){const o={ackSendTs:i.sendTs,maxAckPacketNumber:i.packetNumber,shift:0,type:YS.Ack,version:this.version};this.sendPacket(o)}else if(i.packetNumber>this.lastOrderedPacketNumber){this.unorderedPacketQueue[i.packetNumber-this.lastOrderedPacketNumber-2]=i;const o={ackSendTs:i.sendTs,maxAckPacketNumber:i.packetNumber,shift:0,type:YS.Ack,version:this.version};this.sendPacket(o)}}batchAck(){window.clearTimeout(this.batchAckTimer),this.batchAckTimer=void 0;const i={ackSendTs:this.batchAckPacketQueue[this.batchAckPacketQueue.length-1].sendTs,maxAckPacketNumber:this.batchAckPacketQueue[this.batchAckPacketQueue.length-1].packetNumber,shift:this.batchAckPacketQueue.length-1,type:YS.Ack,version:this.version};this.sendPacket(i),this.batchAckPacketQueue=[]}sendPacket(i){i.type===YS.Default&&(i.sendTs=Math.round(performance.now()));const o=this.serialize(i);this.sendImpl(o)}clearRTO(i){for(let o=i.maxAckPacketNumber-i.shift;o<=i.maxAckPacketNumber;o++){const p=this.timeoutMap.get(o);p!==void 0&&window.clearTimeout(p),this.timeoutMap.delete(o),this.rtoRatioMap.delete(o)}}}class a5 extends Eet{constructor(i,o){super(i,o,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3?arguments[3]:void 0),_e(this,"_initMutex",void 0),_e(this,"_reconnectInterrupter",void 0),_e(this,"_url",void 0),_e(this,"_transmitter",void 0),_e(this,"_addresses",void 0),_e(this,"_reliableTransmission",void 0),this._initMutex=new E0("datachannel");const{timeout:p,timeoutFactor:g}=o,b=Math.max(300,Math.floor(3*p/5)),A=Math.max(1.2,Math.floor(8*g)/10);K0.ONLINE&&(this._retryConfig.timeout=b,this._retryConfig.timeoutFactor=A),X_.on(YT.NETWORK_STATE_CHANGE,(j,H)=>{j!==H&&(this.resetReconnectCount("network state change: ".concat(H," -> ").concat(j)),j===K0.ONLINE?(this._retryConfig.timeout=b,this._retryConfig.timeoutFactor=A):(this._retryConfig.timeout=p,this._retryConfig.timeoutFactor=g))})}getConnection(){if(this._reliableTransmission)return this._reliableTransmission}async init(i){let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;this._forceCloseTimeout=o;const p=(g,b)=>{this._addresses=i,this.currentURLIndex=this._addresses.findIndex(j=>j.fingerprint||nE("FINGERPRINT"));const A=this._addresses[this.currentURLIndex];this.state="connecting",this.createTransmitterConnection(A).then(g).catch(b),this.once(W_.CLOSED,()=>b(new hE(_p.WS_DISCONNECT))),this.once(W_.CONNECTED,()=>g())};return this._initMutex.lock().then(g=>new pE((b,A)=>{p(b,A)}).then(()=>{g()}).catch(()=>{g()}))}sendMessage(i){let o=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this._transmitter||!this._reliableTransmission)throw new hE(_p.WS_ABORT,"datachannel is not ready");try{o||(i=JSON.stringify(i)),this._reliableTransmission.sendMessage(i)}catch(p){throw new hE(_p.WS_ERR,"send datachannel signal message error"+p.toString())}}unbindDcCloseEventListener(){this._transmitter&&(this._transmitter.onclose=null)}sendMessageWithJSON(i){const o=JSON.stringify(i);return{compressed:o,compressedLength:o.length,origin:i}}sendMessageWithUint8Array(i){return{compressed:i,compressedLength:i.byteLength,origin:i}}createTransmitterConnection(i){return this.connectionID+=1,this._joinChannelServiceRecordIndex=void 0,this._url="dc://".concat(i.ip,":").concat(i.port),new pE((o,p)=>{var g;const b=()=>{Gi.debug("[".concat(this._name,"] datachannel opened:"),this._url),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),o()},A=async $=>{var Vt;if((Vt=this._closeEstablishingTransmitter)===null||Vt===void 0||Vt.call(this),Gi.debug("[".concat(this._name,"] datachannel close ").concat(this._url,", code: ").concat($.code,", reason: ").concat($.reason,", current mode: ").concat(this.reconnectMode)),this._reconnectCount<this._retryConfig.maxRetryCount){this.state==="connected"&&(this.reconnectReason=$.reason,this.state="reconnecting");const _r=oS(this,W_.WILL_RECONNECT,this.reconnectMode)||this.reconnectMode,Fi=await this.reconnectWithAction(_r);if(this.state==="closed")return void Gi.debug("[".concat(this.connectionID,"] dc is closed, no need to reconnect"));if(!Fi)return p(new hE(_p.WS_DISCONNECT,"datachannel reconnect failed: ".concat($.code))),void this.close(!0);o()}else p(new hE(_p.WS_DISCONNECT,"datachannel close: ".concat($.code))),this.close()},j=$=>{var Vt;(Vt=this._reliableTransmission)===null||Vt===void 0||Vt.onData($.data)};this._transmitter&&(this._transmitter.onclose=null,this._transmitter.close()),this._reliableTransmission&&(this._reliableTransmission.close(),this._reliableTransmission=void 0),Gi.debug("[".concat(this._name,"] start connect, address: ").concat(JSON.stringify(i)));const H=(g=this._store)===null||g===void 0?void 0:g.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"}),z=Date.now();U_(this,W_.TO_CONNECT_DATACHANNEL,i).then($=>{var Vt,_r;if(!$)throw new Error("transmissonInfo not exist yet");const{transmitter:Fi,close:_l}=$;this._transmitter=Fi,(Vt=this._store)===null||Vt===void 0||Vt.signalChannelOpen();const _u=Date.now()-z;Gi.debug("[choose dc] dc open cost ".concat(_u,"ms")),this._reliableTransmission=new vet(_h=>{var _g;this._transmitter&&this._transmitter.readyState==="open"&&((_g=this._transmitter)===null||_g===void 0||_g.send(_h))},_h=>{typeof _h=="string"&&this.emit(W_.ON_MESSAGE,_h)}),this._closeEstablishingTransmitter=()=>{var _h;(_h=this._reliableTransmission)===null||_h===void 0||_h.close(),this._reliableTransmission=void 0,_l()},b&&b(),Fi.onclose=A,Fi.onmessage=j,(_r=this._store)===null||_r===void 0||_r.recordJoinChannelService({endTs:Date.now(),status:"success"},H),this._joinChannelServiceRecordIndex=H}).catch($=>{var Vt;if((Vt=this._store)===null||Vt===void 0||Vt.recordJoinChannelService({endTs:Date.now(),status:$ instanceof hE&&$.code===_p.WS_ABORT?"aborted":"error",errors:[$]},H),this.state!=="closed"){if($ instanceof hE&&$.code===_p.WS_ERR){const _r=new hE(_p.WS_ERR,"init datachannel failed! Error: ".concat($.toString()));return Gi.error("[".concat(this._name,"]").concat(_r)),void p(_r)}A&&A($)}else p(new hE(_p.WS_DISCONNECT,"datachannel is closed: ".concat($.toString())))})})}async reconnectWithAction(i){let o=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this._reconnectCount>=this._retryConfig.maxRetryCount||!this._addresses||this.state==="closed")return!1;this._onlineReconnectListener||X_.networkState!==K0.OFFLINE||(this._onlineReconnectListener=X_.onlineWaiter&&X_.onlineWaiter.then(()=>{this._onlineReconnectListener=void 0}));let p=!0;if(this._reconnectInterrupter=()=>{p=!1},o){const j=mN(this._reconnectCount,this._retryConfig);Gi.debug("[".concat(this._name,"] wait ").concat(j,"ms to reconnect datachannel, mode: ").concat(i)),await pE.race([w0(j),this._onlineReconnectListener||new pE(()=>{})])}if(this.state==="closed"||!p)return!1;this._reconnectCount+=1;const g=async(j,H)=>{this.emit(W_.RECONNECT_CREATE_CONNECTION,H),await this.createTransmitterConnection(j)};try{if(i==="retry"){const j=this._addresses[this.currentURLIndex];this.emit(W_.RECONNECT_WAITTING_FINISH,i),await g(j,i)}else if(i==="tryNext"){this.currentURLIndex+=1;for(let H=this.currentURLIndex;H<this._addresses.length;H++){if(this._addresses[H].fingerprint||nE("FINGERPRINT")){this.currentURLIndex=H;break}this.currentURLIndex+=1}if(this.currentURLIndex>=this._addresses.length)return Gi.debug("[".concat(this._name,"] the available addresses are exhausted, change to recover")),await this.reconnectWithAction("recover",!1);Gi.debug("[".concat(this._name,"] datachannel url length: ").concat(this._addresses.length," current index: ").concat(this.currentURLIndex));const j=this._addresses[this.currentURLIndex];this.emit(W_.RECONNECT_WAITTING_FINISH,i),await g(j,i)}else i==="recover"&&(Gi.debug("[".concat(this._name,"] start to failback to websocket")),this.resetReconnectCount("recover mode"),this.emit(W_.RECONNECT_WAITTING_FINISH,i),this.emit(W_.FAILBACK));return!0}catch(j){var b,A;return Gi.error("[".concat(this._name,"] reconnect failed"),j.toString()),j!=null&&(b=j.data)!==null&&b!==void 0&&b.desc&&Array.isArray(j.data.desc)&&j.data.desc.length&&VE(A=j.data.desc).call(A,"dynamic key expired")?(this.emit(W_.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):await this.reconnectWithAction(i,o)}}}class tR extends D_{get connectionState(){return this._connectionState}set connectionState(i){i!==this._connectionState&&(this._connectionState=i,i===t_.CONNECTED?this.emit(kE.WS_CONNECTED):i===t_.RECONNECTING?this.emit(kE.WS_RECONNECTING,this._websocketReconnectReason):i===t_.CLOSED&&this.emit(kE.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket?this.websocket.url:null}get rtt(){return this.rttRolling.mean()}constructor(i,o){super(),_e(this,"_disconnectedReason",void 0),_e(this,"_websocketReconnectReason",void 0),_e(this,"_connectionState",t_.CLOSED),_e(this,"reconnectToken",void 0),_e(this,"websocket",void 0),_e(this,"openConnectionTime",void 0),_e(this,"clientId",void 0),_e(this,"lastMsgTime",Date.now()),_e(this,"uploadCache",[]),_e(this,"uploadCacheInterval",void 0),_e(this,"rttRolling",new WL(5)),_e(this,"pingpongTimer",void 0),_e(this,"inflateDataTimer",void 0),_e(this,"pingpongTimeoutCount",0),_e(this,"joinResponse",void 0),_e(this,"multiIpOption",void 0),_e(this,"initError",void 0),_e(this,"spec",void 0),_e(this,"store",void 0),_e(this,"onWebsocketMessage",p=>{if(p instanceof ArrayBuffer)return void this.emit(kE.ON_BINARY_DATA,p);const g=JSON.parse(p);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(g,"_id")){const b="res-@".concat(g._id);this.emit(b,g._result,g._message)}else if(Object.prototype.hasOwnProperty.call(g,"_type")&&(this.emit(g._type,g._message),g._type===JE.ON_NOTIFICATION&&this.handleNotification(g._message),g._type===JE.ON_USER_BANNED))switch(g._message.error_code){case 14:this.close(e_.UID_BANNED);break;case 15:this.close(e_.IP_BANNED);break;case 16:this.close(e_.CHANNEL_BANNED)}}),this.clientId=i.clientId,this.spec=i,this.store=o,this.websocket=new a5("gateway-".concat(this.clientId),this.spec.retryConfig,!0,o),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===t_.CONNECTED&&this.reconnect("retry",NT.OFFLINE)})}async request(i,o,p,g){const b=T_(6,""),A={_id:b,_type:i,_message:o},j=this.websocket.connectionID,H=()=>new pE((_l,_u)=>{if(this.connectionState===t_.CONNECTED)return _l();const _h=()=>{this.off(kE.WS_CLOSED,_g),_l()},_g=()=>{this.off(kE.WS_CONNECTED,_h),_u(new hE(_p.WS_ABORT))};this.once(kE.WS_CONNECTED,_h),this.once(kE.WS_CLOSED,_g),i!==FE.PUBLISH&&i!==FE.SUBSCRIBE&&i!==FE.UNSUBSCRIBE&&i!==FE.UNPUBLISH&&i!==FE.CONTROL&&i!==FE.RESTART_ICE||this.once(kE.DISCONNECT_P2P,()=>{_u(new hE(_p.DISCONNECT_P2P))}),i!==FE.PUBLISH&&i!==FE.RESTART_ICE||this.once(kE.ABORT_P2P_EXECUTION,()=>{_u(new hE(_p.DISCONNECT_P2P))})});if(this.connectionState!==t_.CONNECTING&&this.connectionState!==t_.RECONNECTING||i===FE.JOIN||i===FE.REJOIN||await H(),i===FE.LEAVE&&(this.websocket.unbindDcCloseEventListener(),g=!0),this.websocket.sendMessage(A,!0,!1),g)return;const z=new pE((_l,_u)=>{let _h=!1;const _g=(oE,SE)=>{_h=!0,_l({isSuccess:oE==="success",message:SE||{}}),this.off(kE.WS_CLOSED,eE),this.off(kE.WS_RECONNECTING,eE),this.emit(kE.REQUEST_SUCCESS,i,o)};this.once("res-@".concat(b),_g);const eE=()=>{_u(new hE(_p.WS_ABORT,"type: ".concat(i))),this.off(kE.WS_CLOSED,eE),this.off(kE.WS_RECONNECTING,eE),this.off("res-@".concat(b),_g)};this.once(kE.WS_CLOSED,eE),this.once(kE.WS_RECONNECTING,eE),w0(nE("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==j||_h||(Gi.warning("dc request timeout, type: ".concat(i)),this.emit(kE.REQUEST_TIMEOUT,i,o))})});let $=null;try{$=await z}catch(_l){if(this.connectionState===t_.CLOSED||i===FE.LEAVE)throw new hE(_p.WS_ABORT);return!this.spec.forceWaitGatewayResponse||p?_l.throw():i===FE.JOIN||i===FE.REJOIN?null:(await H(),await this.request(i,o))}if($.isSuccess)return $.message;const Vt=Number($.message.error_code||$.message.code),_r=iI(Vt),Fi=new hE(_p.UNEXPECTED_RESPONSE,"".concat(_r.desc,": ").concat($.message.error_str),{code:Vt,data:$.message});return _r.action==="success"?$.message:(Gi.warning("[".concat(this.websocket.connectionID,"] unexpected response from type ").concat(i,", error_code: ").concat(Vt,", message: ").concat(_r.desc,", action: ").concat(_r.action)),Vt===qE.ERR_TOO_MANY_BROADCASTERS?((i===FE.JOIN||i===FE.REJOIN)&&(this.initError=Fi,this.close()),Fi.throw()):_r.action==="failed"?Fi.throw():_r.action==="quit"?(this.initError=Fi,this.close(),Fi.throw()):(Vt===qE.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=$.message.option,Gi.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",NT.MULTI_IP)):this.reconnect(_r.action,NT.SERVER_ERROR),i===FE.JOIN||i===FE.REJOIN?null:await this.request(i,o)))}waitMessage(i,o){return new pE(p=>{const g=b=>{(!o||o(b))&&(this.off(i,g),p(b))};this.on(i,g)})}upload(i,o){const p={_type:i,_message:o};try{this.websocket.sendMessage(p)}catch{const b=nE("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(p),this.uploadCache.length>b&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==t_.CONNECTED)return;const A=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(A._type,A._message)},nE("UPLOAD_CACHE_INTERVAL")||2e3))}}send(i,o){const p={_type:i,_message:o};this.websocket.sendMessage(p)}init(i,o){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new pE((p,g)=>{this.once(kE.WS_CONNECTED,()=>p(this.joinResponse)),this.once(kE.WS_CLOSED,()=>g(this.initError||new hE(_p.WS_ABORT))),this.connectionState=t_.CONNECTING,this.websocket.init(i).catch(g),this.websocket.once(W_.FAILBACK,()=>{this.openConnectionTime===void 0&&g(new hE(_p.INIT_DATACHANNEL_TIMEOUT))}),this.inflateDataTimer&&window.clearInterval(this.inflateDataTimer),this.inflateDataTimer=window.setInterval(()=>{this.handleInflateData()},2e4),setTimeout(()=>{o&&this.openConnectionTime===void 0&&(Gi.debug("[".concat(this.clientId,"] init datachannel timeout while join with failback to websocket")),g(new hE(_p.INIT_DATACHANNEL_TIMEOUT)))},nE("DC_JOIN_WITH_FAILBACK"))})}close(i){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.inflateDataTimer&&(this.handleInflateData(),window.clearInterval(this.inflateDataTimer),this.inflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=i||e_.LEAVE,this.connectionState=t_.CLOSED,Gi.debug("[".concat(this.clientId,"] ")+"will close datachannel in signal"),this.websocket.close(),i===e_.FALLBACK&&(this.websocket.removeAllListeners(),this.websocket=new a5("gateway-".concat(this.clientId),this.spec.retryConfig,!0,this.store),this.handleWebsocketEvents())}async join(){if(!this.joinResponse){this.emit(kE.ABORT_P2P_EXECUTION);const i=await U_(this,kE.DATACHANNEL_CONNECTING),o=await this.request(FE.JOIN,i);if(!o)return this.emit(kE.REPORT_JOIN_GATEWAY,_p.TIMEOUT,this.url||""),!1;this.joinResponse=o,this.emit(kE.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=t_.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new hE(_p.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const i=JT(this,kE.REQUEST_REJOIN_INFO);i.token=this.reconnectToken;const o=await this.request(FE.REJOIN,i);return!!o&&(this.connectionState=t_.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),o.peers&&o.peers.forEach(p=>{this.emit(JE.ON_USER_ONLINE,{uid:p.uid}),p.audio&&this.emit(JE.ON_ADD_AUDIO_STREAM,{uid:p.uid,uint_id:p.uint_id,audio:!0,ssrcId:p.audio_ssrc}),p.video&&this.emit(JE.ON_ADD_VIDEO_STREAM,{uid:p.uid,uint_id:p.uint_id,video:!0,ssrcId:p.video_ssrc}),p.audio_mute?this.emit(JE.MUTE_AUDIO,{uid:p.uid}):this.emit(JE.UNMUTE_AUDIO,{uid:p.uid}),p.video_mute?this.emit(JE.MUTE_VIDEO,{uid:p.uid}):this.emit(JE.UNMUTE_VIDEO,{uid:p.uid}),p.audio_enable_local?this.emit(JE.ENABLE_LOCAL_AUDIO,{uid:p.uid}):this.emit(JE.DISABLE_LOCAL_AUDIO,{uid:p.uid}),p.video_enable_local?this.emit(JE.ENABLE_LOCAL_VIDEO,{uid:p.uid}):this.emit(JE.DISABLE_LOCAL_VIDEO,{uid:p.uid}),p.audio||p.video||this.emit(JE.ON_REMOVE_STREAM,{uid:p.uid,uint_id:p.uint_id})}),!0)}reconnect(i,o){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(i,o)}handleNotification(i){Gi.debug("[".concat(this.clientId,"] receive notification: "),i);const o=iI(i.code);if(o.action!=="success"){if(o.action!=="failed")return o.action==="quit"?(o.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(e_.UID_BANNED),void this.close()):void this.reconnect(o.action,NT.SERVER_ERROR);Gi.error("[".concat(this.clientId,"] ignore error: "),o.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const i=nE("PING_PONG_TIME_OUT"),o=Date.now();this.pingpongTimeoutCount>=i&&(Gi.warning("PINGPONG Timeout. Last Socket Message: ".concat(o-this.lastMsgTime,"ms")),o-this.lastMsgTime>nE("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",NT.TIMEOUT):this.request(FE.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const p=Date.now()-o;this.rttRolling.add(p),nE("REPORT_STATS")&&this.send(FE.PING_BACK,{pingpongElapse:p})}).catch(p=>{})}handleInflateData(){const{inflateLength:i,deflateLength:o}=this.websocket.getInflateData();i!==0&&o!==0&&this.upload(uS.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:o,ws_inflate_length:i})}handleWebsocketEvents(){this.websocket.on(W_.RECONNECT_WAITTING_FINISH,i=>{this.emit(kE.WS_RECONNECT_WAITTING_FINISH,i)}),this.websocket.on(W_.RECONNECT_CREATE_CONNECTION,i=>{this.emit(kE.WS_RECONNECT_CREATE_CONNECTION,i)}),this.websocket.on(W_.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(W_.CLOSED,()=>{this.connectionState=t_.CLOSED}),this.websocket.on(W_.FAILED,()=>{this._disconnectedReason=e_.NETWORK_ERROR,this.connectionState=t_.CLOSED}),this.websocket.on(W_.RECONNECTING,i=>{this._websocketReconnectReason=i,this.joinResponse=void 0,this.connectionState===t_.CONNECTED?this.connectionState=t_.RECONNECTING:this.connectionState=t_.CONNECTING}),this.websocket.on(W_.WILL_RECONNECT,(i,o)=>{if(JT(this,kE.IS_P2P_DISCONNECTED)&&i==="retry")return Gi.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),this.reconnectToken=void 0,this.emit(kE.NEED_RENEW_SESSION),this.emit(kE.DISCONNECT_P2P),o("tryNext");i!=="retry"&&(Gi.debug("".concat(this.clientId," websockt will_connect event, renewSession reconnectMode is ").concat(i)),this.reconnectToken=void 0,this.emit(kE.NEED_RENEW_SESSION),this.emit(kE.DISCONNECT_P2P)),o(i)}),this.websocket.on(W_.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(i=>{Gi.warning("[".concat(this.clientId,"] rejoin failed ").concat(i)),this.reconnect("tryNext",NT.SERVER_ERROR)}):this.join().catch(i=>{if(this.emit(kE.REPORT_JOIN_GATEWAY,i.message||i.code,this.url||""),i instanceof hE&&i.code===_p.UNEXPECTED_RESPONSE&&i.data.code===qE.ERR_NO_AUTHORIZED)return Gi.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",NT.SERVER_ERROR);Gi.error("[".concat(this.clientId,"] join gateway request failed"),i.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",NT.SERVER_ERROR):(this.initError=i,this.close())})}),this.websocket.on(W_.REQUEST_NEW_URLS,(i,o)=>{U_(this,kE.REQUEST_RECOVER,this.multiIpOption).then(i).catch(o)}),this.websocket.on(W_.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(JE.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(W_.TO_CONNECT_DATACHANNEL,async(i,o,p)=>U_(this,kE.DATACHANNEL_PRECONNECT,i).then(o).catch(p)),this.websocket.on(W_.FAILBACK,()=>{this.openConnectionTime!==void 0&&this.emit(kE.DATACHANNEL_FAILBACK)})}}class iP extends D_{constructor(i){super(),_e(this,"_signal",void 0),_e(this,"_sequence",0),_e(this,"_userMap",new Map),_e(this,"_encoder",new TextEncoder),this._signal=i}async send(i,o,p,g,b){var A,j,H;typeof o!="string"&&(o=JSON.stringify(o)),g=(A=g)!==null&&A!==void 0?A:T_(6,""),b=(j=b)!==null&&j!==void 0?j:this._sequence++;const z={_id:g,_type:i,_seq:(H=b)!==null&&H!==void 0?H:this._sequence++,_message:o};if(nE("SHOW_P2P_LOG")&&Gi.debug("send message",z),this.sendStreamMessage(JSON.stringify(z)),p)return;const $=new pE((_r,Fi)=>{const _l=window.setTimeout(()=>{this.off("res-@".concat(g),_u),Gi.warning("[external-signal] request timeout, type: ".concat(i)),this._userMap.size===0?Fi(new yE(_p.INVALID_REMOTE_USER)):Fi(new yE(_p.TIMEOUT))},nE("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),_u=(_h,_g)=>{_l&&window.clearTimeout(_l),_h==="success"?_r({isSuccess:!0,message:_g}):Fi(new yE(_p.UNEXPECTED_ERROR,_g))};this.once("res-@".concat(g),_u)});let Vt;try{Vt=await $}catch(_r){if(_r.code===_p.TIMEOUT)return await this.send(i,o,!1,g,b);throw _r}return Vt.isSuccess?Vt.message:void 0}sendStreamMessage(i){this._splitMessage(i).forEach(o=>{this._signal.request(FE.DATA_STREAM,{payload:hN(this._encoder.encode(o))})})}onMessage(i){const{_uid:o}=i;let p;const g=this._userMap.get(o);if(g?p=g.splitMessageMap:(p=new Map,this._userMap.set(o,{isStart:!1,splitMessageMap:p,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map})),"id"in i&&"total"in i){var b;const{id:A,total:j}=i,H=(b=p.get(A))!==null&&b!==void 0?b:[];if(H.push(i),p.has(A)||p.set(A,H),H.length!==j)return;{const z=AO(H).call(H,($,Vt)=>$.index-Vt.index).map($=>$.payload).join("");p.delete(A),(i=JSON.parse(z))._uid=o}}this.handleReceivedMessage(i)}setStart(i){this._userMap.has(i)?this._userMap.get(i).isStart=!0:this._userMap.set(i,{isStart:!0,splitMessageMap:new Map,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map}),this.handleReceivedMessage()}setEnd(i){return this._userMap.delete(i),this._userMap.size===0}ack(i,o,p){this.send(w_.ACK,JSON.stringify({success:!p,message:o}),!0,i)}handleReceivedMessage(i){const o=()=>{this._userMap.forEach(z=>{const{receivedMessagesMap:$,nextExpectedSequenceNumber:Vt}=z;for(;$.has(Vt);){const _r=$.get(Vt);$.delete(Vt),this.receiveMessage(_r),z.nextExpectedSequenceNumber++}})};if(!i)return void o();const{_uid:p,_seq:g}=i,b=this._userMap.get(p),{receivedMessagesMap:A,isStart:j,nextExpectedSequenceNumber:H}=b;g<H?Gi.debug("[external-signal] receive old message, seq: ".concat(g)):(A.set(g,i),j&&g===H&&(this.receiveMessage(i),A.delete(H),b.nextExpectedSequenceNumber++,o()))}receiveMessage(i){const{_id:o,_type:p,_message:g,_uid:b}=i;if(nE("SHOW_P2P_LOG")&&Gi.debug("æ”¶åˆ°æ¶ˆæ¯",i),o)switch(i._type){case w_.PUBLISH:const A=JSON.parse(g);this._signal.emit(p,A,b),this.ack(i._id);break;case w_.CONTROL:case w_.UNPUBLISH:case w_.DO_SUBSCRIBE:case w_.DO_UNSUBSCRIBE:{const j=JSON.parse(g);j.uid=b,U_(this._signal,p,j).then(H=>{this.ack(i._id,H)}).catch(H=>{this.ack(i._id,void 0,!0)});break}case w_.ACK:{const{success:j,message:H}=JSON.parse(g);this.emit("res-@".concat(o),j?"success":"failed",H);break}case w_.CALL:U_(this,p,g).then(j=>{this.ack(o,j)});break;case w_.RESTART_ICE:case w_.EXCHANGE_SDP:case w_.SUBSCRIBE:case w_.UNSUBSCRIBE:U_(this._signal,p,g).then(j=>{this.ack(o,j)}).catch(j=>{this.ack(i._id,void 0,!0)});break;case w_.CANDIDATE:this._signal.emit(p,g),this.ack(o);break;case w_.JOIN:this.emit(p,JSON.parse(g));break;default:this.emit(p,g),this.ack(o)}}_splitMessage(i){if(i.length<iP.MAX_MESSAGE_SIZE)return[i];const o=[],p=T_(6,"");let g=0;const b=Math.ceil(i.length/800);for(;i.length>0;){g++;const A=i.slice(0,800);o.push({id:p,index:g,total:b,payload:A}),i=i.slice(800)}return o.map(A=>JSON.stringify(A))}clear(){this._sequence=0,this._userMap.clear()}}_e(iP,"MAX_MESSAGE_SIZE",1024);class c5 extends D_{get connectionState(){return this._connectionState}set connectionState(i){i!==this._connectionState&&(this._connectionState=i,i===t_.CONNECTED?this.emit(kE.WS_CONNECTED):i===t_.RECONNECTING?this.emit(kE.WS_RECONNECTING,this._websocketReconnectReason):i===t_.CLOSED&&this.emit(kE.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(i,o){super(),_e(this,"_disconnectedReason",void 0),_e(this,"_websocketReconnectReason",void 0),_e(this,"_connectionState",t_.CLOSED),_e(this,"reconnectToken",void 0),_e(this,"_userInRoom",!1),_e(this,"_userOnlineTime",void 0),_e(this,"websocket",void 0),_e(this,"openConnectionTime",void 0),_e(this,"clientId",void 0),_e(this,"lastMsgTime",Date.now()),_e(this,"uploadCache",[]),_e(this,"uploadCacheInterval",void 0),_e(this,"rttRolling",new WL(5)),_e(this,"pingpongTimer",void 0),_e(this,"wsInflateDataTimer",void 0),_e(this,"pingpongTimeoutCount",0),_e(this,"joinResponse",void 0),_e(this,"multiIpOption",void 0),_e(this,"initError",void 0),_e(this,"spec",void 0),_e(this,"store",void 0),_e(this,"_external_signal",void 0),_e(this,"onWebsocketMessage",p=>{if(p.data instanceof ArrayBuffer)return void this.emit(kE.ON_BINARY_DATA,p.data);const g=JSON.parse(p.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(g,"_id")){const b="res-@".concat(g._id);this.emit(b,g._result,g._message)}else if(Object.prototype.hasOwnProperty.call(g,"_type")){switch(g._type){case JE.ON_DATA_STREAM:return void this.handleDataStream(g._message);case JE.MUTE_AUDIO:case JE.MUTE_VIDEO:case JE.ON_P2P_LOST:return;case JE.ON_USER_ONLINE:this.emit(g._type,g._message);const{uid:b}=g._message;return this._external_signal.setStart(b),void this._external_signal.send(w_.JOIN,{onlineTime:this._userOnlineTime},!0)}if(this.emit(g._type,g._message),g._type===JE.ON_NOTIFICATION&&this.handleNotification(g._message),g._type===JE.ON_USER_BANNED)switch(g._message.error_code){case 14:this.close(e_.UID_BANNED);break;case 15:this.close(e_.IP_BANNED);break;case 16:this.close(e_.CHANNEL_BANNED)}if(g._type===JE.ON_USER_LICENSE_BANNED)switch(g._message.error_code){case qE.ERR_LICENSE_MISSING:this.close(e_.LICENSE_MISSING);break;case qE.ERR_LICENSE_EXPIRED:this.close(e_.LICENSE_EXPIRED);break;case qE.ERR_LICENSE_MINUTES_EXCEEDED:this.close(e_.LICENSE_MINUTES_EXCEEDED);break;case qE.ERR_LICENSE_PERIOD_INVALID:this.close(e_.LICENSE_PERIOD_INVALID);break;case qE.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(e_.LICENSE_MULTIPLE_SDK_SERVICE);break;case qE.ERR_LICENSE_ILLEGAL:this.close(e_.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=i.clientId,this.spec=i,this.store=o,this.websocket=new HO("gateway-".concat(this.clientId),this.spec.retryConfig,!0,nE("JOIN_GATEWAY_USE_DUAL_DOMAIN"),nE("JOIN_GATEWAY_USE_443PORT_ONLY"),o),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===t_.CONNECTED&&this.reconnect("retry",h0.OFFLINE)}),this._external_signal=new iP(this),this._handleSignalP2PEvents()}async request(i,o,p,g){const b=T_(6,""),A={_id:b,_type:i,_message:o},j=this.websocket.connectionID,H=()=>new pE((_l,_u)=>{if(this.connectionState===t_.CONNECTED)return _l();const _h=()=>{this.off(kE.WS_CLOSED,_g),_l()},_g=()=>{this.off(kE.WS_CONNECTED,_h),_u(new yE(_p.WS_ABORT))};this.once(kE.WS_CONNECTED,_h),this.once(kE.WS_CLOSED,_g),i!==FE.PUBLISH&&i!==FE.SUBSCRIBE&&i!==FE.UNSUBSCRIBE&&i!==FE.UNPUBLISH&&i!==FE.CONTROL&&i!==FE.RESTART_ICE||this.once(kE.DISCONNECT_P2P,()=>{_u(new yE(_p.DISCONNECT_P2P))}),i!==FE.PUBLISH&&i!==FE.RESTART_ICE||this.once(kE.ABORT_P2P_EXECUTION,()=>{_u(new yE(_p.DISCONNECT_P2P))})});if(this.connectionState!==t_.CONNECTING&&this.connectionState!==t_.RECONNECTING||i===FE.JOIN||i===FE.REJOIN||await H(),this.websocket.sendMessage(A,!0),g)return;const z=new pE((_l,_u)=>{let _h=!1;const _g=(oE,SE)=>{_h=!0,_l({isSuccess:oE==="success",message:SE||{}}),this.off(kE.WS_CLOSED,eE),this.off(kE.WS_RECONNECTING,eE),this.emit(kE.REQUEST_SUCCESS,i,o)};this.once("res-@".concat(b),_g);const eE=()=>{_u(new yE(_p.WS_ABORT,"type: ".concat(i))),this.off(kE.WS_CLOSED,eE),this.off(kE.WS_RECONNECTING,eE),this.off("res-@".concat(b),_g)};this.once(kE.WS_CLOSED,eE),this.once(kE.WS_RECONNECTING,eE),w0(nE("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==j||_h||(Gi.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(i)),this.emit(kE.REQUEST_TIMEOUT,i,o))})});let $=null;try{$=await z}catch(_l){if(this.connectionState===t_.CLOSED||i===FE.LEAVE)throw new yE(_p.WS_ABORT);return!this.spec.forceWaitGatewayResponse||p?_l.throw():i===FE.JOIN||i===FE.REJOIN?null:(await H(),await this.request(i,o))}if($.isSuccess)return $.message;const Vt=Number($.message.error_code||$.message.code),_r=iI(Vt),Fi=new yE(_p.UNEXPECTED_RESPONSE,"".concat(_r.desc,": ").concat($.message.error_str),{code:Vt,data:$.message});return _r.action==="success"?$.message:(Gi.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(i,", error_code: ").concat(Vt,", message: ").concat(_r.desc,", action: ").concat(_r.action)),Vt===qE.ERR_TOO_MANY_BROADCASTERS?((i===FE.JOIN||i===FE.REJOIN)&&(this.initError=Fi,this.close()),Fi.throw()):_r.action==="failed"?Fi.throw():_r.action==="quit"?(this.initError=Fi,this.close(),Fi.throw()):(Vt===qE.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=$.message.option,Gi.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",h0.MULTI_IP)):this.reconnect(_r.action,h0.SERVER_ERROR),i===FE.JOIN||i===FE.REJOIN?null:await this.request(i,o)))}waitMessage(i,o){return new pE(p=>{const g=b=>{(!o||o(b))&&(this.off(i,g),p(b))};this.on(i,g)})}upload(i,o){const p={_type:i,_message:o};try{this.websocket.sendMessage(p)}catch{const b=nE("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(p),this.uploadCache.length>b&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==t_.CONNECTED)return;const A=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(A._type,A._message)},nE("UPLOAD_CACHE_INTERVAL")||2e3))}}send(i,o){const p={_type:i,_message:o};this.websocket.sendMessage(p)}async sendExtensionMessage(i,o,p){return await this.waitTillUserOnline(),await this._external_signal.send(i,o,p)}init(i,o){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new pE((p,g)=>{this.once(kE.WS_CONNECTED,()=>p(this.joinResponse)),this.once(kE.WS_CLOSED,()=>g(this.initError||new yE(_p.WS_ABORT))),this.connectionState=t_.CONNECTING,this.websocket.init(i).catch(g),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(i){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=i||e_.LEAVE,this.connectionState=t_.CLOSED,Gi.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),i===e_.FALLBACK&&(this.websocket.removeAllListeners(),this.websocket=new HO("gateway-".concat(this.clientId),this.spec.retryConfig,!0,nE("JOIN_GATEWAY_USE_DUAL_DOMAIN"),nE("JOIN_GATEWAY_USE_443PORT_ONLY"),this.store),this.handleWebsocketEvents())}async join(){if(!this.joinResponse){this.emit(kE.ABORT_P2P_EXECUTION);const i=await U_(this,kE.REQUEST_JOIN_INFO),o=await this.request(FE.JOIN,i);if(!o)return this.emit(kE.REPORT_JOIN_GATEWAY,_p.TIMEOUT,this.url||""),!1;this.joinResponse=o,this.emit(kE.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=t_.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),this._userOnlineTime=new Date().getTime(),this._external_signal.clear(),!0}async rejoin(){if(!this.reconnectToken)throw new yE(_p.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const i=JT(this,kE.REQUEST_REJOIN_INFO);return i.token=this.reconnectToken,!!await this.request(FE.REJOIN,i)&&(this.connectionState=t_.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0)}reconnect(i,o){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(i,o)}handleDataStream(i){try{var o;const p=dN(i.payload),g=new TextDecoder().decode(p),b=JSON.parse(g);"total"in b&&"id"in b||VE(o=Object.values(w_)).call(o,b._type)?(i.seq&&delete i.seq,b._uid=i.uid,this._external_signal.onMessage(b)):this.emit(JE.ON_DATA_STREAM,i)}catch{}}handleNotification(i){Gi.debug("[".concat(this.clientId,"] receive notification: "),i);const o=iI(i.code);if(o.action!=="success"){if(o.action!=="failed")return o.action==="quit"?(o.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(e_.UID_BANNED),void this.close()):void this.reconnect(o.action,h0.SERVER_ERROR);Gi.error("[".concat(this.clientId,"] ignore error: "),o.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const i=nE("PING_PONG_TIME_OUT"),o=Date.now();this.pingpongTimeoutCount>=i&&(Gi.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(o-this.lastMsgTime,"ms")),o-this.lastMsgTime>nE("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",h0.TIMEOUT):this.request(FE.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const p=Date.now()-o;this.rttRolling.add(p),nE("REPORT_STATS")&&this.send(FE.PING_BACK,{pingpongElapse:p})}).catch(p=>{})}handleWsInflateData(){const{wsInflateLength:i,wsDeflateLength:o}=this.websocket.getWsInflateData();i!==0&&o!==0&&this.upload(uS.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:o,ws_inflate_length:i})}handleWebsocketEvents(){this.websocket.on(zE.RECONNECT_WAITTING_FINISH,i=>{this.emit(kE.WS_RECONNECT_WAITTING_FINISH,i)}),this.websocket.on(zE.RECONNECT_CREATE_CONNECTION,i=>{this.emit(kE.WS_RECONNECT_CREATE_CONNECTION,i)}),this.websocket.on(zE.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(zE.CLOSED,()=>{this.connectionState=t_.CLOSED}),this.websocket.on(zE.FAILED,()=>{this._disconnectedReason=e_.NETWORK_ERROR,this.connectionState=t_.CLOSED}),this.websocket.on(zE.RECONNECTING,i=>{this._websocketReconnectReason=i,this.joinResponse=void 0,this.connectionState===t_.CONNECTED?this.connectionState=t_.RECONNECTING:this.connectionState=t_.CONNECTING}),this.websocket.on(zE.WILL_RECONNECT,(i,o,p)=>{if(JT(this,kE.IS_P2P_DISCONNECTED)&&i==="retry")return Gi.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),this.reconnectToken=void 0,this.emit(kE.NEED_RENEW_SESSION),this.emit(kE.DISCONNECT_P2P),p("tryNext");i!=="retry"&&(Gi.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(i)),this.reconnectToken=void 0,this.emit(kE.NEED_RENEW_SESSION),this.emit(kE.DISCONNECT_P2P)),p(i)}),this.websocket.on(zE.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(i=>{Gi.warning("[".concat(this.clientId,"] rejoin failed ").concat(i)),this.reconnect("tryNext",h0.SERVER_ERROR)}):this.join().catch(i=>{if(this.emit(kE.REPORT_JOIN_GATEWAY,i.message||i.code,this.url||""),i instanceof yE&&i.code===_p.UNEXPECTED_RESPONSE&&i.data.code===qE.ERR_NO_AUTHORIZED)return Gi.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",h0.SERVER_ERROR);Gi.error("[".concat(this.clientId,"] join gateway request failed"),i.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",h0.SERVER_ERROR):(this.initError=i,this.close())})}),this.websocket.on(zE.REQUEST_NEW_URLS,(i,o)=>{U_(this,kE.REQUEST_RECOVER,this.multiIpOption).then(i).catch(o)}),this.websocket.on(zE.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(JE.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}_handleSignalP2PEvents(){this._external_signal.on(w_.JOIN,async i=>{if(this._userOnlineTime&&this._userOnlineTime<i.onlineTime){const o=await U_(this,kE.P2P_START,void 0),p=await this._external_signal.send(w_.CALL,o);this.emit(kE.P2P_CONNECTION,p,!0)}this._userInRoom=!0,this.emit("user-online")}),this.on(JE.ON_USER_OFFLINE,async i=>{this._external_signal.clear(),this._userInRoom=!1}),this._external_signal.on(w_.CALL,async(i,o,p)=>{this._userInRoom=!0,this.emit("user-online");try{o(await U_(this,kE.P2P_START,i))}catch(g){p(g)}})}async waitTillUserOnline(){return new pE(i=>{if(this._userInRoom)i();else{const o=()=>{this.off("user-online",o),i()};this.on("user-online",o)}})}}function u5(l,i){var o=Object.keys(l);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(l);i&&(p=p.filter(function(g){return Object.getOwnPropertyDescriptor(l,g).enumerable})),o.push.apply(o,p)}return o}function dT(l){for(var i=1;i<arguments.length;i++){var o=arguments[i]!=null?arguments[i]:{};i%2?u5(Object(o),!0).forEach(function(p){_e(l,p,o[p])}):Object.getOwnPropertyDescriptors?Object.defineProperties(l,Object.getOwnPropertyDescriptors(o)):u5(Object(o)).forEach(function(p){Object.defineProperty(l,p,Object.getOwnPropertyDescriptor(o,p))})}return l}const u2=new Map;class _et extends D_{get state(){return this._state}set state(i){if(i===this._state)return;const o=this._state;this._state=i,i==="DISCONNECTED"&&this._disconnectedReason?this.emit(j_.CONNECTION_STATE_CHANGE,i,o,this._disconnectedReason):this.emit(j_.CONNECTION_STATE_CHANGE,i,o)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(i){Gi.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(i)),this._joinGatewayStartTime=i}constructor(i,o){super(),_e(this,"store",void 0),_e(this,"joinInfo",void 0),_e(this,"key",void 0),_e(this,"ntpOffset",0),_e(this,"signal",void 0),_e(this,"role",void 0),_e(this,"inChannelInfo",{joinAt:null,duration:0}),_e(this,"spec",void 0),_e(this,"_state","DISCONNECTED"),_e(this,"_statsCollector",void 0),_e(this,"_disconnectedReason",void 0),_e(this,"isSignalRecover",!1),_e(this,"hasChangeBGPAddress",!1),_e(this,"trafficStatsInterval",void 0),_e(this,"networkQualityInterval",void 0),_e(this,"_joinGatewayStartTime",0),_e(this,"_signalTimeout",!1),_e(this,"_clientRoleOptions",void 0),_e(this,"_isProactiveJoin",!1),this.store=i,this.spec=o,this.signal=this.store.useP2P?new c5(dT(dT({},o),{},{retryConfig:o.websocketRetryConfig}),i):this.store.useDataChannel?new tR(dT(dT({},o),{},{retryConfig:o.websocketRetryConfig}),i):new w6(dT(dT({},o),{},{retryConfig:o.websocketRetryConfig}),i),this._statsCollector=o.statsCollector,this.role=o.role||"audience",this._clientRoleOptions=o.clientRoleOptions,this.handleSignalEvents()}async join(i,o,p){if(this.signal instanceof tR){let H=!1;i.cloudProxyServer!=="disabled"?(Gi.debug("[".concat(this.store.clientId,"] Dc is not supported, because cloudProxyServer are not supported (").concat(i.cloudProxyServer,")")),H=!0):"".concat(i.apResponse.cid,"_").concat(i.apResponse.cert).length>255||"".concat(i.apResponse.cid,"_").concat(i.apResponse.cert).length<22?(Gi.debug("[".concat(this.store.clientId,"] Dc is not supported, because ticket length is incorrect, it has to be between 22 and 255")),H=!0):i.apResponse.addresses.some(z=>z.fingerprint)||nE("FINGERPRINT")||(Gi.debug("[".concat(this.store.clientId,"] Dc is not supported, because fingerprint does not exist")),H=!0),H&&this.resetSignal()}this.store.joinGatewayStart(),i.cloudProxyServer!=="disabled"&&(this.hasChangeBGPAddress=!0);const g=Date.now();let b=u2.get(i.cname);if(b||(b=new Map,u2.set(i.cname,b)),this._isProactiveJoin=!0,b.has(i.uid)){const H=new hE(_p.UID_CONFLICT);throw jE.joinGateway(i.sid,{lts:g,succ:!1,ec:H.message,addr:null,uid:i.uid,cid:i.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!i.proxyServer,signalChannel:this.signal instanceof tR?"1":"0"}),this._isProactiveJoin=!1,H}b.set(i.uid,!0),this.joinInfo=i,this.key=o;let A=0;this.joinGatewayStartTime=g;const j=i.proxyServer;try{let H;if(Gi.debug("[".concat(this.store.clientId,"] use ").concat(this.signal instanceof tR?"datachannel":"websocket"," join uid ").concat(A)),this.signal instanceof tR)H=await this.signal.init(i.apResponse.addresses,p);else{const z=i.gatewayAddrs.map($=>{let{address:Vt}=$;const[_r,Fi]=Vt.split(":"),_l={host:_r,port:Fi};return i.proxyServer&&(_l.proxy=i.proxyServer),_l});H=await this.signal.init(z,p)}A=H.uid,Gi.debug("[".concat(this.store.clientId,"] ").concat(this.signal instanceof tR?"datachannel":"websocket"," join uid ").concat(A," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(H){throw H&&H.code===_p.INIT_WEBSOCKET_TIMEOUT?(Gi.warning("[".concat(this.store.clientId,"] User join failed"),H.toString()),H):H&&H.code===_p.INIT_DATACHANNEL_TIMEOUT?(Gi.warning("[".concat(this.store.clientId,"] User join datachannel failed"),H.toString()),this.resetSignal(),H):(Gi.error("[".concat(this.store.clientId,"] User join failed"),H.toString()),jE.joinGateway(i.sid,{lts:g,succ:!1,ec:H.message,addr:this.signal.url,uid:i.uid,cid:i.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!j,signalChannel:this.signal instanceof tR?"1":"0"}),this._isProactiveJoin=!1,b.delete(i.uid),this.signal.close(),H)}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),Gi.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval(()=>{this.updateTrafficStats().catch(H=>{Gi.warning("[".concat(this.store.clientId,"] get traffic stats error"),H.toString())})},3e3),this.networkQualityInterval=window.setInterval(()=>{navigator&&navigator.onLine!==void 0&&!navigator.onLine?this.emit(j_.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(j_.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):this.state==="CONNECTED"&&this._statsCollector.trafficStats?this.emit(j_.NETWORK_QUALITY,{uplinkNetworkQuality:s5(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:s5(this._statsCollector.trafficStats.B_dnq)}):this.emit(j_.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),this.store.joinGatewayEnd(),A}async leave(){let i=arguments.length>0&&arguments[0]!==void 0&&arguments[0],o=arguments.length>1?arguments[1]:void 0;if(this.state!=="DISCONNECTED"){o!==e_.FALLBACK&&(this.state="DISCONNECTING");try{i||this.signal.connectionState!==t_.CONNECTED||await function(p,g){return g===1/0?p:pE.race([p,C$(g)])}(this.signal.request(FE.LEAVE,void 0,!0),3e3)}catch(p){Gi.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),p)}this.signal.close(o),o!==e_.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(i,o,p){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new hE(_p.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const g={state:"offer",p2p_id:this.store.p2pId,ortc:o,mode:this.spec.mode,extend:nE("PUB_EXTEND"),twcc:!!nE("PUBLISH_TWCC"),rtx:!!nE("USE_PUB_RTX")};try{return(await this.signal.request(FE.PUBLISH,g,!0))._message}catch(b){if(p&&b.data&&b.data.code===qE.ERR_PUBLISH_REQUEST_INVALID)return Gi.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),b.toString()),await this.tryUnpubBeforeRepub(i,o),this.publish(i,o,!1);throw b}}async publishDataChannel(i,o,p){var g;if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new hE(_p.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const b={stream_id:o.streamId,ordered:o.ordered?1:0,max_retrans_times:(g=o.maxRetransmits)!==null&&g!==void 0?g:10,channel_id:o.channelId,metadata:o.metadata};try{await this.signal.request(FE.PUBLISH_DATASTREAM,b,!0)}catch(A){if(p&&A.data&&A.data.code===qE.ERR_PUBLISH_REQUEST_INVALID)return Gi.warning("[".concat(this.store.clientId,"] receive publish datachannels error code, retry"),A.toString()),await this.tryUnpubDataChannelBeforeRepub(i,o),this.publishDataChannel(i,o,!1);throw A}}async unpublish(i,o){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new hE(_p.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(FE.UNPUBLISH,{stream_id:o,ortc:i},!0)}catch(p){Gi.warning("[".concat(this.store.clientId,"] unpublish warning: "),p)}}async unpublishDataChannel(i){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new hE(_p.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await pE.all(i.map(o=>this.signal.request(FE.UNPUBLISH_DATASTREAM,{channel_id:o},!0)))}catch(o){Gi.warning("unpublish datachannels warning: ",o)}}async subscribe(i,o,p){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new hE(_p.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));const g={stream_id:i,stream_type:o.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!nE("SUBSCRIBE_TWCC"),rtx:!!nE("USE_SUB_RTX"),extend:nE("SUB_EXTEND"),ssrcId:o.ssrcId,svc:Array.isArray(nE("SVC"))&&nE("SVC").length!==0?nE("SVC"):void 0};try{return(await this.signal.request(FE.SUBSCRIBE,g,!0))._message}catch(b){if(p&&b.data&&b.data.code===qE.ERR_SUBSCRIBE_REQUEST_INVALID)return Gi.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),b.toString()),await this.tryUnsubBeforeResub(i,o),await this.subscribe(i,o,!1);throw b}}async subscribeDataChannel(i,o,p){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new hE(_p.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(this.state));const g={uid:i,stream_id:o.id,channel_id:o.datachannelId};try{return void await this.signal.request(FE.SUBSCRIBE_DATASTREAM,g,!0)}catch(b){if(p&&b.data&&b.data.code===qE.ERR_SUBSCRIBE_REQUEST_INVALID)return Gi.warning("[".concat(this.store.clientId,"] receiver subscribe datachannel error code, retry"),b.toString()),await this.tryUnsubDataChannelBeforeResub(i,o),await this.subscribeDataChannel(i,o,!1);throw b}}async subscribeAll(i,o){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new hE(_p.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));const p={p2p_id:this.store.p2pId,users:i,dtx:!1,rtx:!!nE("USE_SUB_RTX")};try{return await this.signal.request(FE.SUBSCRIBE_STREAMS,p,!0)}catch(g){if(o&&g.data&&g.data.code===qE.ERR_SUBSCRIBE_REQUEST_INVALID)return Gi.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),g.toString()),await this.tryMassUnsubBeforeResub(i),await this.subscribeAll(i,!1);throw g}}async setVideoProfile(i){const o=function(p){if(!(p.bitrateMax&&p.bitrateMin&&p.frameRate&&p.height&&p.width))return;let g=p.frameRate,b=p.width,A=p.height,j=!0;return typeof g!="number"&&(g=g.exact||g.ideal||g.max||g.min||0,g||(j=!1)),typeof b!="number"&&(b=b.exact||b.ideal||b.max||b.min||0,b||(j=!1)),typeof A!="number"&&(A=A.exact||A.ideal||A.max||A.min||0,g||(j=!1)),j?{stream_type:0,width:b,height:A,fps:g,start_bps:1e3*p.bitrateMax,min_bps:1e3*p.bitrateMin,target_bps:1e3*p.bitrateMax}:void 0}(i);if(o)return this.signal.request(FE.SET_VIDEO_PROFILE,o);Gi.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(i,o){try{await this.signal.request(FE.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:i,stream_id:o},!0)}catch(p){Gi.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),p)}}async unsubscribeDataChannel(i,o){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new hE(_p.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await pE.all(i.map(p=>this.signal.request(FE.UNSUBSCRIBE_DATASTREAM,{stream_id:p,uid:o},!0)))}catch(p){Gi.warning("unsubscribeDataChannel warning: ",p)}}async massUnsubscribe(i){try{await this.signal.request(FE.UNSUBSCRIBE_STREAMS,i,!0)}catch(o){Gi.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),o)}}async reconnectPC(i){const{iceParameters:o,dtlsParameters:p,rtpCapabilities:g}=i;return{gatewayEstablishParams:await this.signal.request(FE.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:o,dtlsParameters:p,rtpCapabilities:g}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(FE.GATEWAY_INFO)}async renewToken(i){await this.signal.request(FE.RENEW_TOKEN,i),this.key=i.token}async setClientRole(i,o){if(o&&(this._clientRoleOptions=Object.assign({},o)),this.state!=="CONNECTED")return void(this.role=i);let p,g=0;i==="audience"?this._clientRoleOptions&&this._clientRoleOptions.delay?(p=this._clientRoleOptions.delay,g=1):g=this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:g=0,await this.signal.request(FE.SET_CLIENT_ROLE,{role:i,level:g,delay:p,client_ts:Date.now()}),this.role=i}async setRemoteVideoStreamType(i,o){await this.signal.request(FE.SWITCH_VIDEO_STREAM,{stream_id:i,stream_type:o})}async setDefaultRemoteVideoStreamType(i){await this.signal.request(FE.DEFAULT_VIDEO_STREAM,{stream_type:i})}async setStreamFallbackOption(i,o){await this.signal.request(FE.SET_FALLBACK_OPTION,{stream_id:i,fallback_type:o})}async pickSVCLayer(i,o){await this.signal.request(FE.PICK_SVC_LAYER,{stream_id:i,spatial_layer:o.spatialLayer,temporal_layer:o.temporalLayer})}async setRTM2Flag(i){await this.signal.request(FE.SET_RTM2_FLAG,{rtm2_flag:i})}async sendExtensionMessage(i,o,p){if(this.signal instanceof c5)return this.signal.sendExtensionMessage(i,o,p)}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),dT({},this.inChannelInfo)}async getGatewayVersion(){return(await this.signal.request(FE.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){const i=u2.get(this.joinInfo.cname);i&&i.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;const i=function(o){let p;return p=o.startsWith("dc")?o.match(/(dc\:\/\/)?([^:]+):(\d+)/):o.match(/(wss\:\/\/)?([^:]+):(\d+)/),p?{username:wS.username,password:wS.password,turnServerURL:p[2],tcpport:parseInt(p[3])+30,udpport:parseInt(p[3])+30,forceturn:!1}:null}((this.joinInfo.cloudProxyServer==="disabled"?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],i&&this.joinInfo.turnServer.mode!=="off"&&this.joinInfo.cloudProxyServer==="disabled"&&this.joinInfo.turnServer.serversFromGateway.push(dT(dT({},wS),{},{turnServerURL:i.turnServerURL,tcpport:i.tcpport,udpport:i.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if(this.state!=="CONNECTED")return;const i=await this.signal.request(FE.TRAFFIC_STATS,void 0,!0);i.timestamp=Date.now(),i.ntp_offset!=null&&(this.ntpOffset=i.ntp_offset),i.peer_delay.forEach(o=>{const p=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find(g=>g.peer_uid===o.peer_uid);p&&p.B_st!==o.B_st&&sT(()=>{this.emit(j_.STREAM_TYPE_CHANGE,o.peer_uid,o.B_st)})}),this._statsCollector.updateTrafficStats(i)}getJoinMessage(i){if(!this.joinInfo||!this.key)throw new hE(_p.UNEXPECTED_ERROR,"can not generate join message, no join info");const o=Object.assign({},this.joinInfo.apResponse);let p=nE("REPORT_APP_SCENARIO");if(typeof p!="string")try{p=JSON.stringify(p)}catch{p=void 0}p&&p.length>128&&(p=void 0);const g=dT({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:qS,browser:navigator.userAgent,process_id:nE("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:o,extend:nE("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:this.joinInfo.cloudProxyServer==="proxy3"?"1":this.joinInfo.cloudProxyServer==="proxy5"?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:p,attributes:{userAttributes:{enablePublishedUserList:nE("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:nE("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:typeof nE("SUBSCRIBE_AUDIO_FILTER_TOPN")=="number"?nE("SUBSCRIBE_AUDIO_FILTER_TOPN"):void 0,enablePublishAudioFilter:typeof nE("ENABLE_PUBLISH_AUDIO_FILTER")=="boolean"?nE("ENABLE_PUBLISH_AUDIO_FILTER"):void 0,enableUserLicenseCheck:typeof nE("ENABLE_USER_LICENSE_CHECK")=="boolean"?nE("ENABLE_USER_LICENSE_CHECK"):void 0,enableRTX:nE("USE_PUB_RTX")===!0||nE("USE_SUB_RTX")===!0||void 0,disableFEC:nE("DISABLE_FEC"),enableNTPReport:!!nE("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:!!nE("ENABLE_INSTANT_VIDEO")||void 0,enableDataStream2:typeof nE("ENABLE_DATASTREAM_2")=="boolean"?nE("ENABLE_DATASTREAM_2"):void 0,rtm2Flag:typeof nE("RTM2_FLAG")=="number"?nE("RTM2_FLAG"):void 0,enableUserAutoRebalanceCheck:!!nE("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:typeof nE("USE_XR")=="boolean"?nE("USE_XR"):void 0}},join_ts:this.joinGatewayStartTime},i);return this.joinInfo.stringUid&&(g.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(g.aes_mode=this.joinInfo.aesmode,nE("ENCRYPT_AES")?(g.aes_secret=this.joinInfo.aespassword,g.aes_encrypt=!0):g.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(g.aes_salt=this.joinInfo.aessalt)),o.addresses[this.signal.websocket.currentURLIndex]&&(g.ap_response.ticket=o.addresses[this.signal.websocket.currentURLIndex].ticket,delete o.addresses),this.joinInfo.defaultVideoStream!==void 0&&(g.default_video_stream=this.joinInfo.defaultVideoStream),g}getRejoinMessage(){if(!this.joinInfo)throw new hE(_p.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(kE.WS_RECONNECT_WAITTING_FINISH,i=>{var o;VE(o=["tryNext","recover"]).call(o,i)&&this.joinInfo&&jE.adjustSessionStartTime(this.joinInfo.sid)}),this.signal.on(kE.WS_RECONNECT_CREATE_CONNECTION,i=>{this.joinGatewayStartTime=Date.now()}),this.signal.on(kE.WS_RECONNECTING,i=>{this.joinInfo&&jE.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:i||h0.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",jE.sessionInit(this.joinInfo.sid,{lts:new Date().getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on(kE.WS_CLOSED,i=>{let o;switch(i){case e_.LEAVE:o=h0.LEAVE;break;case e_.UID_BANNED:case e_.IP_BANNED:case e_.CHANNEL_BANNED:case e_.SERVER_ERROR:o=h0.SERVER_ERROR;break;case e_.FALLBACK:o=h0.FALLBACK;break;case e_.LICENSE_MISSING:case e_.LICENSE_EXPIRED:case e_.LICENSE_MINUTES_EXCEEDED:case e_.LICENSE_PERIOD_INVALID:case e_.LICENSE_MULTIPLE_SDK_SERVICE:case e_.LICENSE_ILLEGAL:case e_.TOKEN_EXPIRE:o=i;break;default:o=h0.NETWORK_ERROR}Gi.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(o||"undefined -> "+h0.NETWORK_ERROR)),this.joinInfo&&jE.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:i===e_.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:o}),this._disconnectedReason=i,i!==e_.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on(kE.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo&&(this.role==="audience"&&this._clientRoleOptions&&(this._clientRoleOptions.level||this._clientRoleOptions.delay)&&(Gi.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(this._clientRoleOptions.level,", delay: ").concat(this._clientRoleOptions.delay)),this.setClientRole(this.role,this._clientRoleOptions)),jE.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:this.signal instanceof tR?"1":"0"}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&this.joinInfo.setLocalAPVersion===1)){const i=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!i)return void Gi.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(i));y_("EVENT_REPORT_DOMAIN",i[1]),y_("EVENT_REPORT_BACKUP_DOMAIN",i[1]),y_("LOG_UPLOAD_SERVER","".concat(i[1],":6444"))}}),this.signal.on(JE.ON_UPLINK_STATS,i=>{this._statsCollector.updateUplinkStats(i)}),this.signal.on(kE.REQUEST_RECOVER,(i,o,p)=>{if(!this.joinInfo)return p(new hE(_p.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));i&&(this.joinInfo.multiIP=i,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,U_(this,j_.REQUEST_NEW_GATEWAY_LIST).then(o).catch(p)}),this.signal.on(kE.REQUEST_JOIN_INFO,async i=>{var o;if(this.updateTurnConfigFromSignal(),this.store.useP2P)return void i(this.getJoinMessage({ortc:{}}));const{iceParameters:p,dtlsParameters:g,rtpCapabilities:b}=await U_(this,j_.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:(o=this.joinInfo)===null||o===void 0?void 0:o.turnServer});i(this.getJoinMessage({ortc:{iceParameters:p,dtlsParameters:g,rtpCapabilities:b,version:"2"}}))}),this.signal.on(kE.REQUEST_REJOIN_INFO,i=>{i(this.getRejoinMessage())}),this.signal.on(kE.REPORT_JOIN_GATEWAY,(i,o)=>{this.joinInfo&&(jE.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:i,addr:o,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:this.signal instanceof tR?"1":"0"}),this._isProactiveJoin=!1)}),this.signal.on(kE.IS_P2P_DISCONNECTED,i=>{i(JT(this,j_.IS_P2P_DISCONNECTED))}),this.signal.on(kE.DISCONNECT_P2P,()=>{this.emit(j_.DISCONNECT_P2P)}),this.signal.on(kE.NEED_RENEW_SESSION,()=>{this.emit(j_.NEED_RENEW_SESSION)}),this.signal.on(kE.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(kE.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on(kE.JOIN_RESPONSE,i=>{const o=this.getCurrentGatewayAddress();this.emit(j_.JOIN_RESPONSE,i,o)}),this.signal.on(kE.DATACHANNEL_PRECONNECT,async(i,o,p)=>{this.updateTurnConfigFromSignal();const g=this.getCurrentGatewayAddress();return U_(this,j_.DATACHANNEL_PRECONNECT,i,g).then(o).catch(p)}),this.signal.on(kE.DATACHANNEL_CONNECTING,async i=>{const{iceParameters:o,dtlsParameters:p,rtpCapabilities:g}=await U_(this,j_.REQUEST_DC_CONNECTION_PARAMS);i(this.getJoinMessage({ortc:{iceParameters:o,dtlsParameters:p,rtpCapabilities:g,version:"2"}}))}),this.signal.on(kE.DATACHANNEL_FAILBACK,()=>{Gi.warning("[".concat(this.store.clientId,"] User join datachannel failed")),this.reset(),this.resetSignal(),this.emit(j_.DATACHANNEL_FAILBACK)})}async tryUnsubBeforeResub(i,o){try{await this.signal.request(FE.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:i,ortc:[o]},!0)}catch(p){throw Gi.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),p),p}}async tryUnsubDataChannelBeforeResub(i,o){try{await this.signal.request(FE.UNSUBSCRIBE,{stream_id:o.id},!0)}catch(p){throw Gi.warning("unsubscribe datachannel warning",p),p}}async tryUnpubBeforeRepub(i,o){try{await this.signal.request(FE.UNPUBLISH,{stream_id:i,ortc:o},!0)}catch(p){throw Gi.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),p),p}}async tryUnpubDataChannelBeforeRepub(i,o){try{await this.signal.request(FE.UNPUBLISH_DATASTREAM,{channnel_id:o.channelId},!0)}catch(p){throw Gi.warning("unpublish datastream warning: ",p),p}}async tryMassUnsubBeforeResub(i){const o={users:i.map(p=>({stream_id:p.stream_id,stream_type:p.stream_type}))};try{await this.signal.request(FE.UNSUBSCRIBE_STREAMS,o,!0)}catch(p){throw Gi.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),p),p}}async muteLocal(i,o){const p={action:i.find(g=>g.stream_type===v_.Audio)?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:i,stream_id:o};try{await this.signal.request(FE.CONTROL,p,!0,!0)}catch(g){throw Gi.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),g),g}}async unmuteLocal(i,o){const p={action:i.find(g=>g.stream_type===v_.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:i,stream_id:o};try{await this.signal.request(FE.CONTROL,p,!0,!0)}catch(g){throw Gi.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),g),g}}async muteRemote(i,o){const p={action:i===ME.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:this.store.p2pId,stream_id:o};try{await this.signal.request(FE.CONTROL,p,!0,!0)}catch(g){throw Gi.warning("[".concat(this.store.clientId,"] gateway muteRemote warning: "),g),g}}async unmuteRemote(i,o){const p={action:i===ME.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:this.store.p2pId,stream_id:o};try{await this.signal.request(FE.CONTROL,p,!0,!0)}catch(g){throw Gi.warning("[".concat(this.store.clientId,"] gateway unmuteRemote warning: "),g),g}}uploadStats(i,o){this.signal.upload(i,o)}getSignalRTT(){return this.signal.rtt}async restartICE(i){const o={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:i};try{return await this.signal.request(FE.RESTART_ICE,o,!0)}catch(p){throw Gi.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),p),p}}reconnect(){this.state==="CONNECTED"&&this.signal.reconnect(void 0,h0.P2P_FAILED)}getCurrentGatewayAddress(){var i;if(!nE("GATEWAY_WSS_ADDRESS"))return(i=this.joinInfo)!==null&&i!==void 0&&i.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(i){await this.signal.request(FE.SET_PARAMETER,{enablePublishAudioFilter:i})}resetSignal(){this.signal&&(this.signal.removeAllListeners(),this.signal.close(e_.FALLBACK)),this.store.useDataChannel=!1,this.signal=new w6(dT(dT({},this.spec),{},{retryConfig:this.spec.websocketRetryConfig}),this.store),this.handleSignalEvents(),this.emit(j_.RESET_SIGNAL,wN.websocket)}}let sP=0,l2=0;function eR(l,i,o,p){return new pE((g,b)=>{i.timeout=i.timeout||nE("HTTP_CONNECT_TIMEOUT"),i.responseType=i.responseType||"json",i.data&&!o?(i.data=JSON.stringify(i.data),sP+=AT(i.data)):o&&(i.data.size?sP+=i.data.size:i.data instanceof FormData?sP+=nG(i.data):sP+=AT(JSON.stringify(i.data))),i.headers=i.headers||{},i.headers["Content-Type"]=i.headers["Content-Type"]||"application/json",i.method="POST",i.url=l,aS.request(i).then(A=>{typeof A.data=="string"?l2+=AT(A.data):A.data instanceof ArrayBuffer||A.data instanceof Uint8Array?l2+=A.data.byteLength:l2+=AT(JSON.stringify(A.data)),p&&g({data:A.data,headers:A.headers}),g(A.data)}).catch(A=>{aS.isCancel(A)?b(new hE(_p.OPERATION_ABORTED,"cancel token canceled")):A.code==="ECONNABORTED"?b(new hE(_p.NETWORK_TIMEOUT,A.message)):A.response?b(new hE(_p.NETWORK_RESPONSE_ERROR,A.response.status)):b(new hE(_p.NETWORK_ERROR,A.message))})})}/*! formdata-polyfill. MIT License. Jimmy W?rting <https://jimmy.warting.se/opensource> */(function(){var l;function i(RE){var AE=0;return function(){return AE<RE.length?{done:!1,value:RE[AE++]}:{done:!0}}}var o=typeof Object.defineProperties=="function"?Object.defineProperty:function(RE,AE,UE){return RE==Array.prototype||RE==Object.prototype||(RE[AE]=UE.value),RE},p,g=function(RE){RE=[typeof globalThis=="object"&&globalThis,RE,typeof window=="object"&&window,typeof self=="object"&&self,typeof o_=="object"&&o_];for(var AE=0;AE<RE.length;++AE){var UE=RE[AE];if(UE&&UE.Math==Math)return UE}throw Error("Cannot find global object")}(this);function b(RE,AE){if(AE)t:{var UE=g;RE=RE.split(".");for(var YE=0;YE<RE.length-1;YE++){var h_=RE[YE];if(!(h_ in UE))break t;UE=UE[h_]}(AE=AE(YE=UE[RE=RE[RE.length-1]]))!=YE&&AE!=null&&o(UE,RE,{configurable:!0,writable:!0,value:AE})}}function A(RE){return(RE={next:RE})[Symbol.iterator]=function(){return this},RE}function j(RE){var AE=typeof Symbol<"u"&&Symbol.iterator&&RE[Symbol.iterator];return AE?AE.call(RE):{next:i(RE)}}if(b("Symbol",function(RE){function AE(h_,NE){this.A=h_,o(this,"description",{configurable:!0,writable:!0,value:NE})}if(RE)return RE;AE.prototype.toString=function(){return this.A};var UE="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",YE=0;return function h_(NE){if(this instanceof h_)throw new TypeError("Symbol is not a constructor");return new AE(UE+(NE||"")+"_"+YE++,NE)}}),b("Symbol.iterator",function(RE){if(RE)return RE;RE=Symbol("Symbol.iterator");for(var AE="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),UE=0;UE<AE.length;UE++){var YE=g[AE[UE]];typeof YE=="function"&&typeof YE.prototype[RE]!="function"&&o(YE.prototype,RE,{configurable:!0,writable:!0,value:function(){return A(i(this))}})}return RE}),typeof Object.setPrototypeOf=="function")p=Object.setPrototypeOf;else{var H;t:{var z={};try{z.__proto__={a:!0},H=z.a;break t}catch{}H=!1}p=H?function(RE,AE){if(RE.__proto__=AE,RE.__proto__!==AE)throw new TypeError(RE+" is not extensible");return RE}:null}var $=p;function Vt(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function _r(RE){if(RE.m)throw new TypeError("Generator is already running");RE.m=!0}function Fi(RE,AE){return RE.h=3,{value:AE}}function _l(RE){this.g=new Vt,this.G=RE}function _u(RE,AE,UE,YE){try{var h_=AE.call(RE.g.j,UE);if(!(h_ instanceof Object))throw new TypeError("Iterator result "+h_+" is not an object");if(!h_.done)return RE.g.m=!1,h_;var NE=h_.value}catch(ga){return RE.g.j=null,RE.g.s(ga),_h(RE)}return RE.g.j=null,YE.call(RE.g,NE),_h(RE)}function _h(RE){for(;RE.g.h;)try{var AE=RE.G(RE.g);if(AE)return RE.g.m=!1,{value:AE.value,done:!1}}catch(UE){RE.g.v=void 0,RE.g.s(UE)}if(RE.g.m=!1,RE.g.l){if(AE=RE.g.l,RE.g.l=null,AE.F)throw AE.D;return{value:AE.return,done:!0}}return{value:void 0,done:!0}}function _g(RE){this.next=function(AE){return RE.o(AE)},this.throw=function(AE){return RE.s(AE)},this.return=function(AE){return function(UE,YE){_r(UE.g);var h_=UE.g.j;return h_?_u(UE,"return"in h_?h_.return:function(NE){return{value:NE,done:!0}},YE,UE.g.return):(UE.g.return(YE),_h(UE))}(RE,AE)},this[Symbol.iterator]=function(){return this}}function eE(RE,AE){return AE=new _g(new _l(AE)),$&&RE.prototype&&$(AE,RE.prototype),AE}if(Vt.prototype.o=function(RE){this.v=RE},Vt.prototype.s=function(RE){this.l={D:RE,F:!0},this.h=this.C||this.u},Vt.prototype.return=function(RE){this.l={return:RE},this.h=this.u},_l.prototype.o=function(RE){return _r(this.g),this.g.j?_u(this,this.g.j.next,RE,this.g.o):(this.g.o(RE),_h(this))},_l.prototype.s=function(RE){return _r(this.g),this.g.j?_u(this,this.g.j.throw,RE,this.g.o):(this.g.s(RE),_h(this))},b("Array.prototype.entries",function(RE){return RE||function(){return function(AE,UE){AE instanceof String&&(AE+="");var YE=0,h_=!1,NE={next:function(){if(!h_&&YE<AE.length){var ga=YE++;return{value:UE(ga,AE[ga]),done:!1}}return h_=!0,{done:!0,value:void 0}}};return NE[Symbol.iterator]=function(){return NE},NE}(this,function(AE,UE){return[AE,UE]})}}),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var oE=function(RE,AE){for(var UE=0;UE<RE.length;UE++)AE(RE[UE])},SE=function(RE){return RE.replace(/\r?\n|\r/g,`\r
`)},vE=function(RE,AE,UE){return AE instanceof Blob?(UE=UE!==void 0?UE+"":typeof AE.name=="string"?AE.name:"blob",AE.name===UE&&Object.prototype.toString.call(AE)!=="[object Blob]"||(AE=new File([AE],UE)),[String(RE),AE]):[String(RE),String(AE)]},fE=function(RE,AE){if(RE.length<AE)throw new TypeError(AE+" argument required, but only "+RE.length+" present.")},mE=typeof globalThis=="object"?globalThis:typeof window=="object"?window:typeof self=="object"?self:this,EE=mE.FormData,PE=mE.XMLHttpRequest&&mE.XMLHttpRequest.prototype.send,OE=mE.Request&&mE.fetch,$E=mE.navigator&&mE.navigator.sendBeacon,s_=mE.Element&&mE.Element.prototype,B_=mE.Symbol&&Symbol.toStringTag;B_&&(Blob.prototype[B_]||(Blob.prototype[B_]="Blob"),"File"in mE&&!File.prototype[B_]&&(File.prototype[B_]="File"));try{new File([],"")}catch{mE.File=function(AE,UE,YE){return AE=new Blob(AE,YE||{}),Object.defineProperties(AE,{name:{value:UE},lastModified:{value:+(YE&&YE.lastModified!==void 0?new Date(YE.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),B_&&Object.defineProperty(AE,B_,{value:"File"}),AE}}var r0=function(RE){return RE.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},P_=function(RE){this.i=[];var AE=this;RE&&oE(RE.elements,function(UE){if(UE.name&&!UE.disabled&&UE.type!=="submit"&&UE.type!=="button"&&!UE.matches("form fieldset[disabled] *"))if(UE.type==="file"){var YE=UE.files&&UE.files.length?UE.files:[new File([],"",{type:"application/octet-stream"})];oE(YE,function(h_){AE.append(UE.name,h_)})}else UE.type==="select-multiple"||UE.type==="select-one"?oE(UE.options,function(h_){!h_.disabled&&h_.selected&&AE.append(UE.name,h_.value)}):UE.type==="checkbox"||UE.type==="radio"?UE.checked&&AE.append(UE.name,UE.value):(YE=UE.type==="textarea"?SE(UE.value):UE.value,AE.append(UE.name,YE))})};if((l=P_.prototype).append=function(RE,AE,UE){fE(arguments,2),this.i.push(vE(RE,AE,UE))},l.delete=function(RE){fE(arguments,1);var AE=[];RE=String(RE),oE(this.i,function(UE){UE[0]!==RE&&AE.push(UE)}),this.i=AE},l.entries=function RE(){var AE,UE=this;return eE(RE,function(YE){if(YE.h==1&&(AE=0),YE.h!=3)return AE<UE.i.length?YE=Fi(YE,UE.i[AE]):(YE.h=0,YE=void 0),YE;AE++,YE.h=2})},l.forEach=function(RE,AE){fE(arguments,1);for(var UE=j(this),YE=UE.next();!YE.done;YE=UE.next()){var h_=j(YE.value);YE=h_.next().value,h_=h_.next().value,RE.call(AE,h_,YE,this)}},l.get=function(RE){fE(arguments,1);var AE=this.i;RE=String(RE);for(var UE=0;UE<AE.length;UE++)if(AE[UE][0]===RE)return AE[UE][1];return null},l.getAll=function(RE){fE(arguments,1);var AE=[];return RE=String(RE),oE(this.i,function(UE){UE[0]===RE&&AE.push(UE[1])}),AE},l.has=function(RE){fE(arguments,1),RE=String(RE);for(var AE=0;AE<this.i.length;AE++)if(this.i[AE][0]===RE)return!0;return!1},l.keys=function RE(){var AE,UE,YE,h_,NE=this;return eE(RE,function(ga){if(ga.h==1&&(AE=j(NE),UE=AE.next()),ga.h!=3)return UE.done?void(ga.h=0):(YE=UE.value,h_=j(YE),Fi(ga,h_.next().value));UE=AE.next(),ga.h=2})},l.set=function(RE,AE,UE){fE(arguments,2),RE=String(RE);var YE=[],h_=vE(RE,AE,UE),NE=!0;oE(this.i,function(ga){ga[0]===RE?NE&&(NE=!YE.push(h_)):YE.push(ga)}),NE&&YE.push(h_),this.i=YE},l.values=function RE(){var AE,UE,YE,h_,NE=this;return eE(RE,function(ga){if(ga.h==1&&(AE=j(NE),UE=AE.next()),ga.h!=3)return UE.done?void(ga.h=0):(YE=UE.value,(h_=j(YE)).next(),Fi(ga,h_.next().value));UE=AE.next(),ga.h=2})},P_.prototype._asNative=function(){for(var RE=new EE,AE=j(this),UE=AE.next();!UE.done;UE=AE.next()){var YE=j(UE.value);UE=YE.next().value,YE=YE.next().value,RE.append(UE,YE)}return RE},P_.prototype._blob=function(){var RE="----formdata-polyfill-"+Math.random(),AE=[],UE="--"+RE+`\r
Content-Disposition: form-data; name="`;return this.forEach(function(YE,h_){return typeof YE=="string"?AE.push(UE+r0(SE(h_))+`"\r
\r
`+SE(YE)+`\r
`):AE.push(UE+r0(SE(h_))+'"; filename="'+r0(YE.name)+`"\r
Content-Type: `+(YE.type||"application/octet-stream")+`\r
\r
`,YE,`\r
`)}),AE.push("--"+RE+"--"),new Blob(AE,{type:"multipart/form-data; boundary="+RE})},P_.prototype[Symbol.iterator]=function(){return this.entries()},P_.prototype.toString=function(){return"[object FormData]"},s_&&!s_.matches&&(s_.matches=s_.matchesSelector||s_.mozMatchesSelector||s_.msMatchesSelector||s_.oMatchesSelector||s_.webkitMatchesSelector||function(RE){for(var AE=(RE=(this.document||this.ownerDocument).querySelectorAll(RE)).length;0<=--AE&&RE.item(AE)!==this;);return-1<AE}),B_&&(P_.prototype[B_]="FormData"),PE){var yS=mE.XMLHttpRequest.prototype.setRequestHeader;mE.XMLHttpRequest.prototype.setRequestHeader=function(RE,AE){yS.call(this,RE,AE),RE.toLowerCase()==="content-type"&&(this.B=!0)},mE.XMLHttpRequest.prototype.send=function(RE){RE instanceof P_?(RE=RE._blob(),this.B||this.setRequestHeader("Content-Type",RE.type),PE.call(this,RE)):PE.call(this,RE)}}OE&&(mE.fetch=function(RE,AE){return AE&&AE.body&&AE.body instanceof P_&&(AE.body=AE.body._blob()),OE.call(this,RE,AE)}),$E&&(mE.navigator.sendBeacon=function(RE,AE){return AE instanceof P_&&(AE=AE._asNative()),$E.call(this,RE,AE)}),mE.FormData=P_}})();const oP=()=>{const l=nE("AREAS");return l.length===0&&l.push(c_.GLOBAL),ZR(l).call(l,(i,o,p)=>{const g=l5(o);return g?p===0?g:"".concat(i,",").concat(g):i},"")},l5=l=>l===c_.OVERSEA?"".concat(R0.ASIA,",").concat(R0.EUROPE,",").concat(R0.AFRICA,",").concat(R0.NORTH_AMERICA,",").concat(R0.SOUTH_AMERICA,",").concat(R0.OCEANIA):R0[l],yet=l=>{const i={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return l.map(o=>{const p=AN[o],g=Object.keys(p);g&&g.map(b=>{b!=="CODE"&&(i[b]=i[b].concat(p[b]))})}),i},aP={GLOBAL:{ASIA:[c_.CHINA,c_.JAPAN,c_.INDIA,c_.KOREA,c_.HKMC],EUROPE:[],NORTH_AMERICA:[c_.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},cP=Object.keys(aP[c_.GLOBAL]),d2=[c_.CHINA,c_.NORTH_AMERICA,c_.EUROPE,c_.ASIA,c_.JAPAN,c_.INDIA,c_.OCEANIA,c_.SOUTH_AMERICA,c_.AFRICA,c_.KOREA,c_.HKMC,c_.US],bet=function(l,i){let o=[];if(VE(l).call(l,c_.GLOBAL)){const b=[c_.GLOBAL,c_.OVERSEA],A=Object.keys(AN);if(i===c_.GLOBAL)throw new hE(_p.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(i===c_.CHINA)o=[c_.OVERSEA];else if(g=i,VE(cP).call(cP,g)){const j=(p=i,aP[c_.GLOBAL][p]||[]),H=[...b,i,...j];o=A.filter(z=>!VE(H).call(H,z))}else if(function(j){let H=!1;return cP.forEach(z=>{var $;VE($=aP[c_.GLOBAL][z]).call($,j)&&(H=!0)}),H}(i)){const j=function(z){let $;return cP.forEach(Vt=>{var _r;VE(_r=aP[c_.GLOBAL][Vt]).call(_r,z)&&($=Vt)}),$}(i),H=[...b,j,i];o=A.filter(z=>!VE(H).call(H,z))}else o=l;o=function(j){const H=[];return d2.forEach(z=>{VE(j).call(j,z)&&H.push(z)}),H.concat(j.filter(z=>!VE(d2).call(d2,z)))}(o)}else o=l;var p,g;return o};function d5(l){var i,o;if(!l&&VE(i=nE("AREAS")).call(i,c_.EXTENSIONS))return Gi.debug("update area from ap : reset"),void h2(_Z,!0);if(!VE(o=nE("AREAS")).call(o,c_.GLOBAL)||!l)return;let p=AN.EXTENSIONS;p&&(p={CODE:l5(c_.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(l,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(l,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(l,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(l,".agora.io"),"cds-ap-web-2-".concat(l,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(l,".agora.io"),"sua-ap-web-2-".concat(l,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(l,".agora.io"),"uap-ap-web-2-".concat(l,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(l,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(l,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(l,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(l,".agora.io")]},Gi.debug("update area from ap success: ".concat(l,",config is "),p),y_("AREAS",[c_.EXTENSIONS],!0),Object.keys(p).map(g=>{g==="LOG_UPLOAD_SERVER"||g==="EVENT_REPORT_DOMAIN"||g==="EVENT_REPORT_BACKUP_DOMAIN"||g==="PROXY_SERVER_TYPE3"?y_(g,p[g][0]):y_(g,p[g])}))}function h2(l){let i=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const o=jE.reportApiInvoke(null,{name:e0.SET_AREA,options:l,tag:x_.TRACER});try{let p=[];if(typeof l=="string"&&(p=[l]),Array.isArray(l)&&(l.forEach(b=>{if(!VE(g6).call(g6,b))throw new hE(_p.INVALID_PARAMS,"invalid area code")}),p=l),Object.prototype.toString.call(l)==="[object Object]"){const{areaCode:b,excludedArea:A}=l;if(!b)throw new hE(_p.INVALID_PARAMS,"area code is needed");let j=b;typeof b=="string"&&(j=[b]),p=A?bet(j,A):j}if(!i){if(hR.AREAS){const b=new hE(_p.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return o.onError(b),void Gi.warning("setArea is prohibited because of config-distribute")}if(VE(p).call(p,c_.GLOBAL)&&nE("AREAS")===c_.EXTENSIONS){const b=new hE(_p.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return o.onError(b),void Gi.warning("setArea is prohibited because of ap extensions")}}y_("AREAS",p,i);const g=yet(p);Object.keys(g).map(b=>{b==="LOG_UPLOAD_SERVER"||b==="EVENT_REPORT_DOMAIN"||b==="EVENT_REPORT_BACKUP_DOMAIN"||b==="PROXY_SERVER_TYPE3"?y_(b,g[b][0]):y_(b,g[b])}),Gi.debug("set area success:",p.join(","))}catch(p){throw o.onError(p),p}o.onSuccess()}function h5(l,i){var o=Object.keys(l);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(l);i&&(p=p.filter(function(g){return Object.getOwnPropertyDescriptor(l,g).enumerable})),o.push.apply(o,p)}return o}function p2(l){for(var i=1;i<arguments.length;i++){var o=arguments[i]!=null?arguments[i]:{};i%2?h5(Object(o),!0).forEach(function(p){_e(l,p,o[p])}):Object.getOwnPropertyDescriptors?Object.defineProperties(l,Object.getOwnPropertyDescriptors(o)):h5(Object(o)).forEach(function(p){Object.defineProperty(l,p,Object.getOwnPropertyDescriptor(o,p))})}return l}let f2=1;function Tet(l,i,o,p,g){f2+=1;const b={sid:o.sid,command:"convergeAllocateEdge",uid:"666",appId:o.appId,ts:Math.floor(Date.now()/1e3),seq:f2,requestId:f2,version:qS,cname:o.cname},A={service_name:i,json_body:JSON.stringify(b)};let j,H,z=l[0];return vT(async()=>{j=Date.now();const $=await eR(z,{data:A,cancelToken:p,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(H=Date.now()-j,$.code!==0){const Fi=new hE(_p.UNEXPECTED_RESPONSE,"live streaming ap error, code"+$.code,{retry:!0,responseTime:H});throw Gi.error(Fi.toString()),Fi}const Vt=JSON.parse($.json_body);if(Vt.code!==200){const Fi=new hE(_p.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(Vt.code,", reason: ").concat(Vt.reason),{code:Vt.code,responseTime:H});throw Gi.error(Fi.toString()),Fi}if(!Vt.servers||Vt.servers.length===0){const Fi=new hE(_p.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:Vt.code,responseTime:H});throw Gi.error(Fi.toString()),Fi}const _r=function(Fi,_l){return{addressList:Fi.servers.map(_u=>"wss://".concat(_u.address.replace(/\./g,"-"),".").concat(nE("WORKER_DOMAIN"),":").concat(_u.wss,"?serviceName=").concat(encodeURIComponent(_l))),workerToken:Fi.workerToken,vid:Fi.vid}}(Vt,i);return nE("LIVE_STREAMING_ADDRESS")&&(_r.addressList=nE("LIVE_STREAMING_ADDRESS")instanceof Array?nE("LIVE_STREAMING_ADDRESS"):[nE("LIVE_STREAMING_ADDRESS")]),p2(p2({},_r),{},{responseTime:H})},($,Vt)=>(jE.apworkerEvent(o.sid,{success:!0,sc:200,serviceName:i,responseDetail:JSON.stringify($.addressList),firstSuccess:Vt===0,responseTime:H,serverIp:l[Vt%l.length]}),!1),($,Vt)=>(jE.apworkerEvent(o.sid,{success:!1,sc:$.data&&$.data.code||200,serviceName:i,responseTime:H,serverIp:l[Vt%l.length]}),!!($.code!==_p.OPERATION_ABORTED&&$.code!==_p.UNEXPECTED_RESPONSE||$.data&&$.data.retry)&&(z=l[(Vt+1)%l.length],!0)),g)}let m2=1;function p5(l,i,o,p){let{url:g,areaCode:b}=l;const A=Date.now();let j;const[H,z]=E5(i,b,[v0.CHOOSE_SERVER]);let $=X_.networkState;return vT(async()=>{$&&X_.networkState===K0.OFFLINE&&X_.onlineWaiter&&await pE.race([X_.onlineWaiter,w0(p&&p.maxRetryTimeout||$_.maxRetryTimeout)]),$=X_.networkState;const{data:Vt,headers:_r}=await eR(g,{data:H,cancelToken:o,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);j=_r.http3==="1"?1:-1,jE.reportResourceTiming(g,i.sid),m5(Vt,g,i,A,[v0.CHOOSE_SERVER],j);const Fi=a2(Vt,v0.CHOOSE_SERVER);return g5(Fi),r5(Fi,g)},Vt=>(Vt&&jE.joinChooseServer(i.sid,{lts:A,succ:!0,csAddr:g,opid:z,serverList:Vt.gatewayAddrs.map(_r=>_r.address),ec:null,cid:Vt.cid.toString(),uid:Vt.uid.toString(),csIp:Vt.csIp,unilbsServerIds:[v0.CHOOSE_SERVER].toString(),isHttp3:j}),!1),Vt=>Vt.code!==_p.OPERATION_ABORTED&&(Vt.code===_p.CAN_NOT_GET_GATEWAY_SERVER?Vt.data.retry:(jE.joinChooseServer(i.sid,{lts:A,succ:!1,csAddr:g,serverList:null,opid:z,ec:Vt.code,csIp:Vt.data&&Vt.data.csIp,unilbsServerIds:[v0.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:$}),isHttp3:j}),Gi.warning("[".concat(i.clientId,"] Choose server network error, retry"),Vt),!0)),p)}function f5(l,i,o,p){let g,{url:b,areaCode:A,serviceIds:j}=l;const H=Date.now(),[z,$]=E5(i,A,j);let Vt;return vT(async()=>{Vt&&X_.networkState===K0.OFFLINE&&X_.onlineWaiter&&await pE.race([X_.onlineWaiter,w0(p&&p.maxRetryTimeout||$_.maxRetryTimeout)]),Vt=X_.networkState;const{data:_r,headers:Fi}=await eR(b,{data:z,cancelToken:o,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);g=Fi.http3==="1"?1:-1,jE.reportResourceTiming(b,i.sid),m5(_r,b,i,H,j,g);const _l=a2(_r,v0.CHOOSE_SERVER),_u=a2(_r,i.cloudProxyServer==="proxy5"?v0.CLOUD_PROXY_5:i.cloudProxyServer==="proxy3"||i.cloudProxyServer==="proxy4"?v0.CLOUD_PROXY:v0.CLOUD_PROXY_FALLBACK);return g5(_l),{gatewayInfo:r5(_l,b),proxyInfo:_u,url:b}},_r=>(_r.gatewayInfo&&jE.joinChooseServer(i.sid,{lts:H,succ:!0,csAddr:b,serverList:_r.gatewayInfo.gatewayAddrs.map(Fi=>Fi.address),ec:null,opid:$,cid:_r.gatewayInfo.cid.toString(),uid:_r.gatewayInfo.uid.toString(),csIp:_r.gatewayInfo.csIp,unilbsServerIds:j.toString(),isHttp3:g}),_r.proxyInfo&&jE.joinWebProxyAP(i.sid,{lts:H,sucess:1,apServerAddr:b,turnServerAddrList:_r.proxyInfo.addresses.map(Fi=>Fi.ip).join(","),errorCode:null,eventType:i.cloudProxyServer,unilbsServerIds:j.toString()}),!1),_r=>_r.code!==_p.OPERATION_ABORTED&&(_r.code===_p.CAN_NOT_GET_GATEWAY_SERVER?_r.data.retry:(jE.joinWebProxyAP(i.sid,{lts:H,sucess:0,apServerAddr:b,turnServerAddrList:null,errorCode:_r.code,eventType:i.cloudProxyServer,unilbsServerIds:j.toString(),extend:JSON.stringify({networkState:Vt})}),Gi.warning("[".concat(i.clientId,"] multi unilbs network error, retry"),_r),!0)),p)}const m5=(l,i,o,p,g,b)=>{const A=[],j=H=>{H.flag===4096?jE.joinChooseServer(o.sid,{lts:p,succ:!1,csAddr:i,opid:l.opid,serverList:null,ec:H.error.message,csIp:H.error.data&&H.error.data.csIp,unilbsServerIds:g.toString(),isHttp3:b}):H.flag!==1048576&&H.flag!==4194304&&H.flag!==4194310||jE.joinWebProxyAP(o.sid,{lts:p,sucess:0,apServerAddr:i,turnServerAddrList:null,errorCode:H.error.code,eventType:o.cloudProxyServer,unilbsServerIds:g.toString()})};if(l.response_body.forEach(H=>{const z=H.buffer.code;if(H.uri===23&&z===0&&!H.buffer.edges_services)if(H.buffer.flag===4194310)Gi.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),H.buffer.edges_services=[];else{const $={error:new hE(_p.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:l.detail[502]}),flag:H.buffer.flag};A.push($),j($)}if(z!==0){const $=NN(z),Vt={error:new hE(_p.CAN_NOT_GET_GATEWAY_SERVER,$.desc,{desc:$.desc,retry:$.retry,csIp:l.detail[502]}),flag:H.buffer.flag};H.buffer.flag===4194310?Gi.warning(Vt.error.toString()):A.push(Vt),j(Vt)}}),A.length)throw Gi.warning("[".concat(o.clientId,"] multi unilbs ").concat(i," failed, ").concat(A.map(H=>"flag: ".concat(H.flag,", message: ").concat(H.error.message,", retry: ").concat(H.error.data.retry)).join(" | "))),new hE(_p.CAN_NOT_GET_GATEWAY_SERVER,A.map(H=>"flag: ".concat(H.flag,", message: ").concat(H.error.message)).join(" | "),{retry:!!A.find(H=>H.error.data.retry),csIp:l.detail[502],desc:[...new Set(A.map(H=>{var z;return H==null||(z=H.error)===null||z===void 0||(z=z.data)===null||z===void 0?void 0:z.desc}).filter(H=>!!H))]})},g5=l=>{var i,o,p,g;if(l.addresses&&l.addresses.length===0&&l.code===0)throw new hE(_p.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:l.detail&&l.detail[502]});if(nE("AP_AREA")&&((p=l.detail)!==null&&p!==void 0&&p[23]&&typeof((g=l.detail)===null||g===void 0?void 0:g[23])=="string"?d5(l.detail[23].toLowerCase()):d5()),(i=l.detail)!==null&&i!==void 0&&i[19]&&typeof((o=l.detail)===null||o===void 0?void 0:o[19])=="string"){const A=l.detail[19],j=A==null?void 0:A.split(";");for(let H=0;H<j.length;H++){var b;const z=bM(b=j[H]).call(b);l.addresses[H]&&j&&(l.addresses[H].fingerprint=z)}}if(nE("GATEWAY_ADDRESS")&&nE("GATEWAY_ADDRESS").length>0){Gi.debug("assign gateway address to",nE("GATEWAY_ADDRESS"));const A=nE("GATEWAY_ADDRESS").map(j=>{var H,z;const $=(H=(z=l.addresses.find(Vt=>Vt.ip===j.ip&&Vt.port===j.port))===null||z===void 0?void 0:z.fingerprint)!==null&&H!==void 0?H:"";return{ip:j.ip,port:j.port,ticket:l.addresses[0]&&l.addresses[0].ticket,fingerprint:$}});l.addresses=A}},Cet=(l,i)=>{if(l.response_body&&l.response_body.length){const o=l.response_body[0];if(o.buffer.code!==0){const p=NN(o.buffer.code);throw new hE(_p.UPDATE_TICKET_FAILED,"[".concat(o.buffer.code,"]: ").concat(p.desc),{retry:p.retry})}return o.buffer.ticket}throw Gi.debug("update ticket request received ap response without response body:",i),new hE(_p.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},E5=(l,i,o)=>{const p=Math.floor(Math.random()*1e12),g={appid:l.appId,client_ts:Date.now(),opid:p,sid:l.sid,request_bodies:[{uri:22,buffer:{cname:l.cname,detail:p2({6:l.stringUid,11:i,12:nE("USE_NEW_TOKEN")?"1":void 0,22:i},nE("AP_RTM")?{26:"RTM2"}:{}),key:l.token,service_ids:o,uid:l.uid||0}}]};g.request_bodies.forEach(A=>{l.multiIP&&l.multiIP.gateway_ip&&(A.buffer.detail[5]=JSON.stringify({vocs_ip:[l.multiIP.uni_lbs_ip],vos_ip:[l.multiIP.gateway_ip]}))});const b=new FormData;return b.append("request",JSON.stringify(g)),[b,p]},Ret=(l,i)=>{const o=Math.floor(Math.random()*1e12),p={appid:l.appId,client_ts:Date.now(),opid:o,sid:l.sid,request_bodies:[{uri:28,buffer:{cname:l.cname,detail:{1:"",6:l.stringUid,12:"1"},token:l.token,service_ids:i,uid:l.uid||0,edges_services:l.apResponse.addresses.map(b=>({ip:b.ip,port:b.port}))}}]},g=new FormData;return g.append("request",JSON.stringify(p)),[g,o]};let aO=0;function cO(l){return pE.all(l.map(i=>i.then(o=>{throw o},o=>o))).then(i=>{throw i},i=>i)}const h1=async l=>{let{fragementLength:i,referenceList:o,asyncMapHandler:p,allFailedhandler:g,promisesCollector:b}=l,A=0;const j=i;let H,z=0;const $=async()=>{const Vt=(()=>{const _r=A*j,Fi=_r+j;return o.slice(_r,Fi).map(p)})();b&&b.push(...Vt);try{H=await cO(Vt)}catch(_r){if(z+=j,A++,!(z>=o.length))return void await $();g(_r)}Vt.forEach(_r=>_r.cancel())};return await $(),H};async function g2(l,i,o,p){return{gatewayInfo:await async function(b,A,j,H){let z=null;const $=[],Vt=async()=>{const Fi=nE("WEBCS_DOMAIN").slice(0,nE("AJAX_REQUEST_CONCURRENT")).map(_h=>({url:b.proxyServer?"https://".concat(b.proxyServer,"/ap/?url=").concat(_h+"/api/v2/transpond/webrtc?v=2"):"https://".concat(_h,"/api/v2/transpond/webrtc?v=2"),areaCode:oP()})),_l=H.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:Fi.map(_h=>_h.url)}),_u=await h1({fragementLength:nE("FRAGEMENT_LENGTH"),referenceList:Fi,asyncMapHandler:_h=>(Gi.debug("[".concat(b.clientId,"] Connect to choose_server:"),_h.url),p5(_h,b,A,j)),allFailedhandler:_h=>{throw H.recordJoinChannelService({endTs:Date.now(),status:"error",errors:_h},_l),_h[0]},promisesCollector:$});return H.recordJoinChannelService({endTs:Date.now(),status:"success"},_l),_u},_r=async()=>{if(await w0(1e3),z!==null)return z;const Fi=nE("WEBCS_DOMAIN_BACKUP_LIST").map(_h=>({url:b.proxyServer?"https://".concat(b.proxyServer,"/ap/?url=").concat(_h+"/api/v2/transpond/webrtc?v=2"):"https://".concat(_h,"/api/v2/transpond/webrtc?v=2"),areaCode:oP()})),_l=H.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:Fi.map(_h=>_h.url)}),_u=await h1({fragementLength:nE("FRAGEMENT_LENGTH"),referenceList:Fi,asyncMapHandler:_h=>(Gi.debug("[".concat(b.clientId,"] Connect to backup choose_server:"),_h.url),p5(_h,b,A,j)),allFailedhandler:_h=>{throw H.recordJoinChannelService({endTs:Date.now(),status:"error",errors:_h},_l),_h[0]},promisesCollector:$});return H.recordJoinChannelService({endTs:Date.now(),status:"success"},_l),_u};try{return z=await cO([Vt(),_r()]),$.length&&$.forEach(Fi=>Fi.cancel&&typeof Fi.cancel=="function"&&Fi.cancel()),z}catch(Fi){throw Fi[0]}}(l,i,o,p)}}async function v5(l,i,o,p,g){const b=l.cloudProxyServer;if(b==="disabled"){if(!p)return;if(l.useLocalAccessPoint)return await g2(l,i,o,g);if(nE("JOIN_WITH_FALLBACK_MEDIA_PROXY")){const{gatewayInfo:z,proxyInfo:$}=await y5(l,i,o,g);return l.turnServer&&l.turnServer.mode!=="auto"||(l.turnServer={mode:"manual",servers:$.map(Vt=>({turnServerURL:Vt.address,tcpport:Vt.tcpport||wS.tcpport,udpport:Vt.udpport||wS.udpport,username:Vt.username||wS.username,password:Vt.password||wS.password,forceturn:!1,security:!0}))}),{gatewayInfo:z}}return await g2(l,i,o,g)}const{proxyInfo:A,gatewayInfo:j}=await y5(l,i,o,g),H={gatewayInfo:j};return l.turnServer={mode:"manual",servers:A.map(z=>({turnServerURL:z.address,tcpport:b==="proxy3"?void 0:z.tcpport?z.tcpport:wS.tcpport,udpport:b==="proxy4"?void 0:z.udpport?z.udpport:wS.udpport,username:z.username||wS.username,password:z.password||wS.password,forceturn:b!=="proxy4",security:b==="proxy5"}))},Gi.debug("[".concat(l.clientId,"] set proxy server: ").concat(l.proxyServer,", mode: ").concat(b)),H}async function _5(l,i,o,p,g){const b=nE("ACCOUNT_REGISTER").slice(0,nE("AJAX_REQUEST_CONCURRENT"));let A=[];A=i.proxyServer?b.map(H=>"https://".concat(i.proxyServer,"/ap/?url=").concat(H+"/api/v1")):b.map(H=>"https://".concat(H,"/api/v1"));const j=g==null?void 0:g.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:A});try{const H=await async function(z,$,Vt,_r,Fi){const _l=Date.now(),_u={sid:Vt.sid,opid:10,appid:Vt.appId,string_uid:$};let _h=z[0];const _g=await vT(()=>eR(_h+"".concat(_h.indexOf("?")===-1?"?":"&","action=stringuid"),{data:_u,cancelToken:_r,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(eE,oE)=>{if(eE.code===0){if(eE.uid<=0||eE.uid>=Math.pow(2,32))throw Gi.error("Invalid Uint Uid ".concat($," => ").concat(eE.uid),eE),jE.reqUserAccount(_u.sid,{lts:_l,success:!1,serverAddr:_h,stringUid:_u.string_uid,uid:eE.uid,errorCode:_p.INVALID_UINT_UID_FROM_STRING_UID,extend:_u}),new hE(_p.INVALID_UINT_UID_FROM_STRING_UID);return jE.reqUserAccount(_u.sid,{lts:_l,success:!0,serverAddr:_h,stringUid:_u.string_uid,uid:eE.uid,errorCode:null,extend:_u}),!1}const SE=NN(eE.code);return SE.retry&&(_h=z[(oE+1)%z.length]),jE.reqUserAccount(_u.sid,{lts:_l,success:!1,serverAddr:_h,stringUid:_u.string_uid,uid:eE.uid,errorCode:SE.desc,extend:_u}),SE.retry},(eE,oE)=>eE.code!==_p.OPERATION_ABORTED&&(jE.reqUserAccount(_u.sid,{lts:_l,success:!1,serverAddr:_h,stringUid:_u.string_uid,uid:null,errorCode:eE.code,extend:_u}),_h=z[(oE+1)%z.length],!0),Fi);if(_g.code!==0){const eE=NN(_g.code);throw new hE(_p.UNEXPECTED_RESPONSE,eE.desc)}return _g}(A,l,i,o,p);return g==null||g.recordJoinChannelService({status:"success",endTs:Date.now()},j),H.uid}catch(H){throw g==null||g.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[H]},j),H}}async function Iet(l,i,o){const p=nE("CDS_AP").slice(0,nE("AJAX_REQUEST_CONCURRENT")).map(j=>l.proxyServer?"https://".concat(l.proxyServer,"/ap/?url=").concat(j+"/api/v1"):"https://".concat(j,"/api/v1?action=config")).map(j=>function(H,z,$,Vt){const _r=l_(),Fi={flag:64,cipher_method:0,features:{device:_r.name,system:_r.os,system_general:navigator.userAgent,vendor:z.appId,version:qS,cname:z.cname,sid:z.sid,session_id:z.sid,detail:"",proxyServer:z.proxyServer}};return vT(()=>eR(H,{data:Fi,timeout:1e3,cancelToken:$,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,_l=>_l.code!==_p.OPERATION_ABORTED,Vt)}(j,l,i,o));let g=null,b=null,A={};try{g=await cO(p)}catch(j){if(j.code===_p.OPERATION_ABORTED)throw j;b=j}if(p.forEach(j=>j.cancel()),jE.reportApiInvoke(l.sid,{name:e0.REQUEST_CONFIG_DISTRIBUTE,options:{error:b,res:g}}).onSuccess(),g&&g.test_tags)try{A=function(j){if(!j.test_tags)return{};const H=j.test_tags,z=Object.keys(H),$={};return z.forEach(Vt=>{var _r;const Fi=bM(_r=Vt.slice(4)).call(_r),_l=JSON.parse(H[Vt])[1];$[Fi]=_l}),$}(g)}catch{}return A}async function y5(l,i,o,p){const g=nE("PROXY_SERVER_TYPE3"),b=(Fi,_l,_u)=>{let _h=_u||g;return Array.isArray(_h)&&(_h=_l%2==0?g[1]:g[0]),"https://".concat(_h,"/ap/?url=").concat(Fi)};let A=null;const j=[],H=async()=>{const Fi=nE("WEBCS_DOMAIN").slice(0,nE("AJAX_REQUEST_CONCURRENT")).map((_h,_g)=>{let eE;return eE=l.cloudProxyServer==="disabled"&&l.proxyServer?b("".concat(_h,"/api/v2/transpond/webrtc?v=2"),_g,l.proxyServer):l.cloudProxyServer==="disabled"||l.cloudProxyServer==="fallback"?"https://".concat(_h,"/api/v2/transpond/webrtc?v=2"):b("".concat(_h,"/api/v2/transpond/webrtc?v=2"),_g),{url:eE,areaCode:oP(),serviceIds:[v0.CHOOSE_SERVER,l.cloudProxyServer==="proxy5"?v0.CLOUD_PROXY_5:l.cloudProxyServer==="proxy3"||l.cloudProxyServer==="proxy4"?v0.CLOUD_PROXY:v0.CLOUD_PROXY_FALLBACK]}}),_l=p.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:Fi.map(_h=>_h.url)}),_u=await h1({fragementLength:nE("FRAGEMENT_LENGTH"),referenceList:Fi,asyncMapHandler:_h=>(Gi.debug("[".concat(l.clientId,"] Connect to choose_server:"),_h.url),f5(_h,l,i,o)),allFailedhandler:_h=>{throw p.recordJoinChannelService({endTs:Date.now(),status:"error",errors:_h},_l),_h[0]},promisesCollector:j});return p.recordJoinChannelService({endTs:Date.now(),status:"success"},_l),_u},z=async()=>{if(await w0(1e3),A!==null)return A;const Fi=nE("WEBCS_DOMAIN_BACKUP_LIST").map((_h,_g)=>{let eE;return eE=l.cloudProxyServer==="disabled"&&l.proxyServer?b("".concat(_h,"/api/v2/transpond/webrtc?v=2"),_g,l.proxyServer):l.cloudProxyServer==="disabled"||l.cloudProxyServer==="fallback"?"https://".concat(_h,"/api/v2/transpond/webrtc?v=2"):b("".concat(_h,"/api/v2/transpond/webrtc?v=2"),_g),{url:eE,areaCode:oP(),serviceIds:[v0.CHOOSE_SERVER,l.cloudProxyServer==="proxy5"?v0.CLOUD_PROXY_5:l.cloudProxyServer==="proxy3"||l.cloudProxyServer==="proxy4"?v0.CLOUD_PROXY:v0.CLOUD_PROXY_FALLBACK]}}),_l=p.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:Fi.map(_h=>_h.url)}),_u=await h1({fragementLength:nE("FRAGEMENT_LENGTH"),referenceList:Fi,asyncMapHandler:_h=>(Gi.debug("[".concat(l.clientId,"] Connect to backup choose_server:"),_h.url),f5(_h,l,i,o)),allFailedhandler:_h=>{throw p.recordJoinChannelService({endTs:Date.now(),status:"error",errors:_h},_l),_h[0]},promisesCollector:j});return p.recordJoinChannelService({endTs:Date.now(),status:"success"},_l),_u};let $,Vt,_r;try{({gatewayInfo:$,proxyInfo:Vt,url:_r}=await cO([H(),z()]))}catch(Fi){throw Fi[0]}if(j.length&&j.forEach(Fi=>Fi.cancel&&typeof Fi.cancel=="function"&&Fi.cancel()),!$||!Vt)throw new hE(_p.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(l.apUrl=_r,l.cloudProxyServer!=="disabled"&&Array.isArray(g)&&_r){const Fi=/^https?:\/\/(.+?)(\/.*)?$/.exec(_r)[1];VE(g).call(g,Fi)&&(l.proxyServer=Fi,Gi.setProxyServer(Fi),jE.setProxyServer(Fi))}return A={gatewayInfo:$,proxyInfo:await get(Vt,$.uid)},A}async function b5(l,i,o,p){const g=nE("UAP_AP").slice(0,nE("AJAX_REQUEST_CONCURRENT")).map(b=>i.proxyServer?"https://".concat(i.proxyServer,"/ap/?url=").concat(b+"/api/v1?action=uap"):"https://".concat(b,"/api/v1?action=uap"));return await Tet(g,l,i,o,p)}async function wet(l,i,o){const p=nE("UAP_AP").slice(0,nE("AJAX_REQUEST_CONCURRENT")).map(g=>l.proxyServer?"https://".concat(l.proxyServer,"/ap/?url=").concat(g+"/api/v1?action=uap"):"https://".concat(g,"/api/v1?action=uap")).map(g=>function(b,A,j,H){const z={command:"convergeAllocateEdge",sid:A.sid,appId:A.appId,token:A.token,ts:Date.now(),version:qS,cname:A.cname,uid:A.uid.toString(),requestId:m2,seq:m2};m2+=1;const $={service_name:"tele_channel",json_body:JSON.stringify(z)};return vT(async()=>{const Vt=await eR(b,{data:$,cancelToken:j,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(Vt.code!==0){const Fi=new hE(_p.UNEXPECTED_RESPONSE,"cross channel ap error, code"+Vt.code,{retry:!0});throw Gi.error(Fi.toString()),Fi}const _r=JSON.parse(Vt.json_body);if(_r.code!==200){const Fi=new hE(_p.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(_r.code,", reason: ").concat(_r.reason));throw Gi.error(Fi.toString()),Fi}if(!_r.servers||_r.servers.length===0){const Fi=new hE(_p.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw Gi.error(Fi.toString()),Fi}return{vid:_r.vid,workerToken:_r.workerToken,addressList:(nE("CHANNEL_MEDIA_RELAY_SERVERS")||_r.servers).map(Fi=>"wss://".concat(Fi.address.replace(/\./g,"-"),".").concat(nE("WORKER_DOMAIN"),":").concat(Fi.wss))}},void 0,Vt=>!!(Vt.code!==_p.OPERATION_ABORTED&&Vt.code!==_p.UNEXPECTED_RESPONSE||Vt.data&&Vt.data.retry),H)}(g,l,i,o));try{const g=await cO(p);return p.forEach(b=>b.cancel()),g}catch(g){throw g[0]}}async function Aet(l,i,o){let p=null;const g=[],b=async A=>{const j=nE(A?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map(H=>l.proxyServer?"https://".concat(l.proxyServer,"/ap/?url=").concat(H+"/api/v2/transpond/webrtc?v=2"):"https://".concat(H,"/api/v2/transpond/webrtc?v=2"));return A&&(await w0(1e3),p!==null)?p:await h1({fragementLength:nE("FRAGEMENT_LENGTH"),referenceList:j,asyncMapHandler:H=>(Gi.debug("[".concat(l.clientId,"] update ticket, Connect to ").concat(A?"backup":""," choose_server:"),H),function(z,$,Vt,_r){const[Fi]=Ret($,[v0.CHOOSE_SERVER]);let _l=X_.networkState;return vT(async()=>{_l&&X_.networkState===K0.OFFLINE&&X_.onlineWaiter&&await pE.race([X_.onlineWaiter,w0(_r&&_r.maxRetryTimeout||$_.maxRetryTimeout)]),_l=X_.networkState;const _u=await eR(z,{data:Fi,cancelToken:Vt,headers:{"Content-Type":"multipart/form-data;"}},!0);return Cet(_u,z)},()=>!1,_u=>_u.code!==_p.OPERATION_ABORTED&&(_u.code===_p.UPDATE_TICKET_FAILED?_u.data.retry:(Gi.warning("[".concat($.clientId,"] update ticket network error, retry"),_u),!0)),_r)}(H,l,i,o)),allFailedhandler:H=>{throw H[0]},promisesCollector:g})};try{return p=await cO([b(!1),b(!0)]),g.length&&g.forEach(A=>A.cancel&&typeof A.cancel=="function"&&A.cancel()),p}catch(A){throw A[0]}}function S5(l,i){var o=Object.keys(l);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(l);i&&(p=p.filter(function(g){return Object.getOwnPropertyDescriptor(l,g).enumerable})),o.push.apply(o,p)}return o}function T5(l){for(var i=1;i<arguments.length;i++){var o=arguments[i]!=null?arguments[i]:{};i%2?S5(Object(o),!0).forEach(function(p){_e(l,p,o[p])}):Object.getOwnPropertyDescriptors?Object.defineProperties(l,Object.getOwnPropertyDescriptors(o)):S5(Object(o)).forEach(function(p){Object.defineProperty(l,p,Object.getOwnPropertyDescriptor(o,p))})}return l}class Oet extends D_{constructor(){super(),_e(this,"configs",void 0),_e(this,"joinInfo",void 0),_e(this,"cancelToken",void 0),_e(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),_e(this,"interval",void 0),_e(this,"mutex",new E0("config-distribute")),_e(this,"mutableParamsRead",!1)}startGetConfigDistribute(i,o){this.joinInfo=i,this.cancelToken=o,this.interval&&this.stopGetConfigDistribute(),nE("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},nE("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,jE.reportApiInvoke(null,{options:void 0,name:e0.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:x_.TRACER}).onSuccess(JSON.stringify(hR))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void Gi.debug("[config-distribute] get config distribute interrupted have no joininfo");let i;const o=await this.mutex.lock();try{i=await Iet(this.joinInfo,this.cancelToken,this.retryConfig),Gi.debug("[config-distribute] get config distribute",JSON.stringify(i)),i.limit_bitrate&&this.handleBitrateLimit(i.limit_bitrate),this.cacheGlobalParameterConfig(i),this.configs=i}catch(p){const g=new hE(_p.NETWORK_RESPONSE_ERROR,p);Gi.warning("[config-distribute] ".concat(g.toString()))}finally{o()}}getBitrateLimit(){return this.configs?this.configs.limit_bitrate:void 0}handleBitrateLimit(i){var o;(o=i)&&o.uplink&&o.id&&o.uplink.max_bitrate!==void 0&&o.uplink.min_bitrate!==void 0&&(this.configs&&this.configs.limit_bitrate?this.configs&&this.configs.limit_bitrate&&this.configs.limit_bitrate.id!==i.id&&this.emit(WO.UPDATE_BITRATE_LIMIT,i):this.emit(WO.UPDATE_BITRATE_LIMIT,i))}getLowStreamConfigDistribute(){return this.configs&&this.configs.limit_bitrate&&T5({},this.configs.limit_bitrate.low_stream_uplink)}cacheGlobalParameterConfig(i){var o;const p=AO(o=Object.keys(i).filter(b=>/^webrtc_ng_global_parameter/.test(b))).call(o);for(let b=0;b<p.length;b++)for(let A=p.length-1;A>b;A--){const j=p[A];if(typeof i[j].__priority=="number"){const H=i[j].__priority,z=p[A-1];if(typeof i[z].__priority=="number"){if(!(H>i[z].__priority))continue;{const $=j;p[A]=p[A-1],p[A-1]=$}}else{const $=j;p[A]=p[A-1],p[A-1]=$}}}const g={};p.forEach(b=>{const A=i[b],j=A.__expires;Object.keys(A).forEach(H=>{H==="__priority"||H==="__expires"||Object.prototype.hasOwnProperty.call(g,H)||(g[H]=T5({value:A[H]},j&&{expires:j}))})});try{(function(j){try{const H=Date.now();Object.keys(j).forEach(z=>{switch(z){case"ENABLE_EVENT_REPORT":case"UPLOAD_LOG":if(Object.prototype.hasOwnProperty.call($0,z)){const{value:$,expires:Vt}=j[z];if(Vt&&Vt<=H)return;hR[z]=$,$0[z]=$,Gi.debug("Update global parameters from config distribute",z,$)}}})}catch(H){Gi.error("Error update config immediately: ".concat(j),H.message)}})(g);const b=JSON.stringify(g),A=window.btoa(b);window.localStorage.setItem("websdk_ng_global_parameter",A),Gi.debug("Caching global parameters ".concat(b))}catch(b){Gi.error("Error caching global parameters:",b.message)}}}function C5(l,i){var o=Object.keys(l);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(l);i&&(p=p.filter(function(g){return Object.getOwnPropertyDescriptor(l,g).enumerable})),o.push.apply(o,p)}return o}function p1(l){for(var i=1;i<arguments.length;i++){var o=arguments[i]!=null?arguments[i]:{};i%2?C5(Object(o),!0).forEach(function(p){_e(l,p,o[p])}):Object.getOwnPropertyDescriptors?Object.defineProperties(l,Object.getOwnPropertyDescriptors(o)):C5(Object(o)).forEach(function(p){Object.defineProperty(l,p,Object.getOwnPropertyDescriptor(o,p))})}return l}class Net extends D_{constructor(i,o,p,g){super(),_e(this,"spec",void 0),_e(this,"token",void 0),_e(this,"websocket",void 0),_e(this,"pingpongTimer",void 0),_e(this,"reconnectMode","retry"),_e(this,"serviceMode",void 0),_e(this,"reqId",0),_e(this,"commandReqId",0),_e(this,"handleWebSocketOpen",()=>{this.reconnectMode="retry",this.startPingPong()}),_e(this,"handleWebSocketMessage",b=>{if(!b.data)return;const A=JSON.parse(b.data);A.requestId?this.emit("@".concat(A.requestId,"-").concat(A.sid),A):this.serviceMode===o0.INJECT?this.emit(oT.INJECT_STREAM_STATUS,A):(jE.workerEvent(this.spec.sid,{actionType:"status",serverCode:A.code,workerType:this.serviceMode===o0.TRANSCODE?1:2}),this.emit(oT.PUBLISH_STREAM_STATUS,A))}),this.spec=o,this.token=i,this.serviceMode=g,this.websocket=new zO("live-streaming",p),this.websocket.on(zE.CONNECTED,this.handleWebSocketOpen),this.websocket.on(zE.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(zE.REQUEST_NEW_URLS,(b,A)=>{U_(this,oT.REQUEST_NEW_ADDRESS).then(b).catch(A)}),this.websocket.on(zE.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(i){return this.websocket.init(i)}async request(i,o,p,g){this.reqId+=1,i==="request"&&(this.commandReqId+=1);const b=this.commandReqId,A=this.reqId;if(!A||!this.websocket)throw new hE(_p.UNEXPECTED_ERROR);const j=p1({command:i,sdkVersion:qS==="4.19.3"?"0.0.1":qS,seq:A,requestId:A,allocate:p,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},o);if(this.websocket.state==="closed")throw new hE(_p.WS_DISCONNECT);const H=()=>new pE((_r,Fi)=>{this.websocket.once(zE.CLOSED,()=>Fi(new hE(_p.WS_ABORT))),this.websocket.once(zE.CONNECTED,_r)});this.websocket.state!=="connected"&&await H(),j.clientRequest&&(j.clientRequest.workerToken=this.token);const z=new pE((_r,Fi)=>{const _l=()=>{Fi(new hE(_p.WS_ABORT))};this.websocket.once(zE.RECONNECTING,_l),this.websocket.once(zE.CLOSED,_l),this.once("@".concat(A,"-").concat(this.spec.sid),_u=>{_r(_u)})});g&&jE.workerEvent(this.spec.sid,p1(p1({},g),{},{requestId:b,actionType:"request",payload:JSON.stringify(o.clientRequest),serverCode:0,code:0}));const $=Date.now();this.websocket.sendMessage(j);let Vt=null;try{Vt=await z}catch(_r){if(this.websocket.state==="closed")throw _r;return await H(),await this.request(i,o,p)}return g&&jE.workerEvent(this.spec.sid,p1(p1({},g),{},{requestId:b,actionType:"response",payload:JSON.stringify(Vt.serverResponse),serverCode:Vt.code,success:Vt.code===200,responseTime:Date.now()-$})),Vt.code!==200&&this.handleResponseError(Vt),Vt}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){const i=qS==="4.19.3"?"0.0.1":qS;this.reqId+=1,this.websocket.state==="connected"?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:i,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(i){switch(i.code){case J_.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void Gi.warning("live stream response already exists stream");case J_.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case J_.LIVE_STREAM_RESPONSE_BAD_STREAM:case J_.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new hE(_p.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:i.code}).throw();case J_.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if(i.serverResponse.command==="UnpublishStream"||i.serverResponse.command==="UninjectStream")return;throw new hE(_p.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case J_.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new hE(_p.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:i.code}).throw();case J_.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const o=new hE(_p.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(oT.WARNING,o,i.serverResponse.url)}case J_.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{const o=new hE(_p.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(oT.WARNING,o,i.serverResponse.url)}case J_.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new hE(_p.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case J_.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new hE(_p.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:i.code}).throw();case J_.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{const o=new hE(_p.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(oT.WARNING,o,i.serverResponse.url)}case J_.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new hE(_p.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:i.code}).throw();case J_.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new hE(_p.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case J_.LIVE_STREAM_RESPONSE_WORKER_LOST:case J_.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(i.serverResponse.command==="UnpublishStream"||i.serverResponse.command==="UninjectStream")return;throw new hE(_p.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case J_.ERROR_FAIL_SEND_MESSAGE:if(i.serverResponse.command==="UnpublishStream"||i.serverResponse.command==="UninjectStream")return;if(i.serverResponse.command==="UpdateTranscoding"||i.serverResponse.command==="ControlStream")return new hE(_p.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:i.code}).throw();throw new hE(_p.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case J_.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case J_.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case J_.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case J_.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new hE(_p.LIVE_STREAMING_CDN_ERROR,"",{code:i.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{this.websocket.state==="connected"&&this.request("ping",{}).catch(pN)},6e3)}}function R5(l,i){var o=Object.keys(l);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(l);i&&(p=p.filter(function(g){return Object.getOwnPropertyDescriptor(l,g).enumerable})),o.push.apply(o,p)}return o}function nS(l){for(var i=1;i<arguments.length;i++){var o=arguments[i]!=null?arguments[i]:{};i%2?R5(Object(o),!0).forEach(function(p){_e(l,p,o[p])}):Object.getOwnPropertyDescriptors?Object.defineProperties(l,Object.getOwnPropertyDescriptors(o)):R5(Object(o)).forEach(function(p){Object.defineProperty(l,p,Object.getOwnPropertyDescriptor(o,p))})}return l}class Pet extends D_{constructor(i){let o=arguments.length>1&&arguments[1]!==void 0?arguments[1]:$_,p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:$_;super(),_e(this,"onLiveStreamWarning",void 0),_e(this,"onLiveStreamError",void 0),_e(this,"onInjectStatusChange",void 0),_e(this,"spec",void 0),_e(this,"retryTimeout",1e4),_e(this,"connection",void 0),_e(this,"httpRetryConfig",void 0),_e(this,"wsRetryConfig",void 0),_e(this,"streamingTasks",new Map),_e(this,"isStartingStreamingTask",!1),_e(this,"taskMutex",new E0("live-streaming")),_e(this,"cancelToken",aS.CancelToken.source()),_e(this,"transcodingConfig",void 0),_e(this,"injectConfig",nS({},AZ)),_e(this,"injectLoopTimes",0),_e(this,"uapResponse",void 0),_e(this,"lastTaskId",1),_e(this,"statusError",new Map),this.spec=i,this.httpRetryConfig=p,this.wsRetryConfig=o}async setTranscodingConfig(i){const o=nS(nS({},wZ),i);o.videoCodecProfile!==66&&o.videoCodecProfile!==77&&o.videoCodecProfile!==100&&(Gi.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(o.videoCodecProfile," -> 100")),o.videoCodecProfile=100),o.transcodingUsers||(o.transcodingUsers=o.userConfigs),o.transcodingUsers&&(o.transcodingUsers=o.transcodingUsers.map(A=>nS(nS(nS({},IZ),A),{},{zOrder:A.zOrder?A.zOrder+1:1}))),function(A){M_(A.width)||b_(A.width,"config.width",0,1e4),M_(A.height)||b_(A.height,"config.height",0,1e4),M_(A.videoBitrate)||b_(A.videoBitrate,"config.videoBitrate",1,1e6),M_(A.videoFrameRate)||b_(A.videoFrameRate,"config.videoFrameRate"),M_(A.lowLatency)||XR(A.lowLatency,"config.lowLatency"),M_(A.audioSampleRate)||d0(A.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),M_(A.audioBitrate)||b_(A.audioBitrate,"config.audioBitrate",1,128),M_(A.audioChannels)||d0(A.audioChannels,"config.audioChannels",[1,2,3,4,5]),M_(A.videoGop)||b_(A.videoGop,"config.videoGop"),M_(A.videoCodecProfile)||d0(A.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),M_(A.userCount)||b_(A.userCount,"config.userCount",0,17),M_(A.backgroundColor)||b_(A.backgroundColor,"config.backgroundColor",0,16777215),M_(A.userConfigExtraInfo)||O0(A.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),A.transcodingUsers&&!M_(A.transcodingUsers)&&(KT(A.transcodingUsers,"config.transcodingUsers"),A.transcodingUsers.forEach((j,H)=>{fM(j.uid),M_(j.x)||b_(j.x,"transcodingUser[".concat(H,"].x"),0,1e4),M_(j.y)||b_(j.y,"transcodingUser[".concat(H,"].y"),0,1e4),M_(j.width)||b_(j.width,"transcodingUser[".concat(H,"].width"),0,1e4),M_(j.height)||b_(j.height,"transcodingUser[".concat(H,"].height"),0,1e4),M_(j.zOrder)||b_(j.zOrder-1,"transcodingUser[".concat(H,"].zOrder"),0,100),M_(j.alpha)||b_(j.alpha,"transcodingUser[".concat(H,"].alpha"),0,1,!1)})),M_(A.watermark)||gM(A.watermark,"watermark"),M_(A.backgroundImage)||gM(A.backgroundImage,"backgroundImage"),A.images&&!M_(A.images)&&(KT(A.images,"config.images"),A.images.forEach((j,H)=>{gM(j,"images[".concat(H,"]"))}))}(o);const p=[];o.images&&p.push(...o.images.map(A=>nS(nS(nS({},mM),A),{},{zOrder:255}))),o.backgroundImage&&(p.push(nS(nS(nS({},mM),o.backgroundImage),{},{zOrder:0})),delete o.backgroundImage),o.watermark&&(p.push(nS(nS(nS({},mM),o.watermark),{},{zOrder:255})),delete o.watermark),o.images=p,o.transcodingUsers&&(o.userConfigs=o.transcodingUsers.map(A=>nS({},A)),o.userCount=o.transcodingUsers.length,delete o.transcodingUsers);const g=(o.userConfigs||[]).map(A=>typeof A.uid=="number"?pE.resolve(A.uid):_5(A.uid,this.spec,this.cancelToken.token,this.httpRetryConfig));if((await pE.all(g)).forEach((A,j)=>{o.userConfigs&&o.userConfigs[j]&&(o.userConfigs[j].uid=A)}),this.transcodingConfig=o,this.connection)try{var b;const A=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(OT(b=this.streamingTasks).call(b)).map(j=>j.taskId).join("#")});Gi.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(A.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(A){if(!A.data||!A.data.retry)throw A;A.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach(j=>{Gi.warning("[".concat(this.spec.clientId,"] live streaming receive error"),A.toString(),"try to republish",j.url),this.startLiveStreamingTask(j.url,j.mode,A).then(()=>{Gi.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(j.url," success"))}).catch(H=>{Gi.error("[".concat(this.spec.clientId,"] live streaming republish failed"),j.url,H.toString()),this.onLiveStreamError&&this.onLiveStreamError(j.url,H)})})}}setInjectStreamConfig(i,o){this.injectConfig=Object.assign({},this.injectConfig,i),this.injectLoopTimes=o}async startLiveStreamingTask(i,o,p){var g;if(Array.from(OT(g=this.streamingTasks).call(g)).find(H=>H.mode===o0.INJECT)&&o===o0.INJECT)return new hE(_p.LIVE_STREAMING_TASK_CONFLICT,"inject stream over limit").throw();if(!this.transcodingConfig&&o===o0.TRANSCODE)throw new hE(_p.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");let b={command:"PublishStream",ts:Date.now(),url:i,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};Gi.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(i,", mode: ").concat(o));const A=await this.taskMutex.lock();if(!this.connection&&p)return void A();if(this.streamingTasks.get(i)&&!p)return A(),new hE(_p.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(o))}catch(H){throw A(),H}switch(o){case o0.TRANSCODE:b.transcodingConfig=nS({},this.transcodingConfig);break;case o0.RAW:break;case o0.INJECT:b={cname:this.spec.cname,command:"InjectStream",sid:this.spec.sid,transcodingConfig:this.injectConfig,ts:Date.now(),url:i,loopTimes:this.injectLoopTimes}}this.uapResponse&&this.uapResponse.vid&&(b.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;const j=this.lastTaskId++;try{const H=new pE(($,Vt)=>{w0(this.retryTimeout).then(()=>{if(p)return Vt(p);const _r=this.statusError.get(i);return _r?(this.statusError.delete(i),Vt(_r)):void 0})}),z=await pE.race([this.connection.request("request",{clientRequest:b},!0,{url:i,command:"PublishStream",workerType:o===o0.TRANSCODE?1:2,requestByUser:!p,tid:j.toString()}),H]);this.isStartingStreamingTask=!1,Gi.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(z.code)),this.streamingTasks.set(i,{clientRequest:b,mode:o,url:i,taskId:j}),A()}catch(H){if(A(),this.isStartingStreamingTask=!1,!H.data||!H.data.retry||p)throw H;return H.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(i,o,H)):await this.startLiveStreamingTask(i,o,H)}}stopLiveStreamingTask(i){return new pE((o,p)=>{const g=this.streamingTasks.get(i);if(!g||!this.connection)return new hE(_p.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();const b=g.mode;g.abortTask=()=>{Gi.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(i),o()},this.connection.request("request",{clientRequest:{command:b===o0.INJECT?"UninjectStream":"UnpublishStream",url:g.url}},!1,{url:i,command:"UnPublishStream",workerType:b===o0.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(A=>{Gi.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(A.code)),this.streamingTasks.delete(i),this.streamingTasks.size===0&&b!==o0.INJECT&&(this.connection&&this.connection.close(),this.connection=void 0),o(),b===o0.INJECT&&this.onInjectStatusChange&&this.onInjectStatusChange(fR.INJECT_STREAM_STATUS_STOP_SUCCESS,this.spec.uid,i)}).catch(p)})}async controlInjectStream(i,o,p,g){const b=this.streamingTasks.get(i);if(!b||!this.connection||b.mode!==o0.INJECT)throw new hE(_p.INVALID_OPERATION,"can not find inject stream task to control");return(await this.connection.request("request",{clientRequest:{command:"ControlStream",url:i,control:o,audioVolume:p,position:g}})).serverResponse}resetAllTask(){var i;const o=Array.from(OT(i=this.streamingTasks).call(i));this.terminate();for(const p of o)this.startLiveStreamingTask(p.url,p.mode).catch(g=>{this.onLiveStreamError&&this.onLiveStreamError(p.url,g)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=aS.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(i){if(this.connection)throw new hE(_p.UNEXPECTED_ERROR,"live streaming connection has already connected");const o=await U_(this,JI.REQUEST_WORKER_MANAGER_LIST,i);return this.uapResponse=o,this.connection=new Net(o.workerToken,this.spec,this.wsRetryConfig,i),this.connection.on(oT.WARNING,(p,g)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(g,p)),this.connection.on(oT.PUBLISH_STREAM_STATUS,p=>this.handlePublishStreamServer(p)),this.connection.on(oT.INJECT_STREAM_STATUS,p=>this.handleInjectStreamServerStatus(p)),this.connection.on(oT.REQUEST_NEW_ADDRESS,(p,g)=>{if(!this.connection)return g(new hE(_p.UNEXPECTED_ERROR,"can not get new live streaming address list"));U_(this,JI.REQUEST_WORKER_MANAGER_LIST,i).then(b=>{this.uapResponse=b,p(b.addressList)}).catch(g)}),await this.connection.init(o.addressList),this.connection}handlePublishStreamServer(i){const o=i.serverStatus&&i.serverStatus.url||"empty_url",p=this.streamingTasks.get(o),g=i.reason;switch(i.code){case J_.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case J_.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case J_.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case J_.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{const A=new hE(_p.LIVE_STREAMING_CDN_ERROR,"",{code:i.code});if(p)return Gi.error(A.toString()),this.onLiveStreamError&&this.onLiveStreamError(o,A);if(!this.isStartingStreamingTask)return;this.statusError.set(o,A)}case J_.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const A=new hE(_p.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,g);return this.onLiveStreamWarning&&this.onLiveStreamWarning(o,A)}case J_.LIVE_STREAM_RESPONSE_WORKER_LOST:case J_.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var b;if(!this.connection)return;this.connection.tryNextAddress();const A=Array.from(OT(b=this.streamingTasks).call(b));for(const j of A)j.abortTask?j.abortTask():(Gi.warning("[".concat(this.spec.clientId,"] publish stream status code"),i.code,"try to republish",j.url),this.startLiveStreamingTask(j.url,j.mode,new hE(_p.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:i.code})).then(()=>{Gi.debug("[".concat(this.spec.clientId,"] republish live stream success"),j.url)}).catch(H=>{Gi.error(H.toString()),this.onLiveStreamError&&this.onLiveStreamError(j.url,H)}));return}}}handleInjectStreamServerStatus(i){const o=Number(i.uid),p=i.serverStatus&&i.serverStatus.url;switch(i.code){case 200:return void(this.onInjectStatusChange&&this.onInjectStatusChange(fR.INJECT_STREAM_STATUS_START_SUCCESS,o,p));case 451:return this.onInjectStatusChange&&this.onInjectStatusChange(fR.INJECT_STREAM_STATUS_START_ALREADY_EXISTS,o,p),void this.streamingTasks.delete(p);case 453:return this.onInjectStatusChange&&this.onInjectStatusChange(fR.INJECT_STREAM_STATUS_START_UNAUTHORIZED,o,p),void this.streamingTasks.delete(p);case 470:return this.onInjectStatusChange&&this.onInjectStatusChange(fR.INJECT_STREAM_STATUS_BROKEN,o,p),void this.streamingTasks.delete(p);case 499:return this.onInjectStatusChange&&this.onInjectStatusChange(fR.INJECT_STREAM_STATUS_START_TIMEOUT,o,p),void this.streamingTasks.delete(p);default:return void Gi.debug("inject stream server status",i)}}hasUrl(i){return this.streamingTasks.has(i)}}class uP{constructor(){_e(this,"destChannelMediaInfos",new Map),_e(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(i){m6(i),this.srcChannelMediaInfo=i}addDestChannelInfo(i){m6(i),this.destChannelMediaInfos.set(i.channelName,i)}removeDestChannelInfo(i){pM(i),this.destChannelMediaInfos.delete(i)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function I5(l){if(!(l instanceof uP))return new hE(_p.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();const i=l.getSrcChannelMediaInfo(),o=l.getDestChannelMediaInfo();if(!i)return new hE(_p.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw();if(o.size===0)return new hE(_p.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw()}class ket extends D_{constructor(i,o,p){super(),_e(this,"ws",void 0),_e(this,"requestId",1),_e(this,"heartBeatTimer",void 0),_e(this,"joinInfo",void 0),_e(this,"clientId",void 0),_e(this,"onOpen",()=>{this.emit("open"),this.startHeartBeatCheck()}),_e(this,"onClose",g=>{this.emit("close"),this.dispose()}),_e(this,"onMessage",g=>{const b=JSON.parse(g.data);if(!b||b.command!=="serverResponse"||!b.requestId)return b&&b.command==="serverStatus"&&b.serverStatus&&b.serverStatus.command?(this.emit("status",b.serverStatus),void this.emit(b.serverStatus.command,b.serverStatus)):void 0;this.emit("req_".concat(b.requestId),b)}),this.joinInfo=i,this.clientId=o,this.ws=new zO("cross-channel-".concat(this.clientId),p),this.ws.on(zE.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(zE.CONNECTED,this.onOpen),this.ws.on(zE.ON_MESSAGE,this.onMessage),this.ws.on(zE.CLOSED,this.onClose)}isConnect(){return this.ws.state==="connected"}sendMessage(i){const o=this.requestId++;return i.requestId=o,i.seq=o,this.ws.sendMessage(i),o}waitStatus(i){return new pE((o,p)=>{const g=window.setTimeout(()=>{p(new hE(_p.TIMEOUT,"wait status timeout, status: ".concat(i)))},5e3);this.once(i,b=>{window.clearTimeout(g),b.state&&b.state!==0?p(new hE(_p.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(i))):o(void 0)}),this.once("dispose",()=>{window.clearTimeout(g),p(new hE(_p.WS_ABORT))})})}async request(i){if(this.ws.state==="closed")throw new hE(_p.WS_DISCONNECT);const o=()=>new pE((A,j)=>{this.ws.once(zE.CLOSED,()=>j(new hE(_p.WS_ABORT))),this.ws.once(zE.CONNECTED,A)});this.ws.state!=="connected"&&await o();const p=this.sendMessage(i),g=new pE((A,j)=>{const H=()=>{j(new hE(_p.WS_ABORT))};this.ws.once(zE.RECONNECTING,H),this.ws.once(zE.CLOSED,H),this.once("req_".concat(p),A),w0(3e3).then(()=>{this.removeAllListeners("req_".concat(p)),this.ws.off(zE.RECONNECTING,H),this.ws.off(zE.CLOSED,H),j(new hE(_p.TIMEOUT,"cross channel ws request timeout"))})}),b=await g;if(!b||b.code!==200)throw new hE(_p.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(b)));return b}async connect(i){this.ws.removeAllListeners(zE.REQUEST_NEW_URLS),this.ws.on(zE.REQUEST_NEW_URLS,o=>{o(i)}),await this.ws.init(i)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(i){const o=this.requestId++;return i.requestId=o,this.ws.sendMessage(i),o}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class Det extends D_{set state(i){i!==this._state&&(i!==Z0.RELAY_STATE_FAILURE&&(this.errorCode=mR.RELAY_OK),this.emit("state",i,this.errorCode),this._state=i)}get state(){return this._state}constructor(i,o,p,g,b){super(),_e(this,"joinInfo",void 0),_e(this,"sid",void 0),_e(this,"clientId",void 0),_e(this,"cancelToken",aS.CancelToken.source()),_e(this,"workerToken",void 0),_e(this,"requestId",0),_e(this,"signal",void 0),_e(this,"prevChannelMediaConfig",void 0),_e(this,"httpRetryConfig",void 0),_e(this,"_resolution",void 0),_e(this,"_state",Z0.RELAY_STATE_IDLE),_e(this,"errorCode",mR.RELAY_OK),_e(this,"onStatus",A=>{Gi.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(A))),A&&A.command&&(A.command==="onAudioPacketReceived"&&this.emit("event",_T.PACKET_RECEIVED_AUDIO_FROM_SRC),A.command==="onVideoPacketReceived"&&this.emit("event",_T.PACKET_RECEIVED_VIDEO_FROM_SRC),A.command==="onSrcTokenPrivilegeDidExpire"&&(this.errorCode=mR.SRC_TOKEN_EXPIRED,this.state=Z0.RELAY_STATE_FAILURE),A.command==="onDestTokenPrivilegeDidExpire"&&(this.errorCode=mR.DEST_TOKEN_EXPIRED,this.state=Z0.RELAY_STATE_FAILURE))}),_e(this,"onReconnect",async()=>{Gi.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",_T.NETWORK_DISCONNECTED),this.state=Z0.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch(A=>{this.state!==Z0.RELAY_STATE_IDLE&&(Gi.error("auto restart channel media relay failed",A.toString()),this.errorCode=mR.SERVER_CONNECTION_LOST,this.state=Z0.RELAY_STATE_FAILURE)})}),this.joinInfo=i,this.clientId=o,this.sid=BL(),this.signal=new ket(this.joinInfo,this.clientId,p),this.httpRetryConfig=g,this._resolution=b}async startChannelMediaRelay(i){if(this.state!==Z0.RELAY_STATE_IDLE)throw new hE(_p.INVALID_OPERATION);this.state=Z0.RELAY_STATE_CONNECTING,await this.connect(),Gi.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(i)}catch(o){throw o.data&&o.data.serverResponse&&o.data.serverResponse.command==="SetSourceChannel"?new hE(_p.CROSS_CHANNEL_FAILED_JOIN_SRC):o.data&&o.data.serverResponse&&o.serverResponse.command==="SetDestChannelStatus"?new hE(_p.CROSS_CHANNEL_FAILED_JOIN_DEST):o.data&&o.data.serverResponse&&o.serverResponse.command==="StartPacketTransfer"?new hE(_p.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):o}this.prevChannelMediaConfig=i}async updateChannelMediaRelay(i){if(this.state!==Z0.RELAY_STATE_RUNNING)throw new hE(_p.INVALID_OPERATION);await this.sendUpdateMessage(i),this.prevChannelMediaConfig=i}async setVideoProfile(i){if(this._resolution=i,this.state!==Z0.RELAY_STATE_RUNNING)throw new hE(_p.INVALID_OPERATION);const o=this.genMessage(j0.SetVideoProfile);await this.signal.request(o),Gi.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),Gi.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=Z0.RELAY_STATE_IDLE,this.dispose()}dispose(){Gi.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=aS.CancelToken.source(),this.state=Z0.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){const i=await wet(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=i.workerToken,await this.signal.connect(i.addressList),this.emit("event",_T.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(i){const o=this.genMessage(j0.StopPacketTransfer);await this.signal.request(o),await this.signal.waitStatus("Normal Quit"),Gi.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));const p=this.genMessage(j0.SetSdkProfile,i);await this.signal.request(p),Gi.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));const g=this.genMessage(j0.SetSourceChannel,i);await this.signal.request(g),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",_T.PACKET_JOINED_SRC_CHANNEL),Gi.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));const b=this.genMessage(j0.SetSourceUserId,i);await this.signal.request(b),Gi.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));const A=this.genMessage(j0.SetDestChannel,i);await this.signal.request(A),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",_T.PACKET_JOINED_DEST_CHANNEL),Gi.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));const j=this.genMessage(j0.StartPacketTransfer,i);await this.signal.request(j),this.emit("event",_T.PACKET_SENT_TO_DEST_CHANNEL),this.state=Z0.RELAY_STATE_RUNNING,Gi.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)}async sendUpdateMessage(i){const o=this.genMessage(j0.UpdateDestChannel,i);await this.signal.request(o),this.emit("event",_T.PACKET_UPDATE_DEST_CHANNEL),Gi.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){const i=this.genMessage(j0.StopPacketTransfer);await this.signal.request(i),Gi.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(i,o){const p=[],g=[],b=[];this.requestId+=1;const A={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:qS,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};A.sdkVersion==="4.19.3"&&(A.sdkVersion="0.0.1");let j=null,H=null;switch(i){case j0.SetSdkProfile:return A.clientRequest={command:"SetSdkProfile",type:"multi_channel"},A;case j0.SetSourceChannel:if(H=o&&o.getSrcChannelMediaInfo(),!H)throw new hE(_p.UNEXPECTED_ERROR,"can not find source config");return A.clientRequest={command:"SetSourceChannel",uid:"0",channelName:H.channelName,token:H.token||this.joinInfo.appId},A;case j0.SetSourceUserId:if(H=o&&o.getSrcChannelMediaInfo(),!H)throw new hE(_p.UNEXPECTED_ERROR,"can not find source config");return A.clientRequest={command:"SetSourceUserId",uid:H.uid+""},A;case j0.SetDestChannel:if(j=o&&o.getDestChannelMediaInfo(),!j)throw new hE(_p.UNEXPECTED_ERROR,"can not find dest config");return j.forEach(z=>{p.push(z.channelName),g.push(z.uid+""),b.push(z.token||this.joinInfo.appId)}),A.clientRequest={command:"SetDestChannel",channelName:p,uid:g,token:b},A;case j0.StartPacketTransfer:return A.clientRequest={command:"StartPacketTransfer"},A;case j0.Reconnect:return A.clientRequest={command:"Reconnect"},A;case j0.StopPacketTransfer:return A.clientRequest={command:"StopPacketTransfer"},A;case j0.UpdateDestChannel:if(j=o&&o.getDestChannelMediaInfo(),!j)throw new hE(_p.UNEXPECTED_ERROR,"can not find dest config");return j.forEach(z=>{p.push(z.channelName),g.push(z.uid+""),b.push(z.token||this.joinInfo.appId)}),A.clientRequest={command:"UpdateDestChannel",channelName:p,uid:g,token:b},A;case j0.SetVideoProfile:A.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return A}}class D0{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio)return this._audioTrack}get videoTrack(){if(this.hasVideo)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(i,o){_e(this,"uid",void 0),_e(this,"_uintid",void 0),_e(this,"_trust_in_room_",!0),_e(this,"_trust_audio_enabled_state_",!0),_e(this,"_trust_video_enabled_state_",!0),_e(this,"_trust_audio_mute_state_",!0),_e(this,"_trust_video_mute_state_",!0),_e(this,"_audio_muted_",!1),_e(this,"_video_muted_",!1),_e(this,"_audio_enabled_",!0),_e(this,"_video_enabled_",!0),_e(this,"_audio_added_",!1),_e(this,"_video_added_",!1),_e(this,"_trust_video_stream_added_state_",!0),_e(this,"_trust_audio_stream_added_state_",!0),_e(this,"_audioTrack",void 0),_e(this,"_videoTrack",void 0),_e(this,"_dataChannels",[]),_e(this,"_audioSSRC",void 0),_e(this,"_videoSSRC",void 0),_e(this,"_audioOrtc",void 0),_e(this,"_videoOrtc",void 0),_e(this,"_cname",void 0),_e(this,"_rtxSsrcId",void 0),this.uid=i,this._uintid=o}}var Let=UV,xet=RT;Y_({target:"Promise",stat:!0,forced:!0},{withResolvers:function(){var l=xet.f(this);return{promise:l.promise,resolve:l.resolve,reject:l.reject}}});var Met=RT,Uet=xI;Y_({target:"Promise",stat:!0,forced:!0},{try:function(l){var i=Met.f(this),o=Uet(l);return(o.error?i.reject:i.resolve)(o.value),i.promise}});var E2=LE(Let),w5=RI.f("asyncIterator"),Fet=LE(w5);function v2(l,i){this.v=l,this.k=i}function f1(l){var i,o;function p(b,A){try{var j=l[b](A),H=j.value,z=H instanceof v2;E2.resolve(z?H.v:H).then(function($){if(z){var Vt=b==="return"?"return":"next";if(!H.k||$.done)return p(Vt,$);$=l[Vt]($).value}g(j.done?"return":"normal",$)},function($){p("throw",$)})}catch($){g("throw",$)}}function g(b,A){switch(b){case"return":i.resolve({value:A,done:!0});break;case"throw":i.reject(A);break;default:i.resolve({value:A,done:!1})}(i=i.next)?p(i.key,i.arg):o=null}this._invoke=function(b,A){return new E2(function(j,H){var z={key:b,arg:A,resolve:j,reject:H,next:null};o?o=o.next=z:(i=o=z,p(b,A))})},typeof l.return!="function"&&(this.return=void 0)}function JS(l){return function(){return new f1(l.apply(this,arguments))}}function d_(l){return new v2(l,0)}function lP(l){var i={},o=!1;function p(g,b){return o=!0,{done:!1,value:new v2(b=new E2(function(A){A(l[g](b))}),1)}}return i[PI!==void 0&&y3||"@@iterator"]=function(){return this},i.next=function(g){return o?(o=!1,g):p("next",g)},typeof l.throw=="function"&&(i.throw=function(g){if(o)throw o=!1,g;return p("throw",g)}),typeof l.return=="function"&&(i.return=function(g){return o?(o=!1,g):p("return",g)}),i}f1.prototype[typeof PI=="function"&&Fet||"@@asyncIterator"]=function(){return this},f1.prototype.next=function(l){return this._invoke("next",l)},f1.prototype.throw=function(l){return this._invoke("throw",l)},f1.prototype.return=function(l){return this._invoke("return",l)};var A5=LE(w5),O5={exports:{}};(function(l,i){l.exports=(()=>{var o={8:(b,A,j)=>{j.r(A),j.d(A,{Parser:()=>$E,Printer:()=>yS,parse:()=>YE,print:()=>h_});const H=`
`,z="".concat("\r").concat(H),$=" ";let Vt;function _r(NE){return NE>="0"&&NE<="9"}function Fi(NE){return NE>="!"&&NE<="~"}function _l(NE){return Fi(NE)||NE>="Â€"&&NE<="Ã¿"}function _u(NE){return NE==="!"||NE>="#"&&NE<="'"||NE>="*"&&NE<="+"||NE>="-"&&NE<="."||NE>="0"&&NE<="9"||NE>="A"&&NE<="Z"||NE>="^"&&NE<="~"}function _h(NE){return NE>="1"&&NE<="9"}function _g(NE){return NE>="A"&&NE<="Z"||NE>="a"&&NE<="z"}function eE(NE){return NE==="d"||NE==="h"||NE==="m"||NE==="s"}function oE(NE){return NE>""&&NE<"	"||NE>"\v"&&NE<"\f"||NE>""&&NE<"Ã¿"}function SE(NE){return _g(NE)||_r(NE)||NE==="+"||NE==="/"}function vE(NE){return _r(NE)||_g(NE)||NE==="+"||NE==="/"||NE==="-"||NE==="_"}function fE(NE){return _g(NE)||_r(NE)||NE==="+"||NE==="/"}function mE(NE,ga){var Eg=Object.keys(NE);if(Object.getOwnPropertySymbols){var sE=Object.getOwnPropertySymbols(NE);ga&&(sE=sE.filter(function(wE){return Object.getOwnPropertyDescriptor(NE,wE).enumerable})),Eg.push.apply(Eg,sE)}return Eg}function EE(NE){for(var ga=1;ga<arguments.length;ga++){var Eg=arguments[ga]!=null?arguments[ga]:{};ga%2?mE(Object(Eg),!0).forEach(function(sE){PE(NE,sE,Eg[sE])}):Object.getOwnPropertyDescriptors?Object.defineProperties(NE,Object.getOwnPropertyDescriptors(Eg)):mE(Object(Eg)).forEach(function(sE){Object.defineProperty(NE,sE,Object.getOwnPropertyDescriptor(Eg,sE))})}return NE}function PE(NE,ga,Eg){return ga in NE?Object.defineProperty(NE,ga,{value:Eg,enumerable:!0,configurable:!0,writable:!0}):NE[ga]=Eg,NE}(function(NE){NE.VERSION="v",NE.ORIGIN="o",NE.SESSION_NAME="s",NE.INFORMATION="i",NE.URI="u",NE.EMAIL="e",NE.PHONE="p",NE.CONNECTION="c",NE.BANDWIDTH="b",NE.TIME="t",NE.REPEAT="r",NE.ZONE_ADJUSTMENTS="z",NE.KEY="k",NE.ATTRIBUTE="a",NE.MEDIA="m"})(Vt||(Vt={}));class OE{consumeText(ga,Eg){let sE=Eg;for(;sE<ga.length;){const wE=ga[sE];if(wE==="\0"||wE==="\r"||wE===H)break;sE+=1}if(sE-Eg==0)throw new Error("Invalid text, at ".concat(ga));return sE}consumeUnicastAddress(ga,Eg,sE){return this.consumeTill(ga,Eg,$)}consumeOneOrMore(ga,Eg,sE){let wE=Eg;for(;sE(ga[wE]);)wE++;if(wE-Eg==0)throw new Error("Invalid rule at ".concat(Eg,"."));return wE}consumeSpace(ga,Eg){if(ga[Eg]===$)return Eg+1;throw new Error("Invalid space at ".concat(Eg,"."))}consumeIP4Address(ga,Eg){let sE=Eg;for(let wE=0;wE<4;wE++)if(sE=this.consumeDecimalUChar(ga,sE),wE!==3){if(ga[sE]!==".")throw new Error("Invalid IP4 address.");sE++}return sE}consumeDecimalUChar(ga,Eg){let sE=Eg;for(let XE=0;XE<3&&_r(ga[sE]);XE++,sE++);if(sE-Eg==0)throw new Error("Invalid decimal uchar.");const wE=parseInt(ga.slice(Eg,sE));if(wE>=0&&wE<=255)return sE;throw new Error("Invalid decimal uchar")}consumeIP6Address(ga,Eg){let sE=this.consumeHexpart(ga,Eg);return ga[sE]===":"&&(sE+=1,sE=this.consumeIP4Address(ga,sE)),sE}consumeHexpart(ga,Eg){let sE=Eg;if(ga[sE]===":"&&ga[sE+1]===":"){sE+=2;try{sE=this.consumeHexseq(ga,sE)}catch{}return sE}if(sE=this.consumeHexseq(ga,sE),ga[sE]===":"&&ga[sE+1]===":"){sE+=2;try{sE=this.consumeHexseq(ga,sE)}catch{}return sE}return sE}consumeHexseq(ga,Eg){let sE=Eg;for(;sE=this.consumeHex4(ga,sE),ga[sE]===":"&&ga[sE+1]!==":";)sE+=1;return sE}consumeHex4(ga,Eg){let sE=0;for(;sE<4;sE++)if(!((wE=ga[Eg+sE])>="0"&&wE<="9"||wE>="a"&&wE<="f"||wE>="A"&&wE<="F")){if(sE===0)throw new Error("Invalid hex 4");break}var wE;return Eg+sE}consumeFQDN(ga,Eg){let sE=Eg;for(;_r(ga[sE])||_g(ga[sE])||ga[sE]==="-"||ga[sE]===".";)sE+=1;if(sE-Eg<4)throw new Error("Invalid FQDN");return sE}consumeExtnAddr(ga,Eg){return this.consumeOneOrMore(ga,Eg,_l)}consumeMulticastAddress(ga,Eg,sE){switch(sE){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(ga,Eg);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(ga,Eg);default:try{return this.consumeFQDN(ga,Eg)}catch{return this.consumeExtnAddr(ga,Eg)}}}consumeIP6MulticastAddress(ga,Eg){const sE=this.consumeHexpart(ga,Eg);return ga[sE]==="/"?this.consumeInteger(ga,sE+1):sE}consumeIP4MulticastAddress(ga,Eg){let sE=Eg+3;const wE=ga.slice(Eg,sE),XE=parseInt(wE);if(XE<224||XE>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let O_=0;O_<3;O_++){if(ga[sE]!==".")throw new Error("Invalid IP4 multicast address.");sE+=1,sE=this.consumeDecimalUChar(ga,sE)}return ga[sE]==="/"&&(sE+=1),sE=this.consumeTTL(ga,sE),ga[sE]==="/"&&(sE=this.consumeInteger(ga,sE)),sE}consumeInteger(ga,Eg){if(!_h(ga[Eg]))throw new Error("Invalid integer.");for(Eg+=1;_r(ga[Eg]);)Eg+=1;return Eg}consumeTTL(ga,Eg){if(ga[Eg]==="0")return Eg+1;if(!_h(ga[Eg]))throw new Error("Invalid TTL.");Eg+=1;for(let sE=0;sE<2&&_r(ga[Eg]);sE++)Eg+=1;return Eg}consumeToken(ga,Eg){return this.consumeOneOrMore(ga,Eg,_u)}consumeTime(ga,Eg){let sE=Eg;if(ga[sE]==="0")return sE+1;for(_h(ga[sE])&&(sE+=1);_r(ga[sE]);)sE++;if(sE-Eg<10)throw new Error("Invalid time");return sE}consumeAddress(ga,Eg){return this.consumeTill(ga,Eg,$)}consumeTypedTime(ga,Eg){let sE=Eg;return sE=this.consumeOneOrMore(ga,sE,_r),eE(ga[sE])?sE+1:sE}consumeRepeatInterval(ga,Eg){if(!_h(ga[Eg]))throw new Error("Invalid repeat interval");for(Eg+=1;_r(ga[Eg]);)Eg+=1;return eE(ga[Eg])&&(Eg+=1),Eg}consumePort(ga,Eg){return this.consumeOneOrMore(ga,Eg,_r)}consume(ga,Eg,sE){for(let wE=0;wE<sE.length;wE++){if(Eg+wE>=ga.length)throw new Error("consume exceeding value length");if(ga[Eg+wE]!==sE[wE])throw new Error("consume ".concat(sE," failed at ").concat(wE))}return Eg+sE.length}consumeTill(ga,Eg,sE){let wE=Eg;for(;wE<ga.length&&(typeof sE!="string"||ga[wE]!==sE)&&(typeof sE!="function"||!sE(ga[wE]));)wE++;return wE}}class $E extends OE{constructor(){super(),PE(this,"records",[]),PE(this,"currentLine",0)}parse(ga){const Eg=this.probeEOL(ga);this.records=ga.split(Eg).filter(i0=>!!i0.trim()).map(this.parseLine),this.currentLine=0;const sE=this.parseVersion(),wE=this.parseOrigin(),XE=this.parseSessionName(),O_=this.parseInformation(),x0=this.parseUri(),bS=this.parseEmail(),nR=this.parsePhone(),IP=this.parseConnection(),wP=this.parseBandWidth(),tT=this.parseTimeFields(),DR=this.parseKey(),fO=this.parseSessionAttribute(),z_=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:sE,origin:wE,sessionName:XE,information:O_,uri:x0,emails:bS,phones:nR,connection:IP,bandwidths:wP,timeFields:tT,key:DR,attributes:fO,mediaDescriptions:z_}}getCurrentRecord(){const ga=this.records[this.currentLine];if(!ga)throw new Error("Record doesn't exit.");return ga}probeEOL(ga){for(let Eg=0;Eg<ga.length;Eg++)if(ga[Eg]===H)return ga[Eg-1]==="\r"?z:H;throw new Error("Invalid newline character.")}parseLine(ga,Eg){if(ga.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");const sE=ga[0];if(ga[1]!=="=")throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:sE,value:ga.slice(2),line:Eg,cur:0}}parseSessionAttribute(){const ga=new B_;for(;this.currentLine<this.records.length;){const Eg=this.getCurrentRecord();if(Eg.type!==Vt.ATTRIBUTE)break;const sE={attField:this.extractOneOrMore(Eg,wE=>_u(wE)&&wE!==":"),_cur:0};Eg.value[Eg.cur]===":"&&(Eg.cur+=1,sE.attValue=this.extractOneOrMore(Eg,oE)),ga.parse(sE),this.currentLine++}return ga.digest()}parseMediaAttributes(ga){const Eg=new r0(ga);for(;this.currentLine<this.records.length;){const sE=this.getCurrentRecord();if(sE.type!==Vt.ATTRIBUTE)break;const wE={attField:this.extractOneOrMore(sE,XE=>_u(XE)&&XE!==":"),_cur:0};sE.value[sE.cur]===":"&&(sE.cur+=1,wE.attValue=this.extractOneOrMore(sE,oE)),Eg.parse(wE),this.currentLine++}return Eg.digest()}parseKey(){const ga=this.getCurrentRecord();if(ga.type===Vt.KEY){if(ga.value==="prompt"||ga.value==="clear:"||ga.value==="base64:"||ga.value==="uri:")return ga.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){const ga=this.getCurrentRecord();if(ga.type===Vt.ZONE_ADJUSTMENTS){const Eg=[];for(;;)try{const sE=this.extract(ga,this.consumeTime);this.consumeSpaceForRecord(ga);let wE=!1;ga.value[ga.cur]==="-"&&(wE=!0,ga.cur+=1);const XE=this.extract(ga,this.consumeTypedTime);Eg.push({time:sE,typedTime:XE,back:wE})}catch{break}if(Eg.length===0)throw new Error("Invalid zone adjustments");return this.currentLine++,Eg}return[]}parseRepeat(){const ga=[];for(;;){const Eg=this.getCurrentRecord();if(Eg.type!==Vt.REPEAT)break;{const sE=this.extract(Eg,this.consumeRepeatInterval),wE=this.parseTypedTime(Eg);ga.push({repeatInterval:sE,typedTimes:wE}),this.currentLine++}}return ga}parseTypedTime(ga){const Eg=[];for(;;)try{this.consumeSpaceForRecord(ga),Eg.push(this.extract(ga,this.consumeTypedTime))}catch{break}if(Eg.length===0)throw new Error("Invalid typed time.");return Eg}parseTime(){const ga=this.getCurrentRecord(),Eg=this.extract(ga,this.consumeTime);this.consumeSpaceForRecord(ga);const sE=this.extract(ga,this.consumeTime);return this.currentLine++,{startTime:Eg,stopTime:sE}}parseBandWidth(){const ga=[];for(;this.currentLine<this.records.length;){const Eg=this.getCurrentRecord();if(Eg.type!==Vt.BANDWIDTH)break;{const sE=this.extractOneOrMore(Eg,_u);if(Eg.value[Eg.cur]!==":")throw new Error("Invalid bandwidth field.");Eg.cur++;const wE=this.extractOneOrMore(Eg,_r);ga.push({bwtype:sE,bandwidth:wE}),this.currentLine++}}return ga}parseVersion(){const ga=this.getCurrentRecord();if(ga.type!==Vt.VERSION)throw new Error("first sdp record must be version");const Eg=ga.value.slice(0,this.consumeOneOrMore(ga.value,0,_r));if(Eg.length!==ga.value.length)throw new Error('invalid proto version, "v='.concat(ga.value,'"'));return this.currentLine++,Eg}parseOrigin(){const ga=this.getCurrentRecord();if(ga.type!==Vt.ORIGIN)throw new Error("second line of sdp must be origin");const Eg=this.extractOneOrMore(ga,_l);this.consumeSpaceForRecord(ga);const sE=this.extractOneOrMore(ga,_r);this.consumeSpaceForRecord(ga);const wE=this.extractOneOrMore(ga,_r);this.consumeSpaceForRecord(ga);const XE=this.extractOneOrMore(ga,_u);this.consumeSpaceForRecord(ga);const O_=this.extractOneOrMore(ga,_u);this.consumeSpaceForRecord(ga);const x0=this.extract(ga,this.consumeUnicastAddress);return this.currentLine++,{username:Eg,sessId:sE,sessVersion:wE,nettype:XE,addrtype:O_,unicastAddress:x0}}parseSessionName(){const ga=this.getCurrentRecord();if(ga.type===Vt.SESSION_NAME){const Eg=this.extract(ga,this.consumeText);return this.currentLine++,Eg}}parseInformation(){const ga=this.getCurrentRecord();if(ga.type!==Vt.INFORMATION)return;const Eg=this.extract(ga,this.consumeText);return this.currentLine++,Eg}parseUri(){const ga=this.getCurrentRecord();if(ga.type===Vt.URI)return this.currentLine++,ga.value}parseEmail(){const ga=[];for(;;){const Eg=this.getCurrentRecord();if(Eg.type!==Vt.EMAIL)break;ga.push(Eg.value),this.currentLine++}return ga}parsePhone(){const ga=[];for(;;){const Eg=this.getCurrentRecord();if(Eg.type!==Vt.PHONE)break;ga.push(Eg.value),this.currentLine++}return ga}parseConnection(){const ga=this.getCurrentRecord();if(ga.type===Vt.CONNECTION){const Eg=this.extractOneOrMore(ga,_u);this.consumeSpaceForRecord(ga);const sE=this.extractOneOrMore(ga,_u);this.consumeSpaceForRecord(ga);const wE=this.extract(ga,this.consumeAddress);return this.currentLine++,{nettype:Eg,addrtype:sE,address:wE}}}parseMedia(){const ga=this.getCurrentRecord(),Eg=this.extract(ga,this.consumeToken);this.consumeSpaceForRecord(ga);let sE=this.extract(ga,this.consumePort);ga.value[ga.cur]==="/"&&(ga.cur+=1,sE+=this.extract(ga,this.consumeInteger)),this.consumeSpaceForRecord(ga);const wE=[];for(wE.push(this.extract(ga,this.consumeToken));ga.value[ga.cur]==="/";)ga.cur+=1,wE.push(this.extract(ga,this.consumeToken));if(wE.length===0)throw new Error("Invalid proto");const XE=this.parseFmt(ga);return this.currentLine++,{mediaType:Eg,port:sE,protos:wE,fmts:XE}}parseTimeFields(){const ga=[];for(;this.getCurrentRecord().type===Vt.TIME;){const Eg=this.parseTime(),sE=this.parseRepeat(),wE=this.parseZone();ga.push({time:Eg,repeats:sE,zones:wE})}return ga}parseMediaDescription(){const ga=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===Vt.MEDIA;){const Eg=this.parseMedia(),sE=this.parseInformation(),wE=this.parseConnections(),XE=this.parseBandWidth(),O_=this.parseKey(),x0=this.parseMediaAttributes(Eg);ga.push({media:Eg,information:sE,connections:wE,bandwidths:XE,key:O_,attributes:x0})}return ga}parseConnections(){const ga=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===Vt.CONNECTION;)ga.push(this.parseConnection());return ga}parseFmt(ga){const Eg=[];for(;;)try{this.consumeSpaceForRecord(ga),Eg.push(this.extract(ga,this.consumeToken))}catch{break}if(Eg.length===0)throw new Error("Invalid fmts");return Eg}extract(ga,Eg,...sE){const wE=Eg.call(this,ga.value,ga.cur,...sE),XE=ga.value.slice(ga.cur,wE);return ga.cur=wE,XE}extractOneOrMore(ga,Eg){const sE=this.consumeOneOrMore(ga.value,ga.cur,Eg),wE=ga.value.slice(ga.cur,sE);return ga.cur=sE,wE}consumeSpaceForRecord(ga){if(ga.value[ga.cur]!==$)throw new Error("Invalid space at ".concat(ga.cur,"."));ga.cur+=1}}class s_ extends OE{constructor(...ga){super(...ga),PE(this,"attributes",void 0),PE(this,"digested",!1)}extractOneOrMore(ga,Eg,sE){const wE=this.consumeOneOrMore(ga.attValue,ga._cur,Eg),XE=ga.attValue.slice(ga._cur,wE),[O_,x0]=sE||[];if(typeof O_=="number"&&XE.length<O_)throw new Error("error in length, should be more or equal than ".concat(O_," characters."));if(typeof x0=="number"&&XE.length>x0)throw new Error("error in length, should be less or equal than ".concat(x0," characters."));return ga._cur=wE,XE}consumeAttributeSpace(ga){if(ga.attValue[ga._cur]!==$)throw new Error("Invalid space at ".concat(ga._cur,"."));ga._cur+=1}extract(ga,Eg,...sE){if(!ga.attValue)throw new Error("Nothing to extract from attValue.");const wE=Eg.call(this,ga.attValue,ga._cur,...sE),XE=ga.attValue.slice(ga._cur,wE);return ga._cur=wE,XE}atEnd(ga){if(!ga.attValue)throw new Error;return ga._cur>=ga.attValue.length}peekChar(ga){if(!ga.attValue)throw new Error;return ga.attValue[ga._cur]}peek(ga,Eg){if(!ga.attValue)throw new Error;for(let sE=0;sE<Eg.length;sE++)if(Eg[sE]!==ga.attValue[ga._cur+sE])return!1;return!0}parseIceUfrag(ga){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(ga,SE,[4,256])}parseIcePwd(ga){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(ga,SE,[22,256])}parseIceOptions(ga){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");const Eg=[];for(;!this.atEnd(ga);){Eg.push(this.extractOneOrMore(ga,SE));try{this.consumeAttributeSpace(ga)}catch(sE){if(this.atEnd(ga))break;throw sE}}this.attributes.iceOptions=Eg}parseFingerprint(ga){const Eg=this.extract(ga,this.consumeToken);this.consumeAttributeSpace(ga);const sE=this.extract(ga,this.consumeTill);this.attributes.fingerprints.push({hashFunction:Eg,fingerprint:sE})}parseExtmap(ga){const Eg=this.extractOneOrMore(ga,_r);let sE;this.peekChar(ga)==="/"&&(this.extract(ga,this.consume,"/"),sE=this.extract(ga,this.consumeToken)),this.consumeAttributeSpace(ga);const wE=this.extract(ga,this.consumeTill,$),XE=EE(EE({entry:parseInt(Eg,10)},sE&&{direction:sE}),{},{extensionName:wE});this.peekChar(ga)===$&&(this.consumeAttributeSpace(ga),XE.extensionAttributes=this.extract(ga,this.consumeTill)),this.attributes.extmaps.push(XE)}parseSetup(ga){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");const Eg=this.extract(ga,this.consumeTill);if(Eg!=="active"&&Eg!=="passive"&&Eg!=="actpass"&&Eg!=="holdconn")throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=Eg}}class B_ extends s_{constructor(...ga){super(...ga),PE(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(ga){if(this.digested)throw new Error("already digested");try{switch(ga.attField){case"group":this.parseGroup(ga);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(ga);break;case"ice-pwd":this.parseIcePwd(ga);break;case"ice-options":this.parseIceOptions(ga);break;case"fingerprint":this.parseFingerprint(ga);break;case"setup":this.parseSetup(ga);break;case"tls-id":this.parseTlsId(ga);break;case"identity":this.parseIdentity(ga);break;case"extmap":this.parseExtmap(ga);break;case"msid-semantic":this.parseMsidSemantic(ga);break;default:ga.ignored=!0,this.attributes.unrecognized.push(ga)}}catch(Eg){throw console.error("parsing session attribute ".concat(ga.attField,' error, "a=').concat(ga.attField,":").concat(ga.attValue,'"')),Eg}if(!ga.ignored&&ga.attValue&&!this.atEnd(ga))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(ga){const Eg=this.extract(ga,this.consumeToken),sE=[];for(;!this.atEnd(ga)&&this.peekChar(ga)===$;)this.consumeAttributeSpace(ga),sE.push(this.extract(ga,this.consumeToken));this.attributes.groups.push({semantic:Eg,identificationTag:sE})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(ga){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(ga,vE)}parseIdentity(ga){const Eg=this.extractOneOrMore(ga,fE),sE=[];for(;!this.atEnd(ga)&&this.peekChar(ga)===$;){this.consumeAttributeSpace(ga);const wE=this.extract(ga,this.consumeToken);this.extract(ga,this.consume,"=");const XE=this.extractOneOrMore(ga,O_=>O_!==$&&oE(O_));sE.push({name:wE,value:XE})}this.attributes.identities.push({assertionValue:Eg,extensions:sE})}parseMsidSemantic(ga){this.peekChar(ga)===$&&this.consumeAttributeSpace(ga);const Eg={semantic:this.extract(ga,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(ga)}catch{break}if(this.peekChar(ga)==="*"){this.extract(ga,this.consume,"*"),Eg.applyForAll=!0;break}{const sE=this.extract(ga,this.consumeTill,$);Eg.identifierList.push(sE)}}this.attributes.msidSemantic=Eg}}class r0 extends s_{constructor(ga){super(),PE(this,"attributes",void 0),ga.protos.indexOf("RTP")!==-1||ga.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(ga){if(this.digested)throw new Error("already digested");try{switch(ga.attField){case"extmap":this.parseExtmap(ga);break;case"setup":this.parseSetup(ga);break;case"ice-ufrag":this.parseIceUfrag(ga);break;case"ice-pwd":this.parseIcePwd(ga);break;case"ice-options":this.parseIceOptions(ga);break;case"candidate":this.parseCandidate(ga);break;case"remote-candidate":this.parseRemoteCandidate(ga);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(ga);break;case"rtpmap":this.parseRtpmap(ga);break;case"ptime":this.parsePtime(ga);break;case"maxptime":this.parseMaxPtime(ga);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(ga);break;case"ssrc":this.parseSSRC(ga);break;case"fmtp":this.parseFmtp(ga);break;case"rtcp-fb":this.parseRtcpFb(ga);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(ga);break;case"mid":this.parseMid(ga);break;case"msid":this.parseMsid(ga);break;case"imageattr":this.parseImageAttr(ga);break;case"rid":this.parseRid(ga);break;case"simulcast":this.parseSimulcast(ga);break;case"sctp-port":this.parseSctpPort(ga);break;case"max-message-size":this.parseMaxMessageSize(ga);break;case"ssrc-group":this.parseSSRCGroup(ga);break;default:ga.ignored=!0,this.attributes.unrecognized.push(ga)}}catch(Eg){throw console.error("parsing media attribute ".concat(ga.attField,' error, "a=').concat(ga.attField,":").concat(ga.attValue,'"')),Eg}if(!ga.ignored&&ga.attValue&&!this.atEnd(ga))throw new Error("attribute parsing error")}parseCandidate(ga){const Eg=this.extractOneOrMore(ga,SE,[1,32]);this.consumeAttributeSpace(ga);const sE=this.extractOneOrMore(ga,_r,[1,5]);this.consumeAttributeSpace(ga);const wE=this.extract(ga,this.consumeToken);this.consumeAttributeSpace(ga);const XE=this.extractOneOrMore(ga,_r,[1,10]);this.consumeAttributeSpace(ga);const O_=this.extract(ga,this.consumeAddress);this.consumeAttributeSpace(ga);const x0=this.extract(ga,this.consumePort);this.consumeAttributeSpace(ga),this.extract(ga,this.consume,"typ"),this.consumeAttributeSpace(ga);const bS={foundation:Eg,componentId:sE,transport:wE,priority:XE,connectionAddress:O_,port:x0,type:this.extract(ga,this.consumeToken),extension:{}};for(this.peek(ga," raddr")&&(this.extract(ga,this.consume," raddr"),this.consumeAttributeSpace(ga),bS.relAddr=this.extract(ga,this.consumeAddress)),this.peek(ga," rport")&&(this.extract(ga,this.consume," rport"),this.consumeAttributeSpace(ga),bS.relPort=this.extract(ga,this.consumePort));this.peekChar(ga)===$;){this.consumeAttributeSpace(ga);const nR=this.extract(ga,this.consumeToken);this.consumeAttributeSpace(ga),bS.extension[nR]=this.extractOneOrMore(ga,Fi)}this.attributes.candidates.push(bS)}parseRemoteCandidate(ga){const Eg=[];for(;;){const sE=this.extractOneOrMore(ga,_r,[1,5]);this.consumeAttributeSpace(ga);const wE=this.extract(ga,this.consumeAddress);this.consumeAttributeSpace(ga);const XE=this.extract(ga,this.consumePort);Eg.push({componentId:sE,connectionAddress:wE,port:XE});try{this.consumeAttributeSpace(ga)}catch{break}}this.attributes.remoteCandidatesList.push(Eg)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(ga){const Eg=this.extract(ga,this.consumeToken);this.consumeAttributeSpace(ga);const sE=this.extract(ga,this.consumeTill,"/");this.extract(ga,this.consume,"/");const wE={encodingName:sE,clockRate:this.extractOneOrMore(ga,_r)};this.atEnd(ga)||this.peekChar(ga)!=="/"||(this.extract(ga,this.consume,"/"),wE.encodingParameters=parseInt(this.extract(ga,this.consumeTill),10));const XE=this.attributes.payloads.find(O_=>O_.payloadType===parseInt(Eg,10));XE?XE.rtpMap=wE:this.attributes.payloads.push({payloadType:parseInt(Eg,10),rtpMap:wE,rtcpFeedbacks:[]})}parsePtime(ga){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(ga,this.consumeTill)}parseMaxPtime(ga){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(ga,this.consumeTill)}parseDirection(ga){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=ga.attField}parseSSRC(ga){const Eg=this.extractOneOrMore(ga,_r);this.consumeAttributeSpace(ga);const sE=this.extract(ga,this.consumeTill,":");let wE;this.peekChar(ga)===":"&&(this.extract(ga,this.consume,":"),wE=this.extract(ga,this.consumeTill));const XE=this.attributes.ssrcs.find(O_=>O_.ssrcId===parseInt(Eg,10));XE?XE.attributes[sE]=wE:this.attributes.ssrcs.push({ssrcId:parseInt(Eg,10),attributes:{[sE]:wE}})}parseFmtp(ga){const Eg=this.extract(ga,this.consumeTill,$);this.consumeAttributeSpace(ga);const sE=this.extract(ga,this.consumeTill),wE={};sE.split(";").forEach(O_=>{let[x0,bS]=O_.split("=");x0=x0.trim();const nR=typeof bS=="string"?bS.trim():null;typeof x0=="string"&&x0.length>0&&(wE[x0]=nR)});const XE=this.attributes.payloads.find(O_=>O_.payloadType===parseInt(Eg,10));XE?XE.fmtp={parameters:wE}:this.attributes.payloads.push({payloadType:parseInt(Eg,10),rtcpFeedbacks:[],fmtp:{parameters:wE}})}parseFmtParameters(ga){const Eg={},sE=this.extract(ga,this.consumeTill,"=");ga._cur++;const wE=this.extract(ga,this.consumeTill,";");for(Eg[sE]=wE;ga.attValue[ga._cur]===";";){const XE=this.extract(ga,this.consumeTill,"=");ga._cur++;const O_=this.extract(ga,this.consumeTill,";");Eg[XE]=O_}return Eg}parseRtcpFb(ga){let Eg="";Eg=this.peekChar(ga)==="*"?this.extract(ga,this.consume,"*"):this.extract(ga,this.consumeTill,$),this.consumeAttributeSpace(ga);const sE=this.extract(ga,this.consumeTill,$);let wE;if(sE==="trr-int")wE={type:sE,interval:this.extract(ga,this.consumeTill)};else{const XE={type:sE};this.peekChar(ga)===$&&(this.consumeAttributeSpace(ga),XE.parameter=this.extract(ga,this.consumeToken),this.peekChar(ga)===$&&(XE.additional=this.extract(ga,this.consumeTill))),wE=XE}if(Eg==="*")this.attributes.rtcpFeedbackWildcards.push(wE);else{const XE=this.attributes.payloads.find(O_=>O_.payloadType===parseInt(Eg,10));XE?XE.rtcpFeedbacks.push(wE):this.attributes.payloads.push({payloadType:parseInt(Eg,10),rtcpFeedbacks:[wE]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(ga){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");const Eg={port:this.extract(ga,this.consumePort)};this.peekChar(ga)===$&&(this.consumeAttributeSpace(ga),Eg.netType=this.extractOneOrMore(ga,_u),this.consumeAttributeSpace(ga),Eg.addressType=this.extractOneOrMore(ga,_u),this.consumeAttributeSpace(ga),Eg.address=this.extract(ga,this.consumeAddress)),this.attributes.rtcp=Eg}parseMsid(ga){const Eg={id:this.extractOneOrMore(ga,_u,[1,64])};this.peekChar(ga)===$&&(this.consumeAttributeSpace(ga),Eg.appdata=this.extractOneOrMore(ga,_u,[1,64])),this.attributes.msids.push(Eg)}parseImageAttr(ga){this.attributes.imageattr.push(ga.attValue)}parseRid(ga){const Eg=this.extractOneOrMore(ga,wE=>_g(wE)||_r(wE)||wE==="_"||wE==="-");this.consumeAttributeSpace(ga);const sE={id:Eg,direction:this.extract(ga,this.consumeToken),params:[]};if(this.peekChar(ga)===$){if(this.consumeAttributeSpace(ga),this.peek(ga,"pt=")){this.extract(ga,this.consume,"pt=");const wE=[];for(;;){const XE=this.extract(ga,this.consumeToken);wE.push(XE);try{this.extract(ga,this.consume,",")}catch{break}}sE.payloads=wE,this.peekChar(ga)===$&&this.extract(ga,this.consume,$)}for(;;){const wE=this.extract(ga,this.consumeToken);switch(wE){case"depend":{const XE={type:wE,rids:this.extract(ga,this.consume,"=").split(",")};sE.params.push(XE);break}default:{const XE={type:wE};this.peekChar(ga)==="="&&(this.extract(ga,this.consume,"="),XE.val=this.extract(ga,this.consumeTill,";")),sE.params.push(XE)}}try{this.extract(ga,this.consume,";")}catch{break}}}this.attributes.rids.push(sE)}parseSimulcast(ga){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=ga.attValue,this.extract(ga,this.consumeTill)}parseSctpPort(ga){this.attributes.sctpPort=this.extractOneOrMore(ga,_r,[1,5])}parseMaxMessageSize(ga){this.attributes.maxMessageSize=this.extractOneOrMore(ga,_r,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(ga){this.attributes.mid=this.extract(ga,this.consumeToken)}parseSSRCGroup(ga){const Eg=this.extract(ga,this.consumeToken),sE=[];for(;;)try{this.consumeAttributeSpace(ga);const wE=this.extract(ga,this.consumeInteger);sE.push(parseInt(wE,10))}catch{break}this.attributes.ssrcGroups.push({semantic:Eg,ssrcIds:sE})}}function P_(NE,ga,Eg){return ga in NE?Object.defineProperty(NE,ga,{value:Eg,enumerable:!0,configurable:!0,writable:!0}):NE[ga]=Eg,NE}class yS{constructor(){P_(this,"eol",z)}print(ga,Eg){let sE="";return Eg&&(this.eol=Eg),sE+=this.printVersion(ga.version),sE+=this.printOrigin(ga.origin),sE+=this.printSessionName(ga.sessionName),sE+=this.printInformation(ga.information),sE+=this.printUri(ga.uri),sE+=this.printEmail(ga.emails),sE+=this.printPhone(ga.phones),sE+=this.printConnection(ga.connection),sE+=this.printBandwidth(ga.bandwidths),sE+=this.printTimeFields(ga.timeFields),sE+=this.printKey(ga.key),sE+=this.printSessionAttributes(ga.attributes),sE+=this.printMediaDescription(ga.mediaDescriptions),sE}printVersion(ga){return"v=".concat(ga).concat(this.eol)}printOrigin(ga){return"o=".concat(ga.username," ").concat(ga.sessId," ").concat(ga.sessVersion," ").concat(ga.nettype," ").concat(ga.addrtype," ").concat(ga.unicastAddress).concat(this.eol)}printSessionName(ga){return ga?"s=".concat(ga).concat(this.eol):""}printInformation(ga){return ga?"i=".concat(ga).concat(this.eol):""}printUri(ga){return ga?"u=".concat(ga).concat(this.eol):""}printEmail(ga){let Eg="";for(const sE of ga)Eg+="e=".concat(sE).concat(this.eol);return Eg}printPhone(ga){let Eg="";for(const sE of ga)Eg+="e=".concat(sE).concat(this.eol);return Eg}printConnection(ga){return ga?"c=".concat(ga.nettype," ").concat(ga.addrtype," ").concat(ga.address).concat(this.eol):""}printBandwidth(ga){let Eg="";for(const sE of ga)Eg+="b=".concat(sE.bwtype,":").concat(sE.bandwidth).concat(this.eol);return Eg}printTimeFields(ga){let Eg="";for(const sE of ga){Eg+="t=".concat(sE.time.startTime," ").concat(sE.time.startTime).concat(this.eol);for(const wE of sE.repeats)Eg+="r=".concat(wE.repeatInterval," ").concat(wE.typedTimes.join(" ")).concat(this.eol);sE.zoneAdjustments&&(Eg+="z=",Eg+="z=".concat(sE.zoneAdjustments.map(wE=>"".concat(wE.time," ").concat(wE.back?"-":""," ").concat(wE.typedTime)).join(" ")).concat(this.eol),Eg+=this.eol)}return Eg}printKey(ga){return ga?"k=".concat(ga).concat(this.eol):""}printAttributes(ga){let Eg="";for(const sE of ga)Eg+="a=".concat(sE.attField).concat(sE.attValue?":".concat(sE.attValue):"").concat(this.eol);return Eg}printMediaDescription(ga){let Eg="";for(const sE of ga)Eg+=this.printMedia(sE.media),Eg+=this.printInformation(sE.information),Eg+=this.printConnections(sE.connections),Eg+=this.printBandwidth(sE.bandwidths),Eg+=this.printKey(sE.key),Eg+=this.printMediaAttributes(sE);return Eg}printConnections(ga){let Eg="";for(const sE of ga)Eg+=this.printConnection(sE);return Eg}printMedia(ga){return"m=".concat(ga.mediaType," ").concat(ga.port," ").concat(ga.protos.join("/")," ").concat(ga.fmts.join(" ")).concat(this.eol)}printSessionAttributes(ga){return new AE(this.eol).print(ga)}printMediaAttributes(ga){return new UE(this.eol).print(ga)}}class RE{constructor(ga){P_(this,"eol",void 0),this.eol=ga}printIceUfrag(ga){return ga===void 0?"":"a=ice-ufrag:".concat(ga).concat(this.eol)}printIcePwd(ga){return ga===void 0?"":"a=ice-pwd:".concat(ga).concat(this.eol)}printIceOptions(ga){return ga===void 0?"":"a=ice-options:".concat(ga.join($)).concat(this.eol)}printFingerprints(ga){return ga.length>0?ga.map(Eg=>"a=fingerprint:".concat(Eg.hashFunction).concat($).concat(Eg.fingerprint)).join(this.eol)+this.eol:""}printExtmap(ga){return ga.map(Eg=>"a=extmap:".concat(Eg.entry).concat(Eg.direction?"/".concat(Eg.direction):"").concat($).concat(Eg.extensionName).concat(Eg.extensionAttributes?"".concat($).concat(Eg.extensionAttributes):"").concat(this.eol)).join("")}printSetup(ga){return ga===void 0?"":"a=setup:".concat(ga).concat(this.eol)}printUnrecognized(ga){return ga.map(Eg=>"a=".concat(Eg.attField).concat(Eg.attValue?":".concat(Eg.attValue):"").concat(this.eol)).join("")}}class AE extends RE{print(ga){let Eg="";return Eg+=this.printGroups(ga.groups),Eg+=this.printMsidSemantic(ga.msidSemantic),Eg+=this.printIceLite(ga.iceLite),Eg+=this.printIceUfrag(ga.iceUfrag),Eg+=this.printIcePwd(ga.icePwd),Eg+=this.printIceOptions(ga.iceOptions),Eg+=this.printFingerprints(ga.fingerprints),Eg+=this.printSetup(ga.setup),Eg+=this.printTlsId(ga.tlsId),Eg+=this.printIdentity(ga.identities),Eg+=this.printExtmap(ga.extmaps),Eg+=this.printUnrecognized(ga.unrecognized),Eg}printGroups(ga){let Eg="";return ga.length>0&&(Eg+=ga.map(sE=>"a=group:".concat(sE.semantic).concat(sE.identificationTag.map(wE=>"".concat($).concat(wE)).join("")).concat(this.eol)).join("")),Eg}printIceLite(ga){return ga===void 0?"":"a=ice-lite"+this.eol}printTlsId(ga){return ga?"a=tls-id:".concat(ga).concat(this.eol):""}printIdentity(ga){return ga.length===0?"":ga.map(Eg=>"a=identity:".concat(Eg.assertionValue).concat(Eg.extensions.map(sE=>"".concat($).concat(sE.name).concat(sE.value?"=".concat(sE.value):"")))).join(this.eol)+this.eol}printMsidSemantic(ga){if(!ga)return"";let Eg="a=msid-semantic:".concat(ga.semantic);return ga.applyForAll?Eg+="".concat($,"*"):ga.identifierList.length>0&&(Eg+=ga.identifierList.map(sE=>"".concat($).concat(sE))),Eg+this.eol}}class UE extends RE{print(ga){const Eg=ga.attributes;let sE="";return sE+=this.printRTCP(Eg.rtcp),sE+=this.printIceUfrag(Eg.iceUfrag),sE+=this.printIcePwd(Eg.icePwd),sE+=this.printIceOptions(Eg.iceOptions),sE+=this.printCandidates(Eg.candidates),sE+=this.printRemoteCandidatesList(Eg.remoteCandidatesList),sE+=this.printEndOfCandidates(Eg.endOfCandidates),sE+=this.printFingerprints(Eg.fingerprints),sE+=this.printSetup(Eg.setup),sE+=this.printMid(Eg.mid),sE+=this.printExtmap(Eg.extmaps),sE+=this.printRTPRelated(Eg),sE+=this.printPtime(Eg.ptime),sE+=this.printMaxPtime(Eg.maxPtime),sE+=this.printDirection(Eg.direction),sE+=this.printSSRCGroups(Eg.ssrcGroups),sE+=this.printSSRC(Eg.ssrcs),sE+=this.printRTCPMux(Eg.rtcpMux),sE+=this.printRTCPMuxOnly(Eg.rtcpMuxOnly),sE+=this.printRTCPRsize(Eg.rtcpRsize),sE+=this.printMSId(Eg.msids),sE+=this.printImageattr(Eg.imageattr),sE+=this.printRid(Eg.rids),sE+=this.printSimulcast(Eg.simulcast),sE+=this.printSCTPPort(Eg.sctpPort),sE+=this.printMaxMessageSize(Eg.maxMessageSize),sE+=this.printUnrecognized(Eg.unrecognized),sE}printCandidates(ga){return ga.map(Eg=>"a=candidate:".concat(Eg.foundation).concat($).concat(Eg.componentId).concat($).concat(Eg.transport).concat($).concat(Eg.priority).concat($).concat(Eg.connectionAddress).concat($).concat(Eg.port).concat($,"typ").concat($).concat(Eg.type).concat(Eg.relAddr?"".concat($,"raddr").concat($).concat(Eg.relAddr):"").concat(Eg.relPort?"".concat($,"rport").concat($).concat(Eg.relPort):"").concat(Object.keys(Eg.extension).map(sE=>"".concat($).concat(sE).concat($).concat(Eg.extension[sE])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(ga){return ga.map(Eg=>"a=remote-candidates:".concat(Eg.join($)).concat(this.eol)).join("")}printEndOfCandidates(ga){return ga===void 0?"":"a=end-of-candidates"+this.eol}printRTPRelated(ga){if(!ga.payloads)return"";const Eg=ga.payloads;let sE="";sE+=ga.rtcpFeedbackWildcards.map(wE=>this.printRTCPFeedback("*",wE)).join("");for(const wE of Eg)sE+=this.printRtpMap(wE.payloadType,wE.rtpMap),sE+=this.printFmtp(wE.payloadType,wE.fmtp),sE+=wE.rtcpFeedbacks.map(XE=>this.printRTCPFeedback(wE.payloadType,XE)).join("");return sE}printFmtp(ga,Eg){if(!Eg)return"";const sE=Object.keys(Eg.parameters);return sE.length===1&&Eg.parameters[sE[0]]===null?"a=fmtp:".concat(ga).concat($).concat(sE[0]).concat(this.eol):"a=fmtp:".concat(ga).concat($).concat(Object.keys(Eg.parameters).map(wE=>"".concat(wE,"=").concat(Eg.parameters[wE])).join(";")).concat(this.eol)}printRtpMap(ga,Eg){return Eg?"a=rtpmap:".concat(ga).concat($).concat(Eg.encodingName,"/").concat(Eg.clockRate).concat(Eg.encodingParameters?"/".concat(Eg.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(ga,Eg){let sE="a=rtcp-fb:".concat(ga).concat($),wE=Eg;return wE.type==="trr-int"?sE+="ttr-int".concat($).concat(wE.interval):(sE+="".concat(wE.type),wE.parameter&&(sE+="".concat($).concat(wE.parameter),wE.additional&&(sE+="".concat($).concat(wE.additional)))),sE+this.eol}printPtime(ga){return ga===void 0?"":"a=ptime:".concat(ga).concat(this.eol)}printMaxPtime(ga){return ga===void 0?"":"a=maxptime:".concat(ga).concat(this.eol)}printDirection(ga){return ga===void 0?"":"a=".concat(ga).concat(this.eol)}printSSRC(ga){return ga.map(Eg=>Object.keys(Eg.attributes).map(sE=>"a=ssrc:".concat(Eg.ssrcId.toString(10)).concat($).concat(sE).concat(Eg.attributes[sE]?":".concat(Eg.attributes[sE]):"").concat(this.eol)).join("")).join("")}printRTCPMux(ga){return ga===void 0?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(ga){return ga===void 0?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(ga){return ga===void 0?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(ga){if(ga===void 0)return"";let Eg="a=rtcp:".concat(ga.port);return ga.netType&&(Eg+="".concat($).concat(ga.netType)),ga.addressType&&(Eg+="".concat($).concat(ga.addressType)),ga.address&&(Eg+="".concat($).concat(ga.address)),Eg+this.eol}printMSId(ga){return ga.map(Eg=>"a=msid:".concat(Eg.id).concat(Eg.appdata?"".concat($).concat(Eg.appdata):"").concat(this.eol)).join("")}printImageattr(ga){return ga.map(Eg=>"a=imageattr:".concat(Eg).concat(this.eol)).join("")}printRid(ga){return ga.map(Eg=>{let sE="a=rid:".concat(Eg.id).concat($).concat(Eg.direction);return Eg.payloads&&(sE+="".concat($,"pt=").concat(Eg.payloads.join(","))),Eg.params.length>0&&(sE+="".concat($).concat(Eg.params.map(wE=>wE.type==="depend"?"depend=".concat(wE.rids.join(",")):"".concat(wE.type,"=").concat(wE.val)).join(";"))),sE+this.eol}).join("")}printSimulcast(ga){return ga===void 0?"":"a=simulcast:".concat(ga).concat(this.eol)}printSCTPPort(ga){return ga===void 0?"":"a=sctp-port:".concat(ga).concat(this.eol)}printMaxMessageSize(ga){return ga===void 0?"":"a=max-message-size:".concat(ga).concat(this.eol)}printMid(ga){return ga===void 0?"":"a=mid:".concat(ga).concat(this.eol)}printSSRCGroups(ga){return ga.map(Eg=>"a=ssrc-group:".concat(Eg.semantic).concat(Eg.ssrcIds.map(sE=>"".concat($).concat(sE.toString(10))).join("")).concat(this.eol)).join("")}}function YE(NE){return new $E().parse(NE)}function h_(NE,ga){return new yS().print(NE,ga)}}},p={};function g(b){if(p[b])return p[b].exports;var A=p[b]={exports:{}};return o[b](A,A.exports,g),A.exports}return g.d=(b,A)=>{for(var j in A)g.o(A,j)&&!g.o(b,j)&&Object.defineProperty(b,j,{enumerable:!0,get:A[j]})},g.o=(b,A)=>Object.prototype.hasOwnProperty.call(b,A),g.r=b=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(b,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(b,"__esModule",{value:!0})},g(8)})()})(O5);var q_=O5.exports;function N5(l,i){var o=Object.keys(l);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(l);i&&(p=p.filter(function(g){return Object.getOwnPropertyDescriptor(l,g).enumerable})),o.push.apply(o,p)}return o}function P5(l){for(var i=1;i<arguments.length;i++){var o=arguments[i]!=null?arguments[i]:{};i%2?N5(Object(o),!0).forEach(function(p){_e(l,p,o[p])}):Object.getOwnPropertyDescriptors?Object.defineProperties(l,Object.getOwnPropertyDescriptors(o)):N5(Object(o)).forEach(function(p){Object.defineProperty(l,p,Object.getOwnPropertyDescriptor(o,p))})}return l}function _2(l){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},p=arguments.length>3?arguments[3]:void 0;const{filterRTX:g,filterVideoFec:b,filterAudioFec:A,filterAudioCodec:j,filterVideoCodec:H}=i,{useXR:z}=o;let $=[],Vt=[],_r=[],Fi=[],_l=!1,_u=!1;if(q_.parse(l).mediaDescriptions.forEach(_g=>{p&&p!==_g.attributes.direction||(_g.media.mediaType!=="video"||_l||(Vt=_g.attributes.payloads,Fi=_g.attributes.extmaps,_l=!0),_g.media.mediaType!=="audio"||_u||($=_g.attributes.payloads,_r=_g.attributes.extmaps,_u=!0))}),!Fi||Vt.length===0)throw new Error("Cannot get video capabilities from SDP.");if(!_r||$.length===0)throw new Error("Cannot get audio capabilities from SDP.");Vt.forEach(_g=>{var eE;(eE=_g.rtpMap)!==null&&eE!==void 0&&eE.clockRate&&(_g.rtpMap.clockRate=parseInt(_g.rtpMap.clockRate)),z&&_g.rtcpFeedbacks.push({type:"rrtr"})}),$.forEach(_g=>{var eE;(eE=_g.rtpMap)!==null&&eE!==void 0&&eE.clockRate&&(_g.rtpMap.clockRate=parseInt(_g.rtpMap.clockRate)),z&&_g.rtcpFeedbacks.push({type:"rrtr"})}),g&&($=$.filter(_g=>{var eE;return((eE=_g.rtpMap)===null||eE===void 0?void 0:eE.encodingName.toLowerCase())!=="rtx"}),Vt=Vt.filter(_g=>{var eE;return((eE=_g.rtpMap)===null||eE===void 0?void 0:eE.encodingName.toLowerCase())!=="rtx"})),b&&(Vt=Vt.filter(_g=>{var eE;return!/(red)|(ulpfec)|(flexfec)/i.test(((eE=_g.rtpMap)===null||eE===void 0?void 0:eE.encodingName)||"")})),A&&($=$.filter(_g=>{var eE;return!/(red)|(ulpfec)|(flexfec)/i.test(((eE=_g.rtpMap)===null||eE===void 0?void 0:eE.encodingName)||"")})),j&&(j==null?void 0:j.length)>0&&($=$.filter(_g=>{var eE;return VE(j).call(j,((eE=_g.rtpMap)===null||eE===void 0?void 0:eE.encodingName.toLowerCase())||"")})),H&&(H==null?void 0:H.length)>0&&(Vt=Vt.filter(_g=>{var eE;return VE(H).call(H,((eE=_g.rtpMap)===null||eE===void 0?void 0:eE.encodingName.toLowerCase())||"")}));const _h=nE("UNSUPPORTED_VIDEO_CODEC");return _h&&_h.length>0&&(Vt=Vt.filter(_g=>!(_g.rtpMap&&VE(_h).call(_h,_g.rtpMap.encodingName.toLowerCase())))),{audioCodecs:$,videoCodecs:Vt,audioExtensions:_r,videoExtensions:Fi}}function mI(l){const i=q_.parse(l);let o,p;for(const g of i.mediaDescriptions){if(!o){const b=g.attributes.iceUfrag,A=g.attributes.icePwd;if(!b||!A)throw new Error("Cannot get iceUfrag or icePwd from SDP.");o={iceUfrag:b,icePwd:A}}if(!p){const b=g.attributes.fingerprints;b.length>0&&(p={fingerprints:b})}}if(!p&&i.attributes.fingerprints.length>0&&(p={fingerprints:i.attributes.fingerprints}),!p||!o)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:o,dtlsParameters:p}}function k5(l,i){const o=[],p=l.attributes.ssrcGroups.filter(A=>A.semantic==="FID"),g=l.attributes.ssrcGroups.find(A=>A.semantic==="SIM"),b=l.attributes.ssrcs;if(g)g.ssrcIds.forEach(A=>{var j;const H=(j=p.find(z=>z.ssrcIds[0]===A))===null||j===void 0?void 0:j.ssrcIds[1];o.push({ssrcId:A,rtx:i?H:void 0})});else if(p.length>0){const A=p[0].ssrcIds[0],j=p[0].ssrcIds[1];o.push({ssrcId:A,rtx:i?j:void 0})}else{if(b.length===0)throw new Error("No ssrcs found on local media description.");o.push({ssrcId:b[0].ssrcId})}return o}function D5(l,i){const{cname:o}=l;let p;i&&i.ip&&typeof i.port=="number"?(p=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:i.ip,port:i.port.toString(),type:"host",extension:{}}],Gi.debug("Using remote candidate from AP ".concat(i.ip,":").concat(i.port)),i.ip6&&(p.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:i.ip6,port:i.port.toString(),type:"host",extension:{}}),Gi.debug("Using IPV6 remote candidate from AP ".concat(i.ip6,":").concat(i.port)))):p=l.iceParameters.candidates.map(j=>({foundation:j.foundation,componentId:"1",transport:j.protocol,priority:j.priority.toString(),connectionAddress:j.ip,port:j.port.toString(),type:j.type,extension:{}}));const g={fingerprints:l.dtlsParameters.fingerprints.map(j=>({hashFunction:j.algorithm,fingerprint:j.fingerprint}))},b={iceUfrag:l.iceParameters.iceUfrag,icePwd:l.iceParameters.icePwd};let A;switch(l.dtlsParameters.role){case"server":A="passive";break;case"client":A="active";break;case"auto":A="actpass"}return{dtlsParameters:g,iceParameters:b,candidates:p,rtpCapabilities:pP(l.rtpCapabilities),setup:A,cname:o}}function XS(l,i,o){const p=[],g=[];return l.forEach(b=>{let{ssrcId:A,rtx:j}=b;const H=T_(8,"track-"),z={ssrcId:A,attributes:P5({label:H,mslabel:o=o||T_(10,""),msid:"".concat(o," ").concat(H)},i&&{cname:i})};if(p.push(z),j!==void 0){const $={ssrcId:j,attributes:P5({label:H,mslabel:o,msid:"".concat(o," ").concat(H)},i&&{cname:i})};p.push($),g.push({semantic:"FID",ssrcIds:[A,j]})}}),l.length>1&&g.push({semantic:"SIM",ssrcIds:l.map(b=>{let{ssrcId:A}=b;return A})}),{ssrcs:p,ssrcGroups:g}}function gI(l,i){i instanceof g_&&l.attributes.payloads.forEach(o=>{var p;const g=(p=o.rtpMap)===null||p===void 0?void 0:p.encodingName.toLowerCase();if(!g||["opus","pcmu","pcma","g722"].indexOf(g)===-1)return;o.fmtp||(o.fmtp={parameters:{}}),o.fmtp.parameters.minptime="10",o.fmtp.parameters.useinbandfec="1";const b=i._encoderConfig;b&&g!=="pcmu"&&g!=="pcma"&&g!=="g722"&&(b.bitrate&&!N_()&&(o.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*b.bitrate))),b.sampleRate&&(o.fmtp.parameters.maxplaybackrate="".concat(b.sampleRate),o.fmtp.parameters["sprop-maxcapturerate"]="".concat(b.sampleRate)),b.stereo&&(o.fmtp.parameters.stereo="1",o.fmtp.parameters["sprop-stereo"]="1"))})}function y2(l){const i=l.attributes.unrecognized.findIndex(o=>o.attField==="x-google-flag"&&o.attValue==="conference");i!==-1&&l.attributes.unrecognized.splice(i,1)}function b2(l,i){var o;if(!(i instanceof ZE&&i._encoderConfig&&i._hints.indexOf(A_.SCREEN_TRACK)===-1))return;const p=i._encoderConfig;I_().supportMinBitrate&&p.bitrateMin&&l.attributes.payloads.forEach(g=>{var b,A;VE(b=["h264","h265","vp8","vp9","av1"]).call(b,((A=g.rtpMap)===null||A===void 0?void 0:A.encodingName.toLowerCase())||"")&&(g.fmtp||(g.fmtp={parameters:{}}),g.fmtp.parameters["x-google-min-bitrate"]="".concat(p.bitrateMin))}),I_().supportMinBitrate&&!VE(o=i._hints).call(o,A_.LOW_STREAM)&&p.bitrateMax&&l.attributes.payloads.forEach(g=>{var b,A;VE(b=["h264","h265","vp8","vp9","av1"]).call(b,((A=g.rtpMap)===null||A===void 0?void 0:A.encodingName.toLowerCase())||"")&&(g.fmtp||(g.fmtp={parameters:{}}),g.fmtp.parameters["x-google-start-bitrate"]="".concat(nE("X_GOOGLE_START_BITRATE")||Math.floor(p.bitrateMax)))})}function L5(l){if(l.media.mediaType!=="video")return;const i=l_();if(i.name!==m_.SAFARI&&i.os!==l0.IOS)return;const o=l.attributes.extmaps.findIndex(p=>/video-orientation/g.test(p.extensionName));o!==-1&&l.attributes.extmaps.splice(o,1)}function dP(l,i,o){if(!i)return;let p,g;if(l.media.mediaType==="video"?(p=o.videoExtensions,g=o.videoCodecs):(p=o.audioExtensions,g=o.audioCodecs),i.twcc===!0){const b=p.find(A=>A.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01");b&&(l.attributes.extmaps.find(j=>j.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01")||l.attributes.extmaps.push({entry:b.entry,extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"}),function(j,H){return H.filter(z=>!!j.find($=>$.payloadType===z.payloadType&&!!$.rtcpFeedbacks.find(Vt=>Vt.type==="transport-cc")))}(g,l.attributes.payloads).forEach(j=>{j.rtcpFeedbacks.find(H=>H.type==="transport-cc")||j.rtcpFeedbacks.push({type:"transport-cc"})}))}else if(i.twcc===!1){const b=l.attributes.extmaps.findIndex(A=>A.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01");b!==-1&&l.attributes.extmaps.splice(b,1),l.attributes.payloads.forEach(A=>{const j=A.rtcpFeedbacks.findIndex(H=>H.type==="transport-cc");j!==-1&&A.rtcpFeedbacks.splice(j,1)})}if(i.remb===!0){const b=p.find(A=>A.extensionName==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time");b&&(l.attributes.extmaps.find(j=>j.extensionName==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time")||l.attributes.extmaps.push({entry:b.entry,extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}),function(j,H){return H.filter(z=>!!j.find($=>$.payloadType===z.payloadType&&!!$.rtcpFeedbacks.find(Vt=>Vt.type==="goog-remb")))}(g,l.attributes.payloads).forEach(j=>{j.rtcpFeedbacks.find(H=>H.type==="goog-remb")||j.rtcpFeedbacks.push({type:"goog-remb"})}))}else if(i.remb===!1){const b=l.attributes.extmaps.findIndex(A=>A.extensionName==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time");b!==-1&&l.attributes.extmaps.splice(b,1),l.attributes.payloads.forEach(A=>{const j=A.rtcpFeedbacks.findIndex(H=>H.type==="goog-remb");j!==-1&&A.rtcpFeedbacks.splice(j,1)})}}function S2(l,i,o){if(N_()||l.media.mediaType!=="video"||!(i instanceof ZE)||o!=="vp9"&&o!=="vp8"||o==="vp8"&&!nE("SIMULCAST")||i._scalabilityMode===void 0||i._scalabilityMode.numSpatialLayers<=1)return;const p=o==="vp8"?2:i._scalabilityMode.numSpatialLayers,g=l.attributes.ssrcs[0],b=l.attributes.ssrcGroups.find(j=>j.semantic==="FID"&&j.ssrcIds[0]===g.ssrcId),A={semantic:"SIM",ssrcIds:[g.ssrcId]};for(let j=1;j<p;j++)l.attributes.ssrcs.push({ssrcId:g.ssrcId+j,attributes:Q_(g.attributes)}),A.ssrcIds.push(g.ssrcId+j),b&&(l.attributes.ssrcs.push({ssrcId:b.ssrcIds[1]+j,attributes:Q_(g.attributes)}),l.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[g.ssrcId+j,b.ssrcIds[1]+j]}));l.attributes.ssrcGroups.unshift(A)}async function x5(){let l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const{filterRTX:o,filterVideoFec:p,filterAudioFec:g,filterAudioCodec:b,filterVideoCodec:A}=l,{useXR:j}=i,H=new RTCPeerConnection;H.addTransceiver("video",{direction:"sendonly"}),H.addTransceiver("audio",{direction:"sendonly"}),H.addTransceiver("video",{direction:"recvonly"}),H.addTransceiver("audio",{direction:"recvonly"});const z=(await H.createOffer()).sdp,$=_2(z,{filterRTX:o,filterVideoFec:p,filterAudioFec:g,filterAudioCodec:b,filterVideoCodec:A},{useXR:j},"sendonly"),Vt=_2(z,{filterRTX:o,filterVideoFec:p,filterAudioFec:g,filterAudioCodec:b,filterVideoCodec:A},{useXR:j},"recvonly"),_r={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},Fi={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},_l={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(hP($,Vt,"videoExtensions",_r,Fi,_l),hP($,Vt,"videoCodecs",_r,Fi,_l),hP($,Vt,"audioExtensions",_r,Fi,_l),hP($,Vt,"audioCodecs",_r,Fi,_l),nE("RAISE_H264_BASELINE_PRIORITY")){const _u=_l.videoCodecs.findIndex(_h=>{var _g,eE;return((_g=_h.rtpMap)===null||_g===void 0?void 0:_g.encodingName.toLocaleLowerCase())==="h264"&&((eE=_h.fmtp)===null||eE===void 0?void 0:eE.parameters["profile-level-id"])==="42001f"});if(_u!==-1){const _h=_l.videoCodecs.findIndex(_g=>{var eE;return((eE=_g.rtpMap)===null||eE===void 0?void 0:eE.encodingName.toLocaleLowerCase())==="h264"});if(_h<_u){Gi.debug("raising H264 baseline profile priority");const _g=_l.videoCodecs[_u];_l.videoCodecs.splice(_u,1),_l.videoCodecs.splice(_h,0,_g)}_h!==-1&&(Fi.videoCodecs=Fi.videoCodecs.filter(_g=>{var eE,oE;return!(((eE=_g.rtpMap)===null||eE===void 0?void 0:eE.encodingName.toLocaleLowerCase())==="h264"&&((oE=_g.fmtp)===null||oE===void 0?void 0:oE.parameters["profile-level-id"])!=="42001f")})),_h!==-1&&nE("FILTER_SEND_H264_BASELINE")&&(_r.videoCodecs=_r.videoCodecs.filter(_g=>{var eE,oE;return!(((eE=_g.rtpMap)===null||eE===void 0?void 0:eE.encodingName.toLocaleLowerCase())==="h264"&&((oE=_g.fmtp)===null||oE===void 0?void 0:oE.parameters["profile-level-id"])!=="42001f")}))}}try{H.close()}catch{}return{send:_r,recv:Fi,sendrecv:_l}}function hP(l,i,o,p,g,b){if(o==="videoExtensions"||o==="audioExtensions"){const A=[];return l[o].forEach(j=>{i[o].some((H,z)=>{if(j.entry===H.entry&&j.extensionName===H.extensionName)return A.push(z),!0})?b[o].push(j):p[o].push(j)}),void i[o].forEach((j,H)=>{A.indexOf(H)===-1&&g[o].push(j)})}if(o==="videoCodecs"||o==="audioCodecs"){const A=[];return l[o].forEach(j=>{i[o].some((H,z)=>{if(j.payloadType===H.payloadType&&JSON.stringify(j)===JSON.stringify(H))return A.push(z),!0})?b[o].push(j):p[o].push(j)}),void i[o].forEach((j,H)=>{A.indexOf(H)===-1&&g[o].push(j)})}}function pP(l){const{send:i,recv:o,sendrecv:p}=l;if(!p){if(!i||!o)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:i,recv:o}}let g,b;return i?(g={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},g.audioCodecs=[...i.audioCodecs,...p.audioCodecs],g.videoCodecs=[...i.videoCodecs,...p.videoCodecs],g.audioExtensions=[...i.audioExtensions,...p.audioExtensions],g.videoExtensions=[...i.videoExtensions,...p.videoExtensions]):g=p,o?(b={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},b.audioCodecs=[...o.audioCodecs,...p.audioCodecs],b.videoCodecs=[...o.videoCodecs,...p.videoCodecs],b.audioExtensions=[...o.audioExtensions,...p.audioExtensions],b.videoExtensions=[...o.videoExtensions,...p.videoExtensions]):b=p,{send:g,recv:b}}function wR(l){l.media.mediaType==="audio"&&l.attributes.payloads.filter(i=>{var o;return((o=i.rtpMap)===null||o===void 0?void 0:o.encodingName.toLowerCase())==="opus"}).forEach(i=>{i.fmtp||(i.fmtp={parameters:{}}),i.fmtp.parameters.stereo="1",i.fmtp.parameters["sprop-stereo"]="1"})}function fP(l){l.mediaDescriptions.forEach(i=>{i.media.mediaType!=="video"&&i.media.mediaType!=="audio"||i.attributes.payloads.forEach(o=>{o.rtcpFeedbacks.findIndex(p=>p.type==="rrtr")===-1&&o.rtcpFeedbacks.push({type:"rrtr"})})})}function mP(l,i,o,p){let g=[];if(l===ME.VIDEO){if(nE("H264_PROFILE_LEVEL_ID")&&p==="h264"&&(g=i.videoCodecs.filter(b=>{var A;return VE(A=b.rtpMap&&b.rtpMap.encodingName.toLowerCase()||"").call(A,p)&&b&&b.fmtp&&b.fmtp.parameters["profile-level-id"]===nE("H264_PROFILE_LEVEL_ID")})),!Array.isArray(g)||g.length===0){const b=o.videoCodecs.filter(A=>{var j;return VE(j=A.rtpMap&&A.rtpMap.encodingName.toLowerCase()||"").call(j,p)});b.length!==0&&(g=i.videoCodecs.filter(A=>b.some(j=>j.payloadType===A.payloadType)))}if(nE("USE_PUB_RTX")){const b=g.map(j=>j.payloadType.toString()),A=i.videoCodecs.filter(j=>j.rtpMap&&j.rtpMap.encodingName==="rtx"&&VE(b).call(b,j.fmtp&&j.fmtp.parameters.apt||""));g=[...g,...A]}g.length===0&&(Gi.warning("codec ".concat(p," not included in rtpCapabilities, fallback to default payloads: ").concat(i.videoCodecs[0].rtpMap&&i.videoCodecs[0].rtpMap.encodingName)),g=i.videoCodecs)}else g=i.audioCodecs.filter(b=>{var A;return VE(A=b.rtpMap&&b.rtpMap.encodingName.toLowerCase()||"").call(A,p)}),g.length===0&&(Gi.warning("codec ".concat(p," not included in rtpCapabilities, fallback to opus")),g=i.audioCodecs.filter(b=>{var A;return VE(A=b.rtpMap&&b.rtpMap.encodingName.toLowerCase()||"").call(A,"opus")}));return g}function M5(l,i){var o=Object.keys(l);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(l);i&&(p=p.filter(function(g){return Object.getOwnPropertyDescriptor(l,g).enumerable})),o.push.apply(o,p)}return o}function U5(l){for(var i=1;i<arguments.length;i++){var o=arguments[i]!=null?arguments[i]:{};i%2?M5(Object(o),!0).forEach(function(p){_e(l,p,o[p])}):Object.getOwnPropertyDescriptors?Object.defineProperties(l,Object.getOwnPropertyDescriptors(o)):M5(Object(o)).forEach(function(p){Object.defineProperty(l,p,Object.getOwnPropertyDescriptor(o,p))})}return l}function hT(l){if(Array.isArray(l))return l.map(o=>o);if(!F5(l))return l;const i={};for(const o in l){const p=l[o];F5(p)||Array.isArray(p)?i[o]=hT(p):i[o]=p}return i}function F5(l){return!(typeof l!="object"||Array.isArray(l)||!l)}class T2{constructor(i){_e(this,"input",[]),_e(this,"size",void 0),this.size=i}add(i){this.input.push(i),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return this.input.length===0?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}}const FT={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},m1={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:FT,remoteCandidate:FT}},j5={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0},V5={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},B5={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},G5={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0};function q5(l,i){var o=Object.keys(l);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(l);i&&(p=p.filter(function(g){return Object.getOwnPropertyDescriptor(l,g).enumerable})),o.push.apply(o,p)}return o}function W5(l){for(var i=1;i<arguments.length;i++){var o=arguments[i]!=null?arguments[i]:{};i%2?q5(Object(o),!0).forEach(function(p){_e(l,p,o[p])}):Object.getOwnPropertyDescriptors?Object.defineProperties(l,Object.getOwnPropertyDescriptors(o)):q5(Object(o)).forEach(function(p){Object.defineProperty(l,p,Object.getOwnPropertyDescriptor(o,p))})}return l}class C2{constructor(i,o){_e(this,"onFirstVideoReceived",void 0),_e(this,"onFirstVideoDecoded",void 0),_e(this,"onFirstAudioReceived",void 0),_e(this,"onFirstVideoDecodedTimeout",void 0),_e(this,"onFirstAudioDecoded",void 0),_e(this,"onSelectedLocalCandidateChanged",void 0),_e(this,"onSelectedRemoteCandidateChanged",void 0),_e(this,"videoIsReady",!1),_e(this,"videoIsReady2",{}),_e(this,"pc",void 0),_e(this,"options",void 0),_e(this,"intervalTimer",void 0),_e(this,"stats",hT(m1)),_e(this,"isFirstVideoReceived",{}),_e(this,"isFirstVideoDecoded",{}),_e(this,"isFirstAudioReceived",{}),_e(this,"isFirstAudioDecoded",{}),_e(this,"isFirstVideoDecodedTimeout",{}),_e(this,"lossRateWindowStats",[]),this.pc=i,this.options=o,this.intervalTimer=window.setInterval(async()=>{this.updateStats()},this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new pE(i=>{i({local:W5({},FT),remote:W5({},FT)})})}setVideoIsReady(i){this.videoIsReady=i}setVideoIsReady2(i,o){this.videoIsReady2[i]=o}getVideoIsReady(i){return this.videoIsReady2[i]||!1}setIsFirstAudioDecoded(i){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(i){this.lossRateWindowStats.push(i),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);const o=this.lossRateWindowStats.length,p=["videoSend","audioSend","videoRecv","audioRecv"];let g=0,b=0,A=0,j=0;for(const H of p)i[H].forEach((z,$)=>{if(!this.lossRateWindowStats[o-1][H][$]||!this.lossRateWindowStats[0][H][$])return;const Vt=this.lossRateWindowStats[o-1][H][$].packets-this.lossRateWindowStats[0][H][$].packets,_r=this.lossRateWindowStats[o-1][H][$].packetsLost-this.lossRateWindowStats[0][H][$].packetsLost;H==="videoSend"||H==="audioSend"?(g+=Vt,A+=_r):(b+=Vt,j+=_r),Number.isNaN(Vt)||Number.isNaN(Vt)?z.packetLostRate=0:z.packetLostRate=Vt<=0||_r<=0?0:_r/(Vt+_r)});i.sendPacketLossRate=g<=0||A<=0?0:A/(g+A),i.recvPacketLossRate=b<=0||j<=0?0:j/(b+j)}}function H5(l,i){var o=Object.keys(l);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(l);i&&(p=p.filter(function(g){return Object.getOwnPropertyDescriptor(l,g).enumerable})),o.push.apply(o,p)}return o}function jet(l){for(var i=1;i<arguments.length;i++){var o=arguments[i]!=null?arguments[i]:{};i%2?H5(Object(o),!0).forEach(function(p){_e(l,p,o[p])}):Object.getOwnPropertyDescriptors?Object.defineProperties(l,Object.getOwnPropertyDescriptors(o)):H5(Object(o)).forEach(function(p){Object.defineProperty(l,p,Object.getOwnPropertyDescriptor(o,p))})}return l}class Vet extends C2{constructor(){super(...arguments),_e(this,"_stats",m1),_e(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){const i=await this._getStats(),o=this.statsResponsesToObjects(i);this._stats=hT(m1);const p=o.filter(b=>b.type==="ssrc");this.processSSRCStats(p);const g=o.find(b=>b.type==="VideoBwe");g&&this.processBandwidthStats(g),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(i){this._stats.bitrate={actualEncoded:Number(i.googActualEncBitrate),targetEncoded:Number(i.googTargetEncBitrate),retransmit:Number(i.googRetransmitBitrate),transmit:Number(i.googTransmitBitrate)},this._stats.sendBandwidth=Number(i.googAvailableSendBandwidth)}processSSRCStats(i){i.forEach(o=>{var p;const g=VE(p=o.id).call(p,"send");switch("".concat(o.mediaType,"_").concat(g?"send":"recv")){case"video_send":{const b=hT(V5);b.codec=o.googCodecName,b.adaptionChangeReason="none",o.googCpuLimitedResolution&&(b.adaptionChangeReason="cpu"),o.googBandwidthLimitedResolution&&(b.adaptionChangeReason="bandwidth"),b.avgEncodeMs=Number(o.googAvgEncodeMs),b.inputFrame={width:Number(o.googFrameWidthInput)||Number(o.googFrameWidthSent),height:Number(o.googFrameHeightInput)||Number(o.googFrameHeightSent),frameRate:Number(o.googFrameRateInput)},b.sentFrame={width:Number(o.googFrameWidthSent),height:Number(o.googFrameHeightSent),frameRate:Number(o.googFrameRateInput)},b.firsCount=Number(o.googFirReceived),b.nacksCount=Number(o.googNacksReceived),b.plisCount=Number(o.googPlisReceived),b.frameCount=Number(o.framesEncoded),b.bytes=Number(o.bytesSent),b.packets=Number(o.packetsSent),b.packetsLost=Number(o.packetsLost),b.ssrc=Number(o.ssrc),b.rttMs=Number(o.googRtt||0),this._stats.videoSend.push(b),this._stats.rtt=b.rttMs;break}case"video_recv":{const b=hT(j5),A=this.lastDecodeVideoReceiverStats.get(Number(o.ssrc));if(b.codec=o.googCodecName,b.targetDelayMs=Number(o.googTargetDelayMs),b.renderDelayMs=Number(o.googRenderDelayMs),b.currentDelayMs=Number(o.googCurrentDelayMs),b.minPlayoutDelayMs=Number(o.googMinPlayoutDelayMs),b.decodeMs=Number(o.googDecodeMs),b.maxDecodeMs=Number(o.googMaxDecodeMs),b.receivedFrame={width:Number(o.googFrameWidthReceived),height:Number(o.googFrameHeightReceived),frameRate:Number(o.googFrameRateReceived)},b.decodedFrame={width:Number(o.googFrameWidthReceived),height:Number(o.googFrameHeightReceived),frameRate:Number(o.googFrameRateDecoded)},b.decodeFrameRate=Number(o.googFrameRateDecoded),b.outputFrame={width:Number(o.googFrameWidthReceived),height:Number(o.googFrameHeightReceived),frameRate:Number(o.googFrameRateOutput)},b.jitterBufferMs=Number(o.googJitterBufferMs),b.firsCount=Number(o.googFirsSent),b.nacksCount=Number(o.googNacksSent),b.plisCount=Number(o.googPlisSent),b.framesDecodeCount=Number(o.framesDecoded),b.bytes=Number(o.bytesReceived),b.packets=Number(o.packetsReceived),b.packetsLost=Number(o.packetsLost),b.ssrc=Number(o.ssrc),b.packets>0&&!this.isFirstVideoReceived[b.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(b.ssrc),this.isFirstVideoReceived[b.ssrc]=!0),b.framesDecodeCount>0&&!this.isFirstVideoDecoded[b.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(b.ssrc,b.decodedFrame.width,b.decodedFrame.height),this.isFirstVideoDecoded[b.ssrc]=!0),A){const j=A.stats,H=Date.now()-A.lts;b.framesDecodeFreezeTime=j.framesDecodeFreezeTime,b.framesDecodeInterval=j.framesDecodeInterval,b.framesDecodeCount>j.framesDecodeCount&&this.isFirstVideoDecoded[b.ssrc]?(A.lts=Date.now(),b.framesDecodeInterval=H,b.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(o.ssrc,10))?b.framesDecodeFreezeTime+=b.framesDecodeInterval:this.setVideoIsReady2(parseInt(o.ssrc,10),!0))):b.framesDecodeCount<A.stats.framesDecodeCount&&(b.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(b.ssrc,{stats:jet({},b),lts:Date.now()}),this._stats.videoRecv.push(b);break}case"audio_recv":{const b=hT(G5);b.codec=o.googCodecName,b.outputLevel=Math.abs(Number(o.audioOutputLevel))/32767,b.decodingCNG=Number(o.googDecodingCNG),b.decodingCTN=Number(o.googDecodingCTN),b.decodingCTSG=Number(o.googDecodingCTSG),b.decodingNormal=Number(o.googDecodingNormal),b.decodingPLC=Number(o.googDecodingPLC),b.decodingPLCCNG=Number(o.googDecodingPLCCNG),b.expandRate=Number(o.googExpandRate),b.accelerateRate=Number(o.googAccelerateRate),b.preemptiveExpandRate=Number(o.googPreemptiveExpandRate),b.secondaryDecodedRate=Number(o.googSecondaryDecodedRate),b.speechExpandRate=Number(o.googSpeechExpandRate),b.preferredJitterBufferMs=Number(o.googPreferredJitterBufferMs),b.jitterBufferMs=Number(o.googJitterBufferMs),b.jitterMs=Number(o.googJitterReceived),b.bytes=Number(o.bytesReceived),b.packets=Number(o.packetsReceived),b.packetsLost=Number(o.packetsLost),b.ssrc=Number(o.ssrc),b.receivedFrames=Number(o.googDecodingCTN)||Number(o.packetsReceived),b.droppedFrames=Number(o.googDecodingPLC)+Number(o.googDecodingPLCCNG)||Number(o.packetsLost),b.receivedFrames>0&&!this.isFirstAudioReceived[b.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(b.ssrc),this.isFirstAudioReceived[b.ssrc]=!0),b.decodingNormal>0&&!this.isFirstAudioDecoded[b.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(b.ssrc),this.isFirstAudioDecoded[b.ssrc]=!0),this._stats.audioRecv.push(b);break}case"audio_send":{const b=hT(B5);b.codec=o.googCodecName,b.inputLevel=Math.abs(Number(o.audioInputLevel))/32767,b.aecReturnLoss=Number(o.googEchoCancellationReturnLoss||0),b.aecReturnLossEnhancement=Number(o.googEchoCancellationReturnLossEnhancement||0),b.residualEchoLikelihood=Number(o.googResidualEchoLikelihood||0),b.residualEchoLikelihoodRecentMax=Number(o.googResidualEchoLikelihoodRecentMax||0),b.bytes=Number(o.bytesSent),b.packets=Number(o.packetsSent),b.packetsLost=Number(o.packetsLost),b.ssrc=Number(o.ssrc),b.rttMs=Number(o.googRtt||0),this._stats.rtt=b.rttMs,this._stats.audioSend.push(b);break}}})}_getStats(){return new pE((i,o)=>{this.pc.getStats(i,o)})}statsResponsesToObjects(i){const o=[];return i.result().forEach(p=>{const g={id:p.id,timestamp:p.timestamp.valueOf().toString(),type:p.type};p.names().forEach(b=>{g[b]=p.stat(b)}),o.push(g)}),o}}function z5(l,i){var o=Object.keys(l);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(l);i&&(p=p.filter(function(g){return Object.getOwnPropertyDescriptor(l,g).enumerable})),o.push.apply(o,p)}return o}function EI(l){for(var i=1;i<arguments.length;i++){var o=arguments[i]!=null?arguments[i]:{};i%2?z5(Object(o),!0).forEach(function(p){_e(l,p,o[p])}):Object.getOwnPropertyDescriptors?Object.defineProperties(l,Object.getOwnPropertyDescriptors(o)):z5(Object(o)).forEach(function(p){Object.defineProperty(l,p,Object.getOwnPropertyDescriptor(o,p))})}return l}class K5 extends C2{constructor(){super(...arguments),_e(this,"_stats",m1),_e(this,"report",void 0),_e(this,"lastDecodeVideoReceiverStats",new Map),_e(this,"lastVideoFramesRecv",new Map),_e(this,"lastVideoFramesSent",new Map),_e(this,"lastVideoFramesDecode",new Map),_e(this,"lastVideoJBDelay",new Map),_e(this,"lastAudioJBDelay",new Map),_e(this,"mediaBytesSent",new Map),_e(this,"mediaBytesRetransmit",new Map),_e(this,"mediaBytesTargetEncode",new Map),_e(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=hT(m1),this.report.forEach(i=>{switch(i.type){case cS.OUTBOUND:case cS.INBOUND:{const o=i.mediaType||i.kind,p=!o&&"frameWidth"in i,g=!o&&!("frameWidth"in i);i.type===cS.OUTBOUND?o==="audio"||g?this.processAudioOutboundStats(i):(o==="video"||p)&&this.processVideoOutboundStats(i):i.type===cS.INBOUND&&(o==="audio"||g?this.processAudioInboundStats(i):(o==="video"||p)&&this.processVideoInboundStats(i));break}case cS.TRANSPORT:{const o=this.report.get(i.selectedCandidatePairId);o&&this.processCandidatePairStats(o);break}case cS.CANDIDATE_PAIR:i.selected&&this.processCandidatePairStats(i)}}),this.updateSendBitrate(),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){const i=await this.pc.getStats(),o={local:EI({},FT),remote:EI({},FT)};return i.forEach(p=>{let g;if(p.type===cS.TRANSPORT&&(g=i.get(p.selectedCandidatePairId)),p.type===cS.CANDIDATE_PAIR&&p.selected&&(g=p),g){const b=(A,j)=>{A.type=j.type,A.id=j.id,j.address&&(A.address=j.address),j.candidateType&&(A.candidateType=j.candidateType),j.port&&(A.port=j.port),j.priority&&(A.priority=j.priority),j.protocol&&(A.protocol=j.protocol),j.relayProtocol&&(A.relayProtocol=j.relayProtocol)};if(g.localCandidateId){const A=i.get(g.localCandidateId);A&&b(o.local,A)}if(g.remoteCandidateId){const A=i.get(g.remoteCandidateId);A&&b(o.remote,A)}}}),o}processCandidatePairStats(i){if(this._stats.sendBandwidth=i.availableOutgoingBitrate||0,i.currentRoundTripTime&&(this._stats.rtt=1e3*i.currentRoundTripTime),this._stats.videoSend.forEach(o=>{i.currentRoundTripTime&&(o.rttMs=1e3*i.currentRoundTripTime)}),this._stats.audioSend.forEach(o=>{i.currentRoundTripTime&&(o.rttMs=1e3*i.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=i.id,i.localCandidateId){const o=this.report.get(i.localCandidateId);o&&this.processCandidateStats(o)}if(i.remoteCandidateId){const o=this.report.get(i.remoteCandidateId);o&&this.processCandidateStats(o)}}processCandidateStats(i){let o;i.type===cS.LOCAL_CANDIDATE&&(o=this._stats.selectedCandidatePair.localCandidate),i.type===cS.REMOTE_CANDIDATE&&(o=this._stats.selectedCandidatePair.remoteCandidate),o&&(o.type=i.type,o.id=i.id,i.address&&(o.address=i.address),i.candidateType&&(o.candidateType=i.candidateType),i.port&&(o.port=i.port),i.priority&&(o.priority=i.priority),i.protocol&&(o.protocol=i.protocol),i.relayProtocol&&(o.relayProtocol=i.relayProtocol),i.type===cS.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==o.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(EI({},o),EI({},this.stats.selectedCandidatePair.localCandidate)),i.type===cS.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==o.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(EI({},o),EI({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(i){let o=this._stats.audioRecv.find(p=>p.ssrc===i.ssrc);o||(o=hT(G5),this._stats.audioRecv.push(o)),o.ssrc=i.ssrc,o.packets=i.packetsReceived,o.packetsLost=i.packetsLost,o.bytes=i.bytesReceived,o.jitterMs=1e3*i.jitter,this.processAudioTrackReceiverStats(i,i.trackId,o),i.codecId&&(o.codec=this.getCodecFromCodecStats(i.codecId)),o.receivedFrames||(o.receivedFrames=i.packetsReceived),o.droppedFrames||(o.droppedFrames=i.packetsLost),o.receivedFrames>0&&!this.isFirstAudioReceived[o.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(o.ssrc),this.isFirstAudioReceived[o.ssrc]=!0),o.outputLevel&&o.outputLevel>0&&!this.isFirstAudioDecoded[o.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(o.ssrc),this.isFirstAudioDecoded[o.ssrc]=!0),typeof i.concealedSamples=="number"&&(o.concealedSamples=i.concealedSamples)}processVideoInboundStats(i){let o=this._stats.videoRecv.find(A=>A.ssrc===i.ssrc);o||(o=hT(j5),this._stats.videoRecv.push(o)),o.ssrc=i.ssrc,o.packets=i.packetsReceived,o.packetsLost=i.packetsLost,o.bytes=i.bytesReceived,o.firsCount=i.firCount,o.nacksCount=i.nackCount,o.plisCount=i.pliCount,o.framesDecodeCount=i.framesDecoded,o.totalInterFrameDelay=i.totalInterFrameDelay,o.totalSquaredInterFrameDelay=i.totalSquaredInterFrameDelay;const p=this.lastDecodeVideoReceiverStats.get(o.ssrc),g=this.lastVideoFramesDecode.get(o.ssrc),b=Date.now();if(o.framesDecodeCount>0&&!this.isFirstVideoDecoded[o.ssrc]){const A=o.decodedFrame?o.decodedFrame.width:0,j=o.decodedFrame?o.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(o.ssrc,A,j),this.isFirstVideoDecoded[o.ssrc]=!0}if(p){const A=p.stats,j=b-p.lts;o.framesDecodeFreezeTime=A.framesDecodeFreezeTime,o.framesDecodeInterval=A.framesDecodeInterval,!this.isFirstVideoDecoded[o.ssrc]&&j>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[o.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(o.ssrc),this.isFirstVideoDecodedTimeout[o.ssrc]=!0),o.framesDecodeCount>A.framesDecodeCount&&this.isFirstVideoDecoded[o.ssrc]?(p.lts=Date.now(),o.framesDecodeInterval=j,o.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(i.ssrc))?o.framesDecodeFreezeTime+=o.framesDecodeInterval:this.setVideoIsReady2(parseInt(i.ssrc,10),!0))):o.framesDecodeCount<A.framesDecodeCount&&(o.framesDecodeInterval=0),i.framesDecoded&&i.qpSum&&(p.stats.framesDecodeCount>i.framesDecoded?o.qpSumPerFrame=i.qpSum/i.framesDecoded:o.qpSumPerFrame=(i.qpSum-p.qpSum)/(i.framesDecoded-p.stats.framesDecodeCount))}g&&b-g.lts>=800?(o.decodeFrameRate=Math.round((o.framesDecodeCount-g.count)/((b-g.lts)/1e3)),this.lastVideoFramesDecode.set(o.ssrc,{count:o.framesDecodeCount,lts:b,rate:o.decodeFrameRate})):g?o.decodeFrameRate=g.rate:this.lastVideoFramesDecode.set(o.ssrc,{count:o.framesDecodeCount,lts:b,rate:0}),i.totalDecodeTime&&(o.decodeMs=1e3*i.totalDecodeTime),this.processVideoTrackReceiverStats(i,i.trackId,o),i.codecId&&(o.codec=this.getCodecFromCodecStats(i.codecId)),i.framerateMean&&(o.framesRateFirefox=i.framerateMean),o.packets>0&&!this.isFirstVideoReceived[o.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(o.ssrc),this.isFirstVideoReceived[o.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(o.ssrc,{stats:EI({},o),lts:p?p.lts:Date.now(),qpSum:i.qpSum})}processVideoOutboundStats(i){let o=this._stats.videoSend.find(g=>g.ssrc===i.ssrc);o||(o=hT(V5),this._stats.videoSend.push(o));const p=this.mediaBytesSent.get(i.ssrc);if(p)p.add(i.bytesSent);else{const g=new T2(10);g.add(i.bytesSent),this.mediaBytesSent.set(i.ssrc,g)}if(i.retransmittedBytesSent!==void 0){const g=this.mediaBytesRetransmit.get(i.ssrc);if(g)g.add(i.retransmittedBytesSent);else{const b=new T2(10);b.add(i.retransmittedBytesSent),this.mediaBytesRetransmit.set(i.ssrc,b)}}if(i.totalEncodedBytesTarget){const g=this.mediaBytesTargetEncode.get(i.ssrc);if(g)g.add(i.totalEncodedBytesTarget);else{const b=new T2(10);b.add(i.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(i.ssrc,b)}}if(o.ssrc=i.ssrc,o.bytes=i.bytesSent,o.packets=i.packetsSent,o.firsCount=i.firCount,o.nacksCount=i.nackCount,o.plisCount=i.pliCount,o.frameCount=i.framesEncoded,o.adaptionChangeReason=i.qualityLimitationReason,o.scalabilityMode=i.scalabilityMode,i.totalEncodeTime&&i.framesEncoded){const g=this.lastEncoderMs.get(i.ssrc);if(!g||g.lastFrameCount>i.framesEncoded)o.avgEncodeMs=1e3*i.totalEncodeTime/i.framesEncoded;else{const b=i.framesEncoded-g.lastFrameCount,A=i.totalEncodeTime-g.lastEncoderTime;o.avgEncodeMs=1e3*A/b}}if(i.framesEncoded&&i.qpSum){const g=this.lastEncoderMs.get(i.ssrc);!g||g.lastFrameCount>i.framesEncoded?o.qpSumPerFrame=i.qpSum/i.framesEncoded:o.qpSumPerFrame=(i.qpSum-g.lastQpSum)/(i.framesEncoded-g.lastFrameCount)}if(this.lastEncoderMs.set(i.ssrc,{lastFrameCount:i.framesEncoded,lastEncoderTime:i.totalEncodeTime,lastQpSum:i.qpSum,lts:Date.now()}),i.codecId&&(o.codec=this.getCodecFromCodecStats(i.codecId)),i.mediaSourceId&&this.processVideoMediaSource(i.mediaSourceId,o),this.processVideoTrackSenderStats(i,i.trackId,o),i.remoteId)this.processRemoteInboundStats(i.remoteId,o);else{const g=this.findRemoteStatsId(i.ssrc,cS.REMOTE_INBOUND);g&&this.processRemoteInboundStats(g,o)}}processAudioOutboundStats(i){let o=this._stats.audioSend.find(p=>p.ssrc===i.ssrc);if(o||(o=hT(B5),this._stats.audioSend.push(o)),o.ssrc=i.ssrc,o.packets=i.packetsSent,o.bytes=i.bytesSent,i.mediaSourceId&&this.processAudioMediaSource(i.mediaSourceId,o),i.codecId&&(o.codec=this.getCodecFromCodecStats(i.codecId)),this.processAudioTrackSenderStats(i,i.trackId,o),i.remoteId)this.processRemoteInboundStats(i.remoteId,o);else{const p=this.findRemoteStatsId(i.ssrc,cS.REMOTE_INBOUND);p&&this.processRemoteInboundStats(p,o)}}findRemoteStatsId(i,o){var p;const g=Array.from(OT(p=this.report).call(p)).find(b=>b.type===o&&b.ssrc===i);return g?g.id:null}processVideoMediaSource(i,o){const p=this.report.get(i);p&&p.width&&p.height&&p.framesPerSecond&&(o.inputFrame={width:p.width,height:p.height,frameRate:p.framesPerSecond})}processAudioMediaSource(i,o){const p=this.report.get(i);p&&(o.inputLevel=p.audioLevel)}processVideoTrackSenderStats(i,o,p){var g,b,A,j;const H=o?this.report.get(o):void 0,z=(g=H==null?void 0:H.framesSent)!==null&&g!==void 0?g:i.framesSent;if(typeof z!="number")return;let $=(b=H==null?void 0:H.frameWidth)!==null&&b!==void 0?b:i.frameWidth,Vt=(A=H==null?void 0:H.frameHeight)!==null&&A!==void 0?A:i.frameHeight,_r=(j=H==null?void 0:H.framesPerSecond)!==null&&j!==void 0?j:i.framesPerSecond;if(typeof $=="number"&&typeof Vt=="number"||($=0,Vt=0),_r==null){const Fi=Date.now(),_l=this.lastVideoFramesSent.get(p.ssrc);_l&&Fi-_l.lts>=800?(_r=Math.round((z-_l.count)/((Fi-_l.lts)/1e3)),this.lastVideoFramesSent.set(p.ssrc,{count:z,lts:Fi,rate:_r})):_l?_r=_l.rate:this.lastVideoFramesSent.set(p.ssrc,{count:z,lts:Fi,rate:0})}p.sentFrame={width:$,height:Vt,frameRate:Math.max(0,_r)}}processVideoTrackReceiverStats(i,o,p){var g,b,A,j,H;const z=o?this.report.get(o):void 0,$=(g=z==null?void 0:z.framesReceived)!==null&&g!==void 0?g:i.framesReceived,Vt=(b=z==null?void 0:z.frameWidth)!==null&&b!==void 0?b:i.frameWidth,_r=(A=z==null?void 0:z.frameHeight)!==null&&A!==void 0?A:i.frameHeight,Fi=(j=z==null?void 0:z.jitterBufferDelay)!==null&&j!==void 0?j:i.jitterBufferDelay,_l=(H=z==null?void 0:z.jitterBufferEmittedCount)!==null&&H!==void 0?H:i.jitterBufferEmittedCount;if(typeof $=="number"){const _u=this.lastVideoFramesRecv.get(p.ssrc),_h=Date.now();p.framesReceivedCount=$;let _g=0;_u&&_h-_u.lts>=800?(_g=Math.round(($-_u.count)/((_h-_u.lts)/1e3)),this.lastVideoFramesRecv.set(p.ssrc,{count:$,lts:_h,rate:_g})):_u?_g=_u.rate:this.lastVideoFramesRecv.set(p.ssrc,{count:$,lts:_h,rate:0}),p.receivedFrame={width:Vt||0,height:_r||0,frameRate:_g||0},p.decodedFrame={width:Vt||0,height:_r||0,frameRate:p.decodeFrameRate||0},p.outputFrame={width:Vt||0,height:_r||0,frameRate:p.decodeFrameRate||0}}if(Fi&&_l){const _u=this.lastVideoJBDelay.get(p.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let _h=_u.jitterBufferMs;const _g=_l-_u.jitterBufferEmittedCount;_g>0&&(_h=1e3*(Fi-_u.jitterBufferDelay)/_g),p.jitterBufferMs=_h,p.currentDelayMs=Math.round(_h),this.lastVideoJBDelay.set(p.ssrc,{jitterBufferDelay:Fi,jitterBufferEmittedCount:_l,jitterBufferMs:p.currentDelayMs})}}processAudioTrackSenderStats(i,o,p){var g,b,A,j;const H=o?this.report.get(o):void 0,z=(g=(b=H==null?void 0:H.echoReturnLoss)!==null&&b!==void 0?b:i.echoReturnLoss)!==null&&g!==void 0?g:0,$=(A=(j=H==null?void 0:H.echoReturnLossEnhancement)!==null&&j!==void 0?j:i.echoReturnLossEnhancement)!==null&&A!==void 0?A:0;p.aecReturnLoss=z,p.aecReturnLossEnhancement=$}processAudioTrackReceiverStats(i,o,p){var g,b,A,j,H,z,$;const Vt=o?this.report.get(o):void 0,_r=(g=Vt==null?void 0:Vt.removedSamplesForAcceleration)!==null&&g!==void 0?g:i.removedSamplesForAcceleration,Fi=(b=Vt==null?void 0:Vt.totalSamplesReceived)!==null&&b!==void 0?b:i.totalSamplesReceived,_l=(A=Vt==null?void 0:Vt.jitterBufferDelay)!==null&&A!==void 0?A:i.jitterBufferDelay,_u=(j=Vt==null?void 0:Vt.jitterBufferEmittedCount)!==null&&j!==void 0?j:i.jitterBufferEmittedCount,_h=(H=Vt==null?void 0:Vt.audioLevel)!==null&&H!==void 0?H:i==null?void 0:i.audioLevel,_g=(z=Vt==null?void 0:Vt.totalSamplesDuration)!==null&&z!==void 0?z:i==null?void 0:i.totalSamplesDuration,eE=($=Vt==null?void 0:Vt.concealedSamples)!==null&&$!==void 0?$:i.concealedSamples;if(_r&&Fi&&(p.accelerateRate=_r/Fi),_l&&_u){const SE=this.lastAudioJBDelay.get(p.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let vE=SE.jitterBufferMs;const fE=_u-SE.jitterBufferEmittedCount;fE>0&&(vE=1e3*(_l-SE.jitterBufferDelay)/fE),p.jitterBufferMs=Math.round(vE),this.lastAudioJBDelay.set(p.ssrc,{jitterBufferDelay:_l,jitterBufferEmittedCount:_u,jitterBufferMs:p.jitterBufferMs})}p.outputLevel=_h;let oE=1920;_g&&Fi&&(oE=Fi/_g/50,p.receivedFrames=Math.round(Fi/oE)),eE&&(p.droppedFrames=Math.round(eE/oE))}processRemoteInboundStats(i,o){const p=this.report.get(i);p&&(o.packetsLost=p.packetsLost,p.roundTripTime&&(o.rttMs=1e3*p.roundTripTime),p.jitter&&(o.jitterMs=1e3*p.jitter),p.timestamp&&(o.timestamp=p.timestamp))}getCodecFromCodecStats(i){const o=this.report.get(i);if(!o)return"";const p=o.mimeType.match(/\/(.*)$/);return p&&p[1]?p[1]:""}updateSendBitrate(){let i=0,o=null,p=null;this.mediaBytesSent.forEach(b=>{i+=b.diffMean()}),this.mediaBytesRetransmit.forEach(b=>{o=o===null?b.diffMean():o+b.diffMean()}),this.mediaBytesTargetEncode.forEach(b=>{p=p===null?b.diffMean():p+b.diffMean()});const g=o!==null?i-o:i;this._stats.bitrate={actualEncoded:8*g/(this.options.updateInterval/1e3),transmit:8*i/(this.options.updateInterval/1e3)},o!==null&&(this._stats.bitrate.retransmit=8*o/(this.options.updateInterval/1e3)),p!==null&&(this._stats.bitrate.targetEncoded=8*p/(this.options.updateInterval/1e3))}}class Bet extends C2{updateStats(){return pE.resolve()}}function gP(l){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:250,o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:8,p=arguments.length>3&&arguments[3]!==void 0?arguments[3]:500,g=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1e4;const b=function(){const A=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return A&&A[0]?Number(A[0].split("/")[1]):null}();return b?b<76?new Vet(l,{updateInterval:i,lossRateInterval:o,freezeRateLimit:p,firstVideoDecodedTimeout:g}):new K5(l,{updateInterval:i,lossRateInterval:o,freezeRateLimit:p,firstVideoDecodedTimeout:g}):function(A){return!!window.RTCStatsReport&&A.getStats()instanceof pE}(l)?new K5(l,{updateInterval:i,lossRateInterval:o,freezeRateLimit:p,firstVideoDecodedTimeout:g}):new Bet(l,{updateInterval:i,lossRateInterval:o,freezeRateLimit:p,firstVideoDecodedTimeout:g})}function Y5(l,i){var o=Object.keys(l);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(l);i&&(p=p.filter(function(g){return Object.getOwnPropertyDescriptor(l,g).enumerable})),o.push.apply(o,p)}return o}function J5(l){for(var i=1;i<arguments.length;i++){var o=arguments[i]!=null?arguments[i]:{};i%2?Y5(Object(o),!0).forEach(function(p){_e(l,p,o[p])}):Object.getOwnPropertyDescriptors?Object.defineProperties(l,Object.getOwnPropertyDescriptors(o)):Y5(Object(o)).forEach(function(p){Object.defineProperty(l,p,Object.getOwnPropertyDescriptor(o,p))})}return l}class b0 extends ON{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}constructor(i,o){super(i,o),_e(this,"store",void 0),_e(this,"peerConnection",void 0),_e(this,"remoteSDP",void 0),_e(this,"initialOffer",void 0),_e(this,"statsFilter",void 0),_e(this,"useRTX",!1),_e(this,"localCapabilities",void 0),_e(this,"localCandidateCount",0),_e(this,"allCandidatesReceived",!1),_e(this,"establishPromise",void 0),_e(this,"mutex",new E0("P2PConnection-mutex")),this.store=o,this.peerConnection=new RTCPeerConnection(b0.resolvePCConfiguration(i),{optional:[{googDscp:!0}]}),this.statsFilter=gP(this.peerConnection,nE("STATS_UPDATE_INTERVAL"),void 0,N_()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{const i=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!i.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const o=mI(i.sdp),p=_2(i.sdp,{filterRTX:!this.useRTX,filterVideoFec:nE("FILTER_VIDEO_FEC"),filterAudioFec:nE("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return this.localCapabilities=p,this.initialOffer=i,J5(J5({},o),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:p},offerSDP:i.sdp})}catch(i){throw new yE(_p.GET_LOCAL_CONNECTION_PARAMS_FAILED,i.toString())}}async connect(i,o,p,g,b,A){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new class{constructor(H){_e(this,"sessionDesc",void 0),_e(this,"localCapabilities",void 0),_e(this,"rtpCapabilities",void 0),_e(this,"candidates",void 0),_e(this,"iceParameters",void 0),_e(this,"dtlsParameters",void 0),_e(this,"setup",void 0),_e(this,"currentMidIndex",void 0),_e(this,"cname",void 0),H=Q_(H);const{remoteIceParameters:z,remoteDtlsParameters:$,candidates:Vt,remoteRTPCapabilities:_r,remoteSetup:Fi,localCapabilities:_l,sdkCodec:_u,cname:_h}=H,_g=q_.parse(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE audio video
a=msid-semantic: WMS
a=ice-lite
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:audio
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:video
`);this.rtpCapabilities=_r,this.candidates=Vt,this.iceParameters=z,this.dtlsParameters=$,this.setup=Fi,this.localCapabilities=_l,this.cname=_h;for(let eE=0;eE<_g.mediaDescriptions.length;eE++){const oE=_g.mediaDescriptions[eE];if(oE.attributes.iceUfrag=z.iceUfrag,oE.attributes.icePwd=z.icePwd,oE.attributes.fingerprints=$.fingerprints,oE.attributes.candidates=Vt,oE.attributes.setup=Fi,oE.media.mediaType==="video"){oE.media.fmts=_r.videoCodecs.map(vE=>vE.payloadType.toString(10));let SE=_r.videoCodecs.filter(vE=>{var fE,mE;return(fE=vE.rtpMap)===null||fE===void 0?void 0:VE(mE=fE.encodingName.toLowerCase()).call(mE,_u)});SE.length===0&&(SE=_r.videoCodecs),oE.attributes.payloads=SE,oE.attributes.extmaps=_r.videoExtensions}oE.media.mediaType==="audio"&&(oE.media.fmts=_r.audioCodecs.map(SE=>SE.payloadType.toString(10)),oE.attributes.payloads=_r.audioCodecs,oE.attributes.extmaps=_r.audioExtensions),_g.mediaDescriptions[eE]=this.mungMediaDesc(oE)}this.sessionDesc=_g,this.currentMidIndex=_g.mediaDescriptions.length-1}toString(){return q_.print(this.sessionDesc)}send(H,z,$){const{ssrcs:Vt,ssrcGroups:_r}=XS(z,this.cname),Fi=this.sessionDesc.mediaDescriptions.find(_h=>H===ME.VIDEO?_h.media.mediaType==="video":_h.media.mediaType==="audio"),_l=Vt[0].attributes.label,_u=Vt[0].attributes.mslabel;return Fi.attributes.ssrcs=Fi.attributes.ssrcs.concat(Vt),Fi.attributes.ssrcGroups=Fi.attributes.ssrcGroups.concat(_r),{id:_l,mslabel:_u}}batchSend(H){return H.map(z=>{let{kind:$,ssrcMsg:Vt}=z;return this.send($,Vt,void 0)})}stopSending(H){this.sessionDesc.mediaDescriptions.forEach(z=>{const $=[],Vt=[],_r=[];z.attributes.ssrcs.forEach(Fi=>{VE(H).call(H,Fi.attributes.label||"")?_r.push(Fi):$.push(Fi)}),z.attributes.ssrcGroups.forEach(Fi=>{var _l;VE(_l=_r.map(_u=>_u.ssrcId)).call(_l,Fi.ssrcIds[0])||Vt.push(Fi)}),z.attributes.ssrcs=$,z.attributes.ssrcGroups=Vt})}mute(H){const z=this.sessionDesc.mediaDescriptions.find($=>$.attributes.mid===H);if(!z)throw new Error("mediaDescription not found with ".concat(H," in remote SDP when calling RemoteSDP.mute."));z.attributes.direction="inactive"}unmute(H){const z=this.sessionDesc.mediaDescriptions.find($=>$.attributes.mid===H);if(!z)throw new Error("mediaDescription not found with ".concat(H," in remote SDP when calling RemoteSDP.unmute."));z.attributes.direction="sendonly"}receive(H,z,$){H.forEach((Vt,_r)=>{const Fi=Vt._mediaStreamTrack,_l=this.sessionDesc.mediaDescriptions.findIndex(_h=>_h.attributes.mid===Fi.kind),_u=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[_l],Vt);this.sessionDesc.mediaDescriptions[_l]=_u})}stopReceiving(H){}updateCandidates(H){H===N0.TCP?this.candidates.forEach(z=>{this.candidates.findIndex($=>$.transport==="tcp"&&$.connectionAddress===z.connectionAddress&&$.port===z.port)===-1&&this.candidates.push(U5(U5({},z),{},{foundation:"tcpcandidate",priority:Number(z.priority)-1+"",transport:"tcp",port:Number(z.port)+90+""}))}):this.candidates=this.candidates.filter(z=>z.transport!=="tcp");for(const z of this.sessionDesc.mediaDescriptions)z.attributes.candidates=this.candidates}restartICE(H){H=Q_(H),this.iceParameters=H,this.sessionDesc.mediaDescriptions.forEach(z=>{z.attributes.iceUfrag=H.iceUfrag,z.attributes.icePwd=H.icePwd})}predictReceivingMids(H){const z=[];for(let $=0;$<H;$++)z.push((this.currentMidIndex+$+1).toString(10));return z}mungRecvMediaDsec(H,z){const $=Q_(H);return gI($,z),b2($,z),$}updateRecvMedia(H,z){const $=this.sessionDesc.mediaDescriptions.findIndex(Vt=>Vt.attributes.mid===H);if($!==-1){const Vt=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[$],z);this.sessionDesc.mediaDescriptions[$]=Vt}}bumpMid(H){this.currentMidIndex+=H}updateTrackLabel(H,z,$){const Vt=this.sessionDesc.mediaDescriptions.find(Fi=>H===ME.VIDEO?Fi.attributes.mid==="video":Fi.attributes.mid==="audio");if(Vt){const Fi=Vt.attributes.ssrcs.find(_l=>_l.attributes.label===z);var _r;Fi&&(Fi.attributes.label=$,(_r=Fi.attributes.msid)===null||_r===void 0||_r.replace(z,$))}}mungMediaDesc(H){const z=Q_(H);return y2(z),function($){const Vt=$.attributes.extmaps.find(_r=>_r.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01");Vt&&$.attributes.extmaps.splice($.attributes.extmaps.indexOf(Vt),1),$.attributes.payloads.forEach(_r=>{const Fi=_r.rtcpFeedbacks.findIndex(_l=>_l.type==="transport-cc");Fi!==-1&&_r.rtcpFeedbacks.splice(Fi,1)})}(z),z}getSSRC(H){for(const z of this.sessionDesc.mediaDescriptions)for(const $ of z.attributes.ssrcs)if($.attributes.label===H)return[$]}}({remoteIceParameters:i,remoteDtlsParameters:o,candidates:p,remoteRTPCapabilities:g.send,remoteSetup:b,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec,cname:A});const j=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:j})}catch(j){throw new yE(_p.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(j.toString()))}}async updateRemoteRTPCapabilities(i,o){throw new yE(_p.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}send(i,o){var p=this;return JS(function*(){const g=yield d_(p.mutex.lock());try{if(!p.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const b=i.map(_r=>p.peerConnection.addTrack(_r._mediaStreamTrack)),A=yield d_(p.peerConnection.createOffer()),j=q_.parse(A.sdp),H=i.map(_r=>{const Fi=_r._mediaStreamTrack,_l=j.mediaDescriptions.find(_u=>_u.attributes.mid===Fi.kind);if(!_l)throw new Error("Cannot extract ssrc from mediaDescription.");return function(_u,_h,_g){const eE=_u.attributes.ssrcs.filter(SE=>SE.attributes.label===_h),oE=_u.attributes.ssrcGroups;if(eE.length===0)throw new Error("Cannot extract ssrc from plan-b SDP.");if(oE&&eE.length>1){const SE=oE.find(vE=>vE.ssrcIds.indexOf(eE[0].ssrcId)!==-1);return SE?[{ssrcId:SE.ssrcIds[0],rtx:_g?SE.ssrcIds[1]:void 0}]:[{ssrcId:eE[0].ssrcId}]}return[{ssrcId:eE[0].ssrcId}]}(_l,Fi.id,p.useRTX)});let z;try{z=yield H}catch(_r){throw b.forEach(Fi=>{H0()&&Fi.replaceTrack(null),p.peerConnection.removeTrack(Fi)}),_r}const $=p.mungSendOfferSDP(A.sdp,i);p.remoteSDP.receive(i,o,z);const Vt=p.remoteSDP.toString();return yield d_(p.peerConnection.setLocalDescription({type:"offer",sdp:$})),yield d_(p.applySendEncodings(b,i)),yield d_(p.peerConnection.setRemoteDescription({type:"answer",sdp:Vt})),i.map((_r,Fi)=>{const _l=_r._mediaStreamTrack.id;return{localSSRC:H[Fi],id:_l}})}catch(b){throw new yE(_p.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(b.toString()))}finally{g()}})()}async stopSending(i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const o=this.peerConnection.getSenders().filter(b=>{var A;return i.indexOf(((A=b.track)===null||A===void 0?void 0:A.id)||"")!==-1});if(o.length!==i.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");o.map(b=>{H0()&&b.replaceTrack(null),this.peerConnection.removeTrack(b)});const p=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(p),this.remoteSDP.stopReceiving(i);const g=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:g})}catch(o){throw new yE(_p.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(o.toString()))}}async receive(i,o,p,g){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(i," before remoteSDP created."));const{id:b,mslabel:A}=this.remoteSDP.send(i,o,g),j=new pE(($,Vt)=>{const _r=setTimeout(()=>{Vt(new Error("Cannot receive track, id: ".concat(b)))},1e4),Fi=_l=>{const _u=l_();if((_u.name==="Safari"&&Number(_u.version)===11||z0())&&_l.track.id!==b&&_l.streams[0].id===A){var _h;const _g=_l.streams[0].getTracks()[0];return(_h=this.remoteSDP)===null||_h===void 0||_h.updateTrackLabel(i,b,_l.track.id),this.peerConnection.removeEventListener("track",Fi),clearTimeout(_r),void $(_g)}if(_l.track.id===b)return this.peerConnection.removeEventListener("track",Fi),clearTimeout(_r),void $(_l.track)};this.peerConnection.addEventListener("track",Fi)}),H=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:H});const z=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(z),{track:await j,id:b}}catch(b){throw new yE(_p.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(b.toString()))}}async stopReceiving(i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(i);const o=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:o});const p=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(p)}catch(o){throw new yE(_p.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(o.toString()))}}async muteRemote(i){}async unmuteRemote(i){}async muteLocal(i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const o=this.peerConnection.getSenders().filter(p=>{var g;return i.indexOf(((g=p.track)===null||g===void 0?void 0:g.id)||"")!==-1});if(o.length!==i.length)throw new Error("sender' length doesn't match mids' length.");o.map(p=>{if(H0()&&p.track)p.track.enabled=!1;else{const g=p.getParameters();g.encodings.forEach(b=>b.active=!1),p.setParameters(g)}})}catch(o){throw new yE(_p.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(o.toString()))}}async unmuteLocal(i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const o=this.peerConnection.getSenders().filter(b=>{var A;return i.indexOf(((A=b.track)===null||A===void 0?void 0:A.id)||"")!==-1});if(o.length!==i.length)throw new Error("Senders' length doesn't match mids' length.");o.map(async b=>{if(H0()&&b.track)b.track.enabled=!0;else{const A=b.getParameters();A.encodings.forEach(j=>j.active=!0),await b.setParameters(A)}});const p=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(p);const g=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:g})}catch(o){throw new yE(_p.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(o.toString()))}}restartICE(i){var o=this;return JS(function*(){const p=yield d_(o.mutex.lock("From P2PConnection.restartICE"));try{if(!o.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if(I_().supportPCSetConfiguration){const H=o.peerConnection.getConfiguration(),z=i===N0.RELAY?"relay":"all";H.iceTransportPolicy!==z&&(Gi.debug("[".concat(o.store.clientId,"] restartICE change iceTransportPolicy from [").concat(H.iceTransportPolicy,"] to [").concat(z,"]")),H.iceTransportPolicy=z,o.peerConnection.setConfiguration(H))}else if(i===N0.RELAY)return;i!==N0.RELAY&&o.remoteSDP.updateCandidates(i);const g=yield d_(o.peerConnection.createOffer({iceRestart:!0}));if(!g.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const b=mI(g.sdp),{remoteIceParameters:A}=yield b.iceParameters;o.remoteSDP.restartICE(A);const j=o.remoteSDP.toString();yield d_(o.peerConnection.setLocalDescription(g)),yield d_(o.peerConnection.setRemoteDescription({type:"answer",sdp:j}))}catch(g){Gi.warning("[".concat(o.store.clientId,"] restart ICE failed, abort operation"),g)}finally{p()}})()}close(){var i;this.peerConnection.close(),(i=this.onConnectionStateChange)===null||i===void 0||i.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(i){return this.statsFilter.getVideoIsReady(i)}async updateEncoderConfig(i,o){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const p=await this.peerConnection.createOffer(),g=this.mungSendOfferSDP(p.sdp,[o]);this.remoteSDP.updateRecvMedia(o._mediaStreamTrack.kind,o);const b=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:g}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:b})}catch(p){throw new yE(_p.EXCHANGE_SDP_FAILED,p.toString())}}async updateSendParameters(i,o){const p=this.peerConnection.getSenders().filter(g=>{var b;return((b=g.track)===null||b===void 0?void 0:b.id)===i});p.length===1&&await this.applySendEncodings(p,[o])}setStatsRemoteVideoIsReady(i,o){this.statsFilter.setVideoIsReady2(i,o)}async replaceTrack(i,o){const p=this.peerConnection.getSenders().find(g=>{var b;return((b=g.track)===null||b===void 0?void 0:b.id)===o});p&&await p.replaceTrack(i._mediaStreamTrack)}createDataChannels(i,o){throw new yE(_p.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(i){throw new yE(_p.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var i;(i=this.onICEConnectionStateChange)===null||i===void 0||i.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var i;(i=this.onConnectionStateChange)===null||i===void 0||i.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=i=>{i.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,Gi.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,Gi.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},nE("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(i){const o={iceServers:[],sdpSemantics:"plan-b"};return i.iceServers?o.iceServers=i.iceServers:i.turnServer&&i.turnServer.mode!=="off"&&(VI(i.turnServer.servers)?o.iceServers=i.turnServer.servers:(o.iceServers&&o.iceServers.push(...b0.turnServerConfigToIceServers(i.turnServer.servers)),nE("USE_TURN_SERVER_OF_GATEWAY")&&o.iceServers&&i.turnServer.serversFromGateway&&o.iceServers.push(...b0.turnServerConfigToIceServers(i.turnServer.serversFromGateway)),i.turnServer.servers.concat(i.turnServer.serversFromGateway||[]).forEach(p=>{p.forceturn&&(o.iceTransportPolicy="relay")}))),o}static turnServerConfigToIceServers(i){const o=[];return i.forEach(p=>{p.security?p.tcpport&&o.push({username:p.username,credential:p.password,credentialType:"password",urls:"turns:".concat(p.turnServerURL,":").concat(p.tcpport,"?transport=tcp")}):(p.udpport&&o.push({username:p.username,credential:p.password,credentialType:"password",urls:"turn:".concat(p.turnServerURL,":").concat(p.udpport,"?transport=udp")}),p.tcpport&&o.push({username:p.username,credential:p.password,credentialType:"password",urls:"turn:".concat(p.turnServerURL,":").concat(p.tcpport,"?transport=tcp")}))}),o}async updateRtpSenderEncodings(i,o){var p;if(o||(o=this.peerConnection.getSenders().find(z=>{var $;return(($=z.track)===null||$===void 0?void 0:$.id)===i._mediaStreamTrack.id})),!o)return Gi.warn("[".concat(i.getTrackId(),"] no rtpSender found}"));if(!I_().supportSetRtpSenderParameters)return Gi.warn("Browser not support set rtp-sender parameters");const g={},b={};if(i instanceof ZE)switch(i._optimizationMode){case"motion":g.degradationPreference="maintain-framerate";break;case"detail":g.degradationPreference="maintain-resolution";break;default:g.degradationPreference="balanced"}if(nE("DSCP_TYPE")&&lR()){var A;const z=nE("DSCP_TYPE");VE(A=["very-low","low","medium","high"]).call(A,z)&&(b.networkPriority=z)}const j=o.getParameters(),H=(p=j.encodings)===null||p===void 0?void 0:p[0];H&&Object.assign(H,b),Object.assign(j,g),Gi.debug("[".concat(i.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(j.encodings))),await o.setParameters(j)}async applySendEncodings(i,o){try{if(!I_().supportSetRtpSenderParameters||i.length!==o.length)return;for(let p=0;p<i.length;p++){const g=i[p],b=o[p];g&&b&&await this.updateRtpSenderEncodings(b,g)}}catch{Gi.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(i,o){const p=q_.parse(i);return o.forEach((g,b)=>{const A=g._mediaStreamTrack,j=p.mediaDescriptions.find(H=>H.attributes.mid===A.kind);j&&gI(j,g)}),q_.print(p)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=i=>{var o;(o=this.onFirstAudioReceived)===null||o===void 0||o.call(this,i)},this.statsFilter.onFirstVideoReceived=i=>{var o;(o=this.onFirstVideoReceived)===null||o===void 0||o.call(this,i)},this.statsFilter.onFirstAudioDecoded=i=>{var o;(o=this.onFirstAudioDecoded)===null||o===void 0||o.call(this,i)},this.statsFilter.onFirstVideoDecoded=(i,o,p)=>{var g;(g=this.onFirstVideoDecoded)===null||g===void 0||g.call(this,i,o,p)},this.statsFilter.onSelectedLocalCandidateChanged=(i,o)=>{var p;(p=this.onSelectedLocalCandidateChanged)===null||p===void 0||p.call(this,i,o)},this.statsFilter.onSelectedRemoteCandidateChanged=(i,o)=>{var p;(p=this.onSelectedRemoteCandidateChanged)===null||p===void 0||p.call(this,i,o)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const o=this.remoteSDP.batchSend(i).map((b,A)=>{let{id:j,mslabel:H}=b;const{kind:z}=i[A];return new pE(($,Vt)=>{const _r=setTimeout(()=>{Vt(new Error("Cannot receive track, id: ".concat(j)))},1e4),Fi=_l=>{const _u=l_();if(_u.name==="Safari"&&Number(_u.version)===11&&_l.track.id!==j&&_l.streams[0].id===H){var _h;const _g=_l.streams[0].getTracks()[0];return(_h=this.remoteSDP)===null||_h===void 0||_h.updateTrackLabel(z,j,_l.track.id),this.peerConnection.removeEventListener("track",Fi),clearTimeout(_r),void $({track:_g,id:j})}if(_l.track.id===j)return this.peerConnection.removeEventListener("track",Fi),clearTimeout(_r),void $({track:_l.track,id:j})};this.peerConnection.addEventListener("track",Fi)})}),p=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:p});const g=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(g),await pE.all(o)}catch(o){throw new yE(_p.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(o.toString()))}}async getRemoteSSRC(i){if(!this.remoteSDP)return;const o=this.remoteSDP.getSSRC(i);return o==null?void 0:o[0].ssrcId}setConfiguration(i){if(I_().supportPCSetConfiguration){const o=b0.resolvePCConfiguration(i);this.peerConnection.setConfiguration(o)}}}function QS(l,i,o){const p=l[i];if(typeof p!="function")throw new Error("Cannot use mutex on object property.");return o.value=async function(){const g=this.mutex,b=await g.lock("Locking from P2PConnection.".concat(i));try{for(var A=arguments.length,j=new Array(A),H=0;H<A;H++)j[H]=arguments[H];return await p.apply(this,j)}finally{b()}},o}function X5(l,i){var o=Object.keys(l);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(l);i&&(p=p.filter(function(g){return Object.getOwnPropertyDescriptor(l,g).enumerable})),o.push.apply(o,p)}return o}function AR(l){for(var i=1;i<arguments.length;i++){var o=arguments[i]!=null?arguments[i]:{};i%2?X5(Object(o),!0).forEach(function(p){_e(l,p,o[p])}):Object.getOwnPropertyDescriptors?Object.defineProperties(l,Object.getOwnPropertyDescriptors(o)):X5(Object(o)).forEach(function(p){Object.defineProperty(l,p,Object.getOwnPropertyDescriptor(o,p))})}return l}bE([QS,kc("design:type",Function),kc("design:paramtypes",[Object,Object,Array,Object,String,String]),kc("design:returntype",pE)],b0.prototype,"connect",null),bE([QS,kc("design:type",Function),kc("design:paramtypes",[Array]),kc("design:returntype",pE)],b0.prototype,"stopSending",null),bE([QS,kc("design:type",Function),kc("design:paramtypes",[String,Array,String,Object]),kc("design:returntype",pE)],b0.prototype,"receive",null),bE([QS,kc("design:type",Function),kc("design:paramtypes",[Array]),kc("design:returntype",pE)],b0.prototype,"stopReceiving",null),bE([QS,kc("design:type",Function),kc("design:paramtypes",[String]),kc("design:returntype",pE)],b0.prototype,"muteRemote",null),bE([QS,kc("design:type",Function),kc("design:paramtypes",[String]),kc("design:returntype",pE)],b0.prototype,"unmuteRemote",null),bE([QS,kc("design:type",Function),kc("design:paramtypes",[Array]),kc("design:returntype",pE)],b0.prototype,"muteLocal",null),bE([QS,kc("design:type",Function),kc("design:paramtypes",[Array]),kc("design:returntype",pE)],b0.prototype,"unmuteLocal",null),bE([QS,kc("design:type",Function),kc("design:paramtypes",[]),kc("design:returntype",void 0)],b0.prototype,"close",null),bE([QS,kc("design:type",Function),kc("design:paramtypes",[String,P0]),kc("design:returntype",pE)],b0.prototype,"updateEncoderConfig",null),bE([QS,kc("design:type",Function),kc("design:paramtypes",[String,P0]),kc("design:returntype",pE)],b0.prototype,"updateSendParameters",null),bE([QS,kc("design:type",Function),kc("design:paramtypes",[P0,String]),kc("design:returntype",pE)],b0.prototype,"replaceTrack",null),bE([QS,kc("design:type",Function),kc("design:paramtypes",[String]),kc("design:returntype",pE)],b0.prototype,"getRemoteSSRC",null);const g1="9",Q5=4e4;function $5(l,i){var o=Object.keys(l);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(l);i&&(p=p.filter(function(g){return Object.getOwnPropertyDescriptor(l,g).enumerable})),o.push.apply(o,p)}return o}function uO(l){for(var i=1;i<arguments.length;i++){var o=arguments[i]!=null?arguments[i]:{};i%2?$5(Object(o),!0).forEach(function(p){_e(l,p,o[p])}):Object.getOwnPropertyDescriptors?Object.defineProperties(l,Object.getOwnPropertyDescriptors(o)):$5(Object(o)).forEach(function(p){Object.defineProperty(l,p,Object.getOwnPropertyDescriptor(o,p))})}return l}let c0=class y1 extends ON{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var i,o;return(i=(o=this.peerConnection.getReceivers()[0])===null||o===void 0||(o=o.transport)===null||o===void 0?void 0:o.state)!==null&&i!==void 0?i:null}constructor(i,o){super(i,o),_e(this,"store",void 0),_e(this,"peerConnection",void 0),_e(this,"remoteSDP",void 0),_e(this,"initialOffer",void 0),_e(this,"transportEventReceiver",void 0),_e(this,"statsFilter",void 0),_e(this,"useXR",nE("USE_XR")),_e(this,"localCapabilities",void 0),_e(this,"remoteCodecs",void 0),_e(this,"localCandidateCount",0),_e(this,"allCandidatesReceived",!1),_e(this,"dataStreamChannelMap",new Map),_e(this,"establishPromise",void 0),_e(this,"mutex",new E0("P2PConnection-mutex")),this.store=o,this.peerConnection=new RTCPeerConnection(y1.resolvePCConfiguration(i),{optional:[{googDscp:!0}]}),this.statsFilter=gP(this.peerConnection,nE("STATS_UPDATE_INTERVAL"),void 0,N_()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async updateRemoteRTPCapabilities(i,o){this.remoteCodecs=o;const p=[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map(g=>g.rtpMap&&g.rtpMap.encodingName.toLowerCase()||"").filter(g=>{var b;return VE(b=Object.keys(eI)).call(b,g)}))];if(jE.updateRemoteRTPCapabilities(this.store.sessionId,{mids:i,localCodecs:p,remoteCodecs:this.remoteCodecs}),!this.remoteSDP)return void Gi.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(p,", codecs: ").concat(o));if(this.remoteSDP.updateRemoteCodec(i,o,this.store.codec)){const g=await this.peerConnection.createOffer(),b=this.logSDPExchange(g.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(g);const A=this.remoteSDP.toString();b==null||b(A),await this.peerConnection.setRemoteDescription({type:"answer",sdp:A})}else Gi.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.")}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});const i=await this.peerConnection.createOffer();if(!i.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const o=mI(i.sdp),p=await x5({filterRTX:!nE("USE_PUB_RTX")&&!nE("USE_SUB_RTX"),filterVideoFec:nE("FILTER_VIDEO_FEC"),filterAudioFec:nE("FILTER_AUDIO_FEC"),filterVideoCodec:nE("FILTER_VIDEO_CODEC")},{useXR:this.useXR});return this.localCapabilities=pP(p),this.initialOffer=i,uO(uO({},o),{},{rtpCapabilities:p,offerSDP:i.sdp})}catch(i){throw new yE(_p.GET_LOCAL_CONNECTION_PARAMS_FAILED,i.toString())}}async connect(i,o,p,g,b,A){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new class{get localCapabilities(){return Q_(this._localCapabilities)}get rtpCapabilities(){return Q_(this._rtpCapabilities)}get candidates(){return Q_(this._candidates)}get iceParameters(){return Q_(this._iceParameters)}get dtlsParameters(){return Q_(this._dtlsParameters)}constructor(Fi){_e(this,"sessionDesc",void 0),_e(this,"_localCapabilities",void 0),_e(this,"_rtpCapabilities",void 0),_e(this,"_candidates",void 0),_e(this,"_iceParameters",void 0),_e(this,"_dtlsParameters",void 0),_e(this,"setup",void 0),_e(this,"currentMidIndex",void 0),_e(this,"cname",void 0),_e(this,"firefoxSsrcMidMap",new Map),Fi=Q_(Fi);const{remoteIceParameters:_l,remoteDtlsParameters:_u,candidates:_h,remoteRTPCapabilities:_g,remoteSetup:eE,localCapabilities:oE,cname:SE}=Fi,vE=q_.parse(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=ice-lite
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`);this._rtpCapabilities=_g,this._candidates=_h,this._iceParameters=_l,this._dtlsParameters=_u,this._localCapabilities=oE,this.setup=eE,this.cname=SE;const fE=this.rtpCapabilities.send;for(const mE of vE.mediaDescriptions){if(mE.attributes.iceUfrag=_l.iceUfrag,mE.attributes.icePwd=_l.icePwd,mE.attributes.fingerprints=_u.fingerprints,mE.attributes.candidates=_h,mE.attributes.setup=eE,mE.media.mediaType==="video"&&(mE.media.fmts=fE.videoCodecs.map(EE=>EE.payloadType.toString(10)),mE.attributes.payloads=fE.videoCodecs,mE.attributes.extmaps=fE.videoExtensions,nE("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:EE,ssrcGroups:PE}=XS([{ssrcId:Q5,rtx:nE("USE_SUB_RTX")?40001:void 0}],this.cname);mE.attributes.ssrcs=EE,mE.attributes.ssrcGroups=PE}if(mE.media.mediaType==="audio"&&(mE.media.fmts=fE.audioCodecs.map(EE=>EE.payloadType.toString(10)),mE.attributes.payloads=fE.audioCodecs,mE.attributes.extmaps=fE.audioExtensions,wR(mE),nE("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:EE,ssrcGroups:PE}=XS([{ssrcId:2e4}],this.cname);mE.attributes.ssrcs=EE,mE.attributes.ssrcGroups=PE}}this.sessionDesc=vE,this.currentMidIndex=vE.mediaDescriptions.length-1}preloadRemoteMedia(){const Fi=nE("PRELOAD_MEDIA_COUNT");this.rtpCapabilities;const _l=this.candidates,_u=this.dtlsParameters,_h=this.iceParameters,_g=this.rtpCapabilities.send;for(let eE=1;eE<Fi;eE++){const oE=2*eE+2e4,SE=2*eE+Q5,{ssrcs:vE,ssrcGroups:fE}=XS([{ssrcId:oE}],this.cname),{ssrcs:mE,ssrcGroups:EE}=XS([{ssrcId:SE,rtx:nE("USE_SUB_RTX")?SE+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:g1,protos:["UDP","TLS","RTP","SAVPF"],fmts:_g.videoCodecs.map(PE=>PE.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:_h.iceUfrag,icePwd:_h.icePwd,unrecognized:[],candidates:_l,extmaps:_g.videoExtensions,fingerprints:_u.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:mE,ssrcGroups:EE,rtcpFeedbackWildcards:[],payloads:_g.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*eE)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:g1,protos:["UDP","TLS","RTP","SAVPF"],fmts:_g.audioCodecs.map(PE=>PE.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:_h.iceUfrag,icePwd:_h.icePwd,unrecognized:[],candidates:_l,extmaps:_g.audioExtensions,fingerprints:_u.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:vE,ssrcGroups:fE,rtcpFeedbackWildcards:[],payloads:_g.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*eE+1)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return q_.print(this.sessionDesc)}send(Fi,_l,_u,_h){const{ssrcs:_g,ssrcGroups:eE}=XS(_l,this.cname,nE("SYNC_GROUP")?_u:void 0),oE=this.findPreloadMediaDesc(_g);if(oE){if(N_()&&this.firefoxSsrcMidMap.set(_g[0].ssrcId,oE.attributes.mid),_h&&(_h.twcc||_h.remb)){const SE=this.sessionDesc.mediaDescriptions.indexOf(oE);return this.sessionDesc.mediaDescriptions[SE]=this.mungSendMediaDesc(oE,_h),{mid:oE.attributes.mid,needExchangeSDP:!0}}return{mid:oE.attributes.mid,needExchangeSDP:!1}}{const SE=this.findAvailableMediaIndex(Fi,_g);let vE;return SE===-1||SE===1&&(H0()||BV())||SE===0&&nE("USE_SUB_RTX")||GV()?(vE=this.createOrRecycleSendMedia(Fi,_g,eE,"sendonly",_h),this.updateBundleMids()):(vE=Q_(this.sessionDesc.mediaDescriptions[SE]),vE.attributes.direction="sendonly",vE.attributes.ssrcs=_g,vE.attributes.ssrcGroups=eE,this.sessionDesc.mediaDescriptions[SE]=this.mungSendMediaDesc(vE,_h)),N_()&&this.firefoxSsrcMidMap.set(_g[0].ssrcId,vE.attributes.mid),{mid:vE.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){const{mediaDesc:Fi,needExchangeSDP:_l}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:Fi.attributes.mid,needExchangeSDP:_l}}batchSend(Fi){const _l=Fi.map(_g=>{let{kind:eE,ssrcMsg:oE,mslabel:SE}=_g;return this.send(eE,oE,SE)}),_u=[];let _h=!1;return _l.forEach(_g=>{let{mid:eE,needExchangeSDP:oE}=_g;oE&&(_h=!0),_u.push(eE)}),{mids:_u,needExchangeSDP:_h}}stopSending(Fi){const _l=this.sessionDesc.mediaDescriptions.filter(_u=>_u.attributes.mid&&Fi.indexOf(_u.attributes.mid)!==-1);if(_l.length!==Fi.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");_l.forEach(_u=>{_u.attributes.mid==="0"||N_()||GV()?_u.attributes.ssrcs=[]:(_u.attributes.ssrcs=[],_u.attributes.direction="inactive",_u.media.port="0")}),this.updateBundleMids()}mute(Fi){const _l=this.sessionDesc.mediaDescriptions.find(_u=>_u.attributes.mid===Fi);if(!_l)throw new Error("mediaDescription not found with ".concat(Fi," in remote SDP when calling RemoteSDP.mute."));_l.attributes.direction="inactive"}unmute(Fi){const _l=this.sessionDesc.mediaDescriptions.find(_u=>_u.attributes.mid===Fi);if(!_l)throw new Error("mediaDescription not found with ".concat(Fi," in remote SDP when calling RemoteSDP.unmute."));_l.attributes.direction="sendonly"}muteRemote(Fi){const _l=this.sessionDesc.mediaDescriptions.filter(_u=>VE(Fi).call(Fi,_u.attributes.mid||""));if(_l.length!==Fi.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");_l.forEach(_u=>{_u.attributes.direction="inactive"})}unmuteRemote(Fi){const _l=this.sessionDesc.mediaDescriptions.filter(_u=>VE(Fi).call(Fi,_u.attributes.mid||""));if(_l.length!==Fi.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");_l.forEach(_u=>{_u.attributes.direction="recvonly"})}receive(Fi,_l,_u,_h){Fi.forEach((_g,eE)=>{this.createOrRecycleRecvMedia(_g,[],"recvonly",_l,_u,_h[eE])}),this.updateBundleMids()}stopReceiving(Fi){const _l=this.sessionDesc.mediaDescriptions.filter(_u=>Fi.indexOf(_u.attributes.mid)!==-1);if(_l.length!==Fi.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");_l.forEach(_u=>{_u.media.port="0",_u.attributes.direction="inactive"}),this.updateBundleMids()}updateCandidates(Fi){const _l=this._candidates.filter(_u=>_u.transport==="udp");if(Fi===N0.TCP){if(_l.length===0)return;if(nE("TCP_CANDIDATE_ONLY")){const _u=this._candidates.filter(_h=>_h.transport==="tcp");_l.forEach(_h=>{_u.findIndex(_g=>_g.connectionAddress===_h.connectionAddress)===-1&&_u.push(AR(AR({},_h),{},{foundation:"tcpcandidate",priority:Number(_h.priority)-1+"",transport:"tcp",port:Number(_h.port)+90+""}))}),this._candidates=_u}else{const _u=[];_l.forEach(_h=>{_u.push(AR(AR({},_h),{},{foundation:"tcpcandidate",priority:Number(_h.priority)-1+"",transport:"tcp",port:Number(_h.port)+90+""}))}),this._candidates=[..._l,..._u]}}else if(Fi===N0.RELAY){if(_l.length!==0)return;{const _u=this._candidates.filter(_h=>_h.transport==="tcp");_u.forEach(_h=>{_l.push(AR(AR({},_h),{},{foundation:"udpcandidate",priority:Number(_h.priority)+1+"",transport:"udp",port:Number(_h.port)-90+""}))}),this._candidates=[..._l,..._u]}}else _l.length===0?(this._candidates.filter(_u=>_u.transport==="tcp").forEach(_u=>{_l.push(AR(AR({},_u),{},{foundation:"udpcandidate",priority:Number(_u.priority)+1+"",transport:"udp",port:Number(_u.port)-90+""}))}),this._candidates=_l):this._candidates=this._candidates.filter(_u=>_u.transport!=="tcp");for(const _u of this.sessionDesc.mediaDescriptions)_u.attributes.candidates=this.candidates}restartICE(Fi){Fi=Q_(Fi),this._iceParameters=Fi,this.sessionDesc.mediaDescriptions.forEach(_l=>{_l.attributes.iceUfrag=Fi.iceUfrag,_l.attributes.icePwd=Fi.icePwd})}predictReceivingMids(Fi){const _l=[];for(let _u=0;_u<Fi;_u++)_l.push((this.currentMidIndex+_u+1).toString(10));return _l}findAvailableMediaIndex(Fi,_l){return this.sessionDesc.mediaDescriptions.findIndex(_u=>{const _h=_u.media.mediaType===Fi&&_u.media.port!=="0"&&(_u.attributes.direction==="sendonly"||_u.attributes.direction==="sendrecv")&&_u.attributes.ssrcs.length===0;if(N_()){if(_h){const _g=this.firefoxSsrcMidMap.get(_l[0].ssrcId);return!(_g||_u.attributes.mid!=="0"&&_u.attributes.mid!=="1")||!(!_g||_g!==_u.attributes.mid)}return!1}return _h})}createOrRecycleDataChannel(){for(const _u of this.sessionDesc.mediaDescriptions)if(_u.media.mediaType==="application")return{mediaDesc:_u,needExchangeSDP:!1};this.currentMidIndex+=1;const Fi="".concat(this.currentMidIndex),_l={media:{mediaType:"application",port:g1,protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(Fi),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(_l),{mediaDesc:_l,needExchangeSDP:!0}}createOrRecycleRecvMedia(Fi,_l,_u,_h,_g,eE){const oE=Fi._mediaStreamTrack.kind,SE=this.rtpCapabilities.recv,vE=mP(oE,SE,this.localCapabilities.send,oE===ME.VIDEO?_h:_g),fE=oE===ME.VIDEO?SE.videoExtensions:SE.audioExtensions;this.currentMidIndex+=1;const mE="".concat(this.currentMidIndex);let EE={media:{mediaType:oE,port:g1,protos:["UDP","TLS","RTP","SAVPF"],fmts:vE.map(OE=>OE.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:fE,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:_l,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:vE,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:_u,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(mE)}};EE=this.mungRecvMediaDsec(EE,Fi,eE);const PE=this.findFirstClosedMedia(oE);if(PE){const OE=this.sessionDesc.mediaDescriptions.indexOf(PE);this.sessionDesc.mediaDescriptions[OE]=EE}else this.sessionDesc.mediaDescriptions.push(EE);return EE}updateRemoteCodec(Fi,_l,_u){const _h=[...new Set(this._rtpCapabilities.recv.videoCodecs.map(EE=>EE.rtpMap&&EE.rtpMap.encodingName.toLowerCase()||"").filter(EE=>{var PE;return VE(PE=Object.keys(eI)).call(PE,EE)}))],_g=new Set(_l);if(_h.every(EE=>_g.has(EE)))return Gi.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(_l)),!1;const eE=this._rtpCapabilities.recv.videoCodecs.filter(EE=>_l.some(PE=>{var OE;return VE(OE=EE.rtpMap&&EE.rtpMap.encodingName.toLowerCase()||"").call(OE,PE)}));if(eE.length===0)return Gi.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(_h," codecs: ").concat(_l)),!1;const oE=[...new Set(eE.map(EE=>EE.rtpMap&&EE.rtpMap.encodingName.toLowerCase()||""))];let SE;if(Gi.debug("updateRemoteCodec, from ".concat(_h," to ").concat(oE)),Fi.length===0)SE=this.sessionDesc.mediaDescriptions.filter(EE=>EE.media.mediaType==="video"&&EE.attributes.direction==="recvonly");else if(SE=this.sessionDesc.mediaDescriptions.filter(EE=>EE.attributes.mid&&VE(Fi).call(Fi,EE.attributes.mid)&&EE.attributes.direction==="recvonly"),SE.length!==Fi.length)return Gi.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(Fi,", codecs: ").concat(_l)),!1;this._rtpCapabilities.recv.videoCodecs=eE;const vE=this.localCapabilities.send,fE=this.rtpCapabilities.recv,mE=mP(ME.VIDEO,fE,vE,_u);return SE.forEach(EE=>{const PE=mE.map(OE=>OE.payloadType.toString(10));Gi.debug("updateRemoteCodec mid: ".concat(EE.attributes.mid,", from ").concat(EE.attributes.payloads," to ").concat(mE)),EE.attributes.payloads=mE,EE.media.fmts=PE}),!0}createOrRecycleSendMedia(Fi,_l,_u,_h,_g){const eE=this.rtpCapabilities.send,oE=Fi===ME.VIDEO?eE.videoCodecs:eE.audioCodecs,SE=Fi===ME.VIDEO?eE.videoExtensions:eE.audioExtensions;this.currentMidIndex+=1;const vE="".concat(this.currentMidIndex);let fE={media:{mediaType:Fi,port:g1,protos:["UDP","TLS","RTP","SAVPF"],fmts:oE.map(EE=>EE.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:SE,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:_l,ssrcGroups:_u,rtcpFeedbackWildcards:[],payloads:oE,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:_h,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(vE)}};fE=this.mungSendMediaDesc(fE,_g);const mE=this.findFirstClosedMedia(Fi);if(mE){const EE=this.sessionDesc.mediaDescriptions.indexOf(mE);this.sessionDesc.mediaDescriptions[EE]=fE}else this.sessionDesc.mediaDescriptions.push(fE);return fE}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(Fi=>Fi.media.port!=="0").map(Fi=>Fi.attributes.mid)}mungRecvMediaDsec(Fi,_l,_u){const _h=Q_(Fi);return y2(_h),gI(_h,_l),b2(_h,_l),L5(_h),dP(_h,_u,this.localCapabilities.send),_h}mungSendMediaDesc(Fi,_l){const _u=Q_(Fi);return dP(_u,_l,this.localCapabilities.recv),wR(_u),_u}updateRecvMedia(Fi,_l){const _u=this.sessionDesc.mediaDescriptions.findIndex(_h=>_h.attributes.mid===Fi);if(_u!==-1){const _h=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[_u],_l);this.sessionDesc.mediaDescriptions[_u]=_h}}bumpMid(Fi){this.currentMidIndex+=Fi}findFirstClosedMedia(Fi){return this.sessionDesc.mediaDescriptions.find(_l=>N_()?_l.media.port==="0"&&_l.media.mediaType===Fi:_l.media.port==="0")}findPreloadMediaDesc(Fi){return this.sessionDesc.mediaDescriptions.find(_l=>{var _u;return((_u=_l.attributes)===null||_u===void 0||(_u=_u.ssrcs[0])===null||_u===void 0?void 0:_u.ssrcId)===Fi[0].ssrcId})}getSSRC(Fi){var _l;return(_l=this.sessionDesc.mediaDescriptions.find(_u=>_u.attributes.mid===Fi))===null||_l===void 0?void 0:_l.attributes.ssrcs}}({remoteIceParameters:i,remoteDtlsParameters:o,candidates:p,remoteRTPCapabilities:g,remoteSetup:b,localCapabilities:this.localCapabilities,cname:A}),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const j=this.remoteSDP.toString(),H=q_.parse(this.initialOffer.sdp),z=H.mediaDescriptions.find(Fi=>Fi.media.mediaType==="audio");z&&wR(z),this.useXR&&fP(H);const $=q_.print(H),Vt=this.logSDPExchange($||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:$}),Vt==null||Vt(j),await this.peerConnection.setRemoteDescription({type:"answer",sdp:j});const _r=this.peerConnection.getTransceivers()[0];if(_r!=null&&_r.receiver&&this.tryBindTransportEvents(_r.receiver),nE("PRELOAD_MEDIA_COUNT")>0){this.remoteSDP.preloadRemoteMedia();const Fi=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:Fi});const _l=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(_l)}}catch(j){throw new yE(_p.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(j.toString()))}}send(i,o,p){var g=this;return JS(function*(){const b=yield d_(g.mutex.lock("From P2PConnection.send"));try{if(!g.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const A=[];i.forEach(_u=>{const _h=g.peerConnection.addTransceiver(_u._mediaStreamTrack,{direction:"sendonly"});A.push(_h),_u._updateRtpTransceiver(_h)}),N_()&&nE("SIMULCAST")===!0&&(yield d_(g.applySimulcastForFirefox(A,i)));const j=yield d_(g.peerConnection.createOffer()),H=g.remoteSDP.predictReceivingMids(i.length),z=g.mungSendOfferSDP(j.sdp,i,H),$=q_.parse(z),Vt=H.map(_u=>{const _h=$.mediaDescriptions.find(_g=>_g.attributes.mid===_u);if(!_h)throw new Error("Cannot extract ssrc from mediaDescription.");return k5(_h,nE("USE_PUB_RTX"))});let _r;try{_r=yield Vt}catch(_u){_r=[],g.remoteSDP.receive(i,o,p,_r);const _h=g.remoteSDP.toString();throw yield d_(g.peerConnection.setLocalDescription({type:"offer",sdp:z})),yield d_(g.peerConnection.setRemoteDescription({type:"answer",sdp:_h})),yield d_(g.stopSending(H,!0)),_u}g.remoteSDP.receive(i,o,p,_r);const Fi=g.remoteSDP.toString(),_l=g.logSDPExchange(z,"offer","local","send");return yield d_(g.peerConnection.setLocalDescription({type:"offer",sdp:z})),yield d_(g.applySimulcastEncodings(A,i)),yield d_(g.applySendEncodings(A,i)),_l==null||_l(Fi),yield d_(g.peerConnection.setRemoteDescription({type:"answer",sdp:Fi})),A.map((_u,_h)=>{const _g=H[_h];return{localSSRC:Vt[_h],id:_g,transceiver:_u}})}catch(A){throw A instanceof yE?A:new yE(_p.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(A.toString()))}finally{b()}})()}async createDataChannels(i,o){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let p=this.dataStreamChannelMap.get(i);p&&p.readyState==="open"?Gi.debug("[P2PConnection] Channels are already available and can be reused directly."):(p=this.peerConnection.createDataChannel("datastream-channel",{ordered:!1,maxRetransmits:nE("DATASTREAM_MAX_RETRANSMITS")}),p.binaryType="arraybuffer",this.dataStreamChannelMap.set(i,p)),o.forEach(b=>{b._updateOriginDataChannel(p)});const{needExchangeSDP:g}=this.remoteSDP.sendDataChannel();if(g){const b=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:b});const A=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(A),Gi.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else Gi.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(p){throw p instanceof yE?p:new yE(_p.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(p.toString()))}}async stopDataChannels(i){try{const o=this.dataStreamChannelMap.get(i);return o==null||o.close(),void this.dataStreamChannelMap.delete(i)}catch(o){throw o instanceof yE?o:new yE(_p.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(o.toString()))}}async stopSending(i,o){const p=o?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const g=this.peerConnection.getTransceivers().filter(H=>i.indexOf(H.mid)!==-1);if(g.length!==i.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");g.map(H=>{var z;H.direction="inactive",(z=H.stop)===null||z===void 0||z.call(H)});const b=await this.peerConnection.createOffer(),A=this.logSDPExchange(b.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(b),this.remoteSDP.stopReceiving(i);const j=this.remoteSDP.toString();A==null||A(j),await this.peerConnection.setRemoteDescription({type:"answer",sdp:j})}catch(g){throw new yE(_p.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(g.toString()))}finally{p&&p()}}async receive(i,o,p,g){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(i," before remoteSDP created."));const{mid:b,needExchangeSDP:A}=this.remoteSDP.send(i,o,p,g);if(A){const H=this.remoteSDP.toString(),z=this.logSDPExchange(H,"offer","remote","receive");await this.peerConnection.setRemoteDescription({type:"offer",sdp:H});const $=await this.peerConnection.createAnswer(),Vt=this.mungReceiveAnswerSDP($.sdp,b,i);z==null||z(Vt||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:Vt}),Gi.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(i," by exchanging SDP."))}else Gi.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(i," no need to exchange SDP."));const j=this.peerConnection.getTransceivers().find(H=>H.mid===b);if(!j)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:j.receiver.track,id:b,transceiver:j}}catch(b){throw new yE(_p.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(b.toString()))}}async batchReceive(i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const{mids:o,needExchangeSDP:p}=this.remoteSDP.batchSend(i);if(p){const g=this.remoteSDP.toString(),b=this.logSDPExchange(g,"offer","remote","receive");await this.peerConnection.setRemoteDescription({type:"offer",sdp:g});const A=await this.peerConnection.createAnswer();b==null||b(A.sdp||""),await this.peerConnection.setLocalDescription(A),Gi.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))}else Gi.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive no need to exchange SDP."));return o.map(g=>{const b=this.peerConnection.getTransceivers().find(A=>A.mid===g);if(!b)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:b.receiver.track,id:g,transceiver:b}})}catch(o){throw new yE(_p.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(o.toString()))}}async stopReceiving(i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(i);const o=this.remoteSDP.toString(),p=this.logSDPExchange(o,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:o});const g=await this.peerConnection.createAnswer();p==null||p(g.sdp||""),await this.peerConnection.setLocalDescription(g)}catch(o){throw new yE(_p.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(o.toString()))}}async muteRemote(i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(i," before remote SDP created."));this.remoteSDP.mute(i);const o=this.remoteSDP.toString(),p=this.logSDPExchange(o,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:o});const g=await this.peerConnection.createAnswer();p==null||p(g.sdp||""),await this.peerConnection.setLocalDescription(g)}catch(o){throw new yE(_p.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(o.toString()))}}async unmuteRemote(i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(i," before remote SDP created."));this.remoteSDP.unmute(i);const o=this.remoteSDP.toString(),p=this.logSDPExchange(o,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:o});const g=await this.peerConnection.createAnswer();p==null||p(g.sdp||""),await this.peerConnection.setLocalDescription(g)}catch(o){throw new yE(_p.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(o.toString()))}}async muteLocal(i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const o=this.peerConnection.getTransceivers().filter(A=>A.mid&&i.indexOf(A.mid)!==-1);if(o.length!==i.length)throw new Error("Transceivers' length doesn't match mids' length.");o.map(A=>{A.direction="inactive"});const p=await this.peerConnection.createOffer(),g=this.logSDPExchange(p.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(p),this.remoteSDP.muteRemote(i);const b=this.remoteSDP.toString();g==null||g(b),await this.peerConnection.setRemoteDescription({type:"answer",sdp:b})}catch(o){throw new yE(_p.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(o.toString()))}}async unmuteLocal(i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const o=this.peerConnection.getTransceivers().filter(A=>A.mid&&i.indexOf(A.mid)!==-1);if(o.length!==i.length)throw new Error("Transceivers' length doesn't match mids' length.");o.map(async(A,j)=>{A.direction="sendonly"});const p=await this.peerConnection.createOffer(),g=this.logSDPExchange(p.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(p),this.remoteSDP.unmuteRemote(i);const b=this.remoteSDP.toString();g==null||g(b),await this.peerConnection.setRemoteDescription({type:"answer",sdp:b})}catch(o){throw new yE(_p.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(o.toString()))}}restartICE(i){var o=this;return JS(function*(){const p=yield d_(o.mutex.lock("From P2PConnection.restartICE"));try{if(!o.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if(I_().supportPCSetConfiguration){const z=o.peerConnection.getConfiguration(),$=i===N0.RELAY?"relay":"all";z.iceTransportPolicy!==$&&(Gi.debug("[".concat(o.store.clientId,"] restartICE change iceTransportPolicy from [").concat(z.iceTransportPolicy,"] to [").concat($,"]")),z.iceTransportPolicy=$,o.peerConnection.setConfiguration(z))}else if(i===N0.RELAY)return;o.remoteSDP.updateCandidates(i);const g=yield d_(o.peerConnection.createOffer({iceRestart:!0}));if(!g.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const b=mI(g.sdp),{remoteIceParameters:A}=yield b.iceParameters;o.remoteSDP.restartICE(A);const j=o.remoteSDP.toString(),H=o.logSDPExchange(g.sdp||"","offer","local","restartICE");o.store.descriptionStart(),yield d_(o.peerConnection.setLocalDescription(g)),H==null||H(j),yield d_(o.peerConnection.setRemoteDescription({type:"answer",sdp:j}))}catch(g){Gi.warning("[".concat(o.store.clientId,"] restart ICE failed, abort operation"),g)}finally{p()}})()}close(){var i;this.peerConnection.close(),(i=this.onConnectionStateChange)===null||i===void 0||i.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(i){return this.statsFilter.getVideoIsReady(i)}async updateEncoderConfig(i,o){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const p=await this.peerConnection.createOffer(),g=this.mungSendOfferSDP(p.sdp,[o],[i]);this.remoteSDP.updateRecvMedia(i,o);const b=this.remoteSDP.toString(),A=this.logSDPExchange(g,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:g}),A==null||A(b),await this.peerConnection.setRemoteDescription({type:"answer",sdp:b})}catch(p){throw new yE(_p.EXCHANGE_SDP_FAILED,p.toString())}}async updateSendParameters(i,o){const p=this.peerConnection.getTransceivers().filter(g=>g.mid===i);p.length===1&&(this.isVP8Simulcast(o)?N_()||await this.applySimulcastEncodings(p,[o]):await this.applySendEncodings(p,[o]))}setStatsRemoteVideoIsReady(i,o){this.statsFilter.setVideoIsReady2(i,o)}async replaceTrack(i,o){const p=this.peerConnection.getTransceivers().find(g=>g.mid===o);p&&await p.sender.replaceTrack(i._mediaStreamTrack)}async getSelectedCandidatePair(){const i=this.peerConnection.getReceivers();if(i.length>0&&i[0].transport&&i[0].transport.iceTransport&&i[0].transport.iceTransport.getSelectedCandidatePair&&i[0].transport.iceTransport.getSelectedCandidatePair()){const o=i[0].transport.iceTransport,{local:p,remote:g}=o.getSelectedCandidatePair();return{local:uO(uO({},FT),{},{candidateType:p.type,protocol:p.protocol,address:p.address,port:p.port}),remote:uO(uO({},FT),{},{candidateType:g.type,protocol:g.protocol,address:g.address,port:g.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var i;(i=this.onICEConnectionStateChange)===null||i===void 0||i.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var i;(i=this.onConnectionStateChange)===null||i===void 0||i.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=i=>{i.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,Gi.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,Gi.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},nE("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(i){const o={iceServers:[]};return i.iceServers?o.iceServers=i.iceServers:i.turnServer&&i.turnServer.mode!=="off"&&(VI(i.turnServer.servers)?o.iceServers=i.turnServer.servers:(o.iceServers&&o.iceServers.push(...y1.turnServerConfigToIceServers(i.turnServer.servers)),nE("USE_TURN_SERVER_OF_GATEWAY")&&o.iceServers&&i.turnServer.serversFromGateway&&o.iceServers.push(...y1.turnServerConfigToIceServers(i.turnServer.serversFromGateway)),nE("FORCE_TURN_TCP")?o.iceTransportPolicy="relay":i.turnServer.servers.concat(i.turnServer.serversFromGateway||[]).forEach(p=>{p.forceturn&&(o.iceTransportPolicy="relay")}))),nE("ENABLE_ENCODED_TRANSFORM")&&I_().supportWebRTCEncodedTransform&&(o.encodedInsertableStreams=!0),o}static turnServerConfigToIceServers(i){const o=[];return i.forEach(p=>{p.security?p.tcpport&&o.push({username:p.username,credential:p.password,credentialType:"password",urls:"turns:".concat(d1(p.turnServerURL),":").concat(p.tcpport,"?transport=tcp")}):(p.udpport&&!nE("FORCE_TURN_TCP")&&o.push({username:p.username,credential:p.password,credentialType:"password",urls:"turn:".concat(p.turnServerURL,":").concat(p.udpport,"?transport=udp")}),p.tcpport&&o.push({username:p.username,credential:p.password,credentialType:"password",urls:"turn:".concat(p.turnServerURL,":").concat(p.tcpport,"?transport=tcp")}))}),o}tryBindTransportEvents(i){const o=i.transport;if(o){this.transportEventReceiver=i,o.onstatechange=()=>{var g;o!=null&&o.state&&((g=this.onDTLSTransportStateChange)===null||g===void 0||g.call(this,o.state))},o.onerror=g=>{var b;(b=this.onDTLSTransportError)===null||b===void 0||b.call(this,"error"in g?g.error:g)};const p=o.iceTransport;p&&(p.onstatechange=()=>{const g=o==null?void 0:o.iceTransport.state;var b;g&&((b=this.onICETransportStateChange)===null||b===void 0||b.call(this,g))},p.getSelectedCandidatePair&&(p.onselectedcandidatepairchange=()=>{if(p.getSelectedCandidatePair()){const{local:g,remote:b}=p.getSelectedCandidatePair();Gi.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:g.type,protocol:g.protocol}),", remote ").concat(JSON.stringify({candidateType:b.type,protocol:b.protocol,address:b.address,port:b.port})," )"))}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(i,o){var p;if(o||(o=this.peerConnection.getSenders().find($=>$.track===i._mediaStreamTrack)),!o)return Gi.warn("[".concat(i.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(i))return Gi.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!I_().supportSetRtpSenderParameters)return Gi.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const g={},b={};switch(i._optimizationMode){case"motion":g.degradationPreference="maintain-framerate";break;case"detail":g.degradationPreference="maintain-resolution";break;default:g.degradationPreference="balanced"}if(i._encoderConfig){var A;const{bitrateMax:$,frameRate:Vt,scaleResolutionDownBy:_r}=i._encoderConfig;$&&(b.maxBitrate=1e3*$),(VE(A=i._hints).call(A,A_.LOW_STREAM)||i.isUseScaleResolutionDownBy)&&(Vt&&(b.maxFramerate=US(Vt)),_r&&_r>=1&&(b.scaleResolutionDownBy=_r))}if(nE("DSCP_TYPE")&&lR()){var j;const $=nE("DSCP_TYPE");VE(j=["very-low","low","medium","high"]).call(j,$)&&(b.networkPriority=$)}const H=o.getParameters(),z=(p=H.encodings)===null||p===void 0?void 0:p[0];N_()&&!z&&(g.encodings=[b]),z&&Object.assign(z,b),Object.assign(H,g),Gi.debug("[".concat(i.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(H.encodings))),await o.setParameters(H)}async applySendEncodings(i,o){try{if(!I_().supportSetRtpSenderParameters||i.length!==o.length)return;for(let p=0;p<i.length;p++){const g=i[p],b=o[p];b instanceof ZE&&!this.isVP8Simulcast(b)&&await this.updateRtpSenderEncodings(b,g.sender)}}catch{Gi.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(i,o,p){const g=q_.parse(i);return o.forEach((b,A)=>{const j=p[A],H=g.mediaDescriptions.find(z=>z.attributes.mid===j);H&&(gI(H,b),S2(H,b,this.store.codec))}),q_.print(g)}mungReceiveAnswerSDP(i,o,p){const g=q_.parse(i),b=g.mediaDescriptions.find(A=>A.attributes.mid===o);return b&&(p===ME.AUDIO&&b.media.mediaType==="audio"&&wR(b),this.useXR&&fP(g)),q_.print(g)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=i=>{var o;(o=this.onFirstAudioReceived)===null||o===void 0||o.call(this,i)},this.statsFilter.onFirstVideoReceived=i=>{var o;(o=this.onFirstVideoReceived)===null||o===void 0||o.call(this,i)},this.statsFilter.onFirstAudioDecoded=i=>{var o;(o=this.onFirstAudioDecoded)===null||o===void 0||o.call(this,i)},this.statsFilter.onFirstVideoDecoded=(i,o,p)=>{var g;(g=this.onFirstVideoDecoded)===null||g===void 0||g.call(this,i,o,p)},this.statsFilter.onSelectedLocalCandidateChanged=(i,o)=>{var p;(p=this.onSelectedLocalCandidateChanged)===null||p===void 0||p.call(this,i,o)},this.statsFilter.onSelectedRemoteCandidateChanged=(i,o)=>{var p;(p=this.onSelectedRemoteCandidateChanged)===null||p===void 0||p.call(this,i,o)},this.statsFilter.onFirstVideoDecodedTimeout=i=>{var o;(o=this.onFirstVideoDecodedTimeout)===null||o===void 0||o.call(this,i)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(i,o){if(i.length===o.length)for(let H=0;H<i.length;H++){var p,g,b,A,j;const z=i[H],$=o[H];if($ instanceof ZE&&!VE(p=$._hints).call(p,A_.LOW_STREAM)&&(g=$._encoderConfig)!==null&&g!==void 0&&g.bitrateMax&&((b=$._encoderConfig)===null||b===void 0?void 0:b.bitrateMax)>200&&(A=$._scalabilityMode)!==null&&A!==void 0&&A.numSpatialLayers&&((j=$._scalabilityMode)===null||j===void 0?void 0:j.numSpatialLayers)>1&&this.store.codec==="vp8"){const Vt={},_r={high:1e3*($._encoderConfig.bitrateMax-50),medium:5e4};Vt.encodings=[{rid:"m",active:!0,maxBitrate:_r.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:_r.high}];const Fi=z.sender.getParameters();await z.sender.setParameters(Object.assign(Fi,Vt))}}}async applySimulcastEncodings(i,o){if(!N_()&&i.length===o.length)for(let p=0;p<i.length;p++){const g=o[p];if(g instanceof ZE&&this.isVP8Simulcast(g)){const b=i[p],A={},j={high:1e3*(g._encoderConfig.bitrateMax-50),medium:5e4};A.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:j.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:j.medium,scaleResolutionDownBy:4}];const H=b.sender.getParameters();await b.sender.setParameters(Object.assign(H,A))}}}isVP8Simulcast(i){var o,p,g,b,A;return!!(i instanceof ZE&&nE("SIMULCAST")&&this.store.codec==="vp8"&&!VE(o=i._hints).call(o,A_.LOW_STREAM)&&(p=i._encoderConfig)!==null&&p!==void 0&&p.bitrateMax&&((g=i._encoderConfig)===null||g===void 0?void 0:g.bitrateMax)>200&&(b=i._scalabilityMode)!==null&&b!==void 0&&b.numSpatialLayers&&((A=i._scalabilityMode)===null||A===void 0?void 0:A.numSpatialLayers)>1)}logSDPExchange(i,o,p,g){if(nE("SDP_LOGGING"))return Gi.upload("[".concat(this.store.clientId,"] exchanging ").concat(p," ").concat(o," SDP during P2PConnection.").concat(g,`
`),i),o==="offer"?b=>{this.logSDPExchange(b,"answer",p==="local"?"remote":"local",g)}:void 0}async getRemoteSSRC(i){if(!this.remoteSDP)return;const o=this.remoteSDP.getSSRC(i);return o==null?void 0:o[0].ssrcId}setConfiguration(i){if(I_().supportPCSetConfiguration){const o=y1.resolvePCConfiguration(i);this.peerConnection.setConfiguration(o)}}};function _S(l,i,o){const p=l[i];if(typeof p!="function")throw new Error("Cannot use mutex on object property.");return o.value=async function(){const g=this.mutex,b=await g.lock("From P2PConnection.".concat(i));try{for(var A=arguments.length,j=new Array(A),H=0;H<A;H++)j[H]=arguments[H];return await p.apply(this,j)}finally{b()}},o}function R2(l,i){let o=document.createElement("video"),p=document.createElement("canvas");o.setAttribute("style","display:none"),p.setAttribute("style","display:none"),o.setAttribute("muted",""),o.muted=!0,o.setAttribute("autoplay",""),o.autoplay=!0,o.setAttribute("playsinline",""),p.width=US(i.width),p.height=US(i.height);const g=US(i.framerate||15);document.body.append(o),document.body.append(p);let b=l._mediaStreamTrack;o.srcObject=new MediaStream([b]),o.play();const A=p.getContext("2d");if(!A)throw new hE(_p.UNEXPECTED_ERROR,"can not get canvas context");const j=I_(),H=p.captureStream(j.supportRequestFrame?0:g).getVideoTracks()[0];H.canvas||(H.canvas=p),p.startCapture=()=>{if(!o)return p.stopCapture&&p.stopCapture();if(o.paused&&o.play(),o.videoHeight>2&&o.videoWidth>2){const $=o.videoWidth,Vt=o.videoHeight/$,_r=p.width*Vt;Math.abs(_r-p.height)>=2&&(Gi.debug("adjust low stream resolution","".concat(p.width,"x").concat(p.height," -> ").concat(p.width,"x").concat(_r)),p.height=_r)}A.drawImage(o,0,0,p.width,p.height),H.requestFrame&&H.requestFrame(),b!==l._mediaStreamTrack&&(b=l._mediaStreamTrack,o.srcObject=new MediaStream([b]))},p.stopCapture=OM(()=>p.startCapture&&p.startCapture(),g);const z=H.stop;return H.stop=()=>{z.call(H),o&&(o.remove(),o.srcObject=null,o=null),p&&(p.width=0,p.remove(),p.stopCapture&&p.stopCapture(),p.startCapture=void 0,p.stopCapture=void 0,p=null),Gi.debug("clean low stream renderer")},H}function Z5(l,i){var o=Object.keys(l);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(l);i&&(p=p.filter(function(g){return Object.getOwnPropertyDescriptor(l,g).enumerable})),o.push.apply(o,p)}return o}function _q(l){for(var i=1;i<arguments.length;i++){var o=arguments[i]!=null?arguments[i]:{};i%2?Z5(Object(o),!0).forEach(function(p){_e(l,p,o[p])}):Object.getOwnPropertyDescriptors?Object.defineProperties(l,Object.getOwnPropertyDescriptors(o)):Z5(Object(o)).forEach(function(p){Object.defineProperty(l,p,Object.getOwnPropertyDescriptor(o,p))})}return l}bE([_S,kc("design:type",Function),kc("design:paramtypes",[Array,Array]),kc("design:returntype",pE)],c0.prototype,"updateRemoteRTPCapabilities",null),bE([_S,kc("design:type",Function),kc("design:paramtypes",[Object,Object,Array,Object,String,String]),kc("design:returntype",pE)],c0.prototype,"connect",null),bE([_S,kc("design:type",Function),kc("design:paramtypes",[Object,Array]),kc("design:returntype",pE)],c0.prototype,"createDataChannels",null),bE([_S,kc("design:type",Function),kc("design:paramtypes",[String,Array,String,Object]),kc("design:returntype",pE)],c0.prototype,"receive",null),bE([_S,kc("design:type",Function),kc("design:paramtypes",[Array]),kc("design:returntype",pE)],c0.prototype,"batchReceive",null),bE([_S,kc("design:type",Function),kc("design:paramtypes",[Array]),kc("design:returntype",pE)],c0.prototype,"stopReceiving",null),bE([_S,kc("design:type",Function),kc("design:paramtypes",[String]),kc("design:returntype",pE)],c0.prototype,"muteRemote",null),bE([_S,kc("design:type",Function),kc("design:paramtypes",[String]),kc("design:returntype",pE)],c0.prototype,"unmuteRemote",null),bE([_S,kc("design:type",Function),kc("design:paramtypes",[Array]),kc("design:returntype",pE)],c0.prototype,"muteLocal",null),bE([_S,kc("design:type",Function),kc("design:paramtypes",[Array]),kc("design:returntype",pE)],c0.prototype,"unmuteLocal",null),bE([_S,kc("design:type",Function),kc("design:paramtypes",[]),kc("design:returntype",void 0)],c0.prototype,"close",null),bE([_S,kc("design:type",Function),kc("design:paramtypes",[String,P0]),kc("design:returntype",pE)],c0.prototype,"updateEncoderConfig",null),bE([_S,kc("design:type",Function),kc("design:paramtypes",[String,P0]),kc("design:returntype",pE)],c0.prototype,"updateSendParameters",null),bE([_S,kc("design:type",Function),kc("design:paramtypes",[P0,String]),kc("design:returntype",pE)],c0.prototype,"replaceTrack",null),bE([_S,kc("design:type",Function),kc("design:paramtypes",[String]),kc("design:returntype",pE)],c0.prototype,"getRemoteSSRC",null);const t8=`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0
a=msid-semantic: WMS
a=ice-lite
m=application 9 UDP/DTLS/SCTP webrtc-datachannel
c=IN IP4 127.0.0.1
a=mid:0
`,EP="9",I2=2e4,w2=4e4;class Get{get localCapabilities(){return Q_(this._localCapabilities)}get rtpCapabilities(){return Q_(this._rtpCapabilities)}get candidates(){return Q_(this._candidates)}get iceParameters(){return Q_(this._iceParameters)}get dtlsParameters(){return Q_(this._dtlsParameters)}constructor(i){_e(this,"sessionDesc",void 0),_e(this,"_localCapabilities",void 0),_e(this,"_rtpCapabilities",void 0),_e(this,"_candidates",void 0),_e(this,"_iceParameters",void 0),_e(this,"_dtlsParameters",void 0),_e(this,"setup",void 0),_e(this,"currentMidIndex",void 0),_e(this,"cname",void 0),_e(this,"firefoxSsrcMidMap",new Map),i=Q_(i);const{remoteIceParameters:o,remoteDtlsParameters:p,candidates:g,remoteRTPCapabilities:b,remoteSetup:A,localCapabilities:j,cname:H}=i,z=q_.parse(t8);this._rtpCapabilities=b,this._candidates=g,this._iceParameters=o,this._dtlsParameters=p,this._localCapabilities=j,this.setup=A,this.cname=H;const $=this.rtpCapabilities.send;for(const Vt of z.mediaDescriptions){if(Vt.attributes.iceUfrag=o.iceUfrag,Vt.attributes.icePwd=o.icePwd,Vt.attributes.fingerprints=p.fingerprints,Vt.attributes.candidates=g,Vt.attributes.setup=A,Vt.media.mediaType==="application"&&(Vt.attributes.sctpPort="5000"),Vt.media.mediaType==="video"&&(Vt.media.fmts=$.videoCodecs.map(_r=>_r.payloadType.toString(10)),Vt.attributes.payloads=$.videoCodecs,Vt.attributes.extmaps=$.videoExtensions,nE("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:_r,ssrcGroups:Fi}=XS([{ssrcId:w2,rtx:nE("USE_SUB_RTX")?40001:void 0}],this.cname);Vt.attributes.ssrcs=_r,Vt.attributes.ssrcGroups=Fi}if(Vt.media.mediaType==="audio"&&(Vt.media.fmts=$.audioCodecs.map(_r=>_r.payloadType.toString(10)),Vt.attributes.payloads=$.audioCodecs,Vt.attributes.extmaps=$.audioExtensions,wR(Vt),nE("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:_r,ssrcGroups:Fi}=XS([{ssrcId:I2}],this.cname);Vt.attributes.ssrcs=_r,Vt.attributes.ssrcGroups=Fi}}this.sessionDesc=z,this.currentMidIndex=z.mediaDescriptions.length-1}updateRemoteRTPCapabilities(i){const o=q_.parse(t8);this._rtpCapabilities=i;const p=this.rtpCapabilities.send;for(const g of o.mediaDescriptions){if(g.attributes.iceUfrag=this._iceParameters.iceUfrag,g.attributes.icePwd=this._iceParameters.icePwd,g.attributes.fingerprints=this._dtlsParameters.fingerprints,g.attributes.candidates=this._candidates,g.attributes.setup=this.setup,g.media.mediaType==="application"&&(g.attributes.sctpPort="5000"),g.media.mediaType==="video"&&(g.media.fmts=p.videoCodecs.map(b=>b.payloadType.toString(10)),g.attributes.payloads=p.videoCodecs,g.attributes.extmaps=p.videoExtensions,nE("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:b,ssrcGroups:A}=XS([{ssrcId:w2,rtx:nE("USE_SUB_RTX")?40001:void 0}],this.cname);g.attributes.ssrcs=b,g.attributes.ssrcGroups=A}if(g.media.mediaType==="audio"&&(g.media.fmts=p.audioCodecs.map(b=>b.payloadType.toString(10)),g.attributes.payloads=p.audioCodecs,g.attributes.extmaps=p.audioExtensions,nE("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:b,ssrcGroups:A}=XS([{ssrcId:I2}],this.cname);g.attributes.ssrcs=b,g.attributes.ssrcGroups=A}}this.sessionDesc=o,this.currentMidIndex=o.mediaDescriptions.length-1}preloadRemoteMedia(i){this.rtpCapabilities;const o=this.candidates,p=this.dtlsParameters,g=this.iceParameters,b=this.rtpCapabilities.send;for(let A=1;A<i;A++){const j=2*A+I2,H=2*A+w2,{ssrcs:z,ssrcGroups:$}=XS([{ssrcId:j}],this.cname),{ssrcs:Vt,ssrcGroups:_r}=XS([{ssrcId:H,rtx:nE("USE_SUB_RTX")?H+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:EP,protos:["UDP","TLS","RTP","SAVPF"],fmts:b.videoCodecs.map(Fi=>Fi.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:g.iceUfrag,icePwd:g.icePwd,unrecognized:[],candidates:o,extmaps:b.videoExtensions,fingerprints:p.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:Vt,ssrcGroups:_r,rtcpFeedbackWildcards:[],payloads:b.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*A-1)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:EP,protos:["UDP","TLS","RTP","SAVPF"],fmts:b.audioCodecs.map(Fi=>Fi.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:g.iceUfrag,icePwd:g.icePwd,unrecognized:[],candidates:o,extmaps:b.audioExtensions,fingerprints:p.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:z,ssrcGroups:$,rtcpFeedbackWildcards:[],payloads:b.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*A)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return q_.print(this.sessionDesc)}send(i,o,p,g){const{ssrcs:b,ssrcGroups:A}=XS(o,this.cname,nE("SYNC_GROUP")?p:void 0),j=this.findPreloadMediaDesc(b);if(j){if(N_()&&this.firefoxSsrcMidMap.set(b[0].ssrcId,j.attributes.mid),g&&(g.twcc||g.remb)){const H=this.sessionDesc.mediaDescriptions.indexOf(j);return this.sessionDesc.mediaDescriptions[H]=this.mungSendMediaDesc(j,g),{mid:j.attributes.mid,needExchangeSDP:!0}}return{mid:j.attributes.mid,needExchangeSDP:!1}}{const H=this.findAvailableMediaIndex(i,b);let z;return H===-1||H0()||z0()||BV()||H===0&&nE("USE_SUB_RTX")?(z=this.createOrRecycleSendMedia(i,b,A,"sendonly",g),this.updateBundleMids()):(z=Q_(this.sessionDesc.mediaDescriptions[H]),z.attributes.direction="sendonly",z.attributes.ssrcs=b,z.attributes.ssrcGroups=A,this.sessionDesc.mediaDescriptions[H]=this.mungSendMediaDesc(z,g)),N_()&&this.firefoxSsrcMidMap.set(b[0].ssrcId,z.attributes.mid),{mid:z.attributes.mid,needExchangeSDP:!0}}}batchSend(i){const o=i.map(b=>{let{kind:A,ssrcMsg:j,mslabel:H}=b;return this.send(A,j,H)}),p=[];let g=!1;return o.forEach(b=>{let{mid:A,needExchangeSDP:j}=b;j&&(g=!0),p.push(A)}),{mids:p,needExchangeSDP:g}}stopSending(i){const o=this.sessionDesc.mediaDescriptions.filter(p=>p.attributes.mid&&i.indexOf(p.attributes.mid)!==-1);if(o.length!==i.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");o.forEach(p=>{p.attributes.mid==="0"||N_()||H0()||z0()?p.attributes.ssrcs=[]:(p.attributes.ssrcs=[],p.attributes.direction="inactive",p.media.port="0")}),this.updateBundleMids()}mute(i){const o=this.sessionDesc.mediaDescriptions.find(p=>p.attributes.mid===i);if(!o)throw new Error("mediaDescription not found with ".concat(i," in remote SDP when calling RemoteSDP.mute."));o.attributes.direction="inactive"}unmute(i){const o=this.sessionDesc.mediaDescriptions.find(p=>p.attributes.mid===i);if(!o)throw new Error("mediaDescription not found with ".concat(i," in remote SDP when calling RemoteSDP.unmute."));o.attributes.direction="sendonly"}muteRemote(i){const o=this.sessionDesc.mediaDescriptions.filter(p=>VE(i).call(i,p.attributes.mid||""));if(o.length!==i.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");o.forEach(p=>{p.attributes.direction="inactive"})}unmuteRemote(i){const o=this.sessionDesc.mediaDescriptions.filter(p=>VE(i).call(i,p.attributes.mid||""));if(o.length!==i.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");o.forEach(p=>{p.attributes.direction="recvonly"})}receive(i,o,p,g){i.forEach((b,A)=>{this.createOrRecycleRecvMedia(b,[],"recvonly",o,p,g[A])}),this.updateBundleMids()}stopReceiving(i){const o=this.sessionDesc.mediaDescriptions.filter(p=>i.indexOf(p.attributes.mid)!==-1);if(o.length!==i.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");o.forEach(p=>{p.media.port="0",p.attributes.direction="inactive"}),this.updateBundleMids()}updateCandidates(i){i===N0.TCP?this._candidates.forEach(o=>{this._candidates.findIndex(p=>p.transport==="tcp"&&p.connectionAddress===o.connectionAddress&&p.port===o.port)===-1&&this._candidates.push(_q(_q({},o),{},{foundation:"tcpcandidate",priority:Number(o.priority)-1+"",transport:"tcp",port:Number(o.port)+90+""}))}):this._candidates=this._candidates.filter(o=>o.transport!=="tcp");for(const o of this.sessionDesc.mediaDescriptions)o.attributes.candidates=this.candidates}restartICE(i){i=Q_(i),this._iceParameters=i,this.sessionDesc.mediaDescriptions.forEach(o=>{o.attributes.iceUfrag=i.iceUfrag,o.attributes.icePwd=i.icePwd})}predictReceivingMids(i){const o=[];for(let p=0;p<i;p++)o.push((this.currentMidIndex+p+1).toString(10));return o}findAvailableMediaIndex(i,o){return this.sessionDesc.mediaDescriptions.findIndex(p=>{const g=p.media.mediaType===i&&p.media.port!=="0"&&(p.attributes.direction==="sendonly"||p.attributes.direction==="sendrecv")&&p.attributes.ssrcs.length===0;if(N_()){if(g){const b=this.firefoxSsrcMidMap.get(o[0].ssrcId);return!(b||p.attributes.mid!=="0"&&p.attributes.mid!=="1")||!(!b||b!==p.attributes.mid)}return!1}return g})}createOrRecycleRecvMedia(i,o,p,g,b,A){const j=i._mediaStreamTrack.kind,H=this.rtpCapabilities.recv,z=mP(j,H,this.localCapabilities.send,j===ME.VIDEO?g:b),$=j===ME.VIDEO?H.videoExtensions:H.audioExtensions;this.currentMidIndex+=1;const Vt="".concat(this.currentMidIndex);let _r={media:{mediaType:j,port:EP,protos:["UDP","TLS","RTP","SAVPF"],fmts:z.map(_l=>_l.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:$,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:o,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:z,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:p,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(Vt)}};_r=this.mungRecvMediaDsec(_r,i,A);const Fi=this.findFirstClosedMedia(j);if(Fi){const _l=this.sessionDesc.mediaDescriptions.indexOf(Fi);this.sessionDesc.mediaDescriptions[_l]=_r}else this.sessionDesc.mediaDescriptions.push(_r);return _r}updateRemoteCodec(i,o,p){const g=[...new Set(this._rtpCapabilities.recv.videoCodecs.map(_r=>_r.rtpMap&&_r.rtpMap.encodingName.toLowerCase()||"").filter(_r=>{var Fi;return VE(Fi=Object.keys(eI)).call(Fi,_r)}))],b=new Set(o);if(g.every(_r=>b.has(_r)))return Gi.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(o)),!1;const A=this._rtpCapabilities.recv.videoCodecs.filter(_r=>o.some(Fi=>{var _l;return VE(_l=_r.rtpMap&&_r.rtpMap.encodingName.toLowerCase()||"").call(_l,Fi)}));if(A.length===0)return Gi.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(g," codecs: ").concat(o)),!1;const j=[...new Set(A.map(_r=>_r.rtpMap&&_r.rtpMap.encodingName.toLowerCase()||""))];let H;if(Gi.debug("updateRemoteCodec, from ".concat(g," to ").concat(j)),i.length===0)H=this.sessionDesc.mediaDescriptions.filter(_r=>_r.media.mediaType==="video"&&_r.attributes.direction==="recvonly");else if(H=this.sessionDesc.mediaDescriptions.filter(_r=>_r.attributes.mid&&VE(i).call(i,_r.attributes.mid)&&_r.attributes.direction==="recvonly"),H.length!==i.length)return Gi.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(i,", codecs: ").concat(o)),!1;this._rtpCapabilities.recv.videoCodecs=A;const z=this.localCapabilities.send,$=this.rtpCapabilities.recv,Vt=mP(ME.VIDEO,$,z,p);return H.forEach(_r=>{const Fi=Vt.map(_l=>_l.payloadType.toString(10));Gi.debug("updateRemoteCodec mid: ".concat(_r.attributes.mid,", from ").concat(_r.attributes.payloads," to ").concat(Vt)),_r.attributes.payloads=Vt,_r.media.fmts=Fi}),!0}createOrRecycleSendMedia(i,o,p,g,b){const A=this.rtpCapabilities.send,j=i===ME.VIDEO?A.videoCodecs:A.audioCodecs,H=i===ME.VIDEO?A.videoExtensions:A.audioExtensions;this.currentMidIndex+=1;const z="".concat(this.currentMidIndex);let $={media:{mediaType:i,port:EP,protos:["UDP","TLS","RTP","SAVPF"],fmts:j.map(_r=>_r.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:H,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:o,ssrcGroups:p,rtcpFeedbackWildcards:[],payloads:j,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:g,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(z)}};$=this.mungSendMediaDesc($,b);const Vt=this.findFirstClosedMedia(i);if(Vt){const _r=this.sessionDesc.mediaDescriptions.indexOf(Vt);this.sessionDesc.mediaDescriptions[_r]=$}else this.sessionDesc.mediaDescriptions.push($);return $}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(i=>i.media.port!=="0").map(i=>i.attributes.mid)}mungRecvMediaDsec(i,o,p){const g=Q_(i);return y2(g),gI(g,o),b2(g,o),L5(g),dP(g,p,this.localCapabilities.send),g}mungSendMediaDesc(i,o){const p=Q_(i);return dP(p,o,this.localCapabilities.recv),wR(p),p}updateRecvMedia(i,o){const p=this.sessionDesc.mediaDescriptions.findIndex(g=>g.attributes.mid===i);if(p!==-1){const g=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[p],o);this.sessionDesc.mediaDescriptions[p]=g}}bumpMid(i){this.currentMidIndex+=i}findFirstClosedMedia(i){return this.sessionDesc.mediaDescriptions.find(o=>N_()?o.media.port==="0"&&o.media.mediaType===i:o.media.port==="0")}findPreloadMediaDesc(i){return this.sessionDesc.mediaDescriptions.find(o=>{var p;return((p=o.attributes)===null||p===void 0||(p=p.ssrcs[0])===null||p===void 0?void 0:p.ssrcId)===i[0].ssrcId})}getSSRC(i){var o;return(o=this.sessionDesc.mediaDescriptions.find(p=>p.attributes.mid===i))===null||o===void 0?void 0:o.attributes.ssrcs}}function e8(l,i){var o=Object.keys(l);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(l);i&&(p=p.filter(function(g){return Object.getOwnPropertyDescriptor(l,g).enumerable})),o.push.apply(o,p)}return o}function vP(l){for(var i=1;i<arguments.length;i++){var o=arguments[i]!=null?arguments[i]:{};i%2?e8(Object(o),!0).forEach(function(p){_e(l,p,o[p])}):Object.getOwnPropertyDescriptors?Object.defineProperties(l,Object.getOwnPropertyDescriptors(o)):e8(Object(o)).forEach(function(p){Object.defineProperty(l,p,Object.getOwnPropertyDescriptor(o,p))})}return l}class L0 extends ON{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}constructor(i,o,p){super(i,o),_e(this,"store",void 0),_e(this,"peerConnection",void 0),_e(this,"remoteSDP",void 0),_e(this,"initialOffer",void 0),_e(this,"transportEventReceiver",void 0),_e(this,"statsFilter",void 0),_e(this,"useXR",nE("USE_XR")),_e(this,"localCapabilities",void 0),_e(this,"localCandidateCount",0),_e(this,"allCandidatesReceived",!1),_e(this,"remoteCodecs",void 0),_e(this,"dataStreamChannelMap",new Map),_e(this,"establishPromise",void 0),_e(this,"mutex",new E0("NVExtentionsConnection-mutex")),_e(this,"rtcMedia",void 0),this.store=o,this.peerConnection=p,this.statsFilter=gP(this.peerConnection,nE("STATS_UPDATE_INTERVAL"),void 0,N_()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(i){try{const o=await this.peerConnection.createOffer();if(!o.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const p=mI(o.sdp),g=await x5({filterRTX:!nE("USE_PUB_RTX")&&!nE("USE_SUB_RTX"),filterVideoFec:nE("FILTER_VIDEO_FEC"),filterAudioFec:nE("FILTER_AUDIO_FEC"),filterVideoCodec:nE("FILTER_VIDEO_CODEC")},{useXR:this.useXR});return this.localCapabilities=g,this.initialOffer=o,vP(vP({},p),{},{rtpCapabilities:g,offerSDP:o.sdp})}catch(o){throw new hE(_p.GET_LOCAL_CONNECTION_PARAMS_FAILED,o.toString())}}async connect(i,o,p,g,b,A){try{if(!this.initialOffer)throw new Error("Cannot establish NVConnection without initial offer.");this.remoteSDP=new Get({remoteIceParameters:i,remoteDtlsParameters:o,candidates:p,remoteRTPCapabilities:g,remoteSetup:b,localCapabilities:pP(this.localCapabilities),cname:A});const j=this.remoteSDP.toString(),H=q_.parse(this.initialOffer.sdp),z=H.mediaDescriptions.find(_r=>_r.media.mediaType==="audio");z&&wR(z),this.useXR&&fP(H);const $=q_.print(H),Vt=this.logSDPExchange($||"","offer","local","connect");await this.peerConnection.setLocalDescription({type:"offer",sdp:$}),Vt==null||Vt(j),await this.peerConnection.setRemoteDescription({type:"answer",sdp:j})}catch(j){throw new hE(_p.EXCHANGE_SDP_FAILED,"NV.connect failed; ".concat(j.toString()))}}async updateRemoteRTPCapabilities(i,o){let p;this.remoteCodecs=o,this.localCapabilities&&(p=pP(this.localCapabilities));const g=[...new Set(p&&p.send.videoCodecs.map(b=>b.rtpMap&&b.rtpMap.encodingName.toLowerCase()||"").filter(b=>{var A;return VE(A=Object.keys(eI)).call(A,b)}))];if(jE.updateRemoteRTPCapabilities(this.store.sessionId,{mids:i,localCodecs:g,remoteCodecs:this.remoteCodecs}),!this.remoteSDP)return void Gi.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(g,", codecs: ").concat(o));if(this.remoteSDP.updateRemoteCodec(i,o,this.store.codec)){const b=await this.peerConnection.createOffer(),A=this.logSDPExchange(b.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(b);const j=this.remoteSDP.toString();A==null||A(j),await this.peerConnection.setRemoteDescription({type:"answer",sdp:j})}else Gi.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.")}async updateRemoteConnect(i){var o,p,g,b;(o=this.remoteSDP)===null||o===void 0||o.updateRemoteRTPCapabilities(i),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&((b=this.remoteSDP)===null||b===void 0||b.updateRemoteCodec([],this.remoteCodecs,this.store.codec)),(p=this.remoteSDP)===null||p===void 0||p.preloadRemoteMedia(2);const A=(g=this.remoteSDP)===null||g===void 0?void 0:g.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:A});const j=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(j),Gi.debug("[NVExtentionsConnection] updateRemoteRTPCapabilities by exchanging SDP.")}send(i,o,p){var g=this;return JS(function*(){const b=yield d_(g.mutex.lock("From NVExtentionsConnection.send"));try{if(!g.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.send before remote SDP created");const A=[];i.forEach(_u=>{const _h=g.peerConnection.addTransceiver(_u._mediaStreamTrack,{direction:"sendonly"});A.push(_h)}),N_()&&nE("SIMULCAST")===!0&&(yield d_(g.applySimulcastForFirefox(A,i)));const j=yield d_(g.peerConnection.createOffer()),H=g.remoteSDP.predictReceivingMids(i.length),z=g.mungSendOfferSDP(j.sdp,i,H),$=q_.parse(z),Vt=H.map(_u=>{const _h=$.mediaDescriptions.find(_g=>_g.attributes.mid===_u);if(!_h)throw new Error("Cannot extract ssrc from mediaDescription.");return k5(_h,nE("USE_PUB_RTX"))});let _r;try{_r=yield Vt}catch(_u){_r=[],g.remoteSDP.receive(i,o,p,_r);const _h=g.remoteSDP.toString();throw yield d_(g.peerConnection.setLocalDescription({type:"offer",sdp:z})),yield d_(g.peerConnection.setRemoteDescription({type:"answer",sdp:_h})),yield d_(g.stopSending(H,!0)),_u}g.remoteSDP.receive(i,o,p,_r);const Fi=g.remoteSDP.toString(),_l=g.logSDPExchange(z,"offer","local","send");return yield d_(g.peerConnection.setLocalDescription({type:"offer",sdp:z})),yield d_(g.applySimulcastEncodings(A,i)),yield d_(g.applySendEncodings(A,i)),_l==null||_l(Fi),yield d_(g.peerConnection.setRemoteDescription({type:"answer",sdp:Fi})),A.map((_u,_h)=>{const _g=H[_h];return{localSSRC:Vt[_h],id:_g,transceiver:_u}})}catch(A){throw A instanceof hE?A:new hE(_p.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.send failed; ".concat(A.toString()))}finally{b()}})()}async stopSending(i,o){const p=o?void 0:await this.mutex.lock("From NVExtentionsConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.stopSending before remote SDP created");const g=this.peerConnection.getTransceivers().filter(H=>i.indexOf(H.mid)!==-1);if(g.length!==i.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call NVExtentionsConnection.stopSending.");g.map(H=>{var z;H.direction="inactive",(z=H.stop)===null||z===void 0||z.call(H)});const b=await this.peerConnection.createOffer(),A=this.logSDPExchange(b.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(b),this.remoteSDP.stopReceiving(i);const j=this.remoteSDP.toString();A==null||A(j),await this.peerConnection.setRemoteDescription({type:"answer",sdp:j})}catch(g){throw new hE(_p.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.stopSending failed; ".concat(g.toString()))}finally{p&&p()}}async createDataChannels(i,o){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.createDataChannels before remote SDP created");let p=this.dataStreamChannelMap.get(i);return p&&p.readyState==="open"?Gi.debug("[P2PConnection] Channels are already available and can be reused directly."):(p=this.peerConnection.createDataChannel("datastream-channel",{ordered:!1,maxRetransmits:nE("DATASTREAM_MAX_RETRANSMITS")}),p.binaryType="arraybuffer",this.dataStreamChannelMap.set(i,p)),void o.forEach(g=>{g._updateOriginDataChannel(p)})}catch(p){throw p instanceof hE?p:new hE(_p.DATACHANNEL_FAILED,"NVExtentionsConnection.createDataChannels failed; ".concat(p.toString()))}}async stopDataChannels(i){try{const o=this.dataStreamChannelMap.get(i);return o==null||o.close(),void this.dataStreamChannelMap.delete(i)}catch(o){throw o instanceof hE?o:new hE(_p.DATACHANNEL_FAILED,"NVExtentionsConnection.stopDataChannels failed; ".concat(o.toString()))}}async receive(i,o,p,g){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.receive ".concat(i," before remoteSDP created."));const{mid:b,needExchangeSDP:A}=this.remoteSDP.send(i,o,p,g);if(A){const H=this.remoteSDP.toString(),z=this.logSDPExchange(H,"offer","remote","receive");await this.peerConnection.setRemoteDescription({type:"offer",sdp:H});const $=await this.peerConnection.createAnswer(),Vt=this.mungReceiveAnswerSDP($.sdp,b,i);z==null||z(Vt||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:Vt}),Gi.debug("[NVExtentionsConnection] receive ".concat(i," by exchanging SDP."))}else Gi.debug("[NVExtentionsConnection] receive ".concat(i," no need to exchange SDP."));const j=this.peerConnection.getTransceivers().find(H=>H.mid===b);if(!j)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:j.receiver.track,id:b}}catch(b){throw new hE(_p.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.receive failed; ".concat(b.toString()))}}async batchReceive(i){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.batchReceive before remoteSDP created.");const{mids:o,needExchangeSDP:p}=this.remoteSDP.batchSend(i);if(p){const g=this.remoteSDP.toString(),b=this.logSDPExchange(g,"offer","remote","receive");await this.peerConnection.setRemoteDescription({type:"offer",sdp:g});const A=await this.peerConnection.createAnswer();b==null||b(A.sdp||""),await this.peerConnection.setLocalDescription(A),Gi.debug("[NVExtentionsConnection] batchReceive by exchanging SDP.")}else Gi.debug("[NVExtentionsConnection] batchReceive no need to exchange SDP.");return o.map(g=>{const b=this.peerConnection.getTransceivers().find(A=>A.mid===g);if(!b)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:b.receiver.track,id:g}})}catch(o){throw new hE(_p.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.receive failed; ".concat(o.toString()))}}async stopReceiving(i){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(i);const o=this.remoteSDP.toString(),p=this.logSDPExchange(o,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:o});const g=await this.peerConnection.createAnswer();p==null||p(g.sdp||""),await this.peerConnection.setLocalDescription(g)}catch(o){throw new hE(_p.EXCHANGE_SDP_FAILED,"NVExtentionsConnection stopReceiving failed; ".concat(o.toString()))}}async muteRemote(i){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.muteRemote mid=".concat(i," before remote SDP created."));this.remoteSDP.mute(i);const o=this.remoteSDP.toString(),p=this.logSDPExchange(o,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:o});const g=await this.peerConnection.createAnswer();p==null||p(g.sdp||""),await this.peerConnection.setLocalDescription(g)}catch(o){throw new hE(_p.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.muteRemote failed; ".concat(o.toString()))}}async unmuteRemote(i){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.unmuteRemote mid=".concat(i," before remote SDP created."));this.remoteSDP.unmute(i);const o=this.remoteSDP.toString(),p=this.logSDPExchange(o,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:o});const g=await this.peerConnection.createAnswer();p==null||p(g.sdp||""),await this.peerConnection.setLocalDescription(g)}catch(o){throw new hE(_p.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.unmuteRemote failed; ".concat(o.toString()))}}async muteLocal(i){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.muteLocal before remote SDP created.");const o=this.peerConnection.getTransceivers().filter(A=>A.mid&&i.indexOf(A.mid)!==-1);if(o.length!==i.length)throw new Error("Transceivers' length doesn't match mids' length.");o.map(A=>{A.direction="inactive"});const p=await this.peerConnection.createOffer(),g=this.logSDPExchange(p.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(p),this.remoteSDP.muteRemote(i);const b=this.remoteSDP.toString();g==null||g(b),await this.peerConnection.setRemoteDescription({type:"answer",sdp:b})}catch(o){throw new hE(_p.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.muteLocal failed; ".concat(o.toString()))}}async unmuteLocal(i){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.unmuteLocal before remote SDP created.");const o=this.peerConnection.getTransceivers().filter(A=>A.mid&&i.indexOf(A.mid)!==-1);if(o.length!==i.length)throw new Error("Transceivers' length doesn't match mids' length.");o.map(async(A,j)=>{A.direction="sendonly"});const p=await this.peerConnection.createOffer(),g=this.logSDPExchange(p.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(p),this.remoteSDP.unmuteRemote(i);const b=this.remoteSDP.toString();g==null||g(b),await this.peerConnection.setRemoteDescription({type:"answer",sdp:b})}catch(o){throw new hE(_p.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.unmuteLocal failed; ".concat(o.toString()))}}restartICE(i){var o=this;return JS(function*(){const p=yield d_(o.mutex.lock("From NVExtentionsConnection.restartICE"));try{if(!o.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if(I_().supportPCSetConfiguration){const z=o.peerConnection.getConfiguration(),$=i===N0.RELAY?"relay":"all";z.iceTransportPolicy!==$&&(Gi.debug("restartICE change iceTransportPolicy from [".concat(z.iceTransportPolicy,"] to [").concat($,"]")),z.iceTransportPolicy=$,o.peerConnection.setConfiguration(z))}else if(i===N0.RELAY)return;i!==N0.RELAY&&o.remoteSDP.updateCandidates(i);const g=yield d_(o.peerConnection.createOffer({iceRestart:!0}));if(!g.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const b=mI(g.sdp),{remoteIceParameters:A}=yield b.iceParameters;o.remoteSDP.restartICE(A);const j=o.remoteSDP.toString(),H=o.logSDPExchange(g.sdp||"","offer","local","restartICE");yield d_(o.peerConnection.setLocalDescription(g)),H==null||H(j),yield d_(o.peerConnection.setRemoteDescription({type:"answer",sdp:j}))}catch(g){Gi.warning("restart ICE failed, abort operation",g)}finally{p()}})()}close(){var i;(i=this.onConnectionStateChange)===null||i===void 0||i.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(i){return this.statsFilter.getVideoIsReady(i)}async updateEncoderConfig(i,o){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.updateEncoderConfig before remote SDP created.");const p=await this.peerConnection.createOffer(),g=this.mungSendOfferSDP(p.sdp,[o],[i]);this.remoteSDP.updateRecvMedia(i,o);const b=this.remoteSDP.toString(),A=this.logSDPExchange(g,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:g}),A==null||A(b),await this.peerConnection.setRemoteDescription({type:"answer",sdp:b})}catch(p){throw new hE(_p.EXCHANGE_SDP_FAILED,p.toString())}}async updateSendParameters(i,o){const p=this.peerConnection.getTransceivers().filter(g=>g.mid===i);p.length===1&&(this.isVP8Simulcast(o)?N_()||await this.applySimulcastEncodings(p,[o]):await this.applySendEncodings(p,[o]))}setStatsRemoteVideoIsReady(i,o){this.statsFilter.setVideoIsReady2(i,o)}async replaceTrack(i,o){const p=this.peerConnection.getTransceivers().find(g=>g.mid===o);p&&await p.sender.replaceTrack(i._mediaStreamTrack)}getP2PConnectionParams(){var i;if((i=this.peerConnection.currentLocalDescription)===null||i===void 0||!i.sdp||!this.localCapabilities)throw new Error;return vP(vP({},mI(this.peerConnection.currentLocalDescription.sdp)),{},{rtpCapabilities:this.localCapabilities})}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var i;(i=this.onICEConnectionStateChange)===null||i===void 0||i.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var i;(i=this.onConnectionStateChange)===null||i===void 0||i.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=i=>{i.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,Gi.debug("[pc-".concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,Gi.debug("[pc-".concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},nE("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(i){const o={iceServers:[]};return i.iceServers?o.iceServers=i.iceServers:i.turnServer&&i.turnServer.mode!=="off"&&(VI(i.turnServer.servers)?o.iceServers=i.turnServer.servers:(o.iceServers&&o.iceServers.push(...L0.turnServerConfigToIceServers(i.turnServer.servers)),nE("USE_TURN_SERVER_OF_GATEWAY")&&o.iceServers&&i.turnServer.serversFromGateway&&o.iceServers.push(...L0.turnServerConfigToIceServers(i.turnServer.serversFromGateway)),nE("FORCE_TURN_TCP")?o.iceTransportPolicy="relay":i.turnServer.servers.concat(i.turnServer.serversFromGateway||[]).forEach(p=>{p.forceturn&&(o.iceTransportPolicy="relay")}))),o}static turnServerConfigToIceServers(i){const o=[];return i.forEach(p=>{p.security?p.tcpport&&o.push({username:p.username,credential:p.password,credentialType:"password",urls:"turns:".concat(d1(p.turnServerURL),":").concat(p.tcpport,"?transport=tcp")}):(p.udpport&&!nE("FORCE_TURN_TCP")&&o.push({username:p.username,credential:p.password,credentialType:"password",urls:"turn:".concat(p.turnServerURL,":").concat(p.udpport,"?transport=udp")}),p.tcpport&&o.push({username:p.username,credential:p.password,credentialType:"password",urls:"turn:".concat(p.turnServerURL,":").concat(p.tcpport,"?transport=tcp")}))}),o}async applySendEncodings(i,o){try{if(!I_().supportSetRtpSenderParameters||i.length!==o.length)return;for(let Vt=0;Vt<i.length;Vt++){const _r=i[Vt],Fi=o[Vt];if(Fi&&Fi instanceof ZE){var p,g,b;if(this.isVP8Simulcast(Fi))continue;const _l={},_u={};switch(Fi._optimizationMode){case"motion":_l.degradationPreference="maintain-framerate";break;case"detail":_l.degradationPreference="maintain-resolution";break;default:_l.degradationPreference="balanced"}var A,j,H,z;if((p=Fi._encoderConfig)!==null&&p!==void 0&&p.bitrateMax&&(_u.maxBitrate=1e3*((A=Fi._encoderConfig)===null||A===void 0?void 0:A.bitrateMax)),VE(g=Fi._hints).call(g,A_.LOW_STREAM)&&((j=Fi._encoderConfig)!==null&&j!==void 0&&j.frameRate&&(_u.maxFramerate=US(Fi._encoderConfig.frameRate)),(H=Fi._encoderConfig)!==null&&H!==void 0&&H.scaleResolutionDownBy&&((z=Fi._encoderConfig)===null||z===void 0?void 0:z.scaleResolutionDownBy)>1&&(_u.scaleResolutionDownBy=Fi._encoderConfig.scaleResolutionDownBy)),nE("DSCP_TYPE")&&lR()){var $;const eE=nE("DSCP_TYPE");VE($=["very-low","low","medium","high"]).call($,eE)&&(_u.networkPriority=eE)}const _h=_r.sender.getParameters(),_g=(b=_h.encodings)===null||b===void 0?void 0:b[0];N_()&&!_g&&(_l.encodings=[_u]),_g&&Object.assign(_g,_u),Object.assign(_h,_l),await _r.sender.setParameters(_h)}}}catch{Gi.debug("Apply RTPSendEncodings failed.")}}mungSendOfferSDP(i,o,p){const g=q_.parse(i);return o.forEach((b,A)=>{const j=p[A],H=g.mediaDescriptions.find(z=>z.attributes.mid===j);H&&(gI(H,b),S2(H,b,this.store.codec))}),q_.print(g)}mungReceiveAnswerSDP(i,o,p){const g=q_.parse(i),b=g.mediaDescriptions.find(A=>A.attributes.mid===o);return b&&p===ME.AUDIO&&b.media.mediaType==="audio"&&wR(b),this.useXR&&fP(g),q_.print(g)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=i=>{var o;(o=this.onFirstAudioReceived)===null||o===void 0||o.call(this,i)},this.statsFilter.onFirstVideoReceived=i=>{var o;(o=this.onFirstVideoReceived)===null||o===void 0||o.call(this,i)},this.statsFilter.onFirstAudioDecoded=i=>{var o;(o=this.onFirstAudioDecoded)===null||o===void 0||o.call(this,i)},this.statsFilter.onFirstVideoDecoded=(i,o,p)=>{var g;(g=this.onFirstVideoDecoded)===null||g===void 0||g.call(this,i,o,p)},this.statsFilter.onSelectedLocalCandidateChanged=(i,o)=>{var p;(p=this.onSelectedLocalCandidateChanged)===null||p===void 0||p.call(this,i,o)},this.statsFilter.onSelectedRemoteCandidateChanged=(i,o)=>{var p;(p=this.onSelectedRemoteCandidateChanged)===null||p===void 0||p.call(this,i,o)},this.statsFilter.onFirstVideoDecodedTimeout=i=>{var o;(o=this.onFirstVideoDecodedTimeout)===null||o===void 0||o.call(this,i)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(i,o){if(i.length===o.length)for(let H=0;H<i.length;H++){var p,g,b,A,j;const z=i[H],$=o[H];if($ instanceof ZE&&!VE(p=$._hints).call(p,A_.LOW_STREAM)&&(g=$._encoderConfig)!==null&&g!==void 0&&g.bitrateMax&&((b=$._encoderConfig)===null||b===void 0?void 0:b.bitrateMax)>200&&(A=$._scalabilityMode)!==null&&A!==void 0&&A.numSpatialLayers&&((j=$._scalabilityMode)===null||j===void 0?void 0:j.numSpatialLayers)>1&&this.store.codec==="vp8"){const Vt={},_r={high:1e3*($._encoderConfig.bitrateMax-50),medium:5e4};Vt.encodings=[{rid:"m",active:!0,maxBitrate:_r.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:_r.high}];const Fi=z.sender.getParameters();await z.sender.setParameters(Object.assign(Fi,Vt))}}}async applySimulcastEncodings(i,o){if(!N_()&&i.length===o.length)for(let p=0;p<i.length;p++){const g=o[p];if(g instanceof ZE&&this.isVP8Simulcast(g)){const b=i[p],A={},j={high:1e3*(g._encoderConfig.bitrateMax-50),medium:5e4};A.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:j.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:j.medium,scaleResolutionDownBy:4}];const H=b.sender.getParameters();await b.sender.setParameters(Object.assign(H,A))}}}isVP8Simulcast(i){var o,p,g,b,A;return!!(i instanceof ZE&&nE("SIMULCAST")&&this.store.codec==="vp8"&&!VE(o=i._hints).call(o,A_.LOW_STREAM)&&(p=i._encoderConfig)!==null&&p!==void 0&&p.bitrateMax&&((g=i._encoderConfig)===null||g===void 0?void 0:g.bitrateMax)>200&&(b=i._scalabilityMode)!==null&&b!==void 0&&b.numSpatialLayers&&((A=i._scalabilityMode)===null||A===void 0?void 0:A.numSpatialLayers)>1)}logSDPExchange(i,o,p,g){if(nE("SDP_LOGGING"))return Gi.upload("exchanging ".concat(p," ").concat(o," SDP during NVExtentionsConnection.").concat(g,`
`),i),o==="offer"?b=>{this.logSDPExchange(b,"answer",p==="local"?"remote":"local",g)}:void 0}async getRemoteSSRC(i){if(!this.remoteSDP)return;const o=this.remoteSDP.getSSRC(i);return o==null?void 0:o[0].ssrcId}setConfiguration(i){if(I_().supportPCSetConfiguration){const o=L0.resolvePCConfiguration(i);this.peerConnection.setConfiguration(o)}}}function hS(l,i,o){const p=l[i];if(typeof p!="function")throw new Error("Cannot use mutex on object property.");return o.value=async function(){const g=this.mutex,b=await g.lock("From NVExtentionsConnection.".concat(i));try{for(var A=arguments.length,j=new Array(A),H=0;H<A;H++)j[H]=arguments[H];return await p.apply(this,j)}finally{b()}},o}function n8(l){var i,o,p,g=2;for(typeof Symbol<"u"&&(o=A5,p=Symbol.iterator);g--;){if(o&&(i=l[o])!=null)return i.call(l);if(p&&(i=l[p])!=null)return new _P(i.call(l));o="@@asyncIterator",p="@@iterator"}throw new TypeError("Object is not async iterable")}function _P(l){function i(o){if(Object(o)!==o)return pE.reject(new TypeError(o+" is not an object."));var p=o.done;return pE.resolve(o.value).then(function(g){return{value:g,done:p}})}return _P=function(o){this.s=o,this.n=o.next},_P.prototype={s:null,n:null,next:function(){return i(this.n.apply(this.s,arguments))},return:function(o){var p=this.s.return;return p===void 0?pE.resolve({value:o,done:!0}):i(p.apply(this.s,arguments))},throw:function(o){var p=this.s.return;return p===void 0?pE.reject(o):i(p.apply(this.s,arguments))}},new _P(l)}bE([hS,kc("design:type",Function),kc("design:paramtypes",[Object,Object,Array,Object,String,String]),kc("design:returntype",pE)],L0.prototype,"connect",null),bE([hS,kc("design:type",Function),kc("design:paramtypes",[Array,Array]),kc("design:returntype",pE)],L0.prototype,"updateRemoteRTPCapabilities",null),bE([hS,kc("design:type",Function),kc("design:paramtypes",[Object]),kc("design:returntype",pE)],L0.prototype,"updateRemoteConnect",null),bE([hS,kc("design:type",Function),kc("design:paramtypes",[Object,Array]),kc("design:returntype",pE)],L0.prototype,"createDataChannels",null),bE([hS,kc("design:type",Function),kc("design:paramtypes",[String,Array,String,Object]),kc("design:returntype",pE)],L0.prototype,"receive",null),bE([hS,kc("design:type",Function),kc("design:paramtypes",[Array]),kc("design:returntype",pE)],L0.prototype,"batchReceive",null),bE([hS,kc("design:type",Function),kc("design:paramtypes",[Array]),kc("design:returntype",pE)],L0.prototype,"stopReceiving",null),bE([hS,kc("design:type",Function),kc("design:paramtypes",[String]),kc("design:returntype",pE)],L0.prototype,"muteRemote",null),bE([hS,kc("design:type",Function),kc("design:paramtypes",[String]),kc("design:returntype",pE)],L0.prototype,"unmuteRemote",null),bE([hS,kc("design:type",Function),kc("design:paramtypes",[Array]),kc("design:returntype",pE)],L0.prototype,"muteLocal",null),bE([hS,kc("design:type",Function),kc("design:paramtypes",[Array]),kc("design:returntype",pE)],L0.prototype,"unmuteLocal",null),bE([hS,kc("design:type",Function),kc("design:paramtypes",[]),kc("design:returntype",void 0)],L0.prototype,"close",null),bE([hS,kc("design:type",Function),kc("design:paramtypes",[String,P0]),kc("design:returntype",pE)],L0.prototype,"updateEncoderConfig",null),bE([hS,kc("design:type",Function),kc("design:paramtypes",[String,P0]),kc("design:returntype",pE)],L0.prototype,"updateSendParameters",null),bE([hS,kc("design:type",Function),kc("design:paramtypes",[P0,String]),kc("design:returntype",pE)],L0.prototype,"replaceTrack",null),bE([hS,kc("design:type",Function),kc("design:paramtypes",[String]),kc("design:returntype",pE)],L0.prototype,"getRemoteSSRC",null);class u0 extends ON{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}constructor(i,o){super(i,o),_e(this,"store",void 0),_e(this,"peerConnection",void 0),_e(this,"cname",void 0),_e(this,"mutex",new E0("DataChannelConnection-mutex")),_e(this,"dataChannel",void 0),_e(this,"_p2pConnection",void 0),_e(this,"establishPromise",void 0),_e(this,"_nvMedia",void 0),this.store=o,this.store.dcId=this.store.dcId+1,this.peerConnection=new RTCPeerConnection(u0.resolvePCConfiguration(i),{optional:[{googDscp:!0}]}),this.dataChannel=this.peerConnection.createDataChannel("agora-signal",{ordered:!1,maxPacketLifeTime:50}),this.dataChannel.binaryType="arraybuffer",this._p2pConnection=new L0(i,o,this.peerConnection),this.bindPCEvents(),this.establishPromise=this._p2pConnection.establishPromise}async establish(){var i;const o=(i=this._nvMedia)===null||i===void 0?void 0:i.getLocalRtpCapabilities();return await this._p2pConnection.establish(o)}getP2PConnectionParams(){return this._p2pConnection.getP2PConnectionParams()}async connect(i,o,p,g,b,A){return this.cname=A,await this._p2pConnection.connect(i,o,p,g,b,A),await new pE((j,H)=>{const z=setTimeout(()=>{this.closeSignal(),H(new hE(_p.DATACHANNEL_CONNECTION_TIMEOUT,"Datachannel connection timed out, candidates: ".concat(JSON.stringify(p))))},2e3);this.dataChannel.onopen=()=>{if(this.dataChannel.readyState==="open")return clearTimeout(z),void j()},this.dataChannel.onerror=$=>{this.closeSignal(),H($)}}),{transmitter:this.dataChannel,close:this.closeSignal.bind(this)}}async updateRemoteRTPCapabilities(i,o){return this._p2pConnection.updateRemoteRTPCapabilities(i,o)}send(i,o,p){var g=this;return JS(function*(){const b=yield d_(g.mutex.lock("From DataChannelConnection.send"));try{return yield*lP(n8(g._p2pConnection.send(i,o,p)))}finally{b()}})()}async stopSending(i,o){return this._p2pConnection.stopSending(i,o)}async createDataChannels(i,o){return this._p2pConnection.createDataChannels(i,o)}async stopDataChannels(i){return this._p2pConnection.stopDataChannels(i)}async receive(i,o,p,g){return this._nvMedia?(Gi.debug("[DataChannelConnection] receive ".concat(i," by DataChannel.")),await this._nvMedia.reveiveByRTCMedia(i,o,this.cname)):(Gi.debug("[DataChannelConnection] receive ".concat(i," by WebRTC.")),await this._p2pConnection.receive(i,o,p,g))}async batchReceive(i){return[...await this._p2pConnection.batchReceive(i)]}async stopReceiving(i){return await this._p2pConnection.stopReceiving(i)}async muteRemote(i){return await this._p2pConnection.muteRemote(i)}async unmuteRemote(i){return await this._p2pConnection.unmuteRemote(i)}async muteLocal(i){return await this._p2pConnection.muteLocal(i)}async unmuteLocal(i){return await this._p2pConnection.unmuteLocal(i)}restartICE(i){var o=this;return JS(function*(){return yield*lP(n8(o._p2pConnection.restartICE(i)))})()}close(){var i;(i=this._nvMedia)===null||i===void 0||i.close(),this._p2pConnection.close(),this.unbindConnectionEvents(this._p2pConnection)}getStats(){return this._p2pConnection.getStats()}getRemoteVideoIsReady(i){return this._p2pConnection.getRemoteVideoIsReady(i)}updateRemoteConnect(i){var o;(o=this._nvMedia)===null||o===void 0||o.setRemoteRtpCapabilities(i),this._p2pConnection.updateRemoteConnect(i)}async updateEncoderConfig(i,o){return await this._p2pConnection.updateEncoderConfig(i,o)}async updateSendParameters(i,o){return await this._p2pConnection.updateSendParameters(i,o)}setStatsRemoteVideoIsReady(i,o){this._p2pConnection.setStatsRemoteVideoIsReady(i,o)}async replaceTrack(i,o){return await this._p2pConnection.replaceTrack(i,o)}async getRemoteSSRC(i){return this._p2pConnection.getRemoteSSRC(i)}logSDPExchange(i,o,p,g){if(nE("SDP_LOGGING"))return Gi.upload("exchanging ".concat(p," ").concat(o," SDP during DataChannelConnection.").concat(g,`
`),i),o==="offer"?b=>{this.logSDPExchange(b,"answer",p==="local"?"remote":"local",g)}:void 0}static resolvePCConfiguration(i){const o={iceServers:[]};return i.iceServers?o.iceServers=i.iceServers:i.turnServer&&i.turnServer.mode!=="off"&&(VI(i.turnServer.servers)?o.iceServers=i.turnServer.servers:(o.iceServers&&o.iceServers.push(...u0.turnServerConfigToIceServers(i.turnServer.servers)),nE("USE_TURN_SERVER_OF_GATEWAY")&&o.iceServers&&i.turnServer.serversFromGateway&&o.iceServers.push(...u0.turnServerConfigToIceServers(i.turnServer.serversFromGateway)),nE("FORCE_TURN_TCP")?o.iceTransportPolicy="relay":i.turnServer.servers.concat(i.turnServer.serversFromGateway||[]).forEach(p=>{p.forceturn&&(o.iceTransportPolicy="relay")}))),o}static turnServerConfigToIceServers(i){const o=[];return i.forEach(p=>{p.security?p.tcpport&&o.push({username:p.username,credential:p.password,credentialType:"password",urls:"turns:".concat(d1(p.turnServerURL),":").concat(p.tcpport,"?transport=tcp")}):(p.udpport&&!nE("FORCE_TURN_TCP")&&o.push({username:p.username,credential:p.password,credentialType:"password",urls:"turn:".concat(p.turnServerURL,":").concat(p.udpport,"?transport=udp")}),p.tcpport&&o.push({username:p.username,credential:p.password,credentialType:"password",urls:"turn:".concat(p.turnServerURL,":").concat(p.tcpport,"?transport=tcp")}))}),o}bindPCEvents(){this._p2pConnection.onICEConnectionStateChange=i=>{var o;return(o=this.onICEConnectionStateChange)===null||o===void 0?void 0:o.call(this,i)},this._p2pConnection.onConnectionStateChange=i=>{var o;return(o=this.onConnectionStateChange)===null||o===void 0?void 0:o.call(this,i)},this._p2pConnection.onDTLSTransportStateChange=i=>{var o;return(o=this.onDTLSTransportStateChange)===null||o===void 0?void 0:o.call(this,i)},this._p2pConnection.onDTLSTransportError=i=>{var o;return(o=this.onDTLSTransportError)===null||o===void 0?void 0:o.call(this,i)},this._p2pConnection.onICETransportStateChange=i=>{var o;return(o=this.onICETransportStateChange)===null||o===void 0?void 0:o.call(this,i)},this._p2pConnection.onFirstAudioReceived=i=>{var o;return(o=this.onFirstAudioReceived)===null||o===void 0?void 0:o.call(this,i)},this._p2pConnection.onFirstVideoReceived=i=>{var o;return(o=this.onFirstVideoReceived)===null||o===void 0?void 0:o.call(this,i)},this._p2pConnection.onFirstAudioDecoded=i=>{var o;return(o=this.onFirstAudioDecoded)===null||o===void 0?void 0:o.call(this,i)},this._p2pConnection.onFirstVideoDecoded=(i,o,p)=>{var g;return(g=this.onFirstVideoDecoded)===null||g===void 0?void 0:g.call(this,i,o,p)},this._p2pConnection.onFirstVideoDecodedTimeout=i=>{var o;return(o=this.onFirstVideoDecodedTimeout)===null||o===void 0?void 0:o.call(this,i)},this._p2pConnection.onSelectedLocalCandidateChanged=(i,o)=>{var p;return(p=this.onSelectedLocalCandidateChanged)===null||p===void 0?void 0:p.call(this,i,o)},this._p2pConnection.onSelectedRemoteCandidateChanged=(i,o)=>{var p;return(p=this.onSelectedRemoteCandidateChanged)===null||p===void 0?void 0:p.call(this,i,o)}}closeSignal(){this.dataChannel.close(),this.peerConnection.close()}unbindConnectionEvents(i){i.onConnectionStateChange=void 0,i.onICEConnectionStateChange=void 0,i.onICETransportStateChange=void 0,i.onDTLSTransportStateChange=void 0,i.onDTLSTransportError=void 0,i.onFirstAudioDecoded=void 0,i.onFirstAudioReceived=void 0,i.onFirstVideoDecoded=void 0,i.onFirstVideoReceived=void 0,i.onSelectedLocalCandidateChanged=void 0,i.onSelectedRemoteCandidateChanged=void 0,i.onFirstVideoDecodedTimeout=void 0}setConfiguration(i){this._p2pConnection.setConfiguration(i)}}function FS(l,i,o){const p=l[i];if(typeof p!="function")throw new Error("Cannot use mutex on object property.");return o.value=async function(){const g=this.mutex,b=await g.lock("From DataChannelConnection.".concat(i));try{for(var A=arguments.length,j=new Array(A),H=0;H<A;H++)j[H]=arguments[H];return await p.apply(this,j)}finally{b()}},o}function r8(l,i){var o=Object.keys(l);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(l);i&&(p=p.filter(function(g){return Object.getOwnPropertyDescriptor(l,g).enumerable})),o.push.apply(o,p)}return o}function i8(l){for(var i=1;i<arguments.length;i++){var o=arguments[i]!=null?arguments[i]:{};i%2?r8(Object(o),!0).forEach(function(p){_e(l,p,o[p])}):Object.getOwnPropertyDescriptors?Object.defineProperties(l,Object.getOwnPropertyDescriptors(o)):r8(Object(o)).forEach(function(p){Object.defineProperty(l,p,Object.getOwnPropertyDescriptor(o,p))})}return l}bE([FS,kc("design:type",Function),kc("design:paramtypes",[Object,Object,Array,Object,String,String]),kc("design:returntype",pE)],u0.prototype,"connect",null),bE([FS,kc("design:type",Function),kc("design:paramtypes",[Array,Array]),kc("design:returntype",pE)],u0.prototype,"updateRemoteRTPCapabilities",null),bE([FS,kc("design:type",Function),kc("design:paramtypes",[Object,Array]),kc("design:returntype",pE)],u0.prototype,"createDataChannels",null),bE([FS,kc("design:type",Function),kc("design:paramtypes",[String,Array,String,Object]),kc("design:returntype",pE)],u0.prototype,"receive",null),bE([FS,kc("design:type",Function),kc("design:paramtypes",[Array]),kc("design:returntype",pE)],u0.prototype,"stopReceiving",null),bE([FS,kc("design:type",Function),kc("design:paramtypes",[String]),kc("design:returntype",pE)],u0.prototype,"muteRemote",null),bE([FS,kc("design:type",Function),kc("design:paramtypes",[String]),kc("design:returntype",pE)],u0.prototype,"unmuteRemote",null),bE([FS,kc("design:type",Function),kc("design:paramtypes",[Array]),kc("design:returntype",pE)],u0.prototype,"muteLocal",null),bE([FS,kc("design:type",Function),kc("design:paramtypes",[Array]),kc("design:returntype",pE)],u0.prototype,"unmuteLocal",null),bE([FS,kc("design:type",Function),kc("design:paramtypes",[]),kc("design:returntype",void 0)],u0.prototype,"close",null),bE([FS,kc("design:type",Function),kc("design:paramtypes",[String,P0]),kc("design:returntype",pE)],u0.prototype,"updateEncoderConfig",null),bE([FS,kc("design:type",Function),kc("design:paramtypes",[String,P0]),kc("design:returntype",pE)],u0.prototype,"updateSendParameters",null),bE([FS,kc("design:type",Function),kc("design:paramtypes",[P0,String]),kc("design:returntype",pE)],u0.prototype,"replaceTrack",null),bE([FS,kc("design:type",Function),kc("design:paramtypes",[String]),kc("design:returntype",pE)],u0.prototype,"getRemoteSSRC",null);class s8 extends D_{constructor(){super(),_e(this,"uplinkStatsUploadInterval",void 0),_e(this,"uplinkRelatedStatsUploadInterval",void 0),_e(this,"uplinkDenoiserStatsUploadInterval",void 0),_e(this,"transportStatsUploadInterval",void 0),_e(this,"uplinkExtensionStatsUploadInterval",void 0),_e(this,"downlinkExtensionStatsUploadInterval",void 0),_e(this,"extensionUsageStatsUploadInterval",void 0),_e(this,"downlinkStatsUploadInterval",void 0),_e(this,"downlinkRelatedStatsUploadInterval",void 0),_e(this,"lastStats",void 0),_e(this,"uploadUnplinkStarted",!1),_e(this,"uploadDownlinkStarted",!1),_e(this,"uploadTransportStarted",!1),_e(this,"uploadExtensionUsageStarted",!1),_e(this,"requestStats",void 0),_e(this,"requestTransportStats",void 0),_e(this,"requestLocalMedia",void 0),_e(this,"requestRemoteMedia",void 0),_e(this,"requestAllTracks",void 0),_e(this,"requestVideoIsReady",void 0),_e(this,"requestUpload",void 0)}startUploadTransportStats(i){this.uploadTransportStarted||(this.uploadTransportStarted=!0,this.transportStatsUploadInterval&&window.clearInterval(this.transportStatsUploadInterval),this.transportStatsUploadInterval=window.setInterval(()=>{var o;const p=(o=this.requestStats)===null||o===void 0?void 0:o.call(this);if(p){const b=i5(p);if(i){var g;const A=(g=this.requestStats)===null||g===void 0?void 0:g.call(this,!0);if(A){const j=i5(A);b.connectionType+=j.connectionType<<3}b.connectionType+=110}else b.connectionType+=100;sT(()=>{var A;(A=this.requestUpload)===null||A===void 0||A.call(this,uS.TRANSPORT_STATS,b)})}},1e3))}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.extensionUsageStatsUploadInterval&&window.clearInterval(this.extensionUsageStatsUploadInterval);const i=new Map;this.extensionUsageStatsUploadInterval=window.setInterval(async()=>{var o,p,g;const b=Date.now(),A={connectionInterval:nE("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:b};let j=[];const H=((o=this.requestAllTracks)===null||o===void 0?void 0:o.call(this))||[];for(const _r of H)!_r.muted&&_r.enabled&&(j=j.concat(await _r.getProcessorUsage()));const z=((p=this.requestRemoteMedia)===null||p===void 0?void 0:p.call(this))||[];for(const[_r,Fi]of z)Fi.has(ME.VIDEO)&&_r.videoTrack&&(j=j.concat(await _r.videoTrack.getProcessorUsage())),Fi.has(ME.AUDIO)&&_r.audioTrack&&(j=j.concat(await _r.audioTrack.getProcessorUsage()));if(j.length===0)return;A.details=function(_r,Fi){const _l={};for(const{id:eE,value:oE,level:SE,direction:vE}of _r){var _u;const fE=(_u=Fi.get(eE))!==null&&_u!==void 0?_u:0,mE=oE===2?fE+nE("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:fE;var _h,_g;Fi.set(eE,mE),_l[eE]?(oE===2&&(_l[eE].value=oE),SE>_l[eE].level&&(_l[eE].level=SE),vE==="remote"&&(_l[eE].remoteUidCount+=1),_l[eE].totalTs=(_h=Fi.get(eE))!==null&&_h!==void 0?_h:0):_l[eE]={value:oE,level:SE,remoteUidCount:vE==="local"?0:1,totalTs:(_g=Fi.get(eE))!==null&&_g!==void 0?_g:0}}return Object.keys(_l).map(eE=>{const{level:oE,value:SE,totalTs:vE}=_l[eE];return{id:eE,level:oE,value:SE,totalTs:vE}})}(j,i);const $=Date.now(),Vt=$>b?$:b+1;(g=this.requestUpload)===null||g===void 0||g.call(this,uS.EXTENSION_USAGE_STATS,{usageStats:A,sendTs:Vt})},nE("EXTENSION_USAGE_UPLOAD_INTERVAL"))}startUploadUplinkStats(){this.uploadUnplinkStarted||(this.uploadUnplinkStarted=!0,this.uplinkStatsUploadInterval&&window.clearInterval(this.uplinkStatsUploadInterval),this.uplinkStatsUploadInterval=window.setInterval(()=>{var i;const o=(i=this.requestStats)===null||i===void 0?void 0:i.call(this);o&&(this.uploadUplinkStats(o),this.lastStats=o)},3e3),this.uplinkRelatedStatsUploadInterval&&window.clearInterval(this.uplinkRelatedStatsUploadInterval),this.uplinkRelatedStatsUploadInterval=window.setInterval(()=>{var i;const o=(i=this.requestStats)===null||i===void 0?void 0:i.call(this);o&&this.uploadRelatedUplinkStats(o,this.lastStats),this.lastStats=o},1e3),this.uplinkDenoiserStatsUploadInterval&&window.clearInterval(this.uplinkDenoiserStatsUploadInterval),this.uplinkDenoiserStatsUploadInterval=window.setInterval(()=>{var i;const o=(i=this.requestAllTracks)===null||i===void 0?void 0:i.call(this);o&&this.uploadDenoiserStats(o)},2e3),this.uplinkExtensionStatsUploadInterval&&window.clearInterval(this.uplinkExtensionStatsUploadInterval),this.uplinkExtensionStatsUploadInterval=window.setInterval(()=>{var i;const o=(i=this.requestAllTracks)===null||i===void 0?void 0:i.call(this);o&&this.uploadExtensionStats(o)},2e3))}uploadUplinkStats(i){var o;(((o=this.requestLocalMedia)===null||o===void 0?void 0:o.call(this))||[]).forEach(p=>{let[g,{track:b,ssrcs:A}]=p;switch(g){case TE.LocalVideoLowTrack:case TE.LocalVideoTrack:{const j=function($,Vt,_r){var Fi;const _l=Vt.videoSend.find(_h=>_h.ssrc===$);if(!_l)return null;const _u={id:T_(10,""),timestamp:new Date(Vt.timestamp).toISOString(),mediaType:"video",type:"ssrc",ssrc:_l.ssrc.toString()};switch(_u.A_vstd=_r._originMediaStreamTrack&&!_r._originMediaStreamTrack.enabled||_r._mediaStreamTrack&&!_r._mediaStreamTrack.enabled?"1":"0",_l.sentFrame&&(_u.A_fhs=_l.sentFrame.height.toString(),_u.A_frs=_l.sentFrame.frameRate.toString(),_u.A_fws=_l.sentFrame.width.toString()),_l.adaptionChangeReason){case"none":_u.A_ac="0";break;case"cpu":_u.A_ac="1";break;case"bandwidth":_u.A_ac="2";break;case"other":_u.A_ac="3"}return _u.A_lvps=wM[_r._player?_r._player.videoElementStatus:"uninit"].toString(),_u.A_nr=(Fi=_l.nacksCount)===null||Fi===void 0?void 0:Fi.toString(),_l.avgEncodeMs&&(_u.A_aem=_l.avgEncodeMs.toFixed(0).toString()),nE("P2P")&&(_l.bytes&&(_u.bytesSent=_l.bytes.toString()),typeof _l.packetsLost=="number"&&(_u.packetsLost=_l.packetsLost.toString()),_l.packets&&(_u.packetsSent=_l.packets.toString())),_u}(A[0].ssrcId,i,b),H=g===TE.LocalVideoTrack?function($,Vt,_r){var Fi,_l,_u,_h,_g,eE,oE,SE;const vE=Vt.videoSend.find(OE=>OE.ssrc===$);if(!vE)return null;const fE={id:T_(10,""),timestamp:new Date(Vt.timestamp).toISOString(),mediaType:"video",type:"ssrc",ssrc:vE.ssrc.toString()},mE=(Fi=(_l=(_u=vE.inputFrame)===null||_u===void 0?void 0:_u.height)!==null&&_l!==void 0?_l:_r==null?void 0:_r._videoHeight)!==null&&Fi!==void 0?Fi:0,EE=(_h=(_g=(eE=vE.inputFrame)===null||eE===void 0?void 0:eE.width)!==null&&_g!==void 0?_g:_r==null?void 0:_r._videoWidth)!==null&&_h!==void 0?_h:0,PE=(oE=(SE=vE.inputFrame)===null||SE===void 0?void 0:SE.frameRate)!==null&&oE!==void 0?oE:0;return mE&&(fE.A_fhi=mE+""),EE&&(fE.A_fwi=EE+""),PE&&(fE.A_fri=PE+""),fE}(A[0].ssrcId,i,b):null;j&&sT(()=>{var $;return($=this.requestUpload)===null||$===void 0?void 0:$.call(this,uS.PUBLISH_STATS,{stream_type:g===TE.LocalVideoLowTrack?"low":"high",stats:i8(i8({},j),H)})});const z=function($){const Vt={id:"bweforvideo",timestamp:new Date($.timestamp).toISOString(),type:"VideoBwe"};return $.bitrate.retransmit&&(Vt.A_rb=$.bitrate.retransmit.toString()),$.bitrate.targetEncoded&&(Vt.A_teb=$.bitrate.targetEncoded.toString()),Vt.A_aeb=$.bitrate.actualEncoded.toString(),Vt.A_tb=$.bitrate.transmit.toString(),$.sendBandwidth!==void 0&&(Vt.A_asb=$.sendBandwidth.toString()),Vt}(i);z&&setTimeout(()=>{var $;return($=this.requestUpload)===null||$===void 0?void 0:$.call(this,uS.PUBLISH_STATS,{stream_type:g===TE.LocalVideoLowTrack?"low":"high",stats:z})},1e3);break}case TE.LocalAudioTrack:{const j=function(H,z,$){const Vt=z.audioSend.find(Fi=>Fi.ssrc===H);if(!Vt)return null;const _r={id:T_(10,""),timestamp:new Date(z.timestamp).toISOString(),mediaType:"audio",type:"ssrc",ssrc:Vt.ssrc.toString()};return _r.A_astd=$._originMediaStreamTrack&&!$._originMediaStreamTrack.enabled||$._mediaStreamTrack&&!$._mediaStreamTrack.enabled?"1":"0",Vt.inputLevel?_r.A_ail=Math.round(100*Vt.inputLevel).toString():_r.A_ail=Math.round(100*$._source.getAccurateVolumeLevel()).toString(),_r.A_apil=Math.round(100*$._source.getAccurateVolumeLevel()).toString(),Vt.aecReturnLoss&&(_r.A_ecrl=Math.round(Vt.aecReturnLoss).toString()),Vt.aecReturnLossEnhancement&&(_r.A_ecrle=Math.round(Vt.aecReturnLossEnhancement).toString()),nE("P2P")&&(Vt.bytes&&(_r.bytesSent=Vt.bytes.toString()),typeof Vt.packetsLost=="number"&&(_r.packetsLost=Vt.packetsLost.toString()),Vt.packets&&(_r.packetsSent=Vt.packets.toString())),_r}(A[0].ssrcId,i,b);j&&sT(()=>{var H;return(H=this.requestUpload)===null||H===void 0?void 0:H.call(this,uS.PUBLISH_STATS,{stream_type:"high",stats:j})});break}}})}uploadRelatedUplinkStats(i,o){var p;(((p=this.requestLocalMedia)===null||p===void 0?void 0:p.call(this))||[]).filter(g=>{let[b]=g;return b===TE.LocalVideoLowTrack||b===TE.LocalVideoTrack}).forEach(g=>{let[b,{ssrcs:A}]=g;const j=function(H,z){const $=z.videoSend.find(Vt=>Vt.ssrc===H);return $?{mediaType:"video",isVideoMute:!1,frameRateInput:$.inputFrame&&$.inputFrame.frameRate.toString(),frameRateSent:$.sentFrame&&$.sentFrame.frameRate.toString(),googRtt:$.rttMs.toString(),qpSumPerFrame:Math.floor($.qpSumPerFrame).toString()}:null}(A[0].ssrcId,i);j&&sT(()=>{var H;(H=this.requestUpload)===null||H===void 0||H.call(this,uS.PUBLISH_RELATED_STATS,{stream_type:b===TE.LocalVideoLowTrack?"low":"high",stats:j})})})}uploadDenoiserStats(i){for(let b=0;b<i.length;b++){const A=i[b];if(A instanceof _R){var o,p,g;const j=(o=(p=A._external).getDenoiserStats)===null||o===void 0?void 0:o.call(p);return void(j&&((g=this.requestUpload)===null||g===void 0||g.call(this,uS.DENOISER_STATS,j)))}}}uploadExtensionStats(i){for(let o=0;o<i.length;o++)i[o].getProcessorStats().forEach(p=>{var g;(g=this.requestUpload)===null||g===void 0||g.call(this,p.type,p.stats)})}stopUploadUplinkStats(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStatsUploadInterval&&window.clearInterval(this.uplinkStatsUploadInterval),this.uplinkRelatedStatsUploadInterval&&window.clearInterval(this.uplinkRelatedStatsUploadInterval),this.uplinkDenoiserStatsUploadInterval&&window.clearInterval(this.uplinkDenoiserStatsUploadInterval),this.uplinkStatsUploadInterval=void 0,this.uplinkRelatedStatsUploadInterval=void 0,this.uplinkDenoiserStatsUploadInterval=void 0)}startUploadDownlinkStats(){if(this.uploadDownlinkStarted)return;let i;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);let o=!1;this.downlinkStatsUploadInterval=window.setInterval(()=>{var p;const g=(p=this.requestStats)===null||p===void 0?void 0:p.call(this,!0);g&&(this.uploadDownlinkStats(g,o,i),i=g),o=!o},3e3),this.downlinkRelatedStatsUploadInterval&&window.clearInterval(this.downlinkRelatedStatsUploadInterval),this.downlinkRelatedStatsUploadInterval=window.setInterval(()=>{var p;const g=(p=this.requestStats)===null||p===void 0?void 0:p.call(this,!0);g&&(this.uploadRelatedDownlinkStats(g,this.lastStats),this.lastStats=g)},1e3),this.downlinkExtensionStatsUploadInterval&&window.clearInterval(this.downlinkExtensionStatsUploadInterval),this.downlinkExtensionStatsUploadInterval=window.setInterval(()=>{var p;const g=(p=this.requestRemoteMedia)===null||p===void 0?void 0:p.call(this);g&&this.uploadDownlinkExtensionStats(g)},2e3)}uploadDownlinkStats(i,o,p){var g;(((g=this.requestRemoteMedia)===null||g===void 0?void 0:g.call(this))||[]).forEach(b=>{let[A,j]=b;if(j.has(ME.VIDEO)&&A.videoTrack){const H=A.videoTrack?function(z,$,Vt,_r,Fi){const _l=$.videoRecv.find(eE=>eE.ssrc===z);if(!_l)return null;const _u={id:T_(10,""),timestamp:new Date($.timestamp).toISOString(),mediaType:"video",type:"ssrc",ssrc:_l.ssrc.toString()};var _h,_g;if(_u.bytesReceived=_l.bytes.toString(),_u.packetsLost=_l.packetsLost.toString(),_u.packetsReceived=_l.packets.toString(),_l.framesRateFirefox&&(_u.A_frr=_l.framesRateFirefox.toString()),_l.receivedFrame?(_u.A_frr=_l.receivedFrame.frameRate.toString(),_u.A_fhr=_l.receivedFrame.height.toString(),_u.A_fwr=_l.receivedFrame.width.toString()):(_u.A_fhr=(_h=_r._videoHeight)===null||_h===void 0?void 0:_h.toString(),_u.A_fwr=(_g=_r._videoWidth)===null||_g===void 0?void 0:_g.toString()),_u.A_frd=_l.decodeFrameRate.toString(),_l.outputFrame&&(_u.A_fro=_l.outputFrame.frameRate.toString()),_l.jitterBufferMs!==void 0&&(_u.A_jbm=Math.floor(_l.jitterBufferMs).toString()),_l.currentDelayMs!==void 0&&(_u.A_cdm=Math.floor(_l.currentDelayMs).toString()),_u.A_fs=_l.firsCount.toString(),_u.A_ns=_l.nacksCount.toString(),_u.A_ps=_l.plisCount.toString(),_r&&(_u.A_vrtd=_r._originMediaStreamTrack.enabled&&_r._mediaStreamTrack.enabled?"0":"1"),_r._player&&_r._player.freezeTimeCounterList.length>0&&(_u.A_vrft=Math.round(_r._player.freezeTimeCounterList.splice(0,1)[0]).toString()),Fi&&_r._player&&QT.visibility==="visible"){const eE=Math.min(6e3,_r._player.renderFreezeAccTime);_u.A_vrrft=Math.round(eE).toString(),_r._player.renderFreezeAccTime=Math.max(0,_r._player.renderFreezeAccTime-eE)}if(_u.A_rvps=wM[_r._player?_r._player.videoElementStatus:"uninit"].toString(),Vt){const eE=Vt.videoRecv.find(oE=>oE.ssrc===z);if(eE&&_l.totalInterFrameDelay!==void 0&&_l.totalSquaredInterFrameDelay!==void 0&&eE.totalInterFrameDelay!==void 0&&eE.totalSquaredInterFrameDelay!==void 0){const oE=_l.totalInterFrameDelay-eE.totalInterFrameDelay,SE=_l.totalSquaredInterFrameDelay-eE.totalSquaredInterFrameDelay,vE=_l.framesDecodeCount-eE.framesDecodeCount,fE=oE/vE*1e3,mE=Math.round(1e3*Math.sqrt((SE-Math.pow(oE,2)/vE)/vE));!isNaN(mE)&&fE+mE>Math.max(3*fE,fE+150)&&(_u.A_ifdsd=mE.toString())}}return _u}(A._videoSSRC,i,p,A.videoTrack,o):void 0;H&&sT(()=>{var z;return(z=this.requestUpload)===null||z===void 0?void 0:z.call(this,uS.SUBSCRIBE_STATS,{stream_id:A.uid,stats:H})})}if(j.has(ME.AUDIO)&&A.audioTrack){const H=A.audioTrack?function(z,$,Vt,_r){const Fi=$.audioRecv.find(_u=>_u.ssrc===z);if(!Fi)return null;const _l={id:T_(10,""),timestamp:new Date($.timestamp).toISOString(),mediaType:"audio",type:"ssrc",ssrc:Fi.ssrc.toString()};if(_l.bytesReceived=Fi.bytes.toString(),_l.packetsLost=Fi.packetsLost.toString(),_l.packetsReceived=Fi.packets.toString(),Fi.outputLevel?_l.A_aol=Math.round(100*Fi.outputLevel).toString():_l.A_aol=Math.round(100*_r._source.getAccurateVolumeLevel()).toString(),_l.A_apol=Math.round(100*_r._source.getAccurateVolumeLevel()).toString(),_r&&(_l.A_artd=_r._originMediaStreamTrack.enabled&&_r._mediaStreamTrack.enabled?"0":"1"),_l.A_jr=Fi.jitterMs.toString(),_l.A_jbm=Math.floor(Fi.jitterBufferMs).toString(),_l.A_cdm=Math.floor(Fi.jitterBufferMs).toString(),_l.A_raps=wM[vS.getPlayerState(_r.getTrackId())].toString(),Vt){const _u=Vt.audioRecv.find(_h=>_h.ssrc===z);if(_u){const _h=Fi.concealedSamples-_u.concealedSamples;_h>0&&(_l.A_cs=Math.round(_h).toString())}}return _l}(A._audioSSRC,i,p,A.audioTrack):void 0;H&&sT(()=>{var z;return(z=this.requestUpload)===null||z===void 0?void 0:z.call(this,uS.SUBSCRIBE_STATS,{stream_id:A.uid,stats:H})})}})}uploadRelatedDownlinkStats(i,o){var p;(((p=this.requestRemoteMedia)===null||p===void 0?void 0:p.call(this))||[]).forEach(g=>{let[b,A]=g;if(A.has(ME.VIDEO)&&b.videoTrack){var j;const H=(b._videoSSRC&&((j=this.requestVideoIsReady)===null||j===void 0?void 0:j.call(this,b._videoSSRC))||!1)===!0,z=function($,Vt,_r,Fi,_l,_u){const _h=_r.videoRecv.find(SE=>SE.ssrc===$),_g=_l?_l.videoRecv.find(SE=>SE.ssrc===$):void 0;if(!_h)return null;const eE=oO.isRemoteVideoFreeze(_u,_h,_g)&&Vt,oE={mediaType:"video",isVideoMute:!1,peerId:Fi,frameRateReceived:_h.receivedFrame&&_h.receivedFrame.frameRate.toString(),frameRateDecoded:_h.decodedFrame&&_h.decodedFrame.frameRate.toString(),isFreeze:eE,bytesReceived:_h.bytes.toString(),packetsReceived:_h.packets.toString(),packetsLost:_h.packetsLost.toString(),qpSumPerFrame:Math.floor(_h.qpSumPerFrame).toString()};return _h.framesRateFirefox&&(oE.frameRateDecoded=_h.framesRateFirefox.toString(),oE.frameRateReceived=_h.framesRateFirefox.toString()),oE}(b._videoSSRC,H,i,b.uid,o,b.videoTrack);z&&sT(()=>{var $;($=this.requestUpload)===null||$===void 0||$.call(this,uS.SUBSCRIBE_RELATED_STATS,{stream_id:b.uid,stats:z})})}if(A.has(ME.AUDIO)&&b.audioTrack){const H=function(z,$,Vt,_r){const Fi=$.audioRecv.find(_u=>_u.ssrc===z);if(!Fi)return null;const _l=oO.isRemoteAudioFreeze(_r);return{mediaType:"audio",isAudioMute:!1,peerId:Vt,googJitterReceived:Fi.jitterMs.toString(),isFreeze:_l,bytesReceived:Fi.bytes.toString(),packetsReceived:Fi.packets.toString(),packetsLost:Fi.packetsLost.toString(),frameReceived:Fi.receivedFrames.toString(),frameDropped:Fi.droppedFrames.toString()}}(b._audioSSRC,i,b.uid,b.audioTrack);H&&sT(()=>{var z;(z=this.requestUpload)===null||z===void 0||z.call(this,uS.SUBSCRIBE_RELATED_STATS,{stream_id:b.uid,stats:H})})}})}stopUploadDownlinkStats(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval),this.downlinkRelatedStatsUploadInterval&&window.clearInterval(this.downlinkRelatedStatsUploadInterval),this.downlinkStatsUploadInterval=void 0,this.downlinkRelatedStatsUploadInterval=void 0)}stopUploadTransportStats(){this.uploadTransportStarted&&(this.uploadTransportStarted=!1,this.transportStatsUploadInterval&&window.clearInterval(this.transportStatsUploadInterval),this.transportStatsUploadInterval=void 0)}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.extensionUsageStatsUploadInterval&&window.clearInterval(this.extensionUsageStatsUploadInterval),this.extensionUsageStatsUploadInterval=void 0)}uploadDownlinkExtensionStats(i){i.forEach(o=>{let[p,g]=o;g.has(ME.VIDEO)&&p.videoTrack&&p.videoTrack.getProcessorStats().forEach(b=>{var A;(A=this.requestUpload)===null||A===void 0||A.call(this,b.type,b.stats)}),g.has(ME.AUDIO)&&p.audioTrack&&p.audioTrack.getProcessorStats().forEach(b=>{var A;(A=this.requestUpload)===null||A===void 0||A.call(this,b.type,b.stats)})})}}function o8(l,i){var o=Object.keys(l);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(l);i&&(p=p.filter(function(g){return Object.getOwnPropertyDescriptor(l,g).enumerable})),o.push.apply(o,p)}return o}function OR(l){for(var i=1;i<arguments.length;i++){var o=arguments[i]!=null?arguments[i]:{};i%2?o8(Object(o),!0).forEach(function(p){_e(l,p,o[p])}):Object.getOwnPropertyDescriptors?Object.defineProperties(l,Object.getOwnPropertyDescriptors(o)):o8(Object(o)).forEach(function(p){Object.defineProperty(l,p,Object.getOwnPropertyDescriptor(o,p))})}return l}function a8(l){var i,o,p,g=2;for(typeof Symbol<"u"&&(o=A5,p=Symbol.iterator);g--;){if(o&&(i=l[o])!=null)return i.call(l);if(p&&(i=l[p])!=null)return new yP(i.call(l));o="@@asyncIterator",p="@@iterator"}throw new TypeError("Object is not async iterable")}function yP(l){function i(o){if(Object(o)!==o)return pE.reject(new TypeError(o+" is not an object."));var p=o.done;return pE.resolve(o.value).then(function(g){return{value:g,done:p}})}return yP=function(o){this.s=o,this.n=o.next},yP.prototype={s:null,n:null,next:function(){return i(this.n.apply(this.s,arguments))},return:function(o){var p=this.s.return;return p===void 0?pE.resolve({value:o,done:!0}):i(p.apply(this.s,arguments))},throw:function(o){var p=this.s.return;return p===void 0?pE.reject(o):i(p.apply(this.s,arguments))}},new yP(l)}class S0 extends D_{get state(){return this._state}set state(i){const o=this._state;this._state=i,this.emit(WE.StateChange,o,this._state)}constructor(i,o){super(),_e(this,"store",void 0),_e(this,"statsUploader",void 0),_e(this,"connection",void 0),_e(this,"localTrackMap",new Map),_e(this,"remoteUserMap",new Map),_e(this,"localDataChannels",[]),_e(this,"remoteDataChannelMap",new Map),_e(this,"pendingLocalTracks",[]),_e(this,"pendingRemoteTracks",[]),_e(this,"pendingLocalDataChannels",[]),_e(this,"pendingRemoteDataChannels",[]),_e(this,"statsCollector",void 0),_e(this,"isPlanB",!1),_e(this,"shouldForwardP2PCreation",void 0),_e(this,"iceFailedCount",0),_e(this,"dtlsFailedCount",0),_e(this,"mutex",new E0("P2PChannel-mutex")),_e(this,"_state",u_.Disconnected),_e(this,"_pcStatsUploadType",nE("NEW_ICE_RESTART")?yT.FIRST_CONNECTION:yT.OLD_FIRST_CONNECTION),_e(this,"_isInRestartIce",!1),_e(this,"_isStartRestartIce",!1),_e(this,"_restartStates",["disconnected","failed"]),_e(this,"_restartTimer",void 0),_e(this,"_isFirstConnected",!0),_e(this,"handleMuteLocalTrack",async(p,g,b)=>{const A=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==u_.Connected)return void b(new yE(_p.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));const j=this.filterTobeMutedTracks(p);if(j.length===0)return void g();const H=j.find($=>$[0]==="videoLowTrack");H&&H[1].track._originMediaStreamTrack.stop(),await this.connection.muteLocal(j.map($=>{let[,{id:Vt}]=$;return Vt}));const z=this.createMuteMessage(j);await S_(this,WE.RequestMuteLocal,z),g()}catch(j){b(j)}finally{A()}}),_e(this,"handleUnmuteLocalTrack",async(p,g,b)=>{const A=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==u_.Connected)return void b(new yE(_p.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));const j=this.filterTobeUnmutedTracks(p);if(j.length===0)return void g();const H=j.find($=>$[0]==="videoLowTrack");if(H){const $=H[1];if($.track._originMediaStreamTrack.stop(),!nE("DISABLE_DUAL_STREAM_USE_ENCODING")&&I_().supportDualStreamEncoding){const Vt=p._mediaStreamTrack.clone();$.track._mediaStreamTrack=Vt,$.track._originMediaStreamTrack=Vt}else{const Vt=R2(p,JT(this,WE.RequestLowStreamParameter));$.track._mediaStreamTrack=Vt,$.track._originMediaStreamTrack=Vt}await new pE((Vt,_r)=>{this.handleReplaceTrack($.track,Vt,_r,!0)})}await this.connection.unmuteLocal(j.map($=>{let[,{id:Vt}]=$;return Vt}));const z=this.createUnmuteMessage(j);await S_(this,WE.RequestUnmuteLocal,z),g()}catch(j){b(j)}finally{A()}}),_e(this,"handleUpdateVideoEncoder",async(p,g,b)=>{const A=await this.mutex.lock("Locking from P2PChannel.handleSetVideoEncoder");try{const j=this.localTrackMap.get(TE.LocalVideoTrack);if(!this.connection||!j||j.track!==p||this.state!==u_.Connected)return void g();const{id:H,track:z}=j;await this.connection.updateSendParameters(H,z),await this.connection.updateEncoderConfig(H,z),this.emit(WE.UpdateVideoEncoder,z),g()}catch(j){b(j)}finally{A()}}),_e(this,"handleSetOptimizationMode",async(p,g,b)=>{const A=await this.mutex.lock("Locking from P2PChannel.handleSetOptimizationMode");try{const j=this.localTrackMap.get(TE.LocalVideoTrack);if(!this.connection||!j||j.track!==p||this.state!==u_.Connected)return;const{id:H,track:z}=j;await this.connection.updateSendParameters(H,z),g()}catch(j){b(j)}finally{A()}}),_e(this,"handleReplaceTrack",async(p,g,b,A)=>{let j;Gi.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(p.getTrackId(),"]")),typeof A=="boolean"&&A||(j=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var H;const $=Array.from(this.localTrackMap.entries()).find(Vt=>{let[,{track:_r}]=Vt;return p===_r});if(!this.connection||!$||this.state!==u_.Connected)return void g();if(await((H=this.connection)===null||H===void 0?void 0:H.replaceTrack(p,$[1].id)),this.isPlanB){const Vt=$[1];Vt.id=p._mediaStreamTrack.id,this.localTrackMap.set($[0],Vt)}if($[0]===TE.LocalVideoTrack&&!nE("DISABLE_DUAL_STREAM_USE_ENCODING")&&I_().supportDualStreamEncoding){const Vt=this.localTrackMap.get(TE.LocalVideoLowTrack);if(Vt){const _r=p._mediaStreamTrack.clone();Vt.track._originMediaStreamTrack.stop(),Vt.track._mediaStreamTrack=_r,Vt.track._originMediaStreamTrack=_r,await new pE((Fi,_l)=>{this.handleReplaceTrack(Vt.track,Fi,_l,!0)})}}g()}catch($){b($)}finally{var z;(z=j)===null||z===void 0||z()}}),_e(this,"handleGetRTCStats",p=>{p(this.statsCollector.getRTCStats())}),_e(this,"handleGetLocalVideoStats",p=>{p(this.statsCollector.getLocalVideoTrackStats())}),_e(this,"handleGetLocalAudioStats",p=>{p(this.statsCollector.getLocalAudioTrackStats())}),_e(this,"handleGetRemoteVideoStats",p=>this.statsCollector.getRemoteVideoTrackStats(p.uid)[p.uid]),_e(this,"handleGetRemoteAudioStats",p=>this.statsCollector.getRemoteAudioTrackStats(p.uid)[p.uid]),this.store=i,this.statsCollector=o,this.statsCollector.addP2PChannel(this),this.statsUploader=new s8,this.bindStatsUploaderEvents(),this.isPlanB=!I_().supportUnifiedPlan||nE("CHROME_FORCE_PLAN_B")&&lR(),this.shouldForwardP2PCreation=nE("FORWARD_P2P_CREATION")&&I_().supportPCSetConfiguration&&function(){const p=aN();return p===l0.ANDROID||p===l0.IOS||p===l0.HARMONY_OS}(),this.shouldForwardP2PCreation&&(this.connection=this.store.useDataChannel?new u0({},this.store):this.isPlanB?new b0({},this.store):new c0({},this.store),this.bindConnectionEvents(this.connection))}async startP2PConnection(i,o){var p;this.state=u_.New;const g=this.shouldForwardP2PCreation&&((p=this.connection)===null||p===void 0?void 0:p.peerConnectionState)==="closed";if(this.shouldForwardP2PCreation&&!g||(g&&this.connection&&(Gi.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.connection.close(),this.unbindConnectionEvents(this.connection)),this.connection=this.store.useDataChannel?new u0(i,this.store):this.isPlanB?new b0(i,this.store):new c0(i,this.store),this.bindConnectionEvents(this.connection)),!this.connection)throw new yE(_p.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=nE("NEW_ICE_RESTART")?yT.FIRST_CONNECTION:yT.OLD_FIRST_CONNECTION,this._isFirstConnected=!0,this._isInRestartIce=!1,this._isStartRestartIce=!1,this.connection.setConfiguration(i),this.connection.establishPromise}async connect(i,o,p,g,b,A){if(!this.connection)throw new yE(_p.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");this.connection instanceof u0?this.connection.updateRemoteConnect(g):(this.store.peerConnectionStart(),await this.connection.connect(i,o,p,g,b,A),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=u_.Connected)}updateRemoteRTPCapabilities(i){const o=Array.from(this.localTrackMap.entries()).filter(p=>{var g;let[b]=p;return VE(g=[TE.LocalVideoLowTrack,TE.LocalVideoTrack]).call(g,b)}).map(p=>{let[,{id:g}]=p;return g});if(this.connection instanceof c0){if(!VE(i).call(i,this.store.codec)){const p=["vp8","h264"].find(g=>VE(i).call(i,g));p&&(this.store.codec=p,Gi.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId," updateRemoteRTPCapabilities] default codec is not available, hence the fallback to ").concat(p,".")))}this.connection.updateRemoteRTPCapabilities(o,i)}}async preConnect(i,o,p,g,b,A){if(!this.connection)throw new yE(_p.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");this.store.peerConnectionStart();const j=await this.connection.connect(i,o,p,g,b,A);return this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=u_.Connected,j}getEstablishParams(){if(this.connection instanceof u0)return this.connection.getP2PConnectionParams();throw new Error("Only DataChannelConnection needs to obtain establishParams")}async publishDataChannel(i){if(!this.connection){if(this.state===u_.Disconnected)throw new yE(_p.UNEXPECTED_ERROR,"PeerConnection already disconnected.");const p=i.filter(g=>this.pendingLocalDataChannels.findIndex(b=>b.id===g.id)!==-1);return void(this.pendingLocalDataChannels=this.pendingLocalDataChannels.concat(p))}const o=this.filterTobePublishedDataChannels(i);o.length!==0&&(o.forEach(p=>{const g=Date.now();this.store.publish(p.id.toString(),"datachannel",g)}),await this.connection.createDataChannels(this.store.uid,o),o.forEach(p=>{this.localDataChannels.push(p);const g=Date.now();this.store.publish(p.id+"","datachannel",void 0,g)}))}publish(i,o,p){var g=this;return JS(function*(){const b=yield d_(g.mutex.lock("From P2PChannel.publish"));try{if(!g.connection||g.state!==u_.Connected){if(g.state===u_.Disconnected)throw new yE(_p.UNEXPECTED_ERROR,"PeerConnection already disconnected.");g.throwIfTrackTypeNotMatch(i);const j=i.filter(H=>g.pendingLocalTracks.indexOf(H)===-1);return void(g.pendingLocalTracks=g.pendingLocalTracks.concat(j))}g.store.pubId=g.store.pubId+1,k0.markPublishStart(g.store.clientId,g.store.pubId);const A=g.filterTobePublishedTracks(i,o,p);if(A.length===0)return void(yield d_(g.tryToUnmuteAudio(i)));yield*lP(a8(g.doPublish(g.connection,A)))}finally{b()}})()}doPublish(i,o){var p=this;return JS(function*(){o.forEach($=>{let{track:Vt,type:_r}=$;const Fi=Date.now();p.store.publish(Vt.getTrackId(),_r===TE.LocalAudioTrack?"audio":"video",Fi)}),p.bindLocalTrackEvents(o);const g=yield d_(i.send(o.map($=>{let{track:Vt}=$;return Vt}),p.store.codec,p.store.audioCodec)),b=(yield d_(g.next())).value,A=p.createGatewayPublishMessage(o,b);let j;try{j=yield A}catch($){throw g.throw($),($==null?void 0:$.code)===_p.WS_ABORT&&o.forEach(Vt=>{let{track:_r}=Vt;p.pendingLocalTracks.indexOf(_r)===-1&&p.pendingLocalTracks.push(_r)}),p.unbindLocalTrackEvents(o),$}const H=p.mapPubResToRemoteConfig(A,j),z=(yield d_(g.next(H))).value;o.forEach($=>{let{type:Vt}=$;p.statsCollector.addLocalStats(Vt)}),p.assignLocalTracks(o,z),p.statsUploader.startUploadUplinkStats(),o.forEach($=>{let{track:Vt,type:_r}=$;const Fi=Date.now();p.store.publish(Vt.getTrackId(),_r===TE.LocalAudioTrack?"audio":"video",void 0,Fi)})})()}async updateVideoStreamParameter(i,o){const p=this.localTrackMap.get(o);if(!p)return;if(!(p.track instanceof ZE))return Gi.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");if(!(this.connection instanceof c0||this.connection instanceof b0))return Gi.warn("[updateVideoStreamParameter]: connection is not P2PConnection or P2PConnectionPlanB");const{track:g}=p,b=function(A,j){const H={};return A.height&&A.width&&(H.scaleResolutionDownBy=c2(A,j)),H.maxFramerate=A.framerate?US(A.framerate):void 0,H.maxBitrate=A.bitrate?1e3*A.bitrate:void 0,H}(i,g);if(g._encoderConfig||(g._encoderConfig={}),o!==TE.LocalVideoLowTrack||!nE("DISABLE_DUAL_STREAM_USE_ENCODING")&&I_().supportDualStreamEncoding)b.scaleResolutionDownBy!=null&&(g._encoderConfig.scaleResolutionDownBy=b.scaleResolutionDownBy);else{const A=g._originMediaStreamTrack;if(!A.canvas)return Gi.warn("[".concat(g.getTrackId(),"] no canvas on track"));(function(j,H){const z=j.canvas;H.width&&(z.width=US(H.width)),H.height&&(z.height=US(H.height)),H.framerate&&(z.stopCapture&&z.stopCapture(),z.stopCapture=OM(()=>{!z.startCapture&&z.stopCapture&&z.stopCapture(),z.startCapture&&z.startCapture()},US(H.framerate)))})(A,i)}b.maxBitrate!=null&&(g._encoderConfig.bitrateMax=b.maxBitrate/1e3),b.maxFramerate!=null&&(g._encoderConfig.frameRate&&typeof g._encoderConfig.frameRate=="object"?g._encoderConfig.frameRate.max=b.maxFramerate:g._encoderConfig.frameRate={max:b.maxFramerate}),Gi.debug("[".concat(g.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(g._encoderConfig))),await this.connection.updateRtpSenderEncodings(g)}publishLowStream(i){var o=this;return JS(function*(){if(!o.connection||o.state!==u_.Connected)return;const p=yield d_(o.mutex.lock("Locking from P2PChannel.publishLowStream"));try{const b=o.localTrackMap.get(TE.LocalVideoTrack);if(!b)throw new yE(_p.UNEXPECTED_ERROR,"Could not find high stream");if(o.localTrackMap.has(TE.LocalVideoLowTrack))throw new yE(_p.UNEXPECTED_ERROR,"[".concat(o.store.clientId,"] Can't publish low stream when stream already publish"));const A=[{track:o.getLowVideoTrack(b.track,i),type:TE.LocalVideoLowTrack}];if(yield*lP(a8(o.doPublish(o.connection,A))),b.track.muted||!b.track.enabled){var g;const j=(g=o.localTrackMap.get(TE.LocalVideoLowTrack))===null||g===void 0?void 0:g.id;j!==void 0&&(yield d_(o.connection.muteLocal([j])))}}finally{p()}})()}async republish(){this.pendingLocalTracks.length>0&&(Gi.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await U_(this,WE.RequestRePublish,this.pendingLocalTracks),this.emit(WE.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[]),this.pendingLocalDataChannels.length>0&&(Gi.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),await U_(this,WE.RequestRePublishDataChannel,this.pendingLocalDataChannels),this.pendingLocalDataChannels=[])}async reSubscribe(i){for(let o=this.pendingRemoteTracks.length-1;o>=0;o--){const{user:p,kind:g}=this.pendingRemoteTracks[o];(g!==ME.AUDIO||p._audio_added_&&p._audioSSRC)&&(g!==ME.VIDEO||p._video_added_&&p._videoSSRC)||this.pendingRemoteTracks.splice(o,1)}if(i)await U_(this,WE.RequestReSubscribe,this.pendingRemoteTracks);else for(const{user:o,kind:p}of this.pendingRemoteTracks)await this.subscribe(o,p,p===ME.VIDEO?o._videoSSRC:o._audioSSRC);this.pendingRemoteTracks.forEach(o=>{let{user:p}=o;this.emit(WE.MediaReconnectEnd,p.uid)}),this.pendingRemoteTracks=[]}async unpublish(i){if(!this.connection||this.state!==u_.Connected)return void i.forEach(g=>{const b=this.pendingLocalTracks.indexOf(g);b!==-1&&this.pendingLocalTracks.splice(b,1)});const o=this.filterTobeUnpublishedTracks(i);if(o.length===0)return;const p=o.find(g=>g[0]==="videoLowTrack");return p&&p[1].track.close(),this.doUnpublish(this.connection,o)}async unpublishDataChannel(i){if(!this.connection||this.state!==u_.Connected)return void i.forEach(p=>{const g=this.pendingLocalDataChannels.indexOf(p);g!==-1&&this.pendingLocalDataChannels.splice(g,1)});const o=this.filterTobeUnpublishedDataChannels(i);return o.length!==0?(o.forEach(p=>{const g=this.localDataChannels.indexOf(p);g!==-1&&this.localDataChannels.splice(g,1)}),this.localDataChannels.length===0&&await this.connection.stopDataChannels(this.store.uid),o.map(p=>p.id)):void 0}async unpublishLowStream(){if(!this.connection||this.state!==u_.Connected)return;const i=this.localTrackMap.get(TE.LocalVideoLowTrack);if(!i)return;i.track.close();const o=[[TE.LocalVideoLowTrack,i]];return this.doUnpublish(this.connection,o)}async doUnpublish(i,o){const p=this.createGatewayUnpublishMessage(o);return await i.stopSending(o.map(g=>{let[,{id:b}]=g;return b})),this.withdrawLocalTracks(o),this.unbindLocalTrackEvents(o.map(g=>{let[b,{track:A}]=g;return{type:b,track:A}})),o.forEach(g=>{let[b]=g;this.statsCollector.removeLocalStats(b)}),this.localTrackMap.size===0&&this.statsUploader.stopUploadUplinkStats(),p}async subscribeDataChannel(i,o){if(!this.connection||this.state!==u_.Connected)throw new yE(_p.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");const p=o.filter(g=>{var b;return!((b=this.remoteDataChannelMap.get(i))!==null&&b!==void 0&&b.get(g.id))});if(p.length!==0)return await this.connection.createDataChannels(i.uid,p),p.forEach(g=>{var b;this.remoteDataChannelMap.has(i)?(b=this.remoteDataChannelMap.get(i))===null||b===void 0||b.set(g.id,g):this.remoteDataChannelMap.set(i,new Map([[g.id,g]]));const A=this.pendingRemoteDataChannels.findIndex(j=>{let{user:H,id:z}=j;return H.uid===i.uid&&z===g.id});A!==-1&&this.pendingRemoteDataChannels.splice(A,1)}),p.map(g=>g.id)}async subscribe(i,o,p,g,b){var A;if(!this.connection||this.state!==u_.Connected)throw new yE(_p.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if((A=this.remoteUserMap.get(i))!==null&&A!==void 0&&A.has(o))return;let j,H,z;if(b){const _r=b.find(_l=>{let{stream_type:_u}=_l;return _u===o});if(!_r)throw new yE(_p.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(o," for user: ").concat(i.uid," because subscribe answer from gateway does not contain stream_type: ").concat(o,"."));const Fi=await this.connection.receive(o,_r.ssrcs,String(i._uintid),_r.attributes);this.connection instanceof c0&&(z=Fi.transceiver),j=Fi.track,H=Fi.id}else{const _r=await this.connection.receive(o,[{ssrcId:p,rtx:g}],String(i._uintid),void 0);this.connection instanceof c0&&(z=_r.transceiver),j=_r.track,H=_r.id}o===ME.AUDIO?(i._audioTrack?i._audioTrack._updateOriginMediaStreamTrack(j):(i._audioTrack=new cT(j,i.uid,i._uintid,this.store),Gi.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(i._audioTrack.getTrackId()))),z&&i._audioTrack._updateRtpTransceiver(z),this.bindRemoteTrackEvents(i,i._audioTrack)):(i._videoTrack?i._videoTrack._updateOriginMediaStreamTrack(j):(i._videoTrack=new DT(j,i.uid,i._uintid,this.store),Gi.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(i._videoTrack.getTrackId()))),z&&i._videoTrack._updateRtpTransceiver(z),this.bindRemoteTrackEvents(i,i._videoTrack));const $=this.remoteUserMap.get(i);$?$.set(o,H):this.remoteUserMap.set(i,new Map([[o,H]])),this.statsCollector.addRemoteStats(i.uid),this.statsUploader.startUploadDownlinkStats();const Vt=this.pendingRemoteTracks.findIndex(_r=>{let{user:Fi,kind:_l}=_r;return Fi.uid===i.uid&&o===_l});Vt!==-1&&(this.pendingRemoteTracks.splice(Vt,1),this.emit(WE.MediaReconnectEnd,i.uid))}async massSubscribe(i){return this.massSubscribeNoLock(i)}async massSubscribeNoLock(i){if(!this.connection||this.state!==u_.Connected)throw new yE(_p.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");i=i.filter(p=>{var g;let{user:b,mediaType:A}=p;return!((g=this.remoteUserMap.get(b))!==null&&g!==void 0&&g.has(A))});const o=await this.connection.batchReceive(i.map(p=>{let{user:g,mediaType:b,ssrcId:A,rtxSsrcId:j}=p;return{kind:b,ssrcMsg:[{ssrcId:A,rtx:j}],mslabel:String(g._uintid)}}));i.forEach((p,g)=>{let{user:b,mediaType:A}=p;const{track:j,id:H,transceiver:z}=o[g];A===ME.AUDIO?(b._audioTrack?b._audioTrack._updateOriginMediaStreamTrack(j):(b._audioTrack=new cT(j,b.uid,b._uintid,this.store),Gi.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(b._audioTrack.getTrackId()))),z&&b._audioTrack._updateRtpTransceiver(z),this.bindRemoteTrackEvents(b,b._audioTrack)):(b._videoTrack?b._videoTrack._updateOriginMediaStreamTrack(j):(b._videoTrack=new DT(j,b.uid,b._uintid,this.store),Gi.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(b._videoTrack.getTrackId()))),z&&b._videoTrack._updateRtpTransceiver(z),this.bindRemoteTrackEvents(b,b._videoTrack));const $=this.remoteUserMap.get(b);$?$.set(A,H):this.remoteUserMap.set(b,new Map([[A,H]])),this.statsCollector.addRemoteStats(b.uid),this.statsUploader.startUploadDownlinkStats();const Vt=this.pendingRemoteTracks.findIndex(_r=>{let{user:Fi,kind:_l}=_r;return Fi.uid===b.uid&&A===_l});Vt!==-1&&(this.pendingRemoteTracks.splice(Vt,1),this.emit(WE.MediaReconnectEnd,b.uid))})}async unsubscribe(i,o,p){const g=this.pendingRemoteTracks.filter(j=>{let{user:H,kind:z}=j;return o!==void 0?H.uid===i.uid&&o===z:H.uid===i.uid});if(g.forEach(j=>{const H=this.pendingRemoteTracks.indexOf(j);this.pendingRemoteTracks.splice(H,1)}),this.connection&&this.state===u_.Connected||p||g.forEach(j=>{let{kind:H}=j;var z;if(H===ME.AUDIO)(z=i._audioTrack)===null||z===void 0||z._destroy(),i._audioTrack=void 0;else if(H===ME.VIDEO){var $;($=i._videoTrack)===null||$===void 0||$._destroy(),i._videoTrack=void 0}}),!this.connection||this.state!==u_.Connected)return;const b=this.filterTobeUnSubscribedTracks(i,o);if(b.length===0)return;await this.connection.stopReceiving(b.map(j=>{let[,{id:H}]=j;return H}));const A=this.createUnsubscribeMessage(b);return this.withdrawRemoteTracks(b),this.remoteUserMap.size===0&&this.statsUploader.stopUploadDownlinkStats(),b.forEach(j=>{let[H,{kind:z}]=j;var $,Vt;if(z===ME.VIDEO&&H._videoSSRC&&(($=this.connection)===null||$===void 0||$.setStatsRemoteVideoIsReady(H._videoSSRC,!1)),z===ME.VIDEO)this.unbindRemoteTrackEvents(H._videoTrack),p||((Vt=H._videoTrack)===null||Vt===void 0||Vt._destroy(),H._videoTrack=void 0);else if(z===ME.AUDIO){var _r;this.unbindRemoteTrackEvents(H._audioTrack),!p&&((_r=H._audioTrack)===null||_r===void 0||_r._destroy(),H._audioTrack=void 0)}}),A}async unsubscribeDataChannel(i,o){if(o.forEach(b=>{const A=this.pendingRemoteDataChannels.findIndex(j=>j.id===b.id);A!==-1&&this.pendingRemoteDataChannels.splice(A,1)}),!this.connection)return;const p=this.filterTobeUnSubscribedDataChannels(i,o);if(p.length===0)return;o.forEach(b=>{b._close()});const g=this.remoteDataChannelMap.get(i);return p.forEach(b=>{g&&g.delete(b.id)}),g&&g.size===0&&(this.remoteDataChannelMap.delete(i),await this.connection.stopDataChannels(i.uid)),p.map(b=>b.id)}async massUnsubscribe(i){return this.massUnsubscribeNoLock(i)}async massUnsubscribeNoLock(i){let o=[];for(const{user:b,mediaType:A}of i){const j=this.pendingRemoteTracks.filter(H=>{let{user:z,kind:$}=H;return A!==void 0?z.uid===b.uid&&A===$:z.uid===b.uid});j.forEach(H=>{const z=this.pendingRemoteTracks.indexOf(H);this.pendingRemoteTracks.splice(z,1)}),o=o.concat(j)}if(!this.connection||this.state!==u_.Connected)return void o.forEach(b=>{let{user:A,kind:j}=b;var H;if(j===ME.AUDIO)(H=A._audioTrack)===null||H===void 0||H._destroy(),A._audioTrack=void 0;else if(j===ME.VIDEO){var z;(z=A._videoTrack)===null||z===void 0||z._destroy(),A._videoTrack=void 0}});const p=ZR(i).call(i,(b,A)=>{let{user:j,mediaType:H}=A;const z=this.filterTobeUnSubscribedTracks(j,H);return b.concat(z)},[]);if(p.length===0)return;await this.connection.stopReceiving(p.map(b=>{let[,{id:A}]=b;return A}));const g=this.createUnsubscribeAllMessage(p);return this.withdrawRemoteTracks(p),this.remoteUserMap.size===0&&this.statsUploader.stopUploadDownlinkStats(),p.forEach(b=>{let[A,{kind:j}]=b;var H,z;if(j===ME.VIDEO&&A._videoSSRC&&((H=this.connection)===null||H===void 0||H.setStatsRemoteVideoIsReady(A._videoSSRC,!1)),j===ME.VIDEO)this.unbindRemoteTrackEvents(A._videoTrack),(z=A._videoTrack)===null||z===void 0||z._destroy(),A._videoTrack=void 0;else if(j===ME.AUDIO){var $;this.unbindRemoteTrackEvents(A._audioTrack),($=A._audioTrack)===null||$===void 0||$._destroy(),A._audioTrack=void 0}}),g}async muteRemote(i,o){if(!this.connection)return;const p=this.remoteUserMap.get(i);if(!p)return void Gi.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(i.uid,"."));if(!p.get(o))return void Gi.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(i.uid," media type ").concat(o,"."));const g=o===ME.VIDEO?i._videoSSRC:i._audioSSRC;g!==void 0&&this.connection.setStatsRemoteVideoIsReady(g,!1)}async unmuteRemote(i,o){return this.unmuteRemoteNoLock(i,o)}async unmuteRemoteNoLock(i,o){if(!this.connection)return;const p=this.remoteUserMap.get(i);if(!p)return void Gi.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(i.uid,"."));p.get(o)||Gi.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(i.uid," media type ").concat(o,"."))}getAllTracks(i){const o=this.localTrackMap.get(TE.LocalAudioTrack);if((o==null?void 0:o.track)instanceof Z_){const p=o.track;return Array.from(this.localTrackMap.entries()).filter(g=>{let[b]=g;return b!==TE.LocalAudioTrack}).filter(g=>{let[b]=g;return!(i&&b===TE.LocalVideoLowTrack)}).map(g=>{let[,{track:b}]=g;return b}).concat(p.trackList)}return Array.from(this.localTrackMap.entries()).filter(p=>{let[g]=p;return!(i&&g===TE.LocalVideoLowTrack)}).map(p=>{let[,{track:g}]=p;return g})}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(i,o,p,g,b){if(i){const j=this.localTrackMap.get(TE.LocalAudioTrack),H=g?this.localTrackMap.get(TE.LocalVideoLowTrack):this.localTrackMap.get(TE.LocalVideoTrack);jE.publish(this.store.sessionId,{eventElapse:k0.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:i,ec:o,audioName:j==null?void 0:j.track.getTrackLabel(),videoName:H==null?void 0:H.track.getTrackLabel(),screenshare:(H==null?void 0:H.track._hints.indexOf(A_.SCREEN_TRACK))!==-1,audio:!!j,video:!!H,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:b})}else{var A;p||(p=[]);const j=p.find(z=>z instanceof g_),H=g?(A=this.localTrackMap.get(TE.LocalVideoTrack))===null||A===void 0?void 0:A.track:p.find(z=>z instanceof ZE);jE.publish(this.store.sessionId,{eventElapse:k0.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:i,ec:o,audioName:j==null?void 0:j.getTrackLabel(),videoName:H==null?void 0:H.getTrackLabel(),screenshare:(H==null?void 0:H._hints.indexOf(A_.SCREEN_TRACK))!==-1,audio:!!j,video:!!H,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:b})}}reportSubscribeEvent(i,o,p,g){const b=g===ME.VIDEO?p._videoSSRC:p._audioSSRC;b&&jE.subscribe(this.store.sessionId,{succ:i,ec:o,video:g===ME.VIDEO,audio:g===ME.AUDIO,peerid:p.uid,subscribeRequestid:g===ME.VIDEO?p._videoSSRC:p._audioSSRC,p2pid:this.store.p2pId,eventElapse:k0.measureFromSubscribeStart(this.store.clientId,b)})}reset(){Gi.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new E0("P2PChannel-mutex"),this.connection&&(this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=this.store.useDataChannel?new u0({},this.store):this.isPlanB?new b0({},this.store):new c0({},this.store),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadUplinkStats(),this.statsUploader.stopUploadDownlinkStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const i=this.localTrackMap.get(TE.LocalAudioTrack);if((i==null?void 0:i.track)instanceof Z_){if(i.track.trackList.length>0){const o=i.track;i.track.trackList.forEach(p=>{o.removeAudioTrack(p)})}i.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=u_.Disconnected}getStats(){var i;return(i=this.connection)===null||i===void 0?void 0:i.getStats()}getRemoteVideoIsReady(i){var o;return((o=this.connection)===null||o===void 0?void 0:o.getRemoteVideoIsReady(i))||!1}getLocalAudioVolume(){const i=this.localTrackMap.get(TE.LocalAudioTrack);if(i)return i.track.getVolumeLevel()}getLocalVideoSize(){const i=this.localTrackMap.get(TE.LocalVideoTrack);if(i)return{width:i.track._videoWidth||0,height:i.track._videoHeight||0}}getEncoderConfig(i){const o=this.localTrackMap.get(i);return o&&o.track instanceof ZE||o&&o.track instanceof g_?o.track._encoderConfig:void 0}getLocalMedia(i){return this.localTrackMap.get(i)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(i,o){if(!i)return this.remoteUserMap.size>0;const p=this.remoteUserMap.get(i);return!!p&&(!o||p.has(o))}async hasRemoteMediaWithLock(i,o){if(!i)return this.remoteUserMap.size>0;const p=this.remoteUserMap.get(i);return!!p&&(!o||p.has(o))}getRemoteMedia(i){var o;const p=Array.from(RS(o=this.remoteUserMap).call(o)).find(g=>g.uid===i);return p?{audioTrack:p.audioTrack,audioSSRC:p._audioSSRC,videoTrack:p.videoTrack,videoSSRC:p._videoSSRC}:{}}getAudioLevels(){let i=Array.from(this.remoteUserMap.entries()).map(p=>{let[g]=p;return{uid:g.uid,level:g.audioTrack?100*g.audioTrack._source.getAccurateVolumeLevel():0}});const o=this.localTrackMap.get(TE.LocalAudioTrack);return o&&i.push({level:100*o.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),i=AO(i).call(i,(p,g)=>p.level-g.level),i}async disconnectForReconnect(){this.connection&&(Gi.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=u_.Reconnecting,nE("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(i=>{let[o]=i;var p;o._videoTrack&&o._videoTrack._player&&((p=o._videoTrack._player.getVideoElement())===null||p===void 0||p.pause(),o._videoTrack._player.isKeepLastFrame=!0,o._videoTrack._originMediaStreamTrack.stop())}),this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=this.store.useDataChannel?new u0({},this.store):this.isPlanB?new b0({},this.store):new c0({},this.store),this.bindConnectionEvents(this.connection)),this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(i=>{var o;let[p,{track:g}]=i;switch(p){case TE.LocalVideoTrack:VE(o=g._hints).call(o,A_.LOW_STREAM)?g.close():this.pendingLocalTracks.push(g);break;case TE.LocalAudioTrack:g instanceof Z_?this.pendingLocalTracks=this.pendingLocalTracks.concat(g.trackList):this.pendingLocalTracks.push(g);case TE.LocalVideoLowTrack:}}),this.emit(WE.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(i=>{let[o,p]=i;Array.from(RS(p).call(p)).forEach(g=>{this.setPendingRemoteMedia(o,g)}),this.emit(WE.MediaReconnectStart,o.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.localDataChannels.length!==0&&(this.localDataChannels.forEach(i=>{this.pendingLocalDataChannels.push(i)}),this.localDataChannels.length=0),this.remoteDataChannelMap.size!==0&&(Array.from(this.remoteDataChannelMap.entries()).forEach(i=>{let[o,p]=i;Array.from(RS(p).call(p)).forEach(g=>{this.setPendingRemoteDataChannel(o,g)})}),this.remoteDataChannelMap.clear()),this.statsUploader.stopUploadUplinkStats(),this.statsUploader.stopUploadDownlinkStats(),this.statsUploader.stopUploadTransportStats(),Gi.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteDataChannel(i,o){for(const p of this.pendingRemoteDataChannels){const{user:g,id:b}=p;if((i instanceof D0?i.uid:i)===g.uid&&b===o)return!0}return!1}setPendingRemoteDataChannel(i,o){this.hasPendingRemoteDataChannel(i,o)||this.pendingRemoteDataChannels.push({user:i,id:o})}hasPendingRemoteMedia(i,o){for(const p of this.pendingRemoteTracks){const{user:g,kind:b}=p;if((i instanceof D0?i.uid:i)===g.uid&&o===b)return!0}return!1}setPendingRemoteMedia(i,o){this.hasPendingRemoteMedia(i,o)||this.pendingRemoteTracks.push({user:i,kind:o})}restartICE(i){var o=this;return JS(function*(){if(!o.connection||o.state!==u_.Connected||o.connection instanceof u0)return;const p=yield d_(o.mutex.lock("From P2PChannel.restartICE"));let g;try{g=yield d_(o.connection.restartICE(i));const A=yield d_(g.next());if(A.done)return;const j=A.value,H=yield j;switch(o.reportPCDisconnectedOrFailed(i),i){case N0.TCP:o._pcStatsUploadType=yT.TCP_RESTART;break;case N0.RELAY:o._pcStatsUploadType=yT.RELAY_RESTART;break;default:o._pcStatsUploadType=yT.OLD_RESTART}o._isInRestartIce=!0,g.next(H)}catch(A){var b;(b=g)===null||b===void 0||b.throw(A)}finally{p()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;const i=this.connection.getStats(),o=this.localTrackMap.get(TE.LocalVideoTrack),p=this.localTrackMap.get(TE.LocalAudioTrack),g=i.videoSend.find(_l=>_l.ssrc===(o==null?void 0:o.ssrcs[0].ssrcId)),b=i.audioSend.find(_l=>_l.ssrc===(p==null?void 0:p.ssrcs[0].ssrcId));if(!g||!b)return 1;const A=oS(this,WE.NeedSignalRTT),j=g?g.rttMs:void 0,H=b?b.rttMs:void 0,z=j&&H?(j+H)/2:j||H,$=(z&&A?(z+A)/2:z||A)||0,Vt=100*i.sendPacketLossRate*.7/50+.3*$/1500,_r=Vt<.17?1:Vt<.36?2:Vt<.59?3:Vt<.1?4:5,Fi=o==null?void 0:o.track;if(Fi&&Fi._encoderConfig&&Fi._hints.indexOf(A_.SCREEN_TRACK)===-1){const _l=Fi._encoderConfig.bitrateMax,_u=i.bitrate.actualEncoded;if(_l&&_u){const _h=(1e3*_l-_u)/(1e3*_l);return h6[_h<.15?0:_h<.3?1:_h<.45?2:_h<.6?3:4][_r]}}return _r}getDownlinkNetworkQuality(){if(!this.connection)return 0;const i=this.connection.getStats();let o=0;return Array.from(this.remoteUserMap.entries()).forEach(p=>{let[g]=p;const b=g._audioSSRC,A=g._videoSSRC,j=i.audioRecv.find(_u=>_u.ssrc===b),H=i.videoRecv.find(_u=>_u.ssrc===A);if(!j&&!H)return void(o+=1);const z=oS(this,WE.NeedSignalRTT),$=i.rtt,Vt=($&&z?($+z)/2:$||z)||0,_r=j?j.jitterMs:void 0,Fi=i.recvPacketLossRate;let _l=.7*Fi*100/50+.3*Vt/1500;_r&&(_l=.6*Fi*100/50+.2*Vt/1500+.2*_r/400),o+=_l<.1?1:_l<.17?2:_l<.36?3:_l<.59?4:5}),this.remoteUserMap.size>0?Math.round(o/this.remoteUserMap.size):o}async muteLocalTrack(i){return new pE((o,p)=>{this.handleMuteLocalTrack(i,o,p)})}filterTobePublishedTracks(i,o,p){const g=[],b=I_(),A=this.getAllTracks();i=BI(i=i.filter(z=>A.indexOf(z)===-1));let j=!1,H=!1;for(const z of i){if(z instanceof ZE&&(this.localTrackMap.has(TE.LocalVideoTrack)||j?new yE(_p.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(g.push({track:z,type:TE.LocalVideoTrack}),j=!0),o)){const $=this.getLowVideoTrack(z,p);g.push({track:$,type:TE.LocalVideoLowTrack})}if(z instanceof g_){const $=this.localTrackMap.get(TE.LocalAudioTrack);if($){if(!($.track instanceof Z_))throw new yE(_p.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(z._bypassWebAudio)throw new yE(_p.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");$.track.addAudioTrack(z),this.bindLocalAudioTrackEvents(z,!0)}else if(H){const Vt=g.find(_r=>{let{type:Fi}=_r;return Fi===TE.LocalAudioTrack});if(!(Vt.track instanceof Z_))throw new yE(_p.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(z._bypassWebAudio)throw new yE(_p.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");Vt.track.addAudioTrack(z)}else{if(!b.webAudioMediaStreamDest||z instanceof Z_||z._bypassWebAudio)g.push({track:z,type:TE.LocalAudioTrack});else{const Vt=new Z_;Vt.addAudioTrack(z),g.push({track:Vt,type:TE.LocalAudioTrack})}H=!0}}}return g}filterTobeUnpublishedTracks(i){const o=[],p=this.getAllTracks();i=BI(i=i.filter(g=>p.indexOf(g)!==-1));for(const g of i){if(g instanceof g_){const b=this.localTrackMap.get(TE.LocalAudioTrack);if(!b)continue;b.track instanceof Z_?(b.track.removeAudioTrack(g),this.unbindLocalAudioTrackEvents(g),b.track.trackList.length===0&&(o.push([TE.LocalAudioTrack,b]),b.track.close())):o.push([TE.LocalAudioTrack,b])}if(g instanceof ZE){const b=this.localTrackMap.get(TE.LocalVideoTrack);if(!b)continue;o.push([TE.LocalVideoTrack,b]);const A=this.localTrackMap.get(TE.LocalVideoLowTrack);A&&o.push([TE.LocalVideoLowTrack,A])}}return o}filterTobePublishedDataChannels(i){return i=(i=BI(i)).filter(o=>this.localDataChannels.findIndex(p=>p.id===o.id)===-1)}filterTobeUnpublishedDataChannels(i){return i=(i=(i=BI(i)).filter(o=>this.localDataChannels.indexOf(o)!==-1)).filter(o=>o._originDataChannel)}bindLocalTrackEvents(i){i.forEach(o=>{let{track:p,type:g}=o;switch(g){case TE.LocalVideoTrack:p.addListener(xE.GET_STATS,this.handleGetLocalVideoStats),p.addListener(xE.GET_RTC_STATS,this.handleGetRTCStats),p.addListener(xE.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),p.addListener(xE.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),p.addListener(xE.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),p.addListener(xE.SET_OPTIMIZATION_MODE,this.handleSetOptimizationMode),p.addListener(xE.NEED_REPLACE_TRACK,this.handleReplaceTrack),p.addListener(xE.NEED_MUTE_TRACK,this.handleMuteLocalTrack),p.addListener(xE.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case TE.LocalAudioTrack:this.bindLocalAudioTrackEvents(p);case TE.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(i,o){i instanceof Z_?i.trackList.forEach(p=>{p.addListener(xE.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),p.addListener(xE.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),p.addListener(xE.GET_STATS,this.handleGetLocalAudioStats),p.addListener(xE.NEED_MUTE_TRACK,this.handleMuteLocalTrack),p.addListener(xE.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(i.addListener(xE.GET_STATS,this.handleGetLocalAudioStats),i.addListener(xE.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.addListener(xE.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.addListener(xE.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.addListener(xE.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),o||i.addListener(xE.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(i){i||(i=Array.from(this.localTrackMap.entries()).map(o=>{let[p,{track:g}]=o;return{track:g,type:p}})),i.forEach(o=>{let{track:p,type:g}=o;switch(g){case TE.LocalVideoTrack:p.off(xE.GET_STATS,this.handleGetLocalVideoStats),p.off(xE.GET_RTC_STATS,this.handleGetRTCStats),p.off(xE.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),p.off(xE.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),p.off(xE.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),p.off(xE.SET_OPTIMIZATION_MODE,this.handleSetOptimizationMode),p.off(xE.NEED_REPLACE_TRACK,this.handleReplaceTrack),p.off(xE.NEED_MUTE_TRACK,this.handleMuteLocalTrack),p.off(xE.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case TE.LocalAudioTrack:this.unbindLocalAudioTrackEvents(p);case TE.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(i){i instanceof Z_?i.trackList.forEach(o=>{o.off(xE.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),o.off(xE.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),o.off(xE.GET_STATS,this.handleGetLocalAudioStats),o.off(xE.NEED_MUTE_TRACK,this.handleMuteLocalTrack),o.off(xE.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(i.off(xE.GET_STATS,this.handleGetLocalAudioStats),i.off(xE.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.off(xE.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.off(xE.NEED_REPLACE_TRACK,this.handleReplaceTrack),i.off(xE.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.off(xE.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(i,o){o instanceof DT&&o.addListener(xE.GET_STATS,p=>{p(this.handleGetRemoteVideoStats(i))}),o instanceof cT&&o.addListener(xE.GET_STATS,p=>{p(this.handleGetRemoteAudioStats(i))})}unbindRemoteTrackEvents(i){i&&i.removeAllListeners(xE.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(i=>{let[o,p]=i;p.has(ME.AUDIO)&&this.unbindRemoteTrackEvents(o._audioTrack),p.has(ME.VIDEO)&&this.unbindRemoteTrackEvents(o._videoTrack)})}createGatewayPublishMessage(i,o){return i.map((p,g)=>{var b;let A,j,{track:H,type:z}=p;switch(z){case TE.LocalAudioTrack:A=v_.Audio,j={dtx:H instanceof _R&&H._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case TE.LocalVideoTrack:A=VE(b=H._hints).call(b,A_.SCREEN_TRACK)?v_.Screen:v_.High,j=OR(OR({},rP(H)),{},{codec:this.store.codec});break;case TE.LocalVideoLowTrack:A=v_.Low,j=OR(OR({},rP(H)),{},{codec:this.store.codec})}return{stream_type:A,attributes:j,ssrcs:o[g]}})}createGatewayUnpublishMessage(i){return i.map(o=>{var p;let g,[b,{track:A,ssrcs:j,id:H}]=o;switch(b){case TE.LocalVideoTrack:g=VE(p=A._hints).call(p,A_.SCREEN_TRACK)?v_.Screen:v_.High;break;case TE.LocalAudioTrack:g=v_.Audio;break;case TE.LocalVideoLowTrack:g=v_.Low}return{stream_type:g,ssrcs:j,mid:H}})}assignLocalTracks(i,o){i.forEach((p,g)=>{let{track:b,type:A}=p;this.localTrackMap.set(A,{track:b,id:o[g].id,ssrcs:o[g].localSSRC})})}withdrawLocalTracks(i){i.forEach(o=>{let[p]=o;this.localTrackMap.delete(p)})}bindConnectionEvents(i){i.onConnectionStateChange=async o=>{if(Gi.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(o,")")),this.emit(WE.PeerConnectionStateChange,o),o!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),o==="connected"&&(this._restartTimer&&(clearTimeout(this._restartTimer),this._restartTimer=void 0),(this._isFirstConnected||this._isInRestartIce)&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isInRestartIce=!1,this._isFirstConnected=!1,this._isStartRestartIce=!1),nE("NEW_ICE_RESTART")){var p;if(VE(p=this._restartStates).call(p,o)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;const g=j=>{(i.iceConnectionState==="disconnected"||i.iceConnectionState==="checking"||i.iceConnectionState==="failed")&&(Gi.debug("[".concat(this.store.clientId,"] [P2PChannel] start use restartICE, type is ").concat(j)),oS(this,WE.QueryClientConnectionState)==="CONNECTED"&&this.emit(WE.RequestRestartICE,j))},b=()=>{i.iceConnectionState!=="disconnected"&&i.iceConnectionState!=="checking"&&i.iceConnectionState!=="failed"||(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),Gi.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout(()=>this.emit(WE.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},A=nE("ICE_RESTART_INTERVAL");return void(this._restartTimer=window.setTimeout(()=>{if(nE("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&I_().supportPCSetConfiguration)g(N0.RELAY),this._restartTimer=window.setTimeout(b,A);else if(N_())g(N0.UDP),this._restartTimer=window.setTimeout(b,4e3);else{if(g(N0.TCP),I_().supportPCSetConfiguration)return void(this._restartTimer=window.setTimeout(()=>{g(N0.RELAY),this._restartTimer=window.setTimeout(b,A)},A));this._restartTimer=window.setTimeout(b,A)}},800))}}else{if(o==="disconnected"&&i.iceConnectionState==="disconnected")return setTimeout(()=>{i.iceConnectionState==="disconnected"&&nE("ICE_RESTART")&&oS(this,WE.QueryClientConnectionState)==="CONNECTED"&&this.emit(WE.RequestRestartICE)},800),void setTimeout(()=>{i.peerConnectionState==="disconnected"&&(Gi.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isInRestartIce=!1,setTimeout(()=>this.emit(WE.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},4e3);o==="failed"&&(Gi.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCDisconnectedOrFailed(),setTimeout(()=>this.emit(WE.P2PLost),0),this.iceFailedCount+=1,await this.requestReconnect())}},i.onICEConnectionStateChange=o=>{o!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),Gi.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(o,")")),jE.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:o,tag:x_.TRACER}).onSuccess(),this.emit(WE.IceConnectionStateChange,o)},i.onICETransportStateChange=o=>{Gi.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(o,")"))},i.onDTLSTransportStateChange=o=>{Gi.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(o,")"))},i.onDTLSTransportError=o=>{Gi.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(o,")"))},i.onFirstAudioDecoded=o=>{var p;const g=Array.from(RS(p=this.remoteUserMap).call(p)).find(A=>A._audioSSRC===o);var b;g&&(this.store.subscribe(g.uid,"audio",void 0,void 0,void 0,Date.now()),(b=g.audioTrack)===null||b===void 0||b.emit(sI.FIRST_FRAME_DECODED),jE.firstRemoteFrame(this.store.sessionId,p0.FIRST_AUDIO_DECODE,L_.FIRST_AUDIO_DECODE,{peer:g._uintid,subscribeElapse:k0.measureFromSubscribeStart(this.store.clientId,o),subscribeRequestid:o,p2pid:this.store.p2pId}))},i.onFirstAudioReceived=o=>{var p;const g=Array.from(RS(p=this.remoteUserMap).call(p)).find(b=>b._audioSSRC===o);g&&jE.firstRemoteFrame(this.store.sessionId,p0.FIRST_AUDIO_RECEIVED,L_.FIRST_AUDIO_RECEIVED,{peer:g._uintid,subscribeElapse:k0.measureFromSubscribeStart(this.store.clientId,o),subscribeRequestid:o,p2pid:this.store.p2pId})},i.onFirstVideoDecoded=(o,p,g)=>{this.reportVideoFirstFrameDecoded(o,p,g)},i.onFirstVideoReceived=o=>{var p;const g=Array.from(RS(p=this.remoteUserMap).call(p)).find(b=>b._videoSSRC===o);g&&jE.firstRemoteFrame(this.store.sessionId,p0.FIRST_VIDEO_RECEIVED,L_.FIRST_VIDEO_RECEIVED,{peer:g._uintid,subscribeElapse:k0.measureFromSubscribeStart(this.store.clientId,o),subscribeRequestid:o,p2pid:this.store.p2pId})},i.onSelectedLocalCandidateChanged=(o,p)=>{const g=o.candidateType==="relay",b=p.candidateType==="relay";p.candidateType!=="unknown"&&g===b||this.emit(WE.ConnectionTypeChange,g),Gi.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(IR(p))," -> ").concat(JSON.stringify(IR(o)),")"))},i.onSelectedRemoteCandidateChanged=(o,p)=>{Gi.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(IR(p))," -> ").concat(JSON.stringify(IR(o)),")"))},i.onFirstVideoDecodedTimeout=o=>{this.reportVideoFirstFrameDecoded(o,void 0,void 0,!0)}}unbindConnectionEvents(i){i.onConnectionStateChange=void 0,i.onICEConnectionStateChange=void 0,i.onICETransportStateChange=void 0,i.onDTLSTransportStateChange=void 0,i.onDTLSTransportError=void 0,i.onFirstAudioDecoded=void 0,i.onFirstAudioReceived=void 0,i.onFirstVideoDecoded=void 0,i.onFirstVideoReceived=void 0,i.onSelectedLocalCandidateChanged=void 0,i.onSelectedRemoteCandidateChanged=void 0,i.onFirstVideoDecodedTimeout=void 0}filterTobeMutedTracks(i){const o=[];if(this.getAllTracks().indexOf(i)===-1)return o;const p=this.localTrackMap.get(TE.LocalAudioTrack);if(i instanceof g_&&(p==null?void 0:p.track)instanceof Z_)return p.track.isActive||o.push([TE.LocalAudioTrack,p]),o;const g=Array.from(this.localTrackMap.entries()).find(b=>{let[,{track:A}]=b;return i===A});if(g&&(o.push(g),g[0]===TE.LocalVideoTrack)){const b=this.localTrackMap.get(TE.LocalVideoLowTrack);b&&o.push([TE.LocalVideoLowTrack,b])}return o}filterTobeUnmutedTracks(i){const o=[],p=this.localTrackMap.get(TE.LocalAudioTrack);if(i instanceof g_&&(p==null?void 0:p.track)instanceof Z_)return p.track.isActive&&o.push([TE.LocalAudioTrack,p]),o;const g=Array.from(this.localTrackMap.entries()).find(b=>{let[,{track:A}]=b;return i===A});if(g)if(g[0]===TE.LocalVideoTrack){o.push(g);const b=this.localTrackMap.get(TE.LocalVideoLowTrack);b&&o.push([TE.LocalVideoLowTrack,b])}else o.push(g);return o}createMuteMessage(i){return i.map(o=>{var p;let g,[b,{track:A,ssrcs:j,id:H}]=o;switch(b){case TE.LocalAudioTrack:g=v_.Audio;break;case TE.LocalVideoTrack:g=VE(p=A._hints).call(p,A_.SCREEN_TRACK)?v_.Screen:v_.High;break;case TE.LocalVideoLowTrack:g=v_.Low}return{stream_type:g,ssrcs:j,mid:H}})}createUnmuteMessage(i){return i.map(o=>{var p;let g,[b,{track:A,ssrcs:j,id:H}]=o;switch(b){case TE.LocalAudioTrack:g=v_.Audio;break;case TE.LocalVideoTrack:g=VE(p=A._hints).call(p,A_.SCREEN_TRACK)?v_.Screen:v_.High;break;case TE.LocalVideoLowTrack:g=v_.Low}return{stream_type:g,ssrcs:j,mid:H}})}filterTobeUnSubscribedTracks(i,o){const p=[],g=this.remoteUserMap.get(i);if(!g)return p;if(o){const b=g.get(o);if(!b)return p;p.push([i,{kind:o,id:b}])}else Array.from(g.entries()).forEach(b=>{let[A,j]=b;p.push([i,{kind:A,id:j}])});return p}filterTobeUnSubscribedDataChannels(i,o){const p=[];return o.forEach(g=>{var b;(b=this.remoteDataChannelMap.get(i))!==null&&b!==void 0&&b.has(g.id)&&p.push(g)}),p}createUnsubscribeMessage(i){const o=[];return i.forEach(p=>{let[g,{kind:b,id:A}]=p;switch(b){case ME.VIDEO:return void(g._videoSSRC&&o.push({stream_type:ME.VIDEO,ssrcId:g._videoSSRC}));case ME.AUDIO:return void(g._audioSSRC&&o.push({stream_type:ME.AUDIO,ssrcId:g._audioSSRC}))}}),o}createUnsubscribeAllMessage(i){const o=new Map;return i.forEach(p=>{let[g,{kind:b}]=p;if(o.has(g)){let A=o.get(g);b===ME.VIDEO?A|=n0.Video:A|=n0.Audio,o.set(g,A)}else b===ME.VIDEO?o.set(g,n0.Video):o.set(g,n0.Audio)}),{users:Array.from(o.entries()).map(p=>{let[g,b]=p;return{stream_id:g.uid,stream_type:b}})}}withdrawRemoteTracks(i){i.forEach(o=>{let[p,{kind:g}]=o;const b=this.remoteUserMap.get(p);b&&(b.delete(g),Array.from(b.entries()).length===0&&this.remoteUserMap.delete(p))})}async updateBitrateLimit(i){const o=this.localTrackMap.get(TE.LocalVideoTrack),p=this.localTrackMap.get(TE.LocalVideoLowTrack);o&&await o.track.setBitrateLimit(i.uplink),p&&i.low_stream_uplink&&await p.track.setBitrateLimit({max_bitrate:i.low_stream_uplink.bitrate,min_bitrate:i.low_stream_uplink.bitrate||0})}isP2PDisconnected(){return this.connection?this.connection.peerConnectionState!=="connected":!0}mapPubResToRemoteConfig(i,o){return i.map((p,g)=>{var b;let{stream_type:A}=p;return(b=o.find(j=>{let{stream_type:H}=j;return A===H}))===null||b===void 0?void 0:b.attributes})}async tryToUnmuteAudio(i){for(let p=0;p<i.length;p++)if(i[p]instanceof g_){var o;const g=this.filterTobeUnmutedTracks(i[p]);if(g.length===0)continue;await((o=this.connection)===null||o===void 0?void 0:o.unmuteLocal(g.map(A=>{let[,{id:j}]=A;return j})));const b=this.createUnmuteMessage(g);return void await S_(this,WE.RequestUnmuteLocal,b)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=i=>{var o;return!((o=this.connection)===null||o===void 0||!o.getRemoteVideoIsReady(i))},this.statsUploader.requestUpload=(i,o)=>this.emit(WE.RequestUploadStats,i,o),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await w0(mN(this.dtlsFailedCount,$_)),this.emit(WE.RequestReconnect)}async reconnectP2P(){const i=Array.from(this.localTrackMap.entries()),o=this.createGatewayUnpublishMessage(i);Array.from(this.remoteUserMap.entries()),o.length>0&&await U_(this,WE.RequestUnpublishForReconnectPC,o),this.disconnectForReconnect(),this.emit(WE.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has(TE.LocalVideoTrack)||this.pendingLocalTracks.some(i=>i instanceof ZE)}throwIfTrackTypeNotMatch(i){if(i.filter(o=>o instanceof ZE).length>1)throw new yE(_p.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(i.filter(o=>o instanceof g_).length>1&&(i.some(o=>o instanceof g_&&o._bypassWebAudio)||!I_().webAudioMediaStreamDest))throw new yE(_p.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const o of i){if(o instanceof ZE&&this.pendingLocalTracks.some(p=>p instanceof ZE))throw new yE(_p.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(o instanceof g_&&this.pendingLocalTracks.some(p=>p instanceof g_)&&(!I_().webAudioMediaStreamDest||o._bypassWebAudio||this.pendingLocalTracks.some(p=>p instanceof g_&&p._bypassWebAudio)))throw new yE(_p.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(i,o){const p=!nE("DISABLE_DUAL_STREAM_USE_ENCODING")&&I_().supportDualStreamEncoding,g=OR(OR({},{width:160,height:120,framerate:15,bitrate:50}),o);let b;b=p?i._mediaStreamTrack.clone():R2(i,g);const A=T_(8,"track-low-"),j=new ZE(b,OR(OR({},p&&{scaleResolutionDownBy:c2(g,i)}),{},{frameRate:g.framerate,bitrateMax:g.bitrate,bitrateMin:g.bitrate}),void 0,void 0,A);return j.on($I.TRANSCEIVER_UPDATED,H=>{i._updateRtpTransceiver(H,ER.LOW_STREAM)}),j._hints.push(A_.LOW_STREAM),i.addListener(xE.NEED_CLOSE,()=>{j.close()}),j}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(i,o,p){let g=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(this.connection&&this.connection instanceof c0){var b,A,j,H;const z=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:$,dtlsTransportState:Vt,peerConnectionState:_r}=this.connection,{local:Fi,remote:_l}=await this.connection.getSelectedCandidatePair();jE.pcStats(this.store.sessionId,{startTime:z,eventElapse:i-z||0,iceconnectionsate:$,dtlsstate:Vt,connectionstate:_r,intSucc:o?1:2,error:g,selectedLocalCandidateProtocol:(b=Fi==null?void 0:Fi.protocol)!==null&&b!==void 0?b:"",selectedLocalCandidateType:(A=Fi.candidateType)!==null&&A!==void 0?A:"",selectedLocalCandidateAddress:"".concat(Fi.address,":").concat(Fi.port),selectedRemoteCandidateProtocol:(j=_l.protocol)!==null&&j!==void 0?j:"",selectedRemoteCandidateType:(H=_l.candidateType)!==null&&H!==void 0?H:"",selectedRemoteCandidateAddress:"".concat(_l.address,":").concat(_l.port),restartCnt:p})}}reportVideoFirstFrameDecoded(i,o,p,g){var b;const A=Array.from(RS(b=this.remoteUserMap).call(b)).find(j=>j._videoSSRC===i);if(A){g||this.store.subscribe(A.uid,"video",void 0,void 0,void 0,void 0,Date.now());const j=this.store.keyMetrics,H=j.subscribe.find(z=>z.userId===A.uid&&z.type==="video");jE.firstRemoteVideoDecode(this.store.sessionId,p0.FIRST_VIDEO_DECODE,L_.FIRST_VIDEO_DECODE,{peer:A._uintid,videowidth:o,videoheight:p,subscribeElapse:k0.measureFromSubscribeStart(this.store.clientId,i),subscribeRequestid:i,p2pid:this.store.p2pId,apEnd:j.requestAPEnd||0,apStart:j.requestAPStart||0,joinGwEnd:j.joinGatewayEnd||0,joinGwStart:j.joinGatewayStart||0,pcEnd:j.peerConnectionEnd||0,pcStart:j.peerConnectionStart||0,subscriberEnd:(H==null?void 0:H.subscribeEnd)||0,subscriberStart:(H==null?void 0:H.subscribeStart)||0,videoAddNotify:(H==null?void 0:H.streamAdded)||0,state:g?1:0})}}async remoteMediaSsrcChanged(i,o,p){if(!this.connection)return!1;const g=this.remoteUserMap.get(i);if(!g)return!1;const b=g.get(o);if(!b)return!1;const A=await this.connection.getRemoteSSRC(b);return A!==void 0&&A!==p}resetConnection(i){Gi.debug("[".concat(this.store.clientId,"] [P2PChannel] reset connection to ").concat(i)),this.state===u_.Connected?(Gi.debug("[".concat(this.store.clientId,"] [P2PChannel] fallback to websocket but P2PChannel state still connected, disconnect first")),this.disconnectForReconnect()):(this.connection&&(this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=i===wN.datachannel?new u0({},this.store):this.isPlanB?new b0({},this.store):new c0({},this.store),this.bindConnectionEvents(this.connection)))}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(i=>{let[o,{track:p}]=i;o===TE.LocalVideoLowTrack?p._updateRtpTransceiver(void 0,ER.LOW_STREAM):p._updateRtpTransceiver(void 0)})}reportPCDisconnectedOrFailed(i){this.connection&&this.connection instanceof c0&&(this.connection.iceConnectionState!=="disconnected"&&this.connection.iceConnectionState!=="checking"&&this.connection.iceConnectionState!=="failed"||(this._isFirstConnected?(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isFirstConnected=!1):this._pcStatsUploadType===yT.TCP_RESTART&&i===N0.RELAY?this.reportPCStats(Date.now(),!1,this._pcStatsUploadType):this.reportPCStats(Date.now(),!1,yT.DISCONNECTED_OR_FAILED)))}}function q0(l,i,o){const p=l[i];if(typeof p!="function")throw new Error("Cannot use mutex on object property.");return o.value=async function(){const g=this.mutex,b=await g.lock("From P2PChannel.".concat(i));try{for(var A=arguments.length,j=new Array(A),H=0;H<A;H++)j[H]=arguments[H];return await p.apply(this,j)}finally{b()}},o}function qet(l){let i=l8();return function(o,p){let g=o.appId;g!==void 0&&(E_(p,10),jT(p,g));let b=o.cid;b!==void 0&&(E_(p,16),E_(p,b));let A=o.cname;A!==void 0&&(E_(p,26),jT(p,A));let j=o.deviceId;j!==void 0&&(E_(p,34),jT(p,j));let H=o.elapse;H!==void 0&&(E_(p,40),NR(p,H));let z=o.fileSize;z!==void 0&&(E_(p,48),NR(p,lO(z)));let $=o.height;$!==void 0&&(E_(p,56),NR(p,lO($)));let Vt=o.jpg;Vt!==void 0&&(E_(p,66),E_(p,Vt.length),function(yS,RE){let AE=dO(yS,RE.length);yS.bytes.set(RE,AE)}(p,Vt));let _r=o.networkType;_r!==void 0&&(E_(p,72),NR(p,lO(_r)));let Fi=o.osType;Fi!==void 0&&(E_(p,80),NR(p,lO(Fi)));let _l=o.requestId;_l!==void 0&&(E_(p,90),jT(p,_l));let _u=o.sdkVersion;_u!==void 0&&(E_(p,98),jT(p,_u));let _h=o.sequence;_h!==void 0&&(E_(p,104),NR(p,lO(_h)));let _g=o.sid;_g!==void 0&&(E_(p,114),jT(p,_g));let eE=o.timestamp;eE!==void 0&&(E_(p,120),NR(p,eE));let oE=o.uid;oE!==void 0&&(E_(p,128),E_(p,oE));let SE=o.vid;SE!==void 0&&(E_(p,136),E_(p,SE));let vE=o.width;vE!==void 0&&(E_(p,144),NR(p,lO(vE)));let fE=o.service;fE!==void 0&&(E_(p,152),E_(p,fE));let mE=o.callbackData;mE!==void 0&&(E_(p,162),jT(p,mE));let EE=o.jpgEncryption;EE!==void 0&&(E_(p,168),E_(p,EE));let PE=o.requestType;PE!==void 0&&(E_(p,176),E_(p,PE));let OE=o.scorePorn;OE!==void 0&&(E_(p,185),k2(p,OE));let $E=o.scoreSexy;$E!==void 0&&(E_(p,193),k2(p,$E));let s_=o.scoreNeutral;s_!==void 0&&(E_(p,201),k2(p,s_));let B_=o.scene;B_!==void 0&&(E_(p,208),E_(p,B_));let r0=o.ossFilePrefix;r0!==void 0&&(E_(p,218),jT(p,r0));let P_=o.serviceVendor;if(P_!==void 0)for(let yS of P_){E_(p,226);let RE=l8();zet(yS,RE),E_(p,RE.limit),Xet(p,RE),Jet(RE)}}(l,i),function(o){let p=o.bytes,g=o.limit;return p.length===g?p:p.subarray(0,g)}(i)}function Wet(l){return function(o){let p={};t:for(;!d8(o);){let g=VT(o);switch(g>>>3){case 0:break t;case 1:p.code=VT(o);break;case 2:p.msg=h8(o,VT(o));break;case 3:{let b=Ket(o);p.data=Het(o),o.limit=b;break}default:c8(o,7&g)}}return p}({bytes:i=l,offset:0,limit:i.length});var i}function Het(l){let i={};t:for(;!d8(l);){let o=VT(l);switch(o>>>3){case 0:break t;case 1:i.requestId=h8(l,VT(l));break;case 2:i.requestType=VT(l)>>>0;break;case 3:i.scorePorn=P2(l);break;case 4:i.scoreSexy=P2(l);break;case 5:i.scoreNeutral=P2(l);break;case 6:i.requestScene=VT(l)>>>0;break;case 7:i.scene=VT(l)>>>0;break;default:c8(l,7&o)}}return i}function zet(l,i){let o=l.service;o!==void 0&&(E_(i,8),E_(i,o));let p=l.vendor;p!==void 0&&(E_(i,16),E_(i,p));let g=l.token;g!==void 0&&(E_(i,26),jT(i,g));let b=l.callbackUrl;b!==void 0&&(E_(i,34),jT(i,b))}function Ket(l){let i=VT(l),o=l.limit;return l.limit=l.offset+i,o}function c8(l,i){switch(i){case 0:for(;128&p8(l););break;case 2:O2(l,VT(l));break;case 5:O2(l,4);break;case 1:O2(l,8);break;default:throw new Error("Unimplemented type: "+i)}}bE([q0,kc("design:type",Function),kc("design:paramtypes",[Object,Boolean]),kc("design:returntype",pE)],S0.prototype,"startP2PConnection",null),bE([q0,kc("design:type",Function),kc("design:paramtypes",[Object,Object,Array,Object,String,String]),kc("design:returntype",pE)],S0.prototype,"connect",null),bE([q0,kc("design:type",Function),kc("design:paramtypes",[Array]),kc("design:returntype",void 0)],S0.prototype,"updateRemoteRTPCapabilities",null),bE([q0,kc("design:type",Function),kc("design:paramtypes",[Object,Object,Array,Object,String,String]),kc("design:returntype",pE)],S0.prototype,"preConnect",null),bE([q0,kc("design:type",Function),kc("design:paramtypes",[Array]),kc("design:returntype",pE)],S0.prototype,"publishDataChannel",null),bE([q0,kc("design:type",Function),kc("design:paramtypes",[Array]),kc("design:returntype",pE)],S0.prototype,"unpublish",null),bE([q0,kc("design:type",Function),kc("design:paramtypes",[Array]),kc("design:returntype",pE)],S0.prototype,"unpublishDataChannel",null),bE([q0,kc("design:type",Function),kc("design:paramtypes",[]),kc("design:returntype",pE)],S0.prototype,"unpublishLowStream",null),bE([q0,kc("design:type",Function),kc("design:paramtypes",[D0,Array]),kc("design:returntype",pE)],S0.prototype,"subscribeDataChannel",null),bE([q0,kc("design:type",Function),kc("design:paramtypes",[D0,String,Number,Number,Array]),kc("design:returntype",pE)],S0.prototype,"subscribe",null),bE([q0,kc("design:type",Function),kc("design:paramtypes",[Array]),kc("design:returntype",pE)],S0.prototype,"massSubscribe",null),bE([q0,kc("design:type",Function),kc("design:paramtypes",[D0,String,Boolean]),kc("design:returntype",pE)],S0.prototype,"unsubscribe",null),bE([q0,kc("design:type",Function),kc("design:paramtypes",[D0,Array]),kc("design:returntype",pE)],S0.prototype,"unsubscribeDataChannel",null),bE([q0,kc("design:type",Function),kc("design:paramtypes",[Array]),kc("design:returntype",pE)],S0.prototype,"massUnsubscribe",null),bE([q0,kc("design:type",Function),kc("design:paramtypes",[D0,String]),kc("design:returntype",pE)],S0.prototype,"muteRemote",null),bE([q0,kc("design:type",Function),kc("design:paramtypes",[D0,String]),kc("design:returntype",pE)],S0.prototype,"unmuteRemote",null),bE([q0,kc("design:type",Function),kc("design:paramtypes",[D0,String]),kc("design:returntype",pE)],S0.prototype,"hasRemoteMediaWithLock",null),bE([q0,kc("design:type",Function),kc("design:paramtypes",[]),kc("design:returntype",pE)],S0.prototype,"disconnectForReconnect",null),bE([q0,kc("design:type",Function),kc("design:paramtypes",[Object]),kc("design:returntype",pE)],S0.prototype,"updateBitrateLimit",null),bE([q0,kc("design:type",Function),kc("design:paramtypes",[D0,String,Number]),kc("design:returntype",pE)],S0.prototype,"remoteMediaSsrcChanged",null);let Yet=new Float32Array(1);new Uint8Array(Yet.buffer);let A2=new Float64Array(1),pS=new Uint8Array(A2.buffer);function lO(l){return{low:l|=0,high:l>>31,unsigned:l>=0}}let u8=[];function l8(){const l=u8.pop();return l?(l.offset=l.limit=0,l):{bytes:new Uint8Array(64),offset:0,limit:0}}function Jet(l){u8.push(l)}function O2(l,i){if(l.offset+i>l.limit)throw new Error("Skip past limit");l.offset+=i}function d8(l){return l.offset>=l.limit}function dO(l,i){let o=l.bytes,p=l.offset,g=l.limit,b=p+i;if(b>o.length){let A=new Uint8Array(2*b);A.set(o),l.bytes=A}return l.offset=b,b>g&&(l.limit=b),p}function N2(l,i){let o=l.offset;if(o+i>l.limit)throw new Error("Read past limit");return l.offset+=i,o}function h8(l,i){let o=N2(l,i),p=String.fromCharCode,g=l.bytes,b="ï¿½",A="";for(let j=0;j<i;j++){let H,z,$,Vt,_r=g[j+o];128&_r?(224&_r)==192?j+1>=i?A+=b:(H=g[j+o+1],(192&H)!=128?A+=b:(Vt=(31&_r)<<6|63&H,Vt<128?A+=b:(A+=p(Vt),j++))):(240&_r)==224?j+2>=i?A+=b:(H=g[j+o+1],z=g[j+o+2],(49344&(H|z<<8))!=32896?A+=b:(Vt=(15&_r)<<12|(63&H)<<6|63&z,Vt<2048||Vt>=55296&&Vt<=57343?A+=b:(A+=p(Vt),j+=2))):(248&_r)==240?j+3>=i?A+=b:(H=g[j+o+1],z=g[j+o+2],$=g[j+o+3],(12632256&(H|z<<8|$<<16))!=8421504?A+=b:(Vt=(7&_r)<<18|(63&H)<<12|(63&z)<<6|63&$,Vt<65536||Vt>1114111?A+=b:(Vt-=65536,A+=p(55296+(Vt>>10),56320+(1023&Vt)),j+=3))):A+=b:A+=p(_r)}return A}function jT(l,i){let o=i.length,p=0;for(let A=0;A<o;A++){let j=i.charCodeAt(A);j>=55296&&j<=56319&&A+1<o&&(j=(j<<10)+i.charCodeAt(++A)-56613888),p+=j<128?1:j<2048?2:j<65536?3:4}E_(l,p);let g=dO(l,p),b=l.bytes;for(let A=0;A<o;A++){let j=i.charCodeAt(A);j>=55296&&j<=56319&&A+1<o&&(j=(j<<10)+i.charCodeAt(++A)-56613888),j<128?b[g++]=j:(j<2048?b[g++]=j>>6&31|192:(j<65536?b[g++]=j>>12&15|224:(b[g++]=j>>18&7|240,b[g++]=j>>12&63|128),b[g++]=j>>6&63|128),b[g++]=63&j|128)}}function Xet(l,i){let o=dO(l,i.limit),p=l.bytes,g=i.bytes;for(let b=0,A=i.limit;b<A;b++)p[b+o]=g[b]}function p8(l){return l.bytes[N2(l,1)]}function f8(l,i){let o=dO(l,1);l.bytes[o]=i}function P2(l){let i=N2(l,8),o=l.bytes;return pS[0]=o[i++],pS[1]=o[i++],pS[2]=o[i++],pS[3]=o[i++],pS[4]=o[i++],pS[5]=o[i++],pS[6]=o[i++],pS[7]=o[i++],A2[0]}function k2(l,i){let o=dO(l,8),p=l.bytes;A2[0]=i,p[o++]=pS[0],p[o++]=pS[1],p[o++]=pS[2],p[o++]=pS[3],p[o++]=pS[4],p[o++]=pS[5],p[o++]=pS[6],p[o++]=pS[7]}function VT(l){let i,o=0,p=0;do i=p8(l),o<32&&(p|=(127&i)<<o),o+=7;while(128&i);return p}function E_(l,i){for(i>>>=0;i>=128;)f8(l,127&i|128),i>>>=7;f8(l,i)}function NR(l,i){let o=i.low>>>0,p=(i.low>>>28|i.high<<4)>>>0,g=i.high>>>24,b=g===0?p===0?o<16384?o<128?1:2:o<1<<21?3:4:p<16384?p<128?5:6:p<1<<21?7:8:g<128?9:10,A=dO(l,b),j=l.bytes;switch(b){case 10:j[A+9]=g>>>7&1;case 9:j[A+8]=b!==9?128|g:127&g;case 8:j[A+7]=b!==8?p>>>21|128:p>>>21&127;case 7:j[A+6]=b!==7?p>>>14|128:p>>>14&127;case 6:j[A+5]=b!==6?p>>>7|128:p>>>7&127;case 5:j[A+4]=b!==5?128|p:127&p;case 4:j[A+3]=b!==4?o>>>21|128:o>>>21&127;case 3:j[A+2]=b!==3?o>>>14|128:o>>>14&127;case 2:j[A+1]=b!==2?o>>>7|128:o>>>7&127;case 1:j[A]=b!==1?128|o:127&o}}function m8(l,i){var o=Object.keys(l);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(l);i&&(p=p.filter(function(g){return Object.getOwnPropertyDescriptor(l,g).enumerable})),o.push.apply(o,p)}return o}const Qet=new Map([["moderation",1],["supervise",2]]);class bP extends D_{get connectionState(){return this._connectionState}set connectionState(i){if(this._connectionState===i)return;const o=this._connectionState;this._connectionState=i,this.emit(a0.CONNECTION_STATE_CHANGE,o,i)}get inspectType(){return this._inspectType}set inspectType(i){var o;this._inspectMode=ZR(o=i.map(p=>Qet.get(p)||0)).call(o,(p,g)=>p+g),this._inspectType=i}get quality(){return this._quality}set quality(i){this._quality=i>1?1:i<.1?.1:i,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this.qualityRatio},6e4))}constructor(i){super(),_e(this,"name","AgoraRTCVideoContentInspect"),_e(this,"_connectionState",OS.CONNECTING),_e(this,"_innerConnectionState",void 0),_e(this,"sequence",0),_e(this,"inspectStartTime",void 0),_e(this,"workerManagerConnection",void 0),_e(this,"workerConnection",void 0),_e(this,"workerMessageLengthLimit",void 0),_e(this,"inspectIntervalMinimum",void 0),_e(this,"qualityRatio",void 0),_e(this,"_connectInfo",void 0),_e(this,"_cancelTokenSource",aS.CancelToken.source()),_e(this,"_retryConfig",void 0),_e(this,"wmSequence",0),_e(this,"inspectInterval",void 0),_e(this,"inspectTimer",null),_e(this,"ossFilePrefix",void 0),_e(this,"extraInfo",void 0),_e(this,"_inspectType",void 0),_e(this,"_inspectMode",void 0),_e(this,"_quality",1),_e(this,"qualityTimer",null),_e(this,"_inspectId",void 0),_e(this,"_needWorkUrlOnly",!1),_e(this,"inspectImage",()=>{if(this.connectionState!==OS.CONNECTED)throw new hE(_p.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval(()=>{this.connectionState===OS.CONNECTED?this.requestToInspectImage():Gi.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)},this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()}),this._inspectId=T_(5,"inspect-"),this.workerMessageLengthLimit=nE("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=nE("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=nE("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=i.interval,this.ossFilePrefix=i.ossFilePrefix,this.extraInfo=i.extraInfo,this.inspectType=i.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new zO("worker-manager-"+this._inspectId,$_),this.on(a0.STATE_CHANGE,(o,p)=>{this._innerConnectionState=o,Gi.debug("[".concat(this._inspectId,"] Inspect operation :").concat(NS[o]," ").concat(p||""))}),this.handleWorkerManagerEvents(),this.workerConnection=new zO("worker-"+this._inspectId,$_),this.handleWorkerEvents()}async init(i,o){this.emit(a0.STATE_CHANGE,NS.CONNECT_AP),this._connectInfo=i;const p=this._cancelTokenSource.token;return this._retryConfig=o,new pE((g,b)=>{this.on(a0.CONNECTION_STATE_CHANGE,(A,j)=>{j===OS.CONNECTED&&g()}),this.requestAP(i,p,o).then(A=>{this.connectWorkerManager(A)}).catch(A=>{b(A)})})}async requestAP(i,o,p){const g=nE("WEBCS_DOMAIN").map(j=>"https://".concat(j,"/api/v1")),b=await function(j,H,z,$){let{appId:Vt,areaCode:_r,cname:Fi,sid:_l,token:_u,uid:_h}=H;aO++;const _g="image_moderation_api",eE={service_name:_g,json_body:JSON.stringify({appId:Vt,areaCode:_r,cname:Fi,command:"allocateEdge",requestId:aO,seq:aO,sid:_l,token:_u,ts:Date.now(),uid:_h+""})};let oE,SE,vE=j[0];return vT(async()=>{oE=Date.now();const fE=await eR(vE,{data:eE,cancelToken:z,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(SE=Date.now()-oE,fE.code!==0){const OE=new hE(_p.UNEXPECTED_RESPONSE,"image inspect ap error, code"+fE.code,{retry:!0,responseTime:SE});throw Gi.error(OE.toString()),OE}const mE=JSON.parse(fE.json_body);if(mE.code!==200){const OE=new hE(_p.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(mE.code,", reason: ").concat(mE.reason),{code:mE.code,responseTime:SE});throw Gi.error(OE.toString()),OE}if(!mE.servers||!Array.isArray(mE.servers)||mE.servers.length===0){const OE=new hE(_p.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:mE.code,responseTime:SE});throw Gi.error(OE.toString()),OE}const EE=nE("VIDEO_INSPECT_WORKER_MANAGER_HOST"),PE=nE("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:mE.servers.map(OE=>{let{address:$E,wss:s_}=OE;if($E&&s_)return"wss://".concat($E.replace(/\./g,"-"),".").concat(EE,":").concat(PE||s_)}).filter(OE=>!!OE),workerToken:mE.workerToken,vid:mE.vid,responseTime:SE}},(fE,mE)=>(jE.apworkerEvent(_l,{success:!0,sc:200,serviceName:_g,responseDetail:JSON.stringify(fE.addressList),firstSuccess:mE===0,responseTime:SE,serverIp:j[mE%j.length]}),!1),(fE,mE)=>(jE.apworkerEvent(_l,{success:!1,sc:fE.data&&fE.data.code||200,serviceName:_g,responseTime:SE,serverIp:j[mE%j.length]}),!!(fE.code!==_p.OPERATION_ABORTED&&fE.code!==_p.UNEXPECTED_RESPONSE||fE.data&&fE.data.retry)&&(vE=j[(mE+1)%j.length],!0)),$)}(g,i,o,p);this.emit(a0.STATE_CHANGE,NS.AP_CONNECTED);const{addressList:A}=b;return this.wmSequence++,A}async connectWorkerManager(i){let o=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this._needWorkUrlOnly=o,this.emit(a0.STATE_CHANGE,NS.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(i,1e4)}async connectWorker(i){await this.workerConnection.init([i])}handleWorkerManagerEvents(){this.workerManagerConnection.on(zE.CONNECTED,async()=>{this.emit(a0.STATE_CHANGE,NS.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.19.3",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)}),this.workerManagerConnection.on(zE.CLOSED,()=>{this._innerConnectionState<NS.GET_WORKER_MANAGER_RESPONSE&&Gi.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))}),this.workerManagerConnection.on(zE.FAILED,()=>{this._innerConnectionState<NS.GET_WORKER_MANAGER_RESPONSE&&Gi.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))}),this.workerManagerConnection.on(zE.RECONNECTING,()=>{this._innerConnectionState<NS.GET_WORKER_MANAGER_RESPONSE&&Gi.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))}),this.workerManagerConnection.on(zE.ON_MESSAGE,async i=>{this.emit(a0.STATE_CHANGE,NS.GET_WORKER_MANAGER_RESPONSE);const o=this.workerManagerConnection.url;this.workerManagerConnection.close();const p=JSON.parse(i.data);if(p.code!==200)throw Gi.error("[".concat(this._inspectId,"] Unexpected code ").concat(p.code," from worker manager")),new hE(_p.UNEXPECTED_RESPONSE,"response code of worker is unexpected",p);if(!(p.serverResponse&&p.serverResponse.portWss&&o))throw Gi.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(p))),new hE(_p.UNEXPECTED_RESPONSE,"response content of worker is unexpected",p);{const g=nE("VIDEO_INSPECT_WORKER_PORT")||p.serverResponse.portWss,b=o.replace(/:\d+\/?$/,":".concat(g));this.emit(a0.STATE_CHANGE,NS.CONNECT_WORKER,b),this._needWorkUrlOnly?this.emit(a0.REQUEST_NEW_WORKER_URL,b):await this.connectWorker(b)}}),this.workerManagerConnection.on(zE.WILL_RECONNECT,(i,o,p)=>{p(i)}),this.workerManagerConnection.on(zE.REQUEST_NEW_URLS,(i,o)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(i).catch(o)})}handleWorkerEvents(){this.workerConnection.on(zE.CONNECTED,async()=>{this.emit(a0.STATE_CHANGE,NS.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=OS.CONNECTED}),this.workerConnection.on(zE.ON_MESSAGE,async i=>{if(i.data instanceof ArrayBuffer){const p=Wet(new Uint8Array(i.data));if(nE("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&Gi.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(p)),p.code===200){if(Array.isArray(this.inspectType)&&this.inspectType.length===1&&this.inspectType[0]==="supervise")return void this.emit(a0.INSPECT_RESULT,void 0,void 0);if(p.data&&p.data.scorePorn&&p.data.scoreSexy&&p.data.scoreNeutral){var o;const g={porn:p.data.scorePorn,sexy:p.data.scoreSexy,neutral:p.data.scoreNeutral},b=ZR(o=Object.keys(g)).call(o,(j,H)=>g[j]>g[H]?j:H,"porn"),A=Object.keys(g).find(j=>j===b);this.emit(a0.INSPECT_RESULT,A)}else this.emit(a0.INSPECT_RESULT,void 0,new hE(_p.UNEXPECTED_RESPONSE,p.code+"","There is an unexpected data on message"))}else this.emit(a0.INSPECT_RESULT,void 0,new hE(_p.UNEXPECTED_RESPONSE,p.code+"",p.msg))}else Gi.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(a0.INSPECT_RESULT,void 0,new hE(_p.UNEXPECTED_RESPONSE,"invalid worker message type"))}),this.workerConnection.on(zE.CLOSED,()=>{this.connectionState=OS.CLOSED}),this.workerConnection.on(zE.FAILED,()=>{this.connectionState=OS.CLOSED}),this.workerConnection.on(zE.RECONNECTING,()=>{this.connectionState=this.connectionState===OS.CONNECTED?OS.RECONNECTING:OS.CONNECTING}),this.workerConnection.on(zE.WILL_RECONNECT,(i,o,p)=>{i==="recover"&&p(i),p("tryNext")}),this.workerConnection.on(zE.REQUEST_NEW_URLS,(i,o)=>{this.workerManagerConnection.close(),this.once(a0.REQUEST_NEW_WORKER_URL,p=>{i([p])}),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(p=>{this.connectWorkerManager(p,!0)}).catch(p=>{o(p)})})}static intToLong(i){return{low:i|=0,high:i>>31,unsigned:i>=0}}async requestToInspectImage(){this.sequence++;const i=oS(this,a0.CLIENT_LOCAL_VIDEO_TRACK),o={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(i){if(!i.isPlaying)return void this.emit(a0.INSPECT_RESULT,void 0,new hE(_p.INVALID_OPERATION,"Only the track being played can be inspected"));const p=await this.generateRequestData(i,o);this.workerConnection.sendMessage(p,!0,!0)}else this.emit(a0.INSPECT_RESULT,void 0,new hE(_p.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(i,o){let{appId:p,cname:g,cid:b,vid:A,sid:j,uid:H}=o;const z=Date.now(),$=await i.getCurrentFrameImage("image/jpeg",this.quality),Vt=await a4($,p,g),_r=this.sequence+"-"+b+"-"+H+"-"+z+"-"+T_(12,""),Fi={appId:p,cid:b,cname:g,deviceId:"",elapse:bP.intToLong(Number(z-this.inspectStartTime)),fileSize:Vt.byteLength,jpgEncryption:2,height:$.height,width:$.width,jpg:Vt,networkType:6,osType:7,requestId:_r,sdkVersion:"4.19.3",sequence:this.sequence,sid:j,timestamp:bP.intToLong(z),uid:H,vid:A,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};this.extraInfo===void 0&&delete Fi.callbackData,this.ossFilePrefix===void 0&&delete Fi.ossFilePrefix;const _l=qet(Fi);if(_l.byteLength<this.workerMessageLengthLimit){if(nE("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){const _u=function(_h){for(var _g=1;_g<arguments.length;_g++){var eE=arguments[_g]!=null?arguments[_g]:{};_g%2?m8(Object(eE),!0).forEach(function(oE){_e(_h,oE,eE[oE])}):Object.getOwnPropertyDescriptors?Object.defineProperties(_h,Object.getOwnPropertyDescriptors(eE)):m8(Object(eE)).forEach(function(oE){Object.defineProperty(_h,oE,Object.getOwnPropertyDescriptor(eE,oE))})}return _h}({},Fi);delete _u.jpg,Gi.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(_u))}return _l}{const _u=this.quality*this.qualityRatio;return this.quality=_u,await this.generateRequestData(i,{appId:p,cname:g,cid:b,vid:A,sid:j,uid:H})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=aS.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=OS.CLOSED,this.emit(a0.STATE_CHANGE,NS.CLOSED)}}function $et(l){let i=function(){const o=ent.pop();return o?(o.offset=o.limit=0,o):{bytes:new Uint8Array(64),offset:0,limit:0}}();return function(o,p){let g=o.appId;g!==void 0&&(_y(p,10),vI(p,g));let b=o.cid;b!==void 0&&(_y(p,16),_y(p,b));let A=o.cname;A!==void 0&&(_y(p,26),vI(p,A));let j=o.deviceId;j!==void 0&&(_y(p,34),vI(p,j));let H=o.elapse;H!==void 0&&(_y(p,40),PR(p,H));let z=o.fileSize;z!==void 0&&(_y(p,48),PR(p,hO(z)));let $=o.height;$!==void 0&&(_y(p,56),PR(p,hO($)));let Vt=o.jpg;Vt!==void 0&&(_y(p,66),_y(p,Vt.length),E8(p,Vt));let _r=o.networkType;_r!==void 0&&(_y(p,72),PR(p,hO(_r)));let Fi=o.osType;Fi!==void 0&&(_y(p,80),PR(p,hO(Fi)));let _l=o.requestId;_l!==void 0&&(_y(p,90),vI(p,_l));let _u=o.sdkVersion;_u!==void 0&&(_y(p,98),vI(p,_u));let _h=o.sequence;_h!==void 0&&(_y(p,104),PR(p,hO(_h)));let _g=o.sid;_g!==void 0&&(_y(p,114),vI(p,_g));let eE=o.timestamp;eE!==void 0&&(_y(p,120),PR(p,eE));let oE=o.uid;oE!==void 0&&(_y(p,128),_y(p,oE));let SE=o.vid;SE!==void 0&&(_y(p,136),_y(p,SE));let vE=o.width;vE!==void 0&&(_y(p,144),PR(p,hO(vE)));let fE=o.service;fE!==void 0&&(_y(p,152),_y(p,fE));let mE=o.callbackData;mE!==void 0&&(_y(p,162),_y(p,mE.length),E8(p,mE));let EE=o.ticket;EE!==void 0&&(_y(p,170),vI(p,EE))}(l,i),function(o){let p=o.bytes,g=o.limit;return p.length===g?p:p.subarray(0,g)}(i)}function Zet(l){return function(o){let p={};t:for(;!nnt(o);){let g=E1(o);switch(g>>>3){case 0:break t;case 1:p.code=E1(o);break;case 2:p.msg=v8(o,E1(o));break;case 3:p.requestId=v8(o,E1(o));break;case 4:p.timestamp=rnt(o,!1);break;default:tnt(o,7&g)}}return p}({bytes:i=l,offset:0,limit:i.length});var i}function tnt(l,i){switch(i){case 0:for(;128&pT(l););break;case 2:D2(l,E1(l));break;case 5:D2(l,4);break;case 1:D2(l,8);break;default:throw new Error("Unimplemented type: "+i)}}function hO(l){return{low:l|=0,high:l>>31,unsigned:l>=0}}let ent=[];function D2(l,i){if(l.offset+i>l.limit)throw new Error("Skip past limit");l.offset+=i}function nnt(l){return l.offset>=l.limit}function SP(l,i){let o=l.bytes,p=l.offset,g=l.limit,b=p+i;if(b>o.length){let A=new Uint8Array(2*b);A.set(o),l.bytes=A}return l.offset=b,b>g&&(l.limit=b),p}function g8(l,i){let o=l.offset;if(o+i>l.limit)throw new Error("Read past limit");return l.offset+=i,o}function E8(l,i){let o=SP(l,i.length);l.bytes.set(i,o)}function v8(l,i){let o=g8(l,i),p=String.fromCharCode,g=l.bytes,b="ï¿½",A="";for(let j=0;j<i;j++){let H,z,$,Vt,_r=g[j+o];128&_r?(224&_r)==192?j+1>=i?A+=b:(H=g[j+o+1],(192&H)!=128?A+=b:(Vt=(31&_r)<<6|63&H,Vt<128?A+=b:(A+=p(Vt),j++))):(240&_r)==224?j+2>=i?A+=b:(H=g[j+o+1],z=g[j+o+2],(49344&(H|z<<8))!=32896?A+=b:(Vt=(15&_r)<<12|(63&H)<<6|63&z,Vt<2048||Vt>=55296&&Vt<=57343?A+=b:(A+=p(Vt),j+=2))):(248&_r)==240?j+3>=i?A+=b:(H=g[j+o+1],z=g[j+o+2],$=g[j+o+3],(12632256&(H|z<<8|$<<16))!=8421504?A+=b:(Vt=(7&_r)<<18|(63&H)<<12|(63&z)<<6|63&$,Vt<65536||Vt>1114111?A+=b:(Vt-=65536,A+=p(55296+(Vt>>10),56320+(1023&Vt)),j+=3))):A+=b:A+=p(_r)}return A}function vI(l,i){let o=i.length,p=0;for(let A=0;A<o;A++){let j=i.charCodeAt(A);j>=55296&&j<=56319&&A+1<o&&(j=(j<<10)+i.charCodeAt(++A)-56613888),p+=j<128?1:j<2048?2:j<65536?3:4}_y(l,p);let g=SP(l,p),b=l.bytes;for(let A=0;A<o;A++){let j=i.charCodeAt(A);j>=55296&&j<=56319&&A+1<o&&(j=(j<<10)+i.charCodeAt(++A)-56613888),j<128?b[g++]=j:(j<2048?b[g++]=j>>6&31|192:(j<65536?b[g++]=j>>12&15|224:(b[g++]=j>>18&7|240,b[g++]=j>>12&63|128),b[g++]=j>>6&63|128),b[g++]=63&j|128)}}function pT(l){return l.bytes[g8(l,1)]}function _8(l,i){let o=SP(l,1);l.bytes[o]=i}function E1(l){let i,o=0,p=0;do i=pT(l),o<32&&(p|=(127&i)<<o),o+=7;while(128&i);return p}function _y(l,i){for(i>>>=0;i>=128;)_8(l,127&i|128),i>>>=7;_8(l,i)}function rnt(l,i){let o,p=0,g=0,b=0;return o=pT(l),p=127&o,128&o&&(o=pT(l),p|=(127&o)<<7,128&o&&(o=pT(l),p|=(127&o)<<14,128&o&&(o=pT(l),p|=(127&o)<<21,128&o&&(o=pT(l),g=127&o,128&o&&(o=pT(l),g|=(127&o)<<7,128&o&&(o=pT(l),g|=(127&o)<<14,128&o&&(o=pT(l),g|=(127&o)<<21,128&o&&(o=pT(l),b=127&o,128&o&&(o=pT(l),b|=(127&o)<<7))))))))),{low:p|g<<28,high:g>>>4|b<<24,unsigned:i}}function PR(l,i){let o=i.low>>>0,p=(i.low>>>28|i.high<<4)>>>0,g=i.high>>>24,b=g===0?p===0?o<16384?o<128?1:2:o<1<<21?3:4:p<16384?p<128?5:6:p<1<<21?7:8:g<128?9:10,A=SP(l,b),j=l.bytes;switch(b){case 10:j[A+9]=g>>>7&1;case 9:j[A+8]=b!==9?128|g:127&g;case 8:j[A+7]=b!==8?p>>>21|128:p>>>21&127;case 7:j[A+6]=b!==7?p>>>14|128:p>>>14&127;case 6:j[A+5]=b!==6?p>>>7|128:p>>>7&127;case 5:j[A+4]=b!==5?128|p:127&p;case 4:j[A+3]=b!==4?o>>>21|128:o>>>21&127;case 3:j[A+2]=b!==3?o>>>14|128:o>>>14&127;case 2:j[A+1]=b!==2?o>>>7|128:o>>>7&127;case 1:j[A]=b!==1?128|o:127&o}}const y8={},b8={},TP=4294967296,S8=TP*TP,T8=S8/2,L2=R8(0,!0),C8=R8(0),int=pO(0,-2147483648,!1),snt=pO(-1,2147483647,!1),ont=pO(-1,-1,!0);function R8(l,i){let o,p,g;return i?(g=0<=(l>>>=0)&&l<256)&&(p=b8[l],p)?p:(o=pO(l,0,!0),g&&(b8[l]=o),o):(g=-128<=(l|=0)&&l<128)&&(p=y8[l],p)?p:(o=pO(l,l<0?-1:0,!1),g&&(y8[l]=o),o)}function pO(l,i,o){return{low:0|l,high:0|i,unsigned:!!o}}function ant(l,i){if(isNaN(l))return i?L2:C8;if(i){if(l<0)return L2;if(l>=S8)return ont}else{if(l<=-T8)return int;if(l+1>=T8)return snt}return l<0?i?L2:C8:pO(l%TP|0,l/TP|0,i)}function I8(l,i){var o=Object.keys(l);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(l);i&&(p=p.filter(function(g){return Object.getOwnPropertyDescriptor(l,g).enumerable})),o.push.apply(o,p)}return o}class x2 extends D_{get connectionState(){return this._connectionState}set connectionState(i){if(this._connectionState===i)return;const o=this._connectionState;this._connectionState=i,this.emit(HS.CONNECTION_STATE_CHANGE,i,o)}get quality(){return this._quality}set quality(i){this._quality=i>1?1:i<.1?.1:i,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this._qualityRatio},6e4))}constructor(i){var o;super(),_e(this,"name","AgoraRTCImageModeration"),_e(this,"_connectionState",ES.CONNECTING),_e(this,"_sequence",0),_e(this,"_moderationStartTime",void 0),_e(this,"_workerConnection",void 0),_e(this,"_workerMessageLengthLimit",void 0),_e(this,"_qualityRatio",void 0),_e(this,"_connectInfo",void 0),_e(this,"_cancelTokenSource",aS.CancelToken.source()),_e(this,"_retryConfig",void 0),_e(this,"_moderationInterval",void 0),_e(this,"_moderationTimer",null),_e(this,"_moderationMode",1),_e(this,"_quality",1),_e(this,"_qualityTimer",null),_e(this,"_ticket",void 0),_e(this,"_moderationIntervalMinimum",void 0),_e(this,"_uploadFailedNum",0),_e(this,"_uploadNum",0),_e(this,"_uploadTimer",null),_e(this,"_moderationId",void 0),_e(this,"inspectImage",()=>{if(this.connectionState!==ES.CONNECTED)throw new hE(_p.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval(()=>{this.connectionState===ES.CONNECTED?this.requestToInspectImage():Gi.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)},this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()}),this._moderationId=T_(5,"image-moderation-"),this._workerMessageLengthLimit=nE("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=nE("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=(o=i.interval)!==null&&o!==void 0?o:1e3,this._qualityRatio=nE("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new zO("worker-"+this._moderationId,$_),this.on(HS.STATE_CHANGE,(p,g)=>{Gi.debug("[".concat(this._moderationId,"] Moderation operation :").concat(gR[p]," ").concat(g||""))}),this.handleWorkerEvents()}async init(i,o){this.emit(HS.STATE_CHANGE,gR.CONNECT_AP),this._connectInfo=i;const p=this._cancelTokenSource.token;return this._retryConfig=o,new pE((g,b)=>{this.on(HS.CONNECTION_STATE_CHANGE,(A,j)=>{A===ES.CONNECTED&&g()}),this.requestAP(i,p,o).then(A=>{this.connectWorker(A)}).catch(A=>{b(A)})})}updateConfig(i){var o;this._moderationInterval=(o=i.interval)!==null&&o!==void 0?o:1e3,Gi.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(i))),this.connectionState===ES.CONNECTED&&this.inspectImage()}async requestAP(i,o,p){const g=nE("WEBCS_DOMAIN").map(H=>"https://".concat(H,"/api/v1")),b=await function(H,z,$,Vt){let{appId:_r,areaCode:Fi,cname:_l,sid:_u,token:_h,uid:_g}=z;aO++;const eE="moderation_plugin",oE={service_name:eE,json_body:JSON.stringify({appId:_r,areaCode:Fi,cname:_l,command:"allocateEdge",requestId:aO,seq:aO,sid:_u,appToken:_h,ts:Date.now(),uid:_g+""})};let SE,vE,fE=H[0];return vT(async()=>{SE=Date.now();const mE=await eR(fE,{data:oE,cancelToken:$,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(vE=Date.now()-SE,mE.code!==0){const OE=new hE(_p.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+mE.code,{retry:!0,responseTime:vE});throw Gi.error(OE.toString()),OE}const EE=JSON.parse(mE.json_body);if(EE.code!==200){const OE=new hE(_p.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(EE.code,", reason: ").concat(EE.reason),{code:EE.code,responseTime:vE});throw Gi.error(OE.toString()),OE}if(!EE.servers||!Array.isArray(EE.servers)||EE.servers.length===0){const OE=new hE(_p.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:EE.code,responseTime:vE});throw Gi.error(OE.toString()),OE}if(!EE.servers.some(OE=>!!OE.wss)){const OE=new hE(_p.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:EE.code,responseTime:vE});throw Gi.error(OE.toString()),OE}const PE=nE("IMAGE_MODERATION_WORKER_HOST");return{addressList:EE.servers.map(OE=>{let{address:$E,wss:s_}=OE;if($E&&s_)return"wss://".concat($E.replace(/\./g,"-"),".").concat(PE,":").concat(s_,"/moderation")}).filter(OE=>!!OE),workerToken:EE.workerToken,vid:EE.vid,ticket:EE.appTicket,responseTime:vE}},(mE,EE)=>(jE.apworkerEvent(_u,{success:!0,sc:200,serviceName:eE,responseDetail:JSON.stringify(mE.addressList),firstSuccess:EE===0,responseTime:vE,serverIp:H[EE%H.length]}),!1),(mE,EE)=>(jE.apworkerEvent(_u,{success:!1,sc:mE.data&&mE.data.code||200,serviceName:eE,responseTime:vE,serverIp:H[EE%H.length]}),!!(mE.code!==_p.OPERATION_ABORTED&&mE.code!==_p.UNEXPECTED_RESPONSE||mE.data&&mE.data.retry)&&(fE=H[(EE+1)%H.length],!0)),Vt)}(g,i,o,p);this.emit(HS.STATE_CHANGE,gR.AP_CONNECTED);const{addressList:A,ticket:j}=b;return this._ticket=j,A}async connectWorker(i){this.emit(HS.STATE_CHANGE,gR.CONNECT_WORKER),await this._workerConnection.init(i,1e4)}handleWorkerEvents(){this._workerConnection.on(zE.CONNECTED,async()=>{this.emit(HS.STATE_CHANGE,gR.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=ES.CONNECTED}),this._workerConnection.on(zE.CLOSED,()=>{this.connectionState=ES.CLOSED}),this._workerConnection.on(zE.FAILED,()=>{this.connectionState=ES.CLOSED}),this._workerConnection.on(zE.RECONNECTING,()=>{this.connectionState=this.connectionState===ES.CONNECTED?ES.RECONNECTING:ES.CONNECTING}),this._workerConnection.on(zE.ON_MESSAGE,async i=>{if(i.data instanceof ArrayBuffer){const o=Zet(new Uint8Array(i.data));nE("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&Gi.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(o)),this._uploadNum++,o.code===void 0||o.code===0||(this._uploadFailedNum++,Gi.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(o.code,", msg is ").concat(o.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout(()=>{jE.reportApiInvoke(this._connectInfo.sid||null,{name:e0.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,o.code],tag:x_.TRACER}).onError(new hE(_p.IMAGE_MODERATION_UPLOAD_FAILED,o.msg)),this._uploadTimer=null},nE("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else Gi.error("[".concat(this._moderationId,"] Unexpected message type from worker"))}),this._workerConnection.on(zE.WILL_RECONNECT,(i,o,p)=>{i==="recover"&&p(i),p("tryNext")}),this._workerConnection.on(zE.REQUEST_NEW_URLS,(i,o)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(i).catch(o)})}static intToLong(i){return{low:i|=0,high:i>>31,unsigned:i>=0}}async requestToInspectImage(){const i=oS(this,HS.CLIENT_LOCAL_VIDEO_TRACK),o={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(i){if(!i.isPlaying)return void(nE("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&Gi.debug("Only the track being played can be inspected"));this._sequence++;const p=await this.generateRequestData(i,o);this._workerConnection.sendMessage(p,!0,!0)}else nE("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&Gi.debug("Only the track being published can be inspected")}async generateRequestData(i,o){let{appId:p,cname:g,cid:b,vid:A,sid:j,uid:H}=o;const z=Date.now(),$=await i.getCurrentFrameImage("image/jpeg",this.quality),Vt=await a4($,p,g),_r=this._sequence+"-"+b+"-"+H+"-"+z+"-"+T_(12,""),Fi={appId:p,cid:b,cname:g,deviceId:"",elapse:x2.intToLong(Number(z-this._moderationStartTime)),fileSize:$.buffer.byteLength,height:$.height,width:$.width,jpg:Vt,networkType:6,osType:7,requestId:_r,sdkVersion:"4.19.3",sequence:this._sequence,sid:j,timestamp:ant(z),uid:H,vid:A,service:this._moderationMode,ticket:this._ticket},_l=$et(Fi);if(_l.byteLength<this._workerMessageLengthLimit){if(nE("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){const _u=function(_h){for(var _g=1;_g<arguments.length;_g++){var eE=arguments[_g]!=null?arguments[_g]:{};_g%2?I8(Object(eE),!0).forEach(function(oE){_e(_h,oE,eE[oE])}):Object.getOwnPropertyDescriptors?Object.defineProperties(_h,Object.getOwnPropertyDescriptors(eE)):I8(Object(eE)).forEach(function(oE){Object.defineProperty(_h,oE,Object.getOwnPropertyDescriptor(eE,oE))})}return _h}({},Fi);delete _u.jpg,Gi.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(_u))}return _l}{const _u=this.quality*this._qualityRatio;return this.quality=_u,await this.generateRequestData(i,{appId:p,cname:g,cid:b,vid:A,sid:j,uid:H})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=aS.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=ES.CLOSED,this.emit(HS.STATE_CHANGE,gR.CLOSED)}}function w8(l,i){var o=Object.keys(l);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(l);i&&(p=p.filter(function(g){return Object.getOwnPropertyDescriptor(l,g).enumerable})),o.push.apply(o,p)}return o}function CP(l){for(var i=1;i<arguments.length;i++){var o=arguments[i]!=null?arguments[i]:{};i%2?w8(Object(o),!0).forEach(function(p){_e(l,p,o[p])}):Object.getOwnPropertyDescriptors?Object.defineProperties(l,Object.getOwnPropertyDescriptors(o)):w8(Object(o)).forEach(function(p){Object.defineProperty(l,p,Object.getOwnPropertyDescriptor(o,p))})}return l}class Lb extends b6{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var i,o;return(i=(o=this.peerConnection.getReceivers()[0])===null||o===void 0||(o=o.transport)===null||o===void 0?void 0:o.state)!==null&&i!==void 0?i:null}constructor(i,o,p){super(i,o),_e(this,"direction",void 0),_e(this,"store",void 0),_e(this,"peerConnection",void 0),_e(this,"transportEventReceiver",void 0),_e(this,"statsFilter",void 0),_e(this,"localCandidateCount",0),_e(this,"allCandidatesReceived",!1),_e(this,"mutex",new E0("P2PConnection-mutex")),_e(this,"dataChannel",void 0),_e(this,"onLocalCandidate",void 0),this.store=o,this.peerConnection=new RTCPeerConnection(Lb.resolvePCConfiguration(i),{optional:[{googDscp:!0}]}),this.direction=p??YI.SEND_ONLY,this.dataChannel=this.peerConnection.createDataChannel("agora-p2p-signal",{ordered:!0}),this.statsFilter=gP(this.peerConnection,nE("STATS_UPDATE_INTERVAL"),void 0,N_()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}async establish(i){try{if(i){await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});const o=await this.peerConnection.createAnswer();if(await this.peerConnection.setLocalDescription(o),!o.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");return o.sdp}{const o=await this.peerConnection.createOffer();if(!o.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");return await this.peerConnection.setLocalDescription(o),o.sdp}}catch(o){throw new yE(_p.GET_LOCAL_CONNECTION_PARAMS_FAILED,o.toString())}}async connect(i){try{await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(o){throw new yE(_p.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(o.toString()))}}async addRemoteCandidate(i){try{await this.peerConnection.addIceCandidate(i)}catch(o){throw new yE(_p.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(o.toString()))}}async send(i){try{const o=[];i.forEach(b=>{const A=this.peerConnection.addTransceiver(b._mediaStreamTrack,{direction:"sendonly"});o.push(A)}),N_()&&nE("SIMULCAST")===!0&&await this.applySimulcastForFirefox(o,i),await this.applySimulcastEncodings(o,i),await this.applySendEncodings(o,i);const p=await this.peerConnection.createOffer();if(await this.peerConnection.setLocalDescription(p),!p.sdp)throw new Error("Cannot get offer.sdp when trying to send PeerConnection.");const g=o.map(b=>{const A=this.getLocalSSRC(b.mid,p.sdp);if(!A)throw new Error("Cannot get ssrc when trying to send PeerConnection.");return{mid:b.mid,localSSRC:[{ssrcId:A}]}});return{sdp:p.sdp,trackMessage:g}}catch(o){throw o instanceof yE?o:new yE(_p.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(o.toString()))}}async stopSending(i,o){const p=o?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{const g=this.peerConnection.getTransceivers().filter(A=>i.indexOf(A.mid)!==-1);if(g.length!==i.length)throw new Error("Transceivers' length (".concat(g.length,") doesn't match mids' length (").concat(i.length,") when trying to call P2PConnection.stopSending."));g.map(A=>{var j;A.direction="inactive",(j=A.stop)===null||j===void 0||j.call(A),this.peerConnection.removeTrack(A.sender)});const b=await this.peerConnection.createOffer();if(await this.peerConnection.setLocalDescription(b),!b.sdp)throw new Error("Cannot get offer.sdp when trying to send PeerConnection.");return b.sdp}catch(g){throw new yE(_p.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(g.toString()))}finally{p&&p()}}async receive(i,o,p){try{await this.peerConnection.setRemoteDescription({type:"offer",sdp:o});const g=await this.peerConnection.createAnswer();if(!g.sdp)throw new Error("Cannot get answer sdp when trying to receive track.");await this.peerConnection.setLocalDescription(g),Gi.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(i," by exchanging SDP."));const b=this.getRemoteMid(p,o);if(b===void 0)throw new Error("Cannot get transceiver mid when trying to receive track.");const A=this.peerConnection.getTransceivers().find(j=>j.mid===b);if(!A||A.mid===null)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:A.receiver.track,mid:A.mid,sdp:g.sdp}}catch(g){throw new yE(_p.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(g.toString()))}}async setDescription(i,o){try{if(i==="remote"){await this.peerConnection.setRemoteDescription({type:"offer",sdp:o});const p=await this.peerConnection.createAnswer();if(!p.sdp)throw new Error("Cannot get answer sdp when trying to receive track.");return await this.peerConnection.setLocalDescription(p),Gi.debug("[".concat(this.store.clientId,"] [P2PConnection] exchanging SDP, type is ").concat(i)),p.sdp}await this.peerConnection.setRemoteDescription({type:"answer",sdp:o})}catch(p){throw new yE(_p.EXCHANGE_SDP_FAILED,"P2PConnection.setDescription failed; ".concat(p.toString()))}}async stopReceiving(i,o){try{const p=this.peerConnection.getTransceivers().filter(b=>i.indexOf(b.mid)!==-1);if(p.length!==i.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");p.map(b=>{var A;b.direction="inactive",(A=b.stop)===null||A===void 0||A.call(b)}),await this.peerConnection.setRemoteDescription({type:"offer",sdp:o});const g=await this.peerConnection.createAnswer();if(await this.peerConnection.setLocalDescription(g),!g.sdp)throw new Error("Cannot get answer sdp when trying to receive track.");return g.sdp}catch(p){throw new yE(_p.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(p.toString()))}}async restartICE(){try{const i=await this.peerConnection.createOffer({iceRestart:!0});if(!i.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");return this.store.descriptionStart(),await this.peerConnection.setLocalDescription(i),i.sdp}catch(i){throw new yE(_p.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(i.toString()))}}close(){var i;this.peerConnection.close(),(i=this.onConnectionStateChange)===null||i===void 0||i.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transportEventReceiver=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(i){return this.statsFilter.getVideoIsReady(i)}async updateEncoderConfig(i,o){}async updateSendParameters(i,o){const p=this.peerConnection.getTransceivers().filter(g=>g.mid===i);p.length===1&&(this.isVP8Simulcast(o)?N_()||await this.applySimulcastEncodings(p,[o]):await this.applySendEncodings(p,[o]))}setStatsRemoteVideoIsReady(i,o){this.statsFilter.setVideoIsReady2(i,o)}async replaceTrack(i,o){const p=this.peerConnection.getTransceivers().find(g=>g.mid===o);p&&await p.sender.replaceTrack(i._mediaStreamTrack)}async getSelectedCandidatePair(){const i=this.peerConnection.getReceivers();if(i.length>0&&i[0].transport&&i[0].transport.iceTransport&&i[0].transport.iceTransport.getSelectedCandidatePair&&i[0].transport.iceTransport.getSelectedCandidatePair()){const o=i[0].transport.iceTransport,{local:p,remote:g}=o.getSelectedCandidatePair();return{local:CP(CP({},FT),{},{candidateType:p.type,protocol:p.protocol,address:p.address,port:p.port}),remote:CP(CP({},FT),{},{candidateType:g.type,protocol:g.protocol,address:g.address,port:g.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var i;(i=this.onICEConnectionStateChange)===null||i===void 0||i.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var i;(i=this.onConnectionStateChange)===null||i===void 0||i.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=i=>{var o;i.candidate&&((o=this.onLocalCandidate)===null||o===void 0||o.call(this,i.candidate)),i.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,Gi.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,Gi.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},nE("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(i){const o={iceServers:[]};return i.iceServers?o.iceServers=i.iceServers:i.turnServer&&i.turnServer.mode!=="off"&&(VI(i.turnServer.servers)?o.iceServers=i.turnServer.servers:(o.iceServers&&o.iceServers.push(...Lb.turnServerConfigToIceServers(i.turnServer.servers)),nE("USE_TURN_SERVER_OF_GATEWAY")&&o.iceServers&&i.turnServer.serversFromGateway&&o.iceServers.push(...Lb.turnServerConfigToIceServers(i.turnServer.serversFromGateway)),nE("FORCE_TURN_TCP")?o.iceTransportPolicy="relay":i.turnServer.servers.concat(i.turnServer.serversFromGateway||[]).forEach(p=>{p.forceturn&&(o.iceTransportPolicy="relay")}))),nE("ENABLE_ENCODED_TRANSFORM")&&I_().supportWebRTCEncodedTransform&&(o.encodedInsertableStreams=!0),o}static turnServerConfigToIceServers(i){const o=[];return i.forEach(p=>{p.tcpport&&(o.push({username:p.username,credential:p.password,credentialType:"password",urls:"turns:".concat(d1(p.turnServerURL),":").concat(p.tcpport,"?transport=tcp")}),o.push({username:p.username,credential:p.password,credentialType:"password",urls:"turn:".concat(p.turnServerURL,":").concat(p.tcpport,"?transport=udp")}),o.push({username:p.username,credential:p.password,credentialType:"password",urls:"stun:".concat(p.turnServerURL,":").concat(p.tcpport)}))}),o}tryBindTransportEvents(i){const o=i.transport;if(o){this.transportEventReceiver=i,o.onstatechange=()=>{var g;o!=null&&o.state&&((g=this.onDTLSTransportStateChange)===null||g===void 0||g.call(this,o.state))},o.onerror=g=>{var b;(b=this.onDTLSTransportError)===null||b===void 0||b.call(this,"error"in g?g.error:g)};const p=o.iceTransport;p&&(p.onstatechange=()=>{const g=o==null?void 0:o.iceTransport.state;var b;g&&((b=this.onICETransportStateChange)===null||b===void 0||b.call(this,g))},p.getSelectedCandidatePair&&(p.onselectedcandidatepairchange=()=>{if(p.getSelectedCandidatePair()){const{local:g,remote:b}=p.getSelectedCandidatePair();Gi.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:g.type,protocol:g.protocol}),", remote ").concat(JSON.stringify({candidateType:b.type,protocol:b.protocol,address:b.address,port:b.port})," )"))}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(i,o){var p;if(o||(o=this.peerConnection.getSenders().find($=>$.track===i._mediaStreamTrack)),!o)return Gi.warn("[".concat(i.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(i))return Gi.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!I_().supportSetRtpSenderParameters)return Gi.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const g={},b={};switch(i._optimizationMode){case"motion":g.degradationPreference="maintain-framerate";break;case"detail":g.degradationPreference="maintain-resolution";break;default:g.degradationPreference="balanced"}if(i._encoderConfig){var A;const{bitrateMax:$,frameRate:Vt,scaleResolutionDownBy:_r}=i._encoderConfig;$&&(b.maxBitrate=1e3*$),VE(A=i._hints).call(A,A_.LOW_STREAM)&&(Vt&&(b.maxFramerate=US(Vt)),_r&&_r>=1&&(b.scaleResolutionDownBy=_r))}if(nE("DSCP_TYPE")&&lR()){var j;const $=nE("DSCP_TYPE");VE(j=["very-low","low","medium","high"]).call(j,$)&&(b.networkPriority=$)}const H=o.getParameters(),z=(p=H.encodings)===null||p===void 0?void 0:p[0];N_()&&!z&&(g.encodings=[b]),z&&Object.assign(z,b),Object.assign(H,g),Gi.debug("[".concat(i.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(H.encodings))),await o.setParameters(H)}async applySendEncodings(i,o){try{if(!I_().supportSetRtpSenderParameters||i.length!==o.length)return;for(let p=0;p<i.length;p++){const g=i[p],b=o[p];b instanceof ZE&&!this.isVP8Simulcast(b)&&await this.updateRtpSenderEncodings(b,g.sender)}}catch{Gi.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(i,o,p){const g=q_.parse(i);return o.forEach((b,A)=>{const j=p[A],H=g.mediaDescriptions.find(z=>z.attributes.mid===j);H&&(gI(H,b),S2(H,b,this.store.codec))}),q_.print(g)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=i=>{var o;(o=this.onFirstAudioReceived)===null||o===void 0||o.call(this,i)},this.statsFilter.onFirstVideoReceived=i=>{var o;(o=this.onFirstVideoReceived)===null||o===void 0||o.call(this,i)},this.statsFilter.onFirstAudioDecoded=i=>{var o;(o=this.onFirstAudioDecoded)===null||o===void 0||o.call(this,i)},this.statsFilter.onFirstVideoDecoded=(i,o,p)=>{var g;(g=this.onFirstVideoDecoded)===null||g===void 0||g.call(this,i,o,p)},this.statsFilter.onSelectedLocalCandidateChanged=(i,o)=>{var p;(p=this.onSelectedLocalCandidateChanged)===null||p===void 0||p.call(this,i,o)},this.statsFilter.onSelectedRemoteCandidateChanged=(i,o)=>{var p;(p=this.onSelectedRemoteCandidateChanged)===null||p===void 0||p.call(this,i,o)},this.statsFilter.onFirstVideoDecodedTimeout=i=>{var o;(o=this.onFirstVideoDecodedTimeout)===null||o===void 0||o.call(this,i)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(i,o){if(i.length===o.length)for(let H=0;H<i.length;H++){var p,g,b,A,j;const z=i[H],$=o[H];if($ instanceof ZE&&!VE(p=$._hints).call(p,A_.LOW_STREAM)&&(g=$._encoderConfig)!==null&&g!==void 0&&g.bitrateMax&&((b=$._encoderConfig)===null||b===void 0?void 0:b.bitrateMax)>200&&(A=$._scalabilityMode)!==null&&A!==void 0&&A.numSpatialLayers&&((j=$._scalabilityMode)===null||j===void 0?void 0:j.numSpatialLayers)>1&&this.store.codec==="vp8"){const Vt={},_r={high:1e3*($._encoderConfig.bitrateMax-50),medium:5e4};Vt.encodings=[{rid:"m",active:!0,maxBitrate:_r.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:_r.high}];const Fi=z.sender.getParameters();await z.sender.setParameters(Object.assign(Fi,Vt))}}}async applySimulcastEncodings(i,o){if(!N_()&&i.length===o.length)for(let p=0;p<i.length;p++){const g=o[p];if(g instanceof ZE&&this.isVP8Simulcast(g)){const b=i[p],A={},j={high:1e3*(g._encoderConfig.bitrateMax-50),medium:5e4};A.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:j.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:j.medium,scaleResolutionDownBy:4}];const H=b.sender.getParameters();await b.sender.setParameters(Object.assign(H,A))}}}isVP8Simulcast(i){var o,p,g,b,A;return!!(i instanceof ZE&&nE("SIMULCAST")&&this.store.codec==="vp8"&&!VE(o=i._hints).call(o,A_.LOW_STREAM)&&(p=i._encoderConfig)!==null&&p!==void 0&&p.bitrateMax&&((g=i._encoderConfig)===null||g===void 0?void 0:g.bitrateMax)>200&&(b=i._scalabilityMode)!==null&&b!==void 0&&b.numSpatialLayers&&((A=i._scalabilityMode)===null||A===void 0?void 0:A.numSpatialLayers)>1)}logSDPExchange(i,o,p,g){if(nE("SDP_LOGGING"))return Gi.upload("[".concat(this.store.clientId,"] exchanging ").concat(p," ").concat(o," SDP during P2PConnection.").concat(g,`
`),i),o==="offer"?b=>{this.logSDPExchange(b,"answer",p==="local"?"remote":"local",g)}:void 0}getLocalSSRC(i,o){var p,g;if(o=(p=o)!==null&&p!==void 0?p:(g=this.currentLocalDescription)===null||g===void 0?void 0:g.sdp){var b;const A=(b=q_.parse(o).mediaDescriptions.find(j=>j.attributes.mid===i))===null||b===void 0?void 0:b.attributes.ssrcs;return A==null?void 0:A[0].ssrcId}}getRemoteMid(i,o){var p,g;if(o=(p=o)!==null&&p!==void 0?p:(g=this.currentRemoteDescription)===null||g===void 0?void 0:g.sdp){var b;return(b=q_.parse(o).mediaDescriptions.find(A=>A.attributes.ssrcs.some(j=>j.ssrcId===i)))===null||b===void 0?void 0:b.attributes.mid}}async getRemoteSSRC(i,o){var p,g;if(o=(p=o)!==null&&p!==void 0?p:(g=this.currentRemoteDescription)===null||g===void 0?void 0:g.sdp){var b;const A=(b=q_.parse(o).mediaDescriptions.find(j=>j.attributes.mid===i))===null||b===void 0?void 0:b.attributes.ssrcs;return A==null?void 0:A[0].ssrcId}}}function fT(l,i,o){const p=l[i];if(typeof p!="function")throw new Error("Cannot use mutex on object property.");return o.value=async function(){const g=this.mutex,b=await g.lock("From P2PConnection.".concat(i));try{for(var A=arguments.length,j=new Array(A),H=0;H<A;H++)j[H]=arguments[H];return await p.apply(this,j)}finally{b()}},o}var $S;function A8(l,i){var o=Object.keys(l);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(l);i&&(p=p.filter(function(g){return Object.getOwnPropertyDescriptor(l,g).enumerable})),o.push.apply(o,p)}return o}function kR(l){for(var i=1;i<arguments.length;i++){var o=arguments[i]!=null?arguments[i]:{};i%2?A8(Object(o),!0).forEach(function(p){_e(l,p,o[p])}):Object.getOwnPropertyDescriptors?Object.defineProperties(l,Object.getOwnPropertyDescriptors(o)):A8(Object(o)).forEach(function(p){Object.defineProperty(l,p,Object.getOwnPropertyDescriptor(o,p))})}return l}bE([fT,kc("design:type",Function),kc("design:paramtypes",[String]),kc("design:returntype",pE)],Lb.prototype,"establish",null),bE([fT,kc("design:type",Function),kc("design:paramtypes",[String]),kc("design:returntype",pE)],Lb.prototype,"connect",null),bE([fT,kc("design:type",Function),kc("design:paramtypes",[RTCIceCandidate]),kc("design:returntype",pE)],Lb.prototype,"addRemoteCandidate",null),bE([fT,kc("design:type",Function),kc("design:paramtypes",[Array]),kc("design:returntype",pE)],Lb.prototype,"send",null),bE([fT,kc("design:type",Function),kc("design:paramtypes",[String,String,Number]),kc("design:returntype",pE)],Lb.prototype,"receive",null),bE([fT,kc("design:type",Function),kc("design:paramtypes",[String,String]),kc("design:returntype",pE)],Lb.prototype,"setDescription",null),bE([fT,kc("design:type",Function),kc("design:paramtypes",[Array,String]),kc("design:returntype",pE)],Lb.prototype,"stopReceiving",null),bE([fT,kc("design:type",Function),kc("design:paramtypes",[]),kc("design:returntype",pE)],Lb.prototype,"restartICE",null),bE([fT,kc("design:type",Function),kc("design:paramtypes",[]),kc("design:returntype",void 0)],Lb.prototype,"close",null),bE([fT,kc("design:type",Function),kc("design:paramtypes",[String,P0]),kc("design:returntype",pE)],Lb.prototype,"updateEncoderConfig",null),bE([fT,kc("design:type",Function),kc("design:paramtypes",[String,P0]),kc("design:returntype",pE)],Lb.prototype,"updateSendParameters",null),bE([fT,kc("design:type",Function),kc("design:paramtypes",[P0,String]),kc("design:returntype",pE)],Lb.prototype,"replaceTrack",null),function(l){l.SEND_ONLY="SEND_ONLY",l.RECEIVE_ONLY="RECEIVE_ONLY"}($S||($S={}));class V_ extends D_{get state(){return this._state}set state(i){const o=this._state;this._state=i,this.emit(WE.StateChange,o,this._state)}constructor(i,o){super(),_e(this,"store",void 0),_e(this,"statsUploader",void 0),_e(this,"sendConnection",void 0),_e(this,"recvConnection",void 0),_e(this,"localTrackMap",new Map),_e(this,"remoteUserMap",new Map),_e(this,"localDataChannels",[]),_e(this,"pendingLocalTracks",[]),_e(this,"pendingRemoteTracks",[]),_e(this,"statsCollector",void 0),_e(this,"dtlsFailedCount",0),_e(this,"sendMutex",new E0("P2PChannel2-send-mutex")),_e(this,"recvMutex",new E0("P2PChannel2-recv-mutex")),_e(this,"_state",u_.Disconnected),_e(this,"_restartStates",["disconnected","failed"]),_e(this,"_restartTimer",void 0),_e(this,"handleMuteLocalTrack",async(p,g,b)=>{const A=await this.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!this.sendConnection||this.state!==u_.Connected)return void b(new yE(_p.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));const z=this.filterTobeMutedTracks(p);if(z.length===0)return void g();const $=z.find(_g=>_g[0]==="videoLowTrack");$&&$[1].track._originMediaStreamTrack.stop();let Vt=!1;var j,H;p.trackMediaType==="video"?Vt=!((j=this.localTrackMap.get(TE.LocalAudioTrack))===null||j===void 0||!j.track._muted):Vt=((H=this.localTrackMap.get(TE.LocalVideoTrack))===null||H===void 0?void 0:H.id)===void 0;const _r=z.filter(_g=>{let[eE,oE]=_g;return(eE!==TE.LocalAudioTrack||Vt)&&oE.id!==void 0}).map(_g=>{let[,eE]=_g;return eE});let Fi;_r.length>0&&(Fi=await this.sendConnection.stopSending(_r.map(_g=>_g.id)),_r.forEach(_g=>{_g.id=void 0,_g.ssrcs=void 0}));const _l=this.createMuteMessage(z),_u=p.trackMediaType==="video"?PT.MUTE_LOCAL_VIDEO:PT.MUTE_LOCAL_AUDIO,_h=await U_(this,WE.RequestP2PMuteLocal,{action:_u,sdp:Fi,message:_l,isMuteAll:Vt});_h&&await this.sendConnection.setDescription("local",_h),(Fi||p.trackMediaType==="audio")&&await S_(this,WE.RequestMuteLocal,_l),g()}catch(z){b(z)}finally{A()}}),_e(this,"handleUnmuteLocalTrack",async(p,g,b)=>{const A=await this.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!this.sendConnection||this.state!==u_.Connected)return void b(new yE(_p.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));const j=this.filterTobeUnmutedTracks(p);if(j.length===0)return void g();const H=this.createUnmuteMessage(j),z=p.trackMediaType==="video"?PT.UNMUTE_LOCAL_VIDEO:PT.UNMUTE_LOCAL_AUDIO;await S_(this,WE.RequestP2PMuteLocal,{action:z,message:H}),g()}catch(j){b(j)}finally{A()}}),_e(this,"handleUpdateVideoEncoder",async(p,g,b)=>{const A=await this.sendMutex.lock("Locking from P2PChannel2.handleSetVideoEncoder");try{const j=this.localTrackMap.get(TE.LocalVideoTrack);if(!this.sendConnection||!j||j.track!==p||this.state!==u_.Connected)return void g();const{id:H,track:z}=j;H&&(await this.sendConnection.updateSendParameters(H,z),await this.sendConnection.updateEncoderConfig(H,z),this.emit(WE.UpdateVideoEncoder,z)),g()}catch(j){b(j)}finally{A()}}),_e(this,"handleSetOptimizationMode",async(p,g,b)=>{const A=await this.sendMutex.lock("Locking from P2PChannel2.handleSetOptimizationMode");try{const j=this.localTrackMap.get(TE.LocalVideoTrack);if(!this.sendConnection||!j||j.track!==p||this.state!==u_.Connected)return;const{id:H,track:z}=j;H&&await this.sendConnection.updateSendParameters(H,z),g()}catch(j){b(j)}finally{A()}}),_e(this,"handleReplaceTrack",async(p,g,b,A)=>{let j;Gi.debug("[".concat(this.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(p.getTrackId(),"]")),typeof A=="boolean"&&A||(j=await this.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var H;const $=Array.from(this.localTrackMap.entries()).find(Vt=>{let[,{track:_r}]=Vt;return p===_r});if(!this.sendConnection||!$||$[1].id===void 0||this.state!==u_.Connected)return void g();if(await((H=this.sendConnection)===null||H===void 0?void 0:H.replaceTrack(p,$[1].id)),$[0]===TE.LocalVideoTrack&&I_().supportDualStreamEncoding){const Vt=this.localTrackMap.get(TE.LocalVideoLowTrack);if(Vt){const _r=p._mediaStreamTrack.clone();Vt.track._originMediaStreamTrack.stop(),Vt.track._mediaStreamTrack=_r,Vt.track._originMediaStreamTrack=_r,await new pE((Fi,_l)=>{this.handleReplaceTrack(Vt.track,Fi,_l,!0)})}}g()}catch($){b($)}finally{var z;(z=j)===null||z===void 0||z()}}),_e(this,"handleGetLocalVideoStats",p=>{p(this.statsCollector.getLocalVideoTrackStats())}),_e(this,"handleGetLocalAudioStats",p=>{p(this.statsCollector.getLocalAudioTrackStats())}),_e(this,"handleGetRemoteVideoStats",p=>this.statsCollector.getRemoteVideoTrackStats(p.uid)[p.uid]),_e(this,"handleGetRemoteAudioStats",p=>this.statsCollector.getRemoteAudioTrackStats(p.uid)[p.uid]),this.store=i,this.statsCollector=o,this.statsCollector.addP2PChannel(this),this.statsUploader=new s8,this.bindStatsUploaderEvents()}async startP2PConnection(i,o){throw new yE(_p.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")}async connect(i,o,p,g,b,A){throw new yE(_p.NOT_SUPPORTED,"p2p mode does not support connect.")}async startP2P(i,o){if(this.state=u_.New,this.sendConnection&&(Gi.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset P2PConnection.")),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection)),this.recvConnection&&(Gi.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset P2PConnection.")),this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection)),this.sendConnection=new Lb(i,this.store),this.bindConnectionEvents(this.sendConnection),this.recvConnection=new Lb(i,this.store,YI.RECEIVE_ONLY),this.bindConnectionEvents(this.recvConnection),o){this.store.peerConnectionStart(),await this.recvConnection.establish(o);const p=await this.sendConnection.establish(o);return this.statsUploader.startUploadTransportStats(!0),this.statsUploader.startUploadExtensionUsageStats(),this.state=u_.Connected,p}return await this.recvConnection.establish(o),this.sendConnection.establish(o)}async p2pConnect(i){if(!this.sendConnection||!this.recvConnection)throw new yE(_p.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.startP2PConnection .");this.store.peerConnectionStart(),await this.recvConnection.connect(i),await this.sendConnection.connect(i),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=u_.Connected}async addRemoteCandidate(i){if(!this.sendConnection||!this.recvConnection)throw new yE(_p.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.recvConnection.addRemoteCandidate(i),await this.sendConnection.addRemoteCandidate(i)}async publish(i,o,p){if(!this.sendConnection||this.state!==u_.Connected){this.throwIfTrackTypeNotMatch(i);const A=i.filter(j=>this.pendingLocalTracks.indexOf(j)===-1);return void(this.pendingLocalTracks=this.pendingLocalTracks.concat(A))}this.store.pubId=this.store.pubId+1,k0.markPublishStart(this.store.clientId,this.store.pubId);const g=this.filterTobePublishedTracks(i,o,p);if(g.length===0)return void await this.tryToUnmuteAudio(i);g.forEach(A=>{let{track:j,type:H}=A;const z=Date.now();this.store.publish(j.getTrackId(),H===TE.LocalAudioTrack?"audio":"video",z)}),this.bindLocalTrackEvents(g);const b=this.createGatewayPublishMessage(g);return this.assignLocalTracks(g),g.forEach(A=>{let{track:j,type:H}=A;const z=Date.now();this.store.publish(j.getTrackId(),H===TE.LocalAudioTrack?"audio":"video",void 0,z)}),b}async dopublish(i){if(!this.sendConnection||this.state!==u_.Connected)return;const o=this.localTrackMap.get(i);if(o){const{sdp:p,trackMessage:g}=await this.sendConnection.send([o.track]),{mid:b,localSSRC:A}=g[0];o.id=b,o.ssrcs=A,this.statsCollector.addLocalStats(i),this.statsUploader.startUploadUplinkStats();const j=await U_(this,WE.RequestP2PPublish,{kind:i===TE.LocalAudioTrack?ME.AUDIO:ME.VIDEO,sdp:p,ssrcId:A[0].ssrcId});await this.sendConnection.setDescription("local",j);const H=this.createUnmuteMessage([[i,o]]);await S_(this,WE.RequestUnmuteLocal,H)}}async setDescription(i,o){let p,g;i==="local"?(p=await this.sendMutex.lock("From P2PChannel.restartICE"),g=this.sendConnection):(p=await this.recvMutex.lock("From P2PChannel.restartICE"),g=this.recvConnection);try{return!g||this.state!==u_.Connected?void 0:await g.setDescription(i,o)}finally{p()}}publishLowStream(i){return JS(function*(){throw new yE(_p.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")})()}async republish(){this.pendingLocalTracks.length>0&&(Gi.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await U_(this,WE.RequestRePublish,this.pendingLocalTracks),this.emit(WE.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async unpublish(i){if(!this.sendConnection||this.state!==u_.Connected)return void(i.length===0?this.pendingLocalTracks.length=0:this.pendingLocalTracks=this.pendingLocalTracks.filter(H=>!VE(i).call(i,H)));const o=this.filterTobeUnpublishedTracks(i);if(o.length===0)return;this.unbindLocalTrackEvents(o.map(H=>{let[z,{track:$}]=H;return{type:z,track:$}}));const p=o.filter(H=>{let[,{id:z}]=H;return z!==void 0});if(!this.sendConnection||this.state!==u_.Connected)return void i.forEach(H=>{const z=this.pendingLocalTracks.indexOf(H);z!==-1&&this.pendingLocalTracks.splice(z,1)});const g=o.find(H=>H[0]==="videoLowTrack");g&&g[1].track.close();let b;const A=this.createGatewayUnpublishMessage(o);p.length>0&&(b=await this.sendConnection.stopSending(p.map(H=>{let[,{id:z}]=H;return z}))),this.withdrawLocalTracks(o),this.unbindLocalTrackEvents(o.map(H=>{let[z,{track:$}]=H;return{type:z,track:$}})),o.forEach(H=>{let[z]=H;this.statsCollector.removeLocalStats(z)}),this.localTrackMap.size===0&&this.statsUploader.stopUploadUplinkStats();const j=this.createMuteMessage(o);return await pE.all(j.map(async H=>{await S_(this,WE.RequestMuteLocal,[H])})),{sdp:b,unpubMsg:A}}async unpublishLowStream(){throw new yE(_p.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")}async doUnpublish(i){if(!this.sendConnection||this.state!==u_.Connected)return;const o=[];if(i!==ME.AUDIO){const p=this.localTrackMap.get(TE.LocalVideoTrack);(p==null?void 0:p.id)!==void 0&&o.push([TE.LocalVideoTrack,p]);const g=this.localTrackMap.get(TE.LocalVideoLowTrack);(g==null?void 0:g.id)!==void 0&&o.push([TE.LocalVideoLowTrack,g]),this.statsCollector.removeLocalStats(TE.LocalVideoTrack),this.statsCollector.removeLocalStats(TE.LocalVideoLowTrack)}if(i!==ME.VIDEO){const p=this.localTrackMap.get(TE.LocalAudioTrack);(p==null?void 0:p.id)!==void 0&&o.push([TE.LocalAudioTrack,p]),this.statsCollector.removeLocalStats(TE.LocalAudioTrack)}if(o.length>0){const p=await this.sendConnection.stopSending(o.map(A=>{let[,j]=A;return j.id}));o.forEach(A=>{let[,j]=A;j.id=void 0,j.ssrcs=void 0});const g=await U_(this,WE.RequestP2PUnPublish,{sdp:p,kind:i});await this.sendConnection.setDescription("local",g);const b=this.createMuteMessage(o);await pE.all(b.map(async A=>{await S_(this,WE.RequestMuteLocal,[A])}))}}async subscribe(i,o,p,g){var b;if(!this.recvConnection||this.state!==u_.Connected)throw new yE(_p.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if((b=this.remoteUserMap.get(i))!==null&&b!==void 0&&b.has(o))return;const{track:A,mid:j,sdp:H}=await this.recvConnection.receive(o,p,g);o===ME.AUDIO?(i._audioSSRC=g,i._audioTrack?i._audioTrack._updateOriginMediaStreamTrack(A):(i._audioTrack=new cT(A,i.uid,i._uintid,this.store),Gi.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(i._audioTrack.getTrackId()))),this.bindRemoteTrackEvents(i,i._audioTrack)):(i._videoSSRC=g,i._videoTrack?i._videoTrack._updateOriginMediaStreamTrack(A):(i._videoTrack=new DT(A,i.uid,i._uintid,this.store),Gi.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(i._videoTrack.getTrackId()))),this.bindRemoteTrackEvents(i,i._videoTrack));const z=this.remoteUserMap.get(i);z?z.set(o,j):this.remoteUserMap.set(i,new Map([[o,j]])),this.statsCollector.addRemoteStats(i.uid),this.statsUploader.startUploadDownlinkStats(),await S_(this,WE.RequestP2PUnmuteRemote,o);const $=this.pendingRemoteTracks.findIndex(Vt=>{let{user:_r,kind:Fi}=Vt;return _r.uid===i.uid&&o===Fi});return $!==-1&&(this.pendingRemoteTracks.splice($,1),this.emit(WE.MediaReconnectEnd,i.uid)),H}async unsubscribe(i,o,p,g){const b=this.pendingRemoteTracks.filter(H=>{let{user:z,kind:$}=H;return p!==void 0?z.uid===i.uid&&p===$:z.uid===i.uid});if(b.forEach(H=>{const z=this.pendingRemoteTracks.indexOf(H);this.pendingRemoteTracks.splice(z,1)}),this.recvConnection&&this.state===u_.Connected||g||b.forEach(H=>{let{kind:z}=H;var $;if(z===ME.AUDIO)($=i._audioTrack)===null||$===void 0||$._destroy(),i._audioTrack=void 0;else if(z===ME.VIDEO){var Vt;(Vt=i._videoTrack)===null||Vt===void 0||Vt._destroy(),i._videoTrack=void 0}}),!this.recvConnection||this.state!==u_.Connected)return;const A=this.filterTobeUnSubscribedTracks(i,p);if(A.length===0)return void(p!==ME.VIDEO&&S_(this,WE.RequestP2PMuteRemote,ME.AUDIO));const j=await this.recvConnection.stopReceiving(A.map(H=>{let[,{id:z}]=H;return z}),o);return this.withdrawRemoteTracks(A),this.remoteUserMap.size===0&&this.statsUploader.stopUploadDownlinkStats(),A.forEach(H=>{let[z,{kind:$}]=H;var Vt,_r;if($===ME.VIDEO&&z._videoSSRC&&((Vt=this.recvConnection)===null||Vt===void 0||Vt.setStatsRemoteVideoIsReady(z._videoSSRC,!1)),$===ME.VIDEO)this.unbindRemoteTrackEvents(z._videoTrack),g||((_r=z._videoTrack)===null||_r===void 0||_r._destroy(),z._videoTrack=void 0);else if($===ME.AUDIO){var Fi;this.unbindRemoteTrackEvents(z._audioTrack),!g&&((Fi=z._audioTrack)===null||Fi===void 0||Fi._destroy(),z._audioTrack=void 0)}}),A.filter(H=>{let[,{kind:z}]=H;return z!==ME.AUDIO}).forEach(H=>{let[,{kind:z}]=H;S_(this,WE.RequestP2PMuteRemote,z)}),p!==ME.VIDEO&&S_(this,WE.RequestP2PMuteRemote,ME.AUDIO),j}getAllDataChannels(){return this.localDataChannels}async massSubscribe(i){throw new yE(_p.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")}async massSubscribeNoLock(i){throw new yE(_p.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")}async massUnsubscribe(i){throw new yE(_p.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")}async massUnsubscribeNoLock(i){throw new yE(_p.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")}async muteRemote(i,o){if(!this.recvConnection)return;const p=this.remoteUserMap.get(i);if(!p)return void Gi.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(i.uid,"."));if(!p.get(o))return void Gi.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(i.uid," media type ").concat(o,"."));const g=o===ME.VIDEO?i._videoSSRC:i._audioSSRC;g!==void 0&&this.recvConnection.setStatsRemoteVideoIsReady(g,!1)}async unmuteRemote(i,o){return this.unmuteRemoteNoLock(i,o)}async unmuteRemoteNoLock(i,o){if(!this.recvConnection)return;const p=this.remoteUserMap.get(i);if(!p)return void Gi.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(i.uid,"."));p.get(o)||Gi.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(i.uid," media type ").concat(o,"."))}getAllTracks(i){const o=this.localTrackMap.get(TE.LocalAudioTrack);if((o==null?void 0:o.track)instanceof Z_){const p=o.track;return Array.from(this.localTrackMap.entries()).filter(g=>{let[b]=g;return b!==TE.LocalAudioTrack}).filter(g=>{let[b]=g;return!(i&&b===TE.LocalVideoLowTrack)}).map(g=>{let[,{track:b}]=g;return b}).concat(p.trackList)}return Array.from(this.localTrackMap.entries()).filter(p=>{let[g]=p;return!(i&&g===TE.LocalVideoLowTrack)}).map(p=>{let[,{track:g}]=p;return g})}reportPublishEvent(i,o,p,g,b){if(i){const j=this.localTrackMap.get(TE.LocalAudioTrack),H=g?this.localTrackMap.get(TE.LocalVideoLowTrack):this.localTrackMap.get(TE.LocalVideoTrack);jE.publish(this.store.sessionId,{eventElapse:k0.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:i,ec:o,audioName:j==null?void 0:j.track.getTrackLabel(),videoName:H==null?void 0:H.track.getTrackLabel(),screenshare:(H==null?void 0:H.track._hints.indexOf(A_.SCREEN_TRACK))!==-1,audio:!!j,video:!!H,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:b})}else{var A;p||(p=[]);const j=p.find(z=>z instanceof g_),H=g?(A=this.localTrackMap.get(TE.LocalVideoTrack))===null||A===void 0?void 0:A.track:p.find(z=>z instanceof ZE);jE.publish(this.store.sessionId,{eventElapse:k0.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:i,ec:o,audioName:j==null?void 0:j.getTrackLabel(),videoName:H==null?void 0:H.getTrackLabel(),screenshare:(H==null?void 0:H._hints.indexOf(A_.SCREEN_TRACK))!==-1,audio:!!j,video:!!H,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:b})}}reportSubscribeEvent(i,o,p,g){const b=g===ME.VIDEO?p._videoSSRC:p._audioSSRC;b&&jE.subscribe(this.store.sessionId,{succ:i,ec:o,video:g===ME.VIDEO,audio:g===ME.AUDIO,peerid:p.uid,subscribeRequestid:g===ME.VIDEO?p._videoSSRC:p._audioSSRC,p2pid:this.store.p2pId,eventElapse:k0.measureFromSubscribeStart(this.store.clientId,b)})}reset(){Gi.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new E0("P2PChannel2-send-mutex"),this.sendMutex=new E0("P2PChannel2-recv-mutex"),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadUplinkStats(),this.statsUploader.stopUploadDownlinkStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const i=this.localTrackMap.get(TE.LocalAudioTrack);if((i==null?void 0:i.track)instanceof Z_){if(i.track.trackList.length>0){const o=i.track;i.track.trackList.forEach(p=>{o.removeAudioTrack(p)})}i.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.state=u_.Disconnected}getStats(i){var o,p;return i?(p=this.recvConnection)===null||p===void 0?void 0:p.getStats():(o=this.sendConnection)===null||o===void 0?void 0:o.getStats()}getRemoteVideoIsReady(i){var o;return((o=this.recvConnection)===null||o===void 0?void 0:o.getRemoteVideoIsReady(i))||!1}getLocalAudioVolume(){const i=this.localTrackMap.get(TE.LocalAudioTrack);if(i)return i.track.getVolumeLevel()}getLocalVideoSize(){const i=this.localTrackMap.get(TE.LocalVideoTrack);if(i)return{width:i.track._videoWidth||0,height:i.track._videoHeight||0}}getEncoderConfig(i){const o=this.localTrackMap.get(i);return o&&o.track instanceof ZE||o&&o.track instanceof g_?o.track._encoderConfig:void 0}getLocalMedia(i){return this.localTrackMap.get(i)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(i,o){if(!i)return this.remoteUserMap.size>0;const p=this.remoteUserMap.get(i);return!!p&&(!o||p.has(o))}async hasRemoteMediaWithLock(i,o){if(!i)return this.remoteUserMap.size>0;const p=this.remoteUserMap.get(i);return!!p&&(!o||p.has(o))}getRemoteMedia(i){var o;const p=Array.from(RS(o=this.remoteUserMap).call(o)).find(g=>g.uid===i);return p?{audioTrack:p.audioTrack,audioSSRC:p._audioSSRC,videoTrack:p.videoTrack,videoSSRC:p._videoSSRC}:{}}getAudioLevels(){let i=Array.from(this.remoteUserMap.entries()).map(p=>{let[g]=p;return{uid:g.uid,level:g.audioTrack?100*g.audioTrack._source.getAccurateVolumeLevel():0}});const o=this.localTrackMap.get(TE.LocalAudioTrack);return o&&i.push({level:100*o.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),i=AO(i).call(i,(p,g)=>p.level-g.level),i}async disconnectForReconnect(){this.sendConnection&&this.recvConnection&&(Gi.debug("[".concat(this.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),this.state=u_.Reconnecting,nE("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(i=>{let[o]=i;var p;o._videoTrack&&o._videoTrack._player&&((p=o._videoTrack._player.getVideoElement())===null||p===void 0||p.pause(),o._videoTrack._player.isKeepLastFrame=!0,o._videoTrack._originMediaStreamTrack.stop())}),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0,this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0,this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(i=>{var o;let[p,{track:g}]=i;switch(p){case TE.LocalVideoTrack:VE(o=g._hints).call(o,A_.LOW_STREAM)?g.close():this.pendingLocalTracks.push(g);break;case TE.LocalAudioTrack:g instanceof Z_?this.pendingLocalTracks=this.pendingLocalTracks.concat(g.trackList):this.pendingLocalTracks.push(g);case TE.LocalVideoLowTrack:}}),this.emit(WE.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(i=>{let[o,p]=i;Array.from(RS(p).call(p)).forEach(g=>{this.setPendingRemoteMedia(o,g)}),this.emit(WE.MediaReconnectStart,o.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.statsUploader.stopUploadUplinkStats(),this.statsUploader.stopUploadDownlinkStats(),this.statsUploader.stopUploadTransportStats(),Gi.debug("[".concat(this.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))}hasPendingRemoteMedia(i,o){for(const p of this.pendingRemoteTracks){const{user:g,kind:b}=p;if((i instanceof D0?i.uid:i)===g.uid&&o===b)return!0}return!1}setPendingRemoteMedia(i,o){this.hasPendingRemoteMedia(i,o)||this.pendingRemoteTracks.push({user:i,kind:o})}async restartICE(i){let o;o=i.direction===YI.SEND_ONLY?await this.sendMutex.lock("From P2PChannel.restartICE"):await this.recvMutex.lock("From P2PChannel.restartICE");try{const p=await i.restartICE(),g=await U_(this,WE.RequestP2PRestartICE,p);i.setDescription("local",g)}finally{o()}}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;const i=this.sendConnection.getStats(),o=this.localTrackMap.get(TE.LocalVideoTrack),p=this.localTrackMap.get(TE.LocalAudioTrack),g=i.videoSend.find(_l=>{var _u;return _l.ssrc===(o==null||(_u=o.ssrcs)===null||_u===void 0?void 0:_u[0].ssrcId)}),b=i.audioSend.find(_l=>{var _u;return _l.ssrc===(p==null||(_u=p.ssrcs)===null||_u===void 0?void 0:_u[0].ssrcId)});if(!g||!b)return 1;const A=oS(this,WE.NeedSignalRTT),j=g?g.rttMs:void 0,H=b?b.rttMs:void 0,z=j&&H?(j+H)/2:j||H,$=(z&&A?(z+A)/2:z||A)||0,Vt=100*i.sendPacketLossRate*.7/50+.3*$/1500,_r=Vt<.17?1:Vt<.36?2:Vt<.59?3:Vt<.1?4:5,Fi=o==null?void 0:o.track;if(Fi&&Fi._encoderConfig&&Fi._hints.indexOf(A_.SCREEN_TRACK)===-1){const _l=Fi._encoderConfig.bitrateMax,_u=i.bitrate.actualEncoded;if(_l&&_u){const _h=(1e3*_l-_u)/(1e3*_l);return h6[_h<.15?0:_h<.3?1:_h<.45?2:_h<.6?3:4][_r]}}return _r}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;const i=this.recvConnection.getStats();let o=0;return Array.from(this.remoteUserMap.entries()).forEach(p=>{let[g]=p;const b=g._audioSSRC,A=g._videoSSRC,j=i.audioRecv.find(_u=>_u.ssrc===b),H=i.videoRecv.find(_u=>_u.ssrc===A);if(!j&&!H)return void(o+=1);const z=oS(this,WE.NeedSignalRTT),$=i.rtt,Vt=($&&z?($+z)/2:$||z)||0,_r=j?j.jitterMs:void 0,Fi=i.recvPacketLossRate;let _l=.7*Fi*100/50+.3*Vt/1500;_r&&(_l=.6*Fi*100/50+.2*Vt/1500+.2*_r/400),o+=_l<.1?1:_l<.17?2:_l<.36?3:_l<.59?4:5}),this.remoteUserMap.size>0?Math.round(o/this.remoteUserMap.size):o}async muteLocalTrack(i){return new pE((o,p)=>{this.handleMuteLocalTrack(i,o,p)})}filterTobePublishedTracks(i,o,p){const g=[],b=I_(),A=this.getAllTracks();i=BI(i=i.filter(z=>A.indexOf(z)===-1));let j=!1,H=!1;for(const z of i){if(z instanceof ZE&&(this.localTrackMap.has(TE.LocalVideoTrack)||j?new yE(_p.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(g.push({track:z,type:TE.LocalVideoTrack}),j=!0),o)){const $=this.getLowVideoTrack(z,p);g.push({track:$,type:TE.LocalVideoLowTrack})}if(z instanceof g_){const $=this.localTrackMap.get(TE.LocalAudioTrack);if($){if(!($.track instanceof Z_))throw new yE(_p.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(z._bypassWebAudio)throw new yE(_p.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");$.track.addAudioTrack(z),this.bindLocalAudioTrackEvents(z,!0)}else if(H){const Vt=g.find(_r=>{let{type:Fi}=_r;return Fi===TE.LocalAudioTrack});if(!(Vt.track instanceof Z_))throw new yE(_p.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(z._bypassWebAudio)throw new yE(_p.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");Vt.track.addAudioTrack(z)}else{if(!b.webAudioMediaStreamDest||z instanceof Z_||z._bypassWebAudio)g.push({track:z,type:TE.LocalAudioTrack});else{const Vt=new Z_;Vt.addAudioTrack(z),g.push({track:Vt,type:TE.LocalAudioTrack})}H=!0}}}return g}filterTobeUnpublishedTracks(i){const o=[],p=this.getAllTracks();i=BI(i=i.filter(g=>p.indexOf(g)!==-1));for(const g of i){if(g instanceof g_){const b=this.localTrackMap.get(TE.LocalAudioTrack);if(!b)continue;b.track instanceof Z_?(b.track.removeAudioTrack(g),this.unbindLocalAudioTrackEvents(g),b.track.trackList.length===0&&(o.push([TE.LocalAudioTrack,b]),b.track.close())):o.push([TE.LocalAudioTrack,b])}if(g instanceof ZE){const b=this.localTrackMap.get(TE.LocalVideoTrack);if(!b)continue;o.push([TE.LocalVideoTrack,b]);const A=this.localTrackMap.get(TE.LocalVideoLowTrack);A&&o.push([TE.LocalVideoLowTrack,A])}}return o}bindLocalTrackEvents(i){i.forEach(o=>{let{track:p,type:g}=o;switch(g){case TE.LocalVideoTrack:p.addListener(xE.GET_STATS,this.handleGetLocalVideoStats),p.addListener(xE.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),p.addListener(xE.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),p.addListener(xE.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),p.addListener(xE.SET_OPTIMIZATION_MODE,this.handleSetOptimizationMode),p.addListener(xE.NEED_REPLACE_TRACK,this.handleReplaceTrack),p.addListener(xE.NEED_MUTE_TRACK,this.handleMuteLocalTrack),p.addListener(xE.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case TE.LocalAudioTrack:this.bindLocalAudioTrackEvents(p);case TE.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(i,o){i instanceof Z_?i.trackList.forEach(p=>{p.addListener(xE.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),p.addListener(xE.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),p.addListener(xE.GET_STATS,this.handleGetLocalAudioStats),p.addListener(xE.NEED_MUTE_TRACK,this.handleMuteLocalTrack),p.addListener(xE.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(i.addListener(xE.GET_STATS,this.handleGetLocalAudioStats),i.addListener(xE.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.addListener(xE.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.addListener(xE.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.addListener(xE.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),o||i.addListener(xE.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(i){i||(i=Array.from(this.localTrackMap.entries()).map(o=>{let[p,{track:g}]=o;return{track:g,type:p}})),i.forEach(o=>{let{track:p,type:g}=o;switch(g){case TE.LocalVideoTrack:p.off(xE.GET_STATS,this.handleGetLocalVideoStats),p.off(xE.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),p.off(xE.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),p.off(xE.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),p.off(xE.SET_OPTIMIZATION_MODE,this.handleSetOptimizationMode),p.off(xE.NEED_REPLACE_TRACK,this.handleReplaceTrack),p.off(xE.NEED_MUTE_TRACK,this.handleMuteLocalTrack),p.off(xE.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case TE.LocalAudioTrack:this.unbindLocalAudioTrackEvents(p);case TE.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(i){i instanceof Z_?i.trackList.forEach(o=>{o.off(xE.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),o.off(xE.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),o.off(xE.GET_STATS,this.handleGetLocalAudioStats),o.off(xE.NEED_MUTE_TRACK,this.handleMuteLocalTrack),o.off(xE.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(i.off(xE.GET_STATS,this.handleGetLocalAudioStats),i.off(xE.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.off(xE.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.off(xE.NEED_REPLACE_TRACK,this.handleReplaceTrack),i.off(xE.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.off(xE.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(i,o){o instanceof DT&&o.addListener(xE.GET_STATS,p=>{p(this.handleGetRemoteVideoStats(i))}),o instanceof cT&&o.addListener(xE.GET_STATS,p=>{p(this.handleGetRemoteAudioStats(i))})}unbindRemoteTrackEvents(i){i&&i.removeAllListeners(xE.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(i=>{let[o,p]=i;p.has(ME.AUDIO)&&this.unbindRemoteTrackEvents(o._audioTrack),p.has(ME.VIDEO)&&this.unbindRemoteTrackEvents(o._videoTrack)})}createGatewayPublishMessage(i){return i.map(o=>{var p;let g,b,{track:A,type:j}=o;switch(j){case TE.LocalAudioTrack:g=v_.Audio,b={dtx:A instanceof _R&&A._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case TE.LocalVideoTrack:g=VE(p=A._hints).call(p,A_.SCREEN_TRACK)?v_.Screen:v_.High,b=kR(kR({},rP(A)),{},{codec:this.store.codec});break;case TE.LocalVideoLowTrack:g=v_.Low,b=kR(kR({},rP(A)),{},{codec:this.store.codec})}return{kind:j===TE.LocalAudioTrack?ME.AUDIO:ME.VIDEO,stream_type:g,attributes:b,isMuted:A.muted||!A.enabled}})}createGatewayUnpublishMessage(i){return i.map(o=>{var p;let g,[b,{track:A,ssrcs:j,id:H}]=o;switch(b){case TE.LocalVideoTrack:g=VE(p=A._hints).call(p,A_.SCREEN_TRACK)?v_.Screen:v_.High;break;case TE.LocalAudioTrack:g=v_.Audio;break;case TE.LocalVideoLowTrack:g=v_.Low}return{stream_type:g,ssrcs:j,mid:H}})}assignLocalTracks(i){i.forEach(o=>{let{track:p,type:g}=o;this.localTrackMap.set(g,{track:p})})}withdrawLocalTracks(i){i.forEach(o=>{let[p]=o;this.localTrackMap.delete(p)})}bindConnectionEvents(i){i.onConnectionStateChange=async o=>{var p;if(Gi.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(o,")")),this.emit(WE.PeerConnectionStateChange,o),o!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),VE(p=this._restartStates).call(p,o)||i.direction===YI.SEND_ONLY){if(this._restartTimer)return;const g=()=>{(i.iceConnectionState==="disconnected"||i.iceConnectionState==="checking"||i.iceConnectionState==="failed")&&(Gi.debug("[".concat(this.store.clientId,"] [P2PChannel] start use restartICE")),oS(this,WE.QueryClientConnectionState)==="CONNECTED"&&this.restartICE(i))};this._restartTimer=window.setTimeout(()=>{g(),this._restartTimer=void 0},800)}},i.onICEConnectionStateChange=o=>{o!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),Gi.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(o,")")),jE.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:o,tag:x_.TRACER}).onSuccess(),this.emit(WE.IceConnectionStateChange,o)},i.onICETransportStateChange=o=>{Gi.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(o,")"))},i.onDTLSTransportStateChange=o=>{Gi.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(o,")"))},i.onDTLSTransportError=o=>{Gi.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(o,")"))},i.onFirstAudioDecoded=o=>{var p;const g=Array.from(RS(p=this.remoteUserMap).call(p)).find(A=>A._audioSSRC===o);var b;g&&(this.store.subscribe(g.uid,"audio",void 0,void 0,void 0,Date.now()),(b=g.audioTrack)===null||b===void 0||b.emit(sI.FIRST_FRAME_DECODED),jE.firstRemoteFrame(this.store.sessionId,p0.FIRST_AUDIO_DECODE,L_.FIRST_AUDIO_DECODE,{peer:g._uintid,subscribeElapse:k0.measureFromSubscribeStart(this.store.clientId,o),subscribeRequestid:o,p2pid:this.store.p2pId}))},i.onFirstAudioReceived=o=>{var p;const g=Array.from(RS(p=this.remoteUserMap).call(p)).find(b=>b._audioSSRC===o);g&&jE.firstRemoteFrame(this.store.sessionId,p0.FIRST_AUDIO_RECEIVED,L_.FIRST_AUDIO_RECEIVED,{peer:g._uintid,subscribeElapse:k0.measureFromSubscribeStart(this.store.clientId,o),subscribeRequestid:o,p2pid:this.store.p2pId})},i.onFirstVideoDecoded=(o,p,g)=>{this.reportVideoFirstFrameDecoded(o,p,g)},i.onFirstVideoReceived=o=>{var p;const g=Array.from(RS(p=this.remoteUserMap).call(p)).find(b=>b._videoSSRC===o);g&&jE.firstRemoteFrame(this.store.sessionId,p0.FIRST_VIDEO_RECEIVED,L_.FIRST_VIDEO_RECEIVED,{peer:g._uintid,subscribeElapse:k0.measureFromSubscribeStart(this.store.clientId,o),subscribeRequestid:o,p2pid:this.store.p2pId})},i.onSelectedLocalCandidateChanged=(o,p)=>{const g=o.candidateType==="relay",b=p.candidateType==="relay";p.candidateType!=="unknown"&&g===b||this.emit(WE.ConnectionTypeChange,g),Gi.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(IR(p))," -> ").concat(JSON.stringify(IR(o)),")"))},i.onSelectedRemoteCandidateChanged=(o,p)=>{Gi.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(IR(p))," -> ").concat(JSON.stringify(IR(o)),")"))},i.onFirstVideoDecodedTimeout=o=>{this.reportVideoFirstFrameDecoded(o,void 0,void 0,!0)},i.onLocalCandidate=o=>{this.emit(WE.LocalCandidate,o)}}unbindConnectionEvents(i){i.onConnectionStateChange=void 0,i.onICEConnectionStateChange=void 0,i.onICETransportStateChange=void 0,i.onDTLSTransportStateChange=void 0,i.onDTLSTransportError=void 0,i.onFirstAudioDecoded=void 0,i.onFirstAudioReceived=void 0,i.onFirstVideoDecoded=void 0,i.onFirstVideoReceived=void 0,i.onSelectedLocalCandidateChanged=void 0,i.onSelectedRemoteCandidateChanged=void 0,i.onFirstVideoDecodedTimeout=void 0,i.onLocalCandidate=void 0}filterTobeMutedTracks(i){const o=[];if(this.getAllTracks().indexOf(i)===-1)return o;const p=this.localTrackMap.get(TE.LocalAudioTrack);if(i instanceof g_&&(p==null?void 0:p.track)instanceof Z_)return p.track.isActive||o.push([TE.LocalAudioTrack,p]),o;const g=Array.from(this.localTrackMap.entries()).find(b=>{let[,{track:A}]=b;return i===A});if(g&&(o.push(g),g[0]===TE.LocalVideoTrack)){const b=this.localTrackMap.get(TE.LocalVideoLowTrack);b&&o.push([TE.LocalVideoLowTrack,b])}return o}filterTobeUnmutedTracks(i){const o=[],p=this.localTrackMap.get(TE.LocalAudioTrack);if(i instanceof g_&&(p==null?void 0:p.track)instanceof Z_)return p.track.isActive&&o.push([TE.LocalAudioTrack,p]),o;const g=Array.from(this.localTrackMap.entries()).find(b=>{let[,{track:A}]=b;return i===A});if(g)if(g[0]===TE.LocalVideoTrack){o.push(g);const b=this.localTrackMap.get(TE.LocalVideoLowTrack);b&&o.push([TE.LocalVideoLowTrack,b])}else o.push(g);return o}createMuteMessage(i){return i.map(o=>{var p;let g,[b,{track:A,ssrcs:j,id:H}]=o;switch(b){case TE.LocalAudioTrack:g=v_.Audio;break;case TE.LocalVideoTrack:g=VE(p=A._hints).call(p,A_.SCREEN_TRACK)?v_.Screen:v_.High;break;case TE.LocalVideoLowTrack:g=v_.Low}return{stream_type:g,ssrcs:j,mid:H}})}createUnmuteMessage(i){return i.map(o=>{var p;let g,[b,{track:A,ssrcs:j,id:H}]=o;switch(b){case TE.LocalAudioTrack:g=v_.Audio;break;case TE.LocalVideoTrack:g=VE(p=A._hints).call(p,A_.SCREEN_TRACK)?v_.Screen:v_.High;break;case TE.LocalVideoLowTrack:g=v_.Low}return{stream_type:g,ssrcs:j,mid:H}})}filterTobeUnSubscribedTracks(i,o){const p=[],g=this.remoteUserMap.get(i);if(!g)return p;if(o){const b=g.get(o);if(!b)return p;p.push([i,{kind:o,id:b}])}else Array.from(g.entries()).forEach(b=>{let[A,j]=b;p.push([i,{kind:A,id:j}])});return p}createUnsubscribeMessage(i){const o=[];return i.forEach(p=>{let[g,{kind:b,id:A}]=p;switch(b){case ME.VIDEO:return void(g._videoSSRC&&o.push({stream_type:ME.VIDEO,ssrcId:g._videoSSRC}));case ME.AUDIO:return void(g._audioSSRC&&o.push({stream_type:ME.AUDIO,ssrcId:g._audioSSRC}))}}),o}withdrawRemoteTracks(i){i.forEach(o=>{let[p,{kind:g}]=o;const b=this.remoteUserMap.get(p);b&&(b.delete(g),Array.from(b.entries()).length===0&&this.remoteUserMap.delete(p))})}async updateBitrateLimit(i){const o=this.localTrackMap.get(TE.LocalVideoTrack),p=this.localTrackMap.get(TE.LocalVideoLowTrack);o&&await o.track.setBitrateLimit(i.uplink),p&&i.low_stream_uplink&&await p.track.setBitrateLimit({max_bitrate:i.low_stream_uplink.bitrate,min_bitrate:i.low_stream_uplink.bitrate||0})}isP2PDisconnected(){if(this.sendConnection&&this.recvConnection){const i=this.sendConnection.peerConnectionState,o=this.recvConnection.peerConnectionState;return i!=="connected"&&o!=="connected"}return!0}async tryToUnmuteAudio(i){for(let o=0;o<i.length;o++)if(i[o]instanceof g_){const p=this.filterTobeUnmutedTracks(i[o]);if(p.length===0)continue;const g=this.createUnmuteMessage(p);return void await S_(this,WE.RequestUnmuteLocal,g)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=i=>this.getStats(i),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter(i=>{let[,{ssrcs:o}]=i;return!!o}),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=i=>{var o;return!((o=this.recvConnection)===null||o===void 0||!o.getRemoteVideoIsReady(i))},this.statsUploader.requestUpload=(i,o)=>this.emit(WE.RequestUploadStats,i,o),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await w0(mN(this.dtlsFailedCount,$_)),this.emit(WE.RequestReconnect)}async reconnectP2P(){}canPublishLowStream(){return this.localTrackMap.has(TE.LocalVideoTrack)||this.pendingLocalTracks.some(i=>i instanceof ZE)}throwIfTrackTypeNotMatch(i){if(i.filter(o=>o instanceof ZE).length>1)throw new yE(_p.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(i.filter(o=>o instanceof g_).length>1&&(i.some(o=>o instanceof g_&&o._bypassWebAudio)||!I_().webAudioMediaStreamDest))throw new yE(_p.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const o of i){if(o instanceof ZE&&this.pendingLocalTracks.some(p=>p instanceof ZE))throw new yE(_p.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(o instanceof g_&&this.pendingLocalTracks.some(p=>p instanceof g_)&&(!I_().webAudioMediaStreamDest||o._bypassWebAudio||this.pendingLocalTracks.some(p=>p instanceof g_&&p._bypassWebAudio)))throw new yE(_p.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(i,o){const p=!nE("DISABLE_DUAL_STREAM_USE_ENCODING")&&I_().supportDualStreamEncoding,g=kR(kR({},{width:160,height:120,framerate:15,bitrate:50}),o);let b;b=p?i._mediaStreamTrack.clone():R2(i,g);const A=T_(8,"track-low-"),j=new ZE(b,kR(kR({},p&&{scaleResolutionDownBy:c2(g,i)}),{},{frameRate:g.framerate,bitrateMax:g.bitrate,bitrateMin:g.bitrate}),void 0,void 0,A);return j.on($I.TRANSCEIVER_UPDATED,H=>{i._updateRtpTransceiver(H,ER.LOW_STREAM)}),j._hints.push(A_.LOW_STREAM),i.addListener(xE.NEED_CLOSE,()=>{j.close()}),j}async globalLock(){return this.recvMutex.lock("From P2PChannel2.globalLock")}reportVideoFirstFrameDecoded(i,o,p,g){var b;const A=Array.from(RS(b=this.remoteUserMap).call(b)).find(j=>j._videoSSRC===i);if(A){g||this.store.subscribe(A.uid,"video",void 0,void 0,void 0,void 0,Date.now());const j=this.store.keyMetrics,H=j.subscribe.find(z=>z.userId===A.uid&&z.type==="video");jE.firstRemoteVideoDecode(this.store.sessionId,p0.FIRST_VIDEO_DECODE,L_.FIRST_VIDEO_DECODE,{peer:A._uintid,videowidth:o,videoheight:p,subscribeElapse:k0.measureFromSubscribeStart(this.store.clientId,i),subscribeRequestid:i,p2pid:this.store.p2pId,apEnd:j.requestAPEnd||0,apStart:j.requestAPStart||0,joinGwEnd:j.joinGatewayEnd||0,joinGwStart:j.joinGatewayStart||0,pcEnd:j.peerConnectionEnd||0,pcStart:j.peerConnectionStart||0,subscriberEnd:(H==null?void 0:H.subscribeEnd)||0,subscriberStart:(H==null?void 0:H.subscribeStart)||0,videoAddNotify:(H==null?void 0:H.streamAdded)||0,state:g?1:0})}}async remoteMediaSsrcChanged(i,o,p){if(!this.recvConnection)return!1;const g=this.remoteUserMap.get(i);if(!g)return!1;const b=g.get(o);if(!b)return!1;const A=await this.recvConnection.getRemoteSSRC(b);return A!==void 0&&A!==p}resetConnection(i){Gi.debug("[".concat(this.store.clientId,"] [P2PChannel2] reset connection to ").concat(i)),this.state===u_.Connected?(Gi.debug("[".concat(this.store.clientId,"] [P2PChannel2] fallback to websocket but P2PChannel2 state still connected, disconnect first")),this.disconnectForReconnect()):(this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0))}async publishDataChannel(i){throw new yE(_p.NOT_SUPPORTED)}async unpublishDataChannel(i){throw new yE(_p.NOT_SUPPORTED)}async subscribeDataChannel(i,o){throw new yE(_p.NOT_SUPPORTED)}async unsubscribeDataChannel(i,o){throw new yE(_p.NOT_SUPPORTED)}hasPendingRemoteDataChannel(i,o){throw new yE(_p.NOT_SUPPORTED)}setPendingRemoteDataChannel(i,o){throw new yE(_p.NOT_SUPPORTED)}async preConnect(i,o,p,g,b,A){throw new yE(_p.NOT_SUPPORTED)}getEstablishParams(){throw new yE(_p.NOT_SUPPORTED)}async reSubscribe(i){throw new yE(_p.NOT_SUPPORTED)}async updateVideoStreamParameter(i,o){throw new yE(_p.NOT_SUPPORTED)}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(i=>{let[o,{track:p}]=i;o===TE.LocalVideoLowTrack?p._updateRtpTransceiver(void 0,ER.LOW_STREAM):p._updateRtpTransceiver(void 0)})}}function ZS(l){return function(i,o,p){const g=i[o];if(typeof g!="function")throw new Error("Cannot use mutex on object property.");return p.value=async function(){for(var b=arguments.length,A=new Array(b),j=0;j<b;j++)A[j]=arguments[j];switch(l){case $S.SEND_ONLY:{const H=await this.sendMutex.lock("From P2PChannel2.".concat(o));try{return await g.apply(this,A)}finally{H()}}case $S.RECEIVE_ONLY:{const H=await this.recvMutex.lock("From P2PChannel2.".concat(o));try{return await g.apply(this,A)}finally{H()}}default:{const H=await this.sendMutex.lock("From P2PChannel2.".concat(o)),z=await this.recvMutex.lock("From P2PChannel2.".concat(o));try{return await g.apply(this,A)}finally{H(),z()}}}},p}}function O8(l,i){var o=Object.keys(l);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(l);i&&(p=p.filter(function(g){return Object.getOwnPropertyDescriptor(l,g).enumerable})),o.push.apply(o,p)}return o}function N8(l){for(var i=1;i<arguments.length;i++){var o=arguments[i]!=null?arguments[i]:{};i%2?O8(Object(o),!0).forEach(function(p){_e(l,p,o[p])}):Object.getOwnPropertyDescriptors?Object.defineProperties(l,Object.getOwnPropertyDescriptors(o)):O8(Object(o)).forEach(function(p){Object.defineProperty(l,p,Object.getOwnPropertyDescriptor(o,p))})}return l}bE([ZS(),kc("design:type",Function),kc("design:paramtypes",[Object,String]),kc("design:returntype",pE)],V_.prototype,"startP2P",null),bE([ZS(),kc("design:type",Function),kc("design:paramtypes",[String]),kc("design:returntype",pE)],V_.prototype,"p2pConnect",null),bE([ZS($S.SEND_ONLY),kc("design:type",Function),kc("design:paramtypes",[String]),kc("design:returntype",pE)],V_.prototype,"dopublish",null),bE([ZS($S.SEND_ONLY),kc("design:type",Function),kc("design:paramtypes",[Array]),kc("design:returntype",pE)],V_.prototype,"unpublish",null),bE([ZS(),kc("design:type",Function),kc("design:paramtypes",[]),kc("design:returntype",pE)],V_.prototype,"unpublishLowStream",null),bE([ZS($S.SEND_ONLY),kc("design:type",Function),kc("design:paramtypes",[String]),kc("design:returntype",pE)],V_.prototype,"doUnpublish",null),bE([ZS($S.RECEIVE_ONLY),kc("design:type",Function),kc("design:paramtypes",[D0,String,String,Number]),kc("design:returntype",pE)],V_.prototype,"subscribe",null),bE([ZS($S.RECEIVE_ONLY),kc("design:type",Function),kc("design:paramtypes",[D0,String,String,Boolean]),kc("design:returntype",pE)],V_.prototype,"unsubscribe",null),bE([ZS($S.RECEIVE_ONLY),kc("design:type",Function),kc("design:paramtypes",[D0,String]),kc("design:returntype",pE)],V_.prototype,"muteRemote",null),bE([ZS($S.RECEIVE_ONLY),kc("design:type",Function),kc("design:paramtypes",[D0,String]),kc("design:returntype",pE)],V_.prototype,"unmuteRemote",null),bE([ZS($S.RECEIVE_ONLY),kc("design:type",Function),kc("design:paramtypes",[D0,String]),kc("design:returntype",pE)],V_.prototype,"hasRemoteMediaWithLock",null),bE([ZS(),kc("design:type",Function),kc("design:paramtypes",[]),kc("design:returntype",pE)],V_.prototype,"disconnectForReconnect",null),bE([ZS($S.RECEIVE_ONLY),kc("design:type",Function),kc("design:paramtypes",[D0,String,Number]),kc("design:returntype",pE)],V_.prototype,"remoteMediaSsrcChanged",null);const cnt=Date.now(),unt=20,M2=new Map,RP=new Map;async function P8(l){const i=M2.get(l),o=Array.isArray(i)&&i[i.length-1],p=RP.get(l);if(!o)return void(p.isSyncing=!1);const g={uid:o.uid,payload:dN(o.payload)};p.firstRecvTs===0&&(p.firstRecvTs=o.recvTs,p.firstSendTs=o.sendTs);const b=o.sendTs-p.firstSendTs,A=b-(Date.now()-p.firstRecvTs);A>0&&(p.firstRecvTs=Date.now()-b);let j=o.mediaDelay+A;j<=0?(i.pop(),k8(o.context,g),j=0):j=Math.min(j,unt),setTimeout(()=>i.length&&P8(l),j)}function k8(l,i){l.safeEmit(n_.STREAM_MESSAGE,i.uid,i.payload),l.onStreamMessage&&l.onStreamMessage(i)}function lnt(l){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,o=arguments.length>2?arguments[2]:void 0;if(!l.syncWithAudio)return k8(o,{uid:l.uid,payload:dN(l.payload)});const p="".concat(o.id,"-").concat(l.uid),g=M2.get(p)||[],b=g.findIndex(z=>l.sendTs>=z.sendTs),A=N8(N8({},l),{},{context:o,mediaDelay:i,recvTs:Date.now()});b===-1?g.push(A):g.splice(b,0,A),M2.set(p,g);let j=!1;var H;RP.has(p)?j=!((H=RP.get(p))===null||H===void 0||!H.isSyncing):RP.set(p,{isSyncing:j,firstRecvTs:0,firstSendTs:0}),j||P8(p)}const dnt=l_().name;function hnt(){return!function(l,i,o){const p=l_();if(p.os!==l0.IOS||!p.osVersion)return!1;const g=p.osVersion.split(".");return o?i&&Number(g[0])===l&&Number(g[1])<i||Number(g[0])<l:i?Number(g[0])===l&&Number(g[1])<=i||Number(g[0])<l:Number(g[0])<=l}(16,0,!0)&&!function(l,i,o){const p=l_();if(p.name!==m_.SAFARI||!p.osVersion)return!1;const g=p.version.split(".");return o?i&&Number(g[0])===l&&Number(g[1])<i||Number(g[0])<l:i?Number(g[0])===l&&Number(g[1])<=i||Number(g[0])<l:Number(g[0])<=l}(16,0,!0)}function D8(l,i){var o=Object.keys(l);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(l);i&&(p=p.filter(function(g){return Object.getOwnPropertyDescriptor(l,g).enumerable})),o.push.apply(o,p)}return o}function v1(l){for(var i=1;i<arguments.length;i++){var o=arguments[i]!=null?arguments[i]:{};i%2?D8(Object(o),!0).forEach(function(p){_e(l,p,o[p])}):Object.getOwnPropertyDescriptors?Object.defineProperties(l,Object.getOwnPropertyDescriptors(o)):D8(Object(o)).forEach(function(p){Object.defineProperty(l,p,Object.getOwnPropertyDescriptor(o,p))})}return l}E0.setLogger(Gi);class C_ extends D_{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var i;return((i=this._config)===null||i===void 0?void 0:i.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(i){let o;if(super(),_e(this,"store",void 0),_e(this,"_uid",void 0),_e(this,"_channelName",void 0),_e(this,"_uintUid",void 0),_e(this,"_users",[]),_e(this,"_config",void 0),_e(this,"_clientId",void 0),_e(this,"_appId",void 0),_e(this,"_sessionId",null),_e(this,"_key",void 0),_e(this,"_joinInfo",void 0),_e(this,"_gateway",void 0),_e(this,"_statsCollector",void 0),_e(this,"_configDistribute",void 0),_e(this,"_leaveMutex",new E0("client-leave")),_e(this,"_publishMutex",new E0("client-publish")),_e(this,"_renewTokenMutex",new E0("client-renewtoken")),_e(this,"_subscribeMutex",new E0("client-subscribe")),_e(this,"_encryptionMode","none"),_e(this,"_encryptionSecret",null),_e(this,"_encryptionSalt",null),_e(this,"_proxyServer",void 0),_e(this,"_turnServer",{servers:[],mode:"auto"}),_e(this,"_cloudProxyServerMode","disabled"),_e(this,"_isDualStreamEnabled",!1),_e(this,"_defaultStreamFallbackType",void 0),_e(this,"_lowStreamParameter",void 0),_e(this,"_streamFallbackTypeCacheMap",new Map),_e(this,"_remoteStreamTypeCacheMap",new Map),_e(this,"_axiosCancelSource",aS.CancelToken.source()),_e(this,"_audioVolumeIndicationInterval",void 0),_e(this,"_networkQualityInterval",void 0),_e(this,"_userOfflineTimeout",void 0),_e(this,"_streamRemovedTimeout",void 0),_e(this,"_injectStreamingClient",void 0),_e(this,"_liveTranscodeStreamingClient",void 0),_e(this,"_liveRawStreamingClient",void 0),_e(this,"_channelMediaRelayClient",void 0),_e(this,"_networkQualitySensitivity","normal"),_e(this,"_p2pChannel",void 0),_e(this,"_useLocalAccessPoint",!1),_e(this,"_setLocalAPVersion",void 0),_e(this,"_joinAndNotLeaveYet",!1),_e(this,"_numberOfJoinCount",0),_e(this,"_remoteDefaultVideoStreamType",void 0),_e(this,"_inspect",void 0),_e(this,"_moderation",void 0),_e(this,"_license",void 0),_e(this,"_pendingPublishedUsers",[]),_e(this,"ntpAlignErrorCount",0),_e(this,"remoteInboundOffset",0),_e(this,"_handleLocalTrackEnable",(p,g,b)=>{this.publish(p,!1).then(g).catch(b)}),_e(this,"_handleLocalTrackDisable",(p,g,b)=>{this.unpublish(p).then(g).catch(b)}),_e(this,"_handleUserOnline",p=>{if(nE("BLOCK_LOCAL_CLIENT")&&nI(p.uid,this.channelName))return void Gi.debug("[".concat(p.uid,"] will be ignored in local"));this.isStringUID&&typeof p.uid!="string"&&Gi.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));const g=this._users.find(b=>b.uid===p.uid);if(g)g._trust_in_room_=!0;else{const b=new D0(p.uid,p.uint_id||p.uid);this._users.push(b),Gi.debug("[".concat(this._clientId,"] user online"),p.uid),this.safeEmit(n_.USER_JOINED,b)}}),_e(this,"_handleUserOffline",p=>{if(nE("BLOCK_LOCAL_CLIENT")&&nI(p.uid,this.channelName))return;const g=this._users.find(b=>b.uid===p.uid);g&&(this._handleRemoveStream(p),this._handleRemoveDataChannels(p),VL(this._users,g),this._remoteStreamTypeCacheMap.delete(g.uid),this._streamFallbackTypeCacheMap.delete(g.uid),Gi.debug("[".concat(this._clientId,"] user offline"),p.uid,"reason:",p.reason),this.safeEmit(n_.USER_LEAVED,g,p.reason))}),_e(this,"_handleAddAudioOrVideoStream",(p,g,b,A,j,H,z)=>{if(nE("BLOCK_LOCAL_CLIENT")&&nI(g,this.channelName))return;const $=this._users.find(_r=>_r.uid===g);if(!$)return void Gi.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));Gi.debug("[".concat(this._clientId,"] stream added with uid ").concat(g,", type ").concat(p)),this.store.subscribe($.uid,p,void 0,void 0,void 0,Date.now());const Vt=p==="audio"?$.hasAudio:$.hasVideo;$._uintid||($._uintid=j||g),p==="audio"?$._trust_audio_stream_added_state_=!0:$._trust_video_stream_added_state_=!0,p==="audio"?($._audio_added_=!0,b!==void 0&&($._audioSSRC=b),A!==void 0&&($._cname=A),H&&($._audioOrtc=H)):($._video_added_=!0,b!==void 0&&($._videoSSRC=b),A!==void 0&&($._cname=A),z!==void 0&&($._rtxSsrcId=z),H&&($._videoOrtc=H)),(p==="audio"?$.hasAudio:$.hasVideo)&&!Vt&&(Gi.info("[".concat(this._clientId,"] remote user ").concat($.uid," published ").concat(p)),this.safeEmit(n_.USER_PUBLISHED,$,p)),p==="video"?jE.onGatewayStream(this._sessionId,p0.ON_ADD_VIDEO_STREAM,L_.ON_ADD_VIDEO_STREAM,{peer:j||g,ssrc:$._videoSSRC}):jE.onGatewayStream(this._sessionId,p0.ON_ADD_AUDIO_STREAM,L_.ON_ADD_AUDIO_STREAM,{peer:j||g,ssrc:$._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged($,p,b).then(_r=>{if(_r&&(Gi.debug("[".concat(this._clientId,"] resubscribe ").concat(p," for user ").concat($.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof S0))return this._p2pChannel.unsubscribe($,p,!0).then(()=>this._subscribe($,p,!0).catch(Fi=>{Gi.error("[".concat(this._clientId,"] resubscribe error"),Fi.toString())}))}),this._p2pChannel.hasPendingRemoteMedia($,p)&&(Gi.debug("[".concat(this._clientId,"] resubscribe ").concat(p," for user ").concat($.uid," after reconnect.")),this._subscribe($,p,!0).catch(_r=>{Gi.error("[".concat(this._clientId,"] resubscribe error"),_r.toString())}))}),_e(this,"_handleRemoveStream",(p,g,b)=>{if(nE("BLOCK_LOCAL_CLIENT")&&nI(p.uid,this.channelName))return;const A=this._users.find(H=>H.uid===p.uid);if(!A)return void Gi.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));Gi.debug("[".concat(this._clientId,"] stream removed with uid ").concat(p.uid));let j=()=>{};if(A.hasAudio&&A.hasVideo?j=()=>{Gi.info("[".concat(this._clientId,"] remote user ").concat(A.uid," unpublished audio track")),this.safeEmit(n_.USER_UNPUBLISHED,A,"audio"),Gi.info("[".concat(this._clientId,"] remote user ").concat(A.uid," unpublished video track")),this.safeEmit(n_.USER_UNPUBLISHED,A,"video")}:A.hasVideo?j=()=>{Gi.info("[".concat(this._clientId,"] remote user ").concat(A.uid," unpublished video track")),this.safeEmit(n_.USER_UNPUBLISHED,A,"video")}:A.hasAudio&&(j=()=>{Gi.info("[".concat(this._clientId,"] remote user ").concat(A.uid," unpublished audio track")),this.safeEmit(n_.USER_UNPUBLISHED,A,"audio")}),A._trust_audio_stream_added_state_=!0,A._trust_video_stream_added_state_=!0,A._audio_added_=!1,A._video_added_=!1,this._p2pChannel instanceof S0)this._p2pChannel.unsubscribe(A).then(H=>{if(H)return this._gateway.unsubscribe(H,A.uid)});else if(g&&b)if(p.sdp){const{sdp:H}=p;this._p2pChannel.unsubscribe(A,H).then(z=>{z&&g(z)}).catch(b)}else g&&g();A._audioSSRC=void 0,A._videoSSRC=void 0,A._audioOrtc=void 0,A._videoOrtc=void 0,A._rtxSsrcId=void 0,jE.onGatewayStream(this._sessionId,p0.ON_REMOVE_STREAM,L_.ON_REMOVE_STREAM,{peer:p.uint_id||p.uid}),j()}),_e(this,"_handleSetStreamLocalEnable",(p,g,b)=>{if(nE("BLOCK_LOCAL_CLIENT")&&nI(g,this.channelName))return;const A=this._users.find(z=>z.uid===g);if(!A)return void Gi.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));Gi.debug("[".concat(this._clientId,"] local ").concat(p," ").concat(b?"enabled":"disabled"," with uid ").concat(g));const j=p==="audio"?A.hasAudio:A.hasVideo;if(p==="audio"){A._trust_audio_enabled_state_=!0;const z=A._audio_enabled_;if(A._audio_enabled_=b,A._audio_enabled_===z)return;{const $=A._audio_enabled_?"enable-local-audio":"disable-local-audio";Gi.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(g,", msg: ").concat($)),this.safeEmit(n_.USER_INFO_UPDATED,g,$)}}else{A._trust_video_enabled_state_=!0;const z=A._video_enabled_;if(A._video_enabled_=b,A._video_enabled_===z)return;{const $=A._video_enabled_?"enable-local-video":"disable-local-video";Gi.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(g,", msg: ").concat($)),this.safeEmit(n_.USER_INFO_UPDATED,g,$)}}const H=p==="audio"?A.hasAudio:A.hasVideo;return j!==H?!j&&H?(Gi.info("[".concat(this._clientId,"] remote user ").concat(g," published ").concat(p)),void this.safeEmit(n_.USER_PUBLISHED,A,p)):(p==="video"&&A._videoTrack&&A._videoTrack._destroy(),p==="audio"&&A._audioTrack,this._p2pChannel.muteRemote(A,p),Gi.info("[".concat(this._clientId,"] remote user ").concat(g," unpublished ").concat(p)),void this.safeEmit(n_.USER_UNPUBLISHED,A,p)):void 0}),_e(this,"_handleMuteStream",(p,g,b,A,j,H)=>{if(nE("BLOCK_LOCAL_CLIENT")&&nI(p,this.channelName))return;Gi.debug("[".concat(this._clientId,"] receive mute message"),p,g,b);const z=this._users.find(_r=>_r.uid===p);if(!z)return void Gi.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(p));const $=g==="audio"?z.hasAudio:z.hasVideo;if(g==="audio"){z._trust_audio_mute_state_=!0;const _r=z._audio_muted_;if(z._audio_muted_=b,z._audio_muted_===_r)return;{const Fi=z._audio_muted_?"mute-audio":"unmute-audio";Gi.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(p,", msg: ").concat(Fi)),this.safeEmit(n_.USER_INFO_UPDATED,p,Fi)}}else{z._trust_video_mute_state_=!0;const _r=z._video_muted_;if(z._video_muted_=b,z._video_muted_===_r)return;{const Fi=z._video_muted_?"mute-video":"unmute-video";Gi.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(p,", msg: ").concat(Fi)),this.safeEmit(n_.USER_INFO_UPDATED,p,Fi)}}const Vt=g==="audio"?z.hasAudio:z.hasVideo;if($!==Vt){if(!$&&Vt)return!this.store.useP2P&&!(g==="audio"?z._audioSSRC:z._videoSSRC)?void Gi.warning("[".concat(this._clientId,"] remote user ").concat(p," receive ").concat(g," unmute message  before add stream message, ").concat(g," SSRC doesn't exist yet.")):(Gi.info("[".concat(this._clientId,"] remote user ").concat(p," published ").concat(g)),void this.safeEmit(n_.USER_PUBLISHED,z,g));g==="video"&&z._videoTrack&&z._videoTrack._destroy(),g==="audio"&&z._audioTrack,j&&H&&this._p2pChannel instanceof V_&&(A?this._p2pChannel.unsubscribe(z,A,g).then(_r=>{j(_r)}).catch(H):j()),this._p2pChannel.muteRemote(z,g),Gi.info("[".concat(this._clientId,"] remote user ").concat(p," unpublished ").concat(g)),this.safeEmit(n_.USER_UNPUBLISHED,z,g)}}),_e(this,"_handleP2PLost",async p=>{Gi.debug("[".concat(this._clientId,"] receive p2p lost"),p),parseInt(p.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():Gi.warning("[".concat(this._clientId,"] P2PLost stream not found"),p)}),_e(this,"_handleTokenWillExpire",()=>{Gi.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(n_.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)}),_e(this,"_handleBeforeUnload",p=>{p.type==="beforeunload"&&p.returnValue!==void 0&&p.returnValue!==""||(this.leave(),Gi.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))}),_e(this,"_handleUpdateNetworkQuality",()=>{if(this._networkQualitySensitivity==="normal")return;if(navigator&&navigator.onLine!==void 0&&!navigator.onLine)return void this.safeEmit(n_.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});const p={downlinkNetworkQuality:0,uplinkNetworkQuality:0};p.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),p.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(n_.NETWORK_QUALITY,p)}),_e(this,"_handleP2PAddAudioOrVideoStream",(p,g)=>{const b=this._users.find(j=>j.uid===g);if(!b)return void Gi.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));Gi.debug("[".concat(this._clientId,"] stream added with uid ").concat(g,", type ").concat(p)),this.store.subscribe(b.uid,p,void 0,void 0,void 0,Date.now());const A=p==="audio"?b.hasAudio:b.hasVideo;p==="audio"?b._trust_audio_stream_added_state_=!0:b._trust_video_stream_added_state_=!0,p==="audio"?b._audio_added_=!0:b._video_added_=!0,(p==="audio"?b.hasAudio:b.hasVideo)&&!A&&(Gi.info("[".concat(this._clientId,"] remote user ").concat(b.uid," published ").concat(p)),this.safeEmit(n_.USER_PUBLISHED,b,p)),this._p2pChannel.hasPendingRemoteMedia(b,p)&&(Gi.debug("[".concat(this._clientId,"] resubscribe ").concat(p," for user ").concat(b.uid," after reconnect.")),this._subscribe(b,p,!0).catch(j=>{Gi.error("[".concat(this._clientId,"] resubscribe error"),j.toString())}))}),this._config=i,this._clientId=T_(5,"client-"),this.store=new mZ(i.codec,i.audioCodec,i.mode,this._clientId),this.store.clientCreated(),i.proxyServer&&this.setProxyServer(i.proxyServer,!0),i.turnServer&&this.setTurnServer(i.turnServer,!0),Gi.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(qS," build: ").concat(uM,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),i.clientRoleOptions)try{_B(i.clientRoleOptions),o=Object.assign({},i.clientRoleOptions)}catch(p){Gi.warning("[".concat(this._clientId,"] ").concat(p.toString()))}this._statsCollector=new oO(this.store),this._statsCollector.onStatsException=(p,g,b)=>{Gi.debug("[".concat(this._clientId,"] receive exception msg, code: ").concat(p,", msg: ").concat(g,", uid: ").concat(b)),this.safeEmit(n_.EXCEPTION,{code:p,msg:g,uid:b})},this._statsCollector.onUploadPublishDuration=(p,g,b,A)=>{const j=this._users.find(H=>H.uid===p);j&&jE.peerPublishStatus(this._sessionId,{subscribeElapse:A,audioPublishDuration:g,videoPublishDuration:b,peer:j._uintid})},this.store.useDataChannel=I_().supportDataChannel&&nE("SIGNAL_CHANNEL"),this.store.useP2P=nE("P2P"),this._gateway=new _et(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:i.websocketRetryConfig||$_,httpRetryConfig:i.httpRetryConfig||$_,forceWaitGatewayResponse:i.forceWaitGatewayResponse===void 0||i.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:i.role,clientRoleOptions:o}),this._configDistribute=new Oet,this.store.useP2P?(this._p2pChannel=new V_(this.store,this._statsCollector),this._handleP2PEvents()):this._p2pChannel=new S0(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async joinMeta(i,o,p,g,b){let A=!(arguments.length>5&&arguments[5]!==void 0)||arguments[5],j=arguments.length>6&&arguments[6]!==void 0&&arguments[6];y_("JOIN_GATEWAY_USE_443PORT_ONLY",A),y_("JOIN_GATEWAY_USE_DUAL_DOMAIN",j);const H=this._gateway.signal.websocket;return H instanceof HO&&(H.use443PortOnly=A,H.tryDoubleDomain=j),async function(z,$,Vt){sN.get(z)||sN.set(z,[]),oN.get(z)||oN.set(z,$),IT.get(z)||IT.set(z,0);const _r=sN.get(z),Fi=oN.get(z);if(!_r||!Fi)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(IT.get(z)===Fi){const eE=UO();_r.push(eE),await eE.promise}IT.set(z,IT.get(z)+1);for(var _l=arguments.length,_u=new Array(_l>3?_l-3:0),_h=3;_h<_l;_h++)_u[_h-3]=arguments[_h];const _g=await Vt(..._u);return IT.set(z,IT.get(z)-1),IT.get(z)===Fi-1&&_r.length>0&&(_r[0].resolve(),_r.shift()),IT.get(z)===0&&(sN.set(z,[]),oN.set(z,0),IT.set(z,0)),_g}("client.join",nE("JOIN_MAX_CONCURRENCY"),this.join.bind(this),i,o,p,g,b)}async join(i,o,p,g,b){const A=++this._numberOfJoinCount;this.store.joinStart(),g&&(this.store.uid=g);const j=fZ(),H=r6()?window.isSecureContext:"Browser Not Support";if(!r6()&&!j||!window.isSecureContext){const _u="The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser";Gi.warning(_u)}const z=BL();this.connectionState==="DISCONNECTED"&&(this.store.avoidJoinStart=Math.round(Date.now()),Gi.debug("[".concat(this._clientId,"] set avoidJoinStart to ").concat(this.store.avoidJoinStart)));const $=jE.reportApiInvoke(z,{name:e0.JOIN,options:[i,o,p,g],states:{isHttps:j,isSecureContext:H},tag:x_.TRACER});jE.setAppId(i);try{if(!p&&p!==null)throw new hE(_p.INVALID_PARAMS,"Invalid token: ".concat(p,". If you don not use token, set it to null"));p&&O0(p,"token",1,2047),O0(i,"appid",1,2047),pM(o),g&&fM(g),b&&O0(b,"optionalInfo",1,2047)}catch(_u){throw $.onError(_u),_u}if(Gi.info("[".concat(this._clientId,"] start join channel ").concat(o,", join number: ").concat(A)),this._leaveMutex.isLocked&&(Gi.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),Gi.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,this.connectionState!=="DISCONNECTED"){const _u=new hE(_p.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw $.onError(_u),_u}this._sessionId||(this._sessionId=z,this.store.sessionId=this._sessionId),this._gateway.state="CONNECTING";const Vt=v1({clientId:this._clientId,appId:i,sid:this._sessionId,cname:o,uid:typeof g!="string"?g:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:p||i,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:b,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint},this._remoteDefaultVideoStreamType!==void 0&&{defaultVideoStream:this._remoteDefaultVideoStreamType});if(this._useLocalAccessPoint&&(Vt.setLocalAPVersion=this._setLocalAPVersion),typeof g=="string"&&(Vt.stringUid=g,this._uintUid?(Vt.uid=this._uintUid,this._uintUid=void 0):Vt.uid=0),this._encryptionMode!=="none"&&this._encryptionSecret){if(Vt.aesmode=this._encryptionMode,Vt.aespassword=await S$(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new hE(_p.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(Vt.aessalt=this._encryptionSalt)}this._startSession(this._sessionId,{channel:o,appId:i});const _r=this._sessionId;setTimeout(()=>{this.connectionState==="CONNECTING"&&_r===this._sessionId&&jE.joinChannelTimeout(this._sessionId,5)},5e3);try{var Fi;let _u;const _h=Vt.cloudProxyServer;if(VE(Fi=["proxy3","proxy4","proxy5"]).call(Fi,_h)){const SE=nE("PROXY_SERVER_TYPE3");Array.isArray(SE)?Vt.proxyServer=SE[0]:Vt.proxyServer=SE}if(jE.setProxyServer(Vt.proxyServer),Gi.setProxyServer(Vt.proxyServer),this.store.requestAPStart(),Vt.stringUid&&!Vt.uid){const SE=await _5(Vt.stringUid,Vt,this._axiosCancelSource.token,this._config.httpRetryConfig||$_,this.store);Gi.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(Vt.stringUid," => ").concat(SE)),Vt.uid=SE,_u=await v5(Vt,this._axiosCancelSource.token,this._config.httpRetryConfig||$_,!0,this.store)}else _u=await v5(Vt,this._axiosCancelSource.token,this._config.httpRetryConfig||$_,!0,this.store);if(!this._joinAndNotLeaveYet)throw new hE(_p.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this.store.requestAPEnd(),setTimeout(()=>{this._configDistribute.startGetConfigDistribute(Vt,this._axiosCancelSource.token),this._configDistribute.on(WO.UPDATE_BITRATE_LIMIT,SE=>{this._p2pChannel.updateBitrateLimit(SE)})},0),this._key=p||i;const _g=_u.gatewayInfo;this._joinInfo=v1(v1({},Vt),{},{cid:_g.cid,uid:Vt.uid?Vt.uid:_g.uid,vid:_g.vid,apResponse:_g.res,uni_lbs_ip:_g.uni_lbs_ip,gatewayAddrs:_g.gatewayAddrs});const eE=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new hE(_p.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));$.onSuccess(eE),this._appId=i,this._channelName=Vt.cname,this._uid=eE,this.store.uid=eE,setTimeout(()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),window.addEventListener(H0()?"beforeunload":"pagehide",this._handleBeforeUnload)},0);const oE=Vt.stringUid?"string uid: ".concat(Vt.stringUid,",uid: ").concat(Vt.uid):"uid: ".concat(this._uid);return Gi.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(o,",").concat(oE)),setTimeout(()=>{Gi.startUpload()},5e3),this.store.joinEnd(),_l=this,VE(pR).call(pR,_l)||pR.push(_l),eE}catch(_u){const _h=Array.isArray(_u)?_u[0]:_u;throw _h&&_h.code===_p.OPERATION_ABORTED?Gi.warning("[".concat(this._clientId,"] join number: ").concat(A,", Joining channel failed, rollback"),_h):Gi.error("[".concat(this._clientId,"] join number: ").concat(A,", Joining channel failed, rollback"),_h),_h.code!==_p.OPERATION_ABORTED&&this._numberOfJoinCount===A&&(this._gateway.state="DISCONNECTED",this._reset()),$.onError(_h),_h}var _l}_joinGateway(){if(!this._joinInfo||!this._key)throw new hE(_p.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!(this._joinInfo.cloudProxyServer!=="disabled"||this._joinInfo.proxyServer||!nE("JOIN_WITH_FALLBACK_SIGNAL_PROXY"))).then(i=>i).catch(i=>{if(i.code===_p.INIT_WEBSOCKET_TIMEOUT)return this._gateway.leave(!0,e_.FALLBACK),i;if(i.code===_p.INIT_DATACHANNEL_TIMEOUT)return this._gateway.leave(!0,e_.FALLBACK),i;throw i}).then(i=>{if(i instanceof hE){if(i.code===_p.INIT_WEBSOCKET_TIMEOUT){if(Gi.info("[".concat(this._clientId,"] join timeout, fallback to proxy")),!this._joinInfo||!this._key)throw new hE(_p.INVALID_OPERATION);this._joinInfo.cloudProxyServer="fallback",this._cloudProxyServerMode="fallback",this.store.cloudProxyServerMode="fallback";const o=nE("PROXY_SERVER_TYPE3");if(Array.isArray(o))if(this._joinInfo.apUrl){const g=/^https?:\/\/(.+?)(\/.*)?$/.exec(this._joinInfo.apUrl)[1].split("."),b=g.slice(g.length-2).join(".");o.forEach(A=>{this._joinInfo&&VE(A).call(A,b)&&(this._joinInfo.proxyServer=A)}),this._joinInfo.proxyServer||(this._joinInfo.proxyServer=o[0])}else this._joinInfo.proxyServer=o[0];else this._joinInfo.proxyServer=o;const p=nE("LOG_UPLOAD_SERVER").match(/.+:(\d{1,5})$/);return p&&p[1]&&p[1]!=="443"&&Gi.setProxyServer(this._joinInfo.proxyServer),nE("STATS_COLLECTOR_PORT").toString()!=="443"&&jE.setProxyServer(this._joinInfo.proxyServer),jE.reportApiInvoke(this._sessionId,{name:e0.JOIN_FALLBACK_TO_PROXY,options:[this._joinInfo.proxyServer],tag:x_.TRACER}).onSuccess(),this.safeEmit(n_.JOIN_FALLBACK_TO_PROXY,this._joinInfo.proxyServer),nE("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&this._joinInfo.turnServer.servers.forEach(g=>{"forceturn"in g&&(g.forceturn=!0)}),this._gateway.join(this._joinInfo,this._key)}if(Gi.info("[".concat(this._clientId,"] join by datachannel timeout, fallback to websocket")),!this._joinInfo||!this._key)throw new hE(_p.INVALID_OPERATION);return jE.reportApiInvoke(this._sessionId,{name:e0.DATACHANNEL_FAILBACK,options:[this.store.clientId],tag:x_.TRACER}).onSuccess(),this._joinGateway()}return i}).then(i=>i)}async leave(){Gi.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener(H0()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),function(o){const p=pR.indexOf(o);p!==-1&&pR.splice(p,1)}(this);const i=await this._leaveMutex.lock();if(this.connectionState==="DISCONNECTED")return Gi.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void i();await this._gateway.leave(this.connectionState!=="CONNECTED"),Gi.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),i()}async publish(i){let o=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!Array.isArray(i)){if(!(i instanceof P0))return this._publishDataChannel(i);i=[i]}if(i.length===0)throw new hE(_p.INVALID_PARAMS,"param list is empty");const p=i;if(this._gateway.role==="audience")throw new hE(_p.INVALID_OPERATION,"audience can not publish stream");for(const b of p){if(!(b instanceof P0))throw new hE(_p.INVALID_PARAMS,"parameter is not local track");if(!b._enabled&&o)throw new hE(_p.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(b.getTrackId()))}Gi.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(p.map(b=>"".concat(b.getTrackId()," "))));const g=await this._publishMutex.lock();await this._configDistribute.awaitConfigDistributeComplete(),o&&p.forEach(b=>{const A=this._configDistribute.getBitrateLimit();b instanceof ZE&&A&&b.setBitrateLimit(A.uplink)});try{await this._publishHighStream(p),Gi.info("[".concat(this._clientId,"] Publish success, id ").concat(p.map(b=>"".concat(b.getTrackId()," "))))}catch(b){throw Gi.error("[".concat(this._clientId,"] publish error"),b.toString()),b}finally{g()}}async _publishDataChannel(i){b_(i.id,"id",0,65535,!0),XR(i.ordered,"ordered"),O0(i.metadata,"metadata",0,512),Gi.info("[".concat(this._clientId,"] Publishing datachannels, id ").concat(i.id));const o=await this._publishMutex.lock();try{if(this._p2pChannel.getAllDataChannels().findIndex(g=>g.id===i.id)!==-1)throw new hE(_p.INVALID_PARAMS,"Invalid id: ".concat(i.id,". If you want to republish the datachannel, unpublish first"));if(!this._joinInfo||this._uid===void 0)throw new hE(_p.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new hE(_p.INVALID_OPERATION,"can not publish datachannel in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&nE("FORCE_TURN")&&!nE("TURN_ENABLE_TCP")&&!nE("TURN_ENABLE_UDP"))throw new hE(_p.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");const p=new Z4(i);await this._p2pChannel.publishDataChannel([p]);try{const g={streamId:i.id,ordered:i.ordered,maxRetransmits:nE("DATASTREAM_MAX_RETRANSMITS"),metadata:i.metadata,channelId:p._originDataChannelId};await this._gateway.publishDataChannel(this._uid,g,!0)}catch(g){if(g.code!==_p.DISCONNECT_P2P)throw g}return await p._waitTillOpen(),Gi.info("[".concat(this._clientId,"] Publish dataChannels success, id ").concat(p.id)),p}catch(p){throw Gi.error("[".concat(this._clientId,"] publish datachannels error"),p.toString()),p}finally{o()}}async unpublish(i){if(!this._joinInfo||this._uid===void 0)throw new hE(_p.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let o=[];if(i)if(Array.isArray(i))o=i;else{if(!(i instanceof P0))return this._unpublishDataChannel([i]);o=[i]}else this.store.useP2P||await this._unpublishDataChannel(),o=this._p2pChannel.getAllTracks(!0);Gi.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(o.map(g=>"".concat(g.getTrackId()," "))," "));const p=await this._publishMutex.lock();try{if(this._p2pChannel instanceof V_){const g=await this._p2pChannel.unpublish(o);if(g){const b=await this._gateway.sendExtensionMessage(w_.UNPUBLISH,g);b&&await this._p2pChannel.setDescription("local",b)}}else{const g=await this._p2pChannel.unpublish(o);g&&await this._gateway.unpublish(g,this._uid),Gi.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(o.map(b=>"".concat(b.getTrackId()))))}}catch(g){throw Gi.error("[".concat(this._clientId,"] unpublish error"),g.toString()),g}finally{p&&p()}}async _unpublishDataChannel(i){i!==void 0&&i.length!==0||(i=this._p2pChannel.getAllDataChannels()),Gi.info("[".concat(this._clientId,"] Unpublish datachannels, datachannels ").concat(i.map(p=>"".concat(p.id," "))," "));const o=await this._publishMutex.lock();try{const p=await this._p2pChannel.unpublishDataChannel(i);p&&await this._gateway.unpublishDataChannel(p),Gi.info("[".concat(this._clientId,"] Unpublish dataChannel success,dataChannel ").concat(i.map(g=>"".concat(g.id))))}catch(p){throw Gi.error("[".concat(this._clientId,"] unpublish dataChannel error"),p.toString()),p}finally{o&&o()}}async subscribe(i,o,p){return o==="datachannel"?this._subscribeDataChannel(i,p):this._subscribe(i,o)}async _subscribeDataChannel(i,o){var p;if(b_(o,"channelId",0,65535,!0),!this._joinInfo)throw new hE(_p.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new hE(_p.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(this.connectionState," state"));if(!this._users.find(j=>j===i))throw Gi.error("[".concat(this._clientId,"] can not subscribe ").concat(i.uid,", this user is not in the channel")),new hE(_p.INVALID_REMOTE_USER,"user is not in the channel");if(!i.hasAudio&&!i.hasVideo&&i._dataChannels.length===0)throw Gi.error("[".concat(this._clientId,"] can not subscribe ").concat(i.uid,", user is not published")),new hE(_p.INVALID_REMOTE_USER,"user is not published");const g=(p=i._dataChannels)===null||p===void 0?void 0:p.find(j=>j.id===o);if(!g)throw Gi.error("[".concat(this._clientId,"] can not subscribe ").concat(i.uid," with mediaType datachannel, remote datachannel is not published")),new hE(_p.REMOTE_USER_IS_NOT_PUBLISHED);const b=await this._subscribeMutex.lock();Gi.info("[".concat(this._clientId,"] subscribe user ").concat(i.uid,", mediaType: datachannel"));try{const j=await this._p2pChannel.subscribeDataChannel(i,[g]);if(j&&VE(j).call(j,g.id))try{var A;if(!g._originDataChannelId)throw Gi.error("[".concat(this._clientId,"] can not subscribe ").concat(i.uid," with mediaType datachannel, cannot get RTCDatachannel")),new hE(_p.REMOTE_USER_IS_NOT_PUBLISHED);const H={id:g.id,datachannelId:g._originDataChannelId,ordered:g.ordered,maxRetransmits:g.maxRetransmits,metadata:(A=g.metadata)!==null&&A!==void 0?A:""};await this._gateway.subscribeDataChannel(i.uid,H,!0)}catch(H){if((H==null?void 0:H.code)!==_p.WS_ABORT)throw await this._p2pChannel.unsubscribeDataChannel(i,[g]),H;await this._p2pChannel.unsubscribeDataChannel(i,[g]),this._p2pChannel.setPendingRemoteDataChannel(i,g.id)}return await g._waitTillOpen(),Gi.info("[".concat(this._clientId,"] subscribe success user ").concat(i.uid,", mediaType: datachannel")),g}finally{b()}}async _p2pSubscribe(i,o,p){if(d0(o,"mediaType",["audio","video"]),!this._joinInfo)throw new hE(_p.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new hE(_p.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(A=>A===i)){const A=new hE(_p.INVALID_REMOTE_USER,"user is not in the channel");throw Gi.error("[".concat(this._clientId,"] can not subscribe ").concat(i.uid,", this user is not in the channel")),A}if(!i.hasAudio&&!i.hasVideo){const A=new hE(_p.INVALID_REMOTE_USER,"user is not published");throw Gi.error("[".concat(this._clientId,"] can not subscribe ").concat(i.uid,", user is not published")),A}if(!p&&(o==="audio"&&!i.hasAudio||o==="video"&&!i.hasVideo)){const A=new hE(_p.REMOTE_USER_IS_NOT_PUBLISHED);throw Gi.error("[".concat(this._clientId,"] can not subscribe ").concat(i.uid," with mediaType ").concat(o,", remote track is not published")),A}const g=await this._subscribeMutex.lock();Gi.info("[".concat(this._clientId,"] subscribe user ").concat(i.uid,", mediaType: ").concat(o));const b=o==="audio"?TE.LocalAudioTrack:this._joinInfo.defaultVideoStream===LN.LOW_STREAM?TE.LocalVideoLowTrack:TE.LocalVideoTrack;try{await this._p2pChannel.hasRemoteMediaWithLock(i,o)?await this._p2pChannel.unmuteRemote(i,o):(this.store.subscribe(i.uid,o,Date.now()),this._p2pChannel instanceof V_&&await this._gateway.sendExtensionMessage(w_.SUBSCRIBE,{trackType:b})),Gi.info("[".concat(this._clientId,"] subscribe success user ").concat(i.uid,", mediaType: ").concat(o)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(i.uid,this._defaultStreamFallbackType).catch(j=>{Gi.warning("[".concat(this._clientId,"] auto set fallback failed"),j)});const A=o==="audio"?i._audioTrack:i._videoTrack;if(!A)throw new hE(_p.UNEXPECTED_ERROR,"can not find remote track in user object");return A}catch(A){throw Gi.error("[".concat(this._clientId,"] subscribe user ").concat(i.uid," error"),A),A}finally{g()}}async _subscribe(i,o,p){if(this._p2pChannel instanceof V_)return this._p2pSubscribe(i,o);if(d0(o,"mediaType",["audio","video"]),!this._joinInfo)throw new hE(_p.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new hE(_p.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(z=>z===i)){const z=new hE(_p.INVALID_REMOTE_USER,"user is not in the channel");throw Gi.error("[".concat(this._clientId,"] can not subscribe ").concat(i.uid,", this user is not in the channel")),z}if(!i.hasAudio&&!i.hasVideo){const z=new hE(_p.INVALID_REMOTE_USER,"user is not published");throw Gi.error("[".concat(this._clientId,"] can not subscribe ").concat(i.uid,", user is not published")),z}if(!(p||(o!=="audio"||i.hasAudio&&i._audioSSRC!==void 0)&&(o!=="video"||i.hasVideo&&i._videoSSRC!==void 0))){const z=new hE(_p.REMOTE_USER_IS_NOT_PUBLISHED);throw Gi.error("[".concat(this._clientId,"] can not subscribe ").concat(i.uid," with mediaType ").concat(o,", remote track is not published")),z}let g=o==="audio"?i._audioSSRC:i._videoSSRC,b=o==="audio"?i._audioOrtc:i._videoOrtc,A=o==="video"?i._rtxSsrcId:void 0,j={stream_type:o==="audio"?ME.AUDIO:ME.VIDEO,ssrcId:g};const H=await this._subscribeMutex.lock();Gi.info("[".concat(this._clientId,"] subscribe user ").concat(i.uid,", mediaType: ").concat(o));try{if(await this._p2pChannel.hasRemoteMediaWithLock(i,o))await this._p2pChannel.unmuteRemote(i,o);else try{const $=o==="audio"?i._audioSSRC:i._videoSSRC;$!==void 0&&$!==g&&(g=$,b=o==="audio"?i._audioOrtc:i._videoOrtc,A=o==="video"?i._rtxSsrcId:void 0,j={stream_type:o==="audio"?ME.AUDIO:ME.VIDEO,ssrcId:g}),k0.markSubscribeStart(this.store.clientId,g),this.store.subscribe(i.uid,o,Date.now()),await this._p2pChannel.subscribe(i,o,g,A,b);try{await this._gateway.subscribe(i.uid,j,!0)}catch(Vt){if((Vt==null?void 0:Vt.code)!==_p.WS_ABORT)throw await this._p2pChannel.unsubscribe(i,o),Vt;await this._p2pChannel.unsubscribe(i,o,!0),this._p2pChannel.setPendingRemoteMedia(i,o)}this.store.subscribe(i.uid,o,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,i,o)}catch($){throw this._p2pChannel.reportSubscribeEvent(!1,$==null?void 0:$.code,i,o),$}Gi.info("[".concat(this._clientId,"] subscribe success user ").concat(i.uid,", mediaType: ").concat(o)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(i.uid,this._defaultStreamFallbackType).catch($=>{Gi.warning("[".concat(this._clientId,"] auto set fallback failed"),$)});const z=o==="audio"?i._audioTrack:i._videoTrack;if(!z)throw new hE(_p.UNEXPECTED_ERROR,"can not find remote track in user object");return z}catch(z){throw Gi.error("[".concat(this._clientId,"] subscribe user ").concat(i.uid," error"),z),z}finally{H()}}async massSubscribe(i){if(KT(i,"subscribeList"),!this._joinInfo)throw new hE(_p.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new hE(_p.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));const o=Date.now(),p=new Map,g=await this._subscribeMutex.lock();Gi.info("[".concat(this._clientId,"]start massSubscribe user ").concat(i.map(H=>{let{user:z,mediaType:$}=H;return"user: ".concat(z==null?void 0:z.uid,", mediaType: ").concat($)}).join("; ")));const b=(i=[...i]).map(H=>{let{user:z,mediaType:$}=H;return{user:z,mediaType:$}}),A=await this._p2pChannel.globalLock();try{var j;for(let z=i.length-1;z>=0;z--){const $=i[z],{user:Vt,mediaType:_r}=$;if(d0(_r,"mediaType",["audio","video"]),!Vt){const _u=new hE(_p.INVALID_PARAMS,"user property does not exist in subscribeList item");throw Gi.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),_u}if(!this._users.find(_u=>_u===Vt)){const _u=new hE(_p.INVALID_REMOTE_USER,"user is not in the channel");Gi.error("[".concat(this._clientId,"] can not massSubscribe ").concat(Vt.uid,", this user is not in the channel")),b[z].error=_u,i.splice(z,1);continue}if(_r==="audio"&&(!Vt.hasAudio||Vt._audioSSRC===void 0)||_r==="video"&&(!Vt.hasVideo||Vt._videoSSRC===void 0)){const _u=new hE(_p.REMOTE_USER_IS_NOT_PUBLISHED);Gi.error("[".concat(this._clientId,"] can not subscribe ").concat(Vt.uid," with mediaType ").concat(_r,", remote user is not published")),b[z].error=_u,i.splice(z,1);continue}const Fi=n0.Video|n0.LwoVideo,_l=p.get(Vt);if(_l){if(_r==="video"?_l&Fi:_l&n0.Audio){i.splice(z,1),Gi.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(Vt.uid,", mediaType:").concat(_r," twice"));continue}p.set(Vt,_l|(_r==="video"?Fi:n0.Audio))}else p.set(Vt,_r==="video"?Fi:n0.Audio)}for(let z=i.length-1;z>=0;z--){const $=i[z],{user:Vt,mediaType:_r}=$,Fi=n0.Video|n0.LwoVideo;if(this._p2pChannel.hasRemoteMedia(Vt,_r)){await this._p2pChannel.unmuteRemoteNoLock(Vt,_r);const _l=p.get(Vt);p.set(Vt,_r==="video"?_l^Fi:_l^n0.Audio),i.splice(z,1)}}this.store.massSubscribe(i.map(z=>({userId:z.user.uid,type:z.mediaType})),o);const H=ZR(j=Array.from(p.entries())).call(j,(z,$)=>{let[Vt,_r]=$;if(_r===0)return z;const Fi={stream_id:Vt.uid,stream_type:_r};return _r&n0.Audio&&(Fi.audio_ssrc=Vt._audioSSRC),_r&n0.Video&&(Fi.video_ssrc=Vt._videoSSRC),z.push(Fi),z},[]);try{i.length>0&&await this._p2pChannel.massSubscribeNoLock(i.map($=>{let{user:Vt,mediaType:_r}=$;return{user:Vt,mediaType:_r,ssrcId:_r===ME.VIDEO?Vt._videoSSRC:Vt._audioSSRC,rtxSsrcId:_r===ME.VIDEO?Vt._rtxSsrcId:void 0}}));const z=new Map;if(H.length>0){const $=await this._gateway.subscribeAll(H,!0);(($==null?void 0:$.users)||[]).forEach(Vt=>{let{stream_id:_r,video_error_code:Fi,audio_error_code:_l,error_code:_u}=Vt;(Fi||_l||_u)&&z.set(_r,{video_error_code:Fi,audio_error_code:_l,error_code:_u})})}if(Array.from(z.entries()).length>0){const $=Array.from(z.entries()).map(Vt=>{let _r,[Fi,_l]=Vt;return _l.error_code||_l.video_error_code&&_l.audio_error_code?_r=void 0:_l.video_error_code?_r=ME.VIDEO:_l.audio_error_code&&(_r=ME.AUDIO),{user:this.remoteUsers.find(_u=>_u.uid===Fi),mediaType:_r}});await this._p2pChannel.massUnsubscribeNoLock($)}for(const $ of b){const Vt=z.get($.user.uid);if(Vt){const _r=Vt.error_code||$.mediaType==="audio"&&Vt.audio_error_code||$.mediaType==="video"&&Vt.video_error_code;if(_r){const Fi=iI(_r);Gi.error("user:".concat($.user.uid," mediaType:").concat($.mediaType," has massSubscribe error ").concat(Fi.desc)),$.error=new hE(_p.SUBSCRIBE_FAILED,"code ".concat(_r,": ").concat(Fi.desc))}}$.error||($.mediaType==="video"?$.track=$.user.videoTrack:$.track=$.user.audioTrack)}return this.store.massSubscribe(b.filter($=>!$.error).map($=>({userId:$.user.uid,type:$.mediaType})),void 0,Date.now()),b.forEach($=>{var Vt;jE.subscribe(this.store.sessionId,{succ:!!$.error,ec:((Vt=$.error)===null||Vt===void 0?void 0:Vt.code)||null,video:$.mediaType===ME.VIDEO,audio:$.mediaType===ME.AUDIO,peerid:$.user.uid,subscribeRequestid:$.mediaType===ME.VIDEO?$.user._videoSSRC:$.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-o)},!0)}),Gi.info("[".concat(this._clientId,"] massSubscribe success ").concat(i.map($=>{let{user:Vt,mediaType:_r}=$;return"user: ".concat(Vt==null?void 0:Vt.uid,", mediaType: ").concat(_r)}).join("; "))),b}catch(z){throw await this._p2pChannel.massUnsubscribeNoLock(i),z}}finally{A(),g()}}async unsubscribe(i,o,p){if(o||this.store.useP2P){if(o==="datachannel")return this._unsubscribeDataChannel(i,p)}else await this._unsubscribeDataChannel(i,p);if(o&&d0(o,"mediaType",["audio","video"]),!this._joinInfo)throw new hE(_p.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!this._users.find(b=>b===i)){const b=new hE(_p.INVALID_REMOTE_USER,"user is not in the channel");throw Gi.error("[".concat(this._clientId,"] can not unsubscribe ").concat(i.uid,", user is not in the channel")),b}Gi.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(i.uid,", mediaType: ").concat(o));const g=await this._subscribeMutex.lock();try{if(this._p2pChannel instanceof V_)await this._gateway.sendExtensionMessage(w_.UNSUBSCRIBE,{mediaType:o});else{const b=await this._p2pChannel.unsubscribe(i,o);b&&await this._gateway.unsubscribe(b,i.uid),Gi.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(i.uid,", mediaType: ").concat(o))}}catch(b){if(b.code===_p.DISCONNECT_P2P)return void Gi.warning("disconnecting p2p, abort unsubscribe request.");throw Gi.error("[".concat(this._clientId,"] unsubscribe user ").concat(i.uid," error"),b.toString()),b}finally{g()}}async _unsubscribeDataChannel(i,o){if(o&&b_(o,"id",0,65535,!0),!this._joinInfo)throw new hE(_p.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");if(!this._users.find(g=>g===i)){const g=new hE(_p.INVALID_REMOTE_USER,"user is not in the channel");throw Gi.error("[".concat(this._clientId,"] can not unsubscribe ").concat(i.uid,", user is not in the channel")),g}let p;if(typeof o=="number"){const g=i._dataChannels.find(b=>b.id===o);g&&(p=[g])}else p=i._dataChannels;if(p===void 0){const g=new hE(_p.REMOTE_USER_IS_NOT_PUBLISHED);throw Gi.error("[".concat(this._clientId,"] can not unsubscribe ").concat(i.uid," with channelId ").concat(o,", remote datachannel is not published")),g}Gi.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(i.uid,", mediaType: datachannel, ids: ").concat(p.map(g=>g.id)));try{const g=await this._p2pChannel.unsubscribeDataChannel(i,p);g&&await this._gateway.unsubscribeDataChannel(g,i.uid),Gi.info("[".concat(this._clientId,"] unsubscribe datachannel success uid: ").concat(i.uid,", mediaType: datachannel, ids: ").concat(g))}catch(g){if(g.code===_p.DISCONNECT_P2P)return void Gi.warning("disconnecting p2p, abort unsubscribe request.");throw Gi.error("[".concat(this._clientId,"] unsubscribe user ").concat(i.uid," error"),g.toString()),g}}async massUnsubscribe(i){if(KT(i,"unsubscribeList"),!this._joinInfo)throw new hE(_p.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");Gi.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(i.map(p=>{let{user:g,mediaType:b}=p;return"user: ".concat(g==null?void 0:g.uid,", mediaType: ").concat(b,";")}).join())),i=[...i];const o=new Map;for(let p=i.length-1;p>=0;p--){const{user:g,mediaType:b}=i[p];if(!g){const j=new hE(_p.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw Gi.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),j}if(d0(b,"mediaType",["video","audio",void 0]),!this._users.find(j=>j===g)){Gi.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(g.uid,", user is not in the channel")),i.splice(p,1);continue}const A=n0.Video|n0.LwoVideo;if(o.has(g)){const j=o.get(g);let H;switch(b){case"video":H=j&A;break;case"audio":H=j&n0.Audio;break;default:H=j&(n0.Audio|A)}if(H){Gi.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(g.uid,",mediaType:").concat(b," twice.")),i.splice(p,1);continue}b?b==="audio"?o.set(g,j|n0.Audio):b==="video"&&o.set(g,j|A):o.set(g,j|n0.Audio|A)}else b?b==="audio"?o.set(g,n0.Audio):b==="video"&&o.set(g,A):o.set(g,n0.Audio|A)}try{const p=await this._p2pChannel.massUnsubscribe(i);p&&await this._gateway.massUnsubscribe(p),Gi.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(i.map(g=>{let{user:b,mediaType:A}=g;return"user: ".concat(b==null?void 0:b.uid,", mediaType: ").concat(A,";")}).join()))}catch(p){if(p.code===_p.DISCONNECT_P2P)return void Gi.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw Gi.error("[".concat(this._clientId,"] massUnsubscribe error"),p.toString()),p}}async setLowStreamParameter(i){(function(p){if(!p)throw new yE(_p.INVALID_PARAMS);M_(p.width)||UL(p.width,"streamParameter.width"),M_(p.height)||UL(p.height,"streamParameter.height"),M_(p.framerate)||UL(p.framerate,"streamParameter.framerate"),M_(p.bitrate)||b_(p.bitrate,"streamParameter.bitrate")})(i),(!i.width&&i.height||i.width&&!i.height)&&Gi.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),Gi.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(i));const o=this._configDistribute.getLowStreamConfigDistribute();if(o&&o.bitrate&&i.bitrate&&o.bitrate<i.bitrate&&(i.bitrate=o.bitrate),this._lowStreamParameter=i,this._isDualStreamEnabled)return this._p2pChannel.updateVideoStreamParameter(i,TE.LocalVideoLowTrack)}async enableDualStream(){if(!I_().supportDualStream)throw jE.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new hE(_p.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new hE(_p.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(i){throw jE.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),i}this._isDualStreamEnabled=!0,jE.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),Gi.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)throw new hE(_p.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this._p2pChannel.getLocalMedia(TE.LocalVideoLowTrack))try{const i=await this._p2pChannel.unpublishLowStream();i&&await this._gateway.unpublish(i,this._joinInfo.stringUid||this._joinInfo.uid)}catch(i){throw jE.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),i}this._isDualStreamEnabled=!1,jE.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),Gi.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(i,o){if(function(p){d0(p,"role",["audience","host"])}(i),o&&_B(o),this.mode==="rtc")throw Gi.warning("[".concat(this._clientId,"]rtc mode can not use setClientRole")),new hE(_p.INVALID_OPERATION,"rtc mode can not use setClientRole");if(o&&o.level&&i==="host")throw new hE(_p.INVALID_OPERATION,"host mode can not set audience latency level");if(i==="audience"&&this._p2pChannel.hasLocalMedia())throw new hE(_p.INVALID_OPERATION,"can not set client role to audience when publishing stream");await this._gateway.setClientRole(i,o),this._config.role=i,Gi.info("[".concat(this._clientId,"] set client role to ").concat(i,", level: ").concat(o&&o.level))}getRemoteInboundOffset(){var i;const o=(i=this._p2pChannel.getStats())===null||i===void 0?void 0:i.audioSend[0];if(!o||!o.timestamp)return 0;const p=o.timestamp-Date.now();return Math.abs(p)>1e3+o.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?p:0}getNtpWallTimeInMs(){return document.visibilityState==="visible"&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(i,o){if(O0(i,"proxyServer"),!o){if(this.connectionState!=="DISCONNECTED")throw new hE(_p.INVALID_OPERATION,"Set proxy server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new hE(_p.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=i,jE.setProxyServer(this._proxyServer),Gi.setProxyServer(this._proxyServer),Gi.info("[".concat(this._clientId,"] Set proxy server ").concat(o?"by initialize call":""," success."))}setTurnServer(i,o){if(Array.isArray(i)||(i=[i]),!o){if(this.connectionState!=="DISCONNECTED")throw new hE(_p.INVALID_OPERATION,"Set turn server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new hE(_p.INVALID_OPERATION,"You have already set the proxy")}if(VI(i))return this._turnServer={servers:i,mode:"original-manual"},void Gi.info("[".concat(this._clientId,"] Set original turnserver ").concat(o?"by initialize call":""," success: ").concat(i.map(p=>p.urls).join(","),"."));i.forEach(p=>ZV(p)),this._turnServer={servers:i,mode:"manual"},Gi.info("[".concat(this._clientId,"] Set turnserver ").concat(o?"by initialize call":""," success."))}setLicense(i){if(this.connectionState!=="DISCONNECTED")throw new hE(_p.INVALID_OPERATION,"you should set license before join channel");if(O0(i,"license",32,32),!/^[A-Za-z\d]+$/.test(i))throw new hE(_p.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=i,Gi.info("[".concat(this._clientId,"] set license success"),i)}startProxyServer(i){if(this.connectionState!=="DISCONNECTED")throw new hE(_p.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||this._turnServer.mode==="manual"||this._useLocalAccessPoint)throw new hE(_p.INVALID_OPERATION,"You have already set the proxy");const o=[3,4,5];let p;switch(i===void 0&&(i=3),i){case 1:case 2:throw new hE(_p.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:p="proxy3";break;case 4:p="proxy4";break;case 5:p="proxy5";break;default:throw new hE(_p.INVALID_PARAMS,"proxy server mode must be ".concat(o.join("|")))}this._cloudProxyServerMode=p,this.store.cloudProxyServerMode=p,Gi.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if(this.connectionState!=="DISCONNECTED")throw new hE(_p.INVALID_OPERATION,"Stop proxy server after leave channel");jE.setProxyServer(),Gi.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",Gi.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(i){if(!i.accessPoints)throw new hE(_p.INVALID_PARAMS,"accessPoints is required.");KT(i.accessPoints.serverList,"accessPoints.serverList"),O0(i.accessPoints.domain,"accessPoints.domain");const o=(Fi,_l)=>{b_(Fi,_l,0,65535,!0)};let p=443;if(i.accessPoints.port&&(o(i.accessPoints.port,"accessPoints.port"),p=i.accessPoints.port),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new hE(_p.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");nE("CLOSE_AFB_FOR_LOCAL_AP")&&(y_("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),y_("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));const g=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,b=i.accessPoints.domain,A=i.accessPoints.serverList.map(Fi=>g.test(Fi)?"".concat(Fi.replace(/\./g,"-"),".").concat(b):Fi),j=A.map(Fi=>"".concat(Fi,":").concat(p));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,y_("WEBCS_DOMAIN",j),y_("WEBCS_DOMAIN_BACKUP_LIST",j),y_("GATEWAY_DOMAINS",[b]),i.report&&i.report.hostname&&Array.isArray(i.report.hostname)&&i.report.hostname.length?(KT(i.report.hostname,"report.hostname"),y_("EVENT_REPORT_DOMAIN",i.report.hostname[0]),y_("EVENT_REPORT_BACKUP_DOMAIN",i.report.hostname[1]||i.report.hostname[0])):(y_("EVENT_REPORT_DOMAIN",A[0]),y_("EVENT_REPORT_BACKUP_DOMAIN",A[1]||A[0]));let H=6443;i.report&&i.report.port&&(o(i.report.port,"report.port"),H=i.report.port),y_("STATS_COLLECTOR_PORT",H),i.report?y_("ENABLE_EVENT_REPORT",!0):y_("ENABLE_EVENT_REPORT",!1);let z="";i.log&&i.log.hostname&&Array.isArray(i.log.hostname)&&i.log.hostname.length?(KT(i.log.hostname,"log.hostname"),z=i.log.hostname[0]):z=A[0];let $=6444;i.log&&i.log.port&&(o(i.log.port,"log.port"),$=i.log.port),y_("LOG_UPLOAD_SERVER","".concat(z,":").concat($));let Vt=[];i.cds&&i.cds.hostname&&Array.isArray(i.cds.hostname)&&i.cds.hostname.length?(KT(i.cds.hostname,"cds.hostname"),Vt=i.cds.hostname):Vt=A;let _r=443;i.cds&&i.cds.port&&(o(i.cds.port,"cds.port"),_r=i.cds.port),y_("CDS_AP",Vt.map(Fi=>"".concat(Fi,":").concat(_r))),i.cds?y_("ENABLE_CONFIG_DISTRIBUTE",!0):y_("ENABLE_CONFIG_DISTRIBUTE",!1),Gi.info("set local access point v2 success")}setLocalAccessPoints(i,o){if(KT(i,"serverList"),O0(o,"domain"),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new hE(_p.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");const p=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;i=i.map(g=>p.test(g)?"".concat(g.replace(/\./g,"-"),".").concat(o):g),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,y_("WEBCS_DOMAIN",i),y_("WEBCS_DOMAIN_BACKUP_LIST",i),y_("GATEWAY_DOMAINS",[o]),y_("EVENT_REPORT_DOMAIN",i[0]),y_("EVENT_REPORT_BACKUP_DOMAIN",i[1]||i[0]),y_("LOG_UPLOAD_SERVER","".concat(i[0],":6444")),Gi.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(i){if(d0(i,"streamType",[0,1]),this._remoteDefaultVideoStreamType=i,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(i),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(o){throw Gi.error("[".concat(this._clientId,"] set default remote video stream type error"),o.toString()),o}else Gi.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(i))}async setRemoteVideoStreamType(i,o){d0(o,"streamType",[0,1]);try{await this._gateway.setRemoteVideoStreamType(i,o),setTimeout(()=>{const p=this._users.find(g=>g.uid===i);p&&p.videoTrack&&p.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(p){throw Gi.error("[".concat(this._clientId,"] set remote video stream type error"),p.toString()),p}Gi.info("[".concat(this._clientId,"] set remote ").concat(i," video stream type to ").concat(o)),this._remoteStreamTypeCacheMap.set(i,o)}async setStreamFallbackOption(i,o){d0(o,"fallbackType",[0,1,2]);try{await this._gateway.setStreamFallbackOption(i,o)}catch(p){throw Gi.error("[".concat(this._clientId,"] set stream fallback option"),p.toString()),p}Gi.info("[".concat(this._clientId,"] set remote ").concat(i," stream fallback type to ").concat(o)),this._streamFallbackTypeCacheMap.set(i,o)}setEncryptionConfig(i,o,p){(function(b){d0(b,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])})(i),O0(o,"secret");const g=["aes-128-gcm2","aes-256-gcm2"];if(VE(g).call(g,i)){if(!p||!(p instanceof Uint8Array&&p.length===32))throw new hE(_p.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(p)throw new hE(_p.INVALID_PARAMS,"current encrypt mode does not need salt");new RegExp(`^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'"|{}\\[\\]])(?=.{8,})`).test(o)||Gi.warning(`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer.
      `),this._encryptionMode=i,this._encryptionSecret=o,p&&(this._encryptionSalt=hN(p))}async renewToken(i){if(O0(i,"token",1,2047),!this._key||!this._joinInfo)throw new hE(_p.INVALID_OPERATION,"renewToken should not be called before user join");const o=this._key;this._key=i,this._joinInfo&&(this._joinInfo.token=i);const p=await this._renewTokenMutex.lock();try{if(nE("USE_NEW_TOKEN")){Gi.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));const g=await Aet(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||$_);Gi.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:i,ticket:g})}else Gi.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:i});Gi.debug("[".concat(this._clientId,"] renewToken success"))}catch(g){throw this._key=o,this._joinInfo.token=o,Gi.error("[".concat(this._clientId,"] renewToken failed"),g.toString()),g}finally{p()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?Gi.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{const i=this._p2pChannel.getAudioLevels();this.safeEmit(n_.VOLUME_INDICATOR,i)},nE("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){const i=this._statsCollector.getRTCStats(),o=this._gateway.getInChannelInfo();return i.Duration=Math.round(o.duration/1e3),i}async startLiveStreaming(i,o){if(!o){if(this.codec!=="h264")throw new hE(_p.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new hE(_p.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(i)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(i))throw new hE(_p.LIVE_STREAMING_TASK_CONFLICT);const p=o?o0.TRANSCODE:o0.RAW;return this._createLiveStreamingClient(p).startLiveStreamingTask(i,p)}setLiveTranscoding(i){return this._createLiveStreamingClient(o0.TRANSCODE).setTranscodingConfig(i)}async stopLiveStreaming(i){const o=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter(p=>p&&p.hasUrl(i));if(!o.length)throw new hE(_p.INVALID_PARAMS,"can not find live streaming url to stop");await pE.all(o.map(p=>p&&p.stopLiveStreamingTask(i)))}async addInjectStreamUrl(i,o){if(!this._joinInfo)throw new hE(_p.INVALID_OPERATION,"can not addInjectStreamUrl, no joininfo");const p=this._createLiveStreamingClient(o0.INJECT);p.setInjectStreamConfig(o,0),await p.startLiveStreamingTask(i,o0.INJECT)}async removeInjectStreamUrl(){var i;const o=this._createLiveStreamingClient(o0.INJECT),p=Array.from(OT(i=o.streamingTasks).call(i)).find(g=>g.mode===o0.INJECT);if(!this._joinInfo||!p)throw new hE(_p.INVALID_OPERATION,"can remove addInjectStreamUrl, no joininfo or inject task");await o.stopLiveStreamingTask(p.url)}async startChannelMediaRelay(i){I5(i),await this._createChannelMediaRelayClient().startChannelMediaRelay(i)}async updateChannelMediaRelay(i){I5(i),await this._createChannelMediaRelayClient().updateChannelMediaRelay(i)}async stopChannelMediaRelay(){await this._createChannelMediaRelayClient().stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}sendStreamMessage(i){let o=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!this._joinInfo)throw new hE(_p.INVALID_OPERATION,"can not send data stream, not joined");if((typeof i=="string"||i instanceof Uint8Array)&&(i={payload:i}),typeof i.payload=="string"){const p=new TextEncoder;i.payload=p.encode(i.payload)}if(new Blob([i.payload]).size>1024)throw new hE(_p.INVALID_PARAMS,"stream message out of range.");return this._gateway.signal.request(FE.DATA_STREAM,{payload:hN(i.payload),syncWithAudio:i.syncWithAudio,sendTs:Date.now()-cnt},!o)}sendMetadata(i){if(!this._joinInfo)throw new hE(_p.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([i]).size>1024)throw new hE(_p.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(FE.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:hN(i)})}async sendCustomReportMessage(i){if(Array.isArray(i)||(i=[i]),i.forEach(EZ),!this._joinInfo)throw new hE(_p.INVALID_OPERATION,"can not send custom report, not joined");await jE.sendCustomReportMessage(this._joinInfo.sid,i)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){return this._statsCollector.getRemoteNetworkQualityStats()}async pickSVCLayer(i,o){d0(o.spatialLayer,"spatialLayer",[0,1,2,3]),d0(o.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(i,o)}catch(p){throw Gi.error("[".concat(this._clientId,"] pick SVC layer failed"),p.toString()),p}}setRTM2Flag(i){if(d0(i,"flag",[0,1]),!this._joinInfo)throw new hE(_p.INVALID_OPERATION,"Can't setRtm2Flag, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new hE(_p.INVALID_OPERATION,"Can't setRtm2Flag in ".concat(this.connectionState," state"));return this._gateway.setRTM2Flag(i)}_reset(){if(Gi.debug("[".concat(this._clientId,"] reset client")),this._axiosCancelSource.cancel(),this._axiosCancelSource=aS.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId=null,this.store.sessionId=null,this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._pendingPublishedUsers=[],this._users.forEach(i=>{i._audioTrack&&i._audioTrack._destroy(),i._videoTrack&&i._videoTrack._destroy(),i._dataChannels&&(i._dataChannels.forEach(o=>o._close()),i._dataChannels.length=0)}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._cloudProxyServerMode==="fallback"&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new E0("client-publish"),this._subscribeMutex=new E0("client-subscribe"),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._injectStreamingClient&&(this._injectStreamingClient.terminate(),this._injectStreamingClient.removeAllListeners(),this._injectStreamingClient=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}if(this._moderation)try{this.setImageModeration(!1)}catch{}}_startSession(i,o){const p=i||BL();i?Gi.debug("[".concat(this._clientId,"] new Session ").concat(p)):Gi.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(p)),this._sessionId=p,this.store.sessionId=p,o?jE.sessionInit(this._sessionId,{lts:new Date().getTime(),cname:o.channel,appid:o.appId,mode:this.mode}):this._joinInfo?jE.sessionInit(this._sessionId,{lts:new Date().getTime(),cname:this._joinInfo.cname,appid:this._joinInfo.appId,mode:this.mode}):this._gateway.joinInfo&&jE.sessionInit(this._sessionId,{lts:new Date().getTime(),cname:this._gateway.joinInfo.cname,appid:this._gateway.joinInfo.appId,mode:this.mode}),this._joinInfo&&(this._joinInfo.sid=p),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=p)}async _publishHighStream(i){if(!this._joinInfo||this._uid===void 0)throw new hE(_p.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new hE(_p.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&nE("FORCE_TURN")&&!nE("TURN_ENABLE_TCP")&&!nE("TURN_ENABLE_UDP"))throw new hE(_p.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");Gi.debug("[".concat(this._clientId,"] publish high stream"));try{if(this._p2pChannel instanceof V_){const p=await this._p2pChannel.publish(i,this._isDualStreamEnabled,this._lowStreamParameter);if(p)try{await this._gateway.sendExtensionMessage(w_.PUBLISH,p)}catch(g){throw this._p2pChannel.unpublish(i),g}}else{const p=await this._p2pChannel.publish(i,this._isDualStreamEnabled,this._lowStreamParameter),g=(await p.next()).value;if(g){var o;let b;try{b=await this._gateway.publish(this._uid,g,!0)}catch(A){if(A.code!==_p.DISCONNECT_P2P)throw p.throw(A),A}await p.next(((o=b)===null||o===void 0?void 0:o.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(const b of i)b instanceof ZE&&b._encoderConfig&&this._gateway.setVideoProfile(b._encoderConfig),!b.muted&&b.enabled||await this._p2pChannel.muteLocalTrack(b)}}catch(p){if(this._p2pChannel.reportPublishEvent(!1,p==null?void 0:p.code,i),(p==null?void 0:p.code)===_p.WS_ABORT)return;throw p}}async _publishLowStream(){if(!this._joinInfo||this._uid===void 0)throw new hE(_p.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new hE(_p.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));Gi.debug("[".concat(this._clientId,"] publish low stream"));const i=this._configDistribute.getLowStreamConfigDistribute();i&&i.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&i.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=i.bitrate));try{const p=await this._p2pChannel.publishLowStream(this._lowStreamParameter),g=(await p.next()).value;if(g){var o;let b;try{b=await this._gateway.publish(this._uid,g,!0)}catch(A){if(A.code!==_p.DISCONNECT_P2P)throw p.throw(A),A}p.next(((o=b)===null||o===void 0?void 0:o.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(p){if(this._p2pChannel.reportPublishEvent(!1,p==null?void 0:p.code,void 0,!0),(p==null?void 0:p.code)===_p.WS_ABORT)return;throw p}}_createLiveStreamingClient(i){if(!this._joinInfo||!this._appId)return new hE(_p.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();const o=()=>new Pet(this._joinInfo,this._config.websocketRetryConfig||$_,this._config.httpRetryConfig||$_),p=g=>{g.onLiveStreamError=(b,A)=>{jE.reportApiInvoke(this._sessionId,{name:e0.ON_LIVE_STREAM_ERROR,options:[b,A],tag:x_.TRACER}).onSuccess(),this.safeEmit(n_.LIVE_STREAMING_ERROR,b,A)},g.onLiveStreamWarning=(b,A)=>{jE.reportApiInvoke(this._sessionId,{name:e0.ON_LIVE_STREAM_WARNING,options:[b,A],tag:x_.TRACER}).onSuccess(),this.safeEmit(n_.LIVE_STREAMING_WARNING,b,A)},g.on(JI.REQUEST_WORKER_MANAGER_LIST,(b,A,j)=>{if(!this._joinInfo)return j(new hE(_p.INVALID_OPERATION,"can not find join info to get worker manager"));b5(b,this._joinInfo,this._axiosCancelSource.token,$_).then(A).catch(j)})};switch(i){case o0.RAW:return this._liveRawStreamingClient||(this._liveRawStreamingClient=o(),p(this._liveRawStreamingClient)),this._liveRawStreamingClient;case o0.TRANSCODE:return this._liveTranscodeStreamingClient||(this._liveTranscodeStreamingClient=o(),p(this._liveTranscodeStreamingClient)),this._liveTranscodeStreamingClient;case o0.INJECT:return this._injectStreamingClient||(this._injectStreamingClient=o(),this._injectStreamingClient.on(JI.REQUEST_WORKER_MANAGER_LIST,(g,b,A)=>{if(!this._joinInfo)return A(new hE(_p.INVALID_OPERATION,"can not find join info to get worker manager"));b5(g,this._joinInfo,this._axiosCancelSource.token,$_).then(b).catch(A)}),this._injectStreamingClient.onInjectStatusChange=(g,b,A)=>{this.safeEmit(n_.INJECT_STREAM_STATUS,g,b,A)}),this._injectStreamingClient}}_createChannelMediaRelayClient(){if(!this._joinInfo)return new hE(_p.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){const{sendResolutionWidth:i,sendResolutionHeight:o}=this.getLocalVideoStats(),p={width:i,height:o};this._channelMediaRelayClient=new Det(this._joinInfo,this._clientId,this._config.websocketRetryConfig||$_,this._config.httpRetryConfig||$_,p),this._channelMediaRelayClient.on("state",g=>{g===Z0.RELAY_STATE_FAILURE&&this._channelMediaRelayClient&&this._channelMediaRelayClient.dispose(),this.safeEmit(n_.CHANNEL_MEDIA_RELAY_STATE,g)}),this._channelMediaRelayClient.on("event",g=>{this.safeEmit(n_.CHANNEL_MEDIA_RELAY_EVENT,g)}),this._statsCollector.onStatsChanged=(g,b)=>{var A;g==="resolution"&&((A=this._channelMediaRelayClient)===null||A===void 0||A.setVideoProfile(b))}}return this._channelMediaRelayClient}_handleUpdateDataChannel(i,o){const{added:p,deleted:g}=i,b=[];Array.isArray(p)&&p.length>0&&p.forEach(A=>{const{uid:j,stream_id:H,ordered:z,max_retrans_times:$,metadata:Vt}=A,_r=this._users.find(Fi=>Fi._uintid===j);if(!_r)return void Gi.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"));if(Gi.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(j)),VE(b).call(b,_r)||b.push(_r),_r._uintid||(_r._uintid=j),_r._dataChannels.findIndex(Fi=>Fi.id===A.stream_id)===-1){const Fi={id:H,ordered:!!z,maxRetransmits:$,metadata:Vt},_l=new fet(Fi);_r._dataChannels.push(_l),Gi.info("[".concat(this._clientId,"] remote user ").concat(_r.uid," published datachannel")),o||this.safeEmit(n_.USER_PUBLISHED,_r,"datachannel",Fi)}this._p2pChannel.hasPendingRemoteDataChannel(_r,A.stream_id)&&(Gi.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(_r.uid," after reconnect.")),this._subscribeDataChannel(_r,A.stream_id).catch(Fi=>{Gi.error("[".concat(this._clientId,"] resubscribe datachannel error"),Fi.toString())}))}),o&&(this.safeEmit(n_.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(g)&&g.length>0&&g.forEach(A=>{const{uid:j,stream_id:H}=A,z=this._users.find(Vt=>Vt._uintid===j);if(!z)return void Gi.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));const $=z._dataChannels.find(Vt=>Vt.id===A.stream_id);$&&(Gi.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(j)),this._p2pChannel.unsubscribeDataChannel(z,[$]).then(Vt=>{if(Vt)return z._dataChannels=z._dataChannels.filter(_r=>_r!==$),this._gateway.unsubscribeDataChannel(Vt,z.uid)}),Gi.info("[".concat(this._clientId,"] remote user ").concat(j," unpublished datachannel ,id:").concat($.id)),this.safeEmit(n_.USER_UNPUBLISHED,z,"datachannel",$._config))})}_handleRemoveDataChannels(i){const o=this._users.find(p=>p.uid===i.uid);if(o){if(o._dataChannels!==void 0&&o._dataChannels.length>0){Gi.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(i.uid));const p=()=>{Gi.info("[".concat(this._clientId,"] remote user ").concat(o.uid," unpublished datachannel")),o._dataChannels.forEach(g=>{this.safeEmit(n_.USER_UNPUBLISHED,o,"datachannel",g._config)})};this._p2pChannel.unsubscribeDataChannel(o,o._dataChannels).then(g=>{if(g)return this._gateway.unsubscribeDataChannel(g,o.uid)}),p()}}else Gi.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){this._gateway.on(j_.DISCONNECT_P2P,async()=>{await this._p2pChannel.disconnectForReconnect()}),this._gateway.on(j_.CONNECTION_STATE_CHANGE,(i,o,p)=>{var g;if(p===e_.FALLBACK)return;const b=()=>{this.safeEmit(n_.CONNECTION_STATE_CHANGE,i,o,p)};if(jE.reportApiInvoke(this._sessionId||((g=this._gateway.joinInfo)===null||g===void 0?void 0:g.sid)||null,{name:e0.CONNECTION_STATE_CHANGE,options:[i,o,p],tag:x_.TRACER}).onSuccess(JSON.stringify({cur:i,prev:o,reason:p})),Gi.info("[".concat(this._clientId,"] connection state change: ").concat(o," -> ").concat(i)),i==="DISCONNECTED")return this._reset(),void b();if(i==="RECONNECTING")this._users.forEach(j=>{j._trust_in_room_=!1,j._trust_audio_enabled_state_=!1,j._trust_video_enabled_state_=!1,j._trust_audio_mute_state_=!1,j._trust_video_mute_state_=!1,j._trust_audio_stream_added_state_=!1,j._trust_video_stream_added_state_=!1,j._audioSSRC=void 0,j._videoSSRC=void 0,j._videoOrtc=void 0,j._audioOrtc=void 0,j._cname=void 0,j._rtxSsrcId=void 0}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if(i==="CONNECTED"){var A;this._streamFallbackTypeCacheMap.forEach((j,H)=>{this._gateway.setStreamFallbackOption(H,j).catch(z=>{Gi.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),z)})}),this._remoteStreamTypeCacheMap.forEach((j,H)=>{this._gateway.setRemoteVideoStreamType(H,j).catch(z=>{Gi.warning("[".concat(this._clientId,"] auto set remote stream type failed"),z)})}),this._remoteDefaultVideoStreamType!==void 0&&((A=this._joinInfo)===null||A===void 0?void 0:A.defaultVideoStream)===void 0&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{Gi.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(j=>{Gi.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(j))}),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._userOfflineTimeout=void 0,this._users.filter(j=>!j._trust_in_room_).forEach(j=>{Gi.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(j.uid)),this._handleUserOffline({uid:j.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._streamRemovedTimeout=void 0,this._users.forEach(j=>{j._trust_audio_mute_state_||(Gi.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(j.uid)),this._handleMuteStream(j.uid,ME.AUDIO,!1)),j._trust_video_mute_state_||(Gi.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(j.uid)),this._handleMuteStream(j.uid,ME.VIDEO,!1)),j._trust_audio_enabled_state_||(Gi.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(j.uid)),this._handleSetStreamLocalEnable("audio",j.uid,!0)),j._trust_video_enabled_state_||(Gi.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(j.uid)),this._handleSetStreamLocalEnable("video",j.uid,!0)),j._trust_video_stream_added_state_||(Gi.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(j.uid)),this._handleResetAddStream(j,"video")),j._trust_audio_stream_added_state_||(Gi.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(j.uid)),this._handleResetAddStream(j,"audio")),j._video_added_||j._audio_added_||(Gi.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(j.uid)),this._handleRemoveStream({uid:j.uid,uint_id:j._uintid}))}))},1e3))}b()}),this._gateway.on(j_.REQUEST_NEW_GATEWAY_LIST,(i,o)=>{if(!this._joinInfo)return o(new hE(_p.UNEXPECTED_ERROR,"can not recover, no join info"));g2(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||$_,this.store).then(p=>{this._joinInfo&&(this._joinInfo.apResponse=p.gatewayInfo.res,this._joinInfo.gatewayAddrs=p.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=p.gatewayInfo.uni_lbs_ip);const g=[];p.gatewayInfo.gatewayAddrs.forEach(b=>{let{address:A}=b;const[j,H]=A.split(":");this._joinInfo&&this._joinInfo.proxyServer?g.push({proxy:this._joinInfo.proxyServer,host:j,port:H}):g.push({host:j,port:H})}),i(g)}).catch(o)}),this._gateway.on(j_.NETWORK_QUALITY,i=>{this._networkQualitySensitivity==="normal"&&this.safeEmit(n_.NETWORK_QUALITY,i)}),this._gateway.on(j_.STREAM_TYPE_CHANGE,(i,o)=>{this.safeEmit(n_.STREAM_TYPE_CHANGED,i,o),jE.reportApiInvoke(this._sessionId,{name:e0.STREAM_TYPE_CHANGE,options:[i,o],tag:x_.TRACER}).onSuccess(JSON.stringify({uid:i,streamType:o}))}),this._gateway.on(j_.IS_P2P_DISCONNECTED,i=>{this._p2pChannel.isP2PDisconnected()?i(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?i(!1):i(!0)}),this._gateway.on(j_.NEED_RENEW_SESSION,()=>{this._startSession()}),this._gateway.on(j_.REQUEST_P2P_CONNECTION_PARAMS,async(i,o,p)=>{try{o(await this._p2pChannel.startP2PConnection(i))}catch(g){p(g)}}),this._gateway.on(j_.JOIN_RESPONSE,(i,o)=>{if(this.store.useP2P)return;const{dtlsParameters:p,iceParameters:g,candidates:b,rtpCapabilities:A,setup:j,cname:H}=D5(i.ortc,o);this._p2pChannel.connect(g,p,b,A,j,H)}),this._gateway.on(j_.REQUEST_DC_CONNECTION_PARAMS,i=>{i(this._p2pChannel.getEstablishParams())}),this._gateway.on(j_.RESET_SIGNAL,i=>{this._p2pChannel.resetConnection(i),this._handleGatewaySignalEvents()}),this._gateway.on(j_.DATACHANNEL_FAILBACK,()=>{this._joinGateway()}),this._gateway.on(j_.DATACHANNEL_PRECONNECT,async(i,o,p,g)=>{var b,A,j,H,z,$;await this._p2pChannel.startP2PConnection({turnServer:(b=this._joinInfo)===null||b===void 0?void 0:b.turnServer},!0);const Vt=function(_r,Fi){let _l;return Fi&&Fi.ip&&typeof Fi.port=="number"?(_l=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:Fi.ip,port:Fi.port.toString(),type:"host",extension:{}}],Gi.debug("Using remote candidate from AP ".concat(Fi.ip,":").concat(Fi.port)),Fi.ip6&&(_l.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:Fi.ip6,port:Fi.port.toString(),type:"host",extension:{}}),Gi.debug("Using IPV6 remote candidate from AP ".concat(Fi.ip6,":").concat(Fi.port)))):_l=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:_r.ip,port:_r.port.toString(),type:"host",extension:{}}],_l}(i,o);return this._p2pChannel.preConnect({iceUfrag:"".concat((A=this._joinInfo)===null||A===void 0?void 0:A.apResponse.cid,"_").concat((j=this._joinInfo)===null||j===void 0?void 0:j.apResponse.cert),icePwd:"".concat((H=this._joinInfo)===null||H===void 0?void 0:H.apResponse.cid,"_").concat((z=this._joinInfo)===null||z===void 0?void 0:z.apResponse.cert)},{fingerprints:[{hashFunction:"sha-256",fingerprint:($=nE("FINGERPRINT"))!==null&&$!==void 0?$:i.fingerprint}]},Vt,{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},"active","o/i14u9pJrxRKAsu").then(p).catch(g)})}_handleGatewaySignalEvents(){this._gateway.signal.on(JE.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(JE.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(JE.ON_ADD_AUDIO_STREAM,i=>this._handleAddAudioOrVideoStream("audio",i.uid,i.ssrcId,i.cname,i.uint_id,i.ortc)),this._gateway.signal.on(JE.ON_ADD_VIDEO_STREAM,i=>this._handleAddAudioOrVideoStream("video",i.uid,i.ssrcId,i.cname,i.uint_id,i.ortc,i.rtxSsrcId)),this._gateway.signal.on(JE.ON_REMOTE_DATASTREAM_UPDATE,i=>{this._handleUpdateDataChannel(i)}),this._gateway.signal.on(JE.ON_REMOTE_FULL_DATASTREAM_INFO,i=>{this._handleUpdateDataChannel({added:i.datastreams,deleted:[]},!0)}),this._gateway.signal.on(JE.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(JE.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(JE.MUTE_AUDIO,i=>this._handleMuteStream(i.uid,ME.AUDIO,!0)),this._gateway.signal.on(JE.UNMUTE_AUDIO,i=>this._handleMuteStream(i.uid,ME.AUDIO,!1)),this._gateway.signal.on(JE.MUTE_VIDEO,i=>this._handleMuteStream(i.uid,ME.VIDEO,!0)),this._gateway.signal.on(JE.UNMUTE_VIDEO,i=>this._handleMuteStream(i.uid,ME.VIDEO,!1)),this._gateway.signal.on(JE.RECEIVE_METADATA,i=>{const o=dN(i.metadata);this.safeEmit(n_.RECEIVE_METADATA,i.uid,o)}),this._gateway.signal.on(JE.ON_DATA_STREAM,async i=>{if(!i)return;let o=0;if(i.ordered||i.syncWithAudio){const p=this._p2pChannel.getStats(),g=this.remoteUsers.find(A=>A.uid===i.uid),b=p==null?void 0:p.audioRecv.find(A=>A.ssrc===(g==null?void 0:g._audioSSRC));o=b==null?void 0:b.jitterBufferMs}o==null&&(o=0),lnt(i,o,{id:this._clientId,onStreamMessage:typeof this.onStreamMessage=="function"?this.onStreamMessage.bind(this):void 0,safeEmit:this.safeEmit.bind(this)})}),this._gateway.signal.on(JE.ON_CRYPT_ERROR,()=>{VO(()=>{Gi.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(n_.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(JE.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(JE.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{Gi.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,e_.TOKEN_EXPIRE),this.safeEmit(n_.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(JE.ON_STREAM_FALLBACK_UPDATE,i=>{Gi.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(i.stream_id,", attr: ").concat(i.stream_type)),this.safeEmit(n_.STREAM_FALLBACK,i.stream_id,i.stream_type===1?"fallback":"recover")}),this._gateway.signal.on(JE.ON_PUBLISH_STREAM,i=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:i.proxy})),Gi.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(i))))}),this._gateway.signal.on(JE.ENABLE_LOCAL_VIDEO,i=>{this._handleSetStreamLocalEnable("video",i.uid,!0)}),this._gateway.signal.on(JE.DISABLE_LOCAL_VIDEO,i=>{this._handleSetStreamLocalEnable("video",i.uid,!1)}),this._gateway.signal.on(kE.REQUEST_TIMEOUT,(i,o)=>{if(this._joinInfo)switch(i){case FE.PUBLISH:{if(!o)return;const b=o.ortc;if(b){var p,g;const A=b.some(z=>{let{stream_type:$}=z;return $===v_.Audio}),j=b.some(z=>{let{stream_type:$}=z;return $!==v_.Audio}),H=b.some(z=>{let{stream_type:$}=z;return $===v_.Screen||$===v_.ScreenLow});o.state==="offer"&&jE.publish(this._joinInfo.sid,{eventElapse:k0.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:_p.TIMEOUT,audio:A,video:j,p2pid:o.p2p_id,publishRequestid:this.store.pubId,screenshare:H,audioName:A?(p=b.find(z=>{let{stream_type:$}=z;return $===v_.Audio}))===null||p===void 0||(p=p.ssrcs[0])===null||p===void 0?void 0:p.ssrcId.toString():void 0,videoName:j?(g=b.find(z=>{let{stream_type:$}=z;return $!==v_.Audio}))===null||g===void 0||(g=g.ssrcs[0])===null||g===void 0?void 0:g.ssrcId.toString():void 0})}break}case FE.SUBSCRIBE:o&&jE.subscribe(this._joinInfo.sid,{succ:!1,ec:_p.TIMEOUT,audio:o.stream_type===ME.AUDIO,video:o.stream_type===ME.VIDEO,peerid:o.stream_id,subscribeRequestid:o.ssrcId,p2pid:this.store.p2pId,eventElapse:k0.measureFromSubscribeStart(this.store.clientId,o.ssrcId)})}}),this._gateway.signal.on(JE.ON_P2P_OK,i=>{this.uid,this._uid}),this._gateway.signal.on(JE.ON_PUBLISHED_USER_LIST,i=>{if(i==null||!i.users)return;nE("BLOCK_LOCAL_CLIENT")&&(i.users=i.users.filter(g=>!nI(g.string_id||g.stream_id,this.channelName)));const o=[],p=[];for(const g of i.users){let b=this._users.find(Vt=>Vt._uintid===g.stream_id);b?b._trust_in_room_=!0:(b=new D0(g.string_id||g.stream_id,g.stream_id),this._users.push(b),this.getListeners(n_.PUBLISHED_USER_LIST).length===0&&(Gi.debug("[".concat(this._clientId,"] user online"),g.stream_id),this.safeEmit(n_.USER_JOINED,b)));const A=n0.Audio&g.stream_type,j=(n0.Video|n0.LwoVideo)&g.stream_type,H=(65280&g.stream_type)!=0,z=A&&b.hasAudio,$=j&&b.hasVideo;j&&(b._trust_video_stream_added_state_=!0,b._video_added_=!0,b._videoSSRC=g.video_ssrc,b._rtxSsrcId=g.video_rtx),A&&(b._trust_audio_stream_added_state_=!0,b._audio_added_=!0,b._audioSSRC=g.audio_ssrc),A&&!z&&this.getListeners(n_.PUBLISHED_USER_LIST).length===0&&(Gi.info("[".concat(this._clientId,"] remote user ").concat(b.uid," published audio")),this.safeEmit(n_.USER_PUBLISHED,b,"audio")),j&&!$&&this.getListeners(n_.PUBLISHED_USER_LIST).length===0&&(Gi.info("[".concat(this._clientId,"] remote user ").concat(b.uid," published video")),this.safeEmit(n_.USER_PUBLISHED,b,"video")),(A&&!z||j&&!$||H)&&o.push(b),j&&this._p2pChannel.hasPendingRemoteMedia(b,"video")&&p.push({user:b,mediaType:"video"}),A&&this._p2pChannel.hasPendingRemoteMedia(b,"audio")&&p.push({user:b,mediaType:"audio"})}p.length>0&&(Gi.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(p.map(g=>"user: ".concat(g.user.uid,", mediaType: ").concat(g.mediaType)).join("; ")," ")),this.massSubscribe(p).catch(g=>{Gi.error("[".concat(this._clientId,"] mass resubscribe error"),g.toString())})),this.getListeners(n_.PUBLISHED_USER_LIST).length>0?nE("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=o:(Gi.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(o.map(g=>g.uid).join(", "))),this.safeEmit(n_.PUBLISHED_USER_LIST,o)):Gi.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(o.map(g=>g.uid).join(", ")))}),this._gateway.signal.on(JE.ON_RTP_CAPABILITY_CHANGE,i=>{const{video_codec:o}=i;this._p2pChannel instanceof S0&&this._p2pChannel.updateRemoteRTPCapabilities(o.map(p=>p.toLowerCase()).filter(p=>{var g;return VE(g=Object.keys(eI)).call(g,p)}))})}_handleP2PEvents(){this._gateway.signal.on(JE.ON_USER_OFFLINE,()=>{this._p2pChannel.disconnectForReconnect()}),this._gateway.signal.on(w_.PUBLISH,async(i,o)=>{i.forEach(p=>p.kind===ME.VIDEO?(this._handleP2PAddAudioOrVideoStream("video",o),p.isMuted?this._handleMuteStream(o,ME.VIDEO,!0):this._handleMuteStream(o,ME.VIDEO,!1)):(this._handleP2PAddAudioOrVideoStream("audio",o),p.isMuted?this._handleMuteStream(o,ME.AUDIO,!0):this._handleMuteStream(o,ME.AUDIO,!1)))}),this._gateway.signal.on(kE.P2P_START,async(i,o)=>{if(this._p2pChannel instanceof V_){var p;o(await this._p2pChannel.startP2P({turnServer:(p=this._joinInfo)===null||p===void 0?void 0:p.turnServer},i))}}),this._gateway.signal.on(kE.P2P_CONNECTION,async i=>{this._p2pChannel instanceof V_&&await this._p2pChannel.p2pConnect(i)}),this._gateway.signal.on(kE.P2P_REMOTE_CANDIDATE_UPDATE,i=>{this._p2pChannel instanceof V_&&this._p2pChannel.addRemoteCandidate(JSON.parse(i))}),this._gateway.signal.on(w_.SUBSCRIBE,async(i,o,p)=>{if(this._p2pChannel instanceof V_){const{trackType:g}=JSON.parse(i);try{await this._p2pChannel.dopublish(g),o()}catch(b){p(b)}}}),this._gateway.signal.on(w_.UNSUBSCRIBE,async(i,o,p)=>{if(this._p2pChannel instanceof V_){const{mediaType:g}=JSON.parse(i);try{await this._p2pChannel.doUnpublish(g),o()}catch(b){p(b)}}}),this._gateway.signal.on(w_.EXCHANGE_SDP,async(i,o,p)=>{if(this._p2pChannel instanceof V_){const{type:g,sdp:b}=JSON.parse(i);try{o(await this._p2pChannel.setDescription(g,b))}catch(A){p(A)}}}),this._gateway.signal.on(w_.UNPUBLISH,async(i,o,p)=>{if(this._p2pChannel instanceof V_){const{unpubMsg:g,uid:b}=i;if(g.length===1){const A=g[0].stream_type===v_.Audio?ME.AUDIO:ME.VIDEO;this._handleMuteStream(b,A,!0);const{sdp:j}=i;if(this._p2pChannel instanceof V_&&j){const H=this._users.find(z=>z.uid===b);if(!H)return Gi.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(b)),void o();this._p2pChannel.unsubscribe(H,j,A).then(z=>{z&&o(z)}).catch(p)}else o()}else this._handleRemoveStream(i,o,p)}}),this._gateway.signal.on(w_.CONTROL,async(i,o,p)=>{const{action:g,sdp:b,isMuteAll:A,uid:j}=i;switch(g){case PT.MUTE_LOCAL_VIDEO:this._handleMuteStream(j,ME.VIDEO,!0,b,o,p);break;case PT.MUTE_LOCAL_AUDIO:o(),this._handleMuteStream(j,ME.AUDIO,!0);break;case PT.UNMUTE_LOCAL_VIDEO:o(),this._handleP2PAddAudioOrVideoStream("video",j),this._handleMuteStream(j,ME.VIDEO,!1);break;case PT.UNMUTE_LOCAL_AUDIO:o(),this._handleP2PAddAudioOrVideoStream("audio",j),this._handleMuteStream(j,ME.AUDIO,!1)}A&&this._handleRemoveStream(i,o,p)}),this._gateway.signal.on(w_.DO_SUBSCRIBE,async(i,o,p)=>{if(this._p2pChannel instanceof V_){const{kind:g,sdp:b,ssrcId:A,uid:j}=i,H=this._users.find(z=>z.uid===j);if(!H)return Gi.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)")),void o();try{o(await this._p2pChannel.subscribe(H,g,b,A))}catch(z){p(z)}}}),this._gateway.signal.on(w_.DO_UNSUBSCRIBE,async(i,o,p)=>{if(this._p2pChannel instanceof V_){const{uid:g,kind:b,sdp:A}=i,j=this._users.find(H=>H.uid===g);if(!j)return Gi.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)")),void o();try{o(await this._p2pChannel.unsubscribe(j,A,b))}catch(H){p(H)}}}),this._gateway.signal.on(w_.RESTART_ICE,async(i,o,p)=>{if(this._p2pChannel instanceof V_)try{o(await this._p2pChannel.setDescription("remote",i))}catch(g){p(g)}}),this._p2pChannel.on(WE.RequestP2PRestartICE,async(i,o,p)=>{try{o(await this._gateway.sendExtensionMessage(w_.RESTART_ICE,i))}catch(g){p(g)}}),this._p2pChannel.on(WE.LocalCandidate,i=>{this._gateway.sendExtensionMessage(w_.CANDIDATE,JSON.stringify(i))}),this._p2pChannel.on(WE.RequestP2PMuteLocal,async(i,o,p)=>{try{o(await this._gateway.sendExtensionMessage(w_.CONTROL,i))}catch(g){p(g)}}),this._p2pChannel.on(WE.RequestP2PPublish,async(i,o,p)=>{try{o(await this._gateway.sendExtensionMessage(w_.DO_SUBSCRIBE,i))}catch(g){p(g)}}),this._p2pChannel.on(WE.RequestP2PUnPublish,async(i,o,p)=>{try{o(await this._gateway.sendExtensionMessage(w_.DO_UNSUBSCRIBE,i))}catch(g){p(g)}}),this._p2pChannel.on(WE.RequestP2PUnmuteRemote,async(i,o,p)=>{if(this._joinInfo)try{await this._gateway.unmuteRemote(i,this._joinInfo.stringUid||this._joinInfo.uid),o()}catch(g){g.code===_p.DISCONNECT_P2P?o():p(g)}else o()}),this._p2pChannel.on(WE.RequestP2PMuteRemote,async(i,o,p)=>{if(this._joinInfo)try{await this._gateway.muteRemote(i,this._joinInfo.stringUid||this._joinInfo.uid),o()}catch(g){g.code===_p.DISCONNECT_P2P?o():p(g)}else o()}),this._p2pChannel.on(WE.StateChange,(i,o)=>{o===u_.Connected&&this._p2pChannel.republish()})}_handleP2PChannelEvents(){this._p2pChannel.on(WE.RequestMuteLocal,async(i,o,p)=>{if(this._joinInfo)try{await this._gateway.muteLocal(i,this._joinInfo.stringUid||this._joinInfo.uid),o()}catch(g){g.code===_p.DISCONNECT_P2P?o():p(g)}else o()}),this._p2pChannel.on(WE.RequestUnmuteLocal,async(i,o,p)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(i,this._joinInfo.stringUid||this._joinInfo.uid),o()}catch(g){g.code===_p.DISCONNECT_P2P?o():p(g)}else o()}),this._p2pChannel.on(WE.RequestRePublish,(i,o,p)=>{this.publish(i,!1).then(o).catch(p)}),this._p2pChannel.on(WE.RequestRePublishDataChannel,(i,o,p)=>{pE.all(i.map(async g=>{await this._p2pChannel.publishDataChannel([g]);const b={streamId:g.id,ordered:g.ordered,maxRetransmits:g.maxRetransmits,metadata:g.metadata,channelId:g._originDataChannelId};try{await this._gateway.publishDataChannel(this._uid,b,!0)}catch(A){if(A.code!==_p.DISCONNECT_P2P)throw A}})).then(o).catch(p)}),this._p2pChannel.on(WE.RequestReSubscribe,async(i,o,p)=>{try{for(const{user:g,kind:b}of i)b===ME.VIDEO?await this.subscribe(g,"video"):await this.subscribe(g,"audio");o()}catch(g){p(g)}}),this._p2pChannel.on(WE.RequestUploadStats,(i,o)=>{this._gateway.uploadStats(i,o)}),this._p2pChannel.on(WE.MediaReconnectStart,i=>{this.safeEmit(n_.MEDIA_RECONNECT_START,i)}),this._p2pChannel.on(WE.MediaReconnectEnd,i=>{this.safeEmit(n_.MEDIA_RECONNECT_END,i)}),this._p2pChannel.on(WE.NeedSignalRTT,i=>{i(this._gateway.getSignalRTT())}),this._p2pChannel.on(WE.RequestRestartICE,async i=>{if(this._p2pChannel instanceof V_)return;const o=await this._p2pChannel.restartICE(i),p=await o.next();if(p.done)return;const g=p.value;let b;try{b=await this._gateway.restartICE({iceParameters:g})}catch(j){return void o.throw(j)}const{iceParameters:A}=function(j){const H=j.iceParameters;return{iceParameters:{iceUfrag:H.iceUfrag,icePwd:H.icePwd}}}(b);await o.next({remoteIceParameters:A})}),this._p2pChannel.on(WE.RequestReconnect,async()=>{this._gateway.reconnect()}),this._p2pChannel.on(WE.RequestReconnectPC,async()=>{var i;const{iceParameters:o,dtlsParameters:p,rtpCapabilities:g}=await this._p2pChannel.startP2PConnection({turnServer:(i=this._joinInfo)===null||i===void 0?void 0:i.turnServer}),{gatewayEstablishParams:b,gatewayAddress:A}=await this._gateway.reconnectPC({iceParameters:o,dtlsParameters:p,rtpCapabilities:g}),{dtlsParameters:j,iceParameters:H,candidates:z,rtpCapabilities:$,setup:Vt,cname:_r}=D5(b,A);await this._p2pChannel.connect(H,j,z,$,Vt,_r),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()}),this._p2pChannel.on(WE.RequestUnpublishForReconnectPC,async(i,o,p)=>{this._joinInfo&&this._uid!==void 0?(await this._gateway.unpublish(i,this._uid),o()):p()}),this._p2pChannel.on(WE.P2PLost,()=>{this.safeEmit(n_.P2P_LOST,this.store.uid)}),this._p2pChannel.on(WE.UpdateVideoEncoder,i=>{i._encoderConfig&&this._gateway.setVideoProfile(i._encoderConfig)}),this._p2pChannel.on(WE.ConnectionTypeChange,i=>{this.safeEmit(n_.IS_USING_CLOUD_PROXY,i)}),this._p2pChannel.on(WE.RequestLowStreamParameter,i=>{i(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on(WE.QueryClientConnectionState,i=>{i(this.connectionState)})}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(i){if(this.connectionState!=="CONNECTED"||!this._joinInfo)throw new hE(_p.INVALID_OPERATION,"[".concat(this._clientId,"] Client did not join channel"));if(this._inspect)throw new hE(_p.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));if(!i)throw new hE(_p.INVALID_PARAMS,"[".concat(this._clientId,"] inspectConfig is necessary"));if(!i.inspectType||!Array.isArray(i.inspectType))throw new hE(_p.INVALID_PARAMS,"[".concat(this._clientId,"] inspectConfig.inspectType is necessary and is an instance of Array."));{const o=[...new Set(i.inspectType)];o.forEach(p=>{var g;if(!VE(g=["supervise","moderation"]).call(g,p))throw new hE(_p.INVALID_PARAMS,"[".concat(this._clientId,"] ").concat(p," is not a valid inspect type."))}),i.inspectType=o}if(i&&i.extraInfo&&i.extraInfo.length>1024)throw new hE(_p.INVALID_PARAMS,"[".concat(this._clientId,"] inspectConfig.extraInfo length cannot exceed 1024 bytes"));try{const o=new bP(i);this._inspect=o,this.handleVideoInspectEvents(this._inspect),await o.init({appId:this._joinInfo.appId,areaCode:"",cname:this._joinInfo.cname,sid:this._joinInfo.sid,token:this._joinInfo.token,uid:this._joinInfo.uid,cid:this._joinInfo.cid,vid:this._joinInfo.vid?Number(this._joinInfo.vid):0},$_)}catch(o){throw Array.isArray(o)?o[0]:o}}async disableContentInspect(){if(!this._inspect)throw new hE(_p.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(i){throw Array.isArray(i)?i[0]:i}}async setImageModeration(i,o){if(XR(i,"enabled"),i){if(!o)throw new hE(_p.INVALID_PARAMS,"[".concat(this._clientId,"] config is necessary"));if(b_(o.interval,"interval",1e3,1/0),this.connectionState!=="CONNECTED"||!this._joinInfo)throw new hE(_p.INVALID_OPERATION,"[".concat(this._clientId,'] can not enable image moderation, not joined"'));try{if(this._moderation)return void this._moderation.updateConfig(o);const p=new x2(o);this._moderation=p,this.handleImageModerationEvents(this._moderation),await p.init({appId:this._joinInfo.appId,areaCode:"",cname:this._joinInfo.cname,sid:this._joinInfo.sid,token:this._joinInfo.token,uid:this._joinInfo.uid,cid:this._joinInfo.cid,vid:this._joinInfo.vid?Number(this._joinInfo.vid):0},$_)}catch(p){throw Array.isArray(p)?p[0]:p}}else{if(!this._moderation)throw new hE(_p.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(p){throw Array.isArray(p)?p[0]:p}}}handleImageModerationEvents(i){i.on(HS.CONNECTION_STATE_CHANGE,(o,p)=>{if(this.safeEmit(n_.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,o,p),o===ES.CONNECTED){if(this.connectionState!=="CONNECTED")throw this.setImageModeration(!1),new hE(_p.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");i.inspectImage()}}),i.on(HS.CLIENT_LOCAL_VIDEO_TRACK,o=>{o(this.localTracks.filter(p=>p.trackMediaType==="video")[0])})}handleVideoInspectEvents(i){i.on(a0.CONNECTION_STATE_CHANGE,(o,p)=>{if(this.safeEmit(n_.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,o,p),p===OS.CONNECTED){if(this.connectionState!=="CONNECTED")return void this.safeEmit(n_.CONTENT_INSPECT_ERROR,new hE(_p.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));i.inspectImage()}}),i.on(a0.INSPECT_RESULT,(o,p)=>{var g;if((p==null?void 0:p.code)===_p.INVALID_OPERATION&&this.connectionState==="DISCONNECTED")return Gi.debug("Stop inspect content because that has left channel"),this==null||(g=this._inspect)===null||g===void 0||g.close(),void(this._inspect=void 0);this.safeEmit(n_.CONTENT_INSPECT_RESULT,o,p)}),i.on(a0.CLIENT_LOCAL_VIDEO_TRACK,o=>{o(this.localTracks.filter(p=>p.trackMediaType==="video")[0])})}getJoinChannelServiceRecords(){return Gi.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(i){XR(i,"enabled"),y_("ENABLE_PUBLISH_AUDIO_FILTER",i),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(i)}_handleResetAddStream(i,o){switch(o){case"audio":i._audio_added_=!1,i._trust_audio_stream_added_state_=!0;break;case"video":i._video_added_=!1,i._trust_video_stream_added_state_=!0}}}bE([HE(),kc("design:type",Function),kc("design:paramtypes",[]),kc("design:returntype",pE)],C_.prototype,"leave",null),bE([HE({argsMap:(l,i)=>{if(!Array.isArray(i)){if(!(i instanceof P0))return[i];i=[i]}return i.map(o=>o?Object(o).toString():"null")}}),kc("design:type",Function),kc("design:paramtypes",[Object,Boolean]),kc("design:returntype",pE)],C_.prototype,"publish",null),bE([HE({argsMap:(l,i)=>(i||(i=[]),i instanceof Z4?[i.getChannelId()]:(Array.isArray(i)||(i=[i]),i.map(o=>o.getTrackId())))}),kc("design:type",Function),kc("design:paramtypes",[Object]),kc("design:returntype",pE)],C_.prototype,"unpublish",null),bE([HE({argsMap:(l,i,o,p)=>[i.uid,o,p]}),kc("design:type",Function),kc("design:paramtypes",[D0,String,Number]),kc("design:returntype",pE)],C_.prototype,"subscribe",null),bE([HE({argsMap:(l,i)=>i.map(o=>{let{user:p,mediaType:g}=o;return[p==null?void 0:p.uid,g]})}),kc("design:type",Function),kc("design:paramtypes",[Array]),kc("design:returntype",pE)],C_.prototype,"massSubscribe",null),bE([HE({argsMap:(l,i,o,p)=>[i.uid,o,p]}),kc("design:type",Function),kc("design:paramtypes",[D0,String,Number]),kc("design:returntype",pE)],C_.prototype,"unsubscribe",null),bE([HE({argsMap:(l,i)=>i.map(o=>{let{user:p,mediaType:g}=o;return{uid:p==null?void 0:p.uid,mediaType:g}})}),kc("design:type",Function),kc("design:paramtypes",[Array]),kc("design:returntype",pE)],C_.prototype,"massUnsubscribe",null),bE([HE(),kc("design:type",Function),kc("design:paramtypes",[Object]),kc("design:returntype",pE)],C_.prototype,"setLowStreamParameter",null),bE([HE(),kc("design:type",Function),kc("design:paramtypes",[]),kc("design:returntype",pE)],C_.prototype,"enableDualStream",null),bE([HE(),kc("design:type",Function),kc("design:paramtypes",[]),kc("design:returntype",pE)],C_.prototype,"disableDualStream",null),bE([HE(),kc("design:type",Function),kc("design:paramtypes",[String,Object]),kc("design:returntype",pE)],C_.prototype,"setClientRole",null),bE([HE(),kc("design:type",Function),kc("design:paramtypes",[String,Boolean]),kc("design:returntype",void 0)],C_.prototype,"setProxyServer",null),bE([HE(),kc("design:type",Function),kc("design:paramtypes",[Object,Boolean]),kc("design:returntype",void 0)],C_.prototype,"setTurnServer",null),bE([HE(),kc("design:type",Function),kc("design:paramtypes",[String]),kc("design:returntype",void 0)],C_.prototype,"setLicense",null),bE([HE(),kc("design:type",Function),kc("design:paramtypes",[Number]),kc("design:returntype",void 0)],C_.prototype,"startProxyServer",null),bE([HE(),kc("design:type",Function),kc("design:paramtypes",[]),kc("design:returntype",void 0)],C_.prototype,"stopProxyServer",null),bE([HE(),kc("design:type",Function),kc("design:paramtypes",[Object]),kc("design:returntype",void 0)],C_.prototype,"setLocalAccessPointsV2",null),bE([HE(),kc("design:type",Function),kc("design:paramtypes",[Array,String]),kc("design:returntype",void 0)],C_.prototype,"setLocalAccessPoints",null),bE([HE(),kc("design:type",Function),kc("design:paramtypes",[Number]),kc("design:returntype",pE)],C_.prototype,"setRemoteDefaultVideoStreamType",null),bE([HE(),kc("design:type",Function),kc("design:paramtypes",[Object,Number]),kc("design:returntype",pE)],C_.prototype,"setRemoteVideoStreamType",null),bE([HE(),kc("design:type",Function),kc("design:paramtypes",[Object,Number]),kc("design:returntype",pE)],C_.prototype,"setStreamFallbackOption",null),bE([HE({argsMap:(l,i)=>[i]}),kc("design:type",Function),kc("design:paramtypes",[String,String,Uint8Array]),kc("design:returntype",void 0)],C_.prototype,"setEncryptionConfig",null),bE([HE(),kc("design:type",Function),kc("design:paramtypes",[String]),kc("design:returntype",pE)],C_.prototype,"renewToken",null),bE([HE(),kc("design:type",Function),kc("design:paramtypes",[]),kc("design:returntype",void 0)],C_.prototype,"enableAudioVolumeIndicator",null),bE([HE(),kc("design:type",Function),kc("design:paramtypes",[String,Boolean]),kc("design:returntype",pE)],C_.prototype,"startLiveStreaming",null),bE([HE(),kc("design:type",Function),kc("design:paramtypes",[Object]),kc("design:returntype",pE)],C_.prototype,"setLiveTranscoding",null),bE([HE(),kc("design:type",Function),kc("design:paramtypes",[String]),kc("design:returntype",pE)],C_.prototype,"stopLiveStreaming",null),bE([HE(),kc("design:type",Function),kc("design:paramtypes",[String,Object]),kc("design:returntype",pE)],C_.prototype,"addInjectStreamUrl",null),bE([HE(),kc("design:type",Function),kc("design:paramtypes",[]),kc("design:returntype",pE)],C_.prototype,"removeInjectStreamUrl",null),bE([HE(),kc("design:type",Function),kc("design:paramtypes",[uP]),kc("design:returntype",pE)],C_.prototype,"startChannelMediaRelay",null),bE([HE(),kc("design:type",Function),kc("design:paramtypes",[uP]),kc("design:returntype",pE)],C_.prototype,"updateChannelMediaRelay",null),bE([HE(),kc("design:type",Function),kc("design:paramtypes",[]),kc("design:returntype",pE)],C_.prototype,"stopChannelMediaRelay",null),bE([HE({argsMap:(l,i)=>(Array.isArray(i)||(i=[i]),[JSON.stringify(i)])}),kc("design:type",Function),kc("design:paramtypes",[Object]),kc("design:returntype",pE)],C_.prototype,"sendCustomReportMessage",null),bE([HE(),kc("design:type",Function),kc("design:paramtypes",[Object,Object]),kc("design:returntype",pE)],C_.prototype,"pickSVCLayer",null),bE([HE(),kc("design:type",Function),kc("design:paramtypes",[Number]),kc("design:returntype",pE)],C_.prototype,"setRTM2Flag",null),bE([HE(),kc("design:type",Function),kc("design:paramtypes",[Object]),kc("design:returntype",pE)],C_.prototype,"enableContentInspect",null),bE([HE(),kc("design:type",Function),kc("design:paramtypes",[]),kc("design:returntype",pE)],C_.prototype,"disableContentInspect",null),bE([HE(),kc("design:type",Function),kc("design:paramtypes",[Boolean,Object]),kc("design:returntype",pE)],C_.prototype,"setImageModeration",null),bE([HE({reportResult:!0}),kc("design:type",Function),kc("design:paramtypes",[]),kc("design:returntype",Array)],C_.prototype,"getJoinChannelServiceRecords",null),bE([HE(),kc("design:type",Function),kc("design:paramtypes",[Boolean]),kc("design:returntype",pE)],C_.prototype,"setPublishAudioFilterEnabled",null);class _1{constructor(i,o){_e(this,"id",0),_e(this,"element",void 0),_e(this,"peerPair",void 0),_e(this,"context",void 0),_e(this,"audioPlayerElement",void 0),_e(this,"audioTrack",void 0),_1.count+=1,this.id=_1.count,this.element=i,this.context=o}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=i=>{const o=document.createElement("audio");o.srcObject=new MediaStream([i.track]),o.play(),this.audioPlayerElement=o}}async switchSdp(){if(!this.peerPair)return;const i=async(p,g)=>{const b=g==="offer"?await p.createOffer():await p.createAnswer();return await p.setLocalDescription(b),p.iceGatheringState==="complete"?p.localDescription:new pE(A=>{p.onicegatheringstatechange=()=>{p.iceGatheringState==="complete"&&A(p.localDescription)}})},o=async(p,g)=>await p.setRemoteDescription(g);try{const p=await i(this.peerPair[0],"offer");await o(this.peerPair[1],p);const g=await i(this.peerPair[1],"answer");await o(this.peerPair[0],g)}catch(p){throw new hE(_p.LOCAL_AEC_ERROR,p.toString()).print()}}async getTracksFromMediaElement(i){if(this.audioTrack)return this.audioTrack;let o;try{i instanceof HTMLVideoElement&&(i.captureStream?i.captureStream():i.mozCaptureStream()),o=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(i).connect(o)}catch(g){throw new hE(_p.LOCAL_AEC_ERROR,g.toString()).print()}if(!o)throw new hE(_p.LOCAL_AEC_ERROR,"no dest node when local aec").print();const p=o.stream.getAudioTracks()[0];return this.audioTrack=p,p}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();const i=this.element,o=await this.getTracksFromMediaElement(i);this.peerPair&&this.peerPair[0].addTrack(o),await this.switchSdp()}close(){Gi.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(i=>{i.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}}_e(_1,"count",0);const pnt=window.AudioContext||window.webkitAudioContext;class L8{constructor(){_e(this,"units",[]),_e(this,"context",void 0)}processExternalMediaAEC(i){if(!this._doesEnvironmentNeedAEC())return Gi.debug("the system does not need to process local aec"),-1;this.context||(this.context=new pnt);let o=this.units.find(p=>p&&p.getElement()===i);return o||(o=new _1(i,this.context),this.units.push(o)),o.startEchoCancellation(),Gi.debug("start processing local audio echo cancellation, id is",o.id),o.id}_doesEnvironmentNeedAEC(){return l_().name!==m_.SAFARI}}bE([HE({report:jE}),kc("design:type",Function),kc("design:paramtypes",[HTMLAudioElement]),kc("design:returntype",Number)],L8.prototype,"processExternalMediaAEC",null);const fnt=new L8;function x8(l,i){var o=Object.keys(l);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(l);i&&(p=p.filter(function(g){return Object.getOwnPropertyDescriptor(l,g).enumerable})),o.push.apply(o,p)}return o}function M8(l){for(var i=1;i<arguments.length;i++){var o=arguments[i]!=null?arguments[i]:{};i%2?x8(Object(o),!0).forEach(function(p){_e(l,p,o[p])}):Object.getOwnPropertyDescriptors?Object.defineProperties(l,Object.getOwnPropertyDescriptors(o)):x8(Object(o)).forEach(function(p){Object.defineProperty(l,p,Object.getOwnPropertyDescriptor(o,p))})}return l}const U2=window||document;function U8(l){let i=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!U2)return;const o=f0._cspEventHandlerPointer;if(o&&i)return void console.error(o,i);const p=g=>{if(!(g&&g.blockedURI&&(f0.onSecurityPolicyViolation||f0.getListeners(bT.SECURITY_POLICY_VIOLATION).length>0)))return;const b=g.blockedURI;nE("CSP_DETECTED_HOSTNAME_LIST").some(A=>VE(b).call(b,A))&&(f0.onSecurityPolicyViolation&&typeof f0.onSecurityPolicyViolation=="function"&&f0.onSecurityPolicyViolation(g),f0.getListeners(bT.SECURITY_POLICY_VIOLATION).length>0&&f0.safeEmit(bT.SECURITY_POLICY_VIOLATION,g))};o&&U2.removeEventListener("securitypolicyviolation",o),(i||l&&typeof l=="function"||f0.getListeners(bT.SECURITY_POLICY_VIOLATION).length>0)&&U2.addEventListener("securitypolicyviolation",p),f0._cspEventHandlerPointer=p}y_("PROCESS_ID","process-".concat(T_(8,""),"-").concat(T_(4,""),"-").concat(T_(4,""),"-").concat(T_(4,""),"-").concat(T_(12,""))),function(){const l=l_();G0.getDisplayMedia=function(i){return!!(navigator.mediaDevices&&navigator.mediaDevices.getDisplayMedia)}(),G0.getStreamFromExtension=l.name===m_.CHROME&&Number(l.version)>34,G0.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;const i=new RTCPeerConnection;let o=!1;try{i.addTransceiver("audio"),o=!0}catch{}return i.close(),o}(),G0.supportMinBitrate=l.name===m_.CHROME||l.name===m_.EDGE,G0.supportSetRtpSenderParameters=function(){const i=l_();return!window.RTCRtpSender||!window.RTCRtpSender.prototype.setParameters||!window.RTCRtpSender.prototype.getParameters?!1:!!lR()||!(!H0()&&!cN())||i.name===m_.FIREFOX&&Number(i.version)>=64}(),l.name===m_.SAFARI&&(Number(l.version)>=14?G0.supportDualStream=!0:G0.supportDualStream=!1),G0.webAudioMediaStreamDest=function(){const i=l_();return!(i.name===m_.SAFARI&&Number(i.version)<12)}(),G0.supportReplaceTrack=function(){return window.RTCRtpSender?typeof RTCRtpSender.prototype.replaceTrack=="function":!1}(),G0.supportWebGL=typeof WebGLRenderingContext<"u",G0.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,lR()||(G0.webAudioWithAEC=!0),G0.supportShareAudio=function(){const i=l_();return(i.os===l0.WIN_10||i.os===l0.WIN_81||i.os===l0.WIN_7||i.os===l0.LINUX||i.os===l0.MAC_OS)&&i.name===m_.CHROME&&Number(i.version)>=74}(),G0.supportDataChannel=function(){return!!(xL(76)||function(i){const o=l_();return!(o.name!==m_.FIREFOX||!o.osVersion)&&Number(o.version)>=i}(68)||function(i){const o=l_();return!(o.name!==m_.SAFARI||!o.osVersion)&&Number(o.version)>=i}(14))}(),G0.supportPCSetConfiguration=function(){const i=window.RTCPeerConnection;return!N_()&&!!i&&i.prototype.setConfiguration instanceof Function}(),G0.supportWebRTCEncodedTransform=function(){const i=l_();return i.name==="Chrome"&&Number(i.version)>=86}(),G0.supportWebRTCInsertableStream=function(){const i=l_();return(i.name===m_.CHROME||i.name===m_.EDGE)&&Number(i.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window}(),sT(()=>{G0.supportDualStreamEncoding=function(){const i=l_();return nE("DISABLE_WEBAUDIO")?!0:i.name==="Safari"&&Number(i.version)>=14||!!(i.name==="Chrome"&&/Windows/i.test(i.os||"")&&Number(i.version)>=100&&nE("CHROME_DUAL_STREAM_USE_ENCODING"))}(),Gi.info("browser compatibility",JSON.stringify(G0),JSON.stringify(l))})}(),function(){let l;try{l=window.localStorage.getItem("websdk_ng_global_parameter")}catch(i){return void Gi.error("Error loading sdk config",i.message)}if(l)try{const i=JSON.parse(window.atob(l)),o=Date.now();Gi.debug("Loading global parameters from cache",i),Object.keys(i).forEach(p=>{if(Object.prototype.hasOwnProperty.call($0,p)){const{value:g,expires:b}=i[p];if(b&&b<=o)return;hR[p]=g,$0[p]=g}})}catch(i){Gi.error("Error loading mutableParamsCache: ".concat(l),i.message)}}(),Array.isArray(hR.AREAS)&&hR.AREAS.length>0&&h2(hR.AREAS,!0);const f0=function(l){const i=new D_,o=l,p={getListeners:i.getListeners.bind(i),on:(g,b)=>(function(A,j){A===bT.SECURITY_POLICY_VIOLATION&&U8(j,!0)}(g,b),i.on.bind(i)(g,b)),addListener:i.addListener.bind(i),once:i.once.bind(i),off:i.off.bind(i),removeAllListeners:i.removeAllListeners.bind(i),emit:i.emit.bind(i),safeEmit:i.safeEmit.bind(i)};return M8(M8({},o),p)}({__TRACK_LIST__:QI,VERSION:qS,BUILD:uM,ESM_BUNDLER:!1,ESM:!1,UMD:!0,DEV:!1,setParameter:(l,i,o)=>{Gi.debug("setParameter key:".concat(l,", value:").concat(JSON.stringify(i))),y_(l,i,o)},getParameter:nE,getSupportedCodec:async function(){let l={audio:[],video:[]};try{let i=new RTCPeerConnection;i.addTransceiver("video",{direction:"recvonly"}),i.addTransceiver("audio",{direction:"recvonly"});const o=(await i.createOffer()).sdp;if(!o)return l;i.close(),i=null,l=function(p){const g={video:[],audio:[]};return p.match(/ VP8/i)&&g.video.push("VP8"),p.match(/ VP9/i)&&g.video.push("VP9"),p.match(/ AV1/i)&&g.video.push("AV1"),p.match(/ H264/i)&&g.video.push("H264"),p.match(/ H265/i)&&g.video.push("H265"),p.match(/ opus/i)&&g.audio.push("OPUS"),p.match(/ PCMU/i)&&g.audio.push("PCMU"),p.match(/ PCMA/i)&&g.audio.push("PCMA"),p.match(/ G722/i)&&g.audio.push("G722"),g}(o)}catch(i){throw new hE(_p.CREATE_OFFER_FAILED,i.toString&&i.toString()).print()}return l},checkSystemRequirements:function(){const l=jE.reportApiInvoke(null,{name:e0.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:x_.TRACER});let i=!1;try{const b=window.RTCPeerConnection,A=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,j=window.WebSocket;i=!!(b&&A&&j)}catch(b){return Gi.error("check system requirement failed: ",b),!1}let o=!1;const p=l_();p.name===m_.CHROME&&Number(p.version)>=58&&(!b$()||y$())&&(o=!0),p.name===m_.FIREFOX&&Number(p.version)>=56&&(o=!0),p.name===m_.OPERA&&Number(p.version)>=45&&(o=!0),p.name===m_.SAFARI&&Number(p.version)>=11&&(o=!0),(WV()||l_().name===m_.QQ)&&(o=!0),Gi.debug("checkSystemRequirements, api:",i,"browser",o);const g=i&&o;return l.onSuccess(g),g},getDevices:function(l){return DS.enumerateDevices(!0,!0,l)},getMicrophones:function(l){return DS.getRecordingDevices(l)},getCameras:function(l){return DS.getCamerasDevices(l)},getElectronScreenSources:B6,getPlaybackDevices:function(l){return DS.getSpeakers(l)},createClient:function(){let l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"};const i=jE.reportApiInvoke(null,{name:e0.CREATE_CLIENT,options:[l],tag:x_.TRACER});try{(function(o){d0(o.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),d0(o.mode,"config.mode",["rtc","live"]),o.audioCodec!==void 0&&d0(o.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),o.proxyServer!==void 0&&O0(o.proxyServer,"config.proxyServer",1,1e4),o.turnServer!==void 0&&ZV(o.turnServer),o.httpRetryConfig!==void 0&&$V(o.httpRetryConfig),o.websocketRetryConfig!==void 0&&$V(o.websocketRetryConfig)})(l)}catch(o){throw i.onError(o),o}return hnt()||(l.codec==="vp9"&&(l.codec="vp8",Gi.debug("browser not support vp9, force use vp8")),y_("UNSUPPORTED_VIDEO_CODEC",["vp9"])),l.audioCodec===void 0&&(l.audioCodec="opus"),i.onSuccess(),new C_(v1(v1({forceWaitGatewayResponse:!0},l),{},{role:l.mode==="rtc"?"host":l.role||"audience"}))},createCameraVideoTrack:async function(){let l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const i=jE.reportApiInvoke(null,{tag:x_.TRACER,name:e0.CREATE_CAM_VIDEO_TRACK,options:[BN({},l)]}),o=VN(l),p=T_(8,"track-cam-");let g=null;const b=l.encoderConfig==="720p_auto";Gi.info("start create camera video track with config",JSON.stringify(l),"trackId",p);try{g=(await kS({video:o},p)).getVideoTracks()[0]||null}catch(j){throw i.onError(j),j}if(!g){const j=new yE(_p.UNEXPECTED_ERROR,"can not find track in media stream");return i.onError(j),j.throw(Gi)}l.optimizationMode&&FM(p,g,l,kT(l.encoderConfig));const A=new bR(g,l,o,l.scalabiltyMode?kN(l.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},l.optimizationMode,p);return b&&A.startMonitorStats(),i.onSuccess(A.getTrackId()),Gi.info("create camera video success, trackId:",p),A},createCustomVideoTrack:function(l){const i=jE.reportApiInvoke(null,{tag:x_.TRACER,name:e0.CREATE_CUSTOM_VIDEO_TRACK,options:[l]}),o=new ZE(l.mediaStreamTrack,{width:l.width,height:l.height,frameRate:l.frameRate,bitrateMax:l.bitrateMax,bitrateMin:l.bitrateMin},l.scalabiltyMode?kN(l.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},l.optimizationMode,T_(8,"track-cus-"),[A_.CUSTOM_TRACK]);return i.onSuccess(o.getTrackId()),Gi.info("create custom video track success with config",l,"trackId",o.getTrackId()),o},createScreenVideoTrack:async function(){let l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"disable";const o=jE.reportApiInvoke(null,{tag:x_.TRACER,name:e0.CREATE_SCREEN_VIDEO_TRACK,options:[BN({},l),i]}),p=l.encoderConfig==="720p_auto";l.encoderConfig?typeof l.encoderConfig=="string"||l.encoderConfig.width&&l.encoderConfig.height||(l.encoderConfig.width={max:1920},l.encoderConfig.height={max:1080}):l.encoderConfig="1080p_2";const g=function(Vt){const _r={};Vt.screenSourceType&&(_r.mediaSource=Vt.screenSourceType),Vt.extensionId&&LL()&&(_r.extensionId=Vt.extensionId);const{displaySurface:Fi,selfBrowserSurface:_l,surfaceSwitching:_u,systemAudio:_h}=Vt;(xL(107)||jV(107)||VV(93))&&(Fi&&(d0(Fi,"displaySurface",["browser","window","monitor"]),_r.displaySurface=Fi),_l?(d0(_l,"selfBrowserSurface",["exclude","include"]),_r.selfBrowserSurface=_l):_r.selfBrowserSurface="include",_u&&(d0(_u,"surfaceSwitching",["exclude","include"]),_r.surfaceSwitching=_u)),(xL(105)||jV(105)||VV(91))&&_h&&(d0(_h,"systemAudio",["exclude","include"]),_r.systemAudio=_h),Vt.electronScreenSourceId&&(_r.sourceId=Vt.electronScreenSourceId);const _g=Vt.encoderConfig?TM(Vt.encoderConfig):null;return _r.mandatory={chromeMediaSource:"desktop",maxWidth:_g?_g.width:void 0,maxHeight:_g?_g.height:void 0},_g&&(_g.frameRate&&(typeof _g.frameRate=="number"?(_r.mandatory.maxFrameRate=_g.frameRate,_r.mandatory.minFrameRate=_g.frameRate):(_r.mandatory.maxFrameRate=_g.frameRate.max||_g.frameRate.ideal||_g.frameRate.exact||void 0,_r.mandatory.minFrameRate=_g.frameRate.min||_g.frameRate.ideal||_g.frameRate.exact||void 0),_r.frameRate=_g.frameRate),_g.width&&(_r.width=_g.width),_g.height&&(_r.height=_g.height)),_r}(l),b=T_(8,"track-scr-v-");let A=null,j=null;const H=I_();if(!H.supportShareAudio&&i==="enable"){const Vt=new yE(_p.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return o.onError(Vt),Vt.throw(Gi)}Gi.info("start create screen video track with config",l,"withAudio",i,"trackId",b);try{const Vt=await kS({screen:g,screenAudio:i==="auto"?H.supportShareAudio:i==="enable"},b);A=Vt.getVideoTracks()[0]||null,j=Vt.getAudioTracks()[0]||null}catch(Vt){throw o.onError(Vt),Vt}if(!A){const Vt=new yE(_p.UNEXPECTED_ERROR,"can not find track in media stream");return o.onError(Vt),Vt.throw(Gi)}if(!j&&i==="enable"){A&&A.stop();const Vt=new yE(_p.SHARE_AUDIO_NOT_ALLOWED);return o.onError(Vt),Vt.throw(Gi)}l.optimizationMode||(l.optimizationMode="detail"),l.optimizationMode&&(FM(b,A,l,l.encoderConfig&&TM(l.encoderConfig)||void 0),l.encoderConfig&&typeof l.encoderConfig!="string"&&(l.encoderConfig.bitrateMin=l.encoderConfig.bitrateMax));const z=new ZE(A,l.encoderConfig?TM(l.encoderConfig):{},l.scalabiltyMode?kN(l.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},l.optimizationMode,b,[A_.SCREEN_TRACK]);if(p&&z.startMonitorStats(),!j)return o.onSuccess(z.getTrackId()),Gi.info("create screen video track success","video:",z.getTrackId()),z;const $=new g_(j,void 0,T_(8,"track-scr-a-"),!1,!0);return o.onSuccess([z.getTrackId(),$.getTrackId()]),Gi.info("create screen video track success","video:",z.getTrackId(),"audio:",$.getTrackId()),[z,$]},createMicrophoneAndCameraTracks:async function(){let l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const o=jE.reportApiInvoke(null,{tag:x_.TRACER,name:e0.CREATE_MIC_AND_CAM_TRACKS,options:[l,i]}),p=i.encoderConfig==="720p_auto",g=VN(i),b=Z6(l),A=T_(8,"track-mic-"),j=T_(8,"track-cam-");let H=null,z=null;Gi.info("start create camera video track(".concat(j,") and microphone audio track(").concat(A,") with config, audio: ").concat(JSON.stringify(l),", video: ").concat(JSON.stringify(i)));try{const _r=await kS({audio:b,video:g},"".concat(A,"-").concat(j));H=_r.getAudioTracks()[0],z=_r.getVideoTracks()[0]}catch(_r){throw o.onError(_r),_r}if(!H||!z){const _r=new yE(_p.UNEXPECTED_ERROR,"can not find tracks in media stream");return o.onError(_r),_r.throw(Gi)}i.optimizationMode&&FM(j,z,i,kT(i.encoderConfig));const $=new _R(H,l,b,A),Vt=new bR(z,i,g,i.scalabiltyMode?kN(i.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},i.optimizationMode,j);return p&&Vt.startMonitorStats(),o.onSuccess([$.getTrackId(),Vt.getTrackId()]),Gi.info("create camera video track(".concat(j,") and microphone audio track(").concat(A,") success")),[$,Vt]},createMicrophoneAudioTrack:async function(){let l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const i=jE.reportApiInvoke(null,{tag:x_.TRACER,name:e0.CREATE_MIC_AUDIO_TRACK,options:[l]}),o=Z6(l),p=T_(8,"track-mic-");let g=null;Gi.info("start create microphone audio track with config",JSON.stringify(l),"trackId",p);try{g=(await kS({audio:o},p)).getAudioTracks()[0]||null}catch(A){throw i.onError(A),A}if(!g){const A=new yE(_p.UNEXPECTED_ERROR,"can not find track in media stream");return i.onError(A),A.throw(Gi)}const b=new _R(g,l,o,p);return i.onSuccess(b.getTrackId()),Gi.info("create microphone audio track success, trackId:",p),b},createCustomAudioTrack:function(l){const i=jE.reportApiInvoke(null,{tag:x_.TRACER,name:e0.CREATE_CUSTOM_AUDIO_TRACK,options:[l]}),o=new g_(l.mediaStreamTrack,l.encoderConfig?DN(l.encoderConfig):{},T_(8,"track-cus-"),!1,!0);return Gi.info("create custom audio track success with config",l,"trackId",o.getTrackId()),i.onSuccess(o.getTrackId()),o},createBufferSourceAudioTrack:async function(l){var i;const{cacheOnlineFile:o,encoderConfig:p}=l;let{source:g}=l;const b={source:g instanceof AudioBuffer?"AudioBuffer":g instanceof File?(i=File.name)!==null&&i!==void 0?i:"File":g,cacheOnlineFile:o,encoderConfig:p},A=jE.reportApiInvoke(null,{tag:x_.TRACER,name:e0.CREATE_BUFFER_AUDIO_TRACK,options:[b]});if(nE("DISABLE_WEBAUDIO"))throw new yE(_p.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");const j=T_(8,"track-buf-");Gi.info("start create buffer source audio track with config",JSON.stringify(b),"trackId",j);const H=g;if(!(g instanceof AudioBuffer))try{g=await ott(g,o)}catch(Vt){return A.onError(Vt),Vt.throw(Gi)}const z=new stt(g),$=new yR(H,z,p?DN(p):{},j);return Gi.info("create buffer source audio track success, trackId:",j),A.onSuccess($.getTrackId()),$},setAppType:function(l){if(Gi.debug("setAppType: ".concat(l)),!(Number.isInteger(l)&&l>=0))throw Gi.debug("Invalid appType"),new hE(_p.INVALID_PARAMS,"invalid app type",l);y_("APP_TYPE",Math.floor(l))},setLogLevel:function(l){Gi.setLogLevel(l)},enableLogUpload:function(){nE("USE_NEW_LOG")?y_("UPLOAD_LOG",!0):Gi.enableLogUpload()},disableLogUpload:function(){nE("USE_NEW_LOG")?y_("UPLOAD_LOG",!1):Gi.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new uP},checkAudioTrackIsActive:async function(l){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const o=jE.reportApiInvoke(null,{tag:x_.TRACER,name:e0.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[i]});if(!(l instanceof g_||l instanceof cT)){const H=new hE(_p.INVALID_TRACK,"the parameter is not a audio track");return o.onError(H),H.throw()}i&&i<1e3&&(i=1e3);const p=l instanceof g_?l.getTrackLabel():"remote_track",g=l.getVolumeLevel();let b=g,A=g;const j=Date.now();return new pE(H=>{const z=setInterval(()=>{const $=l.getVolumeLevel();b=$>b?$:b,A=$<A?$:A;const Vt=b-A>1e-4,_r=Date.now()-j;if(Vt||_r>i){clearInterval(z);const Fi=Vt,_l={duration:_r,deviceLabel:p,maxVolumeLevel:b,result:Fi};Gi.info("[track-".concat(l.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(_l))),o.onSuccess(_l),H(Fi)}},200)})},checkVideoTrackIsActive:async function(l){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const o=jE.reportApiInvoke(null,{tag:x_.TRACER,name:e0.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[i]});if(!(l instanceof ZE||l instanceof DT)){const Vt=new hE(_p.INVALID_TRACK,"the parameter is not a video track");return o.onError(Vt),Vt.throw()}i&&i<1e3&&(i=1e3);const p=l instanceof ZE?l.getTrackLabel():"remote_track",g=l.getMediaStreamTrack(!0),b=document.createElement("video");b.style.width="1px",b.style.height="1px",b.setAttribute("muted",""),b.muted=!0,b.setAttribute("playsinline",""),b.controls=!1,(H0()||cN())&&(b.style.opacity="0.01",b.style.position="fixed",b.style.left="0",b.style.top="0",document.body.appendChild(b)),b.srcObject=new MediaStream([g]),b.play();const A=document.createElement("canvas");A.width=160,A.height=120;let j=0,H=0;try{const Vt=Date.now();j=await function(_r,Fi,_l,_u){let _h,_g=0,eE=null;return new pE((oE,SE)=>{function vE(){_g>_u&&_h&&(_h(),oE(_g));const fE=_l.getContext("2d");if(!fE){const PE=new hE(_p.UNEXPECTED_ERROR,"can not get canvas 2d context.");return Gi.error(PE.toString()),void SE(PE)}fE.drawImage(_r,0,0,160,120);const mE=fE.getImageData(0,0,_l.width,_l.height),EE=Math.floor(mE.data.length/3);if(eE){for(let PE=0;PE<EE;PE+=3)if(mE.data[PE]!==eE[PE])return _g+=1,void(eE=mE.data);eE=mE.data}else eE=mE.data}setTimeout(()=>{_h&&(_h(),oE(_g))},Fi),_h=OM(()=>{vE()},30)})}(b,i,A,4),H=Date.now()-Vt}catch(Vt){throw o.onError(Vt),Vt}dnt===m_.SAFARI&&(b.pause(),b.remove()),b.srcObject=null;const z=j>4,$={duration:H,changedPicNum:j,deviceLabel:p,result:z};return Gi.info("[track-".concat(l.getTrackId(),"] check video track active completed. ").concat(JSON.stringify($))),o.onSuccess($),z},setArea:h2,audioElementPlayCenter:vS,processExternalMediaAEC:function(l){fnt.processExternalMediaAEC(l)},registerExtensions:function(l){l.forEach(i=>{const o=i;o.__registered__=!0,o.logger.hookLog=Gi.extLog,o.reporter.hookApiInvoke=jE.extApiInvoke,o.parameters&&Object.keys(o.parameters).forEach(p=>{o.parameters[p]=nE(p)})})},ChannelMediaRelayError:mR,ChannelMediaRelayEvent:_T,ChannelMediaRelayState:Z0,RemoteStreamFallbackType:CM,RemoteStreamType:LN,ConnectionDisconnectedReason:e_,AudienceLatencyLevelType:jL,AREAS:c_});return Object.defineProperties(f0,{onAudioAutoplayFailed:{get:()=>LS.onAudioAutoplayFailed,set:l=>{LS.onAudioAutoplayFailed=l}},onAutoplayFailed:{get:()=>LS.onAutoplayFailed,set:l=>{LS.onAutoplayFailed=l}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>f0._onSecurityPolicyViolation,set(l){f0._onSecurityPolicyViolation=l,U8(l)}},__CLIENT_LIST__:{get:()=>nE("SHOW_GLOBAL_CLIENT_LIST")?pR:[]}}),DS.on(XT.CAMERA_DEVICE_CHANGED,l=>{Gi.info("camera device changed",JSON.stringify(l)),f0.onCameraChanged&&f0.onCameraChanged(l),f0.safeEmit(bT.CAMERA_CHANGED,l)}),DS.on(XT.RECORDING_DEVICE_CHANGED,l=>{Gi.info("microphone device changed",JSON.stringify(l)),f0.onMicrophoneChanged&&f0.onMicrophoneChanged(l),f0.safeEmit(bT.MICROPHONE_CHANGED,l)}),DS.on(XT.PLAYOUT_DEVICE_CHANGED,l=>{Gi.debug("playout device changed",JSON.stringify(l)),f0.onPlaybackDeviceChanged&&f0.onPlaybackDeviceChanged(l),f0.safeEmit(bT.PLAYBACK_DEVICE_CHANGED,l)}),vS.onAutoplayFailed=()=>{Gi.info("detect audio element autoplay failed"),LS.onAudioAutoplayFailed&&LS.onAudioAutoplayFailed()},__.on("autoplay-failed",()=>{Gi.info("detect webaudio autoplay failed"),LS.onAudioAutoplayFailed&&LS.onAudioAutoplayFailed(),f0.safeEmit(bT.AUTOPLAY_FAILED)}),X_.on(YT.NETWORK_STATE_CHANGE,(l,i)=>{Gi.info("[network-indicator] network state changed, ".concat(i," => ").concat(l))}),window&&(window.__ARTC__=f0),f0})})(AgoraRTC_NProduction);var AgoraRTC_NProductionExports=AgoraRTC_NProduction.exports;const AgoraRTC__default=getDefaultExportFromCjs(AgoraRTC_NProductionExports);function _objectWithoutPropertiesLoose(e,r){if(e==null)return{};var s={},d=Object.keys(e),f,_;for(_=0;_<d.length;_++)f=d[_],!(r.indexOf(f)>=0)&&(s[f]=e[f]);return s}var AgoraRTCErrorCode;(function(e){e.UNEXPECTED_ERROR="UNEXPECTED_ERROR",e.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",e.TIMEOUT="TIMEOUT",e.INVALID_PARAMS="INVALID_PARAMS",e.NOT_SUPPORTED="NOT_SUPPORTED",e.INVALID_OPERATION="INVALID_OPERATION",e.OPERATION_ABORTED="OPERATION_ABORTED",e.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",e.NETWORK_ERROR="NETWORK_ERROR",e.NETWORK_TIMEOUT="NETWORK_TIMEOUT",e.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",e.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",e.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",e.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",e.ELECTRON_IS_NULL="ELECTRON_IS_NULL",e.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",e.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",e.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",e.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",e.PERMISSION_DENIED="PERMISSION_DENIED",e.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",e.TRACK_IS_DISABLED="TRACK_IS_DISABLED",e.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",e.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",e.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",e.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",e.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",e.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",e.UID_CONFLICT="UID_CONFLICT",e.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",e.INVALID_TRACK="INVALID_TRACK",e.SENDER_NOT_FOUND="SENDER_NOT_FOUND",e.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",e.SET_ANSWER_FAILED="SET_ANSWER_FAILED",e.ICE_FAILED="ICE_FAILED",e.PC_CLOSED="PC_CLOSED",e.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",e.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",e.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",e.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",e.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",e.INVALID_REMOTE_USER="INVALID_REMOTE_USER",e.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",e.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",e.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",e.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",e.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",e.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",e.WS_ABORT="WS_ABORT",e.WS_DISCONNECT="WS_DISCONNECT",e.WS_ERR="WS_ERR",e.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",e.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",e.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",e.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",e.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",e.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",e.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",e.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",e.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",e.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",e.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",e.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",e.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",e.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",e.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",e.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",e.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",e.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE"})(AgoraRTCErrorCode||(AgoraRTCErrorCode={}));var createClient=function e(r){var s;function d(){return s||(s=AgoraRTC__default.createClient(r)),s}return function(){return d()}};function createMicrophoneAndCameraTracks(e,r){var s=function(){try{return Promise.resolve(AgoraRTC__default.createMicrophoneAndCameraTracks(e,r)).then(function(_){return d=_,d})}catch(_){return Promise.reject(_)}},d=null;return function(){var _=reactExports.useState(!1),C=_[0],P=_[1],x=reactExports.useState(null),B=x[0],_t=x[1],ue=reactExports.useRef(d);return reactExports.useEffect(function(){return ue.current===null?s().then(function(Wt){ue.current=Wt,P(!0)},function(Wt){_t(Wt)}):P(!0),function(){d=null}},[]),{ready:C,tracks:ue.current,error:B}}}var AgoraVideoPlayer=function e(r){var s=reactExports.useRef(null),d=r.videoTrack,f=r.config,_=_objectWithoutPropertiesLoose(r,["videoTrack","config"]);return reactExports.useLayoutEffect(function(){return s.current!==null&&d.play(s.current,f),function(){d.stop()}},[d]),React.createElement("div",Object.assign({},_,{ref:s}))},agoraRtmSdk={exports:{}};/*
 @preserve
 AgoraRTM Web SDK 1.4.3-203 - commit: v1.4.3-17-g1e27aa38
 Copyright (C) 2018-2021 Agora Lab.
 This file is licensed under the AGORA, INC. SDK LICENSE AGREEMENT
 A copy of this license may be found at https://www.agora.io/en/sdk-license-agreement/
*/agoraRtmSdk.exports;(function(module,exports){(function(e,r){module.exports=r()})(commonjsGlobal,function(){function be(e,r){var s=Object.keys(e);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(e);r&&(d=d.filter(function(f){return Object.getOwnPropertyDescriptor(e,f).enumerable})),s.push.apply(s,d)}return s}function ua(e){for(var r=1;r<arguments.length;r++){var s=arguments[r]!=null?arguments[r]:{};r%2?be(Object(s),!0).forEach(function(d){m(e,d,s[d])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(s)):be(Object(s)).forEach(function(d){Object.defineProperty(e,d,Object.getOwnPropertyDescriptor(s,d))})}return e}function X(e){return(X=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r})(e)}function sl(e,r,s,d,f,_,C){try{var P=e[_](C),x=P.value}catch(B){return void s(B)}P.done?r(x):Promise.resolve(x).then(d,f)}function J(e){return function(){var r=this,s=arguments;return new Promise(function(d,f){function _(x){sl(P,d,f,_,C,"next",x)}function C(x){sl(P,d,f,_,C,"throw",x)}var P=e.apply(r,s);_(void 0)})}}function W(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function tl(e,r){for(var s=0;s<r.length;s++){var d=r[s];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(e,d.key,d)}}function Ha(e,r,s){return r&&tl(e.prototype,r),s&&tl(e,s),e}function m(e,r,s){return r in e?Object.defineProperty(e,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[r]=s,e}function la(e,r){if(typeof r!="function"&&r!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(r&&r.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),r&&df(e,r)}function wd(e){return(wd=Object.setPrototypeOf?Object.getPrototypeOf:function(r){return r.__proto__||Object.getPrototypeOf(r)})(e)}function df(e,r){return(df=Object.setPrototypeOf||function(s,d){return s.__proto__=d,s})(e,r)}function ul(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function Sh(e,r,s){return(Sh=ul()?Reflect.construct:function(d,f,_){var C=[null];return C.push.apply(C,f),d=new(Function.bind.apply(d,C)),_&&df(d,_.prototype),d}).apply(null,arguments)}function ef(e){var r=typeof Map=="function"?new Map:void 0;return(ef=function(s){function d(){return Sh(s,arguments,wd(this).constructor)}if(s===null||Function.toString.call(s).indexOf("[native code]")===-1)return s;if(typeof s!="function")throw new TypeError("Super expression must either be null or a function");if(r!==void 0){if(r.has(s))return r.get(s);r.set(s,d)}return d.prototype=Object.create(s.prototype,{constructor:{value:d,enumerable:!1,writable:!0,configurable:!0}}),df(d,s)})(e)}function ff(e,r){if(e==null)return{};if(e==null)var s={};else{s={};var d,f=Object.keys(e);for(d=0;d<f.length;d++){var _=f[d];0<=r.indexOf(_)||(s[_]=e[_])}}if(Object.getOwnPropertySymbols)for(d=Object.getOwnPropertySymbols(e),_=0;_<d.length;_++)f=d[_],0<=r.indexOf(f)||Object.prototype.propertyIsEnumerable.call(e,f)&&(s[f]=e[f]);return s}function n(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ma(e){var r=ul();return function(){var s=wd(e);if(r){var d=wd(this).constructor;s=Reflect.construct(s,arguments,d)}else s=s.apply(this,arguments);return s=!s||typeof s!="object"&&typeof s!="function"?n(this):s}}function Th(e,r,s){return(Th=typeof Reflect<"u"&&Reflect.get?Reflect.get:function(d,f,_){for(;!Object.prototype.hasOwnProperty.call(d,f)&&(d=wd(d))!==null;);if(d)return(f=Object.getOwnPropertyDescriptor(d,f)).get?f.get.call(_):f.value})(e,r,s||e)}function ra(e,r){var s=Array.isArray(e)?e:void 0;if(!s)if((s=e&&(typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"]))==null)s=void 0;else{var d,f=[],_=!0,C=!1;try{for(s=s.call(e);!(_=(d=s.next()).done)&&(f.push(d.value),!r||f.length!==r);_=!0);}catch(x){C=!0;var P=x}finally{try{_||s.return==null||s.return()}finally{if(C)throw P}}s=f}if(!(e=s||vl(e,r)))throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`);return e}function G(e){var r=Array.isArray(e)?Uh(e):void 0;if(r||(r=typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null?Array.from(e):void 0),!(e=r||vl(e)))throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`);return e}function vl(e,r){if(e){if(typeof e=="string")return Uh(e,r);var s=Object.prototype.toString.call(e).slice(8,-1);if(s==="Object"&&e.constructor&&(s=e.constructor.name),s==="Map"||s==="Set")return Array.from(e);if(s==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s))return Uh(e,r)}}function Uh(e,r){(r==null||r>e.length)&&(r=e.length);for(var s=0,d=Array(r);s<r;s++)d[s]=e[s];return d}function fa(e,r,s,d,f){var _={};return Object.keys(d).forEach(function(C){_[C]=d[C]}),_.enumerable=!!_.enumerable,_.configurable=!!_.configurable,("value"in _||_.initializer)&&(_.writable=!0),_=s.slice().reverse().reduce(function(C,P){return P(e,r,C)||C},_),f&&_.initializer!==void 0&&(_.value=_.initializer?_.initializer.call(f):void 0,_.initializer=void 0),_.initializer===void 0&&(Object.defineProperty(e,r,_),_=null),_}function $a(e){var r={exports:{}};return e(r,r.exports),r.exports}function wl(e,r){var s,d=3>arguments.length?e:arguments[2];return va(e)===d?e[r]:(s=Fb.f(e,r))?Q(s,"value")?s.value:s.get===void 0?void 0:s.get.call(d):ha(s=Vb(e))?wl(s,r,d):void 0}function rs(e){var r=e.charCodeAt(0)<<24,s=0|ss(~r),d=0,f=0|e.length,_="";if(5>s&&f>=s){for(r=r<<s>>>24+s,d=1;d<s;d=d+1|0)r=r<<6|63&e.charCodeAt(d);65535>=r?_+=xd(r):1114111>=r?_+=xd(55296+((r=r-65536|0)>>10)|0,56320+(1023&r)|0):d=0}for(;d<f;d=d+1|0)_+="ï¿½";return _}function xl(){}function ts(e){var r=0|e.charCodeAt(0);if(55296<=r&&56319>=r){var s=0|e.charCodeAt(1);if(!(s==s&&56320<=s&&57343>=s))return xd(239,191,189);if(65535<(r=(r-55296<<10)+s-56320+65536|0))return xd(240|r>>>18,128|r>>>12&63,128|r>>>6&63,128|63&r)}return 127>=r?e:2047>=r?xd(192|r>>>6,128|63&r):xd(224|r>>>12,128|r>>>6&63,128|63&r)}function yl(){}function ea(){ea.init.call(this)}function ng(e){if(typeof e!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+X(e))}function zl(e,r,s,d){ng(s);var f=e._events;if(f===void 0)f=e._events=Object.create(null),e._eventsCount=0;else{f.newListener!==void 0&&(e.emit("newListener",r,s.listener?s.listener:s),f=e._events);var _=f[r]}return _===void 0?(f[r]=s,++e._eventsCount):(typeof _=="function"?_=f[r]=d?[s,_]:[_,s]:d?_.unshift(s):_.push(s),0<(s=e._maxListeners===void 0?ea.defaultMaxListeners:e._maxListeners)&&_.length>s&&!_.warned&&(_.warned=!0,(s=Error("Possible EventEmitter memory leak detected. "+_.length+" "+String(r)+" listeners added. Use emitter.setMaxListeners() to increase limit")).name="MaxListenersExceededWarning",s.emitter=e,s.type=r,s.count=_.length,console&&console.warn&&console.warn(s))),e}function us(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Al(e,r,s){return e={fired:!1,wrapFn:void 0,target:e,type:r,listener:s},(r=us.bind(e)).listener=s,e.wrapFn=r}function Bl(e,r,s){if((e=e._events)===void 0)return[];if((r=e[r])===void 0)return[];if(typeof r=="function")return s?[r.listener||r]:[r];if(s)for(s=Array(r.length),e=0;e<s.length;++e)s[e]=r[e].listener||r[e];else s=Cl(r,r.length);return s}function Dl(e){var r=this._events;if(r!==void 0){if(typeof(e=r[e])=="function")return 1;if(e!==void 0)return e.length}return 0}function Cl(e,r){for(var s=Array(r),d=0;d<r;++d)s[d]=e[d];return s}function vs(e,r,s){typeof e.on=="function"&&El(e,"error",r,s)}function El(e,r,s,d){if(typeof e.on=="function")d.once?e.once(r,s):e.on(r,s);else{if(typeof e.addEventListener!="function")throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+X(e));e.addEventListener(r,function f(_){d.once&&e.removeEventListener(r,f),s(_)})}}function ws(e){return e?G(e):xs(function(){return[]},function(r,s){return r.push(s),r})}function Fl(e,r){var s,d,f,_;return w.wrap(function(C){for(;;)switch(C.prev=C.next){case 0:s=Gl(e)([Hl,Hl,function(P,x){return x}])[2],d=0;case 2:if(!(d<r.length)){C.next=17;break}if(f=r[d],!((_=s(Vh,f))instanceof og)){C.next=11;break}if((_=Wh(_.deref()))===Vh){C.next=10;break}return C.next=10,_;case 10:return C.abrupt("return");case 11:if(_===Vh){C.next=14;break}return C.next=14,_;case 14:d++,C.next=2;break;case 17:case"end":return C.stop()}},ys)}function pg(e,r){return r!=null&&typeof r[Symbol.iterator]=="function"?Fl(pg(e),r):function(s){var d=s[2];return zs(s,function(f,_){return d(f,e(_))})}}function Ac(e){return Object.prototype.toString.call(e).slice(8,-1)}function yd(e){return Ac(e)==="Object"&&e.constructor===Object&&Object.getPrototypeOf(e)===Object.prototype}function Il(e){var r;return(r=Ac(e)==="Boolean"||Ac(e)==="Null"||Ac(e)==="Undefined")||(r=Ac(e)==="Number"&&!isNaN(e)),r||Ac(e)==="String"||Ac(e)==="Symbol"}function zd(e){var r=-1,s=e==null?0:e.length;for(this.clear();++r<s;){var d=e[r];this.set(d[0],d[1])}}function ce(e){var r=-1,s=e==null?0:e.length;for(this.clear();++r<s;){var d=e[r];this.set(d[0],d[1])}}function de(e){var r=-1,s=e==null?0:e.length;for(this.clear();++r<s;){var d=e[r];this.set(d[0],d[1])}}function gf(e){var r=-1,s=e==null?0:e.length;for(this.__data__=new qg;++r<s;)this.add(e[r])}function ee(e){this.size=(this.__data__=new rg(e)).size}function fe(e,r,s,d,f,_){var C,P=1&r,x=2&r,B=4&r;if(s&&(C=f?s(e,d,f,_):s(e)),C!==void 0)return C;if(!lb(e))return e;if(d=Va(e)){if(C=As(e),!P)return Xh(e,C)}else{var _t=hf(e),ue=_t=="[object Function]"||_t=="[object GeneratorFunction]";if(jf(e))return Jl(e,P);if(_t=="[object Object]"||_t=="[object Arguments]"||ue&&!f){if(C=x||ue?{}:Kl(e),!P)return x?Bs(e,Cs(C,e)):Ds(e,Es(C,e))}else{if(!wa[_t])return f?e:{};C=Fs(e,_t,P)}}if(_||(_=new ge),f=_.get(e))return f;_.set(e,C),Gs(e)?e.forEach(function(_n){C.add(fe(_n,r,s,_n,e,_))}):Hs(e)&&e.forEach(function(_n,_i){C.set(_i,fe(_n,r,s,_i,e,_))}),x=B?x?Ll:Yh:x?kf:Ad;var Wt=d?void 0:x(e);return Is(Wt||e,function(_n,_i){Wt&&(_n=e[_i=_n]),Ml(C,_i,fe(_n,r,s,_i,e,_))}),C}function Zh(e,r){if(typeof e!="function"||r!=null&&typeof r!="function")throw new TypeError("Expected a function");var s=function d(){var f=arguments,_=r?r.apply(this,f):f[0],C=d.cache;return C.has(_)?C.get(_):(f=e.apply(this,f),d.cache=C.set(_,f)||C,f)};return s.cache=new(Zh.Cache||qg),s}function Nl(e){if(typeof e=="string")return e;if(Va(e))return he(e,Nl)+"";if(ie(e))return Ol?Ol.call(e):"";var r=e+"";return r=="0"&&1/e==-Js?"-0":r}function $h(e,r,s,d,f){var _=-1,C=e.length;for(s||(s=Ks),f||(f=[]);++_<C;){var P=e[_];0<r&&s(P)?1<r?$h(P,r-1,s,d,f):ai(f,P):d||(f[f.length]=P)}return f}function je(e,r,s,d,f){if(e===r)r=!0;else if(e==null||r==null||!gc(e)&&!gc(r))r=e!=e&&r!=r;else t:{var _=Va(e),C=Va(r),P=_?"[object Array]":hf(e),x=C?"[object Array]":hf(r),B=(P=P=="[object Arguments]"?"[object Object]":P)=="[object Object]";if(C=(x=x=="[object Arguments]"?"[object Object]":x)=="[object Object]",(x=P==x)&&jf(e)){if(!jf(r)){r=!1;break t}_=!0,B=!1}if(x&&!B)f||(f=new ge),r=_||bi(e)?Pl(e,r,s,d,je,f):Ls(e,r,P,s,d,je,f);else{if(!(1&s)&&(_=B&&Ql.call(e,"__wrapped__"),P=C&&Ql.call(r,"__wrapped__"),_||P)){e=_?e.value():e,r=P?r.value():r,f||(f=new ge),r=je(e,r,s,d,f);break t}if(x)e:if(f||(f=new ge),_=1&s,P=Yh(e),C=P.length,x=Yh(r).length,C==x||_){for(x=C;x--;){var _t=P[x];if(!(_?_t in r:Ms.call(r,_t))){r=!1;break e}}if(B=f.get(e),_t=f.get(r),B&&_t)r=B==r&&_t==e;else{B=!0,f.set(e,r),f.set(r,e);for(var ue=_;++x<C;){var Wt=e[_t=P[x]],_n=r[_t];if(d)var _i=_?d(_n,Wt,_t,r,e,f):d(Wt,_n,_t,e,r,f);if(_i===void 0?Wt!==_n&&!je(Wt,_n,s,d,f):!_i){B=!1;break}ue||(ue=_t=="constructor")}B&&!ue&&(s=e.constructor)!=(d=r.constructor)&&"constructor"in e&&"constructor"in r&&!(typeof s=="function"&&s instanceof s&&typeof d=="function"&&d instanceof d)&&(B=!1),f.delete(e),f.delete(r),r=B}}else r=!1;else r=!1}}return r}function xa(e,r,s){this.low=0|e,this.high=0|r,this.unsigned=!!s}function mb(e){return(e&&e.__isLong__)===!0}function Bd(e,r){var s;if(r){if((r=0<=(e>>>=0)&&256>e)&&(s=Rl[e]))return s;s=ya(e,0>(0|e)?-1:0,!0),r&&(Rl[e]=s)}else{if((r=-128<=(e|=0)&&128>e)&&(s=Sl[e]))return s;s=ya(e,0>e?-1:0,!1),r&&(Sl[e]=s)}return s}function Gb(e,r){if(isNaN(e))return r?Cd:Hb;if(r){if(0>e)return Cd;if(e>=Tl)return Ul}else{if(e<=-Vl)return nb;if(e+1>=Vl)return Wl}return 0>e?Gb(-e,r).neg():ya(e%ke|0,e/ke|0,r)}function ya(e,r,s){return new xa(e,r,s)}function ci(e,r,s){if(e.length===0)throw Error("empty string");if(e==="NaN"||e==="Infinity"||e==="+Infinity"||e==="-Infinity")return Hb;if(typeof r=="number"?(s=r,r=!1):r=!!r,2>(s=s||10)||36<s)throw RangeError("radix");var d;if(0<(d=e.indexOf("-")))throw Error("interior hyphen");if(d===0)return ci(e.substring(1),r,s).neg();d=Gb(sg(s,8));for(var f=Hb,_=0;_<e.length;_+=8){var C=Math.min(8,e.length-_),P=parseInt(e.substring(_,_+C),s);8>C?(C=Gb(sg(s,C)),f=f.mul(C).add(Gb(P))):f=(f=f.mul(d)).add(Gb(P))}return f.unsigned=r,f}function Wb(e,r){return typeof e=="number"?Gb(e,r):typeof e=="string"?ci(e,r):ya(e.low,e.high,typeof r=="boolean"?r:e.unsigned)}function O(e,r){function s(){this.constructor=e}di(e,r),e.prototype=r===null?Object.create(r):(s.prototype=r.prototype,new s)}function le(e){return typeof e=="function"}function me(e){setTimeout(function(){throw e},0)}function ei(e){return e!==null&&X(e)==="object"}function Xl(e){return e.reduce(function(r,s){return r.concat(s instanceof lf?s.errors:s)},[])}function fi(e){for(;e;){var r=e.destination,s=e.isStopped;if(e.closed||s)return!1;e=r&&r instanceof ia?r:null}return!0}function Yc(e){return e}function gi(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return Yl(e)}function Yl(e){return e.length===0?Yc:e.length===1?e[0]:function(r){return e.reduce(function(s,d){return d(s)},r)}}function Zl(e){if(e||(e=Ib.Promise||Promise),!e)throw Error("no Promise impl found");return e}function $l(){return function(e){return e.lift(new Ns(e))}}function mf(e){return e?Os(e):vb}function Os(e){return new Y(function(r){return e.schedule(function(){return r.complete()})})}function Zc(e){return e&&typeof e.schedule=="function"}function hi(e,r){return new Y(function(s){var d=new Oa,f=0;return d.add(r.schedule(function(){f===e.length?s.complete():(s.next(e[f++]),s.closed||d.add(this.schedule()))})),d})}function nf(e,r){return r?hi(e,r):new Y(am(e))}function bb(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return Zc(r=e[e.length-1])?(e.pop(),hi(e,r)):nf(e)}function Z(e,r){return new Y(r?function(s){return r.schedule(Ps,0,{error:e,subscriber:s})}:function(s){return s.error(e)})}function Ps(e){e.subscriber.error(e.error)}function Qs(e,r){return r===void 0&&(r=0),function(s){return s.lift(new Rs(e,r))}}function bm(e){return e in ii&&(delete ii[e],!0)}function hc(){}function ba(e,r){return function(s){if(typeof e!="function")throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return s.lift(new Ss(e,r))}}function cm(e,r,s){if(r){if(!Zc(r))return function(){for(var d=[],f=0;f<arguments.length;f++)d[f]=arguments[f];return cm(e,s).apply(void 0,d).pipe(ba(function(_){return Jb(_)?r.apply(void 0,_):r(_)}))};s=r}return function(){for(var d=[],f=0;f<arguments.length;f++)d[f]=arguments[f];var _,C=this,P={context:C,subject:_,callbackFunc:e,scheduler:s};return new Y(function(x){if(s)return s.schedule(Ts,0,{args:d,subscriber:x,params:P});if(!_){_=new of;try{e.apply(C,d.concat([function(){for(var B=[],_t=0;_t<arguments.length;_t++)B[_t]=arguments[_t];_.next(1>=B.length?B[0]:B),_.complete()}]))}catch(B){fi(_)?_.error(B):console.warn(B)}}return _.subscribe(x)})}}function Ts(e){var r=this,s=e.args,d=e.subscriber,f=e.params;e=f.callbackFunc;var _=f.context,C=f.scheduler,P=f.subject;if(!P){P=f.subject=new of,f=function(){for(var x=[],B=0;B<arguments.length;B++)x[B]=arguments[B];r.add(C.schedule(Us,0,{value:1>=x.length?x[0]:x,subject:P}))};try{e.apply(_,s.concat([f]))}catch(x){P.error(x)}}this.add(P.subscribe(d))}function Us(e){var r=e.subject;r.next(e.value),r.complete()}function dm(e,r,s){if(r){if(!Zc(r))return function(){for(var d=[],f=0;f<arguments.length;f++)d[f]=arguments[f];return dm(e,s).apply(void 0,d).pipe(ba(function(_){return Jb(_)?r.apply(void 0,_):r(_)}))};s=r}return function(){for(var d=[],f=0;f<arguments.length;f++)d[f]=arguments[f];var _={subject:void 0,args:d,callbackFunc:e,scheduler:s,context:this};return new Y(function(C){var P=_.context,x=_.subject;if(s)return s.schedule(Vs,0,{params:_,subscriber:C,context:P});if(!x){x=_.subject=new of;try{e.apply(P,d.concat([function(){for(var B=[],_t=0;_t<arguments.length;_t++)B[_t]=arguments[_t];(_t=B.shift())?x.error(_t):(x.next(1>=B.length?B[0]:B),x.complete())}]))}catch(B){fi(x)?x.error(B):console.warn(B)}}return x.subscribe(C)})}}function Vs(e){var r=this,s=e.params,d=e.subscriber;e=e.context;var f=s.callbackFunc,_=s.args,C=s.scheduler,P=s.subject;if(!P){P=s.subject=new of,s=function(){for(var x=[],B=0;B<arguments.length;B++)x[B]=arguments[B];(B=x.shift())?r.add(C.schedule(em,0,{err:B,subject:P})):r.add(C.schedule(Ws,0,{value:1>=x.length?x[0]:x,subject:P}))};try{f.apply(e,_.concat([s]))}catch(x){this.add(C.schedule(em,0,{err:x,subject:P}))}}this.add(P.subscribe(d))}function Ws(e){var r=e.subject;r.next(e.value),r.complete()}function em(e){e.subject.error(e.err)}function fm(e){return!!e&&typeof e.subscribe!="function"&&typeof e.then=="function"}function ji(e,r,s,d,f){if(f===void 0&&(f=new Xs(e,s,d)),!f.closed)return r instanceof Y?r.subscribe(f):pf(r)(f)}function Ys(e,r){return new Y(function(s){var d=new Oa;return d.add(r.schedule(function(){var f=e[ne]();d.add(f.subscribe({next:function(_){d.add(r.schedule(function(){return s.next(_)}))},error:function(_){d.add(r.schedule(function(){return s.error(_)}))},complete:function(){d.add(r.schedule(function(){return s.complete()}))}}))})),d})}function Zs(e,r){return new Y(function(s){var d=new Oa;return d.add(r.schedule(function(){return e.then(function(f){d.add(r.schedule(function(){s.next(f),d.add(r.schedule(function(){return s.complete()}))}))},function(f){d.add(r.schedule(function(){return s.error(f)}))})})),d})}function $s(e,r){if(!e)throw Error("Iterable cannot be null");return new Y(function(s){var d,f=new Oa;return f.add(function(){d&&typeof d.return=="function"&&d.return()}),f.add(r.schedule(function(){d=e[$c](),f.add(r.schedule(function(){if(!s.closed){try{var _=d.next(),C=_.value,P=_.done}catch(x){return void s.error(x)}P?s.complete():(s.next(C),this.schedule())}}))})),f})}function gm(e,r){if(e!=null){if(e&&typeof e[ne]=="function")return Ys(e,r);if(fm(e))return Zs(e,r);if(hm(e))return hi(e,r);if(e&&typeof e[$c]=="function"||typeof e=="string")return $s(e,r)}throw new TypeError((e!==null&&X(e)||e)+" is not observable")}function Kb(e,r){return r?gm(e,r):e instanceof Y?e:new Y(pf(e))}function ic(e,r){if(!r.closed){if(e instanceof Y)return e.subscribe(r);try{var s=pf(e)(r)}catch(d){r.error(d)}return s}}function cb(e,r,s){return s===void 0&&(s=Number.POSITIVE_INFINITY),typeof r=="function"?function(d){return d.pipe(cb(function(f,_){return Kb(e(f,_)).pipe(ba(function(C,P){return r(f,C,_,P)}))},s))}:(typeof r=="number"&&(s=r),function(d){return d.lift(new at(e,s))})}function tg(e){return e===void 0&&(e=Number.POSITIVE_INFINITY),cb(Yc,e)}function im(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return tg(1)(bb.apply(void 0,e))}function ad(e){return new Y(function(r){try{var s=e()}catch(d){return void r.error(d)}return(s?Kb(s):mf()).subscribe(r)})}function jm(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];if(e.length===1){var s=e[0];if(Jb(s))return ug(s,null);if(ei(s)&&Object.getPrototypeOf(s)===Object.prototype)return ug((e=Object.keys(s)).map(function(f){return s[f]}),e)}if(typeof e[e.length-1]=="function"){var d=e.pop();return ug(e=e.length===1&&Jb(e[0])?e[0]:e,null).pipe(ba(function(f){return d.apply(void 0,f)}))}return ug(e,null)}function ug(e,r){return new Y(function(s){var d=e.length;if(d===0)s.complete();else for(var f=Array(d),_=0,C=0,P=function(B){var _t=Kb(e[B]),ue=!1;s.add(_t.subscribe({next:function(Wt){ue||(ue=!0,C++),f[B]=Wt},error:function(Wt){return s.error(Wt)},complete:function(){++_!==d&&ue||(C===d&&s.next(r?r.reduce(function(Wt,_n,_i){return Wt[_n]=f[_i],Wt},{}):f),s.complete())}}))},x=0;x<d;x++)P(x)})}function gb(e,r,s,d){return le(s)&&(d=s,s=void 0),d?gb(e,r,s).pipe(ba(function(f){return Jb(f)?d.apply(void 0,f):d(f)})):new Y(function(f){km(e,r,function(_){1<arguments.length?f.next(Array.prototype.slice.call(arguments)):f.next(_)},f,s)})}function km(e,r,s,d,f){if(e&&typeof e.addEventListener=="function"&&typeof e.removeEventListener=="function"){e.addEventListener(r,s,f);var _=function(){return e.removeEventListener(r,s,f)}}else if(e&&typeof e.on=="function"&&typeof e.off=="function")e.on(r,s),_=function(){return e.off(r,s)};else if(e&&typeof e.addListener=="function"&&typeof e.removeListener=="function")e.addListener(r,s),_=function(){return e.removeListener(r,s)};else{if(!e||!e.length)throw new TypeError("Invalid event target");for(var C=0,P=e.length;C<P;C++)km(e[C],r,s,d,f)}d.add(_)}function lm(e,r,s){return s?lm(e,r).pipe(ba(function(d){return Jb(d)?s.apply(void 0,d):s(d)})):new Y(function(d){var f=function(){for(var C=[],P=0;P<arguments.length;P++)C[P]=arguments[P];return d.next(C.length===1?C[0]:C)};try{var _=e(f)}catch(C){return void d.error(C)}if(le(r))return function(){return r(f,_)}})}function bt(e){var r=e.subscriber,s=e.condition;if(!r.closed){if(e.needIterate)try{e.state=e.iterate(e.state)}catch(_){return void r.error(_)}else e.needIterate=!0;if(s){var d=void 0;try{d=s(e.state)}catch(_){return void r.error(_)}if(!d)return void r.complete();if(r.closed)return}try{var f=e.resultSelector(e.state)}catch(_){return void r.error(_)}if(!r.closed&&(r.next(f),!r.closed))return this.schedule(e)}}function ki(e){return!Jb(e)&&0<=e-parseFloat(e)+1}function mm(e,r){return e===void 0&&(e=0),r===void 0&&(r=bd),(!ki(e)||0>e)&&(e=0),r&&typeof r.schedule=="function"||(r=bd),new Y(function(s){return s.add(r.schedule(ct,e,{subscriber:s,counter:0,period:e})),s})}function ct(e){var r=e.subscriber,s=e.counter;e=e.period,r.next(s),this.schedule({subscriber:r,counter:s+1,period:e},e)}function Xb(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];r=Number.POSITIVE_INFINITY;var s=null,d=e[e.length-1];return Zc(d)?(s=e.pop(),1<e.length&&typeof e[e.length-1]=="number"&&(r=e.pop())):typeof d=="number"&&(r=e.pop()),s===null&&e.length===1&&e[0]instanceof Y?e[0]:tg(r)(nf(e,s))}function li(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];if(e.length===0)return vb;var s=e[0],d=e.slice(1);return e.length===1&&Jb(s)?li.apply(void 0,s):new Y(function(f){var _=function(){return f.add(li.apply(void 0,d).subscribe(f))};return Kb(s).subscribe({next:function(C){f.next(C)},error:_,complete:_})})}function dt(e){var r=e.keys,s=e.index,d=e.subscriber,f=e.subscription;if(e=e.obj,!d.closed)if(s<r.length){var _=r[s];d.next([_,e[_]]),f.add(this.schedule({keys:r,index:s+1,subscriber:d,subscription:f,obj:e}))}else d.complete()}function et(e,r){function s(){return!s.pred.apply(s.thisArg,arguments)}return s.pred=e,s.thisArg=r,s}function wb(e,r){return function(s){return s.lift(new ft(e,r))}}function Ca(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];if(e.length===1){if(!Jb(e[0]))return e[0];e=e[0]}return nf(e,void 0).lift(new gt)}function ht(e){var r=e.start,s=e.index,d=e.subscriber;s>=e.count?d.complete():(d.next(r),d.closed||(e.index=s+1,e.start=r+1,this.schedule(e)))}function Bc(e,r,s){e===void 0&&(e=0);var d=-1;return ki(r)?d=1>Number(r)?1:Number(r):Zc(r)&&(s=r),Zc(s)||(s=bd),new Y(function(f){var _=ki(e)?e:+e-s.now();return s.schedule(it,_,{index:0,period:d,subscriber:f})})}function it(e){var r=e.index,s=e.period,d=e.subscriber;if(d.next(r),!d.closed){if(s===-1)return d.complete();e.index=r+1,this.schedule(e,s)}}function mi(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return typeof(r=e[e.length-1])=="function"&&e.pop(),nf(e,void 0).lift(new jt(r))}function Ga(e){return function(r){var s=new kt(e);return r=r.lift(s),s.caught=r}}function ni(e,r){return cb(e,r,1)}function nm(e){return e===void 0&&(e=null),function(r){return r.lift(new lt(e))}}function cd(e,r){r===void 0&&(r=bd);var s=e instanceof Date&&!isNaN(+e)?+e-r.now():Math.abs(e);return function(d){return d.lift(new mt(s,r))}}function om(e,r){return function(s){return s.lift(new nt(e,r))}}function Dd(e){return e===void 0&&(e=ot),function(r){return r.lift(new pt(e))}}function ot(){return new vg}function Ka(e){return function(r){return e===0?mf():r.lift(new qt(e))}}function pm(e,r){return r?function(s){return s.pipe(pm(function(d,f){return Kb(e(d,f)).pipe(ba(function(_,C){return r(d,_,f,C)}))}))}:function(s){return s.lift(new rt(e))}}function wg(e){return function(r){return r.lift(new st(e))}}function aa(e,r){var s=2<=arguments.length;return function(d){return d.pipe(e?wb(function(f,_){return e(f,_,d)}):Yc,Ka(1),s?nm(r):Dd(function(){return new vg}))}}function tt(){return function(e){return e.lift(new ut)}}function qm(e){return function(r){return e===0?mf():r.lift(new vt(e))}}function qf(e){return function(r){return r.lift(new wt(e))}}function xg(e,r){var s=!1;return 2<=arguments.length&&(s=!0),function(d){return d.lift(new xt(e,r,s))}}function rm(e,r){return 2<=arguments.length?function(s){return gi(xg(e,r),qm(1),nm(r))(s)}:function(s){return gi(xg(function(d,f,_){return e(d,f,_+1)}),qm(1))(s)}}function yt(e,r){return function(s){var d=typeof e=="function"?e:function(){return e};if(typeof r=="function")return s.lift(new zt(d,r));var f=Object.create(s,At);return f.source=s,f.subjectFactory=d,f}}function oe(e){return function(r){return r.lift(new Bt(e,r))}}function Ct(){return new Pa}function pe(){return function(e){return $l()(yt(Ct)(e))}}function sm(e,r,s){var d=e&&X(e)==="object"?e:{bufferSize:e,windowTime:r,refCount:!1,scheduler:s};return function(f){return f.lift(Dt(d))}}function Dt(e){var r,s,d=e.bufferSize,f=d===void 0?Number.POSITIVE_INFINITY:d,_=(d=e.windowTime)===void 0?Number.POSITIVE_INFINITY:d,C=e.refCount,P=e.scheduler,x=0,B=!1,_t=!1;return function(ue){if(x++,!r||B){B=!1;var Wt=(r=new qe(f,_,P)).subscribe(this);s=ue.subscribe({next:function(_n){r.next(_n)},error:function(_n){B=!0,r.error(_n)},complete:function(){_t=!0,s=void 0,r.complete()}}),_t&&(s=void 0)}else Wt=r.subscribe(this);this.add(function(){x--,Wt.unsubscribe(),Wt=void 0,s&&!_t&&C&&x===0&&(s.unsubscribe(),r=s=void 0)})}}function Cc(e,r){return typeof r=="function"?function(s){return s.pipe(Cc(function(d,f){return Kb(e(d,f)).pipe(ba(function(_,C){return r(d,_,f,C)}))}))}:function(s){return s.lift(new Et(e))}}function ob(e){return function(r){return r.lift(new Ft(e))}}function Gt(e,r){return r===void 0&&(r=!1),function(s){return s.lift(new Ht(e,r))}}function ca(e,r,s){return function(d){return d.lift(new It(e,r,s))}}function Jt(e,r,s){return r===void 0&&(r=bd),s===void 0&&(s=Kt),function(d){return d.lift(new Lt(e,r,s.leading,s.trailing))}}function Mt(e){e.subscriber.clearThrottle()}function Nt(e,r,s){return s===void 0&&(s=bd),function(d){var f=e instanceof Date&&!isNaN(+e),_=f?+e-s.now():Math.abs(e);return d.lift(new Ot(_,f,r,s))}}function hb(e,r){return r===void 0&&(r=bd),Nt(e,Z(new pb),r)}function Pt(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];return function(s){var d;return typeof e[e.length-1]=="function"&&(d=e.pop()),s.lift(new Qt(e,d))}}function tm(e,r,s,d,f){e!==r&&um(r,function(_,C){if(f||(f=new ge),lb(_)){_=f;var P=oi(e,C),x=oi(r,C),B=_.get(x);if(B)pi(e,C,B);else{var _t=(B=d?d(P,x,C+"",e,r,_):void 0)===void 0;if(_t){var ue=Va(x),Wt=!ue&&jf(x),_n=!ue&&!Wt&&bi(x);B=x,ue||Wt||_n?Va(P)?B=P:gc(P)&&Ed(P)?B=Xh(P):Wt?(_t=!1,B=Jl(x,!0)):_n?(_t=!1,B=vm(x,!0)):B=[]:wm(x)||rf(x)?(B=P,rf(P)?B=re(P,kf(P)):lb(P)&&!qi(P)||(B=Kl(x))):_t=!1}_t&&(_.set(x,B),tm(B,x,s,d,_),_.delete(x)),pi(e,C,B)}}else(P=d?d(oi(e,C),_,C+"",e,r,f):void 0)===void 0&&(P=_),pi(e,C,P)},kf)}function Rt(e){var r=1,s=ri;(1>=arguments.length?0:arguments.length-1)==1?typeof(1>=arguments.length?void 0:arguments[1])=="number"?r=1>=arguments.length?void 0:arguments[1]:s=1>=arguments.length?void 0:arguments[1]:(1>=arguments.length?0:arguments.length-1)==2&&(r=1>=arguments.length?void 0:arguments[1],s=2>=arguments.length?void 0:arguments[2]);var d=r||1;return function(f){return f.pipe(xg(function(_,C){var P=s.now(),x=P-e;if((_=_.filter(function(ue){return ue.until>x})).length>=d){var B=_[_.length-1],_t=_[0].until+e*Math.floor(_.length/d);_.push({delay:B.until<P?_t-P:_t-B.until,until:_t,value:C})}else _.push({delay:0,until:P,value:C});return _},[]),ba(function(_){return _[_.length-1]}),ni(function(_){var C=bb(_.value);return _.delay?C.pipe(cd(_.delay,s)):C}))}}function St(e,r){var s=(r=r===void 0?{protocols:xm,makeWebSocket:ym}:r).protocols,d=s===void 0?xm:s,f=(r=r.makeWebSocket)===void 0?ym:r;return new Y(function(_){var C,P=new Pa,x=f(e,d),B=!1,_t=!1,ue=function(Wt){if(C)throw B=!0,Wt=Error("Web socket message factory function called more than once"),_.error(Wt),Wt;return C=Wt.subscribe(function(_n){x.send(_n)}),P};return x.onopen=function(){_t?(B=!0,x.close()):_.next(ue)},x.onmessage=function(Wt){P.next(Wt.data)},x.onerror=function(Wt){B=!0,_.error(Error(Wt.message))},x.onclose=function(Wt){B||(B=!0,_t?(_.complete(),P.complete()):_.error(Error(Wt.code===1e3?"Normal closure":Wt.reason)))},function(){_t=!0,C&&C.unsubscribe(),B||(B=!0,x.close())}})}function yg(){this._listeners={}}function zm(e){return typeof Float32Array<"u"?function(){function r(x,B,_t){_[0]=x,B[_t]=C[0],B[_t+1]=C[1],B[_t+2]=C[2],B[_t+3]=C[3]}function s(x,B,_t){_[0]=x,B[_t]=C[3],B[_t+1]=C[2],B[_t+2]=C[1],B[_t+3]=C[0]}function d(x,B){return C[0]=x[B],C[1]=x[B+1],C[2]=x[B+2],C[3]=x[B+3],_[0]}function f(x,B){return C[3]=x[B],C[2]=x[B+1],C[1]=x[B+2],C[0]=x[B+3],_[0]}var _=new Float32Array([-0]),C=new Uint8Array(_.buffer),P=C[3]===128;e.writeFloatLE=P?r:s,e.writeFloatBE=P?s:r,e.readFloatLE=P?d:f,e.readFloatBE=P?f:d}():function(){function r(d,f,_,C){var P=0>f?1:0;if(P&&(f=-f),f===0)d(0<1/f?0:2147483648,_,C);else if(isNaN(f))d(2143289344,_,C);else if(34028234663852886e22<f)d((P<<31|2139095040)>>>0,_,C);else if(11754943508222875e-54>f)d((P<<31|Math.round(f/1401298464324817e-60))>>>0,_,C);else{var x=Math.floor(Math.log(f)/Math.LN2);d((P<<31|x+127<<23|8388607&Math.round(f*Math.pow(2,-x)*8388608))>>>0,_,C)}}function s(d,f,_){return _=d(f,_),d=2*(_>>31)+1,f=_>>>23&255,_&=8388607,f===255?_?NaN:1/0*d:f===0?1401298464324817e-60*d*_:d*Math.pow(2,f-150)*(_+8388608)}e.writeFloatLE=r.bind(null,Am),e.writeFloatBE=r.bind(null,Bm),e.readFloatLE=s.bind(null,Cm),e.readFloatBE=s.bind(null,Dm)}(),typeof Float64Array<"u"?function(){function r(x,B,_t){_[0]=x,B[_t]=C[0],B[_t+1]=C[1],B[_t+2]=C[2],B[_t+3]=C[3],B[_t+4]=C[4],B[_t+5]=C[5],B[_t+6]=C[6],B[_t+7]=C[7]}function s(x,B,_t){_[0]=x,B[_t]=C[7],B[_t+1]=C[6],B[_t+2]=C[5],B[_t+3]=C[4],B[_t+4]=C[3],B[_t+5]=C[2],B[_t+6]=C[1],B[_t+7]=C[0]}function d(x,B){return C[0]=x[B],C[1]=x[B+1],C[2]=x[B+2],C[3]=x[B+3],C[4]=x[B+4],C[5]=x[B+5],C[6]=x[B+6],C[7]=x[B+7],_[0]}function f(x,B){return C[7]=x[B],C[6]=x[B+1],C[5]=x[B+2],C[4]=x[B+3],C[3]=x[B+4],C[2]=x[B+5],C[1]=x[B+6],C[0]=x[B+7],_[0]}var _=new Float64Array([-0]),C=new Uint8Array(_.buffer),P=C[7]===128;e.writeDoubleLE=P?r:s,e.writeDoubleBE=P?s:r,e.readDoubleLE=P?d:f,e.readDoubleBE=P?f:d}():function(){function r(d,f,_,C,P,x){var B=0>C?1:0;if(B&&(C=-C),C===0)d(0,P,x+f),d(0<1/C?0:2147483648,P,x+_);else if(isNaN(C))d(0,P,x+f),d(2146959360,P,x+_);else if(17976931348623157e292<C)d(0,P,x+f),d((B<<31|2146435072)>>>0,P,x+_);else if(22250738585072014e-324>C)d((C/=5e-324)>>>0,P,x+f),d((B<<31|C/4294967296)>>>0,P,x+_);else{var _t=Math.floor(Math.log(C)/Math.LN2);_t===1024&&(_t=1023),d(4503599627370496*(C*=Math.pow(2,-_t))>>>0,P,x+f),d((B<<31|_t+1023<<20|1048576*C&1048575)>>>0,P,x+_)}}function s(d,f,_,C,P){return f=d(C,P+f),C=d(C,P+_),d=2*(C>>31)+1,f=4294967296*(1048575&C)+f,(_=C>>>20&2047)===2047?f?NaN:1/0*d:_===0?5e-324*d*f:d*Math.pow(2,_-1075)*(f+4503599627370496)}e.writeDoubleLE=r.bind(null,Am,0,4),e.writeDoubleBE=r.bind(null,Bm,4,0),e.readDoubleLE=s.bind(null,Cm,0,4),e.readDoubleBE=s.bind(null,Dm,4,0)}(),e}function Am(e,r,s){r[s]=255&e,r[s+1]=e>>>8&255,r[s+2]=e>>>16&255,r[s+3]=e>>>24}function Bm(e,r,s){r[s]=e>>>24,r[s+1]=e>>>16&255,r[s+2]=e>>>8&255,r[s+3]=255&e}function Cm(e,r){return(e[r]|e[r+1]<<8|e[r+2]<<16|e[r+3]<<24)>>>0}function Dm(e,r){return(e[r]<<24|e[r+1]<<16|e[r+2]<<8|e[r+3])>>>0}function Wa(e,r){this.lo=e>>>0,this.hi=r>>>0}function sf(e,r,s){this.fn=e,this.len=r,this.next=void 0,this.val=s}function si(){}function Tt(e){this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}function ja(){this.len=0,this.tail=this.head=new sf(si,0,0),this.states=null}function ti(e,r,s){r[s]=255&e}function ui(e,r){this.len=e,this.next=void 0,this.val=r}function vi(e,r,s){for(;e.hi;)r[s++]=127&e.lo|128,e.lo=(e.lo>>>7|e.hi<<25)>>>0,e.hi>>>=7;for(;127<e.lo;)r[s++]=127&e.lo|128,e.lo>>>=7;r[s++]=e.lo}function wi(e,r,s){r[s]=255&e,r[s+1]=e>>>8&255,r[s+2]=e>>>16&255,r[s+3]=e>>>24}function jc(){xi.call(this)}function Ut(e,r,s){40>e.length?V.utf8.write(e,r,s):r.utf8Write?r.utf8Write(e,s):r.write(e,s)}function Yb(e,r){return RangeError("index out of range: "+e.pos+" + "+(r||1)+" > "+e.len)}function La(e){this.buf=e,this.pos=0,this.len=e.length}function yi(){var e=new Em(0,0),r=0;if(!(4<this.len-this.pos)){for(;3>r;++r){if(this.pos>=this.len)throw Yb(this);if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*r)>>>0,128>this.buf[this.pos++])return e}return e.lo=(e.lo|(127&this.buf[this.pos++])<<7*r)>>>0,e}for(;4>r;++r)if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*r)>>>0,128>this.buf[this.pos++])return e;if(e.lo=(e.lo|(127&this.buf[this.pos])<<28)>>>0,e.hi=(e.hi|(127&this.buf[this.pos])>>4)>>>0,128>this.buf[this.pos++])return e;if(r=0,4<this.len-this.pos){for(;5>r;++r)if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*r+3)>>>0,128>this.buf[this.pos++])return e}else for(;5>r;++r){if(this.pos>=this.len)throw Yb(this);if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*r+3)>>>0,128>this.buf[this.pos++])return e}throw Error("invalid varint encoding")}function zg(e,r){return(e[r-4]|e[r-3]<<8|e[r-2]<<16|e[r-1]<<24)>>>0}function Fm(){if(this.pos+8>this.len)throw Yb(this,8);return new Em(zg(this.buf,this.pos+=4),zg(this.buf,this.pos+=4))}function Fd(e){zi.call(this,e)}function tf(e,r,s){if(typeof e!="function")throw TypeError("rpcImpl must be a function");V.EventEmitter.call(this),this.rpcImpl=e,this.requestDelimited=!!r,this.responseDelimited=!!s}function za(e){return typeof e=="string"&&/^[\s\w!#$%&()+,.:;<=>?@[\]^{|}~-]{1,64}$/.test(e)&&e!=="null"}function Gm(e){try{var r=e.split(".").map(function(d){return Number(d)})}catch{return!1}if(r.length!==4||r[0]===0)return!1;for(e=0;e<r.length;e++){var s=r[e];if(!Number.isInteger(s)||0>s||255<s)return!1}return!0}function Hm(e,r){if(!Array.isArray(r)||r.length===0||32<r.length||r.some(function(s){return s.length===0||32<s.length}))throw new I("arguments is not valid",Ja);if(!za(e))throw new I("ID is invalid",Ja)}function uf(e){var r=e.attributes,s=e.attrSizeMap,d=e.maxAttrsCount,f=e.maxAttrValueSize;if(e=e.maxTotalSize,!yd(r))throw new I("attributes must be an object",Ja);if(Object.keys(r).length>d)throw new ib("Exceed the limit of ".concat(d," attributes"),se);if(Object.keys(r).length===0)throw new I("The attributes is an empty object",Ja);var _=0,C=0;for(r=Object.entries(r);C<r.length;C++){var P=ra(r[C],2),x=P[1];P=new Blob([P[0]]).size;var B=new Blob([x]).size;if(P===0||32<P)throw new I("Invalid attribute key",Ja);if(B>f)throw new ib("Invalid attribute value, over the limit of ".concat(f," bytes"),se);if(typeof x!="string"||x.length===0)throw new I("Invalid attribute value",Ja);_+=P,_+=B}if(_>e)throw new ib("The attributes size overflow",se);if(s!==void 0){if(Object.keys(s).length>d)throw new ib("Exceed the limit of ".concat(d," attributes"),se);for(_=d=0,s=Object.entries(s);_<s.length;_++){if(C=(r=ra(s[_],2))[1],(r=new Blob([r[0]]).size)===0)throw new I("Invalid attribute key",Ja);if(C>f)throw new ib("Invalid attribute value, over the limit of ".concat(f," bytes"),se);d+=r,d+=C}if(d>e)throw new ib("The attributes size overflow",se)}}function Ag(e,r){return Math.floor(Math.random()*(Math.floor(r)-Math.ceil(e)+1))+e}function Bg(){var e=Ag(0,4294967295),r=Ag(1,4294967295);return new U(e,r,!0)}function Xa(e){return e.toString().padEnd(32,"0")}function Im(e,r){return new TypeError("Unexpected ".concat(e,": ").concat(r))}function Jm(e,r){return e=e.split(".").map(function(s){return Number(s)}),r=r.split(".").map(function(s){return Number(s)}),Math.sqrt(1e3*Math.pow(e[0]-r[0],2)+100*Math.pow(e[1]-r[1],2)+10*Math.pow(e[2]-r[2],2)+1*Math.pow(e[3]-r[3],2))}function Km(e){return e.lessThanOrEqual(Number.MAX_SAFE_INTEGER)?e.toNumber():e.toString()}function Ai(e,r){r="".concat(e).concat(r||"");var s=Lm.get(r)||1;return Lm.set(r,s+1),"".concat(e).concat(s)}function Mm(e,r){var s=typeof r=="number"?r:r!==void 0&&typeof r!="string"?r.code:void 0;return r=typeof r!="number"&&typeof r!="string"&&r!==void 0&&r.serverCode!==void 0?r.serverCode:void 0,s="".concat(s!==void 0?" Error Code ".concat(s):"").concat(r!==void 0?", server Code ".concat(r):""),e=typeof e=="string"&&e?Cg(e):Array.isArray(e)&&typeof e[0]=="string"&&e[0]?Cg(Nm.apply(void 0,[e[0]].concat(G(e.slice(1))))):"","".concat(s===""?"":"".concat(s," - ")).concat(e)}function Om(e){return Bi.apply(this,arguments)}function Bi(){return(Bi=J(w.mark(function e(r){return w.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.abrupt("return",new Promise(function(d){setTimeout(function(){d()},r)}));case 1:case"end":return s.stop()}},e)}))).apply(this,arguments)}function Pm(e){return e instanceof Blob||Object.prototype.toString.call(e)==="[object Blob]"}function Dg(e){var r=255&e,s=e>>8&255,d=e>>16&255;return"".concat(e>>24&255,".").concat(d,".").concat(s,".").concat(r)}function te(e,r,s){return Ci.apply(this,arguments)}function Ci(){return(Ci=J(w.mark(function e(r,s,d){var f,_,C,P,x,B,_t,ue,Wt,_n,_i,Ei,_a,Di,_o,_s,_c,_m,Qm,tE,aE,CE,lE,gE,cE,_E;return w.wrap(function(iE){for(;;)switch(iE.prev=iE.next){case 0:if(f=s.body,_=s.headers,C=_===void 0?{}:_,P=s.timeout,x=P===void 0?1e4:P,B=s.signal,_t=s.withCredentials,ue=_t!==void 0&&_t,Wt=(d||{}).useBinaryResponse,_n=Wt!==void 0&&Wt,(_i=new XMLHttpRequest).open("POST",r,!0),_i.responseType=_n?"arraybuffer":"text",_i.withCredentials=ue,_i.timeout=x,Ei=f instanceof FormData,_a=f instanceof Uint8Array,!(1<(Di=Object.keys(C).filter(function(rE){return rE.toLowerCase()==="content-type"})).length)){iE.next=14;break}throw new RangeError("multiple content-type");case 14:Di.length===0&&(_a?C["Content-Type"]="application/octet-stream":Ei||(C["Content-Type"]="application/json"));case 15:if("setRequestHeader"in _i){iE.next=46;break}return _i.abort(),iE.next=19,fetch(r,{body:Ei||_a?f:JSON.stringify(f),cache:"no-cache",credentials:ue?"include":"same-origin",headers:C,method:"POST",mode:"cors",referrer:"no-referrer",signal:B});case 19:if(_o=iE.sent,!(200<=(_s=_o.status)&&300>_s||_s===304)){iE.next=31;break}if(!_n){iE.next=27;break}return iE.next=25,_o.arrayBuffer();case 25:return _c=iE.sent,iE.abrupt("return",{status:_s,responseData:_c});case 27:return iE.next=29,_o.text();case 29:return _m=iE.sent,iE.abrupt("return",{status:_s,responseText:_m});case 31:return Qm=new da(["Post XHR failure, status %d",_s]),iE.prev=32,iE.next=35,_o.text();case 35:throw tE=iE.sent,Qm.statusCode=_s,Qm.message=tE||"Request failed, status ".concat(_s),Qm;case 41:throw iE.prev=41,iE.t0=iE.catch(32),Qm.statusCode=_s,Qm.message="Request failed, status ".concat(_s),Qm;case 46:if(Object.keys(C).length!==0)for(aE=0,CE=Object.entries(C);aE<CE.length;aE++)lE=ra(CE[aE],2),gE=lE[0],cE=lE[1],_i.setRequestHeader(gE,cE);return B!==void 0&&(_E=function rE(){_i.abort(),B.removeEventListener("abort",rE)},B.addEventListener("abort",_E)),Ei||_a?_i.send(f):_i.send(JSON.stringify(f)),iE.abrupt("return",new Promise(function(rE,vf){_i.onload=function(){var Fg=_i.status;if(200<=Fg&&300>Fg||Fg===304)rE(_n?{status:Fg,responseData:_i.response}:{status:Fg,responseText:_i.responseText});else{var _d=new da(["Post XHR failure, status %d",Fg]);_d.statusCode=Fg,_d.message=_i.response||"Request failed, status ".concat(_i.status),vf(_d)}},_i.ontimeout=function(Fg){vf(new db(["XHR request timed out after %d ms",x],{originalError:Fg}))},_i.onerror=function(){var Fg=new da(["Post XHR failure, status %d",_i.status]);Fg.statusCode=_i.status,Fg.message=_i.response||"Request failed, status ".concat(_i.status),vf(Fg)},_i.onabort=function(){try{vf(new DOMException("The request aborted.","AbortError"))}catch{var Fg=Error("The request aborted.");Fg.name="AbortError",vf(Fg)}}}));case 50:case"end":return iE.stop()}},e,null,[[32,41]])}))).apply(this,arguments)}function Rm(e){return Hi.apply(this,arguments)}function Hi(){return(Hi=J(w.mark(function e(r){var s;return w.wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return(s=new Image).src=r,d.abrupt("return",new Promise(function(f,_){s.onload=function(){f({width:s.width,height:s.height})},s.onerror=_}));case 3:case"end":return d.stop()}},e)}))).apply(this,arguments)}function Xt(e,r){return Ii.apply(this,arguments)}function Ii(){return(Ii=J(w.mark(function e(r,s){var d,f,_,C,P,x,B,_t,ue,Wt;return w.wrap(function(_n){for(;;)switch(_n.prev=_n.next){case 0:if(d=r.thumbnailHeight,f=d===void 0?0:d,_=r.thumbnailWidth,C=_===void 0?0:_,P=r.width,x=P===void 0?0:P,B=r.height,_t=B===void 0?0:B,ue=r.thumbnail,Wt=[],typeof f=="number"&&typeof C=="number"&&typeof x=="number"&&typeof _t=="number"){_n.next=5;break}throw new I("Invalid message params",wf);case 5:return 0>=x&&0>=_t&&Wt.push(Rm(Sm(s)).then(function(_i){x=_i.width,_t=_i.height})),0>=C&&0>=f&&ue!==void 0&&Wt.push(Ji(ue).then(function(){var _i=J(w.mark(function Ei(_a){var Di;return w.wrap(function(_o){for(;;)switch(_o.prev=_o.next){case 0:return _o.next=2,Rm(Sm(_a));case 2:Di=_o.sent,C=Di.width,f=Di.height;case 5:case"end":return _o.stop()}},Ei)}));return function(Ei){return _i.apply(this,arguments)}}())),_n.next=9,Promise.all(Wt).catch(function(){});case 9:return _n.abrupt("return",{width:x,height:_t,thumbnailWidth:C,thumbnailHeight:f});case 10:case"end":return _n.stop()}},e)}))).apply(this,arguments)}function Tm(e,r){if(!yd(e))throw new I("message object is not a plain object",r);if(e.messageType===void 0)if(e.rawMessage instanceof Uint8Array){if(e.messageType="RAW",e.text!==void 0)throw new I("Raw messages cannot have text property. Use description instead",r)}else{if(typeof e.text!="string")throw new I("messageType is undefined",r);if(e.messageType="TEXT",e.rawMessage!==void 0)throw new I("Text messages cannot have rawMessage property",r)}}function Gg(e){return Ki.apply(this,arguments)}function Ki(){return(Ki=J(w.mark(function e(r){var s,d,f,_,C,P,x,B,_t,ue,Wt,_n,_i,Ei,_a,Di,_o,_s,_c,_m,Qm;return w.wrap(function(tE){for(;;)switch(tE.prev=tE.next){case 0:if(s=r.message,d=r.peerId,f=r.toPeer,_=r.session,C=r.errorCodes,P=r.diff,x=r.logger,B=r.options,_!==void 0){tE.next=3;break}throw new K("The client is not logged in. Cannot do the operation",C.NOT_LOGGED_IN);case 3:if(_t=!1,s.messageType!=="TEXT"||!s.text.startsWith("AgoraRTMLegacyEndcallCompatibleMessagePrefix")||!f){tE.next=11;break}if(ue=s.text.split("_"),Wt=ra(ue,3),_n=Wt[0],_i=Wt[1],Wt[2]!==void 0&&za(_i)&&_n==="AgoraRTMLegacyEndcallCompatibleMessagePrefix"){tE.next=10;break}throw new I("Message is not valid",ve);case 10:_t=!0;case 11:if(Ei=Date.now(),_a=_.messageSentTimes.length-1,!((Di=_.messageSentTimes[_a])&&Di+3e3<Ei)){tE.next=18;break}_.messageSentTimes=[Ei],tE.next=29;break;case 18:_o=_a;case 19:if(!(0<=_o)){tE.next=28;break}if(!(_.messageSentTimes[_o]+3e3<Ei)){tE.next=23;break}return _.messageSentTimes=_.messageSentTimes.slice(_o+1,_a+1),tE.abrupt("break",28);case 23:if(!(180<=_a-_o+1)){tE.next=25;break}throw new ib("Message sent failed, exceeded the 180 message in 3 seconds",C.TOO_OFTEN);case 25:_o--,tE.next=19;break;case 28:_.messageSentTimes.push(Ei);case 29:tE.t0=s.messageType,tE.next=tE.t0==="TEXT"?32:tE.t0==="RAW"?37:tE.t0==="FILE"||tE.t0==="IMAGE"?39:40;break;case 32:if(!_t){tE.next=36;break}return _s=s.text.split("_"),_c=ra(_s,3),_m=_c[1],Qm=_c[2],x.info("[rtm-API] EndCall message send api is called"),tE.abrupt("return",_.sendInvitationMessage({peerId:d,type:"CallCancel",extra:Qm,channelId:_m,callId:"0"}));case 36:return tE.abrupt("return",_.sendTextMessage(s.text,d,f,B,1e4-P));case 37:return s.description===void 0&&(s.description=""),tE.abrupt("return",_.sendRawMessage(s.rawMessage,s.description,d,f,B,1e4-P));case 39:return tE.abrupt("return",_.sendMediaMessage(s.messageType,s,d,f,B,1e4-P));case 40:throw new I("Invalid message type",ve);case 41:case"end":return tE.stop()}},e)}))).apply(this,arguments)}function Yt(e){var r=!(1<arguments.length&&arguments[1]!==void 0)||arguments[1],s=e.replace(/(https?:\/\/)?(www.)?/i,"");return r||(s=s.split(".").slice(e.length-2).join(".")),s.indexOf("/")!==-1?s.split("/")[0]:s}function oa(e){if(typeof e!="string")return"[Sensitive Info]";var r=Math.floor(.7*e.length),s=e.length;return Um(e,r,s,"*".repeat(s-r))}function Vm(e,r,s){function d(f){if(e===void 0)return e;if(Il(f))return f;if(Array.isArray(f))return f.map(d);var _={},C=0;for(f=Hg(f);C<f.length;C++){var P=ra(f[C],2),x=P[0];if(typeof(P=P[1])=="string"&&s.includes(x)){_[x]=typeof P=="string"?oa(P):"[Sensitive Info]";break}r.includes(x)?_[x]="[Hidden Info]":_[x]=P==null?P:s.includes(x)?"[Sensitive Info]":d(P)}return _}return Array.isArray(e)?e.map(d):d(e)}function Wm(e){return Object.getOwnPropertyNames(e).forEach(function(r){X(r=e[r])=="object"&&r!==null&&Wm(r)}),Object.freeze(e)}function pa(e){return new TextDecoder("utf-8").decode(e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength))}function Ig(e){return new TextEncoder().encode(e).length}function Xm(){for(var e=0,r=arguments.length,s=Array(r),d=0;d<r;d++)s[d]=arguments[d];for(r=0;r<s.length;r++)e+=s[r].length;for(e=new Uint8Array(e),d=r=0;d<s.length;d++){var f=s[d];e.set(f,r),r+=f.length}return e}function we(e,r,s){var d=e.match(/([^?#]+)(\?[^#]*)?(#.*)?/);if(e=d==null?void 0:d[1],d=d==null?void 0:d[2]){var f;for(d=d.substr(1).split("&"),f=0;f<d.length;f++)if(d[f].split("=")[0]==r){d[f]=r+"="+encodeURIComponent(s);break}return f==d.length&&d.push(r+"="+encodeURIComponent(s)),e+"?"+d.join("&")}return e+"?"+r+"="+encodeURIComponent(s)}function Ji(e){return new Promise(function(r,s){var d=new FileReader;d.onloadend=function(){var f=d.result||new ArrayBuffer(0);r(f)},d.onerror=s,d.readAsArrayBuffer(e)})}function Zt(e,r){e=e=[e],typeof(r=r||{})=="string"&&(r={type:r});try{var s=new Blob(e,r)}catch(f){if(f.name!=="TypeError")throw f;s=new(typeof BlobBuilder<"u"?BlobBuilder:typeof MSBlobBuilder<"u"?MSBlobBuilder:typeof MozBlobBuilder<"u"?MozBlobBuilder:WebKitBlobBuilder);for(var d=0;d<e.length;d+=1)s.append(e[d]);s=s.getBlob(r.type)}return s}function Um(e,r,s,d){return typeof e!="string"?"[Sensitive Info]":e.substring(0,r)+d+e.substring(s)}function Ym(e){var r=[];return function s(d){if(d===null||X(d)!=="object")return d;if(r.indexOf(d)!==-1)return"[Circular]";if(r.push(d),typeof d.toJSON=="function")try{var f=s(d.toJSON());return r.pop(),f}catch(_){return"[Throws: "+(_?_.message:"?")+"]"}return Array.isArray(d)?(f=d.map(s),r.pop(),f):(f=Object.keys(d).reduce(function(_,C){t:{if($t.call(d,C))try{var P=d[C];break t}catch(x){P="[Throws: "+(x?x.message:"?")+"]";break t}P=d[C]}return _[C]=s(P),_},{}),r.pop(),f)}(e)}function au(e){if(!(100<(e=String(e)).length)&&(e=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e))){var r=parseFloat(e[1]);switch((e[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*r;case"weeks":case"week":case"w":return 6048e5*r;case"days":case"day":case"d":return 864e5*r;case"hours":case"hour":case"hrs":case"hr":case"h":return 36e5*r;case"minutes":case"minute":case"mins":case"min":case"m":return 6e4*r;case"seconds":case"second":case"secs":case"sec":case"s":return 1e3*r;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return r}}}function Jg(e,r,s,d){return Math.round(e/s)+" "+d+(r>=1.5*s?"s":"")}function bu(e){var r=e.areas,s=e.excludedArea;if(r.length===1&&r[0]===F.GLOBAL&&s===F.CHINA)return xe([F.OVERSEA]);if(r.includes(F.GLOBAL)){if(e=xf(Kg).filter(function(_){return _!==F.GLOBAL&&_!==F.OVERSEA}),s in yf){r=yf[s];var d=[].concat(G(r??[]),[s]);return xe(e.filter(function(_){return!d.includes(_)}))}if(Zm(s)){var f=cu(s);return xe(e.filter(function(_){return _!==s&&_!==f}))}}if(Zm(s)||s in yf)return xe(r);throw new I("Invalid excludedArea area config")}function Ma(e,r,s){s===void 0&&(s=Object.getOwnPropertyDescriptor(e,r));var d=s.value;return s.value=function(){for(var f=this,_=arguments.length,C=Array(_),P=0;P<_;P++)C[P]=arguments[P];this.invokeTracker.apply(this,["%s: ".concat(0<C.length?"%s with args: ".concat(C.map(function(){return"%o"})):"%s"),this.name,r].concat(G(C.map(ye))));try{var x=d.apply(this,C)}catch(_t){throw this.logError.apply(this,["".concat(_t.code!==void 0?"Error Code ".concat(_t.code,": "):"","%s failed").concat(0<C.length?" with args: ".concat(C.map(function(){return"%o"})):""),r].concat(G(C.map(ye)))),_t.originalError&&this.logError(_t.originalError),this.errorTracker(_t),_t}var B=Date.now();return J(w.mark(function _t(){var ue,Wt;return w.wrap(function(_n){for(;;)switch(_n.prev=_n.next){case 0:return _n.prev=0,_n.next=3,x;case 3:ue=_n.sent,_n.next=12;break;case 6:return _n.prev=6,_n.t0=_n.catch(0),f.logError.apply(f,["".concat(_n.t0.code!==void 0?"Error Code ".concat(_n.t0.code,": "):"","%s failed").concat(0<C.length?" with args: ".concat(C.map(function(){return"%o"})):""),r].concat(G(C.map(ye)))),_n.t0.originalError&&f.logError(_n.t0.originalError),f.errorTracker(_n.t0),_n.abrupt("return");case 12:ue!==x?ue===void 0?f.resultTracker("%s promise resolves after %dms",r,Date.now()-B):f.resultTracker("%s promise resolves after %dms, result is %o",r,Date.now()-B,ye(ue)):Ac(ue)!=="Object"||yd(ue)?f.resultTracker("%s result is %o",r,ye(ue)):f.resultTracker("%s result is %s",r,ue.name||((Wt=ue.constructor)===null||Wt===void 0?void 0:Wt.name));case 13:case"end":return _n.stop()}},_t,null,[[0,6]])}))(),x},s}function Nb(e,r,s){s===void 0&&(s=Object.getOwnPropertyDescriptor(e,r));var d=s.value;return s.value=function(){for(var f=this,_=arguments.length,C=Array(_),P=0;P<_;P++)C[P]=arguments[P];this.invokeTracker.apply(this,["%s: ".concat(0<C.length?"%s with args: ".concat(C.map(function(){return"%o"})):"%s"),this.name,r].concat(C));try{var x=d.apply(this,C)}catch(_t){throw this.logError.apply(this,["".concat(_t.code!==void 0?"Error Code ".concat(_t.code,": "):"","%s failed").concat(0<C.length?" with args: ".concat(C.map(function(){return"%o"})):""),r].concat(C)),_t.originalError&&this.logError(_t.originalError),this.errorTracker(_t),_t}var B=Date.now();return J(w.mark(function _t(){var ue,Wt;return w.wrap(function(_n){for(;;)switch(_n.prev=_n.next){case 0:return _n.prev=0,_n.next=3,x;case 3:ue=_n.sent,_n.next=12;break;case 6:return _n.prev=6,_n.t0=_n.catch(0),f.logError.apply(f,["".concat(_n.t0.code!==void 0?"Error Code ".concat(_n.t0.code,": "):"","%s failed").concat(0<C.length?" with args: ".concat(C.map(function(){return"%o"})):""),r].concat(C)),_n.t0.originalError&&f.logError(_n.t0.originalError),f.errorTracker(_n.t0),_n.abrupt("return");case 12:ue!==x?ue===void 0?f.resultTracker("%s promise resolves after %dms",r,Date.now()-B):f.resultTracker("%s promise resolves after %dms, result is %o",r,Date.now()-B,ue):Ac(ue)!=="Object"||yd(ue)?f.resultTracker("%s result is %o",r,ue):f.resultTracker("%s result is %s",r,ue.name||((Wt=ue.constructor)===null||Wt===void 0?void 0:Wt.name));case 13:case"end":return _n.stop()}},_t,null,[[0,6]])}))(),x},s}function du(e,r){var s="".concat(e,"Uri");if(typeof(s=Li[s])!="number"||s===0)throw new TypeError("Got Unknown URI Name");return r=new(e=$m[e])(r),r=e.encode(r).finish(),new eu({uri:s,data:r})}function an(e,r){return"".concat(e.split(".").join("-"),".edge.").concat(r?"sd-rtn.com":"agora.io")}function eb(e,r,s){return Mi.apply(this,arguments)}function Mi(){return(Mi=J(w.mark(function e(r,s,d){var f,_;return w.wrap(function(C){for(;;)switch(C.prev=C.next){case 0:C.next=2;break;case 2:return f=fu[r].encode(s).finish(),_=function(){var P=J(w.mark(function x(B){var _t,ue,Wt,_n=arguments;return w.wrap(function(_i){for(;;)switch(_i.prev=_i.next){case 0:if(!(3<(ue=1<_n.length&&_n[1]!==void 0?_n[1]:0))){_i.next=3;break}return _i.abrupt("return");case 3:return Wt=we(Wt=d?"https://".concat((_t=M==null?void 0:M.PROXY_NGINX[0])!==null&&_t!==void 0?_t:"webrtc-cloud-proxy.sd-rtn.com","/rs/?h=").concat(B,"&p=6443&d=events/proto-raw"):"https://".concat(B,":6443/events/proto-raw"),"sentTs",Math.ceil(Date.now()/1e3).toString()),Wt=we(Wt,"id",gu[r].toString()),_i.next=8,te(Wt,{body:f,timeout:2e4,headers:{"Content-Type":"application/octet-stream"}}).catch(function(Ei){return _(B,ue+1)});case 8:case"end":return _i.stop()}},x)}));return function(x){return P.apply(this,arguments)}}(),C.prev=4,C.next=7,_((M==null?void 0:M.EVENT_REPORT_DOMAIN[0])||"webcollector-rtm.agora.io");case 7:C.next=13;break;case 9:return C.prev=9,C.t0=C.catch(4),C.next=13,_(M&&bn(1<(M==null?void 0:M.EVENT_REPORT_DOMAIN.length)?M==null?void 0:M.EVENT_REPORT_DOMAIN.slice(1):M==null?void 0:M.EVENT_REPORT_DOMAIN)||"rtm.statscollector.sd-rtn.com");case 13:case"end":return C.stop()}},e,null,[[4,9]])}))).apply(this,arguments)}function fb(e){return e===void 0?U.fromNumber(0):U.fromNumber(Date.now()-e)}function hu(e){return btoa(String.fromCharCode.apply({},e.replace(/\r|\n/g,"").replace(/([\dA-Fa-f]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ").map(function(r){return parseInt(r,16)}))).replace(/={1,2}$/,"")}function Lg(e,r){return U.fromValue(e).eq(r)}function Mg(e,r){var s=r===void 0?e.val:r,d=e.isBoolean;r=e.isNumber;var f=e.oneof,_=e.len;if([d,r,f].filter(function(C){return!C}).length!==2)throw new TypeError("invalid field type");if(s!==void 0&&(e=!1,f!==void 0&&(f=Ni(f),iu(f,Lg).length===f.length&&ju(f,function(C){return Lg(s,C)})!==void 0&&(e=!0)),d=d!==void 0&&(s===0||s===1)&&_===1,r=r!==void 0&&s.toString(2).length<=_,!(e||d||r)))throw Error("invalid field value")}function cn(e){return function(){var r=e();if(!r)throw new K("Client is not logged in. Cannot do the operation");return r}}var Ya=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof commonjsGlobal<"u"?commonjsGlobal:typeof self<"u"?self:{},Ng=function(e){return e&&e.Math==Math&&e},y=Ng(typeof globalThis=="object"&&globalThis)||Ng(typeof window=="object"&&window)||Ng(typeof self=="object"&&self)||Ng(typeof Ya=="object"&&Ya)||function(){return this}()||Function("return this")(),R=function(e){try{return!!e()}catch{return!0}},ka=!R(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!=7}),dn={}.propertyIsEnumerable,en=Object.getOwnPropertyDescriptor,zf=en&&!dn.call({1:2},1)?function(e){return!!(e=en(this,e))&&e.enumerable}:dn,dd=function(e,r){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:r}},ku={}.toString,Zb=function(e){return ku.call(e).slice(8,-1)},lu="".split,Af=R(function(){return!Object("z").propertyIsEnumerable(0)})?function(e){return Zb(e)=="String"?lu.call(e,""):Object(e)}:Object,jb=function(e){if(e==null)throw TypeError("Can't call method on "+e);return e},qb=function(e){return Af(jb(e))},ha=function(e){return typeof e=="object"?e!==null:typeof e=="function"},lc=function(e,r){if(!ha(e))return e;var s,d;if(r&&typeof(s=e.toString)=="function"&&!ha(d=s.call(e))||typeof(s=e.valueOf)=="function"&&!ha(d=s.call(e))||!r&&typeof(s=e.toString)=="function"&&!ha(d=s.call(e)))return d;throw TypeError("Can't convert object to primitive value")},Qa=function(e){return Object(jb(e))},mu={}.hasOwnProperty,Q=function(e,r){return mu.call(Qa(e),r)},ze=y.document,Og=ha(ze)&&ha(ze.createElement),fn=!ka&&!R(function(){return Object.defineProperty(Og?ze.createElement("div"):{},"a",{get:function(){return 7}}).a!=7}),gn=Object.getOwnPropertyDescriptor,Fb={f:ka?gn:function(e,r){if(e=qb(e),r=lc(r,!0),fn)try{return gn(e,r)}catch{}if(Q(e,r))return dd(!zf.call(e,r),e[r])}},va=function(e){if(!ha(e))throw TypeError(String(e)+" is not an object");return e},hn=Object.defineProperty,Ra={f:ka?hn:function(e,r,s){if(va(e),r=lc(r,!0),va(s),fn)try{return hn(e,r,s)}catch{}if("get"in s||"set"in s)throw TypeError("Accessors not supported");return"value"in s&&(e[r]=s.value),e}},Na=ka?function(e,r,s){return Ra.f(e,r,dd(1,s))}:function(e,r,s){return e[r]=s,e},Oi=function(e,r){try{Na(y,e,r)}catch{y[e]=r}return r},ed=y["__core-js_shared__"]||Oi("__core-js_shared__",{}),nu=Function.toString;typeof ed.inspectSource!="function"&&(ed.inspectSource=function(e){return nu.call(e)});var Pi=ed.inspectSource,jn=y.WeakMap,ou=typeof jn=="function"&&/native code/.test(Pi(jn)),fd=$a(function(e){(e.exports=function(r,s){return ed[r]||(ed[r]=s!==void 0?s:{})})("versions",[]).push({version:"3.12.1",mode:"global",copyright:"Â© 2021 Denis Pushkarev (zloirock.ru)"})}),pu=0,qu=Math.random(),Ae=function(e){return"Symbol("+String(e===void 0?"":e)+")_"+(++pu+qu).toString(36)},kn=fd("keys"),Pg=function(e){return kn[e]||(kn[e]=Ae(e))},Be={},ru=y.WeakMap;if(ou||ed.state)var Gd=ed.state||(ed.state=new ru),su=Gd.get,ln=Gd.has,tu=Gd.set,Qi=function(e,r){if(ln.call(Gd,e))throw new TypeError("Object already initialized");return r.facade=e,tu.call(Gd,e,r),r},Qg=function(e){return su.call(Gd,e)||{}},Ri=function(e){return ln.call(Gd,e)};else{var Ce=Pg("state");Be[Ce]=!0,Qi=function(e,r){if(Q(e,Ce))throw new TypeError("Object already initialized");return r.facade=e,Na(e,Ce,r),r},Qg=function(e){return Q(e,Ce)?e[Ce]:{}},Ri=function(e){return Q(e,Ce)}}var Za={set:Qi,get:Qg,has:Ri,enforce:function(e){return Ri(e)?Qg(e):Qi(e,{})},getterFor:function(e){return function(r){var s;if(!ha(r)||(s=Qg(r)).type!==e)throw TypeError("Incompatible receiver, "+e+" required");return s}}},Ta=$a(function(e){var r=Za.get,s=Za.enforce,d=String(String).split("String");(e.exports=function(f,_,C,P){var x=!!P&&!!P.unsafe,B=!!P&&!!P.enumerable;if(P=!!P&&!!P.noTargetGet,typeof C=="function"){typeof _!="string"||Q(C,"name")||Na(C,"name",_);var _t=s(C);_t.source||(_t.source=d.join(typeof _=="string"?_:""))}f===y?B?f[_]=C:Oi(_,C):(x?!P&&f[_]&&(B=!0):delete f[_],B?f[_]=C:Na(f,_,C))})(Function.prototype,"toString",function(){return typeof this=="function"&&r(this).source||Pi(this)})}),mn=function(e){return typeof e=="function"?e:void 0},mc=function(e,r){return 2>arguments.length?mn(y[e])||mn(y[e]):y[e]&&y[e][r]||y[e]&&y[e][r]},uu=Math.ceil,vu=Math.floor,$b=function(e){return isNaN(e=+e)?0:(0<e?vu:uu)(e)},wu=Math.min,ta=function(e){return 0<e?wu($b(e),9007199254740991):0},xu=Math.max,yu=Math.min,xb=function(e,r){return 0>(e=$b(e))?xu(e+r,0):yu(e,r)},nn=function(e){return function(r,s,d){r=qb(r);var f=ta(r.length);if(d=xb(d,f),e&&s!=s){for(;f>d;)if((s=r[d++])!=s)return!0}else for(;f>d;d++)if((e||d in r)&&r[d]===s)return e||d||0;return!e&&-1}},on=nn(!0),Si=nn(!1),pn=function(e,r){e=qb(e);var s,d=0,f=[];for(s in e)!Q(Be,s)&&Q(e,s)&&f.push(s);for(;r.length>d;)Q(e,s=r[d++])&&(~Si(f,s)||f.push(s));return f},Rg="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" "),zu=Rg.concat("length","prototype"),Hd={f:Object.getOwnPropertyNames||function(e){return pn(e,zu)}},Bf={f:Object.getOwnPropertySymbols},qn=mc("Reflect","ownKeys")||function(e){var r=Hd.f(va(e)),s=Bf.f;return s?r.concat(s(e)):r},rn=function(e,r){for(var s=qn(r),d=Ra.f,f=Fb.f,_=0;_<s.length;_++){var C=s[_];Q(e,C)||d(e,C,f(r,C))}},Au=/#|\.prototype\./,nc=function(e,r){return(e=Bu[Cu(e)])==Du||e!=Eu&&(typeof r=="function"?R(r):!!r)},Cu=nc.normalize=function(e){return String(e).replace(Au,".").toLowerCase()},Bu=nc.data={},Eu=nc.NATIVE="N",Du=nc.POLYFILL="P",Fu=Fb.f,N=function(e,r){var s,d,f,_=e.target,C=e.global,P=e.stat;if(d=C?y:P?y[_]||Oi(_,{}):(y[_]||{}).prototype)for(f in r){var x=r[f],B=e.noTargetGet?(s=Fu(d,f))&&s.value:d[f];if(!(s=nc(C?f:_+(P?".":"#")+f,e.forced))&&B!==void 0){if(typeof x==typeof B)continue;rn(x,B)}(e.sham||B&&B.sham)&&Na(x,"sham",!0);try{Ta(d,f,x,e)}catch{}}},yb=function(e){if(typeof e!="function")throw TypeError(String(e)+" is not a function");return e},Id=function(e,r,s){if(yb(e),r===void 0)return e;switch(s){case 0:return function(){return e.call(r)};case 1:return function(d){return e.call(r,d)};case 2:return function(d,f){return e.call(r,d,f)};case 3:return function(d,f,_){return e.call(r,d,f,_)}}return function(){return e.apply(r,arguments)}},gd=Array.isArray||function(e){return Zb(e)=="Array"},De=mc("navigator","userAgent")||"",sn=y.process,tn=sn&&sn.versions,un=tn&&tn.v8;if(un)var hd=un.split("."),Ti=4>hd[0]?1:hd[0]+hd[1];else De&&(hd=De.match(/Edge\/(\d+)/),(!hd||74<=hd[1])&&(hd=De.match(/Chrome\/(\d+)/))&&(Ti=hd[1]));var id=Ti&&+Ti,oc=!!Object.getOwnPropertySymbols&&!R(function(){return!String(Symbol())||!Symbol.sham&&id&&41>id}),vn=oc&&!Symbol.sham&&typeof Symbol.iterator=="symbol",Cf=fd("wks"),Df=y.Symbol,Gu=vn?Df:Df&&Df.withoutSetter||Ae,qa=function(e){return Q(Cf,e)&&(oc||typeof Cf[e]=="string")||(oc&&Q(Df,e)?Cf[e]=Df[e]:Cf[e]=Gu("Symbol."+e)),Cf[e]},Hu=qa("species"),Sg=function(e,r){if(gd(e)){var s=e.constructor;typeof s!="function"||s!==Array&&!gd(s.prototype)?ha(s)&&(s=s[Hu])===null&&(s=void 0):s=void 0}return new(s===void 0?Array:s)(r===0?0:r)},wn=[].push,jd=function(e){var r=e==1,s=e==2,d=e==3,f=e==4,_=e==6,C=e==7,P=e==5||_;return function(x,B,_t,ue){var Wt=Qa(x),_n=Af(Wt);B=Id(B,_t,3),_t=ta(_n.length);var _i,Ei=0;for(ue=ue||Sg,x=r?ue(x,_t):s||C?ue(x,0):void 0;_t>Ei;Ei++)if((P||Ei in _n)&&(_i=B(ue=_n[Ei],Ei,Wt),e))if(r)x[Ei]=_i;else if(_i)switch(e){case 3:return!0;case 5:return ue;case 6:return Ei;case 2:wn.call(x,ue)}else switch(e){case 4:return!1;case 7:wn.call(x,ue)}return _?-1:d||f?f:x}},Jd=jd(0),xn=jd(1),yn=jd(2),Iu=jd(3),Ju=jd(4),zn=jd(5),An=jd(6),Ku=qa("species"),Ef=function(e){return 51<=id||!R(function(){var r=[];return(r.constructor={})[Ku]=function(){return{foo:1}},r[e](Boolean).foo!==1})},Lu=Ef("filter");N({target:"Array",proto:!0,forced:!Lu},{filter:function(e){return yn(this,e,1<arguments.length?arguments[1]:void 0)}});var Dc=Object.keys||function(e){return pn(e,Rg)},Mu=R(function(){Dc(1)});N({target:"Object",stat:!0,forced:Mu},{keys:function(e){return Dc(Qa(e))}});var Ee=function(e,r){var s=[][e];return!!s&&R(function(){s.call(null,r||function(){throw 1},1)})},Nu=[].join,Ou=Af!=Object,Pu=Ee("join",",");N({target:"Array",proto:!0,forced:Ou||!Pu},{join:function(e){return Nu.call(qb(this),e===void 0?",":e)}});var Qu=Ef("map");N({target:"Array",proto:!0,forced:!Qu},{map:function(e){return xn(this,e,1<arguments.length?arguments[1]:void 0)}});var Ui=function(e){var r=e.return;if(r!==void 0)return va(r.call(e)).value},Fe={},Ru=qa("iterator"),Su=Array.prototype,Vi=function(e){return e!==void 0&&(Fe.Array===e||Su[Ru]===e)},Ge=function(e,r,s){(r=lc(r))in e?Ra.f(e,r,dd(0,s)):e[r]=s},Tu=qa("toStringTag"),Bn={};Bn[Tu]="z";var Wi=String(Bn)==="[object z]",Uu=qa("toStringTag"),Vu=Zb(function(){return arguments}())=="Arguments",Ff=Wi?Zb:function(e){var r;if(e===void 0)var s="Undefined";else{if(e===null)var d="Null";else{t:{var f=e=Object(e);try{d=f[Uu];break t}catch{}d=void 0}d=typeof(s=d)=="string"?s:Vu?Zb(e):(r=Zb(e))=="Object"&&typeof e.callee=="function"?"Arguments":r}s=d}return s},Wu=qa("iterator"),Xi=function(e){if(e!=null)return e[Wu]||e["@@iterator"]||Fe[Ff(e)]},Cn=qa("iterator"),Dn=!1;try{var Xu=0,En={next:function(){return{done:!!Xu++}},return:function(){Dn=!0}};En[Cn]=function(){return this},Array.from(En,function(){throw 2})}catch(e){}var Tg=function(e,r){if(!r&&!Dn)return!1;var s=!1;try{(r={})[Cn]=function(){return{next:function(){return{done:s=!0}}}},e(r)}catch{}return s},Yu=!Tg(function(e){Array.from(e)});N({target:"Array",stat:!0,forced:Yu},{from:function(e){var r,s=Qa(e),d=typeof this=="function"?this:Array,f=arguments.length,_=1<f?arguments[1]:void 0,C=_!==void 0,P=Xi(s),x=0;if(C&&(_=Id(_,2<f?arguments[2]:void 0,2)),P==null||d==Array&&Vi(P)){var B=ta(s.length);for(d=new d(B);B>x;x++)P=C?_(s[x],x):s[x],Ge(d,x,P)}else for(f=(s=P.call(s)).next,d=new d;!(r=f.call(s)).done;x++){if(C){P=s;var _t=_;r=[r.value,x];try{B=_t(va(r)[0],r[1])}catch(ue){throw Ui(P),ue}}else B=r.value;Ge(d,x,P=B)}return d.length=x,d}});var Fn=function(e){return function(r,s){r=String(jb(r)),s=$b(s);var d,f=r.length;if(0>s||s>=f)return e?"":void 0;var _=r.charCodeAt(s);return 55296>_||56319<_||s+1===f||56320>(d=r.charCodeAt(s+1))||57343<d?e?r.charAt(s):_:e?r.slice(s,s+2):d-56320+(_-55296<<10)+65536}},Gn=Fn(!0),Hn=!R(function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}),In=Pg("IE_PROTO"),Zu=Object.prototype,Vb=Hn?Object.getPrototypeOf:function(e){return e=Qa(e),Q(e,In)?e[In]:typeof e.constructor=="function"&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?Zu:null},Yi=qa("iterator"),Jn=!1,$u=function(){return this},Kd;if([].keys){var Kn=[].keys();if("next"in Kn){var Ln=Vb(Vb(Kn));Ln!==Object.prototype&&(Kd=Ln)}else Jn=!0}(Kd==null||R(function(){var e={};return Kd[Yi].call(e)!==e}))&&(Kd={}),Q(Kd,Yi)||Na(Kd,Yi,$u);var Ug=Kd,Vg=Jn,av=ka?Object.defineProperties:function(e,r){va(e);for(var s,d=Dc(r),f=d.length,_=0;f>_;)Ra.f(e,s=d[_++],r[s]);return e},Zi=mc("document","documentElement"),Mn=Pg("IE_PROTO"),$i=function(){},aj,Wg=function(){try{aj=document.domain&&new ActiveXObject("htmlfile")}catch{}if(aj){var e=aj;e.write("<script><\/script>"),e.close(),e=e.parentWindow.Object}else(e=Og?ze.createElement("iframe"):{}).style.display="none",Zi.appendChild(e),e.src="javascript:",(e=e.contentWindow.document).open(),e.write("<script>document.F=Object<\/script>"),e.close(),e=e.F;for(Wg=e,e=Rg.length;e--;)delete Wg.prototype[Rg[e]];return Wg()};Be[Mn]=!0;var ac=Object.create||function(e,r){if(e!==null){$i.prototype=va(e);var s=new $i;$i.prototype=null,s[Mn]=e}else s=Wg();return r===void 0?s:av(s,r)},bv=Ra.f,Nn=qa("toStringTag"),Ec=function(e,r,s){e&&!Q(e=s?e:e.prototype,Nn)&&bv(e,Nn,{configurable:!0,value:r})},cv=function(){return this},dv=function(e,r,s){return r+=" Iterator",e.prototype=ac(Ug,{next:dd(1,s)}),Ec(e,r,!1),Fe[r]=cv,e},Ua=Object.setPrototypeOf||("__proto__"in{}?function(){var e=!1,r={};try{var s=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set;s.call(r,[]),e=r instanceof Array}catch{}return function(d,f){if(va(d),!ha(f)&&f!==null)throw TypeError("Can't set "+String(f)+" as a prototype");return e?s.call(d,f):d.__proto__=f,d}}():void 0),Gf=qa("iterator"),ev=function(){return this},bj=function(e,r,s,d,f,_,C){dv(s,r,d),d=function(Ei){if(Ei===f&&Wt)return Wt;if(!Vg&&Ei in _t)return _t[Ei];switch(Ei){case"keys":case"values":case"entries":return function(){return new s(this,Ei)}}return function(){return new s(this)}};var P,x=r+" Iterator",B=!1,_t=e.prototype,ue=_t[Gf]||_t["@@iterator"]||f&&_t[f],Wt=!Vg&&ue||d(f),_n=r=="Array"&&_t.entries||ue;if(_n&&(e=Vb(_n.call(new e)),Ug!==Object.prototype&&e.next&&(Vb(e)!==Ug&&(Ua?Ua(e,Ug):typeof e[Gf]!="function"&&Na(e,Gf,ev)),Ec(e,x,!0))),f=="values"&&ue&&ue.name!=="values"&&(B=!0,Wt=function(){return ue.call(this)}),_t[Gf]!==Wt&&Na(_t,Gf,Wt),Fe[r]=Wt,f){var _i={values:d("values"),keys:_?Wt:d("keys"),entries:d("entries")};if(C)for(P in _i)!Vg&&!B&&P in _t||Ta(_t,P,_i[P]);else N({target:r,proto:!0,forced:Vg||B},_i)}return _i},fv=Za.set,gv=Za.getterFor("String Iterator");bj(String,"String",function(e){fv(this,{type:"String Iterator",string:String(e),index:0})},function(){var e=gv(this),r=e.string,s=e.index;return s>=r.length?{value:void 0,done:!0}:(r=Gn(r,s),e.index+=r.length,{value:r,done:!1})});var cj=qa("unscopables"),dj=Array.prototype;dj[cj]==null&&Ra.f(dj,cj,{configurable:!0,value:ac(null)});var Ld=function(e){dj[cj][e]=!0},On=!0;"find"in[]&&Array(1).find(function(){On=!1}),N({target:"Array",proto:!0,forced:On},{find:function(e){return zn(this,e,1<arguments.length?arguments[1]:void 0)}}),Ld("find");var Pn=function(e){var r=String(jb(this)),s="";if(0>(e=$b(e))||1/0==e)throw RangeError("Wrong number of repetitions");for(;0<e;(e>>>=1)&&(r+=r))1&e&&(s+=r);return s};N({target:"String",proto:!0},{repeat:Pn}),N({target:"Number",stat:!0},{MAX_SAFE_INTEGER:9007199254740991}),N({target:"Number",stat:!0},{isNaN:function(e){return e!=e}}),y.Number.isNaN;var hv=Wi?{}.toString:function(){return"[object "+Ff(this)+"]"};Wi||Ta(Object.prototype,"toString",hv,{unsafe:!0});var Fc=y.Promise,Hf=function(e,r,s){for(var d in r)Ta(e,d,r[d],s);return e},Qn=qa("species"),If=function(e){e=mc(e);var r=Ra.f;ka&&e&&!e[Qn]&&r(e,Qn,{configurable:!0,get:function(){return this}})},Gc=function(e,r,s){if(!(e instanceof r))throw TypeError("Incorrect "+(s?s+" ":"")+"invocation");return e},Jf=function(e,r){this.stopped=e,this.result=r},Xg=function(e,r,s){var d,f=!(!s||!s.AS_ENTRIES),_=!(!s||!s.IS_ITERATOR),C=!(!s||!s.INTERRUPTED),P=Id(r,s&&s.that,1+f+C),x=function(_t){return B&&Ui(B),new Jf(!0,_t)};if(r=function(_t){return f?(va(_t),C?P(_t[0],_t[1],x):P(_t[0],_t[1])):C?P(_t,x):P(_t)},_)var B=e;else{if(typeof(_=Xi(e))!="function")throw TypeError("Target is not iterable");if(Vi(_)){for(_=0,s=ta(e.length);s>_;_++)if((d=r(e[_]))&&d instanceof Jf)return d;return new Jf(!1)}B=_.call(e)}for(e=B.next;!(_=e.call(B)).done;){try{d=r(_.value)}catch(_t){throw Ui(B),_t}if(typeof d=="object"&&d&&d instanceof Jf)return d}return new Jf(!1)},iv=qa("species"),kd=function(e,r){var s;return(e=va(e).constructor)===void 0||(s=va(e)[iv])==null?r:yb(s)},Rn=/(?:iphone|ipod|ipad).*applewebkit/i.test(De),Hc=Zb(y.process)=="process",Yg=y.location,ej=y.setImmediate,Sn=y.clearImmediate,jv=y.process,Tn=y.MessageChannel,fj=y.Dispatch,gj=0,Kf={},hj=function(e){if(Kf.hasOwnProperty(e)){var r=Kf[e];delete Kf[e],r()}},ij=function(e){return function(){hj(e)}},Un=function(e){hj(e.data)},Vn=function(e){y.postMessage(e+"",Yg.protocol+"//"+Yg.host)};if(!ej||!Sn)if(ej=function(e){for(var r=[],s=1;arguments.length>s;)r.push(arguments[s++]);return Kf[++gj]=function(){(typeof e=="function"?e:Function(e)).apply(void 0,r)},Lf(gj),gj},Sn=function(e){delete Kf[e]},Hc)var Lf=function(e){jv.nextTick(ij(e))};else if(fj&&fj.now)Lf=function(e){fj.now(ij(e))};else if(Tn&&!Rn){var Wn=new Tn,Xn=Wn.port2;Wn.port1.onmessage=Un,Lf=Id(Xn.postMessage,Xn,1)}else y.addEventListener&&typeof postMessage=="function"&&!y.importScripts&&Yg&&Yg.protocol!=="file:"&&!R(Vn)?(Lf=Vn,y.addEventListener("message",Un,!1)):Lf="onreadystatechange"in(Og?ze.createElement("script"):{})?function(e){Zi.appendChild(Og?ze.createElement("script"):{}).onreadystatechange=function(){Zi.removeChild(this),hj(e)}}:function(e){setTimeout(ij(e),0)};var jj=ej,kv=/web0s(?!.*chrome)/i.test(De),lv=Fb.f,Yn=y.MutationObserver||y.WebKitMutationObserver,Zn=y.document,$n=y.process,Zg=y.Promise,ao=lv(y,"queueMicrotask"),bo=ao&&ao.value,Md,Mf;if(!bo){var ah=function(){var e;for(Hc&&(e=$n.domain)&&e.exit();Md;){var r=Md.fn;Md=Md.next;try{r()}catch(s){throw Md?$g():Mf=void 0,s}}Mf=void 0,e&&e.enter()};if(Rn||Hc||kv||!Yn||!Zn)if(Zg&&Zg.resolve){var kj=Zg.resolve(void 0);kj.constructor=Zg;var mv=kj.then,$g=function(){mv.call(kj,ah)}}else $g=Hc?function(){$n.nextTick(ah)}:function(){jj.call(y,ah)};else{var co=!0,eo=Zn.createTextNode("");new Yn(ah).observe(eo,{characterData:!0}),$g=function(){eo.data=co=!co}}}var fo=bo||function(e){e={fn:e,next:void 0},Mf&&(Mf.next=e),Md||(Md=e,$g()),Mf=e},nv=function(e){var r,s;this.promise=new e(function(d,f){if(r!==void 0||s!==void 0)throw TypeError("Bad Promise constructor");r=d,s=f}),this.resolve=yb(r),this.reject=yb(s)},lj={f:function(e){return new nv(e)}},mj=function(e,r){return va(e),ha(r)&&r.constructor===e?r:((0,(e=lj.f(e)).resolve)(r),e.promise)},ov=function(e,r){var s=y.console;s&&s.error&&(arguments.length===1?s.error(e):s.error(e,r))},nj=function(e){try{return{error:!1,value:e()}}catch(r){return{error:!0,value:r}}},pv=typeof window=="object",qv=qa("species"),go=Za.get,rv=Za.set,sv=Za.getterFor("Promise"),Nd=Fc&&Fc.prototype,zb=Fc,bh=Nd,ho=y.TypeError,oj=y.document,pj=y.process,He=lj.f,tv=He,uv=!!(oj&&oj.createEvent&&y.dispatchEvent),io=typeof PromiseRejectionEvent=="function",jo=!1,Nf=nc("Promise",function(){var e=Pi(zb)!==String(zb);if(!e&&id===66)return!0;if(51<=id&&/native code/.test(zb))return!1;var r=new zb(function(d){d(1)}),s=function(d){d(function(){},function(){})};return(r.constructor={})[qv]=s,!(jo=r.then(function(){})instanceof s)||!e&&pv&&!io}),vv=Nf||!Tg(function(e){zb.all(e).catch(function(){})}),ko=function(e){var r;return!(!ha(e)||typeof(r=e.then)!="function")&&r},qj=function(e,r){if(!e.notified){e.notified=!0;var s=e.reactions;fo(function(){for(var d=e.value,f=e.state==1,_=0;s.length>_;){var C,P=s[_++],x=f?P.ok:P.fail,B=P.resolve,_t=P.reject,ue=P.domain;try{if(x){if(f||(e.rejection===2&&wv(e),e.rejection=1),x===!0)var Wt=d;else if(ue&&ue.enter(),Wt=x(d),ue){ue.exit();var _n=!0}Wt===P.promise?_t(ho("Promise-chain cycle")):(C=ko(Wt))?C.call(Wt,B,_t):B(Wt)}else _t(d)}catch(_i){ue&&!_n&&ue.exit(),_t(_i)}}e.reactions=[],e.notified=!1,r&&!e.rejection&&xv(e)})}},lo=function(e,r,s){var d;if(uv){var f=oj.createEvent("Event");f.promise=r,f.reason=s,f.initEvent(e,!1,!0),y.dispatchEvent(f)}else f={promise:r,reason:s};!io&&(d=y["on"+e])?d(f):e==="unhandledrejection"&&ov("Unhandled promise rejection",s)},xv=function(e){jj.call(y,function(){var r=e.facade,s=e.value;if(e.rejection!==1&&!e.parent){var d=nj(function(){Hc?pj.emit("unhandledRejection",s,r):lo("unhandledrejection",r,s)});if(e.rejection=Hc||e.rejection!==1&&!e.parent?2:1,d.error)throw d.value}})},wv=function(e){jj.call(y,function(){var r=e.facade;Hc?pj.emit("rejectionHandled",r):lo("rejectionhandled",r,e.value)})},Ie=function(e,r,s){return function(d){e(r,d,s)}},Je=function(e,r,s){e.done||(e.done=!0,s&&(e=s),e.value=r,e.state=2,qj(e,!0))},rj=function(e,r,s){if(!e.done){e.done=!0,s&&(e=s);try{if(e.facade===r)throw ho("Promise can't be resolved itself");var d=ko(r);d?fo(function(){var f={done:!1};try{d.call(r,Ie(rj,f,e),Ie(Je,f,e))}catch(_){Je(f,_,e)}}):(e.value=r,e.state=1,qj(e,!1))}catch(f){Je({done:!1},f,e)}}};if(Nf){zb=function(e){Gc(this,zb,"Promise"),yb(e),sj.call(this);var r=go(this);try{e(Ie(rj,r),Ie(Je,r))}catch(s){Je(r,s)}},bh=zb.prototype;var sj=function(e){rv(this,{type:"Promise",done:!1,notified:!1,parent:!1,reactions:[],rejection:!1,state:0,value:void 0})};sj.prototype=Hf(bh,{then:function(e,r){var s=sv(this),d=He(kd(this,zb));return d.ok=typeof e!="function"||e,d.fail=typeof r=="function"&&r,d.domain=Hc?pj.domain:void 0,s.parent=!0,s.reactions.push(d),s.state!=0&&qj(s,!1),d.promise},catch:function(e){return this.then(void 0,e)}});var yv=function(){var e=new sj,r=go(e);this.promise=e,this.resolve=Ie(rj,r),this.reject=Ie(Je,r)};if(lj.f=He=function(e){return e===zb||e===zv?new yv(e):tv(e)},typeof Fc=="function"&&Nd!==Object.prototype){var Av=Nd.then;jo||(Ta(Nd,"then",function(e,r){var s=this;return new zb(function(d,f){Av.call(s,d,f)}).then(e,r)},{unsafe:!0}),Ta(Nd,"catch",bh.catch,{unsafe:!0}));try{delete Nd.constructor}catch{}Ua&&Ua(Nd,bh)}}N({global:!0,wrap:!0,forced:Nf},{Promise:zb}),Ec(zb,"Promise",!1),If("Promise");var zv=mc("Promise");N({target:"Promise",stat:!0,forced:Nf},{reject:function(e){var r=He(this);return r.reject.call(void 0,e),r.promise}}),N({target:"Promise",stat:!0,forced:Nf},{resolve:function(e){return mj(this,e)}}),N({target:"Promise",stat:!0,forced:vv},{all:function(e){var r=this,s=He(r),d=s.resolve,f=s.reject,_=nj(function(){var C=yb(r.resolve),P=[],x=0,B=1;Xg(e,function(_t){var ue=x++,Wt=!1;P.push(void 0),B++,C.call(r,_t).then(function(_n){Wt||(Wt=!0,P[ue]=_n,--B||d(P))},f)}),--B||d(P)});return _.error&&f(_.value),s.promise},race:function(e){var r=this,s=He(r),d=s.reject,f=nj(function(){var _=yb(r.resolve);Xg(e,function(C){_.call(r,C).then(s.resolve,d)})});return f.error&&d(f.value),s.promise}});var mo=[].indexOf,no=!!mo&&0>1/[1].indexOf(1,-0),Bv=Ee("indexOf");N({target:"Array",proto:!0,forced:no||!Bv},{indexOf:function(e){return no?mo.apply(this,arguments)||0:Si(this,e,1<arguments.length?arguments[1]:void 0)}});var tj=function(){var e=va(this),r="";return e.global&&(r+="g"),e.ignoreCase&&(r+="i"),e.multiline&&(r+="m"),e.dotAll&&(r+="s"),e.unicode&&(r+="u"),e.sticky&&(r+="y"),r},pc=R(function(){var e=RegExp("a","y");return e.lastIndex=2,e.exec("abcd")!=null}),Cv=R(function(){var e=RegExp("^r","gy");return e.lastIndex=2,e.exec("str")!=null}),ch=RegExp.prototype.exec,Dv=fd("native-string-replace",String.prototype.replace),oo=ch,uj=(c=/a/,a=/b*/g,ch.call(c,"a"),ch.call(a,"a"),c.lastIndex!==0||a.lastIndex!==0),po=pc||Cv,vj=/()??/.exec("")[1]!==void 0,c,a;(uj||vj||po)&&(oo=function(e){var r,s=po&&this.sticky,d=tj.call(this),f=this.source,_=0,C=e;if(s){(d=d.replace("y","")).indexOf("g")===-1&&(d+="g"),C=String(e).slice(this.lastIndex),0<this.lastIndex&&(!this.multiline||this.multiline&&e[this.lastIndex-1]!==`
`)&&(f="(?: "+f+")",C=" "+C,_++);var P=new RegExp("^(?:"+f+")",d)}if(vj&&(P=new RegExp("^"+f+"$(?!\\s)",d)),uj)var x=this.lastIndex;var B=ch.call(s?P:this,C);return s?B?(B.input=B.input.slice(_),B[0]=B[0].slice(_),B.index=this.lastIndex,this.lastIndex+=B[0].length):this.lastIndex=0:uj&&B&&(this.lastIndex=this.global?B.index+B[0].length:x),vj&&B&&1<B.length&&Dv.call(B[0],P,function(){for(r=1;r<arguments.length-2;r++)arguments[r]===void 0&&(B[r]=void 0)}),B});var Of=oo;N({target:"RegExp",proto:!0,forced:/./.exec!==Of},{exec:Of});var Ev=qa("species"),wj=RegExp.prototype,Fv=!R(function(){var e=/./;return e.exec=function(){var r=[];return r.groups={a:"7"},r},"".replace(e,"$<a>")!=="7"}),qo="a".replace(/./,"$0")==="$0",ro=qa("replace"),so=!!/./[ro]&&/./[ro]("a","$0")==="",Gv=!R(function(){var e=/(?:)/,r=e.exec;return e.exec=function(){return r.apply(this,arguments)},(e="ab".split(e)).length!==2||e[0]!=="a"||e[1]!=="b"}),dh=function(e,r,s,d){var f=qa(e),_=!R(function(){var B={};return B[f]=function(){return 7},""[e](B)!=7}),C=_&&!R(function(){var B=!1,_t=/a/;return e==="split"&&((_t={constructor:{}}).constructor[Ev]=function(){return _t},_t.flags="",_t[f]=/./[f]),_t.exec=function(){return B=!0,null},_t[f](""),!B});if(!_||!C||e==="replace"&&(!Fv||!qo||so)||e==="split"&&!Gv){var P=/./[f],x=(s=s(f,""[e],function(B,_t,ue,Wt,_n){var _i=_t.exec;return _i===Of||_i===wj.exec?_&&!_n?{done:!0,value:P.call(_t,ue,Wt)}:{done:!0,value:B.call(ue,_t,Wt)}:{done:!1}},{REPLACE_KEEPS_$0:qo,REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE:so}))[1];Ta(String.prototype,e,s[0]),Ta(wj,f,r==2?function(B,_t){return x.call(B,this,_t)}:function(B){return x.call(B,this)})}d&&Na(wj[f],"sham",!0)},xj=function(e,r,s){return r+(s?Gn(e,r).length:1)},Hv=Math.floor,Iv="".replace,Jv=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,Kv=/\$([$&'`]|\d{1,2})/g,Lv=function(e,r,s,d,f,_){var C=s+e.length,P=d.length,x=Kv;return f!==void 0&&(f=Qa(f),x=Jv),Iv.call(_,x,function(B,_t){switch(_t.charAt(0)){case"$":return"$";case"&":return e;case"`":return r.slice(0,s);case"'":return r.slice(C);case"<":B=f[_t.slice(1,-1)];break;default:var ue=+_t;if(ue===0)return B;if(ue>P)return(ue=Hv(ue/10))===0?B:ue<=P?d[ue-1]===void 0?_t.charAt(1):d[ue-1]+_t.charAt(1):B;B=d[ue-1]}return B===void 0?"":B})},Ke=function(e,r){var s=e.exec;if(typeof s=="function"){if(typeof(e=s.call(e,r))!="object")throw TypeError("RegExp exec method returned something other than an Object or null");return e}if(Zb(e)!=="RegExp")throw TypeError("RegExp#exec called on incompatible receiver");return Of.call(e,r)},Mv=Math.max,Nv=Math.min,Ov=function(e){return e===void 0?e:String(e)};dh("replace",2,function(e,r,s,d){var f=d.REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE,_=d.REPLACE_KEEPS_$0,C=f?"$":"$0";return[function(P,x){var B=jb(this),_t=P==null?void 0:P[e];return _t!==void 0?_t.call(P,B,x):r.call(String(B),P,x)},function(P,x){if(!f&&_||typeof x=="string"&&x.indexOf(C)===-1){var B=s(r,P,this,x);if(B.done)return B.value}var _t=va(P);P=String(this),(B=typeof x=="function")||(x=String(x));var ue=_t.global;if(ue){var Wt=_t.unicode;_t.lastIndex=0}for(var _n=[];;){var _i=Ke(_t,P);if(_i===null||(_n.push(_i),!ue))break;String(_i[0])===""&&(_t.lastIndex=xj(P,ta(_t.lastIndex),Wt))}for(Wt="",ue=_t=0;ue<_n.length;ue++){_i=_n[ue];for(var Ei=String(_i[0]),_a=Mv(Nv($b(_i.index),P.length),0),Di=[],_o=1;_o<_i.length;_o++)Di.push(Ov(_i[_o]));_i=_i.groups,B?(Di=[Ei].concat(Di,_a,P),_i!==void 0&&Di.push(_i),_i=String(x.apply(void 0,Di))):_i=Lv(Ei,P,_a,Di,_i,x),_a>=_t&&(Wt+=P.slice(_t,_a)+_i,_t=_a+Ei.length)}return Wt+P.slice(_t)}]});var Pv=Ef("slice"),Qv=qa("species"),Rv=[].slice,Sv=Math.max;N({target:"Array",proto:!0,forced:!Pv},{slice:function(e,r){var s=qb(this),d=ta(s.length);if(e=xb(e,d),r=xb(r===void 0?d:r,d),gd(s)){var f=s.constructor;if(typeof f!="function"||f!==Array&&!gd(f.prototype)?ha(f)&&(f=f[Qv])===null&&(f=void 0):f=void 0,f===Array||f===void 0)return Rv.call(s,e,r)}for(f=new(f===void 0?Array:f)(Sv(r-e,0)),d=0;e<r;e++,d++)e in s&&Ge(f,d,s[e]);return f.length=d,f}});var Tv=Za.set,Uv=Za.getterFor("Array Iterator"),ld=bj(Array,"Array",function(e,r){Tv(this,{type:"Array Iterator",target:qb(e),index:0,kind:r})},function(){var e=Uv(this),r=e.target,s=e.kind,d=e.index++;return!r||d>=r.length?(e.target=void 0,{value:void 0,done:!0}):s=="keys"?{value:d,done:!1}:s=="values"?{value:r[d],done:!1}:{value:[d,r[d]],done:!1}},"values");Fe.Arguments=Fe.Array,Ld("keys"),Ld("values"),Ld("entries");var to=typeof ArrayBuffer<"u"&&typeof DataView<"u",Le=function(e){if(e===void 0)return 0;e=$b(e);var r=ta(e);if(e!==r)throw RangeError("Wrong length or index");return r},Vv=Math.abs,Ic=Math.pow,Wv=Math.floor,Xv=Math.log,Yv=Math.LN2,yj=function(e){var r=Qa(this),s=ta(r.length),d=arguments.length,f=xb(1<d?arguments[1]:void 0,s);for(s=(d=2<d?arguments[2]:void 0)===void 0?s:xb(d,s);s>f;)r[f++]=e;return r},Zv=Hd.f,$v=Ra.f,Me=Za.get,uo=Za.set,bc=y.ArrayBuffer,Ab=bc,cc=y.DataView,eh=cc&&cc.prototype,vo=Object.prototype,fh=y.RangeError,wo=function(e,r,s){var d,f=Array(s),_=(1<<(s=8*s-r-1))-1,C=_>>1,P=r===23?Ic(2,-24)-Ic(2,-77):0,x=0>e||e===0&&0>1/e?1:0,B=0;if((e=Vv(e))!=e||1/0===e){e=e!=e?1:0;var _t=_}else _t=Wv(Xv(e)/Yv),1>e*(d=Ic(2,-_t))&&(_t--,d*=2),2<=(e=1<=_t+C?e+P/d:e+P*Ic(2,1-C))*d&&(_t++,d/=2),_t+C>=_?(e=0,_t=_):1<=_t+C?(e=(e*d-1)*Ic(2,r),_t+=C):(e=e*Ic(2,C-1)*Ic(2,r),_t=0);for(;8<=r;f[B++]=255&e,e/=256,r-=8);for(_t=_t<<r|e,s+=r;0<s;f[B++]=255&_t,_t/=256,s-=8);return f[--B]|=128*x,f},xo=function(e,r){var s=e.length,d=8*s-r-1,f=(1<<d)-1,_=f>>1;d-=7,--s;var C=e[s--],P=127&C;for(C>>=7;0<d;P=256*P+e[s],s--,d-=8);var x=P&(1<<-d)-1;for(P>>=-d,d+=r;0<d;x=256*x+e[s],s--,d-=8);if(P===0)P=1-_;else{if(P===f)return x?NaN:C?-1/0:1/0;x+=Ic(2,r),P-=_}return(C?-1:1)*x*Ic(2,P-r)},yo=function(e){return[255&e]},zo=function(e){return[255&e,e>>8&255]},Ao=function(e){return[255&e,e>>8&255,e>>16&255,e>>24&255]},Bo=function(e){return e[3]<<24|e[2]<<16|e[1]<<8|e[0]},aw=function(e){return wo(e,23,4)},bw=function(e){return wo(e,52,8)},gh=function(e,r){$v(e.prototype,r,{get:function(){return Me(this)[r]}})},md=function(e,r,s,d){s=Le(s);var f=Me(e);if(s+r>f.byteLength)throw fh("Wrong index");return e=Me(f.buffer).bytes,s+=f.byteOffset,r=e.slice(s,s+r),d?r:r.reverse()},nd=function(e,r,s,d,f,_){s=Le(s);var C=Me(e);if(s+r>C.byteLength)throw fh("Wrong index");for(e=Me(C.buffer).bytes,s+=C.byteOffset,d=d(+f),f=0;f<r;f++)e[s+f]=d[_?f:r-f-1]};if(to){if(!R(function(){bc(1)})||!R(function(){new bc(-1)})||R(function(){return new bc,new bc(1.5),new bc(NaN),bc.name!="ArrayBuffer"})){Ab=function(e){return Gc(this,Ab),new bc(Le(e))};for(var cw=Ab.prototype=bc.prototype,Co=Zv(bc),Do=0,zj;Co.length>Do;)(zj=Co[Do++])in Ab||Na(Ab,zj,bc[zj]);cw.constructor=Ab}Ua&&Vb(eh)!==vo&&Ua(eh,vo);var hh=new cc(new Ab(2)),Eo=eh.setInt8;hh.setInt8(0,2147483648),hh.setInt8(1,2147483649),!hh.getInt8(0)&&hh.getInt8(1)||Hf(eh,{setInt8:function(e,r){Eo.call(this,e,r<<24>>24)},setUint8:function(e,r){Eo.call(this,e,r<<24>>24)}},{unsafe:!0})}else Ab=function(e){Gc(this,Ab,"ArrayBuffer"),e=Le(e),uo(this,{bytes:yj.call(Array(e),0),byteLength:e}),ka||(this.byteLength=e)},cc=function(e,r,s){Gc(this,cc,"DataView"),Gc(e,Ab,"DataView");var d=Me(e).byteLength;if(0>(r=$b(r))||r>d)throw fh("Wrong offset");if(r+(s=s===void 0?d-r:ta(s))>d)throw fh("Wrong length");uo(this,{buffer:e,byteLength:s,byteOffset:r}),ka||(this.buffer=e,this.byteLength=s,this.byteOffset=r)},ka&&(gh(Ab,"byteLength"),gh(cc,"buffer"),gh(cc,"byteLength"),gh(cc,"byteOffset")),Hf(cc.prototype,{getInt8:function(e){return md(this,1,e)[0]<<24>>24},getUint8:function(e){return md(this,1,e)[0]},getInt16:function(e){var r=md(this,2,e,1<arguments.length?arguments[1]:void 0);return(r[1]<<8|r[0])<<16>>16},getUint16:function(e){var r=md(this,2,e,1<arguments.length?arguments[1]:void 0);return r[1]<<8|r[0]},getInt32:function(e){return Bo(md(this,4,e,1<arguments.length?arguments[1]:void 0))},getUint32:function(e){return Bo(md(this,4,e,1<arguments.length?arguments[1]:void 0))>>>0},getFloat32:function(e){return xo(md(this,4,e,1<arguments.length?arguments[1]:void 0),23)},getFloat64:function(e){return xo(md(this,8,e,1<arguments.length?arguments[1]:void 0),52)},setInt8:function(e,r){nd(this,1,e,yo,r)},setUint8:function(e,r){nd(this,1,e,yo,r)},setInt16:function(e,r){nd(this,2,e,zo,r,2<arguments.length?arguments[2]:void 0)},setUint16:function(e,r){nd(this,2,e,zo,r,2<arguments.length?arguments[2]:void 0)},setInt32:function(e,r){nd(this,4,e,Ao,r,2<arguments.length?arguments[2]:void 0)},setUint32:function(e,r){nd(this,4,e,Ao,r,2<arguments.length?arguments[2]:void 0)},setFloat32:function(e,r){nd(this,4,e,aw,r,2<arguments.length?arguments[2]:void 0)},setFloat64:function(e,r){nd(this,8,e,bw,r,2<arguments.length?arguments[2]:void 0)}});Ec(Ab,"ArrayBuffer"),Ec(cc,"DataView");var Pf={ArrayBuffer:Ab,DataView:cc},Aj=Pf.ArrayBuffer,Fo=Pf.DataView,Go=Aj.prototype.slice,dw=R(function(){return!new Aj(2).slice(1,void 0).byteLength});N({target:"ArrayBuffer",proto:!0,unsafe:!0,forced:dw},{slice:function(e,r){if(Go!==void 0&&r===void 0)return Go.call(va(this),e);var s=va(this).byteLength;e=xb(e,s),r=xb(r===void 0?s:r,s),s=new(kd(this,Aj))(ta(r-e));for(var d=new Fo(this),f=new Fo(s),_=0;e<r;)f.setUint8(_++,d.getUint8(e++));return s}});var ew=Ra.f,ih=y.Int8Array,Bj=ih&&ih.prototype,Ho=y.Uint8ClampedArray,Io=Ho&&Ho.prototype,qc=ih&&Vb(ih),dc=Bj&&Vb(Bj),Jo=Object.prototype,Ko=Jo.isPrototypeOf,Lo=qa("toStringTag"),Cj=Ae("TYPED_ARRAY_TAG"),Jc=to&&!!Ua&&Ff(y.opera)!=="Opera",Mo=!1,Bb,rc={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},fw={BigInt64Array:8,BigUint64Array:8},jh=function(e){return!!ha(e)&&(e=Ff(e),Q(rc,e)||Q(fw,e))};for(Bb in rc)y[Bb]||(Jc=!1);if((!Jc||typeof qc!="function"||qc===Function.prototype)&&(qc=function(){throw TypeError("Incorrect invocation")},Jc))for(Bb in rc)y[Bb]&&Ua(y[Bb],qc);if((!Jc||!dc||dc===Jo)&&(dc=qc.prototype,Jc))for(Bb in rc)y[Bb]&&Ua(y[Bb].prototype,dc);if(Jc&&Vb(Io)!==dc&&Ua(Io,dc),ka&&!Q(dc,Lo))for(Bb in Mo=!0,ew(dc,Lo,{get:function(){return ha(this)?this[Cj]:void 0}}),rc)y[Bb]&&Na(y[Bb],Cj,Bb);var Qf=Jc,No=Mo&&Cj,Da=function(e){if(jh(e))return e;throw TypeError("Target is not a typed array")},Ne=function(e){if(Ua){if(Ko.call(qc,e))return e}else for(var r in rc)if(Q(rc,Bb)){var s=y[r];if(s&&(e===s||Ko.call(s,e)))return e}throw TypeError("Target is not a typed array constructor")},Aa=function(e,r,s){if(ka){if(s)for(var d in rc){var f=y[d];if(f&&Q(f.prototype,e))try{delete f.prototype[e]}catch{}}dc[e]&&!s||Ta(dc,e,s?r:Jc&&Bj[e]||r)}},Oo=function(e,r,s){var d,f;if(ka){if(Ua){if(s){for(d in rc)if((f=y[d])&&Q(f,e))try{delete f[e]}catch{}}if(qc[e]&&!s)return;try{return Ta(qc,e,s?r:Jc&&qc[e]||r)}catch{}}for(d in rc)!(f=y[d])||f[e]&&!s||Ta(f,e,r)}},Po=qc,Rf=dc,gw=y.ArrayBuffer,Od=y.Int8Array,Dj=!Qf||!R(function(){Od(1)})||!R(function(){new Od(-1)})||!Tg(function(e){new Od,new Od(null),new Od(1.5),new Od(e)},!0)||R(function(){return new Od(new gw(2),1,void 0).length!==1}),kh=function(e,r){if(0>(e=$b(e)))throw RangeError("The argument can't be less than 0");if(e%r)throw RangeError("Wrong offset");return e},Ej=function(e){var r=Qa(e),s=arguments.length,d=1<s?arguments[1]:void 0,f=d!==void 0,_=Xi(r);if(_!=null&&!Vi(_)){var C=_.call(r),P=C.next;for(r=[];!(_=P.call(C)).done;)r.push(_.value)}for(f&&2<s&&(d=Id(d,arguments[2],2)),_=ta(r.length),C=new(Ne(this))(_),s=0;_>s;s++)C[s]=f?d(r[s],s):r[s];return C},lh=function(e,r,s){var d,f;return Ua&&typeof(d=r.constructor)=="function"&&d!==s&&ha(f=d.prototype)&&f!==s.prototype&&Ua(e,f),e},Sf=$a(function(e){var r=Hd.f,s=Za.get,d=Za.set,f=Ra.f,_=Fb.f,C=Math.round,P=y.RangeError,x=Pf.ArrayBuffer,B=Pf.DataView,_t=function(_a,Di){var _o=0,_s=Di.length;for(_a=new(Ne(_a))(_s);_s>_o;)_a[_o]=Di[_o++];return _a},ue=function(_a,Di){f(_a,Di,{get:function(){return s(this)[Di]}})},Wt=function(_a){var Di;return _a instanceof x||(Di=Ff(_a))=="ArrayBuffer"||Di=="SharedArrayBuffer"},_n=function(_a,Di){return jh(_a)&&typeof Di!="symbol"&&Di in _a&&String(+Di)==String(Di)},_i=function(_a,Di){return _n(_a,Di=lc(Di,!0))?dd(2,_a[Di]):_(_a,Di)},Ei=function(_a,Di,_o){return!(_n(_a,Di=lc(Di,!0))&&ha(_o)&&Q(_o,"value"))||Q(_o,"get")||Q(_o,"set")||_o.configurable||Q(_o,"writable")&&!_o.writable||Q(_o,"enumerable")&&!_o.enumerable?f(_a,Di,_o):(_a[Di]=_o.value,_a)};ka?(Qf||(Fb.f=_i,Ra.f=Ei,ue(Rf,"buffer"),ue(Rf,"byteOffset"),ue(Rf,"byteLength"),ue(Rf,"length")),N({target:"Object",stat:!0,forced:!Qf},{getOwnPropertyDescriptor:_i,defineProperty:Ei}),e.exports=function(_a,Di,_o){var _s=_a.match(/\d+$/)[0]/8,_c=_a+(_o?"Clamped":"")+"Array",_m="get"+_a,Qm="set"+_a,tE=y[_c],aE=tE;_a=aE&&aE.prototype;var CE={},lE=function(gE,cE){f(gE,cE,{get:function(){var _E=s(this);return _E.view[_m](cE*_s+_E.byteOffset,!0)},set:function(_E){var iE=s(this);_o&&(_E=0>(_E=C(_E))?0:255<_E?255:255&_E),iE.view[Qm](cE*_s+iE.byteOffset,_E,!0)},enumerable:!0})};Qf?Dj&&(aE=Di(function(gE,cE,_E,iE){return Gc(gE,aE,_c),lh(ha(cE)?Wt(cE)?iE!==void 0?new tE(cE,kh(_E,_s),iE):_E!==void 0?new tE(cE,kh(_E,_s)):new tE(cE):jh(cE)?_t(aE,cE):Ej.call(aE,cE):new tE(Le(cE)),gE,aE)}),Ua&&Ua(aE,Po),Jd(r(tE),function(gE){gE in aE||Na(aE,gE,tE[gE])}),aE.prototype=_a):(aE=Di(function(gE,cE,_E,iE){Gc(gE,aE,_c);var rE=0,vf=0;if(ha(cE)){if(!Wt(cE))return jh(cE)?_t(aE,cE):Ej.call(aE,cE);var Fg=cE;if(vf=kh(_E,_s),cE=cE.byteLength,iE===void 0){if(cE%_s||0>(iE=cE-vf))throw P("Wrong length")}else if((iE=ta(iE)*_s)+vf>cE)throw P("Wrong length");cE=iE/_s}else cE=Le(cE),Fg=new x(iE=cE*_s);for(d(gE,{buffer:Fg,byteOffset:vf,byteLength:iE,length:cE,view:new B(Fg)});rE<cE;)lE(gE,rE++)}),Ua&&Ua(aE,Po),_a=aE.prototype=ac(Rf)),_a.constructor!==aE&&Na(_a,"constructor",aE),No&&Na(_a,No,_c),CE[_c]=aE,N({global:!0,forced:aE!=tE,sham:!Qf},CE),"BYTES_PER_ELEMENT"in aE||Na(aE,"BYTES_PER_ELEMENT",_s),"BYTES_PER_ELEMENT"in _a||Na(_a,"BYTES_PER_ELEMENT",_s),If(_c)}):e.exports=function(){}});Sf("Uint8",function(e){return function(r,s,d){return e(this,r,s,d)}});var hw=Math.min,iw=[].copyWithin||function(e,r){var s=Qa(this),d=ta(s.length),f=xb(e,d),_=xb(r,d),C=2<arguments.length?arguments[2]:void 0;for(d=hw((C===void 0?d:xb(C,d))-_,d-f),C=1,_<f&&f<_+d&&(C=-1,_+=d-1,f+=d-1);0<d--;)_ in s?s[f]=s[_]:delete s[f],f+=C,_+=C;return s};Aa("copyWithin",function(e,r){return iw.call(Da(this),e,r,2<arguments.length?arguments[2]:void 0)}),Aa("every",function(e){return Ju(Da(this),e,1<arguments.length?arguments[1]:void 0)}),Aa("fill",function(e){return yj.apply(Da(this),arguments)}),Aa("filter",function(e){var r=yn(Da(this),e,1<arguments.length?arguments[1]:void 0),s=kd(this,this.constructor),d=0,f=r.length;for(s=new(Ne(s))(f);f>d;)s[d]=r[d++];return s}),Aa("find",function(e){return zn(Da(this),e,1<arguments.length?arguments[1]:void 0)}),Aa("findIndex",function(e){return An(Da(this),e,1<arguments.length?arguments[1]:void 0)}),Aa("forEach",function(e){Jd(Da(this),e,1<arguments.length?arguments[1]:void 0)}),Aa("includes",function(e){return on(Da(this),e,1<arguments.length?arguments[1]:void 0)}),Aa("indexOf",function(e){return Si(Da(this),e,1<arguments.length?arguments[1]:void 0)});var Qo=qa("iterator"),Ro=y.Uint8Array,jw=ld.values,kw=ld.keys,lw=ld.entries,Fj=Ro&&Ro.prototype[Qo],So=!!Fj&&(Fj.name=="values"||Fj.name==null),To=function(){return jw.call(Da(this))};Aa("entries",function(){return lw.call(Da(this))}),Aa("keys",function(){return kw.call(Da(this))}),Aa("values",To,!So),Aa(Qo,To,!So);var mw=[].join;Aa("join",function(e){return mw.apply(Da(this),arguments)});var nw=Math.min,Gj=[].lastIndexOf,Uo=!!Gj&&0>1/[1].lastIndexOf(1,-0),ow=Ee("lastIndexOf"),pw=Uo||!ow?function(e){if(Uo)return Gj.apply(this,arguments)||0;var r=qb(this),s=ta(r.length),d=s-1;for(1<arguments.length&&(d=nw(d,$b(arguments[1]))),0>d&&(d=s+d);0<=d;d--)if(d in r&&r[d]===e)return d||0;return-1}:Gj;Aa("lastIndexOf",function(e){return pw.apply(Da(this),arguments)}),Aa("map",function(e){return xn(Da(this),e,1<arguments.length?arguments[1]:void 0,function(r,s){return new(Ne(kd(r,r.constructor)))(s)})});var Vo=function(e){return function(r,s,d,f){yb(s),r=Qa(r);var _=Af(r),C=ta(r.length),P=e?C-1:0,x=e?-1:1;if(2>d)for(;;){if(P in _){f=_[P],P+=x;break}if(P+=x,e?0>P:C<=P)throw TypeError("Reduce of empty array with no initial value")}for(;e?0<=P:C>P;P+=x)P in _&&(f=s(f,_[P],P,r));return f}},Wo=Vo(!1),qw=Vo(!0);Aa("reduce",function(e){return Wo(Da(this),e,arguments.length,1<arguments.length?arguments[1]:void 0)}),Aa("reduceRight",function(e){return qw(Da(this),e,arguments.length,1<arguments.length?arguments[1]:void 0)});var rw=Math.floor;Aa("reverse",function(){for(var e,r=Da(this).length,s=rw(r/2),d=0;d<s;)e=this[d],this[d++]=this[--r],this[r]=e;return this});var sw=R(function(){new Int8Array(1).set({})});Aa("set",function(e){Da(this);var r=kh(1<arguments.length?arguments[1]:void 0,1),s=this.length,d=Qa(e),f=ta(d.length),_=0;if(f+r>s)throw RangeError("Wrong length");for(;_<f;)this[r+_]=d[_++]},sw);var tw=[].slice,uw=R(function(){new Int8Array(1).slice()});Aa("slice",function(e,r){e=tw.call(Da(this),e,r);var s=kd(this,this.constructor);r=0;var d=e.length;for(s=new(Ne(s))(d);d>r;)s[r]=e[r++];return s},uw),Aa("some",function(e){return Iu(Da(this),e,1<arguments.length?arguments[1]:void 0)});var vw=[].sort;Aa("sort",function(e){return vw.call(Da(this),e)}),Aa("subarray",function(e,r){var s=Da(this),d=s.length;return e=xb(e,d),new(kd(s,s.constructor))(s.buffer,s.byteOffset+e*s.BYTES_PER_ELEMENT,ta((r===void 0?d:xb(r,d))-e))});var mh=y.Int8Array,Xo=[].toLocaleString,ww=[].slice,xw=!!mh&&R(function(){Xo.call(new mh(1))}),yw=R(function(){return[1,2].toLocaleString()!=new mh([1,2]).toLocaleString()})||!R(function(){mh.prototype.toLocaleString.call([1,2])});Aa("toLocaleString",function(){return Xo.apply(xw?ww.call(Da(this)):Da(this),arguments)},yw);var Yo=y.Uint8Array,zw=Yo&&Yo.prototype||{},nh=[].toString,Aw=[].join;R(function(){nh.call({})})&&(nh=function(){return Aw.call(this)}),Aa("toString",nh,zw.toString!=nh);var Zo=Pf.ArrayBuffer;N({global:!0,forced:y.ArrayBuffer!==Zo},{ArrayBuffer:Zo}),If("ArrayBuffer");var Bw=Ra.f,Hj=Function.prototype,Cw=Hj.toString,Dw=/^\s*function ([^ (]*)/;!ka||"name"in Hj||Bw(Hj,"name",{configurable:!0,get:function(){try{return Cw.call(this).match(Dw)[1]}catch{return""}}});var $o=RegExp.prototype,ap=$o.toString,Ew=R(function(){return ap.call({source:"a",flags:"b"})!="/a/b"}),Fw=ap.name!="toString";(Ew||Fw)&&Ta(RegExp.prototype,"toString",function(){var e=va(this),r=String(e.source),s=e.flags;return"/"+r+"/"+(e=String(s===void 0&&e instanceof RegExp&&!("flags"in $o)?tj.call(e):s))},{unsafe:!0});var Gw=Ef("splice"),Hw=Math.max,Iw=Math.min;N({target:"Array",proto:!0,forced:!Gw},{splice:function(e,r){var s,d,f=Qa(this),_=ta(f.length),C=xb(e,_),P=arguments.length;if(P===0?P=s=0:P===1?(P=0,s=_-C):(P-=2,s=Iw(Hw($b(r),0),_-C)),9007199254740991<_+P-s)throw TypeError("Maximum allowed length exceeded");var x=Sg(f,s);for(d=0;d<s;d++){var B=C+d;B in f&&Ge(x,d,f[B])}if(x.length=s,P<s){for(d=C;d<_-s;d++){var _t=d+P;(B=d+s)in f?f[_t]=f[B]:delete f[_t]}for(d=_;d>_-s+P;d--)delete f[d-1]}else if(P>s)for(d=_-s;d>C;d--)_t=d+P-1,(B=d+s-1)in f?f[_t]=f[B]:delete f[_t];for(d=0;d<P;d++)f[d+C]=arguments[d+2];return f.length=_-s+P,x}});var Ij={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},Jj=qa("iterator"),bp=qa("toStringTag"),Kj=ld.values,oh;for(oh in Ij){var cp=y[oh],Kc=cp&&cp.prototype;if(Kc){if(Kc[Jj]!==Kj)try{Na(Kc,Jj,Kj)}catch{Kc[Jj]=Kj}if(Kc[bp]||Na(Kc,bp,oh),Ij[oh]){for(var Oe in ld)if(Kc[Oe]!==ld[Oe])try{Na(Kc,Oe,ld[Oe])}catch{Kc[Oe]=ld[Oe]}}}}var dp=Object.is||function(e,r){return e===r?e!==0||1/e==1/r:e!=e&&r!=r};dh("search",1,function(e,r,s){return[function(d){var f=jb(this),_=d==null?void 0:d[e];return _!==void 0?_.call(d,f):new RegExp(d)[e](String(f))},function(d){var f=s(r,d,this);if(f.done)return f.value;d=va(d);var _=String(this);return f=d.lastIndex,dp(f,0)||(d.lastIndex=0),_=Ke(d,_),dp(d.lastIndex,f)||(d.lastIndex=f),_===null?-1:_.index}]}),$a(function(e){(function(r,s){e.exports?e.exports=s(r):s(r)})(typeof self<"u"?self:Ya,function(r){function s(lE){return btoa(lE).replace(/=+$/,"").replace(/\+/g,"-").replace(/\//g,"_")}function d(lE){return lE=(lE+="===").slice(0,-lE.length%4),atob(lE.replace(/-/g,"+").replace(/_/g,"/"))}function f(lE){for(var gE=new Uint8Array(lE.length),cE=0;cE<lE.length;cE++)gE[cE]=lE.charCodeAt(cE);return gE}function _(lE){return lE instanceof ArrayBuffer&&(lE=new Uint8Array(lE)),String.fromCharCode.apply(String,lE)}function C(lE){var gE={name:(lE.name||lE||"").toUpperCase().replace("V","v")};switch(gE.name){case"SHA-1":case"SHA-256":case"SHA-384":case"SHA-512":break;case"AES-CBC":case"AES-GCM":case"AES-KW":lE.length&&(gE.length=lE.length);break;case"HMAC":lE.hash&&(gE.hash=C(lE.hash)),lE.length&&(gE.length=lE.length);break;case"RSAES-PKCS1-v1_5":lE.publicExponent&&(gE.publicExponent=new Uint8Array(lE.publicExponent)),lE.modulusLength&&(gE.modulusLength=lE.modulusLength);break;case"RSASSA-PKCS1-v1_5":case"RSA-OAEP":lE.hash&&(gE.hash=C(lE.hash)),lE.publicExponent&&(gE.publicExponent=new Uint8Array(lE.publicExponent)),lE.modulusLength&&(gE.modulusLength=lE.modulusLength);break;default:throw new SyntaxError("Bad algorithm name")}return gE}function P(lE){return{HMAC:{"SHA-1":"HS1","SHA-256":"HS256","SHA-384":"HS384","SHA-512":"HS512"},"RSASSA-PKCS1-v1_5":{"SHA-1":"RS1","SHA-256":"RS256","SHA-384":"RS384","SHA-512":"RS512"},"RSAES-PKCS1-v1_5":{"":"RSA1_5"},"RSA-OAEP":{"SHA-1":"RSA-OAEP","SHA-256":"RSA-OAEP-256"},"AES-KW":{128:"A128KW",192:"A192KW",256:"A256KW"},"AES-GCM":{128:"A128GCM",192:"A192GCM",256:"A256GCM"},"AES-CBC":{128:"A128CBC",192:"A192CBC",256:"A256CBC"}}[lE.name][(lE.hash||{}).name||lE.length||""]}function x(lE){(lE instanceof ArrayBuffer||lE instanceof Uint8Array)&&(lE=JSON.parse(decodeURIComponent(escape(_(lE)))));var gE={kty:lE.kty,alg:lE.alg,ext:lE.ext||lE.extractable};switch(gE.kty){case"oct":gE.k=lE.k;case"RSA":"n e d p q dp dq qi oth".split(" ").forEach(function(cE){cE in lE&&(gE[cE]=lE[cE])});break;default:throw new TypeError("Unsupported key type")}return gE}function B(lE){return lE=x(lE),_m&&(lE.extractable=lE.ext,delete lE.ext),f(unescape(encodeURIComponent(JSON.stringify(lE)))).buffer}function _t(lE){var gE=ue(lE),cE=!1;switch(2<gE.length&&(cE=!0,gE.shift()),lE={ext:!0},gE[0][0]){case"1.2.840.113549.1.1.1":var _E="n e d p q dp dq qi".split(" ");for(gE=ue(gE[1]),cE&&gE.shift(),cE=0;cE<gE.length;cE++)gE[cE][0]||(gE[cE]=gE[cE].subarray(1)),lE[_E[cE]]=s(_(gE[cE]));lE.kty="RSA";break;default:throw new TypeError("Unsupported key type")}return lE}function ue(lE,gE){if(lE instanceof ArrayBuffer&&(lE=new Uint8Array(lE)),gE||(gE={pos:0,end:lE.length}),2>gE.end-gE.pos||gE.end>lE.length)throw new RangeError("Malformed DER");var cE=lE[gE.pos++],_E=lE[gE.pos++];if(128<=_E){if(_E&=127,gE.end-gE.pos<_E)throw new RangeError("Malformed DER");for(var iE=0;_E--;)iE<<=8,iE|=lE[gE.pos++];_E=iE}if(gE.end-gE.pos<_E)throw new RangeError("Malformed DER");switch(cE){case 2:cE=lE.subarray(gE.pos,gE.pos+=_E);break;case 3:if(lE[gE.pos++])throw Error("Unsupported bit string");_E--;case 4:cE=new Uint8Array(lE.subarray(gE.pos,gE.pos+=_E)).buffer;break;case 5:cE=null;break;case 6:if(!((lE=btoa(_(lE.subarray(gE.pos,gE.pos+=_E))))in tE))throw Error("Unsupported OBJECT ID "+lE);cE=tE[lE];break;case 48:for(cE=[],_E=gE.pos+_E;gE.pos<_E;)cE.push(ue(lE,gE));break;default:throw Error("Unsupported DER tag 0x"+cE.toString(16))}return cE}function Wt(lE,gE){gE||(gE=[]);var cE=gE.length+2;if(gE.push(0,0),lE instanceof Uint8Array)for(var _E=2,iE=lE.length,rE=0;rE<iE;rE++)gE.push(lE[rE]);else if(lE instanceof ArrayBuffer)for(_E=4,iE=lE.byteLength,lE=new Uint8Array(lE),rE=0;rE<iE;rE++)gE.push(lE[rE]);else if(lE===null)_E=5,iE=0;else if(typeof lE=="string"&&lE in aE)for(_E=6,iE=(lE=f(atob(aE[lE]))).length,rE=0;rE<iE;rE++)gE.push(lE[rE]);else if(lE instanceof Array){for(rE=0;rE<lE.length;rE++)Wt(lE[rE],gE);_E=48,iE=gE.length-cE}else{if(!(X(lE)==="object"&&lE.tag===3&&lE.value instanceof ArrayBuffer))throw Error("Unsupported DER value "+lE);for(_E=3,iE=(lE=new Uint8Array(lE.value)).byteLength,gE.push(0),rE=0;rE<iE;rE++)gE.push(lE[rE]);iE++}if(128<=iE){for(rE=iE,iE=4,gE.splice(cE,0,rE>>24&255,rE>>16&255,rE>>8&255,255&rE);1<iE&&!(rE>>24);)rE<<=8,iE--;4>iE&&gE.splice(cE,4-iE),iE|=128}return gE.splice(cE-2,2,_E,iE),gE}function _n(lE,gE,cE,_E){Object.defineProperties(this,{_key:{value:lE},type:{value:lE.type,enumerable:!0},extractable:{value:cE===void 0?lE.extractable:cE,enumerable:!0},algorithm:{value:gE===void 0?lE.algorithm:gE,enumerable:!0},usages:{value:_E===void 0?lE.usages:_E,enumerable:!0}})}function _i(lE){return lE==="verify"||lE==="encrypt"||lE==="wrapKey"}function Ei(lE){return lE==="sign"||lE==="decrypt"||lE==="unwrapKey"}if(typeof Promise!="function")throw"Promise support required";var _a=r.crypto||r.msCrypto;if(_a){var Di=_a.subtle||_a.webkitSubtle;if(Di){var _o=r.Crypto||_a.constructor||Object,_s=r.SubtleCrypto||Di.constructor||Object;r.CryptoKey||r.Key;var _c=-1<r.navigator.userAgent.indexOf("Edge/"),_m=!!r.msCrypto&&!_c,Qm=!_a.subtle&&!!_a.webkitSubtle;if(_m||Qm){var tE={KoZIhvcNAQEB:"1.2.840.113549.1.1.1"},aE={"1.2.840.113549.1.1.1":"KoZIhvcNAQEB"};if(["generateKey","importKey","unwrapKey"].forEach(function(lE){var gE=Di[lE];Di[lE]=function(cE,_E,iE){var rE=[].slice.call(arguments);switch(lE){case"generateKey":var vf=C(cE),Fg=_E,_d=iE;break;case"importKey":vf=C(iE),Fg=rE[3],_d=rE[4],cE==="jwk"&&((_E=x(_E)).alg||(_E.alg=P(vf)),_E.key_ops||(_E.key_ops=_E.kty!=="oct"?"d"in _E?_d.filter(Ei):_d.filter(_i):_d.slice()),rE[1]=B(_E));break;case"unwrapKey":vf=rE[4],Fg=rE[5],_d=rE[6],rE[2]=iE._key}if(lE==="generateKey"&&vf.name==="HMAC"&&vf.hash)return vf.length=vf.length||{"SHA-1":512,"SHA-256":512,"SHA-384":1024,"SHA-512":1024}[vf.hash.name],Di.importKey("raw",_a.getRandomValues(new Uint8Array(vf.length+7>>3)),vf,Fg,_d);if(Qm&&lE==="generateKey"&&vf.name==="RSASSA-PKCS1-v1_5"&&(!vf.modulusLength||2048<=vf.modulusLength))return(cE=C(cE)).name="RSAES-PKCS1-v1_5",delete cE.hash,Di.generateKey(cE,!0,["encrypt","decrypt"]).then(function(uE){return Promise.all([Di.exportKey("jwk",uE.publicKey),Di.exportKey("jwk",uE.privateKey)])}).then(function(uE){return uE[0].alg=uE[1].alg=P(vf),uE[0].key_ops=_d.filter(_i),uE[1].key_ops=_d.filter(Ei),Promise.all([Di.importKey("jwk",uE[0],vf,!0,uE[0].key_ops),Di.importKey("jwk",uE[1],vf,Fg,uE[1].key_ops)])}).then(function(uE){return{publicKey:uE[0],privateKey:uE[1]}});if((Qm||_m&&(vf.hash||{}).name==="SHA-1")&&lE==="importKey"&&cE==="jwk"&&vf.name==="HMAC"&&_E.kty==="oct")return Di.importKey("raw",f(d(_E.k)),iE,rE[3],rE[4]);if(Qm&&lE==="importKey"&&(cE==="spki"||cE==="pkcs8"))return Di.importKey("jwk",_t(_E),iE,rE[3],rE[4]);if(_m&&lE==="unwrapKey")return Di.decrypt(rE[3],iE,_E).then(function(uE){return Di.importKey(cE,uE,rE[4],rE[5],rE[6])});try{var _f=gE.apply(Di,rE)}catch(uE){return Promise.reject(uE)}return _m&&(_f=new Promise(function(uE,dE){_f.onabort=_f.onerror=function(IE){dE(IE)},_f.oncomplete=function(IE){uE(IE.target.result)}})),_f=_f.then(function(uE){return vf.name!=="HMAC"||vf.length||(vf.length=8*uE.algorithm.length),vf.name.search("RSA")==0&&(vf.modulusLength||(vf.modulusLength=(uE.publicKey||uE).algorithm.modulusLength),vf.publicExponent||(vf.publicExponent=(uE.publicKey||uE).algorithm.publicExponent)),uE.publicKey&&uE.privateKey?{publicKey:new _n(uE.publicKey,vf,Fg,_d.filter(_i)),privateKey:new _n(uE.privateKey,vf,Fg,_d.filter(Ei))}:new _n(uE,vf,Fg,_d)})}}),["exportKey","wrapKey"].forEach(function(lE){var gE=Di[lE];Di[lE]=function(cE,_E,iE){var rE=[].slice.call(arguments);switch(lE){case"exportKey":rE[1]=_E._key;break;case"wrapKey":rE[1]=_E._key,rE[2]=iE._key}if((Qm||_m&&(_E.algorithm.hash||{}).name==="SHA-1")&&lE==="exportKey"&&cE==="jwk"&&_E.algorithm.name==="HMAC"&&(rE[0]="raw"),!Qm||lE!=="exportKey"||cE!=="spki"&&cE!=="pkcs8"||(rE[0]="jwk"),_m&&lE==="wrapKey")return Di.exportKey(cE,_E).then(function(Fg){return cE==="jwk"&&(Fg=f(unescape(encodeURIComponent(JSON.stringify(x(Fg)))))),Di.encrypt(rE[3],iE,Fg)});try{var vf=gE.apply(Di,rE)}catch(Fg){return Promise.reject(Fg)}return _m&&(vf=new Promise(function(Fg,_d){vf.onabort=vf.onerror=function(_f){_d(_f)},vf.oncomplete=function(_f){Fg(_f.target.result)}})),lE==="exportKey"&&cE==="jwk"&&(vf=vf.then(function(Fg){return(Qm||_m&&(_E.algorithm.hash||{}).name==="SHA-1")&&_E.algorithm.name==="HMAC"?{kty:"oct",alg:P(_E.algorithm),key_ops:_E.usages.slice(),ext:!0,k:s(_(Fg))}:((Fg=x(Fg)).alg||(Fg.alg=P(_E.algorithm)),Fg.key_ops||(Fg.key_ops=_E.type==="public"?_E.usages.filter(_i):_E.type==="private"?_E.usages.filter(Ei):_E.usages.slice()),Fg)})),!Qm||lE!=="exportKey"||cE!=="spki"&&cE!=="pkcs8"||(vf=vf.then(function(Fg){var _d=[["",null]],_f=!1;switch((Fg=x(Fg)).kty){case"RSA":for(var uE="n e d p q dp dq qi".split(" "),dE=[],IE=0;IE<uE.length&&uE[IE]in Fg;IE++){var DE=dE[IE]=f(d(Fg[uE[IE]]));128&DE[0]&&(dE[IE]=new Uint8Array(DE.length+1),dE[IE].set(DE,1))}2<dE.length&&(_f=!0,dE.unshift(new Uint8Array([0]))),_d[0][0]="1.2.840.113549.1.1.1";break;default:throw new TypeError("Unsupported key type")}return _d.push(new Uint8Array(Wt(dE)).buffer),_f?_d.unshift(new Uint8Array([0])):_d[1]={tag:3,value:_d[1]},new Uint8Array(Wt(_d)).buffer})),vf}}),["encrypt","decrypt","sign","verify"].forEach(function(lE){var gE=Di[lE];Di[lE]=function(cE,_E,iE,rE){if(_m&&(!iE.byteLength||rE&&!rE.byteLength))throw Error("Empty input is not allowed");var vf=[].slice.call(arguments),Fg=C(cE);if(!_m||lE!=="sign"&&lE!=="verify"||cE!=="RSASSA-PKCS1-v1_5"&&cE!=="HMAC"||(vf[0]={name:cE}),_m&&_E.algorithm.hash&&(vf[0].hash=vf[0].hash||_E.algorithm.hash),_m&&lE==="decrypt"&&Fg.name==="AES-GCM"){var _d=cE.tagLength>>3;vf[2]=(iE.buffer||iE).slice(0,iE.byteLength-_d),cE.tag=(iE.buffer||iE).slice(iE.byteLength-_d)}_m&&Fg.name==="AES-GCM"&&vf[0].tagLength===void 0&&(vf[0].tagLength=128),vf[1]=_E._key;try{var _f=gE.apply(Di,vf)}catch(uE){return Promise.reject(uE)}return _m&&(_f=new Promise(function(uE,dE){_f.onabort=_f.onerror=function(IE){dE(IE)},_f.oncomplete=function(IE){if(IE=IE.target.result,lE==="encrypt"&&IE instanceof AesGcmEncryptResult){var DE=IE.ciphertext,GE=IE.tag;(IE=new Uint8Array(DE.byteLength+GE.byteLength)).set(new Uint8Array(DE),0),IE.set(new Uint8Array(GE),DE.byteLength),IE=IE.buffer}uE(IE)}})),_f}}),_m){var CE=Di.digest;Di.digest=function(lE,gE){if(!gE.byteLength)throw Error("Empty input is not allowed");try{var cE=CE.call(Di,lE,gE)}catch(_E){return Promise.reject(_E)}return cE=new Promise(function(_E,iE){cE.onabort=cE.onerror=function(rE){iE(rE)},cE.oncomplete=function(rE){_E(rE.target.result)}})},r.crypto=Object.create(_a,{getRandomValues:{value:function(lE){return _a.getRandomValues(lE)}},subtle:{value:Di}}),r.CryptoKey=_n}Qm&&(_a.subtle=Di,r.Crypto=_o,r.SubtleCrypto=_s,r.CryptoKey=_n)}}}})});var Jw=qa("match"),Lj=function(e){var r;return ha(e)&&((r=e[Jw])!==void 0?!!r:Zb(e)=="RegExp")},Kw=[].push,Lw=Math.min;dh("split",2,function(e,r,s){var d="abbc".split(/(b)*/)[1]=="c"||"test".split(/(?:)/,-1).length!=4||"ab".split(/(?:ab)*/).length!=2||".".split(/(.?)(.?)/).length!=4||1<".".split(/()()/).length||"".split(/.?/).length?function(f,_){var C=String(jb(this));if((_=_===void 0?4294967295:_>>>0)===0)return[];if(f===void 0)return[C];if(!Lj(f))return r.call(C,f,_);var P,x,B,_t=[],ue=0;for(f=new RegExp(f.source,(f.ignoreCase?"i":"")+(f.multiline?"m":"")+(f.unicode?"u":"")+(f.sticky?"y":"")+"g");(P=Of.call(f,C))&&!((x=f.lastIndex)>ue&&(_t.push(C.slice(ue,P.index)),1<P.length&&P.index<C.length&&Kw.apply(_t,P.slice(1)),B=P[0].length,ue=x,_t.length>=_));)f.lastIndex===P.index&&f.lastIndex++;return ue===C.length?(B||!f.test(""))&&_t.push(""):_t.push(C.slice(ue)),_t.length>_?_t.slice(0,_):_t}:"0".split(void 0,0).length?function(f,_){return f===void 0&&_===0?[]:r.call(this,f,_)}:r;return[function(f,_){var C=jb(this),P=f==null?void 0:f[e];return P!==void 0?P.call(f,C,_):d.call(String(C),f,_)},function(f,_){var C=s(d,f,this,_,d!==r);if(C.done)return C.value;var P=va(f);f=String(this);var x=kd(P,RegExp);if(C=P.unicode,P=new x(pc?"^(?:"+P.source+")":P,(P.ignoreCase?"i":"")+(P.multiline?"m":"")+(P.unicode?"u":"")+(pc?"g":"y")),(_=_===void 0?4294967295:_>>>0)===0)return[];if(f.length===0)return Ke(P,f)===null?[f]:[];var B=0,_t=0;for(x=[];_t<f.length;){P.lastIndex=pc?0:_t;var ue,Wt=Ke(P,pc?f.slice(_t):f);if(Wt===null||(ue=Lw(ta(P.lastIndex+(pc?_t:0)),f.length))===B)_t=xj(f,_t,C);else{if(x.push(f.slice(B,_t)),x.length===_)return x;for(B=1;B<=Wt.length-1;B++)if(x.push(Wt[B]),x.length===_)return x;_t=B=ue}}return x.push(f.slice(B)),x}]},pc),function(e){e.console||(e.console={}),e=e.console;for(var r,s=function(){},d=["memory"],f="assert clear count debug dir dirxml error exception group groupCollapsed groupEnd info log markTimeline profile profiles profileEnd show table time timeEnd timeline timelineEnd timeStamp trace warn".split(" ");r=d.pop();)e[r]||(e[r]={});for(;r=f.pop();)e[r]||(e[r]=s)}(typeof window>"u"?Ya:window),N({target:"Object",stat:!0},{setPrototypeOf:Ua});var Mw=R(function(){Vb(1)});N({target:"Object",stat:!0,forced:Mw,sham:!Hn},{getPrototypeOf:function(e){return Vb(Qa(e))}});var ep=[].slice,Mj={},Nw=Function.bind||function(e){var r=yb(this),s=ep.call(arguments,1),d=function(){var f=s.concat(ep.call(arguments));if(this instanceof d){var _=f.length;if(!(_ in Mj)){for(var C=[],P=0;P<_;P++)C[P]="a["+P+"]";Mj[_]=Function("C,a","return new C("+C.join(",")+")")}f=Mj[_](r,f)}else f=r.apply(e,f);return f};return ha(r.prototype)&&(d.prototype=r.prototype),d},Nj=mc("Reflect","construct"),fp=R(function(){function e(){}return!(Nj(function(){},[],e)instanceof e)}),gp=!R(function(){Nj(function(){})}),hp=fp||gp;N({target:"Reflect",stat:!0,forced:hp,sham:hp},{construct:function(e,r){yb(e),va(r);var s=3>arguments.length?e:yb(arguments[2]);if(gp&&!fp)return Nj(e,r,s);if(e==s){switch(r.length){case 0:return new e;case 1:return new e(r[0]);case 2:return new e(r[0],r[1]);case 3:return new e(r[0],r[1],r[2]);case 4:return new e(r[0],r[1],r[2],r[3])}return(s=[null]).push.apply(s,r),new(Nw.apply(e,s))}s=s.prototype,s=ac(ha(s)?s:Object.prototype);var d=Function.apply.call(e,s,r);return ha(d)?d:s}}),N({target:"Reflect",stat:!0},{get:wl});var ip=Fb.f,Ow=R(function(){ip(1)});N({target:"Object",stat:!0,forced:!ka||Ow,sham:!ka},{getOwnPropertyDescriptor:function(e,r){return ip(qb(e),r)}});var jp=Hd.f,Pw={}.toString,kp=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],Oj=function(e){if(kp&&Pw.call(e)=="[object Window]")try{var r=jp(e)}catch{r=kp.slice()}else r=jp(qb(e));return r},lp={f:qa},Qw=Ra.f,ph=function(e){var r=y.Symbol||(y.Symbol={});Q(r,e)||Qw(r,e,{value:lp.f(e)})},rb=Pg("hidden"),mp=qa("toPrimitive"),Rw=Za.set,np=Za.getterFor("Symbol"),Ob=Object.prototype,sb=y.Symbol,Tf=mc("JSON","stringify"),op=Fb.f,od=Ra.f,pp=Oj,Sw=zf,Lc=fd("symbols"),Uf=fd("op-symbols"),Pj=fd("string-to-symbol-registry"),Qj=fd("symbol-to-string-registry"),Tw=fd("wks"),Rj=y.QObject,Sj=!Rj||!Rj.prototype||!Rj.prototype.findChild,Tj=ka&&R(function(){return ac(od({},"a",{get:function(){return od(this,"a",{value:7}).a}})).a!=7})?function(e,r,s){var d=op(Ob,r);d&&delete Ob[r],od(e,r,s),d&&e!==Ob&&od(Ob,r,d)}:od,Uj=function(e,r){var s=Lc[e]=ac(sb.prototype);return Rw(s,{type:"Symbol",tag:e,description:r}),ka||(s.description=r),s},Vj=vn?function(e){return typeof e=="symbol"}:function(e){return Object(e)instanceof sb},qh=function(e,r,s){return e===Ob&&qh(Uf,r,s),va(e),r=lc(r,!0),va(s),Q(Lc,r)?(s.enumerable?(Q(e,rb)&&e[rb][r]&&(e[rb][r]=!1),s=ac(s,{enumerable:dd(0,!1)})):(Q(e,rb)||od(e,rb,dd(1,{})),e[rb][r]=!0),Tj(e,r,s)):od(e,r,s)},qp=function(e,r){va(e);var s=qb(r);return r=Dc(s).concat(Wj(s)),Jd(r,function(d){ka&&!Xj.call(s,d)||qh(e,d,s[d])}),e},Xj=function(e){e=lc(e,!0);var r=Sw.call(this,e);return!(this===Ob&&Q(Lc,e)&&!Q(Uf,e))&&(!(r||!Q(this,e)||!Q(Lc,e)||Q(this,rb)&&this[rb][e])||r)},rp=function(e,r){if(e=qb(e),r=lc(r,!0),e!==Ob||!Q(Lc,r)||Q(Uf,r)){var s=op(e,r);return!s||!Q(Lc,r)||Q(e,rb)&&e[rb][r]||(s.enumerable=!0),s}},sp=function(e){e=pp(qb(e));var r=[];return Jd(e,function(s){Q(Lc,s)||Q(Be,s)||r.push(s)}),r},Wj=function(e){var r=e===Ob;e=pp(r?Uf:qb(e));var s=[];return Jd(e,function(d){!Q(Lc,d)||r&&!Q(Ob,d)||s.push(Lc[d])}),s};if(oc||(sb=function(){if(this instanceof sb)throw TypeError("Symbol is not a constructor");var e=arguments.length&&arguments[0]!==void 0?String(arguments[0]):void 0,r=Ae(e),s=function(d){this===Ob&&s.call(Uf,d),Q(this,rb)&&Q(this[rb],r)&&(this[rb][r]=!1),Tj(this,r,dd(1,d))};return ka&&Sj&&Tj(Ob,r,{configurable:!0,set:s}),Uj(r,e)},Ta(sb.prototype,"toString",function(){return np(this).tag}),Ta(sb,"withoutSetter",function(e){return Uj(Ae(e),e)}),zf=Xj,Ra.f=qh,Fb.f=rp,Hd.f=Oj=sp,Bf.f=Wj,lp.f=function(e){return Uj(qa(e),e)},ka&&(od(sb.prototype,"description",{configurable:!0,get:function(){return np(this).description}}),Ta(Ob,"propertyIsEnumerable",Xj,{unsafe:!0}))),N({global:!0,wrap:!0,forced:!oc,sham:!oc},{Symbol:sb}),Jd(Dc(Tw),function(e){ph(e)}),N({target:"Symbol",stat:!0,forced:!oc},{for:function(e){if(e=String(e),Q(Pj,e))return Pj[e];var r=sb(e);return Pj[e]=r,Qj[r]=e,r},keyFor:function(e){if(!Vj(e))throw TypeError(e+" is not a symbol");if(Q(Qj,e))return Qj[e]},useSetter:function(){Sj=!0},useSimple:function(){Sj=!1}}),N({target:"Object",stat:!0,forced:!oc,sham:!ka},{create:function(e,r){return r===void 0?ac(e):qp(ac(e),r)},defineProperty:qh,defineProperties:qp,getOwnPropertyDescriptor:rp}),N({target:"Object",stat:!0,forced:!oc},{getOwnPropertyNames:sp,getOwnPropertySymbols:Wj}),N({target:"Object",stat:!0,forced:R(function(){Bf.f(1)})},{getOwnPropertySymbols:function(e){return Bf.f(Qa(e))}}),Tf){var Uw=!oc||R(function(){var e=sb();return Tf([e])!="[null]"||Tf({a:e})!="{}"||Tf(Object(e))!="{}"});N({target:"JSON",stat:!0,forced:Uw},{stringify:function(e,r,s){for(var d,f=[e],_=1;arguments.length>_;)f.push(arguments[_++]);if(d=r,(ha(r)||e!==void 0)&&!Vj(e))return gd(r)||(r=function(C,P){if(typeof d=="function"&&(P=d.call(this,C,P)),!Vj(P))return P}),f[1]=r,Tf.apply(null,f)}})}sb.prototype[mp]||Na(sb.prototype,mp,sb.prototype.valueOf),Ec(sb,"Symbol"),Be[rb]=!0;var Vw=Ra.f,Mc=y.Symbol;if(ka&&typeof Mc=="function"&&(!("description"in Mc.prototype)||Mc().description!==void 0)){var tp={},Vf=function(){var e=1>arguments.length||arguments[0]===void 0?void 0:String(arguments[0]),r=this instanceof Vf?new Mc(e):e===void 0?Mc():Mc(e);return e===""&&(tp[r]=!0),r};rn(Vf,Mc);var Yj=Vf.prototype=Mc.prototype;Yj.constructor=Vf;var Ww=Yj.toString,Xw=String(Mc("test"))=="Symbol(test)",Yw=/^Symbol\((.*)\)[^)]+$/;Vw(Yj,"description",{configurable:!0,get:function(){var e=ha(this)?this.valueOf():this,r=Ww.call(e);return Q(tp,e)?"":(e=Xw?r.slice(7,-1):r.replace(Yw,"$1"))===""?void 0:e}}),N({global:!0,forced:!0},{Symbol:Vf})}ph("toStringTag"),Ec(y.JSON,"JSON",!0),Ec(Math,"Math",!0),function(){function e(Wt,_n){if(!(Wt instanceof _n))throw new TypeError("Cannot call a class as a function")}function r(Wt,_n){for(var _i=0;_i<_n.length;_i++){var Ei=_n[_i];Ei.enumerable=Ei.enumerable||!1,Ei.configurable=!0,"value"in Ei&&(Ei.writable=!0),Object.defineProperty(Wt,Ei.key,Ei)}}function s(Wt,_n,_i){return _n&&r(Wt.prototype,_n),_i&&r(Wt,_i),Wt}function d(Wt,_n){if(typeof _n!="function"&&_n!==null)throw new TypeError("Super expression must either be null or a function");Wt.prototype=Object.create(_n&&_n.prototype,{constructor:{value:Wt,writable:!0,configurable:!0}}),_n&&_(Wt,_n)}function f(Wt){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(_n){return _n.__proto__||Object.getPrototypeOf(_n)})(Wt)}function _(Wt,_n){return(_=Object.setPrototypeOf||function(_i,Ei){return _i.__proto__=Ei,_i})(Wt,_n)}function C(Wt){if(Wt===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return Wt}function P(Wt){var _n=function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}();return function(){var _i=f(Wt);if(_n){var Ei=f(this).constructor;_i=Reflect.construct(_i,arguments,Ei)}else _i=_i.apply(this,arguments);return _i=!_i||X(_i)!=="object"&&typeof _i!="function"?C(this):_i}}function x(Wt,_n,_i){return(x=typeof Reflect<"u"&&Reflect.get?Reflect.get:function(Ei,_a,Di){for(;!Object.prototype.hasOwnProperty.call(Ei,_a)&&(Ei=f(Ei))!==null;);if(Ei)return(_a=Object.getOwnPropertyDescriptor(Ei,_a)).get?_a.get.call(Di):_a.value})(Wt,_n,_i||Wt)}var B=function(){function Wt(){e(this,Wt),Object.defineProperty(this,"listeners",{value:{},writable:!0,configurable:!0})}return s(Wt,[{key:"addEventListener",value:function(_n,_i,Ei){_n in this.listeners||(this.listeners[_n]=[]),this.listeners[_n].push({callback:_i,options:Ei})}},{key:"removeEventListener",value:function(_n,_i){if(_n in this.listeners){for(var Ei=0,_a=(_n=this.listeners[_n]).length;Ei<_a;Ei++)if(_n[Ei].callback===_i){_n.splice(Ei,1);break}}}},{key:"dispatchEvent",value:function(_n){if(_n.type in this.listeners){for(var _i=this.listeners[_n.type].slice(),Ei=0,_a=_i.length;Ei<_a;Ei++){var Di=_i[Ei];try{Di.callback.call(this,_n)}catch(_o){Promise.resolve().then(function(){throw _o})}Di.options&&Di.options.once&&this.removeEventListener(_n.type,Di.callback)}return!_n.defaultPrevented}}}]),Wt}(),_t=function(Wt){function _n(){e(this,_n);var Ei=_i.call(this);return Ei.listeners||B.call(C(Ei)),Object.defineProperty(C(Ei),"aborted",{value:!1,writable:!0,configurable:!0}),Object.defineProperty(C(Ei),"onabort",{value:null,writable:!0,configurable:!0}),Ei}d(_n,Wt);var _i=P(_n);return s(_n,[{key:"toString",value:function(){return"[object AbortSignal]"}},{key:"dispatchEvent",value:function(Ei){Ei.type==="abort"&&(this.aborted=!0,typeof this.onabort=="function"&&this.onabort.call(this,Ei)),x(f(_n.prototype),"dispatchEvent",this).call(this,Ei)}}]),_n}(B),ue=function(){function Wt(){e(this,Wt),Object.defineProperty(this,"signal",{value:new _t,writable:!0,configurable:!0})}return s(Wt,[{key:"abort",value:function(){try{var _n=new Event("abort")}catch{typeof document<"u"?document.createEvent?(_n=document.createEvent("Event")).initEvent("abort",!1,!1):(_n=document.createEventObject()).type="abort":_n={type:"abort",bubbles:!1,cancelable:!1}}this.signal.dispatchEvent(_n)}},{key:"toString",value:function(){return"[object AbortController]"}}]),Wt}();typeof Symbol<"u"&&Symbol.toStringTag&&(ue.prototype[Symbol.toStringTag]="AbortController",_t.prototype[Symbol.toStringTag]="AbortSignal"),function(Wt){if(Wt.__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL){console.log("__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL=true is set, will force install polyfill");var _n=!0}else _n=typeof Wt.Request=="function"&&!Wt.Request.prototype.hasOwnProperty("signal")||!Wt.AbortController;_n&&(Wt.AbortController=ue,Wt.AbortSignal=_t)}(typeof self<"u"?self:Ya)}();var Zw=Math.floor,$w=Math.log,ax=Math.LOG2E;N({target:"Math",stat:!0},{clz32:function(e){return(e>>>=0)?31-Zw($w(e+.5)*ax):32}});var bx=Math.log,cx=Math.LN2,ss=Math.clz32||function(e){return 31-bx(e>>>0)/cx|0},xd=String.fromCharCode,up={}.toString,Zj=window.Uint8Array,ak=Zj||Array,dx=up.call((window.ArrayBuffer||ak).prototype),bk;xl.prototype.decode=function(e){if(e=e&&e.buffer||e,up.call(e)!==dx)throw Error("Failed to execute 'decode' on 'TextDecoder': The provided value is not of type '(ArrayBuffer or ArrayBufferView)'");for(var r="",s=0,d=0|(e=Zj?new ak(e):e).length;s<d;s=s+32768|0)r+=xd.apply(0,e[Zj?"slice":"subarray"](s,s+32768|0));return r.replace(/[\xc0-\xff][\x80-\xbf]*/g,rs)},window.TextDecoder||(window.TextDecoder=xl),yl.prototype.encode=function(e){for(var r=0|(e=e===void 0?"":(""+e).replace(/[\x80-\uD7ff\uDC00-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]?/g,ts)).length,s=new ak(r),d=0;d<r;d=d+1|0)s[d]=e.charCodeAt(d);return s},window.TextEncoder||(window.TextEncoder=yl),function(e){var r,s,d,f,_,C,P,x,B,_t,ue;(function(Wt){Wt.LOGIN="LOGIN",Wt.LOGIN_SUCCESS="LOGIN_SUCCESS",Wt.LOGIN_FAILURE="LOGIN_FAILURE",Wt.LOGIN_TIMEOUT="LOGIN_TIMEOUT",Wt.INTERRUPTED="INTERRUPTED",Wt.LOGOUT="LOGOUT",Wt.BANNED_BY_SERVER="BANNED_BY_SERVER",Wt.REMOTE_LOGIN="REMOTE_LOGIN"})(r||(r={})),e.ConnectionChangeReason=r,function(Wt){Wt.DISCONNECTED="DISCONNECTED",Wt.CONNECTING="CONNECTING",Wt.CONNECTED="CONNECTED",Wt.RECONNECTING="RECONNECTING",Wt.ABORTED="ABORTED"}(s||(s={})),e.ConnectionState=s,function(Wt){Wt.IDLE="IDLE",Wt.SENT_TO_REMOTE="SENT_TO_REMOTE",Wt.RECEIVED_BY_REMOTE="RECEIVED_BY_REMOTE",Wt.ACCEPTED_BY_REMOTE="ACCEPTED_BY_REMOTE",Wt.REFUSED_BY_REMOTE="REFUSED_BY_REMOTE",Wt.CANCELED="CANCELED",Wt.FAILURE="FAILURE"}(d||(d={})),e.LocalInvitationState=d,function(Wt){Wt.INVITATION_RECEIVED="INVITATION_RECEIVED",Wt.ACCEPT_SENT_TO_LOCAL="ACCEPT_SENT_TO_LOCAL",Wt.REFUSED="REFUSED",Wt.ACCEPTED="ACCEPTED",Wt.CANCELED="CANCELED",Wt.FAILURE="FAILURE"}(f||(f={})),e.RemoteInvitationState=f,function(Wt){Wt.UNKNOWN="UNKNOWN",Wt.PEER_NO_RESPONSE="PEER_NO_RESPONSE",Wt.INVITATION_EXPIRE="INVITATION_EXPIRE",Wt.PEER_OFFLINE="PEER_OFFLINE",Wt.NOT_LOGGEDIN="NOT_LOGGEDIN"}(_||(_={})),e.LocalInvitationFailureReason=_,function(Wt){Wt.UNKNOWN="UNKNOWN",Wt.PEER_OFFLINE="PEER_OFFLINE",Wt.ACCEPT_FAILURE="ACCEPT_FAILURE",Wt.INVITATION_EXPIRE="INVITATION_EXPIRE"}(C||(C={})),e.RemoteInvitationFailureReason=C,function(Wt){Wt.ONLINE="ONLINE",Wt.UNREACHABLE="UNREACHABLE",Wt.OFFLINE="OFFLINE"}(P||(P={})),e.PeerOnlineState=P,(x||(x={})).ONLINE_STATUS="ONLINE_STATUS",e.PeerSubscriptionOption=x,function(Wt){Wt.TEXT="TEXT",Wt.RAW="RAW",Wt.IMAGE="IMAGE",Wt.FILE="FILE"}(B||(B={})),e.MessageType=B,function(Wt){Wt.CN="CN",Wt.NA="NA",Wt.EU="EU",Wt.AS="AS",Wt.JP="JP",Wt.IN="IN",Wt.GLOB="GLOB",Wt.OC="OC",Wt.SA="SA",Wt.AF="AF",Wt.OVS="OVS"}(_t||(_t={})),e.LegacyAreaCode=_t,function(Wt){Wt.GLOBAL="GLOBAL",Wt.INDIA="INDIA",Wt.JAPAN="JAPAN",Wt.ASIA="ASIA",Wt.EUROPE="EUROPE",Wt.CHINA="CHINA",Wt.NORTH_AMERICA="NORTH_AMERICA"}(ue||(ue={})),e.AreaCode=ue}(bk||(bk={}));var S=bk;N({target:"Array",proto:!0},{includes:function(e){return on(this,e,1<arguments.length?arguments[1]:void 0)}}),Ld("includes");var ck=function(e){if(Lj(e))throw TypeError("The method doesn't accept regular expressions");return e},ex=qa("match"),dk=function(e){var r=/./;try{"/./"[e](r)}catch{try{return r[ex]=!1,"/./"[e](r)}catch{}}return!1};N({target:"String",proto:!0,forced:!dk("includes")},{includes:function(e){return!!~String(jb(this)).indexOf(ck(e),1<arguments.length?arguments[1]:void 0)}});var Nc={RECONNECTING_AP_INTERVAL:2500,RECONNECTING_AP_NUM:2,DISABLE_MESSAGE_COMPRESSION:!1,LOG_UPLOAD_INTERVAL:3e3,LOG_HANDLER:void 0};ph("iterator"),ph("asyncIterator");var ek=Ee("forEach")?[].forEach:function(e){return Jd(this,e,1<arguments.length?arguments[1]:void 0)},vp;for(vp in Ij){var wp=y[vp],rh=wp&&wp.prototype;if(rh&&rh.forEach!==ek)try{Na(rh,"forEach",ek)}catch{rh.forEach=ek}}var fx=[].reverse,xp=[1,2];N({target:"Array",proto:!0,forced:String(xp)===String(xp.reverse())},{reverse:function(){return gd(this)&&(this.length=this.length),fx.call(this)}});var w=$a(function(e){e=function(r){function s(iE,rE,vf){return Object.defineProperty(iE,rE,{value:vf,enumerable:!0,configurable:!0,writable:!0}),iE[rE]}function d(iE,rE,vf,Fg){return rE=Object.create((rE&&rE.prototype instanceof _?rE:_).prototype),Fg=new _n(Fg||[]),rE._invoke=function(_d,_f,uE){var dE=tE;return function(IE,DE){if(dE===CE)throw Error("Generator is already running");if(dE===lE){if(IE==="throw")throw DE;return Ei()}for(uE.method=IE,uE.arg=DE;;){if((IE=uE.delegate)&&(IE=_t(IE,uE))){if(IE===gE)continue;return IE}if(uE.method==="next")uE.sent=uE._sent=uE.arg;else if(uE.method==="throw"){if(dE===tE)throw dE=lE,uE.arg;uE.dispatchException(uE.arg)}else uE.method==="return"&&uE.abrupt("return",uE.arg);if(dE=CE,(IE=f(_d,_f,uE)).type==="normal"){if(dE=uE.done?lE:aE,IE.arg===gE)continue;return{value:IE.arg,done:uE.done}}IE.type==="throw"&&(dE=lE,uE.method="throw",uE.arg=IE.arg)}}}(iE,vf,Fg),rE}function f(iE,rE,vf){try{return{type:"normal",arg:iE.call(rE,vf)}}catch(Fg){return{type:"throw",arg:Fg}}}function _(){}function C(){}function P(){}function x(iE){["next","throw","return"].forEach(function(rE){s(iE,rE,function(vf){return this._invoke(rE,vf)})})}function B(iE,rE){function vf(_d,_f,uE,dE){if((_d=f(iE[_d],iE,_f)).type!=="throw"){var IE=_d.arg;return(_d=IE.value)&&X(_d)==="object"&&_o.call(_d,"__await")?rE.resolve(_d.__await).then(function(DE){vf("next",DE,uE,dE)},function(DE){vf("throw",DE,uE,dE)}):rE.resolve(_d).then(function(DE){IE.value=DE,uE(IE)},function(DE){return vf("throw",DE,uE,dE)})}dE(_d.arg)}var Fg;this._invoke=function(_d,_f){function uE(){return new rE(function(dE,IE){vf(_d,_f,dE,IE)})}return Fg=Fg?Fg.then(uE,uE):uE()}}function _t(iE,rE){var vf=iE.iterator[rE.method];if(vf===_a){if(rE.delegate=null,rE.method==="throw"){if(iE.iterator.return&&(rE.method="return",rE.arg=_a,_t(iE,rE),rE.method==="throw"))return gE;rE.method="throw",rE.arg=new TypeError("The iterator does not provide a 'throw' method")}return gE}return(vf=f(vf,iE.iterator,rE.arg)).type==="throw"?(rE.method="throw",rE.arg=vf.arg,rE.delegate=null,gE):(vf=vf.arg)?vf.done?(rE[iE.resultName]=vf.value,rE.next=iE.nextLoc,rE.method!=="return"&&(rE.method="next",rE.arg=_a),rE.delegate=null,gE):vf:(rE.method="throw",rE.arg=new TypeError("iterator result is not an object"),rE.delegate=null,gE)}function ue(iE){var rE={tryLoc:iE[0]};1 in iE&&(rE.catchLoc=iE[1]),2 in iE&&(rE.finallyLoc=iE[2],rE.afterLoc=iE[3]),this.tryEntries.push(rE)}function Wt(iE){var rE=iE.completion||{};rE.type="normal",delete rE.arg,iE.completion=rE}function _n(iE){this.tryEntries=[{tryLoc:"root"}],iE.forEach(ue,this),this.reset(!0)}function _i(iE){if(iE){var rE=iE[_c];if(rE)return rE.call(iE);if(typeof iE.next=="function")return iE;if(!isNaN(iE.length)){var vf=-1;return(rE=function Fg(){for(;++vf<iE.length;)if(_o.call(iE,vf))return Fg.value=iE[vf],Fg.done=!1,Fg;return Fg.value=_a,Fg.done=!0,Fg}).next=rE}}return{next:Ei}}function Ei(){return{value:_a,done:!0}}var _a,Di=Object.prototype,_o=Di.hasOwnProperty,_s=typeof Symbol=="function"?Symbol:{},_c=_s.iterator||"@@iterator",_m=_s.asyncIterator||"@@asyncIterator",Qm=_s.toStringTag||"@@toStringTag";try{s({},"")}catch{s=function(rE,vf,Fg){return rE[vf]=Fg}}r.wrap=d;var tE="suspendedStart",aE="suspendedYield",CE="executing",lE="completed",gE={};s(_s={},_c,function(){return this});var cE=Object.getPrototypeOf;(cE=cE&&cE(cE(_i([]))))&&cE!==Di&&_o.call(cE,_c)&&(_s=cE);var _E=P.prototype=_.prototype=Object.create(_s);return C.prototype=P,s(_E,"constructor",P),s(P,"constructor",C),C.displayName=s(P,Qm,"GeneratorFunction"),r.isGeneratorFunction=function(iE){return!!(iE=typeof iE=="function"&&iE.constructor)&&(iE===C||(iE.displayName||iE.name)==="GeneratorFunction")},r.mark=function(iE){return Object.setPrototypeOf?Object.setPrototypeOf(iE,P):(iE.__proto__=P,s(iE,Qm,"GeneratorFunction")),iE.prototype=Object.create(_E),iE},r.awrap=function(iE){return{__await:iE}},x(B.prototype),s(B.prototype,_m,function(){return this}),r.AsyncIterator=B,r.async=function(iE,rE,vf,Fg,_d){_d===void 0&&(_d=Promise);var _f=new B(d(iE,rE,vf,Fg),_d);return r.isGeneratorFunction(rE)?_f:_f.next().then(function(uE){return uE.done?uE.value:_f.next()})},x(_E),s(_E,Qm,"Generator"),s(_E,_c,function(){return this}),s(_E,"toString",function(){return"[object Generator]"}),r.keys=function(iE){var rE,vf=[];for(rE in iE)vf.push(rE);return vf.reverse(),function Fg(){for(;vf.length;){var _d=vf.pop();if(_d in iE)return Fg.value=_d,Fg.done=!1,Fg}return Fg.done=!0,Fg}},r.values=_i,_n.prototype={constructor:_n,reset:function(iE){if(this.next=this.prev=0,this.sent=this._sent=_a,this.done=!1,this.delegate=null,this.method="next",this.arg=_a,this.tryEntries.forEach(Wt),!iE)for(var rE in this)rE.charAt(0)==="t"&&_o.call(this,rE)&&!isNaN(+rE.slice(1))&&(this[rE]=_a)},stop:function(){this.done=!0;var iE=this.tryEntries[0].completion;if(iE.type==="throw")throw iE.arg;return this.rval},dispatchException:function(iE){function rE(IE,DE){return _f.type="throw",_f.arg=iE,vf.next=IE,DE&&(vf.method="next",vf.arg=_a),!!DE}if(this.done)throw iE;for(var vf=this,Fg=this.tryEntries.length-1;0<=Fg;--Fg){var _d=this.tryEntries[Fg],_f=_d.completion;if(_d.tryLoc==="root")return rE("end");if(_d.tryLoc<=this.prev){var uE=_o.call(_d,"catchLoc"),dE=_o.call(_d,"finallyLoc");if(uE&&dE){if(this.prev<_d.catchLoc)return rE(_d.catchLoc,!0);if(this.prev<_d.finallyLoc)return rE(_d.finallyLoc)}else if(uE){if(this.prev<_d.catchLoc)return rE(_d.catchLoc,!0)}else{if(!dE)throw Error("try statement without catch or finally");if(this.prev<_d.finallyLoc)return rE(_d.finallyLoc)}}}},abrupt:function(iE,rE){for(var vf=this.tryEntries.length-1;0<=vf;--vf){var Fg=this.tryEntries[vf];if(Fg.tryLoc<=this.prev&&_o.call(Fg,"finallyLoc")&&this.prev<Fg.finallyLoc){var _d=Fg;break}}return _d&&(iE==="break"||iE==="continue")&&_d.tryLoc<=rE&&rE<=_d.finallyLoc&&(_d=null),(vf=_d?_d.completion:{}).type=iE,vf.arg=rE,_d?(this.method="next",this.next=_d.finallyLoc,gE):this.complete(vf)},complete:function(iE,rE){if(iE.type==="throw")throw iE.arg;return iE.type==="break"||iE.type==="continue"?this.next=iE.arg:iE.type==="return"?(this.rval=this.arg=iE.arg,this.method="return",this.next="end"):iE.type==="normal"&&rE&&(this.next=rE),gE},finish:function(iE){for(var rE=this.tryEntries.length-1;0<=rE;--rE){var vf=this.tryEntries[rE];if(vf.finallyLoc===iE)return this.complete(vf.completion,vf.afterLoc),Wt(vf),gE}},catch:function(iE){for(var rE=this.tryEntries.length-1;0<=rE;--rE){var vf=this.tryEntries[rE];if(vf.tryLoc===iE){if((iE=vf.completion).type==="throw"){var Fg=iE.arg;Wt(vf)}return Fg}}throw Error("illegal catch attempt")},delegateYield:function(iE,rE,vf){return this.delegate={iterator:_i(iE),resultName:rE,nextLoc:vf},this.method==="next"&&(this.arg=_a),gE}},r}(e.exports);try{regeneratorRuntime=e}catch{(typeof globalThis>"u"?"undefined":X(globalThis))==="object"?globalThis.regeneratorRuntime=e:Function("r","regeneratorRuntime = r")(e)}}),yp=!R(function(){return Object.isExtensible(Object.preventExtensions({}))}),fk=$a(function(e){var r=Ra.f,s=Ae("meta"),d=0,f=Object.isExtensible||function(){return!0},_=function(P){r(P,s,{value:{objectID:"O"+ ++d,weakData:{}}})},C=e.exports={REQUIRED:!1,fastKey:function(P,x){if(!ha(P))return typeof P=="symbol"?P:(typeof P=="string"?"S":"P")+P;if(!Q(P,s)){if(!f(P))return"F";if(!x)return"E";_(P)}return P[s].objectID},getWeakData:function(P,x){if(!Q(P,s)){if(!f(P))return!0;if(!x)return!1;_(P)}return P[s].weakData},onFreeze:function(P){return yp&&C.REQUIRED&&f(P)&&!Q(P,s)&&_(P),P}};Be[s]=!0}),zp=function(e,r,s){var d=e.indexOf("Map")!==-1,f=e.indexOf("Weak")!==-1,_=d?"set":"add",C=y[e],P=C&&C.prototype,x=C,B={},_t=function(_a){var Di=P[_a];Ta(P,_a,_a=="add"?function(_o){return Di.call(this,_o===0?0:_o),this}:_a=="delete"?function(_o){return!(f&&!ha(_o))&&Di.call(this,_o===0?0:_o)}:_a=="get"?function(_o){return f&&!ha(_o)?void 0:Di.call(this,_o===0?0:_o)}:_a=="has"?function(_o){return!(f&&!ha(_o))&&Di.call(this,_o===0?0:_o)}:function(_o,_s){return Di.call(this,_o===0?0:_o,_s),this})};if(nc(e,typeof C!="function"||!(f||P.forEach&&!R(function(){new C().entries().next()}))))x=s.getConstructor(r,e,d,_),fk.REQUIRED=!0;else if(nc(e,!0)){var ue=new x,Wt=ue[_](f?{}:-0,1)!=ue,_n=R(function(){ue.has(1)}),_i=Tg(function(_a){new C(_a)}),Ei=!f&&R(function(){for(var _a=new C,Di=5;Di--;)_a[_](Di,Di);return!_a.has(-0)});_i||((x=r(function(_a,Di){return Gc(_a,x,e),_a=lh(new C,_a,x),Di!=null&&Xg(Di,_a[_],{that:_a,AS_ENTRIES:d}),_a})).prototype=P,P.constructor=x),(_n||Ei)&&(_t("delete"),_t("has"),d&&_t("get")),(Ei||Wt)&&_t(_),f&&P.clear&&delete P.clear}return B[e]=x,N({global:!0,forced:x!=C},B),Ec(x,e),f||s.setStrong(x,e,d),x},gx=Ra.f,Ap=fk.fastKey,Bp=Za.set,gk=Za.getterFor,Cp={getConstructor:function(e,r,s,d){var f=e(function(x,B){Gc(x,f,r),Bp(x,{type:r,index:ac(null),first:void 0,last:void 0,size:0}),ka||(x.size=0),B!=null&&Xg(B,x[d],{that:x,AS_ENTRIES:s})}),_=gk(r),C=function(x,B,_t){var ue,Wt=_(x),_n=P(x,B);return _n?_n.value=_t:(Wt.last=_n={index:ue=Ap(B,!0),key:B,value:_t,previous:B=Wt.last,next:void 0,removed:!1},Wt.first||(Wt.first=_n),B&&(B.next=_n),ka?Wt.size++:x.size++,ue!=="F"&&(Wt.index[ue]=_n)),x},P=function(x,B){x=_(x);var _t=Ap(B);if(_t!=="F")return x.index[_t];for(x=x.first;x;x=x.next)if(x.key==B)return x};return Hf(f.prototype,{clear:function(){for(var x=_(this),B=x.index,_t=x.first;_t;)_t.removed=!0,_t.previous&&(_t.previous=_t.previous.next=void 0),delete B[_t.index],_t=_t.next;x.first=x.last=void 0,ka?x.size=0:this.size=0},delete:function(x){var B=_(this);if(x=P(this,x)){var _t=x.next,ue=x.previous;delete B.index[x.index],x.removed=!0,ue&&(ue.next=_t),_t&&(_t.previous=ue),B.first==x&&(B.first=_t),B.last==x&&(B.last=ue),ka?B.size--:this.size--}return!!x},forEach:function(x){for(var B,_t=_(this),ue=Id(x,1<arguments.length?arguments[1]:void 0,3);B=B?B.next:_t.first;)for(ue(B.value,B.key,this);B&&B.removed;)B=B.previous},has:function(x){return!!P(this,x)}}),Hf(f.prototype,s?{get:function(x){return(x=P(this,x))&&x.value},set:function(x,B){return C(this,x===0?0:x,B)}}:{add:function(x){return C(this,x=x===0?0:x,x)}}),ka&&gx(f.prototype,"size",{get:function(){return _(this).size}}),f},setStrong:function(e,r,s){var d=r+" Iterator",f=gk(r),_=gk(d);bj(e,r,function(C,P){Bp(this,{type:d,target:C,state:f(C),kind:P,last:void 0})},function(){for(var C=_(this),P=C.kind,x=C.last;x&&x.removed;)x=x.previous;return C.target&&(C.last=x=x?x.next:C.state.first)?P=="keys"?{value:x.key,done:!1}:P=="values"?{value:x.value,done:!1}:{value:[x.key,x.value],done:!1}:(C.target=void 0,{value:void 0,done:!0})},s?"entries":"values",!s,!0),If(r)}};zp("Set",function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}},Cp);var hx=/^[\t\n\x0B\f\r \u00a0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff][\t\n\x0B\f\r \u00a0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff]*/,ix=/[\t\n\x0B\f\r \u00a0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff][\t\n\x0B\f\r \u00a0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff]*$/,hk=function(e){return function(r){return r=String(jb(r)),1&e&&(r=r.replace(hx,"")),2&e&&(r=r.replace(ix,"")),r}},ik=hk(3),sh=y.parseInt,jx=/^[+-]?0[Xx]/,Dp=sh(`	
\v\f\r Â áš€â€€â€â€‚â€ƒâ€„â€…â€†â€‡â€ˆâ€‰â€Šâ€¯âŸã€€\u2028\u2029\uFEFF08`)!==8||sh(`	
\v\f\r Â áš€â€€â€â€‚â€ƒâ€„â€…â€†â€‡â€ˆâ€‰â€Šâ€¯âŸã€€\u2028\u2029\uFEFF0x16`)!==22?function(e,r){return e=ik(String(e)),sh(e,r>>>0||(jx.test(e)?16:10))}:sh;N({global:!0,forced:parseInt!=Dp},{parseInt:Dp});var kx=Hd.f,lx=Fb.f,mx=Ra.f,pd=y.Number,th=pd.prototype,nx=Zb(ac(th))=="Number",Ep=function(e){var r,s=lc(e,!1);if(typeof s=="string"&&2<s.length){if((e=(s=ik(s)).charCodeAt(0))===43||e===45){if((e=s.charCodeAt(2))===88||e===120)return NaN}else if(e===48){switch(s.charCodeAt(1)){case 66:case 98:e=2;var d=49;break;case 79:case 111:e=8,d=55;break;default:return+s}var f=(s=s.slice(2)).length;for(r=0;r<f;r++){var _=s.charCodeAt(r);if(48>_||_>d)return NaN}return parseInt(s,e)}}return+s};if(nc("Number",!pd(" 0o1")||!pd("0b1")||pd("+0x1"))){for(var Pd=function(e){var r=1>arguments.length?0:e,s=this;return s instanceof Pd&&(nx?R(function(){th.valueOf.call(s)}):Zb(s)!="Number")?lh(new pd(Ep(r)),s,Pd):Ep(r)},Fp=ka?kx(pd):"MAX_VALUE MIN_VALUE NaN NEGATIVE_INFINITY POSITIVE_INFINITY EPSILON isFinite isInteger isNaN isSafeInteger MAX_SAFE_INTEGER MIN_SAFE_INTEGER parseFloat parseInt isInteger fromString range".split(" "),jk=0,uh;Fp.length>jk;jk++)Q(pd,uh=Fp[jk])&&!Q(Pd,uh)&&mx(Pd,uh,lx(pd,uh));Pd.prototype=th,th.constructor=Pd,Ta(y,"Number",Pd)}var Gp=qa("isConcatSpreadable"),ox=51<=id||!R(function(){var e=[];return e[Gp]=!1,e.concat()[0]!==e}),px=Ef("concat");N({target:"Array",proto:!0,forced:!ox||!px},{concat:function(e){var r,s=Qa(this),d=Sg(s,0),f=0,_=-1;for(r=arguments.length;_<r;_++){var C=_===-1?s:arguments[_],P=C;if(ha(P)){var x=P[Gp];P=x!==void 0?!!x:gd(P)}else P=!1;if(P){if(9007199254740991<f+(x=ta(C.length)))throw TypeError("Maximum allowed index exceeded");for(P=0;P<x;P++,f++)P in C&&Ge(d,f,C[P])}else{if(9007199254740991<=f)throw TypeError("Maximum allowed index exceeded");Ge(d,f++,C)}}return d.length=f,d}});var kk=mc("Reflect","apply"),qx=Function.apply,rx=!R(function(){kk(function(){})});N({target:"Reflect",stat:!0,forced:rx},{apply:function(e,r,s){return yb(e),va(s),kk?kk(e,r,s):qx.call(e,r,s)}}),N({target:"Reflect",stat:!0},{ownKeys:qn});var sx=Oj,tx=R(function(){return!Object.getOwnPropertyNames(1)});N({target:"Object",stat:!0,forced:tx},{getOwnPropertyNames:sx});var Pe=(typeof Reflect>"u"?"undefined":X(Reflect))==="object"?Reflect:null,Hp=Pe&&typeof Pe.apply=="function"?Pe.apply:function(e,r,s){return Function.prototype.apply.call(e,r,s)},ux=Pe&&typeof Pe.ownKeys=="function"?Pe.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)},Ip=Number.isNaN||function(e){return e!=e};ea.EventEmitter=ea,ea.prototype._events=void 0,ea.prototype._eventsCount=0,ea.prototype._maxListeners=void 0;var Jp=10;Object.defineProperty(ea,"defaultMaxListeners",{enumerable:!0,get:function(){return Jp},set:function(e){if(typeof e!="number"||0>e||Ip(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");Jp=e}}),ea.init=function(){this._events!==void 0&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},ea.prototype.setMaxListeners=function(e){if(typeof e!="number"||0>e||Ip(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},ea.prototype.getMaxListeners=function(){return this._maxListeners===void 0?ea.defaultMaxListeners:this._maxListeners},ea.prototype.emit=function(e){for(var r=[],s=1;s<arguments.length;s++)r.push(arguments[s]);s=e==="error";var d=this._events;if(d!==void 0)s=s&&d.error===void 0;else if(!s)return!1;if(s){var f;throw 0<r.length&&(f=r[0]),f instanceof Error?f:((r=Error("Unhandled error."+(f?" ("+f.message+")":""))).context=f,r)}if((s=d[e])===void 0)return!1;if(typeof s=="function")Hp(s,this,r);else for(d=Cl(s,f=s.length),s=0;s<f;++s)Hp(d[s],this,r);return!0},ea.prototype.addListener=function(e,r){return zl(this,e,r,!1)},ea.prototype.on=ea.prototype.addListener,ea.prototype.prependListener=function(e,r){return zl(this,e,r,!0)},ea.prototype.once=function(e,r){return ng(r),this.on(e,Al(this,e,r)),this},ea.prototype.prependOnceListener=function(e,r){return ng(r),this.prependListener(e,Al(this,e,r)),this},ea.prototype.removeListener=function(e,r){var s;ng(r);var d=this._events;if(d===void 0)return this;var f=d[e];if(f===void 0)return this;if(f===r||f.listener===r)--this._eventsCount==0?this._events=Object.create(null):(delete d[e],d.removeListener&&this.emit("removeListener",e,f.listener||r));else if(typeof f!="function"){var _=-1;for(s=f.length-1;0<=s;s--)if(f[s]===r||f[s].listener===r){var C=f[s].listener;_=s;break}if(0>_)return this;if(_===0)f.shift();else{for(;_+1<f.length;_++)f[_]=f[_+1];f.pop()}f.length===1&&(d[e]=f[0]),d.removeListener!==void 0&&this.emit("removeListener",e,C||r)}return this},ea.prototype.off=ea.prototype.removeListener,ea.prototype.removeAllListeners=function(e){var r=this._events;if(r===void 0)return this;if(r.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):r[e]!==void 0&&(--this._eventsCount==0?this._events=Object.create(null):delete r[e]),this;if(arguments.length===0){var s=Object.keys(r);for(r=0;r<s.length;++r){var d=s[r];d!=="removeListener"&&this.removeAllListeners(d)}return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(typeof(s=r[e])=="function")this.removeListener(e,s);else if(s!==void 0)for(r=s.length-1;0<=r;r--)this.removeListener(e,s[r]);return this},ea.prototype.listeners=function(e){return Bl(this,e,!0)},ea.prototype.rawListeners=function(e){return Bl(this,e,!1)},ea.listenerCount=function(e,r){return typeof e.listenerCount=="function"?e.listenerCount(r):Dl.call(e,r)},ea.prototype.listenerCount=Dl,ea.prototype.eventNames=function(){return 0<this._eventsCount?ux(this._events):[]},ea.once=function(e,r){return new Promise(function(s,d){function f(C){e.removeListener(r,_),d(C)}function _(){typeof e.removeListener=="function"&&e.removeListener("error",f),s([].slice.call(arguments))}El(e,r,_,{once:!0}),r!=="error"&&vs(e,f,{once:!0})})};var Qe=Object.assign,Kp=Object.defineProperty,Lp=!Qe||R(function(){if(ka&&Qe({b:1},Qe(Kp({},"a",{enumerable:!0,get:function(){Kp(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var e={},r={},s=Symbol();return e[s]=7,"abcdefghijklmnopqrst".split("").forEach(function(d){r[d]=d}),Qe({},e)[s]!=7||Dc(Qe({},r)).join("")!="abcdefghijklmnopqrst"})?function(e,r){for(var s=Qa(e),d=arguments.length,f=1,_=Bf.f,C=zf;d>f;)for(var P,x=Af(arguments[f++]),B=_?Dc(x).concat(_(x)):Dc(x),_t=B.length,ue=0;_t>ue;)P=B[ue++],(!ka||C.call(x,P))&&(s[P]=x[P]);return s}:Qe;N({target:"Object",stat:!0,forced:Object.assign!==Lp},{assign:Lp}),zp("Map",function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}},Cp);var vx=Math.log,wx=Math.LN2;N({target:"Math",stat:!0},{log2:function(e){return vx(e)/wx}});var xx=Ra.f,yx=Hd.f,zx=Za.enforce,Ax=qa("match"),sc=y.RegExp,lk=sc.prototype,Wf=/a/g,mk=/a/g,nk=new sc(Wf)!==Wf;if(ka&&nc("RegExp",!nk||pc||R(function(){return mk[Ax]=!1,sc(Wf)!=Wf||sc(mk)==mk||sc(Wf,"i")!="/a/i"}))){for(var Oc=function(e,r){var s,d=this instanceof Oc,f=Lj(e),_=r===void 0;return!d&&f&&e.constructor===Oc&&_||(nk?f&&!_&&(e=e.source):e instanceof Oc&&(_&&(r=tj.call(e)),e=e.source),pc&&(s=!!r&&-1<r.indexOf("y"))&&(r=r.replace(/y/g,"")),e=lh(nk?new sc(e,r):sc(e,r),d?this:lk,Oc),pc&&s&&(zx(e).sticky=!0)),e},Bx=function(e){e in Oc||xx(Oc,e,{configurable:!0,get:function(){return sc[e]},set:function(r){sc[e]=r}})},Mp=yx(sc),Np=0;Mp.length>Np;)Bx(Mp[Np++]);lk.constructor=Oc,Oc.prototype=lk,Ta(y,"RegExp",Oc)}If("RegExp"),Sf("Float32",function(e){return function(r,s,d){return e(this,r,s,d)}}),Sf("Float64",function(e){return function(r,s,d){return e(this,r,s,d)}}),Sf("Uint32",function(e){return function(r,s,d){return e(this,r,s,d)}}),Sf("Uint16",function(e){return function(r,s,d){return e(this,r,s,d)}});var ok=function(e,r){return e===r?0:e==null?r==null?0:-1:r==null?e==null?0:1:typeof e.compare=="function"?e.compare(r):typeof r.compare=="function"?-r.compare(e):e<r?-1:e>r?1:0},pk=[],Op=pk.sort,Cx=R(function(){pk.sort(void 0)}),Dx=R(function(){pk.sort(null)}),Ex=Ee("sort");N({target:"Array",proto:!0,forced:Cx||!Dx||!Ex},{sort:function(e){return e===void 0?Op.call(Qa(this)):Op.call(Qa(this),yb(e))}});var Pp=Object.getPrototypeOf({}),Xf=function(e,r){var s;return e===r||(e==null?e==r:X(e.equiv)==="function"?e.equiv(r):r==null?e==r:X(r.equiv)==="function"?r.equiv(e):X(e)!=="string"&&X(r)!=="string"&&((s=Object.getPrototypeOf(e))!=null&&s!==Pp||(s=Object.getPrototypeOf(r))!=null&&s!==Pp?X(e)!=="function"&&e.length!==void 0&&X(r)!=="function"&&r.length!==void 0?Gx(e,r):e instanceof Set&&r instanceof Set?Hx(e,r):e instanceof Map&&r instanceof Map?Ix(e,r):e instanceof Date&&r instanceof Date?e.getTime()===r.getTime():e instanceof RegExp&&r instanceof RegExp?e.toString()===r.toString():e!=e&&r!=r:Fx(e,r)))},Gx=function(e,r){var s=2<arguments.length&&arguments[2]!==void 0?arguments[2]:Xf,d=e.length;if(d===r.length)for(;0<=--d&&s(e[d],r[d]););return 0>d},Hx=function(e,r){var s=2<arguments.length&&arguments[2]!==void 0?arguments[2]:Xf;return e.size===r.size&&s(G(e.keys()).sort(),G(r.keys()).sort())},Ix=function(e,r){var s=2<arguments.length&&arguments[2]!==void 0?arguments[2]:Xf;return e.size===r.size&&s(G(e).sort(),G(r).sort())},Fx=function(e,r){var s=2<arguments.length&&arguments[2]!==void 0?arguments[2]:Xf;if(Object.keys(e).length!==Object.keys(r).length)return!1;for(var d in e)if(!r.hasOwnProperty(d)||!s(e[d],r[d]))return!1;return!0},Qp=function(e){var r=1<arguments.length&&arguments[1]!==void 0?arguments[1]:function(s){return s!==void 0?": "+s:""};return function(s){function d(_){return W(this,d),f.call(this,e(_)+r(_))}la(d,s);var f=ma(d);return d}(ef(Error))},Jx=Qp(function(){return"illegal argument(s)"}),vh=function(e){throw new Jx(e)},qk=Qp(function(){return"index out of bounds"}),Rp=1/4294967295,Kx=function(){function e(){W(this,e)}return Ha(e,[{key:"float",value:function(){var r=0<arguments.length&&arguments[0]!==void 0?arguments[0]:1;return this.int()*Rp*r}},{key:"norm",value:function(){var r=0<arguments.length&&arguments[0]!==void 0?arguments[0]:1;return 2*(this.int()*Rp-.5)*r}},{key:"minmax",value:function(r,s){return this.float()*(s-r)+r}}]),e}(),rk=Math.random,Lx=new(function(e){function r(){return W(this,r),s.apply(this,arguments)}la(r,e);var s=ma(r);return Ha(r,[{key:"int",value:function(){return 4294967296*rk()>>>0}},{key:"float",value:function(){var d=0<arguments.length&&arguments[0]!==void 0?arguments[0]:1;return rk()*d}},{key:"norm",value:function(){var d=0<arguments.length&&arguments[0]!==void 0?arguments[0]:1;return 2*(rk()-.5)*d}}]),r}(Kx)),Vh=Symbol(),Hl=function(){},Mx=fk.onFreeze,sk=Object.freeze,Nx=R(function(){sk(1)});N({target:"Object",stat:!0,forced:Nx,sham:!yp},{freeze:function(e){return sk&&ha(e)?sk(Mx(e)):e}});var Ox=Ee("reduce"),Px=!Hc&&79<id&&83>id;N({target:"Array",proto:!0,forced:!Ox||Px},{reduce:function(e){return Wo(this,e,arguments.length,1<arguments.length?arguments[1]:void 0)}});var Gl=function(e){return e!=null&&typeof e.xform=="function"?e.xform():e},og=function(){function e(r){W(this,e),this.value=r}return Ha(e,[{key:"deref",value:function(){return this.value}}]),e}(),Wh=function(e){return e instanceof og?e.deref():e},xs=function(e,r){return[e,function(s){return s},r]},Qx=w.mark(function(e,r){var s,d,f,_,C,P;return w.wrap(function(x){for(;;)switch(x.prev=x.next){case 0:s=Gl(e)(ws()),d=s[1],f=s[2],_=0;case 4:if(!(_<r.length)){x.next=15;break}if(C=r[_],!((P=f([],C))instanceof og)){x.next=10;break}return x.delegateYield(Wh(d(P.deref())),"t0",9);case 9:return x.abrupt("return");case 10:if(!P.length){x.next=12;break}return x.delegateYield(P,"t1",12);case 12:_++,x.next=4;break;case 15:return x.delegateYield(Wh(d([])),"t2",16);case 16:case"end":return x.stop()}},Qx)}),ys=w.mark(Fl),zs=function(e,r){return[e[0],e[1],r]},Sp=!0;"findIndex"in[]&&Array(1).findIndex(function(){Sp=!1}),N({target:"Array",proto:!0,forced:Sp},{findIndex:function(e){return An(this,e,1<arguments.length?arguments[1]:void 0)}}),Ld("findIndex"),N({target:"Array",proto:!0},{fill:yj}),Ld("fill");var Rx=function(){function e(r){W(this,e),this._length=0,r&&this.into(r)}return Ha(e,[{key:"length",get:function(){return this._length}},{key:"copy",value:function(){return new e(this)}},{key:"empty",value:function(){return new e}},{key:"clear",value:function(){this.release()}},{key:"release",value:function(){for(var r,s=this.head;s;)r=s.next,delete s.value,delete s.prev,delete s.next,s=r;return delete this.head,delete this.tail,this._length=0,!0}},{key:"compare",value:function(r){var s=this._length;if(s<r._length)return-1;if(s>r._length)return 1;if(s===0)return 0;s=this.head,r=r.head;for(var d=0;s&&d==0;)d=ok(s.value,r.value),s=s.next,r=r.next;return d}},{key:"equiv",value:function(r){if(!(r instanceof e||r!=null&&typeof r!="function"&&r.length!==void 0)||this._length!==r.length)return!1;if(!this._length||this===r)return!0;for(var s=this.head,d=0;d<r.length;d++){if(!Xf(s.value,r[d]))return!1;s=s.next}return!0}},{key:Symbol.iterator,value:w.mark(function r(){var s;return w.wrap(function(d){for(;;)switch(d.prev=d.next){case 0:s=this.head;case 1:if(!s){d.next=7;break}return d.next=4,s.value;case 4:s=s.next,d.next=1;break;case 7:case"end":return d.stop()}},r,this)})},{key:"seq",value:function(){var r=0<arguments.length&&arguments[0]!==void 0?arguments[0]:0,s=1<arguments.length&&arguments[1]!==void 0?arguments[1]:this.length;if(!(r>=s||0>r)){r=this.nthCell(r);var d=this.nthCell(s-1);return s=function f(_){return{first:function(){return _.value},next:function(){return _!==d&&_.next?f(_.next):void 0}}},r?s(r):void 0}}},{key:"cycle",value:w.mark(function r(){return w.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.delegateYield(this,"t0",2);case 2:s.next=0;break;case 4:case"end":return s.stop()}},r,this)})},{key:"$reduce",value:function(r,s){for(var d=this.head;d&&!(s instanceof og);)s=r(s,d.value),d=d.next;return s}},{key:"drop",value:function(){var r=this.head;if(r)return(this.head=r.next)?delete this.head.prev:delete this.tail,this._length--,r.value}},{key:"cons",value:function(r){return r={value:r,next:this.head},this.head?this.head.prev=r:this.tail=r,this.head=r,this._length++,this}},{key:"insertBefore",value:function(r,s){return r||vh("cell is undefined"),s={value:s,next:r,prev:r.prev},r.prev?r.prev.next=s:this.head=s,r.prev=s,this._length++,this}},{key:"insertAfter",value:function(r,s){return r||vh("cell is undefined"),s={value:s,next:r.next,prev:r},r.next?r.next.prev=s:this.tail=s,r.next=s,this._length++,this}},{key:"insertBeforeNth",value:function(r,s){if(0>r&&(r+=this._length),0>=r)return this.cons(s);if(0>r||r>=this._length)throw new qk(r);return this.insertBefore(this.nthCellUnsafe(r),s)}},{key:"insertAfterNth",value:function(r,s){if(0>r&&(r+=this._length),r>=this._length-1)return this.push(s);if(0>r||r>=this._length)throw new qk(r);return this.insertAfter(this.nthCellUnsafe(r),s)}},{key:"insertSorted",value:function(r,s){s=s||ok;for(var d=this.head;d;){if(0>=s(r,d.value))return this.insertBefore(d,r);d=d.next}return this.push(r)}},{key:"find",value:function(r){for(var s=this.head;s;){if(s.value===r)return s;s=s.next}}},{key:"findWith",value:function(r){for(var s=this.head;s;){if(r(s.value))return s;s=s.next}}},{key:"concat",value:function(){for(var r=this.copy(),s=arguments.length,d=Array(s),f=0;f<s;f++)d[f]=arguments[f];for(s=0;s<d.length;s++)r.into(d[s]);return r}},{key:"into",value:function(r){for(var s=0;s<r.length;s++)this.push(r[s])}},{key:"slice",value:function(){var r=0<arguments.length&&arguments[0]!==void 0?arguments[0]:0,s=1<arguments.length&&arguments[1]!==void 0?arguments[1]:this.length;r=0>r?r+this._length:r,s=0>s?s+this._length:s,(0>r||0>s)&&vh("invalid indices: ${from} / ${to}");for(var d=new e,f=this.nthCell(r);f&&++r<=s;)d.push(f.value),f=f.next;return d}},{key:"splice",value:function(r){var s=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0,d=2<arguments.length?arguments[2]:void 0;if(typeof r=="number"){if(0>r&&(r+=this._length),0>r||r>=this._length)throw new qk(r);var f=this.nthCellUnsafe(r)}else f=r;var _=new e;if(0<s)for(;f&&0<s--;)this.remove(f),_.push(f.value),f=f.next;else f&&(f=f.next);if(d)if(f)for(s=0;s<d.length;s++)this.insertBefore(f,d[s]);else for(f=0;f<d.length;f++)this.push(d[f]);return _}},{key:"remove",value:function(r){return r.prev?r.prev.next=r.next:this.head=r.next,r.next?r.next.prev=r.prev:this.tail=r.prev,this._length--,this}},{key:"swap",value:function(r,s){if(r!==s){var d=r.value;r.value=s.value,s.value=d}return this}},{key:"push",value:function(r){return this.tail?(r={value:r,prev:this.tail},this.tail=this.tail.next=r,this._length++,this):this.cons(r)}},{key:"pop",value:function(){var r=this.tail;if(r)return(this.tail=r.prev)?delete this.tail.next:delete this.head,this._length--,r.value}},{key:"first",value:function(){return this.head&&this.head.value}},{key:"peek",value:function(){return this.tail&&this.tail.value}},{key:"setHead",value:function(r){return this.head?(this.head.value=r,this):this.cons(r)}},{key:"setTail",value:function(r){return this.tail?(this.tail.value=r,this):this.push(r)}},{key:"setNth",value:function(r,s){var d=this.nthCell(r);return!d&&vh("index out of bounds: ".concat(r)),d.value=s,this}},{key:"nth",value:function(r,s){return(r=this.nthCell(r))?r.value:s}},{key:"nthCell",value:function(r){if(0>r&&(r+=this._length),!(0>r||r>=this._length))return this.nthCellUnsafe(r)}},{key:"rotateLeft",value:function(){switch(this._length){case 0:case 1:return this;case 2:return this.swap(this.head,this.tail);default:return this.push(this.drop())}}},{key:"rotateRight",value:function(){switch(this._length){case 0:case 1:return this;case 2:return this.swap(this.head,this.tail);default:var r=this.peek();return this.pop(),this.cons(r)}}},{key:"map",value:function(r){for(var s=new e,d=this.head;d;)s.push(r(d.value)),d=d.next;return s}},{key:"filter",value:function(r){for(var s=new e,d=this.head;d;)r(d.value)&&s.push(d.value),d=d.next;return s}},{key:"reduce",value:function(r,s){for(var d=this.head;d;)s=r(s,d.value),d=d.next;return s}},{key:"shuffle",value:function(r){var s=1<arguments.length&&arguments[1]!==void 0?arguments[1]:Lx;if(2>this._length)return this;for(r=r??Math.ceil(1.5*Math.log2(this._length));0<r;r--)for(var d=this.head;d;){var f=d.next;.5>s.float()?this.asHead(d):this.asTail(d),d=f}return this}},{key:"sort",value:function(){var r=0<arguments.length&&arguments[0]!==void 0?arguments[0]:ok;if(!this._length)return this;for(var s=1;;){var d=this.head;this.tail=this.head=void 0;for(var f=0;d;){f++;for(var _=d,C=0,P=0;P<s&&(C++,_=_.next);P++);for(P=s;0<C||0<P&&_;){if(C===0){var x=_;_=_.next,P--}else _&&P!==0?0>=r(d.value,_.value)?(x=d,d=d.next,C--):(x=_,_=_.next,P--):(x=d,d=d.next,C--);this.tail?this.tail.next=x:this.head=x,x.prev=this.tail,this.tail=x}d=_}if(this.tail.next=void 0,1>=f)return this;s*=2}}},{key:"reverse",value:function(){for(var r=this.head,s=this.tail,d=(this._length>>>1)+(1&this._length);r&&s&&0<d;){var f=r.value;r.value=s.value,s.value=f,r=r.next,s=s.prev,d--}return this}},{key:"asHead",value:function(r){return r===this.head||(this.remove(r),this.head.prev=r,r.next=this.head,r.prev=void 0,this.head=r,this._length++),this}},{key:"asTail",value:function(r){return r===this.tail||(this.remove(r),this.tail.next=r,r.prev=this.tail,r.next=void 0,this.tail=r,this._length++),this}},{key:"toString",value:function(){for(var r=[],s=this.head;s;)r.push(String(s.value)),s=s.next;return r.join(", ")}},{key:"toJSON",value:function(){return G(this)}},{key:"nthCellUnsafe",value:function(r){if(r<=this._length>>1)var s=this.head,d="next";else s=this.tail,d="prev",r=this._length-r-1;for(;0<r--&&s;)s=s[d];return s}}]),e}(),tc=function(){function e(r,s){W(this,e),s=Object.assign({maxlen:1/0,maxsize:1/0,map:function(){return new Map},ksize:function(){return 0},vsize:function(){return 0}},s),this.map=s.map(),this.items=new Rx,this._size=0,this.opts=s,r&&this.into(r)}return Ha(e,[{key:"length",get:function(){return this.items.length}},{key:"size",get:function(){return this._size}},{key:Symbol.iterator,value:function(){return this.entries()}},{key:"entries",value:function(){return pg(function(r){return[r.k,r]},this.items)}},{key:"keys",value:function(){return pg(function(r){return r.k},this.items)}},{key:"values",value:function(){return pg(function(r){return r.v},this.items)}},{key:"copy",value:function(){var r=this.empty();r.items=this.items.copy();for(var s=r.items.head;s;)r.map.set(s.value.k,s),s=s.next;return r}},{key:"empty",value:function(){return new e(null,this.opts)}},{key:"release",value:function(){this._size=0,this.map.clear();var r=this.opts.release;if(r){for(var s;s=this.items.drop();)r(s.k,s.v);return!0}return this.items.release()}},{key:"has",value:function(r){return this.map.has(r)}},{key:"get",value:function(r,s){return(r=this.map.get(r))?this.resetEntry(r):s}},{key:"set",value:function(r,s){var d=this.opts.ksize(r)+this.opts.vsize(s),f=this.map.get(r);return this._size+=Math.max(0,d-(f?f.value.s:0)),this.ensureSize()&&this.doSetEntry(f,r,s,d),s}},{key:"into",value:function(r){for(var s=0;s<r.length;s++){var d=r[s];this.set(d[0],d[1])}return this}},{key:"getSet",value:function(r,s){var d=this,f=this.map.get(r);return f?Promise.resolve(this.resetEntry(f)):s().then(function(_){return d.set(r,_)})}},{key:"delete",value:function(r){return!!(r=this.map.get(r))&&(this.removeEntry(r),!0)}},{key:"resetEntry",value:function(r){return this.items.asTail(r),r.value.v}},{key:"ensureSize",value:function(){for(var r=this.opts.release,s=this.opts.maxsize,d=this.opts.maxlen;this._size>s||this.length>=d;){var f=this.items.drop();if(!f)return!1;this.map.delete(f.k),r&&r(f.k,f.v),this._size-=f.s}return!0}},{key:"removeEntry",value:function(r){var s=r.value;this.map.delete(s.k),this.items.remove(r),this.opts.release&&this.opts.release(s.k,s.v),this._size-=s.s}},{key:"doSetEntry",value:function(r,s,d,f){r?(r.value.v=d,r.value.s=f,this.items.asTail(r)):(this.items.push({k:s,v:d,s:f}),this.map.set(s,this.items.tail))}}]),e}(),Sx=function(e){function r(d,f){return W(this,r),f=Object.assign({ttl:36e5},f),s.call(this,d,f)}la(r,e);var s=ma(r);return Ha(r,[{key:"empty",value:function(){return new r(null,this.opts)}},{key:"has",value:function(d){return this.get(d)!==void 0}},{key:"get",value:function(d,f){if(d=this.map.get(d)){if(d.value.t>=Date.now())return this.resetEntry(d);this.removeEntry(d)}return f}},{key:"set",value:function(d,f){var _=2<arguments.length&&arguments[2]!==void 0?arguments[2]:this.opts.ttl,C=this.opts.ksize(d)+this.opts.vsize(f),P=this.map.get(d);return this._size+=Math.max(0,C-(P?P.value.s:0)),this.ensureSize()&&(_=Date.now()+_,P?(P.value.v=f,P.value.s=C,P.value.t=_,this.items.asTail(P)):(this.items.push({k:d,v:f,s:C,t:_}),this.map.set(d,this.items.tail))),f}},{key:"getSet",value:function(d,f){var _=this,C=2<arguments.length&&arguments[2]!==void 0?arguments[2]:this.opts.ttl,P=this.get(d);return P?Promise.resolve(P):f().then(function(x){return _.set(d,x,C)})}},{key:"prune",value:function(){for(var d=Date.now(),f=this.items.head;f;)f.value.t<d&&this.removeEntry(f),f=f.next}},{key:"ensureSize",value:function(){for(var d=this.opts.maxsize,f=this.opts.maxlen,_=Date.now(),C=this.items.head;C&&(this._size>d||this.length>=f);)C.value.t<_&&this.removeEntry(C),C=C.next;return Th(wd(r.prototype),"ensureSize",this).call(this)}}]),r}(tc),Tp=X(Ya)=="object"&&Ya&&Ya.Object===Object&&Ya,Tx=(typeof self>"u"?"undefined":X(self))=="object"&&self&&self.Object===Object&&self,Cb=Tp||Tx||Function("return this")(),Pb=Cb.Symbol,Up=Object.prototype,Ux=Up.hasOwnProperty,Vx=Up.toString,Yf=Pb?Pb.toStringTag:void 0,Wx=Object.prototype.toString,Vp=Pb?Pb.toStringTag:void 0,Qd=function(e){if(e==null)e=e===void 0?"[object Undefined]":"[object Null]";else if(Vp&&Vp in Object(e)){var r=Ux.call(e,Yf),s=e[Yf];try{e[Yf]=void 0;var d=!0}catch{}var f=Vx.call(e);d&&(r?e[Yf]=s:delete e[Yf]),e=f}else e=Wx.call(e);return e},lb=function(e){var r=X(e);return e!=null&&(r=="object"||r=="function")},qi=function(e){return!!lb(e)&&((e=Qd(e))=="[object Function]"||e=="[object GeneratorFunction]"||e=="[object AsyncFunction]"||e=="[object Proxy]")},tk=Cb["__core-js_shared__"],Wp=function(){var e=/[^.]+$/.exec(tk&&tk.keys&&tk.keys.IE_PROTO||"");return e?"Symbol(src)_1."+e:""}(),Xx=Function.prototype.toString,Rd=function(e){if(e!=null){try{return Xx.call(e)}catch{}return e+""}return""},Yx=/^\[object .+?Constructor\]$/,Zx=RegExp("^"+Function.prototype.toString.call(Object.prototype.hasOwnProperty).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Sd=function(e,r){return e=e==null?void 0:e[r],!lb(e)||Wp&&Wp in e||!(qi(e)?Zx:Yx).test(Rd(e))?void 0:e},Zf=Sd(Object,"create"),$x=Object.prototype.hasOwnProperty,ay=Object.prototype.hasOwnProperty;zd.prototype.clear=function(){this.__data__=Zf?Zf(null):{},this.size=0},zd.prototype.delete=function(e){return e=this.has(e)&&delete this.__data__[e],this.size-=e?1:0,e},zd.prototype.get=function(e){var r=this.__data__;return Zf?(e=r[e])==="__lodash_hash_undefined__"?void 0:e:$x.call(r,e)?r[e]:void 0},zd.prototype.has=function(e){var r=this.__data__;return Zf?r[e]!==void 0:ay.call(r,e)},zd.prototype.set=function(e,r){var s=this.__data__;return this.size+=this.has(e)?0:1,s[e]=Zf&&r===void 0?"__lodash_hash_undefined__":r,this};var $f=function(e,r){return e===r||e!=e&&r!=r},wh=function(e,r){for(var s=e.length;s--;)if($f(e[s][0],r))return s;return-1},by=Array.prototype.splice;ce.prototype.clear=function(){this.__data__=[],this.size=0},ce.prototype.delete=function(e){var r=this.__data__;return!(0>(e=wh(r,e)))&&(e==r.length-1?r.pop():by.call(r,e,1),--this.size,!0)},ce.prototype.get=function(e){var r=this.__data__;return 0>(e=wh(r,e))?void 0:r[e][1]},ce.prototype.has=function(e){return-1<wh(this.__data__,e)},ce.prototype.set=function(e,r){var s=this.__data__,d=wh(s,e);return 0>d?(++this.size,s.push([e,r])):s[d][1]=r,this};var rg=ce,ag=Sd(Cb,"Map"),xh=function(e,r){e=e.__data__;var s=X(r);return(s=="string"||s=="number"||s=="symbol"||s=="boolean"?r!=="__proto__":r===null)?e[typeof r=="string"?"string":"hash"]:e.map};de.prototype.clear=function(){this.size=0,this.__data__={hash:new zd,map:new(ag||rg),string:new zd}},de.prototype.delete=function(e){return e=xh(this,e).delete(e),this.size-=e?1:0,e},de.prototype.get=function(e){return xh(this,e).get(e)},de.prototype.has=function(e){return xh(this,e).has(e)},de.prototype.set=function(e,r){var s=xh(this,e),d=s.size;return s.set(e,r),this.size+=s.size==d?0:1,this};var qg=de;gf.prototype.add=gf.prototype.push=function(e){return this.__data__.set(e,"__lodash_hash_undefined__"),this},gf.prototype.has=function(e){return this.__data__.has(e)};var Xp=function(e,r,s,d){var f=e.length;for(s+=d?1:-1;d?s--:++s<f;)if(r(e[s],s,e))return s;return-1},cy=function(e){return e!=e},dy=function(e,r){var s;if(s=!(e==null||!e.length)){if(r==r)t:{s=-1;for(var d=e.length;++s<d;)if(e[s]===r){e=s;break t}e=-1}else e=Xp(e,cy,0);s=-1<e}return s},ey=function(e,r,s){for(var d=-1,f=e==null?0:e.length;++d<f;)if(s(r,e[d]))return!0;return!1},fy=function(e,r){return e.has(r)},Re=Sd(Cb,"Set"),gy=function(){},uk=function(e){var r=-1,s=Array(e.size);return e.forEach(function(d){s[++r]=d}),s},hy=1/0,iy=Re&&1/uk(new Re([,-0]))[1]==hy?function(e){return new Re(e)}:gy,vk=function(e,r,s){var d=-1,f=dy,_=e.length,C=!0,P=[],x=P;if(s)C=!1,f=ey;else if(200<=_){if(f=r?null:iy(e))return uk(f);C=!1,f=fy,x=new gf}else x=r?[]:P;t:for(;++d<_;){var B=e[d],_t=r?r(B):B;if(B=s||B!==0?B:0,C&&_t==_t){for(var ue=x.length;ue--;)if(x[ue]===_t)continue t;r&&x.push(_t),P.push(B)}else f(x,_t,s)||(x!==P&&x.push(_t),P.push(B))}return P},Yp=function(e){for(var r=-1,s=e==null?0:e.length,d={};++r<s;){var f=e[r];d[f[0]]=f[1]}return d},he=function(e,r){for(var s=-1,d=e==null?0:e.length,f=Array(d);++s<d;)f[s]=r(e[s],s,e);return f};ee.prototype.clear=function(){this.__data__=new rg,this.size=0},ee.prototype.delete=function(e){var r=this.__data__;return e=r.delete(e),this.size=r.size,e},ee.prototype.get=function(e){return this.__data__.get(e)},ee.prototype.has=function(e){return this.__data__.has(e)},ee.prototype.set=function(e,r){var s=this.__data__;if(s instanceof rg){var d=s.__data__;if(!ag||199>d.length)return d.push([e,r]),this.size=++s.size,this;s=this.__data__=new qg(d)}return s.set(e,r),this.size=s.size,this};var ge=ee,Is=function(e,r){for(var s=-1,d=e==null?0:e.length;++s<d&&r(e[s],s,e)!==!1;);return e},yh=function(){try{var e=Sd(Object,"defineProperty");return e({},"",{}),e}catch{}}(),bg=function(e,r,s){r=="__proto__"&&yh?yh(e,r,{configurable:!0,enumerable:!0,value:s,writable:!0}):e[r]=s},jy=Object.prototype.hasOwnProperty,Ml=function(e,r,s){var d=e[r];jy.call(e,r)&&$f(d,s)&&(s!==void 0||r in e)||bg(e,r,s)},re=function(e,r,s,d){var f=!s;s||(s={});for(var _=-1,C=r.length;++_<C;){var P=r[_],x=d?d(s[P],e[P],P,s,e):void 0;x===void 0&&(x=e[P]),f?bg(s,P,x):Ml(s,P,x)}return s},gc=function(e){return e!=null&&X(e)=="object"},Zp=function(e){return gc(e)&&Qd(e)=="[object Arguments]"},$p=Object.prototype,ky=$p.hasOwnProperty,ly=$p.propertyIsEnumerable,rf=Zp(function(){return arguments}())?Zp:function(e){return gc(e)&&ky.call(e,"callee")&&!ly.call(e,"callee")},Va=Array.isArray,my=function(){return!1},jf=$a(function(e,r){var s=(r=r&&!r.nodeType&&r)&&e&&!e.nodeType&&e;r=s&&s.exports===r?Cb.Buffer:void 0,e.exports=(r?r.isBuffer:void 0)||my}),ny=/^(?:0|[1-9]\d*)$/,wk=function(e,r){var s=X(e);return!!(r=r??9007199254740991)&&(s=="number"||s!="symbol"&&ny.test(e))&&-1<e&&e%1==0&&e<r},xk=function(e){return typeof e=="number"&&-1<e&&e%1==0&&9007199254740991>=e},Ea={};Ea["[object Float32Array]"]=Ea["[object Float64Array]"]=Ea["[object Int8Array]"]=Ea["[object Int16Array]"]=Ea["[object Int32Array]"]=Ea["[object Uint8Array]"]=Ea["[object Uint8ClampedArray]"]=Ea["[object Uint16Array]"]=Ea["[object Uint32Array]"]=!0,Ea["[object Arguments]"]=Ea["[object Array]"]=Ea["[object ArrayBuffer]"]=Ea["[object Boolean]"]=Ea["[object DataView]"]=Ea["[object Date]"]=Ea["[object Error]"]=Ea["[object Function]"]=Ea["[object Map]"]=Ea["[object Number]"]=Ea["[object Object]"]=Ea["[object RegExp]"]=Ea["[object Set]"]=Ea["[object String]"]=Ea["[object WeakMap]"]=!1;var oy=function(e){return gc(e)&&xk(e.length)&&!!Ea[Qd(e)]},zh=function(e){return function(r){return e(r)}},Se=$a(function(e,r){var s=r&&!r.nodeType&&r;s=(r=s&&e&&!e.nodeType&&e)&&r.exports===s&&Tp.process;t:{try{var d=r&&r.require&&r.require("util").types;if(d){var f=d;break t}f=s&&s.binding&&s.binding("util");break t}catch{}f=void 0}e.exports=f}),aq=Se&&Se.isTypedArray,bi=aq?zh(aq):oy,py=Object.prototype.hasOwnProperty,bq=function(e,r){var s=Va(e),d=!s&&rf(e),f=!s&&!d&&jf(e),_=!s&&!d&&!f&&bi(e);if(s=s||d||f||_){d=e.length;for(var C=String,P=-1,x=Array(d);++P<d;)x[P]=C(P);d=x}else d=[];for(var B in C=d.length,e)!r&&!py.call(e,B)||s&&(B=="length"||f&&(B=="offset"||B=="parent")||_&&(B=="buffer"||B=="byteLength"||B=="byteOffset")||wk(B,C))||d.push(B);return d},qy=Object.prototype,yk=function(e){var r=e&&e.constructor;return e===(typeof r=="function"&&r.prototype||qy)},cq=function(e,r){return function(s){return e(r(s))}},ry=cq(Object.keys,Object),sy=Object.prototype.hasOwnProperty,Ed=function(e){return e!=null&&xk(e.length)&&!qi(e)},Ad=function(e){if(Ed(e))e=bq(e);else if(yk(e)){var r,s=[];for(r in Object(e))sy.call(e,r)&&r!="constructor"&&s.push(r);e=s}else e=ry(e);return e},Es=function(e,r){return e&&re(r,Ad(r),e)},ty=Object.prototype.hasOwnProperty,kf=function(e){if(Ed(e))e=bq(e,!0);else if(lb(e)){var r=yk(e),s=[];for(d in e)(d!="constructor"||!r&&ty.call(e,d))&&s.push(d);e=s}else{var d=[];if(e!=null)for(r in Object(e))d.push(r);e=d}return e},Cs=function(e,r){return e&&re(r,kf(r),e)},Jl=$a(function(e,r){var s=(r=r&&!r.nodeType&&r)&&e&&!e.nodeType&&e,d=(r=s&&s.exports===r?Cb.Buffer:void 0)?r.allocUnsafe:void 0;e.exports=function(f,_){return _?f.slice():(_=f.length,_=d?d(_):new f.constructor(_),f.copy(_),_)}}),Xh=function(e,r){var s=-1,d=e.length;for(r||(r=Array(d));++s<d;)r[s]=e[s];return r},uy=function(e,r){for(var s=-1,d=e==null?0:e.length,f=0,_=[];++s<d;){var C=e[s];r(C,s,e)&&(_[f++]=C)}return _},dq=function(){return[]},vy=Object.prototype.propertyIsEnumerable,eq=Object.getOwnPropertySymbols,zk=eq?function(e){return e==null?[]:(e=Object(e),uy(eq(e),function(r){return vy.call(e,r)}))}:dq,Ds=function(e,r){return re(e,zk(e),r)},ai=function(e,r){for(var s=-1,d=r.length,f=e.length;++s<d;)e[f+s]=r[s];return e},Ak=cq(Object.getPrototypeOf,Object),fq=Object.getOwnPropertySymbols?function(e){for(var r=[];e;)ai(r,zk(e)),e=Ak(e);return r}:dq,Bs=function(e,r){return re(e,fq(e),r)},gq=function(e,r,s){return r=r(e),Va(e)?r:ai(r,s(e))},Yh=function(e){return gq(e,Ad,zk)},Ll=function(e){return gq(e,kf,fq)},Bk=Sd(Cb,"DataView"),Ck=Sd(Cb,"Promise"),Dk=Sd(Cb,"WeakMap"),wy=Rd(Bk),xy=Rd(ag),yy=Rd(Ck),zy=Rd(Re),Ay=Rd(Dk),Td=Qd;(Bk&&Td(new Bk(new ArrayBuffer(1)))!="[object DataView]"||ag&&Td(new ag)!="[object Map]"||Ck&&Td(Ck.resolve())!="[object Promise]"||Re&&Td(new Re)!="[object Set]"||Dk&&Td(new Dk)!="[object WeakMap]")&&(Td=function(e){var r=Qd(e);if(e=(e=r=="[object Object]"?e.constructor:void 0)?Rd(e):"")switch(e){case wy:return"[object DataView]";case xy:return"[object Map]";case yy:return"[object Promise]";case zy:return"[object Set]";case Ay:return"[object WeakMap]"}return r});var hf=Td,By=Object.prototype.hasOwnProperty,As=function(e){var r=e.length,s=new e.constructor(r);return r&&typeof e[0]=="string"&&By.call(e,"index")&&(s.index=e.index,s.input=e.input),s},Ah=Cb.Uint8Array,Ek=function(e){var r=new e.constructor(e.byteLength);return new Ah(r).set(new Ah(e)),r},Cy=/\w*$/,hq=Pb?Pb.prototype:void 0,iq=hq?hq.valueOf:void 0,vm=function(e,r){return r=r?Ek(e.buffer):e.buffer,new e.constructor(r,e.byteOffset,e.length)},Fs=function(e,r,s){var d=e.constructor;switch(r){case"[object ArrayBuffer]":return Ek(e);case"[object Boolean]":case"[object Date]":return new d(+e);case"[object DataView]":return r=s?Ek(e.buffer):e.buffer,new e.constructor(r,e.byteOffset,e.byteLength);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return vm(e,s);case"[object Map]":return new d;case"[object Number]":case"[object String]":return new d(e);case"[object RegExp]":return(r=new e.constructor(e.source,Cy.exec(e))).lastIndex=e.lastIndex,r;case"[object Set]":return new d;case"[object Symbol]":return iq?Object(iq.call(e)):{}}},jq=Object.create,Dy=function(){function e(){}return function(r){return lb(r)?jq?jq(r):(e.prototype=r,r=new e,e.prototype=void 0,r):{}}}(),Kl=function(e){return typeof e.constructor!="function"||yk(e)?{}:Dy(Ak(e))},Ey=function(e){return gc(e)&&hf(e)=="[object Map]"},kq=Se&&Se.isMap,Hs=kq?zh(kq):Ey,Fy=function(e){return gc(e)&&hf(e)=="[object Set]"},lq=Se&&Se.isSet,Gs=lq?zh(lq):Fy,wa={};wa["[object Arguments]"]=wa["[object Array]"]=wa["[object ArrayBuffer]"]=wa["[object DataView]"]=wa["[object Boolean]"]=wa["[object Date]"]=wa["[object Float32Array]"]=wa["[object Float64Array]"]=wa["[object Int8Array]"]=wa["[object Int16Array]"]=wa["[object Int32Array]"]=wa["[object Map]"]=wa["[object Number]"]=wa["[object Object]"]=wa["[object RegExp]"]=wa["[object Set]"]=wa["[object String]"]=wa["[object Symbol]"]=wa["[object Uint8Array]"]=wa["[object Uint8ClampedArray]"]=wa["[object Uint16Array]"]=wa["[object Uint32Array]"]=!0,wa["[object Error]"]=wa["[object Function]"]=wa["[object WeakMap]"]=!1;var ie=function(e){return X(e)=="symbol"||gc(e)&&Qd(e)=="[object Symbol]"},Gy=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Hy=/^\w*$/,Fk=function(e,r){if(Va(e))return!1;var s=X(e);return!(s!="number"&&s!="symbol"&&s!="boolean"&&e!=null&&!ie(e))||Hy.test(e)||!Gy.test(e)||r!=null&&e in Object(r)};Zh.Cache=qg;var Iy=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Jy=/\\(\\)?/g,Ky=function(e){var r=(e=Zh(e,function(s){return r.size===500&&r.clear(),s})).cache;return e}(function(e){var r=[];return e.charCodeAt(0)===46&&r.push(""),e.replace(Iy,function(s,d,f,_){r.push(f?_.replace(Jy,"$1"):d||s)}),r}),Js=1/0,mq=Pb?Pb.prototype:void 0,Ol=mq?mq.toString:void 0,Bh=function(e,r){return Va(e)?e:Fk(e,r)?[e]:Ky(e==null?"":Nl(e))},Ly=1/0,cg=function(e){if(typeof e=="string"||ie(e))return e;var r=e+"";return r=="0"&&1/e==-Ly?"-0":r},Ch=function(e,r){for(var s=0,d=(r=Bh(r,e)).length;e!=null&&s<d;)e=e[cg(r[s++])];return s&&s==d?e:void 0},My=function(e,r){if(!(2>(r=Bh(r,e)).length)){var s=r,d=0,f=-1,_=-1,C=s.length;for(0>d&&(d=-d>C?0:C+d),0>(f=f>C?C:f)&&(f+=C),C=d>f?0:f-d>>>0,d>>>=0,f=Array(C);++_<C;)f[_]=s[_+d];e=Ch(e,f)}return(s=e==null)||(s=r==null?0:r.length,s=delete e[cg(s?r[s-1]:void 0)]),s},nq=Function.prototype.toString,Ny=Object.prototype.hasOwnProperty,Oy=nq.call(Object),wm=function(e){return!(!gc(e)||Qd(e)!="[object Object]")&&((e=Ak(e))===null||typeof(e=Ny.call(e,"constructor")&&e.constructor)=="function"&&e instanceof e&&nq.call(e)==Oy)},Py=function(e){return wm(e)?void 0:e},oq=Pb?Pb.isConcatSpreadable:void 0,Ks=function(e){return Va(e)||rf(e)||!!(oq&&e&&e[oq])},Qy=function(e){return e!=null&&e.length?$h(e,1):[]},Ry=function(e,r,s){switch(s.length){case 0:return e.call(r);case 1:return e.call(r,s[0]);case 2:return e.call(r,s[0],s[1]);case 3:return e.call(r,s[0],s[1],s[2])}return e.apply(r,s)},pq=Math.max,qq=function(e,r,s){return r=pq(r===void 0?e.length-1:r,0),function(){for(var d=arguments,f=-1,_=pq(d.length-r,0),C=Array(_);++f<_;)C[f]=d[r+f];for(f=-1,_=Array(r+1);++f<r;)_[f]=d[f];return _[r]=s(C),Ry(e,this,_)}},Sy=function(e){return function(){return e}},Dh=function(e){return e},Ty=Date.now,rq=function(e){var r=0,s=0;return function(){var d=Ty(),f=16-(d-s);if(s=d,0<f){if(800<=++r)return arguments[0]}else r=0;return e.apply(void 0,arguments)}}(yh?function(e,r){return yh(e,"toString",{configurable:!0,enumerable:!1,value:Sy(r),writable:!0})}:Dh),Gk=function(e){return rq(qq(e,void 0,Qy),e+"")}(function(e,r){var s={};if(e==null)return s;var d=!1;r=he(r,function(_){return _=Bh(_,e),d||(d=1<_.length),_}),re(e,Ll(e),s),d&&(s=fe(s,7,Py));for(var f=r.length;f--;)My(s,r[f]);return s}),Uy=function(e,r,s,d){for(var f=-1,_=e==null?0:e.length;++f<_;){var C=e[f];r(d,C,s(C),e)}return d},um=function(e,r,s){for(var d=-1,f=Object(e),_=(s=s(e)).length;_--;){var C=s[++d];if(r(f[C],C,f)===!1)break}return e},sq=function(e,r){return e&&um(e,r,Ad)},Hk=function(e,r){return function(s,d){if(s==null)return s;if(!Ed(s))return e(s,d);for(var f=s.length,_=-1,C=Object(s);++_<f&&d(C[_],_,C)!==!1;);return s}}(sq),Vy=function(e,r,s,d){return Hk(e,function(f,_,C){r(d,f,s(f),C)}),d},tq=function(e,r){for(var s=-1,d=e==null?0:e.length;++s<d;)if(r(e[s],s,e))return!0;return!1},Pl=function(e,r,s,d,f,_){var C=1&s,P=e.length,x=r.length;if(P!=x&&!(C&&x>P))return!1;x=_.get(e);var B=_.get(r);if(x&&B)return x==r&&B==e;x=-1,B=!0;var _t=2&s?new gf:void 0;for(_.set(e,r),_.set(r,e);++x<P;){var ue=e[x],Wt=r[x];if(d)var _n=C?d(Wt,ue,x,r,e,_):d(ue,Wt,x,e,r,_);if(_n!==void 0){if(_n)continue;B=!1;break}if(_t){if(!tq(r,function(_i,Ei){if(!_t.has(Ei)&&(ue===_i||f(ue,_i,s,d,_)))return _t.push(Ei)})){B=!1;break}}else if(ue!==Wt&&!f(ue,Wt,s,d,_)){B=!1;break}}return _.delete(e),_.delete(r),B},Wy=function(e){var r=-1,s=Array(e.size);return e.forEach(function(d,f){s[++r]=[f,d]}),s},uq=Pb?Pb.prototype:void 0,Ik=uq?uq.valueOf:void 0,Ls=function(e,r,s,d,f,_,C){switch(s){case"[object DataView]":if(e.byteLength!=r.byteLength||e.byteOffset!=r.byteOffset)break;e=e.buffer,r=r.buffer;case"[object ArrayBuffer]":if(e.byteLength!=r.byteLength||!_(new Ah(e),new Ah(r)))break;return!0;case"[object Boolean]":case"[object Date]":case"[object Number]":return $f(+e,+r);case"[object Error]":return e.name==r.name&&e.message==r.message;case"[object RegExp]":case"[object String]":return e==r+"";case"[object Map]":var P=Wy;case"[object Set]":if(P||(P=uk),e.size!=r.size&&!(1&d))break;return(s=C.get(e))?s==r:(d|=2,C.set(e,r),r=Pl(P(e),P(r),d,f,_,C),C.delete(e),r);case"[object Symbol]":if(Ik)return Ik.call(e)==Ik.call(r)}return!1},Ms=Object.prototype.hasOwnProperty,Ql=Object.prototype.hasOwnProperty,Xy=function(e,r,s,d){var f=s.length,_=f,C=!d;if(e==null)return!_;for(e=Object(e);f--;){var P=s[f];if(C&&P[2]?P[1]!==e[P[0]]:!(P[0]in e))return!1}for(;++f<_;){var x=(P=s[f])[0],B=e[x],_t=P[1];if(C&&P[2]){if(B===void 0&&!(x in e))return!1}else{if(P=new ge,d)var ue=d(B,_t,x,e,r,P);if(ue===void 0?!je(_t,B,3,d,P):!ue)return!1}}return!0},Yy=function(e){for(var r=Ad(e),s=r.length;s--;){var d=r[s],f=e[d];r[s]=[d,f,f==f&&!lb(f)]}return r},vq=function(e,r){return function(s){return s!=null&&s[e]===r&&(r!==void 0||e in Object(s))}},Zy=function(e){var r=Yy(e);return r.length==1&&r[0][2]?vq(r[0][0],r[0][1]):function(s){return s===e||Xy(s,e,r)}},$y=function(e,r){return Fk(e)&&r==r&&!lb(r)?vq(cg(e),r):function(s){var d=s==null?void 0:Ch(s,e);if((d=d===void 0?void 0:d)===void 0&&d===r){if(d=s!=null){for(var f=-1,_=(d=Bh(d=e,s)).length,C=!1;++f<_;){var P=cg(d[f]);if(!(C=s!=null&&s!=null&&P in Object(s)))break;s=s[P]}C||++f!=_?d=C:d=!!(_=s==null?0:s.length)&&xk(_)&&wk(P,_)&&(Va(s)||rf(s))}P=d}else P=je(r,d,3);return P}},az=function(e){return function(r){return r==null?void 0:r[e]}},bz=function(e){return function(r){return Ch(r,e)}},Te=function(e){return typeof e=="function"?e:e==null?Dh:X(e)=="object"?Va(e)?$y(e[0],e[1]):Zy(e):Fk(e)?az(cg(e)):bz(e)},Jk=function(e,r){return function(s,d){var f={};return(Va(s)?Uy:Vy)(s,e,Te(d),f)}}(function(e,r,s){bg(e,s,r)}),uc=function(e,r){var s={};return r=Te(r),sq(e,function(d,f,_){bg(s,f,r(d,f,_))}),s};N({target:"String",proto:!0,forced:R(function(){var e="".sub('"');return e!==e.toLowerCase()||3<e.split('"').length})},{sub:function(){return"<sub>"+String(jb(this))+"</sub>"}});var U=xa,Qb=null;try{Qb=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(e){}xa.prototype.__isLong__,Object.defineProperty(xa.prototype,"__isLong__",{value:!0}),xa.isLong=mb;var Sl={},Rl={};xa.fromInt=Bd,xa.fromNumber=Gb,xa.fromBits=ya;var sg=Math.pow;xa.fromString=ci,xa.fromValue=Wb;var ke=4294967296,Tl=ke*ke,Vl=Tl/2,wq=Bd(16777216),Hb=Bd(0);xa.ZERO=Hb;var Cd=Bd(0,!0);xa.UZERO=Cd;var Ue=Bd(1);xa.ONE=Ue;var xq=Bd(1,!0);xa.UONE=xq;var Kk=Bd(-1);xa.NEG_ONE=Kk;var Wl=ya(-1,2147483647,!1);xa.MAX_VALUE=Wl;var Ul=ya(-1,-1,!0);xa.MAX_UNSIGNED_VALUE=Ul;var nb=ya(0,-2147483648,!1);xa.MIN_VALUE=nb;var D=xa.prototype;D.toInt=function(){return this.unsigned?this.low>>>0:this.low},D.toNumber=function(){return this.unsigned?(this.high>>>0)*ke+(this.low>>>0):this.high*ke+(this.low>>>0)},D.toString=function(e){if(2>(e=e||10)||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(nb)){var r=Gb(e),s=this.div(r);return r=s.mul(r).sub(this),s.toString(e)+r.toInt().toString(e)}return"-"+this.neg().toString(e)}s=Gb(sg(e,6),this.unsigned),r=this;for(var d="";;){var f=r.div(s),_=(r.sub(f.mul(s)).toInt()>>>0).toString(e);if((r=f).isZero())return _+d;for(;6>_.length;)_="0"+_;d=""+_+d}},D.getHighBits=function(){return this.high},D.getHighBitsUnsigned=function(){return this.high>>>0},D.getLowBits=function(){return this.low},D.getLowBitsUnsigned=function(){return this.low>>>0},D.getNumBitsAbs=function(){if(this.isNegative())return this.eq(nb)?64:this.neg().getNumBitsAbs();for(var e=this.high!=0?this.high:this.low,r=31;0<r&&!(e&1<<r);r--);return this.high!=0?r+33:r+1},D.isZero=function(){return this.high===0&&this.low===0},D.eqz=D.isZero,D.isNegative=function(){return!this.unsigned&&0>this.high},D.isPositive=function(){return this.unsigned||0<=this.high},D.isOdd=function(){return(1&this.low)==1},D.isEven=function(){return(1&this.low)==0},D.equals=function(e){return mb(e)||(e=Wb(e)),(this.unsigned===e.unsigned||this.high>>>31!=1||e.high>>>31!=1)&&this.high===e.high&&this.low===e.low},D.eq=D.equals,D.notEquals=function(e){return!this.eq(e)},D.neq=D.notEquals,D.ne=D.notEquals,D.lessThan=function(e){return 0>this.comp(e)},D.lt=D.lessThan,D.lessThanOrEqual=function(e){return 0>=this.comp(e)},D.lte=D.lessThanOrEqual,D.le=D.lessThanOrEqual,D.greaterThan=function(e){return 0<this.comp(e)},D.gt=D.greaterThan,D.greaterThanOrEqual=function(e){return 0<=this.comp(e)},D.gte=D.greaterThanOrEqual,D.ge=D.greaterThanOrEqual,D.compare=function(e){if(mb(e)||(e=Wb(e)),this.eq(e))return 0;var r=this.isNegative(),s=e.isNegative();return r&&!s?-1:!r&&s?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1},D.comp=D.compare,D.negate=function(){return!this.unsigned&&this.eq(nb)?nb:this.not().add(Ue)},D.neg=D.negate,D.add=function(e){mb(e)||(e=Wb(e));var r=this.high>>>16,s=65535&this.high,d=this.low>>>16,f=e.high>>>16,_=65535&e.high,C=e.low>>>16;return d=(C=((e=(65535&this.low)+(65535&e.low))>>>16)+(d+C))>>>16,ya((65535&C)<<16|65535&e,(r=((d+=s+_)>>>16)+(r+f)&65535)<<16|65535&d,this.unsigned)},D.subtract=function(e){return mb(e)||(e=Wb(e)),this.add(e.neg())},D.sub=D.subtract,D.multiply=function(e){if(this.isZero())return Hb;if(mb(e)||(e=Wb(e)),Qb){var r=Qb.mul(this.low,this.high,e.low,e.high);return ya(r,Qb.get_high(),this.unsigned)}if(e.isZero())return Hb;if(this.eq(nb))return e.isOdd()?nb:Hb;if(e.eq(nb))return this.isOdd()?nb:Hb;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(wq)&&e.lt(wq))return Gb(this.toNumber()*e.toNumber(),this.unsigned);r=this.high>>>16;var s=65535&this.high,d=this.low>>>16,f=65535&this.low,_=e.high>>>16,C=65535&e.high,P=e.low>>>16,x=f*(e=65535&e.low),B=(x>>>16)+d*e,_t=B>>>16;_t+=(B=(65535&B)+f*P)>>>16;var ue=(_t+=s*e)>>>16;return ya((65535&B)<<16|65535&x,(ue=(ue+=(_t=(65535&_t)+d*P)>>>16)+((_t=(65535&_t)+f*C)>>>16)+(r*e+s*P+d*C+f*_)&65535)<<16|65535&_t,this.unsigned)},D.mul=D.multiply,D.divide=function(e){if(mb(e)||(e=Wb(e)),e.isZero())throw Error("division by zero");if(Qb)return this.unsigned||this.high!==-2147483648||e.low!==-1||e.high!==-1?ya(e=(this.unsigned?Qb.div_u:Qb.div_s)(this.low,this.high,e.low,e.high),Qb.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?Cd:Hb;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return Cd;if(e.gt(this.shru(1)))return xq;var r=Cd}else{if(this.eq(nb)){if(e.eq(Ue)||e.eq(Kk))return nb;if(e.eq(nb))return Ue;var s=this.shr(1).div(e).shl(1);if(s.eq(Hb))return e.isNegative()?Ue:Kk;var d=this.sub(e.mul(s));return s.add(d.div(e))}if(e.eq(nb))return this.unsigned?Cd:Hb;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();r=Hb}for(d=this;d.gte(e);){s=Math.max(1,Math.floor(d.toNumber()/e.toNumber()));var f=Math.ceil(Math.log(s)/Math.LN2);f=48>=f?1:sg(2,f-48);for(var _=Gb(s),C=_.mul(e);C.isNegative()||C.gt(d);)C=(_=Gb(s-=f,this.unsigned)).mul(e);_.isZero()&&(_=Ue),r=r.add(_),d=d.sub(C)}return r},D.div=D.divide,D.modulo=function(e){return mb(e)||(e=Wb(e)),Qb?ya(e=(this.unsigned?Qb.rem_u:Qb.rem_s)(this.low,this.high,e.low,e.high),Qb.get_high(),this.unsigned):this.sub(this.div(e).mul(e))},D.mod=D.modulo,D.rem=D.modulo,D.not=function(){return ya(~this.low,~this.high,this.unsigned)},D.and=function(e){return mb(e)||(e=Wb(e)),ya(this.low&e.low,this.high&e.high,this.unsigned)},D.or=function(e){return mb(e)||(e=Wb(e)),ya(this.low|e.low,this.high|e.high,this.unsigned)},D.xor=function(e){return mb(e)||(e=Wb(e)),ya(this.low^e.low,this.high^e.high,this.unsigned)},D.shiftLeft=function(e){return mb(e)&&(e=e.toInt()),(e&=63)==0?this:32>e?ya(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):ya(0,this.low<<e-32,this.unsigned)},D.shl=D.shiftLeft,D.shiftRight=function(e){return mb(e)&&(e=e.toInt()),(e&=63)==0?this:32>e?ya(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):ya(this.high>>e-32,0<=this.high?0:-1,this.unsigned)},D.shr=D.shiftRight,D.shiftRightUnsigned=function(e){if(mb(e)&&(e=e.toInt()),(e&=63)===0)return this;var r=this.high;return 32>e?ya(this.low>>>e|r<<32-e,r>>>e,this.unsigned):ya(e===32?r:r>>>e-32,0,this.unsigned)},D.shru=D.shiftRightUnsigned,D.shr_u=D.shiftRightUnsigned,D.toSigned=function(){return this.unsigned?ya(this.low,this.high,!1):this},D.toUnsigned=function(){return this.unsigned?this:ya(this.low,this.high,!0)},D.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},D.toBytesLE=function(){var e=this.high,r=this.low;return[255&r,r>>>8&255,r>>>16&255,r>>>24,255&e,e>>>8&255,e>>>16&255,e>>>24]},D.toBytesBE=function(){var e=this.high,r=this.low;return[e>>>24,e>>>16&255,e>>>8&255,255&e,r>>>24,r>>>16&255,r>>>8&255,255&r]},xa.fromBytes=function(e,r,s){return s?xa.fromBytesLE(e,r):xa.fromBytesBE(e,r)},xa.fromBytesLE=function(e,r){return new xa(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,r)},xa.fromBytesBE=function(e,r){return new xa(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],r)};var di=function(e,r){return(di=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(s,d){s.__proto__=d}||function(s,d){for(var f in d)d.hasOwnProperty(f)&&(s[f]=d[f])})(e,r)},Lk=!1,Ib={Promise:void 0,set useDeprecatedSynchronousErrorHandling(e){e?console.warn(`DEPRECATED! RxJS was set to use deprecated synchronous error handling behavior by code at: 
`+Error().stack):Lk&&console.log("RxJS: Back to a better error behavior. Thank you. <3"),Lk=e},get useDeprecatedSynchronousErrorHandling(){return Lk}},Eh={closed:!0,next:function(e){},error:function(e){if(Ib.useDeprecatedSynchronousErrorHandling)throw e;me(e)},complete:function(){}},Jb=Array.isArray||function(e){return e&&typeof e.length=="number"},lf=function(){function e(r){return Error.call(this),this.message=r?r.length+` errors occurred during unsubscription:
`+r.map(function(s,d){return d+1+") "+s.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=r,this}return e.prototype=Object.create(Error.prototype),e}(),Oa=function(){function e(r){this.closed=!1,this._subscriptions=this._parentOrParents=null,r&&(this._ctorUnsubscribe=!0,this._unsubscribe=r)}return e.prototype.unsubscribe=function(){if(!this.closed){var r=this._parentOrParents,s=this._ctorUnsubscribe,d=this._unsubscribe,f=this._subscriptions;if(this.closed=!0,this._subscriptions=this._parentOrParents=null,r instanceof e)r.remove(this);else if(r!==null)for(var _=0;_<r.length;++_)r[_].remove(this);if(le(d)){s&&(this._unsubscribe=void 0);try{d.call(this)}catch(P){var C=P instanceof lf?Xl(P.errors):[P]}}if(Jb(f)){for(_=-1,r=f.length;++_<r;)if(ei(s=f[_]))try{s.unsubscribe()}catch(P){C=C||[],P instanceof lf?C=C.concat(Xl(P.errors)):C.push(P)}}if(C)throw new lf(C)}},e.prototype.add=function(r){var s=r;if(!r)return e.EMPTY;switch(X(r)){case"function":s=new e(r);case"object":if(s===this||s.closed||typeof s.unsubscribe!="function")return s;if(this.closed)return s.unsubscribe(),s;s instanceof e||(r=s,(s=new e)._subscriptions=[r]);break;default:throw Error("unrecognized teardown "+r+" added to Subscription.")}if((r=s._parentOrParents)===null)s._parentOrParents=this;else if(r instanceof e){if(r===this)return s;s._parentOrParents=[r,this]}else{if(r.indexOf(this)!==-1)return s;r.push(this)}return(r=this._subscriptions)===null?this._subscriptions=[s]:r.push(s),s},e.prototype.remove=function(r){var s=this._subscriptions;s&&(r=s.indexOf(r))!==-1&&s.splice(r,1)},e.EMPTY=function(r){return r.closed=!0,r}(new e),e}(),Fh=typeof Symbol=="function"?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random(),ia=function(e){function r(s,d,f){var _=e.call(this)||this;switch(_.syncErrorValue=null,_.syncErrorThrown=!1,_.syncErrorThrowable=!1,_.isStopped=!1,arguments.length){case 0:_.destination=Eh;break;case 1:if(!s){_.destination=Eh;break}if(X(s)==="object"){s instanceof r?(_.syncErrorThrowable=s.syncErrorThrowable,_.destination=s,s.add(_)):(_.syncErrorThrowable=!0,_.destination=new yq(_,s));break}default:_.syncErrorThrowable=!0,_.destination=new yq(_,s,d,f)}return _}return O(r,e),r.prototype[Fh]=function(){return this},r.create=function(s,d,f){return(s=new r(s,d,f)).syncErrorThrowable=!1,s},r.prototype.next=function(s){this.isStopped||this._next(s)},r.prototype.error=function(s){this.isStopped||(this.isStopped=!0,this._error(s))},r.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},r.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,e.prototype.unsubscribe.call(this))},r.prototype._next=function(s){this.destination.next(s)},r.prototype._error=function(s){this.destination.error(s),this.unsubscribe()},r.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},r.prototype._unsubscribeAndRecycle=function(){var s=this._parentOrParents;return this._parentOrParents=null,this.unsubscribe(),this.isStopped=this.closed=!1,this._parentOrParents=s,this},r}(Oa),yq=function(e){function r(s,d,f,_){var C=e.call(this)||this;if(C._parentSubscriber=s,s=C,le(d))var P=d;else d&&(P=d.next,f=d.error,_=d.complete,d!==Eh&&(le((s=Object.create(d)).unsubscribe)&&C.add(s.unsubscribe.bind(s)),s.unsubscribe=C.unsubscribe.bind(C)));return C._context=s,C._next=P,C._error=f,C._complete=_,C}return O(r,e),r.prototype.next=function(s){if(!this.isStopped&&this._next){var d=this._parentSubscriber;Ib.useDeprecatedSynchronousErrorHandling&&d.syncErrorThrowable?this.__tryOrSetError(d,this._next,s)&&this.unsubscribe():this.__tryOrUnsub(this._next,s)}},r.prototype.error=function(s){if(!this.isStopped){var d=this._parentSubscriber,f=Ib.useDeprecatedSynchronousErrorHandling;if(this._error)f&&d.syncErrorThrowable?this.__tryOrSetError(d,this._error,s):this.__tryOrUnsub(this._error,s),this.unsubscribe();else if(d.syncErrorThrowable)f?(d.syncErrorValue=s,d.syncErrorThrown=!0):me(s),this.unsubscribe();else{if(this.unsubscribe(),f)throw s;me(s)}}},r.prototype.complete=function(){var s=this;if(!this.isStopped){var d=this._parentSubscriber;if(this._complete){var f=function(){return s._complete.call(s._context)};Ib.useDeprecatedSynchronousErrorHandling&&d.syncErrorThrowable?this.__tryOrSetError(d,f):this.__tryOrUnsub(f)}this.unsubscribe()}},r.prototype.__tryOrUnsub=function(s,d){try{s.call(this._context,d)}catch(f){if(this.unsubscribe(),Ib.useDeprecatedSynchronousErrorHandling)throw f;me(f)}},r.prototype.__tryOrSetError=function(s,d,f){if(!Ib.useDeprecatedSynchronousErrorHandling)throw Error("bad call");try{d.call(this._context,f)}catch(_){return Ib.useDeprecatedSynchronousErrorHandling?(s.syncErrorValue=_,s.syncErrorThrown=!0):me(_),!0}return!1},r.prototype._unsubscribe=function(){var s=this._parentSubscriber;this._parentSubscriber=this._context=null,s.unsubscribe()},r}(ia),ne=typeof Symbol=="function"&&Symbol.observable||"@@observable",Y=function(){function e(r){this._isScalar=!1,r&&(this._subscribe=r)}return e.prototype.lift=function(r){var s=new e;return s.source=this,s.operator=r,s},e.prototype.subscribe=function(r,s,d){var f=this.operator;t:{if(r){if(r instanceof ia)break t;if(r[Fh]){r=r[Fh]();break t}}r=r||s||d?new ia(r,s,d):new ia(Eh)}if(f?r.add(f.call(r,this.source)):r.add(this.source||Ib.useDeprecatedSynchronousErrorHandling&&!r.syncErrorThrowable?this._subscribe(r):this._trySubscribe(r)),Ib.useDeprecatedSynchronousErrorHandling&&r.syncErrorThrowable&&(r.syncErrorThrowable=!1,r.syncErrorThrown))throw r.syncErrorValue;return r},e.prototype._trySubscribe=function(r){try{return this._subscribe(r)}catch(s){Ib.useDeprecatedSynchronousErrorHandling&&(r.syncErrorThrown=!0,r.syncErrorValue=s),fi(r)?r.error(s):console.warn(s)}},e.prototype.forEach=function(r,s){var d=this;return new(s=Zl(s))(function(f,_){var C=d.subscribe(function(P){try{r(P)}catch(x){_(x),C&&C.unsubscribe()}},_,f)})},e.prototype._subscribe=function(r){var s=this.source;return s&&s.subscribe(r)},e.prototype[ne]=function(){return this},e.prototype.pipe=function(){for(var r=[],s=0;s<arguments.length;s++)r[s]=arguments[s];return r.length===0?this:Yl(r)(this)},e.prototype.toPromise=function(r){var s=this;return new(r=Zl(r))(function(d,f){var _;s.subscribe(function(C){return _=C},function(C){return f(C)},function(){return d(_)})})},e.create=function(r){return new e(r)},e}(),qd=function(){function e(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}return e.prototype=Object.create(Error.prototype),e}(),zq=function(e){function r(s,d){var f=e.call(this)||this;return f.subject=s,f.subscriber=d,f.closed=!1,f}return O(r,e),r.prototype.unsubscribe=function(){if(!this.closed){this.closed=!0;var s=this.subject,d=s.observers;this.subject=null,!d||d.length===0||s.isStopped||s.closed||(s=d.indexOf(this.subscriber))!==-1&&d.splice(s,1)}},r}(Oa),Aq=function(e){function r(s){var d=e.call(this,s)||this;return d.destination=s,d}return O(r,e),r}(ia),Pa=function(e){function r(){var s=e.call(this)||this;return s.observers=[],s.closed=!1,s.isStopped=!1,s.hasError=!1,s.thrownError=null,s}return O(r,e),r.prototype[Fh]=function(){return new Aq(this)},r.prototype.lift=function(s){var d=new Bq(this,this);return d.operator=s,d},r.prototype.next=function(s){if(this.closed)throw new qd;if(!this.isStopped){var d=this.observers,f=d.length;d=d.slice();for(var _=0;_<f;_++)d[_].next(s)}},r.prototype.error=function(s){if(this.closed)throw new qd;this.hasError=!0,this.thrownError=s,this.isStopped=!0;var d=this.observers,f=d.length;d=d.slice();for(var _=0;_<f;_++)d[_].error(s);this.observers.length=0},r.prototype.complete=function(){if(this.closed)throw new qd;this.isStopped=!0;var s=this.observers,d=s.length;s=s.slice();for(var f=0;f<d;f++)s[f].complete();this.observers.length=0},r.prototype.unsubscribe=function(){this.closed=this.isStopped=!0,this.observers=null},r.prototype._trySubscribe=function(s){if(this.closed)throw new qd;return e.prototype._trySubscribe.call(this,s)},r.prototype._subscribe=function(s){if(this.closed)throw new qd;return this.hasError?(s.error(this.thrownError),Oa.EMPTY):this.isStopped?(s.complete(),Oa.EMPTY):(this.observers.push(s),new zq(this,s))},r.prototype.asObservable=function(){var s=new Y;return s.source=this,s},r.create=function(s,d){return new Bq(s,d)},r}(Y),Bq=function(e){function r(s,d){var f=e.call(this)||this;return f.destination=s,f.source=d,f}return O(r,e),r.prototype.next=function(s){var d=this.destination;d&&d.next&&d.next(s)},r.prototype.error=function(s){var d=this.destination;d&&d.error&&this.destination.error(s)},r.prototype.complete=function(){var s=this.destination;s&&s.complete&&this.destination.complete()},r.prototype._subscribe=function(s){return this.source?this.source.subscribe(s):Oa.EMPTY},r}(Pa),Ns=function(){function e(r){this.connectable=r}return e.prototype.call=function(r,s){var d=this.connectable;return d._refCount++,r=new cz(r,d),s=s.subscribe(r),r.closed||(r.connection=d.connect()),s},e}(),cz=function(e){function r(s,d){return(s=e.call(this,s)||this).connectable=d,s}return O(r,e),r.prototype._unsubscribe=function(){var s=this.connectable;if(s){this.connectable=null;var d=s._refCount;0>=d?this.connection=null:(s._refCount=d-1,1<d?this.connection=null:(d=this.connection,s=s._connection,this.connection=null,!s||d&&s!==d||s.unsubscribe()))}else this.connection=null},r}(ia),Cq=function(e){function r(s,d){var f=e.call(this)||this;return f.source=s,f.subjectFactory=d,f._refCount=0,f._isComplete=!1,f}return O(r,e),r.prototype._subscribe=function(s){return this.getSubject().subscribe(s)},r.prototype.getSubject=function(){var s=this._subject;return s&&!s.isStopped||(this._subject=this.subjectFactory()),this._subject},r.prototype.connect=function(){var s=this._connection;return s||(this._isComplete=!1,(s=this._connection=new Oa).add(this.source.subscribe(new dz(this.getSubject(),this))),s.closed&&(this._connection=null,s=Oa.EMPTY)),s},r.prototype.refCount=function(){return $l()(this)},r}(Y),At=function(){var e=Cq.prototype;return{operator:{value:null},_refCount:{value:0,writable:!0},_subject:{value:null,writable:!0},_connection:{value:null,writable:!0},_subscribe:{value:e._subscribe},_isComplete:{value:e._isComplete,writable:!0},getSubject:{value:e.getSubject},connect:{value:e.connect},refCount:{value:e.refCount}}}(),dz=function(e){function r(s,d){return(s=e.call(this,s)||this).connectable=d,s}return O(r,e),r.prototype._error=function(s){this._unsubscribe(),e.prototype._error.call(this,s)},r.prototype._complete=function(){this.connectable._isComplete=!0,this._unsubscribe(),e.prototype._complete.call(this)},r.prototype._unsubscribe=function(){var s=this.connectable;if(s){this.connectable=null;var d=s._connection;s._refCount=0,s._subject=null,s._connection=null,d&&d.unsubscribe()}},r}(Aq);(function(e){function r(s,d){return(s=e.call(this,s)||this).connectable=d,s}O(r,e),r.prototype._unsubscribe=function(){var s=this.connectable;if(s){this.connectable=null;var d=s._refCount;0>=d?this.connection=null:(s._refCount=d-1,1<d?this.connection=null:(d=this.connection,s=s._connection,this.connection=null,!s||d&&s!==d||s.unsubscribe()))}else this.connection=null}})(ia),function(e){function r(s,d,f,_,C){return(s=e.call(this,s)||this).keySelector=d,s.elementSelector=f,s.durationSelector=_,s.subjectSelector=C,s.groups=null,s.attemptedToUnsubscribe=!1,s.count=0,s}O(r,e),r.prototype._next=function(s){try{var d=this.keySelector(s)}catch(f){return void this.error(f)}this._group(s,d)},r.prototype._group=function(s,d){var f=this.groups;f||(f=this.groups=new Map);var _=f.get(d);if(this.elementSelector)try{var C=this.elementSelector(s)}catch(P){this.error(P)}else C=s;if(!_&&(_=this.subjectSelector?this.subjectSelector():new Pa,f.set(d,_),s=new Mk(d,_,this),this.destination.next(s),this.durationSelector)){s=void 0;try{s=this.durationSelector(new Mk(d,_))}catch(P){return void this.error(P)}this.add(s.subscribe(new ez(d,_,this)))}_.closed||_.next(C)},r.prototype._error=function(s){var d=this.groups;d&&(d.forEach(function(f,_){f.error(s)}),d.clear()),this.destination.error(s)},r.prototype._complete=function(){var s=this.groups;s&&(s.forEach(function(d,f){d.complete()}),s.clear()),this.destination.complete()},r.prototype.removeGroup=function(s){this.groups.delete(s)},r.prototype.unsubscribe=function(){this.closed||(this.attemptedToUnsubscribe=!0,this.count===0&&e.prototype.unsubscribe.call(this))}}(ia);var ez=function(e){function r(s,d,f){var _=e.call(this,d)||this;return _.key=s,_.group=d,_.parent=f,_}return O(r,e),r.prototype._next=function(s){this.complete()},r.prototype._unsubscribe=function(){var s=this.parent,d=this.key;this.key=this.parent=null,s&&s.removeGroup(d)},r}(ia),Mk=function(e){function r(s,d,f){var _=e.call(this)||this;return _.key=s,_.groupSubject=d,_.refCountSubscription=f,_}return O(r,e),r.prototype._subscribe=function(s){var d=new Oa,f=this.refCountSubscription,_=this.groupSubject;return f&&!f.closed&&d.add(new fz(f)),d.add(_.subscribe(s)),d},r}(Y),fz=function(e){function r(s){var d=e.call(this)||this;return d.parent=s,s.count++,d}return O(r,e),r.prototype.unsubscribe=function(){var s=this.parent;s.closed||this.closed||(e.prototype.unsubscribe.call(this),--s.count,s.count===0&&s.attemptedToUnsubscribe&&s.unsubscribe())},r}(Oa),gz=function(e){function r(s){var d=e.call(this)||this;return d._value=s,d}return O(r,e),Object.defineProperty(r.prototype,"value",{get:function(){return this.getValue()},enumerable:!0,configurable:!0}),r.prototype._subscribe=function(s){var d=e.prototype._subscribe.call(this,s);return d&&!d.closed&&s.next(this._value),d},r.prototype.getValue=function(){if(this.hasError)throw this.thrownError;if(this.closed)throw new qd;return this._value},r.prototype.next=function(s){e.prototype.next.call(this,this._value=s)},r}(Pa),dg=function(e){function r(s,d){var f=e.call(this,s,d)||this;return f.scheduler=s,f.work=d,f.pending=!1,f}return O(r,e),r.prototype.schedule=function(s,d){if(d===void 0&&(d=0),this.closed)return this;this.state=s,s=this.id;var f=this.scheduler;return s!=null&&(this.id=this.recycleAsyncId(f,s,d)),this.pending=!0,this.delay=d,this.id=this.id||this.requestAsyncId(f,this.id,d),this},r.prototype.requestAsyncId=function(s,d,f){return f===void 0&&(f=0),setInterval(s.flush.bind(s,this),f)},r.prototype.recycleAsyncId=function(s,d,f){if(f===void 0&&(f=0),f!==null&&this.delay===f&&this.pending===!1)return d;clearInterval(d)},r.prototype.execute=function(s,d){return this.closed?Error("executing a cancelled action"):(this.pending=!1,(s=this._execute(s,d))?s:void(this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))))},r.prototype._execute=function(s,d){d=!1;var f=void 0;try{this.work(s)}catch(_){d=!0,f=!!_&&_||Error(_)}if(d)return this.unsubscribe(),f},r.prototype._unsubscribe=function(){var s=this.id,d=this.scheduler,f=d.actions,_=f.indexOf(this);this.state=this.work=null,this.pending=!1,this.scheduler=null,_!==-1&&f.splice(_,1),s!=null&&(this.id=this.recycleAsyncId(d,s,null)),this.delay=null},r}(function(e){function r(s,d){return e.call(this)||this}return O(r,e),r.prototype.schedule=function(s,d){return this},r}(Oa)),hz=function(e){function r(s,d){var f=e.call(this,s,d)||this;return f.scheduler=s,f.work=d,f}return O(r,e),r.prototype.schedule=function(s,d){return d===void 0&&(d=0),0<d?e.prototype.schedule.call(this,s,d):(this.delay=d,this.state=s,this.scheduler.flush(this),this)},r.prototype.execute=function(s,d){return 0<d||this.closed?e.prototype.execute.call(this,s,d):this._execute(s,d)},r.prototype.requestAsyncId=function(s,d,f){return f===void 0&&(f=0),f!==null&&0<f||f===null&&0<this.delay?e.prototype.requestAsyncId.call(this,s,d,f):s.flush(this)},r}(dg),Nk=function(){function e(r,s){s===void 0&&(s=e.now),this.SchedulerAction=r,this.now=s}return e.prototype.schedule=function(r,s,d){return s===void 0&&(s=0),new this.SchedulerAction(this,r).schedule(d,s)},e.now=function(){return Date.now()},e}(),eg=function(e){function r(s,d){d===void 0&&(d=Nk.now);var f=e.call(this,s,function(){return r.delegate&&r.delegate!==f?r.delegate.now():d()})||this;return f.actions=[],f.active=!1,f.scheduled=void 0,f}return O(r,e),r.prototype.schedule=function(s,d,f){return d===void 0&&(d=0),r.delegate&&r.delegate!==this?r.delegate.schedule(s,d,f):e.prototype.schedule.call(this,s,d,f)},r.prototype.flush=function(s){var d=this.actions;if(this.active)d.push(s);else{var f;this.active=!0;do if(f=s.execute(s.state,s.delay))break;while(s=d.shift());if(this.active=!1,f){for(;s=d.shift();)s.unsubscribe();throw f}}},r}(Nk),fg=new(function(e){function r(){return e!==null&&e.apply(this,arguments)||this}return O(r,e),r}(eg))(hz),vb=new Y(function(e){return e.complete()}),am=function(e){return function(r){for(var s=0,d=e.length;s<d&&!r.closed;s++)r.next(e[s]);r.complete()}},Ok;(function(e){e.NEXT="N",e.ERROR="E",e.COMPLETE="C"})(Ok||(Ok={}));var Ve=function(){function e(r,s,d){this.kind=r,this.value=s,this.error=d,this.hasValue=r==="N"}return e.prototype.observe=function(r){switch(this.kind){case"N":return r.next&&r.next(this.value);case"E":return r.error&&r.error(this.error);case"C":return r.complete&&r.complete()}},e.prototype.do=function(r,s,d){switch(this.kind){case"N":return r&&r(this.value);case"E":return s&&s(this.error);case"C":return d&&d()}},e.prototype.accept=function(r,s,d){return r&&typeof r.next=="function"?this.observe(r):this.do(r,s,d)},e.prototype.toObservable=function(){switch(this.kind){case"N":return bb(this.value);case"E":return Z(this.error);case"C":return mf()}throw Error("unexpected notification kind value")},e.createNext=function(r){return r!==void 0?new e("N",r):e.undefinedValueNotification},e.createError=function(r){return new e("E",void 0,r)},e.createComplete=function(){return e.completeNotification},e.completeNotification=new e("C"),e.undefinedValueNotification=new e("N",void 0),e}(),Rs=function(){function e(r,s){s===void 0&&(s=0),this.scheduler=r,this.delay=s}return e.prototype.call=function(r,s){return s.subscribe(new Dq(r,this.scheduler,this.delay))},e}(),Dq=function(e){function r(s,d,f){return f===void 0&&(f=0),(s=e.call(this,s)||this).scheduler=d,s.delay=f,s}return O(r,e),r.dispatch=function(s){s.notification.observe(s.destination),this.unsubscribe()},r.prototype.scheduleMessage=function(s){this.destination.add(this.scheduler.schedule(r.dispatch,this.delay,new iz(s,this.destination)))},r.prototype._next=function(s){this.scheduleMessage(Ve.createNext(s))},r.prototype._error=function(s){this.scheduleMessage(Ve.createError(s)),this.unsubscribe()},r.prototype._complete=function(){this.scheduleMessage(Ve.createComplete()),this.unsubscribe()},r}(ia),iz=function(e,r){this.notification=e,this.destination=r},qe=function(e){function r(s,d,f){s===void 0&&(s=Number.POSITIVE_INFINITY),d===void 0&&(d=Number.POSITIVE_INFINITY);var _=e.call(this)||this;return _.scheduler=f,_._events=[],_._infiniteTimeWindow=!1,_._bufferSize=1>s?1:s,_._windowTime=1>d?1:d,d===Number.POSITIVE_INFINITY?(_._infiniteTimeWindow=!0,_.next=_.nextInfiniteTimeWindow):_.next=_.nextTimeWindow,_}return O(r,e),r.prototype.nextInfiniteTimeWindow=function(s){if(!this.isStopped){var d=this._events;d.push(s),d.length>this._bufferSize&&d.shift()}e.prototype.next.call(this,s)},r.prototype.nextTimeWindow=function(s){this.isStopped||(this._events.push(new jz(this._getNow(),s)),this._trimBufferThenGetEvents()),e.prototype.next.call(this,s)},r.prototype._subscribe=function(s){var d=this._infiniteTimeWindow,f=d?this._events:this._trimBufferThenGetEvents(),_=this.scheduler,C=f.length;if(this.closed)throw new qd;if(this.isStopped||this.hasError)var P=Oa.EMPTY;else this.observers.push(s),P=new zq(this,s);if(_&&s.add(s=new Dq(s,_)),d)for(d=0;d<C&&!s.closed;d++)s.next(f[d]);else for(d=0;d<C&&!s.closed;d++)s.next(f[d].value);return this.hasError?s.error(this.thrownError):this.isStopped&&s.complete(),P},r.prototype._getNow=function(){return(this.scheduler||fg).now()},r.prototype._trimBufferThenGetEvents=function(){for(var s=this._getNow(),d=this._bufferSize,f=this._windowTime,_=this._events,C=_.length,P=0;P<C&&!(s-_[P].time<f);)P++;return C>d&&(P=Math.max(P,C-d)),0<P&&_.splice(0,P),_},r}(Pa),jz=function(e,r){this.time=e,this.value=r},of=function(e){function r(){var s=e!==null&&e.apply(this,arguments)||this;return s.value=null,s.hasNext=!1,s.hasCompleted=!1,s}return O(r,e),r.prototype._subscribe=function(s){return this.hasError?(s.error(this.thrownError),Oa.EMPTY):this.hasCompleted&&this.hasNext?(s.next(this.value),s.complete(),Oa.EMPTY):e.prototype._subscribe.call(this,s)},r.prototype.next=function(s){this.hasCompleted||(this.value=s,this.hasNext=!0)},r.prototype.error=function(s){this.hasCompleted||e.prototype.error.call(this,s)},r.prototype.complete=function(){this.hasCompleted=!0,this.hasNext&&e.prototype.next.call(this,this.value),e.prototype.complete.call(this)},r}(Pa),kz=1,lz=Promise.resolve(),ii={},Eq={setImmediate:function(e){var r=kz++;return ii[r]=!0,lz.then(function(){return bm(r)&&e()}),r},clearImmediate:function(e){bm(e)}},mz=function(e){function r(s,d){var f=e.call(this,s,d)||this;return f.scheduler=s,f.work=d,f}return O(r,e),r.prototype.requestAsyncId=function(s,d,f){return f===void 0&&(f=0),f!==null&&0<f?e.prototype.requestAsyncId.call(this,s,d,f):(s.actions.push(this),s.scheduled||(s.scheduled=Eq.setImmediate(s.flush.bind(s,null))))},r.prototype.recycleAsyncId=function(s,d,f){if(f===void 0&&(f=0),f!==null&&0<f||f===null&&0<this.delay)return e.prototype.recycleAsyncId.call(this,s,d,f);s.actions.length===0&&(Eq.clearImmediate(d),s.scheduled=void 0)},r}(dg),ri=new(function(e){function r(){return e!==null&&e.apply(this,arguments)||this}return O(r,e),r.prototype.flush=function(s){this.active=!0,this.scheduled=void 0;var d,f=this.actions,_=-1,C=f.length;s=s||f.shift();do if(d=s.execute(s.state,s.delay))break;while(++_<C&&(s=f.shift()));if(this.active=!1,d){for(;++_<C&&(s=f.shift());)s.unsubscribe();throw d}},r}(eg))(mz),nz=ri,Pk=new eg(dg),bd=Pk,oz=function(e){function r(s,d){var f=e.call(this,s,d)||this;return f.scheduler=s,f.work=d,f}return O(r,e),r.prototype.requestAsyncId=function(s,d,f){return f===void 0&&(f=0),f!==null&&0<f?e.prototype.requestAsyncId.call(this,s,d,f):(s.actions.push(this),s.scheduled||(s.scheduled=requestAnimationFrame(function(){return s.flush(null)})))},r.prototype.recycleAsyncId=function(s,d,f){if(f===void 0&&(f=0),f!==null&&0<f||f===null&&0<this.delay)return e.prototype.recycleAsyncId.call(this,s,d,f);s.actions.length===0&&(cancelAnimationFrame(d),s.scheduled=void 0)},r}(dg),Fq=new(function(e){function r(){return e!==null&&e.apply(this,arguments)||this}return O(r,e),r.prototype.flush=function(s){this.active=!0,this.scheduled=void 0;var d,f=this.actions,_=-1,C=f.length;s=s||f.shift();do if(d=s.execute(s.state,s.delay))break;while(++_<C&&(s=f.shift()));if(this.active=!1,d){for(;++_<C&&(s=f.shift());)s.unsubscribe();throw d}},r}(eg))(oz),pz=function(e){function r(s,d){s===void 0&&(s=Gq),d===void 0&&(d=Number.POSITIVE_INFINITY);var f=e.call(this,s,function(){return f.frame})||this;return f.maxFrames=d,f.frame=0,f.index=-1,f}return O(r,e),r.prototype.flush=function(){for(var s,d,f=this.actions,_=this.maxFrames;(d=f[0])&&d.delay<=_&&(f.shift(),this.frame=d.delay,!(s=d.execute(d.state,d.delay))););if(s){for(;d=f.shift();)d.unsubscribe();throw s}},r.frameTimeFactor=10,r}(eg),Gq=function(e){function r(s,d,f){f===void 0&&(f=s.index+=1);var _=e.call(this,s,d)||this;return _.scheduler=s,_.work=d,_.index=f,_.active=!0,_.index=s.index=f,_}return O(r,e),r.prototype.schedule=function(s,d){if(d===void 0&&(d=0),!this.id)return e.prototype.schedule.call(this,s,d);this.active=!1;var f=new r(this.scheduler,this.work);return this.add(f),f.schedule(s,d)},r.prototype.requestAsyncId=function(s,d,f){return f===void 0&&(f=0),this.delay=s.frame+f,(s=s.actions).push(this),s.sort(r.sortActions),!0},r.prototype.recycleAsyncId=function(s,d,f){},r.prototype._execute=function(s,d){if(this.active===!0)return e.prototype._execute.call(this,s,d)},r.sortActions=function(s,d){return s.delay===d.delay?s.index===d.index?0:s.index>d.index?1:-1:s.delay>d.delay?1:-1},r}(dg),Qk=function(){function e(){return Error.call(this),this.message="argument out of range",this.name="ArgumentOutOfRangeError",this}return e.prototype=Object.create(Error.prototype),e}(),vg=function(){function e(){return Error.call(this),this.message="no elements in sequence",this.name="EmptyError",this}return e.prototype=Object.create(Error.prototype),e}(),pb=function(){function e(){return Error.call(this),this.message="Timeout has occurred",this.name="TimeoutError",this}return e.prototype=Object.create(Error.prototype),e}(),Ss=function(){function e(r,s){this.project=r,this.thisArg=s}return e.prototype.call=function(r,s){return s.subscribe(new qz(r,this.project,this.thisArg))},e}(),qz=function(e){function r(s,d,f){return(s=e.call(this,s)||this).project=d,s.count=0,s.thisArg=f||s,s}return O(r,e),r.prototype._next=function(s){try{var d=this.project.call(this.thisArg,s,this.count++)}catch(f){return void this.destination.error(f)}this.destination.next(d)},r}(ia),Rk=function(e){function r(){return e!==null&&e.apply(this,arguments)||this}return O(r,e),r.prototype.notifyNext=function(s,d,f,_,C){this.destination.next(d)},r.prototype.notifyError=function(s,d){this.destination.error(s)},r.prototype.notifyComplete=function(s){this.destination.complete()},r}(ia),Xs=function(e){function r(s,d,f){var _=e.call(this)||this;return _.parent=s,_.outerValue=d,_.outerIndex=f,_.index=0,_}return O(r,e),r.prototype._next=function(s){this.parent.notifyNext(this.outerValue,s,this.outerIndex,this.index++,this)},r.prototype._error=function(s){this.parent.notifyError(s,this),this.unsubscribe()},r.prototype._complete=function(){this.parent.notifyComplete(this),this.unsubscribe()},r}(ia),rz=function(e){return function(r){return e.then(function(s){r.closed||(r.next(s),r.complete())},function(s){return r.error(s)}).then(null,me),r}},$c=typeof Symbol=="function"&&Symbol.iterator?Symbol.iterator:"@@iterator",sz=function(e){return function(r){for(var s=e[$c]();;){var d=void 0;try{d=s.next()}catch(f){return r.error(f),r}if(d.done){r.complete();break}if(r.next(d.value),r.closed)break}return typeof s.return=="function"&&r.add(function(){s.return&&s.return()}),r}},tz=function(e){return function(r){var s=e[ne]();if(typeof s.subscribe!="function")throw new TypeError("Provided object does not correctly implement Symbol.observable");return s.subscribe(r)}},hm=function(e){return e&&typeof e.length=="number"&&typeof e!="function"},pf=function(e){if(e&&typeof e[ne]=="function")return tz(e);if(hm(e))return am(e);if(fm(e))return rz(e);if(e&&typeof e[$c]=="function")return sz(e);throw e=ei(e)?"an invalid object":"'"+e+"'",new TypeError("You provided "+e+" where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.")},Hq={},vz=function(){function e(r){this.resultSelector=r}return e.prototype.call=function(r,s){return s.subscribe(new uz(r,this.resultSelector))},e}(),uz=function(e){function r(s,d){return(s=e.call(this,s)||this).resultSelector=d,s.active=0,s.values=[],s.observables=[],s}return O(r,e),r.prototype._next=function(s){this.values.push(Hq),this.observables.push(s)},r.prototype._complete=function(){var s=this.observables,d=s.length;if(d===0)this.destination.complete();else{this.toRespond=this.active=d;for(var f=0;f<d;f++)this.add(ji(this,s[f],void 0,f))}},r.prototype.notifyComplete=function(s){--this.active==0&&this.destination.complete()},r.prototype.notifyNext=function(s,d,f){var _=(s=this.values)[f];_=this.toRespond?_===Hq?--this.toRespond:this.toRespond:0,s[f]=d,_===0&&(this.resultSelector?this._tryResultSelector(s):this.destination.next(s.slice()))},r.prototype._tryResultSelector=function(s){try{var d=this.resultSelector.apply(this,s)}catch(f){return void this.destination.error(f)}this.destination.next(d)},r}(Rk),vc=function(e){function r(s){var d=e.call(this)||this;return d.parent=s,d}return O(r,e),r.prototype._next=function(s){this.parent.notifyNext(s)},r.prototype._error=function(s){this.parent.notifyError(s),this.unsubscribe()},r.prototype._complete=function(){this.parent.notifyComplete(),this.unsubscribe()},r}(ia);(function(e){function r(s,d,f){var _=e.call(this)||this;return _.parent=s,_.outerValue=d,_.outerIndex=f,_}O(r,e),r.prototype._next=function(s){this.parent.notifyNext(this.outerValue,s,this.outerIndex,this)},r.prototype._error=function(s){this.parent.notifyError(s),this.unsubscribe()},r.prototype._complete=function(){this.parent.notifyComplete(this),this.unsubscribe()}})(ia);var wc=function(e){function r(){return e!==null&&e.apply(this,arguments)||this}return O(r,e),r.prototype.notifyNext=function(s){this.destination.next(s)},r.prototype.notifyError=function(s){this.destination.error(s)},r.prototype.notifyComplete=function(){this.destination.complete()},r}(ia);(function(e){function r(){return e!==null&&e.apply(this,arguments)||this}O(r,e),r.prototype.notifyNext=function(s,d,f,_){this.destination.next(d)},r.prototype.notifyError=function(s){this.destination.error(s)},r.prototype.notifyComplete=function(s){this.destination.complete()}})(ia);var at=function(){function e(r,s){s===void 0&&(s=Number.POSITIVE_INFINITY),this.project=r,this.concurrent=s}return e.prototype.call=function(r,s){return s.subscribe(new wz(r,this.project,this.concurrent))},e}(),wz=function(e){function r(s,d,f){return f===void 0&&(f=Number.POSITIVE_INFINITY),(s=e.call(this,s)||this).project=d,s.concurrent=f,s.hasCompleted=!1,s.buffer=[],s.active=0,s.index=0,s}return O(r,e),r.prototype._next=function(s){this.active<this.concurrent?this._tryNext(s):this.buffer.push(s)},r.prototype._tryNext=function(s){var d=this.index++;try{var f=this.project(s,d)}catch(_){return void this.destination.error(_)}this.active++,this._innerSub(f)},r.prototype._innerSub=function(s){var d=new vc(this),f=this.destination;f.add(d),(s=ic(s,d))!==d&&f.add(s)},r.prototype._complete=function(){this.hasCompleted=!0,this.active===0&&this.buffer.length===0&&this.destination.complete(),this.unsubscribe()},r.prototype.notifyNext=function(s){this.destination.next(s)},r.prototype.notifyComplete=function(){var s=this.buffer;this.active--,0<s.length?this._next(s.shift()):this.active===0&&this.hasCompleted&&this.destination.complete()},r}(wc),Sk=y.parseFloat,Iq=-1/0!=1/Sk(`	
\v\f\r Â áš€â€€â€â€‚â€ƒâ€„â€…â€†â€‡â€ˆâ€‰â€Šâ€¯âŸã€€\u2028\u2029\uFEFF-0`)?function(e){e=ik(String(e));var r=Sk(e);return r===0&&e.charAt(0)=="-"?-0:r}:Sk;N({global:!0,forced:parseFloat!=Iq},{parseFloat:Iq});var Tk=new Y(hc),ft=function(){function e(r,s){this.predicate=r,this.thisArg=s}return e.prototype.call=function(r,s){return s.subscribe(new xz(r,this.predicate,this.thisArg))},e}(),xz=function(e){function r(s,d,f){return(s=e.call(this,s)||this).predicate=d,s.thisArg=f,s.count=0,s}return O(r,e),r.prototype._next=function(s){try{var d=this.predicate.call(this.thisArg,s,this.count++)}catch(f){return void this.destination.error(f)}d&&this.destination.next(s)},r}(ia),gt=function(){function e(){}return e.prototype.call=function(r,s){return s.subscribe(new yz(r))},e}(),yz=function(e){function r(s){return(s=e.call(this,s)||this).hasFirst=!1,s.observables=[],s.subscriptions=[],s}return O(r,e),r.prototype._next=function(s){this.observables.push(s)},r.prototype._complete=function(){var s=this.observables,d=s.length;if(d===0)this.destination.complete();else{for(var f=0;f<d&&!this.hasFirst;f++){var _=ji(this,s[f],void 0,f);this.subscriptions&&this.subscriptions.push(_),this.add(_)}this.observables=null}},r.prototype.notifyNext=function(s,d,f){if(!this.hasFirst){for(this.hasFirst=!0,s=0;s<this.subscriptions.length;s++)if(s!==f){var _=this.subscriptions[s];_.unsubscribe(),this.remove(_)}this.subscriptions=null}this.destination.next(d)},r}(Rk),jt=function(){function e(r){this.resultSelector=r}return e.prototype.call=function(r,s){return s.subscribe(new zz(r,this.resultSelector))},e}(),zz=function(e){function r(s,d,f){return(s=e.call(this,s)||this).resultSelector=d,s.iterators=[],s.active=0,s.resultSelector=typeof d=="function"?d:void 0,s}return O(r,e),r.prototype._next=function(s){var d=this.iterators;Jb(s)?d.push(new Az(s)):typeof s[$c]=="function"?d.push(new Bz(s[$c]())):d.push(new Cz(this.destination,this,s))},r.prototype._complete=function(){var s=this.iterators,d=s.length;if(this.unsubscribe(),d===0)this.destination.complete();else{this.active=d;for(var f=0;f<d;f++){var _=s[f];_.stillUnsubscribed?this.destination.add(_.subscribe()):this.active--}}},r.prototype.notifyInactive=function(){this.active--,this.active===0&&this.destination.complete()},r.prototype.checkIterators=function(){for(var s=this.iterators,d=s.length,f=this.destination,_=0;_<d;_++){var C=s[_];if(typeof C.hasValue=="function"&&!C.hasValue())return}var P=!1,x=[];for(_=0;_<d;_++){var B=(C=s[_]).next();if(C.hasCompleted()&&(P=!0),B.done)return void f.complete();x.push(B.value)}this.resultSelector?this._tryresultSelector(x):f.next(x),P&&f.complete()},r.prototype._tryresultSelector=function(s){try{var d=this.resultSelector.apply(this,s)}catch(f){return void this.destination.error(f)}this.destination.next(d)},r}(ia),Bz=function(){function e(r){this.iterator=r,this.nextResult=r.next()}return e.prototype.hasValue=function(){return!0},e.prototype.next=function(){var r=this.nextResult;return this.nextResult=this.iterator.next(),r},e.prototype.hasCompleted=function(){var r=this.nextResult;return!(!r||!r.done)},e}(),Az=function(){function e(r){this.array=r,this.length=this.index=0,this.length=r.length}return e.prototype[$c]=function(){return this},e.prototype.next=function(r){r=this.index++;var s=this.array;return r<this.length?{value:s[r],done:!1}:{value:null,done:!0}},e.prototype.hasValue=function(){return this.array.length>this.index},e.prototype.hasCompleted=function(){return this.array.length===this.index},e}(),Cz=function(e){function r(s,d,f){return(s=e.call(this,s)||this).parent=d,s.observable=f,s.stillUnsubscribed=!0,s.buffer=[],s.isComplete=!1,s}return O(r,e),r.prototype[$c]=function(){return this},r.prototype.next=function(){var s=this.buffer;return s.length===0&&this.isComplete?{value:null,done:!0}:{value:s.shift(),done:!1}},r.prototype.hasValue=function(){return 0<this.buffer.length},r.prototype.hasCompleted=function(){return this.buffer.length===0&&this.isComplete},r.prototype.notifyComplete=function(){0<this.buffer.length?(this.isComplete=!0,this.parent.notifyInactive()):this.destination.complete()},r.prototype.notifyNext=function(s){this.buffer.push(s),this.parent.checkIterators()},r.prototype.subscribe=function(){return ic(this.observable,new vc(this))},r}(wc),Dz=Object.freeze({__proto__:null,Observable:Y,ConnectableObservable:Cq,GroupedObservable:Mk,observable:ne,Subject:Pa,BehaviorSubject:gz,ReplaySubject:qe,AsyncSubject:of,asap:nz,asapScheduler:ri,async:bd,asyncScheduler:Pk,queue:fg,queueScheduler:fg,animationFrame:Fq,animationFrameScheduler:Fq,VirtualTimeScheduler:pz,VirtualAction:Gq,Scheduler:Nk,Subscription:Oa,Subscriber:ia,Notification:Ve,get NotificationKind(){return Ok},pipe:gi,noop:hc,identity:Yc,isObservable:function(e){return!!e&&(e instanceof Y||typeof e.lift=="function"&&typeof e.subscribe=="function")},ArgumentOutOfRangeError:Qk,EmptyError:vg,ObjectUnsubscribedError:qd,UnsubscriptionError:lf,TimeoutError:pb,bindCallback:cm,bindNodeCallback:dm,combineLatest:function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];var s=r=void 0;return Zc(e[e.length-1])&&(s=e.pop()),typeof e[e.length-1]=="function"&&(r=e.pop()),e.length===1&&Jb(e[0])&&(e=e[0]),nf(e,s).lift(new vz(r))},concat:im,defer:ad,empty:mf,forkJoin:jm,from:Kb,fromEvent:gb,fromEventPattern:lm,generate:function(e,r,s,d,f){if(arguments.length==1){var _=e.initialState;r=e.condition,s=e.iterate;var C=e.resultSelector||Yc;f=e.scheduler}else d===void 0||Zc(d)?(_=e,C=Yc,f=d):(_=e,C=d);return new Y(function(P){var x=_;if(f)return f.schedule(bt,0,{subscriber:P,iterate:s,condition:r,resultSelector:C,state:x});for(;;){if(r){var B=void 0;try{B=r(x)}catch(_t){P.error(_t);break}if(!B){P.complete();break}}B=void 0;try{B=C(x)}catch(_t){P.error(_t);break}if(P.next(B),P.closed)break;try{x=s(x)}catch(_t){P.error(_t);break}}})},iif:function(e,r,s){return r===void 0&&(r=vb),s===void 0&&(s=vb),ad(function(){return e()?r:s})},interval:mm,merge:Xb,never:function(){return Tk},of:bb,onErrorResumeNext:li,pairs:function(e,r){return new Y(r?function(s){var d=Object.keys(e),f=new Oa;return f.add(r.schedule(dt,0,{keys:d,index:0,subscriber:s,subscription:f,obj:e})),f}:function(s){for(var d=Object.keys(e),f=0;f<d.length&&!s.closed;f++){var _=d[f];e.hasOwnProperty(_)&&s.next([_,e[_]])}s.complete()})},partition:function(e,r,s){return[wb(r,s)(new Y(pf(e))),wb(et(r,s))(new Y(pf(e)))]},race:Ca,range:function(e,r,s){return e===void 0&&(e=0),new Y(function(d){r===void 0&&(r=e,e=0);var f=0,_=e;if(s)return s.schedule(ht,0,{index:f,count:r,start:e,subscriber:d});for(;;){if(f++>=r){d.complete();break}if(d.next(_++),d.closed)break}})},throwError:Z,timer:Bc,using:function(e,r){return new Y(function(s){try{var d=e()}catch(C){return void s.error(C)}try{var f=r(d)}catch(C){return void s.error(C)}var _=(f?Kb(f):vb).subscribe(s);return function(){_.unsubscribe(),d&&d.unsubscribe()}})},zip:mi,scheduled:gm,EMPTY:vb,NEVER:Tk,config:Ib}),kt=function(){function e(r){this.selector=r}return e.prototype.call=function(r,s){return s.subscribe(new Ez(r,this.selector,this.caught))},e}(),Ez=function(e){function r(s,d,f){return(s=e.call(this,s)||this).selector=d,s.caught=f,s}return O(r,e),r.prototype.error=function(s){if(!this.isStopped){var d=void 0;try{d=this.selector(s,this.caught)}catch(f){return void e.prototype.error.call(this,f)}this._unsubscribeAndRecycle(),s=new vc(this),this.add(s),(d=ic(d,s))!==s&&this.add(d)}},r}(wc),lt=function(){function e(r){this.defaultValue=r}return e.prototype.call=function(r,s){return s.subscribe(new Fz(r,this.defaultValue))},e}(),Fz=function(e){function r(s,d){return(s=e.call(this,s)||this).defaultValue=d,s.isEmpty=!0,s}return O(r,e),r.prototype._next=function(s){this.isEmpty=!1,this.destination.next(s)},r.prototype._complete=function(){this.isEmpty&&this.destination.next(this.defaultValue),this.destination.complete()},r}(ia),mt=function(){function e(r,s){this.delay=r,this.scheduler=s}return e.prototype.call=function(r,s){return s.subscribe(new Gz(r,this.delay,this.scheduler))},e}(),Gz=function(e){function r(s,d,f){return(s=e.call(this,s)||this).delay=d,s.scheduler=f,s.queue=[],s.active=!1,s.errored=!1,s}return O(r,e),r.dispatch=function(s){for(var d=s.source,f=d.queue,_=s.scheduler,C=s.destination;0<f.length&&0>=f[0].time-_.now();)f.shift().notification.observe(C);0<f.length?(d=Math.max(0,f[0].time-_.now()),this.schedule(s,d)):(this.unsubscribe(),d.active=!1)},r.prototype._schedule=function(s){this.active=!0,this.destination.add(s.schedule(r.dispatch,this.delay,{source:this,destination:this.destination,scheduler:s}))},r.prototype.scheduleNotification=function(s){if(this.errored!==!0){var d=this.scheduler;s=new Hz(d.now()+this.delay,s),this.queue.push(s),this.active===!1&&this._schedule(d)}},r.prototype._next=function(s){this.scheduleNotification(Ve.createNext(s))},r.prototype._error=function(s){this.errored=!0,this.queue=[],this.destination.error(s),this.unsubscribe()},r.prototype._complete=function(){this.scheduleNotification(Ve.createComplete()),this.unsubscribe()},r}(ia),Hz=function(e,r){this.time=e,this.notification=r},nt=function(){function e(r,s){this.keySelector=r,this.flushes=s}return e.prototype.call=function(r,s){return s.subscribe(new Iz(r,this.keySelector,this.flushes))},e}(),Iz=function(e){function r(s,d,f){return(s=e.call(this,s)||this).keySelector=d,s.values=new Set,f&&s.add(ic(f,new vc(s))),s}return O(r,e),r.prototype.notifyNext=function(){this.values.clear()},r.prototype.notifyError=function(s){this._error(s)},r.prototype._next=function(s){this.keySelector?this._useKeySelector(s):this._finalizeNext(s,s)},r.prototype._useKeySelector=function(s){var d=this.destination;try{var f=this.keySelector(s)}catch(_){return void d.error(_)}this._finalizeNext(f,s)},r.prototype._finalizeNext=function(s,d){var f=this.values;f.has(s)||(f.add(s),this.destination.next(d))},r}(wc),pt=function(){function e(r){this.errorFactory=r}return e.prototype.call=function(r,s){return s.subscribe(new Jz(r,this.errorFactory))},e}(),Jz=function(e){function r(s,d){return(s=e.call(this,s)||this).errorFactory=d,s.hasValue=!1,s}return O(r,e),r.prototype._next=function(s){this.hasValue=!0,this.destination.next(s)},r.prototype._complete=function(){if(this.hasValue)return this.destination.complete();var s=void 0;try{s=this.errorFactory()}catch(d){s=d}this.destination.error(s)},r}(ia),qt=function(){function e(r){if(this.total=r,0>this.total)throw new Qk}return e.prototype.call=function(r,s){return s.subscribe(new Kz(r,this.total))},e}(),Kz=function(e){function r(s,d){return(s=e.call(this,s)||this).total=d,s.count=0,s}return O(r,e),r.prototype._next=function(s){var d=this.total,f=++this.count;f<=d&&(this.destination.next(s),f===d&&(this.destination.complete(),this.unsubscribe()))},r}(ia),rt=function(){function e(r){this.project=r}return e.prototype.call=function(r,s){return s.subscribe(new Lz(r,this.project))},e}(),Lz=function(e){function r(s,d){return(s=e.call(this,s)||this).project=d,s.hasSubscription=!1,s.hasCompleted=!1,s.index=0,s}return O(r,e),r.prototype._next=function(s){this.hasSubscription||this.tryNext(s)},r.prototype.tryNext=function(s){var d=this.index++;try{var f=this.project(s,d)}catch(_){return void this.destination.error(_)}this.hasSubscription=!0,this._innerSub(f)},r.prototype._innerSub=function(s){var d=new vc(this),f=this.destination;f.add(d),(s=ic(s,d))!==d&&f.add(s)},r.prototype._complete=function(){this.hasCompleted=!0,this.hasSubscription||this.destination.complete(),this.unsubscribe()},r.prototype.notifyNext=function(s){this.destination.next(s)},r.prototype.notifyError=function(s){this.destination.error(s)},r.prototype.notifyComplete=function(){this.hasSubscription=!1,this.hasCompleted&&this.destination.complete()},r}(wc),st=function(){function e(r){this.callback=r}return e.prototype.call=function(r,s){return s.subscribe(new Mz(r,this.callback))},e}(),Mz=function(e){function r(s,d){return(s=e.call(this,s)||this).add(new Oa(d)),s}return O(r,e),r}(ia),ut=function(){function e(){}return e.prototype.call=function(r,s){return s.subscribe(new Nz(r))},e}(),Nz=function(e){function r(){return e!==null&&e.apply(this,arguments)||this}return O(r,e),r.prototype._next=function(s){},r}(ia),vt=function(){function e(r){if(this.total=r,0>this.total)throw new Qk}return e.prototype.call=function(r,s){return s.subscribe(new Oz(r,this.total))},e}(),Oz=function(e){function r(s,d){return(s=e.call(this,s)||this).total=d,s.ring=[],s.count=0,s}return O(r,e),r.prototype._next=function(s){var d=this.ring,f=this.total,_=this.count++;d.length<f?d.push(s):d[_%f]=s},r.prototype._complete=function(){var s=this.destination,d=this.count;if(0<d)for(var f=this.count>=this.total?this.total:this.count,_=this.ring,C=0;C<f;C++){var P=d++%f;s.next(_[P])}s.complete()},r}(ia),wt=function(){function e(r){this.value=r}return e.prototype.call=function(r,s){return s.subscribe(new Pz(r,this.value))},e}(),Pz=function(e){function r(s,d){return(s=e.call(this,s)||this).value=d,s}return O(r,e),r.prototype._next=function(s){this.destination.next(this.value)},r}(ia),xt=function(){function e(r,s,d){d===void 0&&(d=!1),this.accumulator=r,this.seed=s,this.hasSeed=d}return e.prototype.call=function(r,s){return s.subscribe(new Qz(r,this.accumulator,this.seed,this.hasSeed))},e}(),Qz=function(e){function r(s,d,f,_){return(s=e.call(this,s)||this).accumulator=d,s._seed=f,s.hasSeed=_,s.index=0,s}return O(r,e),Object.defineProperty(r.prototype,"seed",{get:function(){return this._seed},set:function(s){this.hasSeed=!0,this._seed=s},enumerable:!0,configurable:!0}),r.prototype._next=function(s){if(this.hasSeed)return this._tryNext(s);this.seed=s,this.destination.next(s)},r.prototype._tryNext=function(s){var d=this.index++;try{var f=this.accumulator(this.seed,s,d)}catch(_){this.destination.error(_)}this.seed=f,this.destination.next(f)},r}(ia),zt=function(){function e(r,s){this.subjectFactory=r,this.selector=s}return e.prototype.call=function(r,s){var d=this.selector,f=this.subjectFactory();return(r=d(f).subscribe(r)).add(s.subscribe(f)),r},e}(),Bt=function(){function e(r,s){this.notifier=r,this.source=s}return e.prototype.call=function(r,s){return s.subscribe(new Rz(r,this.notifier,this.source))},e}(),Rz=function(e){function r(s,d,f){return(s=e.call(this,s)||this).notifier=d,s.source=f,s}return O(r,e),r.prototype.error=function(s){if(!this.isStopped){var d=this.errors,f=this.retries,_=this.retriesSubscription;if(f)this.retriesSubscription=this.errors=void 0;else{d=new Pa;try{f=(0,this.notifier)(d)}catch(C){return e.prototype.error.call(this,C)}_=ic(f,new vc(this))}this._unsubscribeAndRecycle(),this.errors=d,this.retries=f,this.retriesSubscription=_,d.next(s)}},r.prototype._unsubscribe=function(){var s=this.errors,d=this.retriesSubscription;s&&(s.unsubscribe(),this.errors=void 0),d&&(d.unsubscribe(),this.retriesSubscription=void 0),this.retries=void 0},r.prototype.notifyNext=function(){var s=this._unsubscribe;this._unsubscribe=null,this._unsubscribeAndRecycle(),this._unsubscribe=s,this.source.subscribe(this)},r}(wc),Et=function(){function e(r){this.project=r}return e.prototype.call=function(r,s){return s.subscribe(new Sz(r,this.project))},e}(),Sz=function(e){function r(s,d){return(s=e.call(this,s)||this).project=d,s.index=0,s}return O(r,e),r.prototype._next=function(s){var d=this.index++;try{var f=this.project(s,d)}catch(_){return void this.destination.error(_)}this._innerSub(f)},r.prototype._innerSub=function(s){var d=this.innerSubscription;d&&d.unsubscribe(),d=new vc(this);var f=this.destination;f.add(d),this.innerSubscription=ic(s,d),this.innerSubscription!==d&&f.add(this.innerSubscription)},r.prototype._complete=function(){var s=this.innerSubscription;s&&!s.closed||e.prototype._complete.call(this),this.unsubscribe()},r.prototype._unsubscribe=function(){this.innerSubscription=void 0},r.prototype.notifyComplete=function(){this.innerSubscription=void 0,this.isStopped&&e.prototype._complete.call(this)},r.prototype.notifyNext=function(s){this.destination.next(s)},r}(wc),Ft=function(){function e(r){this.notifier=r}return e.prototype.call=function(r,s){r=new Tz(r);var d=ic(this.notifier,new vc(r));return d&&!r.seenValue?(r.add(d),s.subscribe(r)):r},e}(),Tz=function(e){function r(s){return(s=e.call(this,s)||this).seenValue=!1,s}return O(r,e),r.prototype.notifyNext=function(){this.seenValue=!0,this.complete()},r.prototype.notifyComplete=function(){},r}(wc),Ht=function(){function e(r,s){this.predicate=r,this.inclusive=s}return e.prototype.call=function(r,s){return s.subscribe(new Uz(r,this.predicate,this.inclusive))},e}(),Uz=function(e){function r(s,d,f){return(s=e.call(this,s)||this).predicate=d,s.inclusive=f,s.index=0,s}return O(r,e),r.prototype._next=function(s){var d=this.destination;try{var f=this.predicate(s,this.index++)}catch(_){return void d.error(_)}this.nextOrComplete(s,f)},r.prototype.nextOrComplete=function(s,d){var f=this.destination;d?f.next(s):(this.inclusive&&f.next(s),f.complete())},r}(ia),It=function(){function e(r,s,d){this.nextOrObserver=r,this.error=s,this.complete=d}return e.prototype.call=function(r,s){return s.subscribe(new Vz(r,this.nextOrObserver,this.error,this.complete))},e}(),Vz=function(e){function r(s,d,f,_){return(s=e.call(this,s)||this)._tapNext=hc,s._tapError=hc,s._tapComplete=hc,s._tapError=f||hc,s._tapComplete=_||hc,le(d)?(s._context=s,s._tapNext=d):d&&(s._context=d,s._tapNext=d.next||hc,s._tapError=d.error||hc,s._tapComplete=d.complete||hc),s}return O(r,e),r.prototype._next=function(s){try{this._tapNext.call(this._context,s)}catch(d){return void this.destination.error(d)}this.destination.next(s)},r.prototype._error=function(s){try{this._tapError.call(this._context,s)}catch(d){return void this.destination.error(d)}this.destination.error(s)},r.prototype._complete=function(){try{this._tapComplete.call(this._context)}catch(s){return void this.destination.error(s)}return this.destination.complete()},r}(ia),Kt={leading:!0,trailing:!1};(function(e){function r(s,d,f,_){var C=e.call(this,s)||this;return C.destination=s,C.durationSelector=d,C._leading=f,C._trailing=_,C._hasValue=!1,C}O(r,e),r.prototype._next=function(s){this._hasValue=!0,this._sendValue=s,this._throttled||(this._leading?this.send():this.throttle(s))},r.prototype.send=function(){var s=this._sendValue;this._hasValue&&(this.destination.next(s),this.throttle(s)),this._hasValue=!1,this._sendValue=void 0},r.prototype.throttle=function(s){(s=this.tryDurationSelector(s))&&this.add(this._throttled=ic(s,new vc(this)))},r.prototype.tryDurationSelector=function(s){try{return this.durationSelector(s)}catch(d){return this.destination.error(d),null}},r.prototype.throttlingDone=function(){var s=this._throttled,d=this._trailing;s&&s.unsubscribe(),this._throttled=void 0,d&&this.send()},r.prototype.notifyNext=function(){this.throttlingDone()},r.prototype.notifyComplete=function(){this.throttlingDone()}})(wc);for(var Lt=function(){function e(r,s,d,f){this.duration=r,this.scheduler=s,this.leading=d,this.trailing=f}return e.prototype.call=function(r,s){return s.subscribe(new Wz(r,this.duration,this.scheduler,this.leading,this.trailing))},e}(),Wz=function(e){function r(s,d,f,_,C){return(s=e.call(this,s)||this).duration=d,s.scheduler=f,s.leading=_,s.trailing=C,s._hasTrailingValue=!1,s._trailingValue=null,s}return O(r,e),r.prototype._next=function(s){this.throttled?this.trailing&&(this._trailingValue=s,this._hasTrailingValue=!0):(this.add(this.throttled=this.scheduler.schedule(Mt,this.duration,{subscriber:this})),this.leading?this.destination.next(s):this.trailing&&(this._trailingValue=s,this._hasTrailingValue=!0))},r.prototype._complete=function(){this._hasTrailingValue&&this.destination.next(this._trailingValue),this.destination.complete()},r.prototype.clearThrottle=function(){var s=this.throttled;s&&(this.trailing&&this._hasTrailingValue&&(this.destination.next(this._trailingValue),this._trailingValue=null,this._hasTrailingValue=!1),s.unsubscribe(),this.remove(s),this.throttled=null)},r}(ia),Ot=function(){function e(r,s,d,f){this.waitFor=r,this.absoluteTimeout=s,this.withObservable=d,this.scheduler=f}return e.prototype.call=function(r,s){return s.subscribe(new Xz(r,this.absoluteTimeout,this.waitFor,this.withObservable,this.scheduler))},e}(),Xz=function(e){function r(s,d,f,_,C){return(s=e.call(this,s)||this).absoluteTimeout=d,s.waitFor=f,s.withObservable=_,s.scheduler=C,s.scheduleTimeout(),s}return O(r,e),r.dispatchTimeout=function(s){var d=s.withObservable;s._unsubscribeAndRecycle(),s.add(ic(d,new vc(s)))},r.prototype.scheduleTimeout=function(){var s=this.action;s?this.action=s.schedule(this,this.waitFor):this.add(this.action=this.scheduler.schedule(r.dispatchTimeout,this.waitFor,this))},r.prototype._next=function(s){this.absoluteTimeout||this.scheduleTimeout(),e.prototype._next.call(this,s)},r.prototype._unsubscribe=function(){this.action=void 0,this.withObservable=this.scheduler=null},r}(wc),Qt=function(){function e(r,s){this.observables=r,this.project=s}return e.prototype.call=function(r,s){return s.subscribe(new Yz(r,this.observables,this.project))},e}(),Yz=function(e){function r(s,d,f){(s=e.call(this,s)||this).observables=d,s.project=f,s.toRespond=[],f=d.length,s.values=Array(f);for(var _=0;_<f;_++)s.toRespond.push(_);for(_=0;_<f;_++)s.add(ji(s,d[_],void 0,_));return s}return O(r,e),r.prototype.notifyNext=function(s,d,f){this.values[f]=d,0<(s=this.toRespond).length&&(f=s.indexOf(f))!==-1&&s.splice(f,1)},r.prototype.notifyComplete=function(){},r.prototype._next=function(s){this.toRespond.length===0&&(s=[s].concat(this.values),this.project?this._tryProject(s):this.destination.next(s))},r.prototype._tryProject=function(s){try{var d=this.project.apply(this,s)}catch(f){return void this.destination.error(f)}this.destination.next(d)},r}(Rk),Jq=$a(function(e){var r=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof window.msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto);if(r){var s=new Uint8Array(16);e.exports=function(){return r(s),s}}else{var d=Array(16);e.exports=function(){for(var f,_=0;16>_;_++)!(3&_)&&(f=4294967296*Math.random()),d[_]=f>>>((3&_)<<3)&255;return d}}}),ab=[],Gh=0;256>Gh;++Gh)ab[Gh]=(Gh+256).toString(16).substr(1);var Kq=function(e,r){return r=r||0,[ab[e[r++]],ab[e[r++]],ab[e[r++]],ab[e[r++]],"-",ab[e[r++]],ab[e[r++]],"-",ab[e[r++]],ab[e[r++]],"-",ab[e[r++]],ab[e[r++]],"-",ab[e[r++]],ab[e[r++]],ab[e[r++]],ab[e[r++]],ab[e[r++]],ab[e[r++]]].join("")},Ud=function(e,r,s){if(s=r&&s||0,typeof e=="string"&&(r=e==="binary"?Array(16):null,e=null),(e=(e=e||{}).random||(e.rng||Jq)())[6]=15&e[6]|64,e[8]=63&e[8]|128,r)for(var d=0;16>d;++d)r[s+d]=e[d];return r||Kq(e)},gg=Ud(),Uk=!1,Pc,rd,Vk,Wk,sd,Vd,ec,We,Rb,Xk,Qc,Wd,Rc,Sc,Tc,Xe,Uc,Vc;(function(e){e[e.ATTRIBUTE_OPERATION_ERR_FAILURE=2]="ATTRIBUTE_OPERATION_ERR_FAILURE",e[e.ATTRIBUTE_OPERATION_ERR_INVALID_ARGUMENT=3]="ATTRIBUTE_OPERATION_ERR_INVALID_ARGUMENT",e[e.ATTRIBUTE_OPERATION_ERR_SIZE_OVERFLOW=4]="ATTRIBUTE_OPERATION_ERR_SIZE_OVERFLOW",e[e.ATTRIBUTE_OPERATION_ERR_TOO_OFTEN=5]="ATTRIBUTE_OPERATION_ERR_TOO_OFTEN",e[e.ATTRIBUTE_OPERATION_ERR_USER_NOT_FOUND=6]="ATTRIBUTE_OPERATION_ERR_USER_NOT_FOUND",e[e.ATTRIBUTE_OPERATION_ERR_TIMEOUT=7]="ATTRIBUTE_OPERATION_ERR_TIMEOUT",e[e.ATTRIBUTE_OPERATION_ERR_USER_NOT_LOGGED_IN=102]="ATTRIBUTE_OPERATION_ERR_USER_NOT_LOGGED_IN"})(Pc||(Pc={})),function(e){e[e.CHANNEL_MESSAGE_ERR_FAILURE=1]="CHANNEL_MESSAGE_ERR_FAILURE",e[e.CHANNEL_MESSAGE_ERR_TIMEOUT=2]="CHANNEL_MESSAGE_ERR_TIMEOUT",e[e.CHANNEL_MESSAGE_ERR_TOO_OFTEN=3]="CHANNEL_MESSAGE_ERR_TOO_OFTEN",e[e.CHANNEL_MESSAGE_ERR_INVALID_MESSAGE=4]="CHANNEL_MESSAGE_ERR_INVALID_MESSAGE",e[e.CHANNEL_MESSAGE_ERR_NOT_IN_CHANNEL=5]="CHANNEL_MESSAGE_ERR_NOT_IN_CHANNEL",e[e.CHANNEL_MESSAGE_ERR_USER_NOT_LOGGED_IN=102]="CHANNEL_MESSAGE_ERR_USER_NOT_LOGGED_IN"}(rd||(rd={})),function(e){e[e.CREATE_CHANNEL_ERR_INVALID_ARGUMENT=1]="CREATE_CHANNEL_ERR_INVALID_ARGUMENT"}(Vk||(Vk={})),function(e){e[e.CREATE_INSTANCE_ERR_INVALID_ARGUMENT=1]="CREATE_INSTANCE_ERR_INVALID_ARGUMENT"}(Wk||(Wk={})),function(e){e[e.GET_MEMBERS_ERR_FAILURE=1]="GET_MEMBERS_ERR_FAILURE",e[e.GET_MEMBERS_ERR_REJECTED=2]="GET_MEMBERS_ERR_REJECTED",e[e.GET_MEMBERS_ERR_TIMEOUT=3]="GET_MEMBERS_ERR_TIMEOUT",e[e.GET_MEMBERS_ERR_TOO_OFTEN=4]="GET_MEMBERS_ERR_TOO_OFTEN",e[e.GET_MEMBERS_ERR_NOT_IN_CHANNEL=5]="GET_MEMBERS_ERR_NOT_IN_CHANNEL",e[e.GET_MEMBERS_ERR_USER_NOT_LOGGED_IN=102]="GET_MEMBERS_ERR_USER_NOT_LOGGED_IN"}(sd||(sd={})),function(e){e[e.INVITATION_API_CALL_ERR_INVALID_ARGUMENT=1]="INVITATION_API_CALL_ERR_INVALID_ARGUMENT",e[e.INVITATION_API_CALL_ERR_NOT_STARTED=2]="INVITATION_API_CALL_ERR_NOT_STARTED",e[e.INVITATION_API_CALL_ERR_ALREADY_END=3]="INVITATION_API_CALL_ERR_ALREADY_END",e[e.INVITATION_API_CALL_ERR_ALREADY_ACCEPT=4]="INVITATION_API_CALL_ERR_ALREADY_ACCEPT",e[e.INVITATION_API_CALL_ERR_ALREADY_SENT=5]="INVITATION_API_CALL_ERR_ALREADY_SENT"}(Vd||(Vd={})),function(e){e[e.JOIN_CHANNEL_ERR_FAILURE=1]="JOIN_CHANNEL_ERR_FAILURE",e[e.JOIN_CHANNEL_ERR_REJECTED=2]="JOIN_CHANNEL_ERR_REJECTED",e[e.JOIN_CHANNEL_ERR_INVALID_ARGUMENT=3]="JOIN_CHANNEL_ERR_INVALID_ARGUMENT",e[e.JOIN_CHANNEL_TIMEOUT=4]="JOIN_CHANNEL_TIMEOUT",e[e.JOIN_CHANNEL_ERR_EXCEED_LIMIT=5]="JOIN_CHANNEL_ERR_EXCEED_LIMIT",e[e.JOIN_CHANNEL_ERR_ALREADY_JOINED=6]="JOIN_CHANNEL_ERR_ALREADY_JOINED",e[e.JOIN_CHANNEL_ERR_TOO_OFTEN=7]="JOIN_CHANNEL_ERR_TOO_OFTEN",e[e.JOIN_CHANNEL_ERR_JOIN_SAME_CHANNEL_TOO_OFTEN=8]="JOIN_CHANNEL_ERR_JOIN_SAME_CHANNEL_TOO_OFTEN",e[e.JOIN_CHANNEL_ERR_USER_NOT_LOGGED_IN=102]="JOIN_CHANNEL_ERR_USER_NOT_LOGGED_IN",e[e.JOIN_CHANNEL_ERR_ABORTED_BY_LEAVE=201]="JOIN_CHANNEL_ERR_ABORTED_BY_LEAVE",e[e.JOIN_CHANNEL_ERR_ALREADY_JOINED_CHANNEL_OF_SAME_ID=202]="JOIN_CHANNEL_ERR_ALREADY_JOINED_CHANNEL_OF_SAME_ID"}(ec||(ec={})),function(e){e[e.LEAVE_CHANNEL_ERR_FAILURE=1]="LEAVE_CHANNEL_ERR_FAILURE",e[e.LEAVE_CHANNEL_ERR_REJECTED=2]="LEAVE_CHANNEL_ERR_REJECTED",e[e.LEAVE_CHANNEL_ERR_NOT_IN_CHANNEL=3]="LEAVE_CHANNEL_ERR_NOT_IN_CHANNEL",e[e.LEAVE_CHANNEL_ERR_USER_NOT_LOGGED_IN=102]="LEAVE_CHANNEL_ERR_USER_NOT_LOGGED_IN"}(We||(We={})),function(e){e[e.LOGIN_ERR_UNKNOWN=1]="LOGIN_ERR_UNKNOWN",e[e.LOGIN_ERR_REJECTED=2]="LOGIN_ERR_REJECTED",e[e.LOGIN_ERR_INVALID_ARGUMENT=3]="LOGIN_ERR_INVALID_ARGUMENT",e[e.LOGIN_ERR_INVALID_APP_ID=4]="LOGIN_ERR_INVALID_APP_ID",e[e.LOGIN_ERR_INVALID_TOKEN=5]="LOGIN_ERR_INVALID_TOKEN",e[e.LOGIN_ERR_TOKEN_EXPIRED=6]="LOGIN_ERR_TOKEN_EXPIRED",e[e.LOGIN_ERR_NOT_AUTHORIZED=7]="LOGIN_ERR_NOT_AUTHORIZED",e[e.LOGIN_ERR_ALREADY_LOGIN=8]="LOGIN_ERR_ALREADY_LOGIN",e[e.LOGIN_ERR_TIMEOUT=9]="LOGIN_ERR_TIMEOUT",e[e.LOGIN_ERR_TOO_OFTEN=10]="LOGIN_ERR_TOO_OFTEN",e[e.LOGIN_ERR_ABORTED_BY_LOGOUT=201]="LOGIN_ERR_ABORTED_BY_LOGOUT"}(Rb||(Rb={})),function(e){e[e.LOGOUT_ERR_USER_NOT_LOGGED_IN=102]="LOGOUT_ERR_USER_NOT_LOGGED_IN"}(Xk||(Xk={})),function(e){e[e.PEER_MESSAGE_ERR_FAILURE=1]="PEER_MESSAGE_ERR_FAILURE",e[e.PEER_MESSAGE_ERR_TIMEOUT=2]="PEER_MESSAGE_ERR_TIMEOUT",e[e.PEER_MESSAGE_ERR_TOO_OFTEN=5]="PEER_MESSAGE_ERR_TOO_OFTEN",e[e.PEER_MESSAGE_ERR_INVALID_USERID=6]="PEER_MESSAGE_ERR_INVALID_USERID",e[e.PEER_MESSAGE_ERR_INVALID_MESSAGE=7]="PEER_MESSAGE_ERR_INVALID_MESSAGE",e[e.PEER_MESSAGE_ERR_INCOMPATIBLE_MESSAGE=8]="PEER_MESSAGE_ERR_INCOMPATIBLE_MESSAGE",e[e.PEER_MESSAGE_ERR_USER_NOT_LOGGED_IN=102]="PEER_MESSAGE_ERR_USER_NOT_LOGGED_IN"}(Qc||(Qc={})),function(e){e[e.QUERY_PEERS_ONLINE_STATUS_ERR_INVALID_ARGUMENT=2]="QUERY_PEERS_ONLINE_STATUS_ERR_INVALID_ARGUMENT",e[e.QUERY_PEERS_ONLINE_STATUS_ERR_REJECTED=3]="QUERY_PEERS_ONLINE_STATUS_ERR_REJECTED",e[e.QUERY_PEERS_ONLINE_STATUS_ERR_TIMEOUT=4]="QUERY_PEERS_ONLINE_STATUS_ERR_TIMEOUT",e[e.QUERY_PEERS_ONLINE_STATUS_ERR_TOO_OFTEN=5]="QUERY_PEERS_ONLINE_STATUS_ERR_TOO_OFTEN",e[e.QUERY_PEERS_ONLINE_STATUS_ERR_USER_NOT_LOGGED_IN=102]="QUERY_PEERS_ONLINE_STATUS_ERR_USER_NOT_LOGGED_IN"}(Wd||(Wd={})),function(e){e[e.RENEW_TOKEN_ERR_FAILURE=1]="RENEW_TOKEN_ERR_FAILURE",e[e.RENEW_TOKEN_ERR_INVALID_ARGUMENT=2]="RENEW_TOKEN_ERR_INVALID_ARGUMENT",e[e.RENEW_TOKEN_ERR_REJECTED=3]="RENEW_TOKEN_ERR_REJECTED",e[e.RENEW_TOKEN_ERR_TOO_OFTEN=4]="RENEW_TOKEN_ERR_TOO_OFTEN",e[e.RENEW_TOKEN_ERR_TOKEN_EXPIRED=5]="RENEW_TOKEN_ERR_TOKEN_EXPIRED",e[e.RENEW_TOKEN_ERR_INVALID_TOKEN=6]="RENEW_TOKEN_ERR_INVALID_TOKEN",e[e.RENEW_TOKEN_ERR_USER_NOT_LOGGED_IN=102]="RENEW_TOKEN_ERR_USER_NOT_LOGGED_IN",e[e.RENEW_TOKEN_ERR_ABORTED_BY_LOGOUT=201]="RENEW_TOKEN_ERR_ABORTED_BY_LOGOUT"}(Rc||(Rc={})),function(e){e[e.GET_CHANNEL_MEMBER_COUNT_ERR_FAILURE=1]="GET_CHANNEL_MEMBER_COUNT_ERR_FAILURE",e[e.GET_CHANNEL_MEMBER_COUNT_ERR_INVALID_ARGUMENT=2]="GET_CHANNEL_MEMBER_COUNT_ERR_INVALID_ARGUMENT",e[e.GET_CHANNEL_MEMBER_COUNT_ERR_TOO_OFTEN=3]="GET_CHANNEL_MEMBER_COUNT_ERR_TOO_OFTEN",e[e.GET_CHANNEL_MEMBER_COUNT_ERR_TIMEOUT=4]="GET_CHANNEL_MEMBER_COUNT_ERR_TIMEOUT",e[e.GET_CHANNEL_MEMBER_COUNT_ERR_EXCEED_LIMIT=5]="GET_CHANNEL_MEMBER_COUNT_ERR_EXCEED_LIMIT",e[e.GET_CHANNEL_MEMBER_COUNT_ERR_NOT_INITIALIZED=101]="GET_CHANNEL_MEMBER_COUNT_ERR_NOT_INITIALIZED",e[e.GET_CHANNEL_MEMBER_COUNT_ERR_USER_NOT_LOGGED_IN=102]="GET_CHANNEL_MEMBER_COUNT_ERR_USER_NOT_LOGGED_IN"}(Sc||(Sc={})),function(e){e[e.PEER_SUBSCRIPTION_STATUS_ERR_FAILURE=1]="PEER_SUBSCRIPTION_STATUS_ERR_FAILURE",e[e.PEER_SUBSCRIPTION_STATUS_ERR_INVALID_ARGUMENT=2]="PEER_SUBSCRIPTION_STATUS_ERR_INVALID_ARGUMENT",e[e.PEER_SUBSCRIPTION_STATUS_ERR_REJECTED=3]="PEER_SUBSCRIPTION_STATUS_ERR_REJECTED",e[e.PEER_SUBSCRIPTION_STATUS_ERR_TIMEOUT=4]="PEER_SUBSCRIPTION_STATUS_ERR_TIMEOUT",e[e.PEER_SUBSCRIPTION_STATUS_ERR_TOO_OFTEN=5]="PEER_SUBSCRIPTION_STATUS_ERR_TOO_OFTEN",e[e.PEER_SUBSCRIPTION_STATUS_ERR_OVERFLOW=6]="PEER_SUBSCRIPTION_STATUS_ERR_OVERFLOW",e[e.PEER_SUBSCRIPTION_STATUS_ERR_USER_NOT_LOGGED_IN=102]="PEER_SUBSCRIPTION_STATUS_ERR_USER_NOT_LOGGED_IN"}(Tc||(Tc={})),function(e){e[e.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_FAILURE=1]="QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_FAILURE",e[e.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_TIMEOUT=2]="QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_TIMEOUT",e[e.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_TOO_OFTEN=3]="QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_TOO_OFTEN",e[e.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_USER_NOT_LOGGED_IN=102]="QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_USER_NOT_LOGGED_IN"}(Xe||(Xe={})),function(e){e[e.UPLOAD_MEDIA_ERR_FAILURE=1]="UPLOAD_MEDIA_ERR_FAILURE",e[e.UPLOAD_MEDIA_ERR_INVALID_ARGUMENT=2]="UPLOAD_MEDIA_ERR_INVALID_ARGUMENT",e[e.UPLOAD_MEDIA_ERR_TIMEOUT=3]="UPLOAD_MEDIA_ERR_TIMEOUT",e[e.UPLOAD_MEDIA_ERR_SIZE_OVERFLOW=4]="UPLOAD_MEDIA_ERR_SIZE_OVERFLOW",e[e.UPLOAD_MEDIA_ERR_CONCURRENCY_LIMIT_EXCEEDED=5]="UPLOAD_MEDIA_ERR_CONCURRENCY_LIMIT_EXCEEDED",e[e.UPLOAD_MEDIA_ERR_INTERRUPTED=6]="UPLOAD_MEDIA_ERR_INTERRUPTED",e[e.UPLOAD_MEDIA_ERR_NOT_LOGGED_IN=102]="UPLOAD_MEDIA_ERR_NOT_LOGGED_IN"}(Uc||(Uc={})),function(e){e[e.DOWNLOAD_MEDIA_ERR_FAILURE=1]="DOWNLOAD_MEDIA_ERR_FAILURE",e[e.DOWNLOAD_MEDIA_ERR_INVALID_ARGUMENT=2]="DOWNLOAD_MEDIA_ERR_INVALID_ARGUMENT",e[e.DOWNLOAD_MEDIA_ERR_TIMEOUT=3]="DOWNLOAD_MEDIA_ERR_TIMEOUT",e[e.DOWNLOAD_MEDIA_ERR_NOT_EXIST=4]="DOWNLOAD_MEDIA_ERR_NOT_EXIST",e[e.DOWNLOAD_MEDIA_ERR_CONCURRENCY_LIMIT_EXCEEDED=5]="DOWNLOAD_MEDIA_ERR_CONCURRENCY_LIMIT_EXCEEDED",e[e.DOWNLOAD_MEDIA_ERR_INTERRUPTED=6]="DOWNLOAD_MEDIA_ERR_INTERRUPTED",e[e.DOWNLOAD_MEDIA_ERR_NOT_LOGGED_IN=102]="DOWNLOAD_MEDIA_ERR_NOT_LOGGED_IN"}(Vc||(Vc={}));var Sb=Pc.ATTRIBUTE_OPERATION_ERR_FAILURE,Ja=Pc.ATTRIBUTE_OPERATION_ERR_INVALID_ARGUMENT,se=Pc.ATTRIBUTE_OPERATION_ERR_SIZE_OVERFLOW;Pc.ATTRIBUTE_OPERATION_ERR_TOO_OFTEN;var Lq=Pc.ATTRIBUTE_OPERATION_ERR_USER_NOT_FOUND,Tb=Pc.ATTRIBUTE_OPERATION_ERR_TIMEOUT,Ub=Pc.ATTRIBUTE_OPERATION_ERR_USER_NOT_LOGGED_IN,hg=rd.CHANNEL_MESSAGE_ERR_FAILURE,Yk=rd.CHANNEL_MESSAGE_ERR_TIMEOUT,Mq=rd.CHANNEL_MESSAGE_ERR_TOO_OFTEN,Hh=rd.CHANNEL_MESSAGE_ERR_INVALID_MESSAGE;rd.CHANNEL_MESSAGE_ERR_NOT_IN_CHANNEL;var ig=rd.CHANNEL_MESSAGE_ERR_USER_NOT_LOGGED_IN,Zz=Vk.CREATE_CHANNEL_ERR_INVALID_ARGUMENT,Nq=Wk.CREATE_INSTANCE_ERR_INVALID_ARGUMENT;Sc.GET_CHANNEL_MEMBER_COUNT_ERR_FAILURE;var Oq=Sc.GET_CHANNEL_MEMBER_COUNT_ERR_INVALID_ARGUMENT;Sc.GET_CHANNEL_MEMBER_COUNT_ERR_TOO_OFTEN;var Pq=Sc.GET_CHANNEL_MEMBER_COUNT_ERR_TIMEOUT,$z=Sc.GET_CHANNEL_MEMBER_COUNT_ERR_EXCEED_LIMIT;Sc.GET_CHANNEL_MEMBER_COUNT_ERR_NOT_INITIALIZED;var aA=Sc.GET_CHANNEL_MEMBER_COUNT_ERR_USER_NOT_LOGGED_IN,bA=sd.GET_MEMBERS_ERR_FAILURE,cA=sd.GET_MEMBERS_ERR_REJECTED;sd.GET_MEMBERS_ERR_TIMEOUT,sd.GET_MEMBERS_ERR_TOO_OFTEN;var dA=sd.GET_MEMBERS_ERR_NOT_IN_CHANNEL,eA=sd.GET_MEMBERS_ERR_USER_NOT_LOGGED_IN,xc=Vd.INVITATION_API_CALL_ERR_INVALID_ARGUMENT,fA=Vd.INVITATION_API_CALL_ERR_NOT_STARTED,Ih=Vd.INVITATION_API_CALL_ERR_ALREADY_END,Qq=Vd.INVITATION_API_CALL_ERR_ALREADY_ACCEPT,gA=Vd.INVITATION_API_CALL_ERR_ALREADY_SENT,Rq=ec.JOIN_CHANNEL_ERR_FAILURE;ec.JOIN_CHANNEL_ERR_REJECTED;var hA=ec.JOIN_CHANNEL_ERR_INVALID_ARGUMENT,Sq=ec.JOIN_CHANNEL_TIMEOUT,Tq=ec.JOIN_CHANNEL_ERR_EXCEED_LIMIT,Uq=ec.JOIN_CHANNEL_ERR_ALREADY_JOINED;ec.JOIN_CHANNEL_ERR_TOO_OFTEN;var Vq=ec.JOIN_CHANNEL_ERR_USER_NOT_LOGGED_IN,Wq=ec.JOIN_CHANNEL_ERR_ALREADY_JOINED_CHANNEL_OF_SAME_ID,Xq=We.LEAVE_CHANNEL_ERR_FAILURE,Yq=We.LEAVE_CHANNEL_ERR_REJECTED,iA=We.LEAVE_CHANNEL_ERR_NOT_IN_CHANNEL,jA=We.LEAVE_CHANNEL_ERR_USER_NOT_LOGGED_IN,Zq=Rb.LOGIN_ERR_UNKNOWN,jg=Rb.LOGIN_ERR_REJECTED,Jh=Rb.LOGIN_ERR_INVALID_ARGUMENT,$q=Rb.LOGIN_ERR_INVALID_APP_ID,ar=Rb.LOGIN_ERR_INVALID_TOKEN,Kh=Rb.LOGIN_ERR_TOKEN_EXPIRED;Rb.LOGIN_ERR_NOT_AUTHORIZED;var kA=Rb.LOGIN_ERR_ALREADY_LOGIN,lA=Rb.LOGIN_ERR_TIMEOUT,mA=Rb.LOGIN_ERR_TOO_OFTEN,br=Xk.LOGOUT_ERR_USER_NOT_LOGGED_IN,cr=Qc.PEER_MESSAGE_ERR_FAILURE,Zk=Qc.PEER_MESSAGE_ERR_TIMEOUT,dr=Qc.PEER_MESSAGE_ERR_TOO_OFTEN,$k=Qc.PEER_MESSAGE_ERR_INVALID_USERID,ve=Qc.PEER_MESSAGE_ERR_INVALID_MESSAGE,al=Qc.PEER_MESSAGE_ERR_USER_NOT_LOGGED_IN,nA=Qc.PEER_MESSAGE_ERR_INCOMPATIBLE_MESSAGE,er=Wd.QUERY_PEERS_ONLINE_STATUS_ERR_INVALID_ARGUMENT;Wd.QUERY_PEERS_ONLINE_STATUS_ERR_REJECTED;var oA=Wd.QUERY_PEERS_ONLINE_STATUS_ERR_TIMEOUT;Wd.QUERY_PEERS_ONLINE_STATUS_ERR_TOO_OFTEN;var pA=Wd.QUERY_PEERS_ONLINE_STATUS_ERR_USER_NOT_LOGGED_IN,qA=Rc.RENEW_TOKEN_ERR_FAILURE,rA=Rc.RENEW_TOKEN_ERR_INVALID_ARGUMENT;Rc.RENEW_TOKEN_ERR_REJECTED,Rc.RENEW_TOKEN_ERR_TOO_OFTEN;var sA=Rc.RENEW_TOKEN_ERR_TOKEN_EXPIRED,tA=Rc.RENEW_TOKEN_ERR_INVALID_TOKEN,uA=Rc.RENEW_TOKEN_ERR_USER_NOT_LOGGED_IN,fr=Tc.PEER_SUBSCRIPTION_STATUS_ERR_FAILURE,kg=Tc.PEER_SUBSCRIPTION_STATUS_ERR_INVALID_ARGUMENT;Tc.PEER_SUBSCRIPTION_STATUS_ERR_REJECTED;var vA=Tc.PEER_SUBSCRIPTION_STATUS_ERR_TIMEOUT;Tc.PEER_SUBSCRIPTION_STATUS_ERR_TOO_OFTEN;var gr=Tc.PEER_SUBSCRIPTION_STATUS_ERR_OVERFLOW,bl=Tc.PEER_SUBSCRIPTION_STATUS_ERR_USER_NOT_LOGGED_IN;Xe.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_FAILURE,Xe.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_TIMEOUT,Xe.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_TOO_OFTEN,Xe.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_USER_NOT_LOGGED_IN;var lg=Uc.UPLOAD_MEDIA_ERR_FAILURE,wf=Uc.UPLOAD_MEDIA_ERR_INVALID_ARGUMENT,Lh=Uc.UPLOAD_MEDIA_ERR_TIMEOUT,wA=Uc.UPLOAD_MEDIA_ERR_SIZE_OVERFLOW,xA=Uc.UPLOAD_MEDIA_ERR_CONCURRENCY_LIMIT_EXCEEDED,hr=Uc.UPLOAD_MEDIA_ERR_INTERRUPTED,yA=Uc.UPLOAD_MEDIA_ERR_NOT_LOGGED_IN,mg=Vc.DOWNLOAD_MEDIA_ERR_FAILURE,cl=Vc.DOWNLOAD_MEDIA_ERR_INVALID_ARGUMENT,zA=Vc.DOWNLOAD_MEDIA_ERR_TIMEOUT,AA=Vc.DOWNLOAD_MEDIA_ERR_NOT_EXIST,BA=Vc.DOWNLOAD_MEDIA_ERR_CONCURRENCY_LIMIT_EXCEEDED,ir=Vc.DOWNLOAD_MEDIA_ERR_INTERRUPTED,CA=Vc.DOWNLOAD_MEDIA_ERR_NOT_LOGGED_IN,DA=function(e,r){var s;return Hk(e,function(d,f,_){return!(s=r(d,f,_))}),!!s},Mh=function(e,r,s){if(!lb(s))return!1;var d=X(r);return!!(d=="number"?Ed(s)&&wk(r,s.length):d=="string"&&r in s)&&$f(s[r],e)},dl=function(e,r,s){var d=Va(e)?tq:DA;return s&&Mh(e,r,s)&&(r=void 0),d(e,Te(r))},EA=function(e,r){var s=-1,d=Ed(e)?Array(e.length):[];return Hk(e,function(f,_,C){d[++s]=r(f,_,C)}),d},FA=function(e,r){var s=e.length;for(e.sort(r);s--;)e[s]=e[s].value;return e},GA=function(e,r,s){r=r.length?he(r,function(f){return Va(f)?function(_){return Ch(_,f.length===1?f[0]:f)}:f}):[Dh];var d=-1;return r=he(r,zh(Te)),e=EA(e,function(f,_,C){return{criteria:he(r,function(P){return P(f)}),index:++d,value:f}}),FA(e,function(f,_){t:{for(var C=-1,P=f.criteria,x=_.criteria,B=P.length,_t=s.length;++C<B;){e:{var ue=P[C],Wt=x[C];if(ue!==Wt){var _n=ue!==void 0,_i=ue===null,Ei=ue==ue,_a=ie(ue),Di=Wt!==void 0,_o=Wt===null,_s=Wt==Wt,_c=ie(Wt);if(!_o&&!_c&&!_a&&ue>Wt||_a&&Di&&_s&&!_o&&!_c||_i&&Di&&_s||!_n&&_s||!Ei){ue=1;break e}if(!_i&&!_a&&!_c&&ue<Wt||_c&&_n&&Ei&&!_i&&!_a||_o&&_n&&Ei||!Di&&Ei||!_s){ue=-1;break e}}ue=0}if(ue){f=C>=_t?ue:ue*(s[C]=="desc"?-1:1);break t}}f=f.index-_.index}return f})},jr=function(e,r){return rq(qq(e,r,Dh),e+"")},kr=jr(function(e,r){if(e==null)return[];var s=r.length;return 1<s&&Mh(e,r[0],r[1])?r=[]:2<s&&Mh(r[0],r[1],r[2])&&(r=[r[0]]),GA(e,$h(r,1),[])}),lr=function(e){if(e.__esModule)return e;var r=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(e).forEach(function(s){var d=Object.getOwnPropertyDescriptor(e,s);Object.defineProperty(r,s,d.get?d:{enumerable:!0,get:function(){return e[s]}})}),r}(Dz),mr=$a(function(e,r){Object.defineProperty(r,"__esModule",{value:!0});var s=[],d=function(f,_){return new WebSocket(f,_)};r.normalClosureMessage="Normal closure",r.default=function(f,_){var C=(_=_===void 0?{protocols:s,makeWebSocket:d}:_).protocols,P=C===void 0?s:C,x=(_=_.makeWebSocket)===void 0?d:_;return new lr.Observable(function(B){var _t,ue=new lr.Subject,Wt=x(f,P),_n=!1,_i=!1,Ei=function(_a){if(_t)throw _n=!0,_a=Error("Web socket message factory function called more than once"),B.error(_a),_a;return _t=_a.subscribe(function(Di){Wt.send(Di)}),ue};return Wt.onopen=function(){_i?(_n=!0,Wt.close()):B.next(Ei)},Wt.onmessage=function(_a){ue.next(_a.data)},Wt.onerror=function(_a){_n=!0,B.error(Error(_a.message))},Wt.onclose=function(_a){_n||(_n=!0,_i?(B.complete(),ue.complete()):B.error(Error(_a.code===1e3?r.normalClosureMessage:_a.reason)))},function(){_i=!0,_t&&_t.unsubscribe(),_n||(_n=!0,Wt.close())}})}});(function(e){e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")&&e.default})(mr);var pi=function(e,r,s){(s===void 0||$f(e[r],s))&&(s!==void 0||r in e)||bg(e,r,s)},oi=function(e,r){if((r!=="constructor"||typeof e[r]!="function")&&r!="__proto__")return e[r]},HA=function(e){return jr(function(r,s){var d=-1,f=s.length,_=1<f?s[f-1]:void 0,C=2<f?s[2]:void 0;for(_=3<e.length&&typeof _=="function"?(f--,_):void 0,C&&Mh(s[0],s[1],C)&&(_=3>f?void 0:_,f=1),r=Object(r);++d<f;)(C=s[d])&&e(r,C,d,_);return r})}(function(e,r,s,d){tm(e,r,s,d)}),IA=Math.floor,JA=Math.random,nr=function(e,r){return e+IA(JA()*(r-e+1))},or=function(e){var r=e.length;return r?e[nr(0,r-1)]:void 0},KA=function(e,r){return he(r,function(s){return e[s]})},Ni=function(e){return e==null?[]:KA(e,Ad(e))},LA=function(e){return or(Ni(e))},bn=function(e){return(Va(e)?or:LA)(e)},xm=[],ym=function(e,r){return new WebSocket(e,r)},MA=Math.floor;N({target:"Number",stat:!0},{isInteger:function(e){return!ha(e)&&isFinite(e)&&MA(e)===e}}),Oo("from",Ej,Dj);var NA=function(e,r){for(var s=Array(arguments.length-1),d=0,f=2,_=!0;f<arguments.length;)s[d++]=arguments[f++];return new Promise(function(C,P){s[d]=function(x){if(_)if(_=!1,x)P(x);else{for(var B=Array(arguments.length-1),_t=0;_t<B.length;)B[_t++]=arguments[_t];C.apply(null,B)}};try{e.apply(r||null,s)}catch(x){_&&(_=!1,P(x))}})},OA=$a(function(e,r){r.length=function(f){var _=f.length;if(!_)return 0;for(var C=0;1<--_%4&&f.charAt(_)==="=";)++C;return Math.ceil(3*f.length)/4-C};var s=Array(64),d=Array(123);for(e=0;64>e;)d[s[e]=26>e?e+65:52>e?e+71:62>e?e-4:e-59|43]=e++;r.encode=function(f,_,C){for(var P,x=null,B=[],_t=0,ue=0;_<C;){var Wt=f[_++];switch(ue){case 0:B[_t++]=s[Wt>>2],P=(3&Wt)<<4,ue=1;break;case 1:B[_t++]=s[P|Wt>>4],P=(15&Wt)<<2,ue=2;break;case 2:B[_t++]=s[P|Wt>>6],B[_t++]=s[63&Wt],ue=0}8191<_t&&((x||(x=[])).push(String.fromCharCode.apply(String,B)),_t=0)}return ue&&(B[_t++]=s[P],B[_t++]=61,ue===1&&(B[_t++]=61)),x?(_t&&x.push(String.fromCharCode.apply(String,B.slice(0,_t))),x.join("")):String.fromCharCode.apply(String,B.slice(0,_t))},r.decode=function(f,_,C){for(var P,x=C,B=0,_t=0;_t<f.length;){var ue=f.charCodeAt(_t++);if(ue===61&&1<B)break;if((ue=d[ue])===void 0)throw Error("invalid encoding");switch(B){case 0:P=ue,B=1;break;case 1:_[C++]=P<<2|(48&ue)>>4,P=ue,B=2;break;case 2:_[C++]=(15&P)<<4|(60&ue)>>2,P=ue,B=3;break;case 3:_[C++]=(3&P)<<6|ue,B=0}}if(B===1)throw Error("invalid encoding");return C-x},r.test=function(f){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(f)}});yg.prototype.on=function(e,r,s){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:r,ctx:s||this}),this},yg.prototype.off=function(e,r){if(e===void 0)this._listeners={};else if(r===void 0)this._listeners[e]=[];else{e=this._listeners[e];for(var s=0;s<e.length;)e[s].fn===r?e.splice(s,1):++s}return this},yg.prototype.emit=function(e){var r=this._listeners[e];if(r){for(var s=[],d=1;d<arguments.length;)s.push(arguments[d++]);for(d=0;d<r.length;)r[d].fn.apply(r[d++].ctx,s)}return this};var PA=zm(zm),QA=function(c){try{var a=eval("quire".replace(/^/,"re"))(c);if(a&&(a.length||Object.keys(a).length))return a}catch(e){}return null},RA=$a(function(e,r){r.length=function(s){for(var d,f=0,_=0;_<s.length;++_)128>(d=s.charCodeAt(_))?f+=1:2048>d?f+=2:(64512&d)==55296&&(64512&s.charCodeAt(_+1))==56320?(++_,f+=4):f+=3;return f},r.read=function(s,d,f){if(1>f-d)return"";for(var _,C=null,P=[],x=0;d<f;)128>(_=s[d++])?P[x++]=_:191<_&&224>_?P[x++]=(31&_)<<6|63&s[d++]:239<_&&365>_?(_=((7&_)<<18|(63&s[d++])<<12|(63&s[d++])<<6|63&s[d++])-65536,P[x++]=55296+(_>>10),P[x++]=56320+(1023&_)):P[x++]=(15&_)<<12|(63&s[d++])<<6|63&s[d++],8191<x&&((C||(C=[])).push(String.fromCharCode.apply(String,P)),x=0);return C?(x&&C.push(String.fromCharCode.apply(String,P.slice(0,x))),C.join("")):String.fromCharCode.apply(String,P.slice(0,x))},r.write=function(s,d,f){for(var _,C,P=f,x=0;x<s.length;++x)128>(_=s.charCodeAt(x))?d[f++]=_:(2048>_?d[f++]=_>>6|192:((64512&_)==55296&&(64512&(C=s.charCodeAt(x+1)))==56320?(_=65536+((1023&_)<<10)+(1023&C),++x,d[f++]=_>>18|240,d[f++]=_>>12&63|128):d[f++]=_>>12|224,d[f++]=_>>6&63|128),d[f++]=63&_|128);return f-P}}),SA=function(e,r,s){var d=s||8192,f=d>>>1,_=null,C=d;return function(P){return 1>P||P>f?e(P):(C+P>d&&(_=e(d),C=0),P=r.call(_,C,C+=P),7&C&&(C=1+(7|C)),P)}},Xd=Wa.zero=new Wa(0,0);Xd.toNumber=function(){return 0},Xd.zzEncode=Xd.zzDecode=function(){return this},Xd.length=function(){return 1};var TA=Wa.zeroHash="\0\0\0\0\0\0\0\0";Wa.fromNumber=function(e){if(e===0)return Xd;var r=0>e;r&&(e=-e);var s=e>>>0;return e=(e-s)/4294967296>>>0,r&&(e=~e>>>0,s=~s>>>0,4294967295<++s&&(s=0,4294967295<++e&&(e=0))),new Wa(s,e)},Wa.from=function(e){if(typeof e=="number")return Wa.fromNumber(e);if(V.isString(e)){if(!V.Long)return Wa.fromNumber(parseInt(e,10));e=V.Long.fromString(e)}return e.low||e.high?new Wa(e.low>>>0,e.high>>>0):Xd},Wa.prototype.toNumber=function(e){if(!e&&this.hi>>>31){e=1+~this.lo>>>0;var r=~this.hi>>>0;return e||(r=r+1>>>0),-(e+4294967296*r)}return this.lo+4294967296*this.hi},Wa.prototype.toLong=function(e){return V.Long?new V.Long(0|this.lo,0|this.hi,!!e):{low:0|this.lo,high:0|this.hi,unsigned:!!e}};var td=String.prototype.charCodeAt;Wa.fromHash=function(e){return e===TA?Xd:new Wa((td.call(e,0)|td.call(e,1)<<8|td.call(e,2)<<16|td.call(e,3)<<24)>>>0,(td.call(e,4)|td.call(e,5)<<8|td.call(e,6)<<16|td.call(e,7)<<24)>>>0)},Wa.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},Wa.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this},Wa.prototype.zzDecode=function(){var e=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this},Wa.prototype.length=function(){var e=this.lo,r=(this.lo>>>28|this.hi<<4)>>>0,s=this.hi>>>24;return s===0?r===0?16384>e?128>e?1:2:2097152>e?3:4:16384>r?128>r?5:6:2097152>r?7:8:128>s?9:10};var V=$a(function(e,r){function s(f,_,C){for(var P=Object.keys(_),x=0;x<P.length;++x)f[P[x]]!==void 0&&C||(f[P[x]]=_[P[x]]);return f}function d(f){function _(C,P){if(!(this instanceof _))return new _(C,P);Object.defineProperty(this,"message",{get:function(){return C}}),Error.captureStackTrace?Error.captureStackTrace(this,_):Object.defineProperty(this,"stack",{value:Error().stack||""}),P&&s(this,P)}return(_.prototype=Object.create(Error.prototype)).constructor=_,Object.defineProperty(_.prototype,"name",{get:function(){return f}}),_.prototype.toString=function(){return this.name+": "+this.message},_}r.asPromise=NA,r.base64=OA,r.EventEmitter=yg,r.float=PA,r.inquire=QA,r.utf8=RA,r.pool=SA,r.LongBits=Wa,r.isNode=!!(Ya!==void 0&&Ya&&Ya.process&&Ya.process.versions&&Ya.process.versions.node),r.global=r.isNode&&Ya||typeof window<"u"&&window||typeof self<"u"&&self||Ya,r.emptyArray=Object.freeze?Object.freeze([]):[],r.emptyObject=Object.freeze?Object.freeze({}):{},r.isInteger=Number.isInteger||function(f){return typeof f=="number"&&isFinite(f)&&Math.floor(f)===f},r.isString=function(f){return typeof f=="string"||f instanceof String},r.isObject=function(f){return f&&X(f)==="object"},r.isset=r.isSet=function(f,_){var C=f[_];return!(C==null||!f.hasOwnProperty(_))&&(X(C)!=="object"||0<(Array.isArray(C)?C.length:Object.keys(C).length))},r.Buffer=function(){try{var f=r.inquire("buffer").Buffer;return f.prototype.utf8Write?f:null}catch{return null}}(),r._Buffer_from=null,r._Buffer_allocUnsafe=null,r.newBuffer=function(f){return typeof f=="number"?r.Buffer?r._Buffer_allocUnsafe(f):new r.Array(f):r.Buffer?r._Buffer_from(f):typeof Uint8Array>"u"?f:new Uint8Array(f)},r.Array=typeof Uint8Array<"u"?Uint8Array:Array,r.Long=r.global.dcodeIO&&r.global.dcodeIO.Long||r.global.Long||r.inquire("long"),r.key2Re=/^true|false|0|1$/,r.key32Re=/^-?(?:0|[1-9][0-9]*)$/,r.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,r.longToHash=function(f){return f?r.LongBits.from(f).toHash():r.LongBits.zeroHash},r.longFromHash=function(f,_){return f=r.LongBits.fromHash(f),r.Long?r.Long.fromBits(f.lo,f.hi,_):f.toNumber(!!_)},r.merge=s,r.lcFirst=function(f){return f.charAt(0).toLowerCase()+f.substring(1)},r.newError=d,r.ProtocolError=d("ProtocolError"),r.oneOfGetter=function(f){for(var _={},C=0;C<f.length;++C)_[f[C]]=1;return function(){for(var P=Object.keys(this),x=P.length-1;-1<x;--x)if(_[P[x]]===1&&this[P[x]]!==void 0&&this[P[x]]!==null)return P[x]}},r.oneOfSetter=function(f){return function(_){for(var C=0;C<f.length;++C)f[C]!==_&&delete this[f[C]]}},r.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},r._configure=function(){var f=r.Buffer;f?(r._Buffer_from=f.from!==Uint8Array.from&&f.from||function(_,C){return new f(_,C)},r._Buffer_allocUnsafe=f.allocUnsafe||function(_){return new f(_)}):r._Buffer_from=r._Buffer_allocUnsafe=null}}),xi=ja,el,Nh=V.LongBits,pr=V.base64,qr=V.utf8,rr=function(){return V.Buffer?function(){return(ja.create=function(){return new el})()}:function(){return new ja}};ja.create=rr(),ja.alloc=function(e){return new V.Array(e)},V.Array!==Array&&(ja.alloc=V.pool(ja.alloc,V.Array.prototype.subarray)),ja.prototype._push=function(e,r,s){return this.tail=this.tail.next=new sf(e,r,s),this.len+=r,this},ui.prototype=Object.create(sf.prototype),ui.prototype.fn=function(e,r,s){for(;127<e;)r[s++]=127&e|128,e>>>=7;r[s]=e},ja.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new ui(128>(e>>>=0)?1:16384>e?2:2097152>e?3:268435456>e?4:5,e)).len,this},ja.prototype.int32=function(e){return 0>e?this._push(vi,10,Nh.fromNumber(e)):this.uint32(e)},ja.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)},ja.prototype.uint64=function(e){return e=Nh.from(e),this._push(vi,e.length(),e)},ja.prototype.int64=ja.prototype.uint64,ja.prototype.sint64=function(e){return e=Nh.from(e).zzEncode(),this._push(vi,e.length(),e)},ja.prototype.bool=function(e){return this._push(ti,1,e?1:0)},ja.prototype.fixed32=function(e){return this._push(wi,4,e>>>0)},ja.prototype.sfixed32=ja.prototype.fixed32,ja.prototype.fixed64=function(e){return e=Nh.from(e),this._push(wi,4,e.lo)._push(wi,4,e.hi)},ja.prototype.sfixed64=ja.prototype.fixed64,ja.prototype.float=function(e){return this._push(V.float.writeFloatLE,4,e)},ja.prototype.double=function(e){return this._push(V.float.writeDoubleLE,8,e)};var UA=V.Array.prototype.set?function(e,r,s){r.set(e,s)}:function(e,r,s){for(var d=0;d<e.length;++d)r[s+d]=e[d]};ja.prototype.bytes=function(e){var r=e.length>>>0;if(!r)return this._push(ti,1,0);if(V.isString(e)){var s=ja.alloc(r=pr.length(e));pr.decode(e,s,0),e=s}return this.uint32(r)._push(UA,r,e)},ja.prototype.string=function(e){var r=qr.length(e);return r?this.uint32(r)._push(qr.write,r,e):this._push(ti,1,0)},ja.prototype.fork=function(){return this.states=new Tt(this),this.head=this.tail=new sf(si,0,0),this.len=0,this},ja.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new sf(si,0,0),this.len=0),this},ja.prototype.ldelim=function(){var e=this.head,r=this.tail,s=this.len;return this.reset().uint32(s),s&&(this.tail.next=e.next,this.tail=r,this.len+=s),this},ja.prototype.finish=function(){for(var e=this.head.next,r=this.constructor.alloc(this.len),s=0;e;)e.fn(e.val,r,s),s+=e.len,e=e.next;return r},ja._configure=function(e){el=e,ja.create=rr(),el._configure()},(jc.prototype=Object.create(xi.prototype)).constructor=jc,jc._configure=function(){jc.alloc=V._Buffer_allocUnsafe,jc.writeBytesBuffer=V.Buffer&&V.Buffer.prototype instanceof Uint8Array&&V.Buffer.prototype.set.name==="set"?function(e,r,s){r.set(e,s)}:function(e,r,s){if(e.copy)e.copy(r,s,0,e.length);else for(var d=0;d<e.length;)r[s++]=e[d++]}},jc.prototype.bytes=function(e){V.isString(e)&&(e=V._Buffer_from(e,"base64"));var r=e.length>>>0;return this.uint32(r),r&&this._push(jc.writeBytesBuffer,r,e),this},jc.prototype.string=function(e){var r=V.Buffer.byteLength(e);return this.uint32(r),r&&this._push(Ut,r,e),this},jc._configure();var zi=La,fl,Em=V.LongBits,VA=V.utf8,sr=typeof Uint8Array<"u"?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new La(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new La(e);throw Error("illegal buffer")},tr=function(){return V.Buffer?function(e){return(La.create=function(r){return V.Buffer.isBuffer(r)?new fl(r):sr(r)})(e)}:sr};La.create=tr(),La.prototype._slice=V.Array.prototype.subarray||V.Array.prototype.slice,La.prototype.uint32=function(){var e=4294967295;return function(){if(e=(127&this.buf[this.pos])>>>0,128>this.buf[this.pos++]||(e=(e|(127&this.buf[this.pos])<<7)>>>0,128>this.buf[this.pos++])||(e=(e|(127&this.buf[this.pos])<<14)>>>0,128>this.buf[this.pos++])||(e=(e|(127&this.buf[this.pos])<<21)>>>0,128>this.buf[this.pos++])||(e=(e|(15&this.buf[this.pos])<<28)>>>0,128>this.buf[this.pos++]))return e;if((this.pos+=5)>this.len)throw this.pos=this.len,Yb(this,10);return e}}(),La.prototype.int32=function(){return 0|this.uint32()},La.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(1&e)|0},La.prototype.bool=function(){return this.uint32()!==0},La.prototype.fixed32=function(){if(this.pos+4>this.len)throw Yb(this,4);return zg(this.buf,this.pos+=4)},La.prototype.sfixed32=function(){if(this.pos+4>this.len)throw Yb(this,4);return 0|zg(this.buf,this.pos+=4)},La.prototype.float=function(){if(this.pos+4>this.len)throw Yb(this,4);var e=V.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e},La.prototype.double=function(){if(this.pos+8>this.len)throw Yb(this,4);var e=V.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e},La.prototype.bytes=function(){var e=this.uint32(),r=this.pos,s=this.pos+e;if(s>this.len)throw Yb(this,e);return this.pos+=e,Array.isArray(this.buf)?this.buf.slice(r,s):r===s?new this.buf.constructor(0):this._slice.call(this.buf,r,s)},La.prototype.string=function(){var e=this.bytes();return VA.read(e,0,e.length)},La.prototype.skip=function(e){if(typeof e=="number"){if(this.pos+e>this.len)throw Yb(this,e);this.pos+=e}else do if(this.pos>=this.len)throw Yb(this);while(128&this.buf[this.pos++]);return this},La.prototype.skipType=function(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(e=7&this.uint32())!=4;)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+e+" at offset "+this.pos)}return this},La._configure=function(e){fl=e,La.create=tr(),fl._configure();var r=V.Long?"toLong":"toNumber";V.merge(La.prototype,{int64:function(){return yi.call(this)[r](!1)},uint64:function(){return yi.call(this)[r](!0)},sint64:function(){return yi.call(this).zzDecode()[r](!1)},fixed64:function(){return Fm.call(this)[r](!0)},sfixed64:function(){return Fm.call(this)[r](!1)}})},(Fd.prototype=Object.create(zi.prototype)).constructor=Fd,Fd._configure=function(){V.Buffer&&(Fd.prototype._slice=V.Buffer.prototype.slice)},Fd.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))},Fd._configure(),(tf.prototype=Object.create(V.EventEmitter.prototype)).constructor=tf,tf.prototype.rpcCall=function e(r,s,d,f,_){if(!f)throw TypeError("request must be specified");var C=this;if(!_)return V.asPromise(e,C,r,s,d,f);if(C.rpcImpl)try{return C.rpcImpl(r,s[C.requestDelimited?"encodeDelimited":"encode"](f).finish(),function(P,x){if(P)return C.emit("error",P,r),_(P);if(x!==null){if(!(x instanceof d))try{x=d[C.responseDelimited?"decodeDelimited":"decode"](x)}catch(B){return C.emit("error",B,r),_(B)}return C.emit("data",x,r),_(null,x)}C.end(!0)})}catch(P){C.emit("error",P,r),setTimeout(function(){_(P)},0)}else setTimeout(function(){_(Error("already ended"))},0)},tf.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this};var WA=$a(function(e,r){r.Service=tf}),XA={},fc=$a(function(e,r){function s(){d.util._configure(),d.Writer._configure(d.BufferWriter),d.Reader._configure(d.BufferReader)}var d=r;d.build="minimal",d.Writer=xi,d.BufferWriter=jc,d.Reader=zi,d.BufferReader=Fd,d.util=V,d.rpc=WA,d.roots=XA,d.configure=s,s()});fc.util.Long=U,fc.configure();var u=fc.Reader,L=fc.Writer,q=fc.util,t=fc.roots.default||(fc.roots.default={}),YA=t.URI=function(){var e={},r=Object.create(e);return r[e[0]="Unknown"]=0,r[e[1]="PingUri"]=1,r[e[2]="PongUri"]=2,r[e[11]="UserJoinUri"]=11,r[e[12]="UserRespUri"]=12,r[e[21]="UserQuitUri"]=21,r[e[22]="UserDropUri"]=22,r[e[31]="GroupEnterUri"]=31,r[e[32]="GroupLeaveUri"]=32,r[e[33]="GroupReplyUri"]=33,r[e[36]="GroupEnterNoticeUri"]=36,r[e[37]="GroupLeaveNoticeUri"]=37,r[e[38]="GroupEventNoticeUri"]=38,r[e[39]="GroupCountNoticeUri"]=39,r[e[41]="UserStatusListUri"]=41,r[e[42]="UserStatusResultUri"]=42,r[e[51]="GroupStatusListUri"]=51,r[e[52]="GroupStatusResultUri"]=52,r[e[55]="GroupAllUsersListUri"]=55,r[e[56]="GroupAllUsersResultUri"]=56,r[e[100]="MessageUri"]=100,r[e[101]="AckUri"]=101,r[e[115]="FileUploadIndexGetUri"]=115,r[e[116]="FileUploadIndexRetUri"]=116,r[e[117]="FileUploadIndexSetUri"]=117,r[e[118]="FileUploadIndexFinUri"]=118,r[e[119]="FileUploadIndexErrUri"]=119,r[e[125]="FileDownloadIndexGetUri"]=125,r[e[126]="FileDownloadIndexRetUri"]=126,r[e[127]="FileDownloadIndexErrUri"]=127,r[e[201]="UserJoinNoticeUri"]=201,r[e[202]="UserQuitNoticeUri"]=202,r[e[203]="UserWaitNoticeUri"]=203,r[e[301]="UserAttributeGetUri"]=301,r[e[302]="UserAttributeRetUri"]=302,r[e[303]="UserAttributeSetUri"]=303,r[e[304]="UserAttributeModUri"]=304,r[e[305]="UserAttributeDelUri"]=305,r[e[307]="UserAttributeRspUri"]=307,r[e[308]="UserAttributeErrUri"]=308,r[e[311]="UserAttributeKeysGetUri"]=311,r[e[312]="UserAttributeKeysRetUri"]=312,r[e[351]="GroupAttributeGetUri"]=351,r[e[352]="GroupAttributeRetUri"]=352,r[e[353]="GroupAttributeSetUri"]=353,r[e[354]="GroupAttributeModUri"]=354,r[e[355]="GroupAttributeDelUri"]=355,r[e[356]="GroupAttributeAltUri"]=356,r[e[357]="GroupAttributeRspUri"]=357,r[e[358]="GroupAttributeErrUri"]=358,r[e[361]="GroupAttributeKeysGetUri"]=361,r[e[362]="GroupAttributeKeysRetUri"]=362,r[e[401]="SubscribeUserStatusUri"]=401,r[e[402]="UnsubscribeUserStatusUri"]=402,r[e[499]="SubscribeResponseUri"]=499,r}(),Oh=t.Wrapper=function(){function e(r){if(r)for(var s=Object.keys(r),d=0;d<s.length;++d)r[s[d]]!=null&&(this[s[d]]=r[s[d]])}return e.prototype.uri=0,e.prototype.data=q.newBuffer([]),e.encode=function(r,s){return s||(s=L.create()),r.uri!=null&&Object.hasOwnProperty.call(r,"uri")&&s.uint32(8).int32(r.uri),r.data!=null&&Object.hasOwnProperty.call(r,"data")&&s.uint32(18).bytes(r.data),s},e.decode=function(r,s){r instanceof u||(r=u.create(r)),s=s===void 0?r.len:r.pos+s;for(var d=new t.Wrapper;r.pos<s;){var f=r.uint32();switch(f>>>3){case 1:d.uri=r.int32();break;case 2:d.data=r.bytes();break;default:r.skipType(7&f)}}return d},e}(),ZA=t.Ping=function(){function e(r){if(r)for(var s=Object.keys(r),d=0;d<s.length;++d)r[s[d]]!=null&&(this[s[d]]=r[s[d]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.ms=q.Long?q.Long.fromBits(0,0,!0):0,e.encode=function(r,s){return s||(s=L.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&s.uint32(8).uint64(r.seq),r.ms!=null&&Object.hasOwnProperty.call(r,"ms")&&s.uint32(16).uint64(r.ms),s},e.decode=function(r,s){r instanceof u||(r=u.create(r)),s=s===void 0?r.len:r.pos+s;for(var d=new t.Ping;r.pos<s;){var f=r.uint32();switch(f>>>3){case 1:d.seq=r.uint64();break;case 2:d.ms=r.uint64();break;default:r.skipType(7&f)}}return d},e}(),$A=t.Pong=function(){function e(r){if(r)for(var s=Object.keys(r),d=0;d<s.length;++d)r[s[d]]!=null&&(this[s[d]]=r[s[d]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.ms=q.Long?q.Long.fromBits(0,0,!0):0,e.encode=function(r,s){return s||(s=L.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&s.uint32(8).uint64(r.seq),r.ms!=null&&Object.hasOwnProperty.call(r,"ms")&&s.uint32(16).uint64(r.ms),s},e.decode=function(r,s){r instanceof u||(r=u.create(r)),s=s===void 0?r.len:r.pos+s;for(var d=new t.Pong;r.pos<s;){var f=r.uint32();switch(f>>>3){case 1:d.seq=r.uint64();break;case 2:d.ms=r.uint64();break;default:r.skipType(7&f)}}return d},e}(),aB=t.UserJoin=function(){function e(r){if(r)for(var s=Object.keys(r),d=0;d<s.length;++d)r[s[d]]!=null&&(this[s[d]]=r[s[d]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.opt=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.account="",e.prototype.ticket="",e.encode=function(r,s){return s||(s=L.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&s.uint32(8).uint64(r.seq),r.opt!=null&&Object.hasOwnProperty.call(r,"opt")&&s.uint32(16).uint64(r.opt),r.instance!=null&&Object.hasOwnProperty.call(r,"instance")&&s.uint32(24).uint64(r.instance),r.account!=null&&Object.hasOwnProperty.call(r,"account")&&s.uint32(34).string(r.account),r.ticket!=null&&Object.hasOwnProperty.call(r,"ticket")&&s.uint32(42).string(r.ticket),s},e.decode=function(r,s){r instanceof u||(r=u.create(r)),s=s===void 0?r.len:r.pos+s;for(var d=new t.UserJoin;r.pos<s;){var f=r.uint32();switch(f>>>3){case 1:d.seq=r.uint64();break;case 2:d.opt=r.uint64();break;case 3:d.instance=r.uint64();break;case 4:d.account=r.string();break;case 5:d.ticket=r.string();break;default:r.skipType(7&f)}}return d},e}(),bB=t.UserResp=function(){function e(r){if(r)for(var s=Object.keys(r),d=0;d<s.length;++d)r[s[d]]!=null&&(this[s[d]]=r[s[d]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.account="",e.prototype.code=0,e.encode=function(r,s){return s||(s=L.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&s.uint32(8).uint64(r.seq),r.account!=null&&Object.hasOwnProperty.call(r,"account")&&s.uint32(18).string(r.account),r.code!=null&&Object.hasOwnProperty.call(r,"code")&&s.uint32(24).uint32(r.code),s},e.decode=function(r,s){r instanceof u||(r=u.create(r)),s=s===void 0?r.len:r.pos+s;for(var d=new t.UserResp;r.pos<s;){var f=r.uint32();switch(f>>>3){case 1:d.seq=r.uint64();break;case 2:d.account=r.string();break;case 3:d.code=r.uint32();break;default:r.skipType(7&f)}}return d},e}(),cB=t.UserQuit=function(){function e(r){if(r)for(var s=Object.keys(r),d=0;d<s.length;++d)r[s[d]]!=null&&(this[s[d]]=r[s[d]])}return e.encode=function(r,s){return s||(s=L.create()),s},e.decode=function(r,s){r instanceof u||(r=u.create(r)),s=s===void 0?r.len:r.pos+s;for(var d=new t.UserQuit;r.pos<s;){var f=r.uint32();r.skipType(7&f)}return d},e}(),dB=t.UserDrop=function(){function e(r){if(r)for(var s=Object.keys(r),d=0;d<s.length;++d)r[s[d]]!=null&&(this[s[d]]=r[s[d]])}return e.prototype.code=0,e.encode=function(r,s){return s||(s=L.create()),r.code!=null&&Object.hasOwnProperty.call(r,"code")&&s.uint32(8).uint32(r.code),s},e.decode=function(r,s){r instanceof u||(r=u.create(r)),s=s===void 0?r.len:r.pos+s;for(var d=new t.UserDrop;r.pos<s;){var f=r.uint32();switch(f>>>3){case 1:d.code=r.uint32();break;default:r.skipType(7&f)}}return d},e}(),eB=t.GroupEnter=function(){function e(r){if(r)for(var s=Object.keys(r),d=0;d<s.length;++d)r[s[d]]!=null&&(this[s[d]]=r[s[d]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.account="",e.encode=function(r,s){return s||(s=L.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&s.uint32(8).uint64(r.seq),r.account!=null&&Object.hasOwnProperty.call(r,"account")&&s.uint32(18).string(r.account),s},e.decode=function(r,s){r instanceof u||(r=u.create(r)),s=s===void 0?r.len:r.pos+s;for(var d=new t.GroupEnter;r.pos<s;){var f=r.uint32();switch(f>>>3){case 1:d.seq=r.uint64();break;case 2:d.account=r.string();break;default:r.skipType(7&f)}}return d},e}(),fB=t.GroupLeave=function(){function e(r){if(r)for(var s=Object.keys(r),d=0;d<s.length;++d)r[s[d]]!=null&&(this[s[d]]=r[s[d]])}return e.prototype.account="",e.encode=function(r,s){return s||(s=L.create()),r.account!=null&&Object.hasOwnProperty.call(r,"account")&&s.uint32(10).string(r.account),s},e.decode=function(r,s){r instanceof u||(r=u.create(r)),s=s===void 0?r.len:r.pos+s;for(var d=new t.GroupLeave;r.pos<s;){var f=r.uint32();switch(f>>>3){case 1:d.account=r.string();break;default:r.skipType(7&f)}}return d},e}(),gB=t.GroupReply=function(){function e(r){if(r)for(var s=Object.keys(r),d=0;d<s.length;++d)r[s[d]]!=null&&(this[s[d]]=r[s[d]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.account="",e.prototype.code=0,e.encode=function(r,s){return s||(s=L.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&s.uint32(8).uint64(r.seq),r.account!=null&&Object.hasOwnProperty.call(r,"account")&&s.uint32(18).string(r.account),r.code!=null&&Object.hasOwnProperty.call(r,"code")&&s.uint32(24).uint32(r.code),s},e.decode=function(r,s){r instanceof u||(r=u.create(r)),s=s===void 0?r.len:r.pos+s;for(var d=new t.GroupReply;r.pos<s;){var f=r.uint32();switch(f>>>3){case 1:d.seq=r.uint64();break;case 2:d.account=r.string();break;case 3:d.code=r.uint32();break;default:r.skipType(7&f)}}return d},e}(),ur=t.GroupLeaveNotice=function(){function e(r){if(r)for(var s=Object.keys(r),d=0;d<s.length;++d)r[s[d]]!=null&&(this[s[d]]=r[s[d]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.user="",e.prototype.group="",e.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.size=0,e.encode=function(r,s){return s||(s=L.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&s.uint32(8).uint64(r.seq),r.user!=null&&Object.hasOwnProperty.call(r,"user")&&s.uint32(18).string(r.user),r.group!=null&&Object.hasOwnProperty.call(r,"group")&&s.uint32(26).string(r.group),r.instance!=null&&Object.hasOwnProperty.call(r,"instance")&&s.uint32(32).uint64(r.instance),r.size!=null&&Object.hasOwnProperty.call(r,"size")&&s.uint32(40).uint32(r.size),s},e.decode=function(r,s){r instanceof u||(r=u.create(r)),s=s===void 0?r.len:r.pos+s;for(var d=new t.GroupLeaveNotice;r.pos<s;){var f=r.uint32();switch(f>>>3){case 1:d.seq=r.uint64();break;case 2:d.user=r.string();break;case 3:d.group=r.string();break;case 4:d.instance=r.uint64();break;case 5:d.size=r.uint32();break;default:r.skipType(7&f)}}return d},e}(),vr=t.GroupEnterNotice=function(){function e(r){if(r)for(var s=Object.keys(r),d=0;d<s.length;++d)r[s[d]]!=null&&(this[s[d]]=r[s[d]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.user="",e.prototype.group="",e.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.size=0,e.encode=function(r,s){return s||(s=L.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&s.uint32(8).uint64(r.seq),r.user!=null&&Object.hasOwnProperty.call(r,"user")&&s.uint32(18).string(r.user),r.group!=null&&Object.hasOwnProperty.call(r,"group")&&s.uint32(26).string(r.group),r.instance!=null&&Object.hasOwnProperty.call(r,"instance")&&s.uint32(32).uint64(r.instance),r.size!=null&&Object.hasOwnProperty.call(r,"size")&&s.uint32(40).uint32(r.size),s},e.decode=function(r,s){r instanceof u||(r=u.create(r)),s=s===void 0?r.len:r.pos+s;for(var d=new t.GroupEnterNotice;r.pos<s;){var f=r.uint32();switch(f>>>3){case 1:d.seq=r.uint64();break;case 2:d.user=r.string();break;case 3:d.group=r.string();break;case 4:d.instance=r.uint64();break;case 5:d.size=r.uint32();break;default:r.skipType(7&f)}}return d},e}(),wr=t.Message=function(){function e(r){if(this.MiscMap={},r)for(var s=Object.keys(r),d=0;d<s.length;++d)r[s[d]]!=null&&(this[s[d]]=r[s[d]])}return e.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.dialogue=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.sequence=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.options=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.src="",e.prototype.dst="",e.prototype.payload=q.newBuffer([]),e.prototype.MiscMap=q.emptyObject,e.prototype.ms=q.Long?q.Long.fromBits(0,0,!0):0,e.encode=function(r,s){if(s||(s=L.create()),r.instance!=null&&Object.hasOwnProperty.call(r,"instance")&&s.uint32(8).uint64(r.instance),r.dialogue!=null&&Object.hasOwnProperty.call(r,"dialogue")&&s.uint32(16).uint64(r.dialogue),r.sequence!=null&&Object.hasOwnProperty.call(r,"sequence")&&s.uint32(24).uint64(r.sequence),r.options!=null&&Object.hasOwnProperty.call(r,"options")&&s.uint32(32).uint64(r.options),r.src!=null&&Object.hasOwnProperty.call(r,"src")&&s.uint32(42).string(r.src),r.dst!=null&&Object.hasOwnProperty.call(r,"dst")&&s.uint32(50).string(r.dst),r.payload!=null&&Object.hasOwnProperty.call(r,"payload")&&s.uint32(58).bytes(r.payload),r.MiscMap!=null&&Object.hasOwnProperty.call(r,"MiscMap"))for(var d=Object.keys(r.MiscMap),f=0;f<d.length;++f)s.uint32(66).fork().uint32(10).string(d[f]).uint32(18).bytes(r.MiscMap[d[f]]).ldelim();return r.ms!=null&&Object.hasOwnProperty.call(r,"ms")&&s.uint32(72).uint64(r.ms),s},e.decode=function(r,s){r instanceof u||(r=u.create(r)),s=s===void 0?r.len:r.pos+s;for(var d,f,_=new t.Message;r.pos<s;)switch(d=r.uint32(),d>>>3){case 1:_.instance=r.uint64();break;case 2:_.dialogue=r.uint64();break;case 3:_.sequence=r.uint64();break;case 4:_.options=r.uint64();break;case 5:_.src=r.string();break;case 6:_.dst=r.string();break;case 7:_.payload=r.bytes();break;case 8:_.MiscMap===q.emptyObject&&(_.MiscMap={});var C=r.uint32()+r.pos;for(d="",f=[];r.pos<C;){var P=r.uint32();switch(P>>>3){case 1:d=r.string();break;case 2:f=r.bytes();break;default:r.skipType(7&P)}}_.MiscMap[d]=f;break;case 9:_.ms=r.uint64();break;default:r.skipType(7&d)}return _},e}(),xr=t.Ack=function(){function e(r){if(r)for(var s=Object.keys(r),d=0;d<s.length;++d)r[s[d]]!=null&&(this[s[d]]=r[s[d]])}return e.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.dialogue=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.sequence=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.code=0,e.encode=function(r,s){return s||(s=L.create()),r.instance!=null&&Object.hasOwnProperty.call(r,"instance")&&s.uint32(8).uint64(r.instance),r.dialogue!=null&&Object.hasOwnProperty.call(r,"dialogue")&&s.uint32(16).uint64(r.dialogue),r.sequence!=null&&Object.hasOwnProperty.call(r,"sequence")&&s.uint32(24).uint64(r.sequence),r.code!=null&&Object.hasOwnProperty.call(r,"code")&&s.uint32(32).uint32(r.code),s},e.decode=function(r,s){r instanceof u||(r=u.create(r)),s=s===void 0?r.len:r.pos+s;for(var d=new t.Ack;r.pos<s;){var f=r.uint32();switch(f>>>3){case 1:d.instance=r.uint64();break;case 2:d.dialogue=r.uint64();break;case 3:d.sequence=r.uint64();break;case 4:d.code=r.uint32();break;default:r.skipType(7&f)}}return d},e}(),hB=t.FileUploadIndexGet=function(){function e(r){if(r)for(var s=Object.keys(r),d=0;d<s.length;++d)r[s[d]]!=null&&(this[s[d]]=r[s[d]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.hash=q.newBuffer([]),e.prototype.size=0,e.encode=function(r,s){return s||(s=L.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&s.uint32(8).uint64(r.seq),r.hash!=null&&Object.hasOwnProperty.call(r,"hash")&&s.uint32(18).bytes(r.hash),r.size!=null&&Object.hasOwnProperty.call(r,"size")&&s.uint32(24).uint32(r.size),s},e.decode=function(r,s){r instanceof u||(r=u.create(r)),s=s===void 0?r.len:r.pos+s;for(var d=new t.FileUploadIndexGet;r.pos<s;){var f=r.uint32();switch(f>>>3){case 1:d.seq=r.uint64();break;case 2:d.hash=r.bytes();break;case 3:d.size=r.uint32();break;default:r.skipType(7&f)}}return d},e}(),iB=t.FileUploadIndexRet=function(){function e(r){if(this.servers=[],r)for(var s=Object.keys(r),d=0;d<s.length;++d)r[s[d]]!=null&&(this[s[d]]=r[s[d]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.unit=0,e.prototype.servers=q.emptyArray,e.encode=function(r,s){if(s||(s=L.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&s.uint32(8).uint64(r.seq),r.unit!=null&&Object.hasOwnProperty.call(r,"unit")&&s.uint32(16).uint32(r.unit),r.servers!=null&&r.servers.length){s.uint32(26).fork();for(var d=0;d<r.servers.length;++d)s.uint32(r.servers[d]);s.ldelim()}return s},e.decode=function(r,s){r instanceof u||(r=u.create(r)),s=s===void 0?r.len:r.pos+s;for(var d=new t.FileUploadIndexRet;r.pos<s;){var f=r.uint32();switch(f>>>3){case 1:d.seq=r.uint64();break;case 2:d.unit=r.uint32();break;case 3:if(d.servers&&d.servers.length||(d.servers=[]),(7&f)==2)for(f=r.uint32()+r.pos;r.pos<f;)d.servers.push(r.uint32());else d.servers.push(r.uint32());break;default:r.skipType(7&f)}}return d},e}(),jB=t.FileUploadIndexSet=function(){function e(r){if(this.servers=[],r)for(var s=Object.keys(r),d=0;d<s.length;++d)r[s[d]]!=null&&(this[s[d]]=r[s[d]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.hash=q.newBuffer([]),e.prototype.unit=0,e.prototype.servers=q.emptyArray,e.encode=function(r,s){if(s||(s=L.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&s.uint32(8).uint64(r.seq),r.hash!=null&&Object.hasOwnProperty.call(r,"hash")&&s.uint32(18).bytes(r.hash),r.unit!=null&&Object.hasOwnProperty.call(r,"unit")&&s.uint32(24).uint32(r.unit),r.servers!=null&&r.servers.length){s.uint32(34).fork();for(var d=0;d<r.servers.length;++d)s.uint32(r.servers[d]);s.ldelim()}return s},e.decode=function(r,s){r instanceof u||(r=u.create(r)),s=s===void 0?r.len:r.pos+s;for(var d=new t.FileUploadIndexSet;r.pos<s;){var f=r.uint32();switch(f>>>3){case 1:d.seq=r.uint64();break;case 2:d.hash=r.bytes();break;case 3:d.unit=r.uint32();break;case 4:if(d.servers&&d.servers.length||(d.servers=[]),(7&f)==2)for(f=r.uint32()+r.pos;r.pos<f;)d.servers.push(r.uint32());else d.servers.push(r.uint32());break;default:r.skipType(7&f)}}return d},e}(),kB=t.FileUploadIndexFin=function(){function e(r){if(r)for(var s=Object.keys(r),d=0;d<s.length;++d)r[s[d]]!=null&&(this[s[d]]=r[s[d]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.zone=0,e.prototype.unit=0,e.encode=function(r,s){return s||(s=L.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&s.uint32(8).uint64(r.seq),r.zone!=null&&Object.hasOwnProperty.call(r,"zone")&&s.uint32(16).uint32(r.zone),r.unit!=null&&Object.hasOwnProperty.call(r,"unit")&&s.uint32(24).uint32(r.unit),s},e.decode=function(r,s){r instanceof u||(r=u.create(r)),s=s===void 0?r.len:r.pos+s;for(var d=new t.FileUploadIndexFin;r.pos<s;){var f=r.uint32();switch(f>>>3){case 1:d.seq=r.uint64();break;case 2:d.zone=r.uint32();break;case 3:d.unit=r.uint32();break;default:r.skipType(7&f)}}return d},e}(),lB=t.FileUploadIndexErr=function(){function e(r){if(r)for(var s=Object.keys(r),d=0;d<s.length;++d)r[s[d]]!=null&&(this[s[d]]=r[s[d]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.code=0,e.encode=function(r,s){return s||(s=L.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&s.uint32(8).uint64(r.seq),r.code!=null&&Object.hasOwnProperty.call(r,"code")&&s.uint32(16).uint32(r.code),s},e.decode=function(r,s){r instanceof u||(r=u.create(r)),s=s===void 0?r.len:r.pos+s;for(var d=new t.FileUploadIndexErr;r.pos<s;){var f=r.uint32();switch(f>>>3){case 1:d.seq=r.uint64();break;case 2:d.code=r.uint32();break;default:r.skipType(7&f)}}return d},e}(),mB=t.FileDownloadIndexGet=function(){function e(r){if(r)for(var s=Object.keys(r),d=0;d<s.length;++d)r[s[d]]!=null&&(this[s[d]]=r[s[d]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.zone=0,e.prototype.hash=q.newBuffer([]),e.prototype.size=0,e.prototype.unit=0,e.encode=function(r,s){return s||(s=L.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&s.uint32(8).uint64(r.seq),r.zone!=null&&Object.hasOwnProperty.call(r,"zone")&&s.uint32(16).uint32(r.zone),r.hash!=null&&Object.hasOwnProperty.call(r,"hash")&&s.uint32(26).bytes(r.hash),r.size!=null&&Object.hasOwnProperty.call(r,"size")&&s.uint32(32).uint32(r.size),r.unit!=null&&Object.hasOwnProperty.call(r,"unit")&&s.uint32(40).uint32(r.unit),s},e.decode=function(r,s){r instanceof u||(r=u.create(r)),s=s===void 0?r.len:r.pos+s;for(var d=new t.FileDownloadIndexGet;r.pos<s;){var f=r.uint32();switch(f>>>3){case 1:d.seq=r.uint64();break;case 2:d.zone=r.uint32();break;case 3:d.hash=r.bytes();break;case 4:d.size=r.uint32();break;case 5:d.unit=r.uint32();break;default:r.skipType(7&f)}}return d},e}(),nB=t.FileDownloadIndexRet=function(){function e(r){if(this.servers=[],this.backups=[],r)for(var s=Object.keys(r),d=0;d<s.length;++d)r[s[d]]!=null&&(this[s[d]]=r[s[d]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.unit=0,e.prototype.zone=0,e.prototype.servers=q.emptyArray,e.prototype.backups=q.emptyArray,e.encode=function(r,s){if(s||(s=L.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&s.uint32(8).uint64(r.seq),r.unit!=null&&Object.hasOwnProperty.call(r,"unit")&&s.uint32(16).uint32(r.unit),r.zone!=null&&Object.hasOwnProperty.call(r,"zone")&&s.uint32(24).uint32(r.zone),r.servers!=null&&r.servers.length){s.uint32(34).fork();for(var d=0;d<r.servers.length;++d)s.uint32(r.servers[d]);s.ldelim()}if(r.backups!=null&&r.backups.length){for(s.uint32(42).fork(),d=0;d<r.backups.length;++d)s.uint32(r.backups[d]);s.ldelim()}return s},e.decode=function(r,s){r instanceof u||(r=u.create(r)),s=s===void 0?r.len:r.pos+s;for(var d=new t.FileDownloadIndexRet;r.pos<s;){var f=r.uint32();switch(f>>>3){case 1:d.seq=r.uint64();break;case 2:d.unit=r.uint32();break;case 3:d.zone=r.uint32();break;case 4:if(d.servers&&d.servers.length||(d.servers=[]),(7&f)==2)for(f=r.uint32()+r.pos;r.pos<f;)d.servers.push(r.uint32());else d.servers.push(r.uint32());break;case 5:if(d.backups&&d.backups.length||(d.backups=[]),(7&f)==2)for(f=r.uint32()+r.pos;r.pos<f;)d.backups.push(r.uint32());else d.backups.push(r.uint32());break;default:r.skipType(7&f)}}return d},e}(),oB=t.FileDownloadIndexErr=function(){function e(r){if(r)for(var s=Object.keys(r),d=0;d<s.length;++d)r[s[d]]!=null&&(this[s[d]]=r[s[d]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.code=0,e.encode=function(r,s){return s||(s=L.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&s.uint32(8).uint64(r.seq),r.code!=null&&Object.hasOwnProperty.call(r,"code")&&s.uint32(16).uint32(r.code),s},e.decode=function(r,s){r instanceof u||(r=u.create(r)),s=s===void 0?r.len:r.pos+s;for(var d=new t.FileDownloadIndexErr;r.pos<s;){var f=r.uint32();switch(f>>>3){case 1:d.seq=r.uint64();break;case 2:d.code=r.uint32();break;default:r.skipType(7&f)}}return d},e}(),pB=t.GroupAllUsersList=function(){function e(r){if(r)for(var s=Object.keys(r),d=0;d<s.length;++d)r[s[d]]!=null&&(this[s[d]]=r[s[d]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.group="",e.prototype.pageSize=0,e.prototype.pageNumber=0,e.encode=function(r,s){return s||(s=L.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&s.uint32(8).uint64(r.seq),r.group!=null&&Object.hasOwnProperty.call(r,"group")&&s.uint32(18).string(r.group),r.pageSize!=null&&Object.hasOwnProperty.call(r,"pageSize")&&s.uint32(24).uint32(r.pageSize),r.pageNumber!=null&&Object.hasOwnProperty.call(r,"pageNumber")&&s.uint32(32).uint32(r.pageNumber),s},e.decode=function(r,s){r instanceof u||(r=u.create(r)),s=s===void 0?r.len:r.pos+s;for(var d=new t.GroupAllUsersList;r.pos<s;){var f=r.uint32();switch(f>>>3){case 1:d.seq=r.uint64();break;case 2:d.group=r.string();break;case 3:d.pageSize=r.uint32();break;case 4:d.pageNumber=r.uint32();break;default:r.skipType(7&f)}}return d},e}(),qB=t.GroupAllUsersResult=function(){function e(r){if(this.memberInfos=[],r)for(var s=Object.keys(r),d=0;d<s.length;++d)r[s[d]]!=null&&(this[s[d]]=r[s[d]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.group="",e.prototype.totalSize=0,e.prototype.pageSize=0,e.prototype.pageNumber=0,e.prototype.memberInfos=q.emptyArray,e.encode=function(r,s){if(s||(s=L.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&s.uint32(8).uint64(r.seq),r.group!=null&&Object.hasOwnProperty.call(r,"group")&&s.uint32(18).string(r.group),r.totalSize!=null&&Object.hasOwnProperty.call(r,"totalSize")&&s.uint32(24).uint32(r.totalSize),r.pageSize!=null&&Object.hasOwnProperty.call(r,"pageSize")&&s.uint32(32).uint32(r.pageSize),r.pageNumber!=null&&Object.hasOwnProperty.call(r,"pageNumber")&&s.uint32(40).uint32(r.pageNumber),r.memberInfos!=null&&r.memberInfos.length)for(var d=0;d<r.memberInfos.length;++d)t.GroupAllUsersResult.MemberInfo.encode(r.memberInfos[d],s.uint32(50).fork()).ldelim();return s},e.decode=function(r,s){r instanceof u||(r=u.create(r)),s=s===void 0?r.len:r.pos+s;for(var d=new t.GroupAllUsersResult;r.pos<s;){var f=r.uint32();switch(f>>>3){case 1:d.seq=r.uint64();break;case 2:d.group=r.string();break;case 3:d.totalSize=r.uint32();break;case 4:d.pageSize=r.uint32();break;case 5:d.pageNumber=r.uint32();break;case 6:d.memberInfos&&d.memberInfos.length||(d.memberInfos=[]),d.memberInfos.push(t.GroupAllUsersResult.MemberInfo.decode(r,r.uint32()));break;default:r.skipType(7&f)}}return d},e.MemberInfo=function(){function r(s){if(s)for(var d=Object.keys(s),f=0;f<d.length;++f)s[d[f]]!=null&&(this[d[f]]=s[d[f]])}return r.prototype.account="",r.prototype.ts=0,r.encode=function(s,d){return d||(d=L.create()),s.account!=null&&Object.hasOwnProperty.call(s,"account")&&d.uint32(10).string(s.account),s.ts!=null&&Object.hasOwnProperty.call(s,"ts")&&d.uint32(16).uint32(s.ts),d},r.decode=function(s,d){s instanceof u||(s=u.create(s)),d=d===void 0?s.len:s.pos+d;for(var f=new t.GroupAllUsersResult.MemberInfo;s.pos<d;){var _=s.uint32();switch(_>>>3){case 1:f.account=s.string();break;case 2:f.ts=s.uint32();break;default:s.skipType(7&_)}}return f},r}(),e}(),rB=t.UserStatusList=function(){function e(r){if(this.users=[],r)for(var s=Object.keys(r),d=0;d<s.length;++d)r[s[d]]!=null&&(this[s[d]]=r[s[d]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.users=q.emptyArray,e.encode=function(r,s){if(s||(s=L.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&s.uint32(8).uint64(r.seq),r.users!=null&&r.users.length)for(var d=0;d<r.users.length;++d)s.uint32(18).string(r.users[d]);return s},e.decode=function(r,s){r instanceof u||(r=u.create(r)),s=s===void 0?r.len:r.pos+s;for(var d=new t.UserStatusList;r.pos<s;){var f=r.uint32();switch(f>>>3){case 1:d.seq=r.uint64();break;case 2:d.users&&d.users.length||(d.users=[]),d.users.push(r.string());break;default:r.skipType(7&f)}}return d},e}(),sB=t.UserStatusResult=function(){function e(r){if(this.userInfos=[],r)for(var s=Object.keys(r),d=0;d<s.length;++d)r[s[d]]!=null&&(this[s[d]]=r[s[d]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.userInfos=q.emptyArray,e.encode=function(r,s){if(s||(s=L.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&s.uint32(8).uint64(r.seq),r.userInfos!=null&&r.userInfos.length)for(var d=0;d<r.userInfos.length;++d)t.UserStatusResult.UserStatusInfo.encode(r.userInfos[d],s.uint32(18).fork()).ldelim();return s},e.decode=function(r,s){r instanceof u||(r=u.create(r)),s=s===void 0?r.len:r.pos+s;for(var d=new t.UserStatusResult;r.pos<s;){var f=r.uint32();switch(f>>>3){case 1:d.seq=r.uint64();break;case 2:d.userInfos&&d.userInfos.length||(d.userInfos=[]),d.userInfos.push(t.UserStatusResult.UserStatusInfo.decode(r,r.uint32()));break;default:r.skipType(7&f)}}return d},e.UserStatusInfo=function(){function r(s){if(s)for(var d=Object.keys(s),f=0;f<d.length;++f)s[d[f]]!=null&&(this[d[f]]=s[d[f]])}return r.prototype.account="",r.prototype.ts=0,r.encode=function(s,d){return d||(d=L.create()),s.account!=null&&Object.hasOwnProperty.call(s,"account")&&d.uint32(10).string(s.account),s.ts!=null&&Object.hasOwnProperty.call(s,"ts")&&d.uint32(16).uint32(s.ts),d},r.decode=function(s,d){s instanceof u||(s=u.create(s)),d=d===void 0?s.len:s.pos+d;for(var f=new t.UserStatusResult.UserStatusInfo;s.pos<d;){var _=s.uint32();switch(_>>>3){case 1:f.account=s.string();break;case 2:f.ts=s.uint32();break;default:s.skipType(7&_)}}return f},r}(),e}(),tB=t.UserAttributeGet=function(){function e(r){if(this.attributes=[],r)for(var s=Object.keys(r),d=0;d<s.length;++d)r[s[d]]!=null&&(this[s[d]]=r[s[d]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.account="",e.prototype.attributes=q.emptyArray,e.encode=function(r,s){if(s||(s=L.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&s.uint32(8).uint64(r.seq),r.account!=null&&Object.hasOwnProperty.call(r,"account")&&s.uint32(18).string(r.account),r.attributes!=null&&r.attributes.length)for(var d=0;d<r.attributes.length;++d)s.uint32(26).string(r.attributes[d]);return s},e.decode=function(r,s){r instanceof u||(r=u.create(r)),s=s===void 0?r.len:r.pos+s;for(var d=new t.UserAttributeGet;r.pos<s;){var f=r.uint32();switch(f>>>3){case 1:d.seq=r.uint64();break;case 2:d.account=r.string();break;case 3:d.attributes&&d.attributes.length||(d.attributes=[]),d.attributes.push(r.string());break;default:r.skipType(7&f)}}return d},e}(),uB=t.UserAttributeRet=function(){function e(r){if(this.attributeInfos=[],r)for(var s=Object.keys(r),d=0;d<s.length;++d)r[s[d]]!=null&&(this[s[d]]=r[s[d]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.attributeInfos=q.emptyArray,e.encode=function(r,s){if(s||(s=L.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&s.uint32(8).uint64(r.seq),r.attributeInfos!=null&&r.attributeInfos.length)for(var d=0;d<r.attributeInfos.length;++d)t.UserAttributeRet.AttributeInfo.encode(r.attributeInfos[d],s.uint32(18).fork()).ldelim();return s},e.decode=function(r,s){r instanceof u||(r=u.create(r)),s=s===void 0?r.len:r.pos+s;for(var d=new t.UserAttributeRet;r.pos<s;){var f=r.uint32();switch(f>>>3){case 1:d.seq=r.uint64();break;case 2:d.attributeInfos&&d.attributeInfos.length||(d.attributeInfos=[]),d.attributeInfos.push(t.UserAttributeRet.AttributeInfo.decode(r,r.uint32()));break;default:r.skipType(7&f)}}return d},e.AttributeInfo=function(){function r(s){if(s)for(var d=Object.keys(s),f=0;f<d.length;++f)s[d[f]]!=null&&(this[d[f]]=s[d[f]])}return r.prototype.key="",r.prototype.value="",r.encode=function(s,d){return d||(d=L.create()),s.key!=null&&Object.hasOwnProperty.call(s,"key")&&d.uint32(10).string(s.key),s.value!=null&&Object.hasOwnProperty.call(s,"value")&&d.uint32(18).string(s.value),d},r.decode=function(s,d){s instanceof u||(s=u.create(s)),d=d===void 0?s.len:s.pos+d;for(var f=new t.UserAttributeRet.AttributeInfo;s.pos<d;){var _=s.uint32();switch(_>>>3){case 1:f.key=s.string();break;case 2:f.value=s.string();break;default:s.skipType(7&_)}}return f},r}(),e}(),vB=t.UserAttributeSet=function(){function e(r){if(this.attributeInfos=[],r)for(var s=Object.keys(r),d=0;d<s.length;++d)r[s[d]]!=null&&(this[s[d]]=r[s[d]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.account="",e.prototype.attributeInfos=q.emptyArray,e.encode=function(r,s){if(s||(s=L.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&s.uint32(8).uint64(r.seq),r.account!=null&&Object.hasOwnProperty.call(r,"account")&&s.uint32(18).string(r.account),r.attributeInfos!=null&&r.attributeInfos.length)for(var d=0;d<r.attributeInfos.length;++d)t.UserAttributeSet.AttributeInfo.encode(r.attributeInfos[d],s.uint32(26).fork()).ldelim();return s},e.decode=function(r,s){r instanceof u||(r=u.create(r)),s=s===void 0?r.len:r.pos+s;for(var d=new t.UserAttributeSet;r.pos<s;){var f=r.uint32();switch(f>>>3){case 1:d.seq=r.uint64();break;case 2:d.account=r.string();break;case 3:d.attributeInfos&&d.attributeInfos.length||(d.attributeInfos=[]),d.attributeInfos.push(t.UserAttributeSet.AttributeInfo.decode(r,r.uint32()));break;default:r.skipType(7&f)}}return d},e.AttributeInfo=function(){function r(s){if(s)for(var d=Object.keys(s),f=0;f<d.length;++f)s[d[f]]!=null&&(this[d[f]]=s[d[f]])}return r.prototype.key="",r.prototype.value="",r.encode=function(s,d){return d||(d=L.create()),s.key!=null&&Object.hasOwnProperty.call(s,"key")&&d.uint32(10).string(s.key),s.value!=null&&Object.hasOwnProperty.call(s,"value")&&d.uint32(18).string(s.value),d},r.decode=function(s,d){s instanceof u||(s=u.create(s)),d=d===void 0?s.len:s.pos+d;for(var f=new t.UserAttributeSet.AttributeInfo;s.pos<d;){var _=s.uint32();switch(_>>>3){case 1:f.key=s.string();break;case 2:f.value=s.string();break;default:s.skipType(7&_)}}return f},r}(),e}(),wB=t.UserAttributeMod=function(){function e(r){if(this.attributeInfos=[],r)for(var s=Object.keys(r),d=0;d<s.length;++d)r[s[d]]!=null&&(this[s[d]]=r[s[d]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.account="",e.prototype.attributeInfos=q.emptyArray,e.encode=function(r,s){if(s||(s=L.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&s.uint32(8).uint64(r.seq),r.account!=null&&Object.hasOwnProperty.call(r,"account")&&s.uint32(18).string(r.account),r.attributeInfos!=null&&r.attributeInfos.length)for(var d=0;d<r.attributeInfos.length;++d)t.UserAttributeMod.AttributeInfo.encode(r.attributeInfos[d],s.uint32(26).fork()).ldelim();return s},e.decode=function(r,s){r instanceof u||(r=u.create(r)),s=s===void 0?r.len:r.pos+s;for(var d=new t.UserAttributeMod;r.pos<s;){var f=r.uint32();switch(f>>>3){case 1:d.seq=r.uint64();break;case 2:d.account=r.string();break;case 3:d.attributeInfos&&d.attributeInfos.length||(d.attributeInfos=[]),d.attributeInfos.push(t.UserAttributeMod.AttributeInfo.decode(r,r.uint32()));break;default:r.skipType(7&f)}}return d},e.AttributeInfo=function(){function r(s){if(s)for(var d=Object.keys(s),f=0;f<d.length;++f)s[d[f]]!=null&&(this[d[f]]=s[d[f]])}return r.prototype.key="",r.prototype.value="",r.encode=function(s,d){return d||(d=L.create()),s.key!=null&&Object.hasOwnProperty.call(s,"key")&&d.uint32(10).string(s.key),s.value!=null&&Object.hasOwnProperty.call(s,"value")&&d.uint32(18).string(s.value),d},r.decode=function(s,d){s instanceof u||(s=u.create(s)),d=d===void 0?s.len:s.pos+d;for(var f=new t.UserAttributeMod.AttributeInfo;s.pos<d;){var _=s.uint32();switch(_>>>3){case 1:f.key=s.string();break;case 2:f.value=s.string();break;default:s.skipType(7&_)}}return f},r}(),e}(),xB=t.UserAttributeDel=function(){function e(r){if(this.attributes=[],r)for(var s=Object.keys(r),d=0;d<s.length;++d)r[s[d]]!=null&&(this[s[d]]=r[s[d]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.account="",e.prototype.attributes=q.emptyArray,e.encode=function(r,s){if(s||(s=L.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&s.uint32(8).uint64(r.seq),r.account!=null&&Object.hasOwnProperty.call(r,"account")&&s.uint32(18).string(r.account),r.attributes!=null&&r.attributes.length)for(var d=0;d<r.attributes.length;++d)s.uint32(26).string(r.attributes[d]);return s},e.decode=function(r,s){r instanceof u||(r=u.create(r)),s=s===void 0?r.len:r.pos+s;for(var d=new t.UserAttributeDel;r.pos<s;){var f=r.uint32();switch(f>>>3){case 1:d.seq=r.uint64();break;case 2:d.account=r.string();break;case 3:d.attributes&&d.attributes.length||(d.attributes=[]),d.attributes.push(r.string());break;default:r.skipType(7&f)}}return d},e}(),yB=t.UserAttributeErr=function(){function e(r){if(r)for(var s=Object.keys(r),d=0;d<s.length;++d)r[s[d]]!=null&&(this[s[d]]=r[s[d]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.code=0,e.encode=function(r,s){return s||(s=L.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&s.uint32(8).uint64(r.seq),r.code!=null&&Object.hasOwnProperty.call(r,"code")&&s.uint32(16).uint32(r.code),s},e.decode=function(r,s){r instanceof u||(r=u.create(r)),s=s===void 0?r.len:r.pos+s;for(var d=new t.UserAttributeErr;r.pos<s;){var f=r.uint32();switch(f>>>3){case 1:d.seq=r.uint64();break;case 2:d.code=r.uint32();break;default:r.skipType(7&f)}}return d},e}(),zB=t.UserAttributeKeysGet=function(){function e(r){if(r)for(var s=Object.keys(r),d=0;d<s.length;++d)r[s[d]]!=null&&(this[s[d]]=r[s[d]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.account="",e.encode=function(r,s){return s||(s=L.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&s.uint32(8).uint64(r.seq),r.account!=null&&Object.hasOwnProperty.call(r,"account")&&s.uint32(18).string(r.account),s},e.decode=function(r,s){r instanceof u||(r=u.create(r)),s=s===void 0?r.len:r.pos+s;for(var d=new t.UserAttributeKeysGet;r.pos<s;){var f=r.uint32();switch(f>>>3){case 1:d.seq=r.uint64();break;case 2:d.account=r.string();break;default:r.skipType(7&f)}}return d},e}(),AB=t.UserAttributeKeysRet=function(){function e(r){if(this.keys=[],r)for(var s=Object.keys(r),d=0;d<s.length;++d)r[s[d]]!=null&&(this[s[d]]=r[s[d]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.keys=q.emptyArray,e.encode=function(r,s){if(s||(s=L.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&s.uint32(8).uint64(r.seq),r.keys!=null&&r.keys.length)for(var d=0;d<r.keys.length;++d)s.uint32(18).string(r.keys[d]);return s},e.decode=function(r,s){r instanceof u||(r=u.create(r)),s=s===void 0?r.len:r.pos+s;for(var d=new t.UserAttributeKeysRet;r.pos<s;){var f=r.uint32();switch(f>>>3){case 1:d.seq=r.uint64();break;case 2:d.keys&&d.keys.length||(d.keys=[]),d.keys.push(r.string());break;default:r.skipType(7&f)}}return d},e}(),BB=t.UserAttributeRsp=function(){function e(r){if(r)for(var s=Object.keys(r),d=0;d<s.length;++d)r[s[d]]!=null&&(this[s[d]]=r[s[d]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.encode=function(r,s){return s||(s=L.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&s.uint32(8).uint64(r.seq),s},e.decode=function(r,s){r instanceof u||(r=u.create(r)),s=s===void 0?r.len:r.pos+s;for(var d=new t.UserAttributeRsp;r.pos<s;){var f=r.uint32();switch(f>>>3){case 1:d.seq=r.uint64();break;default:r.skipType(7&f)}}return d},e}(),CB=t.GroupStatusList=function(){function e(r){if(this.groups=[],r)for(var s=Object.keys(r),d=0;d<s.length;++d)r[s[d]]!=null&&(this[s[d]]=r[s[d]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.groups=q.emptyArray,e.encode=function(r,s){if(s||(s=L.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&s.uint32(8).uint64(r.seq),r.groups!=null&&r.groups.length)for(var d=0;d<r.groups.length;++d)s.uint32(18).string(r.groups[d]);return s},e.decode=function(r,s){r instanceof u||(r=u.create(r)),s=s===void 0?r.len:r.pos+s;for(var d=new t.GroupStatusList;r.pos<s;){var f=r.uint32();switch(f>>>3){case 1:d.seq=r.uint64();break;case 2:d.groups&&d.groups.length||(d.groups=[]),d.groups.push(r.string());break;default:r.skipType(7&f)}}return d},e}(),DB=t.GroupStatusResult=function(){function e(r){if(this.groupInfos=[],r)for(var s=Object.keys(r),d=0;d<s.length;++d)r[s[d]]!=null&&(this[s[d]]=r[s[d]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.groupInfos=q.emptyArray,e.encode=function(r,s){if(s||(s=L.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&s.uint32(8).uint64(r.seq),r.groupInfos!=null&&r.groupInfos.length)for(var d=0;d<r.groupInfos.length;++d)t.GroupStatusResult.GroupInfo.encode(r.groupInfos[d],s.uint32(18).fork()).ldelim();return s},e.decode=function(r,s){r instanceof u||(r=u.create(r)),s=s===void 0?r.len:r.pos+s;for(var d=new t.GroupStatusResult;r.pos<s;){var f=r.uint32();switch(f>>>3){case 1:d.seq=r.uint64();break;case 2:d.groupInfos&&d.groupInfos.length||(d.groupInfos=[]),d.groupInfos.push(t.GroupStatusResult.GroupInfo.decode(r,r.uint32()));break;default:r.skipType(7&f)}}return d},e.GroupInfo=function(){function r(s){if(s)for(var d=Object.keys(s),f=0;f<d.length;++f)s[d[f]]!=null&&(this[d[f]]=s[d[f]])}return r.prototype.group="",r.prototype.memberCount=0,r.encode=function(s,d){return d||(d=L.create()),s.group!=null&&Object.hasOwnProperty.call(s,"group")&&d.uint32(10).string(s.group),s.memberCount!=null&&Object.hasOwnProperty.call(s,"memberCount")&&d.uint32(16).uint32(s.memberCount),d},r.decode=function(s,d){s instanceof u||(s=u.create(s)),d=d===void 0?s.len:s.pos+d;for(var f=new t.GroupStatusResult.GroupInfo;s.pos<d;){var _=s.uint32();switch(_>>>3){case 1:f.group=s.string();break;case 2:f.memberCount=s.uint32();break;default:s.skipType(7&_)}}return f},r}(),e}(),EB=t.GroupCountNotice=function(){function e(r){if(r)for(var s=Object.keys(r),d=0;d<s.length;++d)r[s[d]]!=null&&(this[s[d]]=r[s[d]])}return e.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.group="",e.prototype.size=0,e.encode=function(r,s){return s||(s=L.create()),r.instance!=null&&Object.hasOwnProperty.call(r,"instance")&&s.uint32(8).uint64(r.instance),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&s.uint32(16).uint64(r.seq),r.group!=null&&Object.hasOwnProperty.call(r,"group")&&s.uint32(26).string(r.group),r.size!=null&&Object.hasOwnProperty.call(r,"size")&&s.uint32(32).uint32(r.size),s},e.decode=function(r,s){r instanceof u||(r=u.create(r)),s=s===void 0?r.len:r.pos+s;for(var d=new t.GroupCountNotice;r.pos<s;){var f=r.uint32();switch(f>>>3){case 1:d.instance=r.uint64();break;case 2:d.seq=r.uint64();break;case 3:d.group=r.string();break;case 4:d.size=r.uint32();break;default:r.skipType(7&f)}}return d},e}(),FB=t.GroupAttributeGet=function(){function e(r){if(this.attributes=[],r)for(var s=Object.keys(r),d=0;d<s.length;++d)r[s[d]]!=null&&(this[s[d]]=r[s[d]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.group="",e.prototype.attributes=q.emptyArray,e.encode=function(r,s){if(s||(s=L.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&s.uint32(8).uint64(r.seq),r.group!=null&&Object.hasOwnProperty.call(r,"group")&&s.uint32(18).string(r.group),r.attributes!=null&&r.attributes.length)for(var d=0;d<r.attributes.length;++d)s.uint32(26).string(r.attributes[d]);return s},e.decode=function(r,s){r instanceof u||(r=u.create(r)),s=s===void 0?r.len:r.pos+s;for(var d=new t.GroupAttributeGet;r.pos<s;){var f=r.uint32();switch(f>>>3){case 1:d.seq=r.uint64();break;case 2:d.group=r.string();break;case 3:d.attributes&&d.attributes.length||(d.attributes=[]),d.attributes.push(r.string());break;default:r.skipType(7&f)}}return d},e}(),GB=t.GroupAttributeRet=function(){function e(r){if(this.attributeMaps=[],r)for(var s=Object.keys(r),d=0;d<s.length;++d)r[s[d]]!=null&&(this[s[d]]=r[s[d]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.attributeMaps=q.emptyArray,e.encode=function(r,s){if(s||(s=L.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&s.uint32(8).uint64(r.seq),r.attributeMaps!=null&&r.attributeMaps.length)for(var d=0;d<r.attributeMaps.length;++d)t.GroupAttributeRet.AttributeMap.encode(r.attributeMaps[d],s.uint32(18).fork()).ldelim();return s},e.decode=function(r,s){r instanceof u||(r=u.create(r)),s=s===void 0?r.len:r.pos+s;for(var d=new t.GroupAttributeRet;r.pos<s;){var f=r.uint32();switch(f>>>3){case 1:d.seq=r.uint64();break;case 2:d.attributeMaps&&d.attributeMaps.length||(d.attributeMaps=[]),d.attributeMaps.push(t.GroupAttributeRet.AttributeMap.decode(r,r.uint32()));break;default:r.skipType(7&f)}}return d},e.AttributeMap=function(){function r(s){if(s)for(var d=Object.keys(s),f=0;f<d.length;++f)s[d[f]]!=null&&(this[d[f]]=s[d[f]])}return r.prototype.key="",r.prototype.value="",r.prototype.origin="",r.prototype.ms=q.Long?q.Long.fromBits(0,0,!0):0,r.encode=function(s,d){return d||(d=L.create()),s.key!=null&&Object.hasOwnProperty.call(s,"key")&&d.uint32(10).string(s.key),s.value!=null&&Object.hasOwnProperty.call(s,"value")&&d.uint32(18).string(s.value),s.origin!=null&&Object.hasOwnProperty.call(s,"origin")&&d.uint32(26).string(s.origin),s.ms!=null&&Object.hasOwnProperty.call(s,"ms")&&d.uint32(32).uint64(s.ms),d},r.decode=function(s,d){s instanceof u||(s=u.create(s)),d=d===void 0?s.len:s.pos+d;for(var f=new t.GroupAttributeRet.AttributeMap;s.pos<d;){var _=s.uint32();switch(_>>>3){case 1:f.key=s.string();break;case 2:f.value=s.string();break;case 3:f.origin=s.string();break;case 4:f.ms=s.uint64();break;default:s.skipType(7&_)}}return f},r}(),e}(),HB=t.GroupAttributeSet=function(){function e(r){if(this.attributeInfos=[],r)for(var s=Object.keys(r),d=0;d<s.length;++d)r[s[d]]!=null&&(this[s[d]]=r[s[d]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.group="",e.prototype.broadcast=!1,e.prototype.attributeInfos=q.emptyArray,e.encode=function(r,s){if(s||(s=L.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&s.uint32(8).uint64(r.seq),r.group!=null&&Object.hasOwnProperty.call(r,"group")&&s.uint32(18).string(r.group),r.broadcast!=null&&Object.hasOwnProperty.call(r,"broadcast")&&s.uint32(24).bool(r.broadcast),r.attributeInfos!=null&&r.attributeInfos.length)for(var d=0;d<r.attributeInfos.length;++d)t.GroupAttributeSet.AttributeInfo.encode(r.attributeInfos[d],s.uint32(34).fork()).ldelim();return s},e.decode=function(r,s){r instanceof u||(r=u.create(r)),s=s===void 0?r.len:r.pos+s;for(var d=new t.GroupAttributeSet;r.pos<s;){var f=r.uint32();switch(f>>>3){case 1:d.seq=r.uint64();break;case 2:d.group=r.string();break;case 3:d.broadcast=r.bool();break;case 4:d.attributeInfos&&d.attributeInfos.length||(d.attributeInfos=[]),d.attributeInfos.push(t.GroupAttributeSet.AttributeInfo.decode(r,r.uint32()));break;default:r.skipType(7&f)}}return d},e.AttributeInfo=function(){function r(s){if(s)for(var d=Object.keys(s),f=0;f<d.length;++f)s[d[f]]!=null&&(this[d[f]]=s[d[f]])}return r.prototype.key="",r.prototype.value="",r.encode=function(s,d){return d||(d=L.create()),s.key!=null&&Object.hasOwnProperty.call(s,"key")&&d.uint32(10).string(s.key),s.value!=null&&Object.hasOwnProperty.call(s,"value")&&d.uint32(18).string(s.value),d},r.decode=function(s,d){s instanceof u||(s=u.create(s)),d=d===void 0?s.len:s.pos+d;for(var f=new t.GroupAttributeSet.AttributeInfo;s.pos<d;){var _=s.uint32();switch(_>>>3){case 1:f.key=s.string();break;case 2:f.value=s.string();break;default:s.skipType(7&_)}}return f},r}(),e}(),IB=t.GroupAttributeMod=function(){function e(r){if(this.attributeInfos=[],r)for(var s=Object.keys(r),d=0;d<s.length;++d)r[s[d]]!=null&&(this[s[d]]=r[s[d]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.group="",e.prototype.broadcast=!1,e.prototype.attributeInfos=q.emptyArray,e.encode=function(r,s){if(s||(s=L.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&s.uint32(8).uint64(r.seq),r.group!=null&&Object.hasOwnProperty.call(r,"group")&&s.uint32(18).string(r.group),r.broadcast!=null&&Object.hasOwnProperty.call(r,"broadcast")&&s.uint32(24).bool(r.broadcast),r.attributeInfos!=null&&r.attributeInfos.length)for(var d=0;d<r.attributeInfos.length;++d)t.GroupAttributeMod.AttributeInfo.encode(r.attributeInfos[d],s.uint32(34).fork()).ldelim();return s},e.decode=function(r,s){r instanceof u||(r=u.create(r)),s=s===void 0?r.len:r.pos+s;for(var d=new t.GroupAttributeMod;r.pos<s;){var f=r.uint32();switch(f>>>3){case 1:d.seq=r.uint64();break;case 2:d.group=r.string();break;case 3:d.broadcast=r.bool();break;case 4:d.attributeInfos&&d.attributeInfos.length||(d.attributeInfos=[]),d.attributeInfos.push(t.GroupAttributeMod.AttributeInfo.decode(r,r.uint32()));break;default:r.skipType(7&f)}}return d},e.AttributeInfo=function(){function r(s){if(s)for(var d=Object.keys(s),f=0;f<d.length;++f)s[d[f]]!=null&&(this[d[f]]=s[d[f]])}return r.prototype.key="",r.prototype.value="",r.encode=function(s,d){return d||(d=L.create()),s.key!=null&&Object.hasOwnProperty.call(s,"key")&&d.uint32(10).string(s.key),s.value!=null&&Object.hasOwnProperty.call(s,"value")&&d.uint32(18).string(s.value),d},r.decode=function(s,d){s instanceof u||(s=u.create(s)),d=d===void 0?s.len:s.pos+d;for(var f=new t.GroupAttributeMod.AttributeInfo;s.pos<d;){var _=s.uint32();switch(_>>>3){case 1:f.key=s.string();break;case 2:f.value=s.string();break;default:s.skipType(7&_)}}return f},r}(),e}(),JB=t.GroupAttributeDel=function(){function e(r){if(this.attributes=[],r)for(var s=Object.keys(r),d=0;d<s.length;++d)r[s[d]]!=null&&(this[s[d]]=r[s[d]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.group="",e.prototype.broadcast=!1,e.prototype.attributes=q.emptyArray,e.encode=function(r,s){if(s||(s=L.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&s.uint32(8).uint64(r.seq),r.group!=null&&Object.hasOwnProperty.call(r,"group")&&s.uint32(18).string(r.group),r.broadcast!=null&&Object.hasOwnProperty.call(r,"broadcast")&&s.uint32(24).bool(r.broadcast),r.attributes!=null&&r.attributes.length)for(var d=0;d<r.attributes.length;++d)s.uint32(34).string(r.attributes[d]);return s},e.decode=function(r,s){r instanceof u||(r=u.create(r)),s=s===void 0?r.len:r.pos+s;for(var d=new t.GroupAttributeDel;r.pos<s;){var f=r.uint32();switch(f>>>3){case 1:d.seq=r.uint64();break;case 2:d.group=r.string();break;case 3:d.broadcast=r.bool();break;case 4:d.attributes&&d.attributes.length||(d.attributes=[]),d.attributes.push(r.string());break;default:r.skipType(7&f)}}return d},e}(),KB=t.GroupAttributeAlt=function(){function e(r){if(this.attributeMaps=[],r)for(var s=Object.keys(r),d=0;d<s.length;++d)r[s[d]]!=null&&(this[s[d]]=r[s[d]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.group="",e.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.attributeMaps=q.emptyArray,e.encode=function(r,s){if(s||(s=L.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&s.uint32(8).uint64(r.seq),r.group!=null&&Object.hasOwnProperty.call(r,"group")&&s.uint32(18).string(r.group),r.instance!=null&&Object.hasOwnProperty.call(r,"instance")&&s.uint32(24).uint64(r.instance),r.attributeMaps!=null&&r.attributeMaps.length)for(var d=0;d<r.attributeMaps.length;++d)t.GroupAttributeAlt.AttributeMap.encode(r.attributeMaps[d],s.uint32(34).fork()).ldelim();return s},e.decode=function(r,s){r instanceof u||(r=u.create(r)),s=s===void 0?r.len:r.pos+s;for(var d=new t.GroupAttributeAlt;r.pos<s;){var f=r.uint32();switch(f>>>3){case 1:d.seq=r.uint64();break;case 2:d.group=r.string();break;case 3:d.instance=r.uint64();break;case 4:d.attributeMaps&&d.attributeMaps.length||(d.attributeMaps=[]),d.attributeMaps.push(t.GroupAttributeAlt.AttributeMap.decode(r,r.uint32()));break;default:r.skipType(7&f)}}return d},e.AttributeMap=function(){function r(s){if(s)for(var d=Object.keys(s),f=0;f<d.length;++f)s[d[f]]!=null&&(this[d[f]]=s[d[f]])}return r.prototype.key="",r.prototype.value="",r.prototype.origin="",r.prototype.ms=q.Long?q.Long.fromBits(0,0,!0):0,r.encode=function(s,d){return d||(d=L.create()),s.key!=null&&Object.hasOwnProperty.call(s,"key")&&d.uint32(10).string(s.key),s.value!=null&&Object.hasOwnProperty.call(s,"value")&&d.uint32(18).string(s.value),s.origin!=null&&Object.hasOwnProperty.call(s,"origin")&&d.uint32(26).string(s.origin),s.ms!=null&&Object.hasOwnProperty.call(s,"ms")&&d.uint32(32).uint64(s.ms),d},r.decode=function(s,d){s instanceof u||(s=u.create(s)),d=d===void 0?s.len:s.pos+d;for(var f=new t.GroupAttributeAlt.AttributeMap;s.pos<d;){var _=s.uint32();switch(_>>>3){case 1:f.key=s.string();break;case 2:f.value=s.string();break;case 3:f.origin=s.string();break;case 4:f.ms=s.uint64();break;default:s.skipType(7&_)}}return f},r}(),e}(),LB=t.GroupAttributeRsp=function(){function e(r){if(r)for(var s=Object.keys(r),d=0;d<s.length;++d)r[s[d]]!=null&&(this[s[d]]=r[s[d]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.encode=function(r,s){return s||(s=L.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&s.uint32(8).uint64(r.seq),s},e.decode=function(r,s){r instanceof u||(r=u.create(r)),s=s===void 0?r.len:r.pos+s;for(var d=new t.GroupAttributeRsp;r.pos<s;){var f=r.uint32();switch(f>>>3){case 1:d.seq=r.uint64();break;default:r.skipType(7&f)}}return d},e}(),MB=t.GroupAttributeErr=function(){function e(r){if(r)for(var s=Object.keys(r),d=0;d<s.length;++d)r[s[d]]!=null&&(this[s[d]]=r[s[d]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.code=0,e.encode=function(r,s){return s||(s=L.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&s.uint32(8).uint64(r.seq),r.code!=null&&Object.hasOwnProperty.call(r,"code")&&s.uint32(16).uint32(r.code),s},e.decode=function(r,s){r instanceof u||(r=u.create(r)),s=s===void 0?r.len:r.pos+s;for(var d=new t.GroupAttributeErr;r.pos<s;){var f=r.uint32();switch(f>>>3){case 1:d.seq=r.uint64();break;case 2:d.code=r.uint32();break;default:r.skipType(7&f)}}return d},e}(),NB=t.GroupAttributeKeysGet=function(){function e(r){if(r)for(var s=Object.keys(r),d=0;d<s.length;++d)r[s[d]]!=null&&(this[s[d]]=r[s[d]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.group="",e.encode=function(r,s){return s||(s=L.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&s.uint32(8).uint64(r.seq),r.group!=null&&Object.hasOwnProperty.call(r,"group")&&s.uint32(18).string(r.group),s},e.decode=function(r,s){r instanceof u||(r=u.create(r)),s=s===void 0?r.len:r.pos+s;for(var d=new t.GroupAttributeKeysGet;r.pos<s;){var f=r.uint32();switch(f>>>3){case 1:d.seq=r.uint64();break;case 2:d.group=r.string();break;default:r.skipType(7&f)}}return d},e}(),OB=t.GroupAttributeKeysRet=function(){function e(r){if(this.keys=[],r)for(var s=Object.keys(r),d=0;d<s.length;++d)r[s[d]]!=null&&(this[s[d]]=r[s[d]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.keys=q.emptyArray,e.encode=function(r,s){if(s||(s=L.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&s.uint32(8).uint64(r.seq),r.keys!=null&&r.keys.length)for(var d=0;d<r.keys.length;++d)s.uint32(18).string(r.keys[d]);return s},e.decode=function(r,s){r instanceof u||(r=u.create(r)),s=s===void 0?r.len:r.pos+s;for(var d=new t.GroupAttributeKeysRet;r.pos<s;){var f=r.uint32();switch(f>>>3){case 1:d.seq=r.uint64();break;case 2:d.keys&&d.keys.length||(d.keys=[]),d.keys.push(r.string());break;default:r.skipType(7&f)}}return d},e}(),PB=t.SubscribeUserStatus=function(){function e(r){if(this.users=[],r)for(var s=Object.keys(r),d=0;d<s.length;++d)r[s[d]]!=null&&(this[s[d]]=r[s[d]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.users=q.emptyArray,e.encode=function(r,s){if(s||(s=L.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&s.uint32(8).uint64(r.seq),r.users!=null&&r.users.length)for(var d=0;d<r.users.length;++d)s.uint32(18).string(r.users[d]);return s},e.decode=function(r,s){r instanceof u||(r=u.create(r)),s=s===void 0?r.len:r.pos+s;for(var d=new t.SubscribeUserStatus;r.pos<s;){var f=r.uint32();switch(f>>>3){case 1:d.seq=r.uint64();break;case 2:d.users&&d.users.length||(d.users=[]),d.users.push(r.string());break;default:r.skipType(7&f)}}return d},e}(),QB=t.UnsubscribeUserStatus=function(){function e(r){if(this.users=[],r)for(var s=Object.keys(r),d=0;d<s.length;++d)r[s[d]]!=null&&(this[s[d]]=r[s[d]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.users=q.emptyArray,e.encode=function(r,s){if(s||(s=L.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&s.uint32(8).uint64(r.seq),r.users!=null&&r.users.length)for(var d=0;d<r.users.length;++d)s.uint32(18).string(r.users[d]);return s},e.decode=function(r,s){r instanceof u||(r=u.create(r)),s=s===void 0?r.len:r.pos+s;for(var d=new t.UnsubscribeUserStatus;r.pos<s;){var f=r.uint32();switch(f>>>3){case 1:d.seq=r.uint64();break;case 2:d.users&&d.users.length||(d.users=[]),d.users.push(r.string());break;default:r.skipType(7&f)}}return d},e}(),RB=t.UserJoinNotice=function(){function e(r){if(r)for(var s=Object.keys(r),d=0;d<s.length;++d)r[s[d]]!=null&&(this[s[d]]=r[s[d]])}return e.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.user="",e.encode=function(r,s){return s||(s=L.create()),r.instance!=null&&Object.hasOwnProperty.call(r,"instance")&&s.uint32(8).uint64(r.instance),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&s.uint32(16).uint64(r.seq),r.user!=null&&Object.hasOwnProperty.call(r,"user")&&s.uint32(26).string(r.user),s},e.decode=function(r,s){r instanceof u||(r=u.create(r)),s=s===void 0?r.len:r.pos+s;for(var d=new t.UserJoinNotice;r.pos<s;){var f=r.uint32();switch(f>>>3){case 1:d.instance=r.uint64();break;case 2:d.seq=r.uint64();break;case 3:d.user=r.string();break;default:r.skipType(7&f)}}return d},e}(),SB=t.UserQuitNotice=function(){function e(r){if(r)for(var s=Object.keys(r),d=0;d<s.length;++d)r[s[d]]!=null&&(this[s[d]]=r[s[d]])}return e.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.user="",e.encode=function(r,s){return s||(s=L.create()),r.instance!=null&&Object.hasOwnProperty.call(r,"instance")&&s.uint32(8).uint64(r.instance),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&s.uint32(16).uint64(r.seq),r.user!=null&&Object.hasOwnProperty.call(r,"user")&&s.uint32(26).string(r.user),s},e.decode=function(r,s){r instanceof u||(r=u.create(r)),s=s===void 0?r.len:r.pos+s;for(var d=new t.UserQuitNotice;r.pos<s;){var f=r.uint32();switch(f>>>3){case 1:d.instance=r.uint64();break;case 2:d.seq=r.uint64();break;case 3:d.user=r.string();break;default:r.skipType(7&f)}}return d},e}(),TB=t.UserWaitNotice=function(){function e(r){if(r)for(var s=Object.keys(r),d=0;d<s.length;++d)r[s[d]]!=null&&(this[s[d]]=r[s[d]])}return e.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.user="",e.encode=function(r,s){return s||(s=L.create()),r.instance!=null&&Object.hasOwnProperty.call(r,"instance")&&s.uint32(8).uint64(r.instance),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&s.uint32(16).uint64(r.seq),r.user!=null&&Object.hasOwnProperty.call(r,"user")&&s.uint32(26).string(r.user),s},e.decode=function(r,s){r instanceof u||(r=u.create(r)),s=s===void 0?r.len:r.pos+s;for(var d=new t.UserWaitNotice;r.pos<s;){var f=r.uint32();switch(f>>>3){case 1:d.instance=r.uint64();break;case 2:d.seq=r.uint64();break;case 3:d.user=r.string();break;default:r.skipType(7&f)}}return d},e}(),UB=t.SubscribeResponse=function(){function e(r){if(this.errors=[],r)for(var s=Object.keys(r),d=0;d<s.length;++d)r[s[d]]!=null&&(this[s[d]]=r[s[d]])}return e.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,e.prototype.errors=q.emptyArray,e.encode=function(r,s){if(s||(s=L.create()),r.seq!=null&&Object.hasOwnProperty.call(r,"seq")&&s.uint32(8).uint64(r.seq),r.errors!=null&&r.errors.length)for(var d=0;d<r.errors.length;++d)t.SubscribeResponse.SubscribeErrorsType.encode(r.errors[d],s.uint32(18).fork()).ldelim();return s},e.decode=function(r,s){r instanceof u||(r=u.create(r)),s=s===void 0?r.len:r.pos+s;for(var d=new t.SubscribeResponse;r.pos<s;){var f=r.uint32();switch(f>>>3){case 1:d.seq=r.uint64();break;case 2:d.errors&&d.errors.length||(d.errors=[]),d.errors.push(t.SubscribeResponse.SubscribeErrorsType.decode(r,r.uint32()));break;default:r.skipType(7&f)}}return d},e.SubscribeErrorsType=function(){function r(s){if(s)for(var d=Object.keys(s),f=0;f<d.length;++f)s[d[f]]!=null&&(this[d[f]]=s[d[f]])}return r.prototype.account="",r.prototype.code=0,r.encode=function(s,d){return d||(d=L.create()),s.account!=null&&Object.hasOwnProperty.call(s,"account")&&d.uint32(10).string(s.account),s.code!=null&&Object.hasOwnProperty.call(s,"code")&&d.uint32(16).uint32(s.code),d},r.decode=function(s,d){s instanceof u||(s=u.create(s)),d=d===void 0?s.len:s.pos+d;for(var f=new t.SubscribeResponse.SubscribeErrorsType;s.pos<d;){var _=s.uint32();switch(_>>>3){case 1:f.account=s.string();break;case 2:f.code=s.uint32();break;default:s.skipType(7&_)}}return f},r}(),e}(),VB=Object.freeze({__proto__:null,URI:YA,Wrapper:Oh,Ping:ZA,Pong:$A,UserJoin:aB,UserResp:bB,UserQuit:cB,UserDrop:dB,GroupEnter:eB,GroupLeave:fB,GroupReply:gB,GroupLeaveNotice:ur,GroupEnterNotice:vr,Message:wr,Ack:xr,FileUploadIndexGet:hB,FileUploadIndexRet:iB,FileUploadIndexSet:jB,FileUploadIndexFin:kB,FileUploadIndexErr:lB,FileDownloadIndexGet:mB,FileDownloadIndexRet:nB,FileDownloadIndexErr:oB,GroupAllUsersList:pB,GroupAllUsersResult:qB,UserStatusList:rB,UserStatusResult:sB,UserAttributeGet:tB,UserAttributeRet:uB,UserAttributeSet:vB,UserAttributeMod:wB,UserAttributeDel:xB,UserAttributeErr:yB,UserAttributeKeysGet:zB,UserAttributeKeysRet:AB,UserAttributeRsp:BB,GroupStatusList:CB,GroupStatusResult:DB,GroupCountNotice:EB,GroupAttributeGet:FB,GroupAttributeRet:GB,GroupAttributeSet:HB,GroupAttributeMod:IB,GroupAttributeDel:JB,GroupAttributeAlt:KB,GroupAttributeRsp:LB,GroupAttributeErr:MB,GroupAttributeKeysGet:NB,GroupAttributeKeysRet:OB,SubscribeUserStatus:PB,UnsubscribeUserStatus:QB,UserJoinNotice:RB,UserQuitNotice:SB,UserWaitNotice:TB,SubscribeResponse:UB,default:t}),WB=Math.ceil,yr=function(e){return function(r,s,d){var f=(r=String(jb(r))).length;return d=d===void 0?" ":String(d),(s=ta(s))<=f||d==""?r:(s-=f,(f=Pn.call(d,WB(s/d.length))).length>s&&(f=f.slice(0,s)),e?r+f:f+r)}},XB=yr(!1),YB=yr(!0),zr=/Version\/10(?:\.\d+){1,2}(?: [\w./]+)?(?: Mobile\/\w+)? Safari\//.test(De);N({target:"String",proto:!0,forced:zr},{padEnd:function(e){return YB(this,e,1<arguments.length?arguments[1]:void 0)}});var ZB=zf,Ar=function(e){return function(r){r=qb(r);for(var s,d=Dc(r),f=d.length,_=0,C=[];f>_;)s=d[_++],ka&&!ZB.call(r,s)||C.push(e?[s,r[s]]:r[s]);return C}},$B=Ar(!0),aC=Ar(!1);N({target:"Object",stat:!0},{entries:function(e){return $B(e)}});var bC=Fb.f,Br="".endsWith,cC=Math.min,Cr=dk("endsWith"),dC=!Cr&&!!function(){var e=bC(String.prototype,"endsWith");return e&&!e.writable}();N({target:"String",proto:!0,forced:!dC&&!Cr},{endsWith:function(e){var r=String(jb(this));ck(e);var s=1<arguments.length?arguments[1]:void 0,d=ta(r.length);return s=s===void 0?d:cC(ta(s),d),d=String(e),Br?Br.call(r,d,s):r.slice(s-d.length,s)===d}}),dh("match",1,function(e,r,s){return[function(d){var f=jb(this),_=d==null?void 0:d[e];return _!==void 0?_.call(d,f):new RegExp(d)[e](String(f))},function(d){var f=s(r,d,this);if(f.done)return f.value;if(d=va(d),f=String(this),!d.global)return Ke(d,f);var _=d.unicode;d.lastIndex=0;for(var C,P=[],x=0;(C=Ke(d,f))!==null;)C=String(C[0]),P[x]=C,C===""&&(d.lastIndex=xj(f,ta(d.lastIndex),_)),x++;return x===0?null:P}]});var eC=Fb.f,Dr="".startsWith,fC=Math.min,Er=dk("startsWith"),gC=!Er&&!!function(){var e=eC(String.prototype,"startsWith");return e&&!e.writable}();N({target:"String",proto:!0,forced:!gC&&!Er},{startsWith:function(e){var r=String(jb(this));ck(e);var s=ta(fC(1<arguments.length?arguments[1]:void 0,r.length)),d=String(e);return Dr?Dr.call(r,d,s):r.slice(s,s+d.length)===d}});var Nm=function(e){var r=/(%?)(%([jds]))/g,s=Array.prototype.slice.call(arguments,1);return s.length&&(e=e.replace(r,function(d,f,_,C){switch(_=s.shift(),C){case"s":_=""+_;break;case"d":_=Number(_);break;case"j":_=JSON.stringify(_)}return f?(s.unshift(_),d):_})),s.length&&(e+=" "+s.join(" ")),""+(e=e.replace(/%{2,2}/g,"%"))},hC=/\s/,iC=function(e){for(var r=e.length;r--&&hC.test(e.charAt(r)););return r},jC=/^\s+/,Fr=NaN,kC=/^[-+]0x[0-9a-f]+$/i,lC=/^0b[01]+$/i,mC=/^0o[0-7]+$/i,nC=parseInt,gl=function(e){if(typeof e=="number")return e;if(ie(e))return Fr;if(lb(e)&&(e=typeof e.valueOf=="function"?e.valueOf():e,e=lb(e)?e+"":e),typeof e!="string")return e===0?e:+e;e=e&&e.slice(0,iC(e)+1).replace(jC,"");var r=lC.test(e);return r||mC.test(e)?nC(e.slice(2),r?2:8):kC.test(e)?Fr:+e},oC=Math.max,pC=Math.min,qC=function(e,r,s){function d(_o){var _s=x,_c=B;return x=B=void 0,_n=_o,_t=e.apply(_c,_s)}function f(_o){var _s=_o-Wt;return _o-=_n,Wt===void 0||_s>=r||0>_s||Ei&&_o>=Di}function _(){var _o=Cb.Date.now();if(f(_o))return C(_o);var _s=setTimeout,_c=_o-_n;_o=r-(_o-Wt),_c=Ei?pC(_o,Di-_c):_o,ue=_s(_,_c)}function C(_o){return ue=void 0,_a&&x?d(_o):(x=B=void 0,_t)}function P(){var _o=Cb.Date.now(),_s=f(_o);if(x=arguments,B=this,Wt=_o,_s){if(ue===void 0)return _n=_o=Wt,ue=setTimeout(_,r),_i?d(_o):_t;if(Ei)return clearTimeout(ue),ue=setTimeout(_,r),d(Wt)}return ue===void 0&&(ue=setTimeout(_,r)),_t}var x,B,_t,ue,Wt,_n=0,_i=!1,Ei=!1,_a=!0;if(typeof e!="function")throw new TypeError("Expected a function");if(r=gl(r)||0,lb(s)){_i=!!s.leading;var Di=(Ei="maxWait"in s)?oC(gl(s.maxWait)||0,r):Di;_a="trailing"in s?!!s.trailing:_a}return P.cancel=function(){ue!==void 0&&clearTimeout(ue),_n=0,x=Wt=B=ue=void 0},P.flush=function(){return ue===void 0?_t:C(Cb.Date.now())},P},yc=function(e){function r(d,f){return W(this,r),m(n(d=s.call(this,Mm(d,f))),"originalError",void 0),m(n(d),"code",void 0),m(n(d),"serverCode",void 0),typeof f=="number"?d.code=f:typeof f=="string"?d.name=f:f!==void 0&&(f.originalError&&(d.originalError=f.originalError),f.code!==void 0&&(d.code=f.code),f.serverCode!==void 0&&(d.serverCode=f.serverCode)),d}la(r,e);var s=ma(r);return r}(ef(Error)),Ia=function(e){function r(d,f){return W(this,r),m(n(d=s.call(this,Mm(d,f))),"name","RtmInternalError"),m(n(d),"code",void 0),d.code=f,d}la(r,e);var s=ma(r);return r}(ef(Error)),Ph=function(){return function(e){function r(d){W(this,r);var f=Object.keys(d);return s.call(this,d[f[0]],f[0])}la(r,e);var s=ma(r);return r}(Ia)},Fa=Ph(),db=function(e){function r(){W(this,r);for(var d=arguments.length,f=Array(d),_=0;_<d;_++)f[_]=arguments[_];return m(n(d=s.call.apply(s,[this].concat(f))),"name","RtmTimeoutError"),d}la(r,e);var s=ma(r);return r}(yc),I=function(e){function r(){W(this,r);for(var d=arguments.length,f=Array(d),_=0;_<d;_++)f[_]=arguments[_];return m(n(d=s.call.apply(s,[this].concat(f))),"name","RtmInvalidArgumentError"),d}la(r,e);var s=ma(r);return r}(yc),K=function(e){function r(){W(this,r);for(var d=arguments.length,f=Array(d),_=0;_<d;_++)f[_]=arguments[_];return m(n(d=s.call.apply(s,[this].concat(f))),"name","RtmInvalidStatusError"),d}la(r,e);var s=ma(r);return r}(yc),hl=function(e){function r(){W(this,r);for(var d=arguments.length,f=Array(d),_=0;_<d;_++)f[_]=arguments[_];return m(n(d=s.call.apply(s,[this].concat(f))),"name","RtmInterruptedError"),d}la(r,e);var s=ma(r);return r}(yc),ib=function(e){function r(){W(this,r);for(var d=arguments.length,f=Array(d),_=0;_<d;_++)f[_]=arguments[_];return m(n(d=s.call.apply(s,[this].concat(f))),"name","RtmLimitExceededError"),d}la(r,e);var s=ma(r);return r}(yc),rC=function(e){function r(){W(this,r);for(var d=arguments.length,f=Array(d),_=0;_<d;_++)f[_]=arguments[_];return m(n(d=s.call.apply(s,[this].concat(f))),"name","RtmInvokeTooOftenError"),d}la(r,e);var s=ma(r);return r}(yc),da=function(e){function r(){W(this,r);for(var d=arguments.length,f=Array(d),_=0;_<d;_++)f[_]=arguments[_];return m(n(d=s.call.apply(s,[this].concat(f))),"name","RtmUnavailableError"),m(n(d),"serverCode",void 0),m(n(d),"statusCode",void 0),d}la(r,e);var s=ma(r);return r}(yc),Ye=function(e){function r(){W(this,r);for(var d=arguments.length,f=Array(d),_=0;_<d;_++)f[_]=arguments[_];return m(n(d=s.call.apply(s,[this].concat(f))),"name","RtmUnauthenticatedError"),m(n(d),"serverCode",void 0),d}la(r,e);var s=ma(r);return r}(yc),Wc=function(e){function r(){W(this,r);for(var d=arguments.length,f=Array(d),_=0;_<d;_++)f[_]=arguments[_];return m(n(d=s.call.apply(s,[this].concat(f))),"name","RtmUnknownError"),d}la(r,e);var s=ma(r);return r}(yc),Sa=function(e){return e instanceof db||e instanceof pb},sa=function(e){return e instanceof yc},Yd=function(e,r,s){return['Executing "%s.%s" timed out after %ds',e,r,s/1e3]},Lm=new Map,sC=function(){var e=new Date;return"".concat(e.toISOString().split("T")[1].replace(/\..+/,""),".").concat(e.getMilliseconds())},xf=Object.keys,Hg=Object.entries.bind(Object),Cg=function(e){return typeof e=="string"?e.endsWith(".")?e:"".concat(e,"."):e},Sm=function(e){for(var r="",s=(e=new Uint8Array(e)).byteLength,d=-1;++d<s;)r+=String.fromCharCode(e[d]);return r=btoa(r),"data:;base64,".concat(r)},tC=R(function(){return new Date(NaN).toJSON()!==null||Date.prototype.toJSON.call({toISOString:function(){return 1}})!==1});N({target:"Date",proto:!0,forced:tC},{toJSON:function(e){e=Qa(this);var r=lc(e);return typeof r!="number"||isFinite(r)?e.toISOString():null}}),N({target:"URL",proto:!0,enumerable:!0},{toJSON:function(){return URL.prototype.toString.call(this)}});var $t=Object.prototype.hasOwnProperty,Gr=function(e,r,s){return JSON.stringify(Ym(e),r,s)};Gr.ensureProperties=Ym;var uC=function(e,r){r=r||{};var s=X(e);if(s==="string"&&0<e.length)return au(e);if(s==="number"&&isFinite(e))return r.long?e=864e5<=(r=Math.abs(e))?Jg(e,r,864e5,"day"):36e5<=r?Jg(e,r,36e5,"hour"):6e4<=r?Jg(e,r,6e4,"minute"):1e3<=r?Jg(e,r,1e3,"second"):e+" ms":e=864e5<=(r=Math.abs(e))?Math.round(e/864e5)+"d":36e5<=r?Math.round(e/36e5)+"h":6e4<=r?Math.round(e/6e4)+"m":1e3<=r?Math.round(e/1e3)+"s":e+"ms",e;throw Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))},vC=function(e){function r(f){function _(){for(var x=arguments.length,B=Array(x),_t=0;_t<x;_t++)B[_t]=arguments[_t];if(_.enabled){x=Number(new Date),_.diff=x-(C||x),_.prev=C,C=_.curr=x,B[0]=r.coerce(B[0]),typeof B[0]!="string"&&B.unshift("%O");var ue=0;B[0]=B[0].replace(/%([a-zA-Z%])/g,function(Wt,_n){return Wt==="%%"?"%":(ue++,typeof(_n=r.formatters[_n])=="function"&&(Wt=_n.call(_,B[ue]),B.splice(ue,1),ue--),Wt)}),r.formatArgs.call(_,B),(_.log||r.log).apply(_,B)}}var C,P=null;return _.namespace=f,_.useColors=r.useColors(),_.color=r.selectColor(f),_.extend=s,_.destroy=r.destroy,Object.defineProperty(_,"enabled",{enumerable:!0,configurable:!1,get:function(){return P===null?r.enabled(f):P},set:function(x){P=x}}),typeof r.init=="function"&&r.init(_),_}function s(f,_){return(f=r(this.namespace+(_===void 0?":":_)+f)).log=this.log,f}function d(f){return f.toString().substring(2,f.toString().length-2).replace(/\.\*\?$/,"*")}return r.debug=r,r.default=r,r.coerce=function(f){return f instanceof Error?f.stack||f.message:f},r.disable=function(){var f=[].concat(G(r.names.map(d)),G(r.skips.map(d).map(function(_){return"-"+_}))).join(",");return r.enable(""),f},r.enable=function(f){r.save(f),r.names=[],r.skips=[];var _,C=(typeof f=="string"?f:"").split(/[\s,]+/),P=C.length;for(_=0;_<P;_++)C[_]&&((f=C[_].replace(/\*/g,".*?"))[0]==="-"?r.skips.push(new RegExp("^"+f.substr(1)+"$")):r.names.push(new RegExp("^"+f+"$")))},r.enabled=function(f){if(f[f.length-1]==="*")return!0;var _,C=0;for(_=r.skips.length;C<_;C++)if(r.skips[C].test(f))return!1;for(C=0,_=r.names.length;C<_;C++)if(r.names[C].test(f))return!0;return!1},r.humanize=uC,r.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(e).forEach(function(f){r[f]=e[f]}),r.names=[],r.skips=[],r.formatters={},r.selectColor=function(f){for(var _=0,C=0;C<f.length;C++)_=(_<<5)-_+f.charCodeAt(C),_|=0;return r.colors[Math.abs(_)%r.colors.length]},r.enable(r.load()),r},Hr=$a(function(e,r){r.formatArgs=function(d){if(d[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+d[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),this.useColors){var f="color: "+this.color;d.splice(1,0,f,"color: inherit");var _=0,C=0;d[0].replace(/%[a-zA-Z%]/g,function(P){P!=="%%"&&(_++,P==="%c"&&(C=_))}),d.splice(C,0,f)}},r.save=function(d){try{d?r.storage.setItem("debug",d):r.storage.removeItem("debug")}catch{}},r.load=function(){try{var d=r.storage.getItem("debug")}catch{}return!d&&typeof process<"u"&&"env"in process&&(d={}.DEBUG),d},r.useColors=function(){return!(typeof window>"u"||!window.process||window.process.type!=="renderer"&&!window.process.__nwjs)||(typeof navigator>"u"||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&(typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&31<=parseInt(RegExp.$1,10)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))};t:{try{var s=localStorage;break t}catch{}s=void 0}r.storage=s,r.destroy=function(){var d=!1;return function(){d||(d=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}}(),r.colors="#0000CC #0000FF #0033CC #0033FF #0066CC #0066FF #0099CC #0099FF #00CC00 #00CC33 #00CC66 #00CC99 #00CCCC #00CCFF #3300CC #3300FF #3333CC #3333FF #3366CC #3366FF #3399CC #3399FF #33CC00 #33CC33 #33CC66 #33CC99 #33CCCC #33CCFF #6600CC #6600FF #6633CC #6633FF #66CC00 #66CC33 #9900CC #9900FF #9933CC #9933FF #99CC00 #99CC33 #CC0000 #CC0033 #CC0066 #CC0099 #CC00CC #CC00FF #CC3300 #CC3333 #CC3366 #CC3399 #CC33CC #CC33FF #CC6600 #CC6633 #CC9900 #CC9933 #CCCC00 #CCCC33 #FF0000 #FF0033 #FF0066 #FF0099 #FF00CC #FF00FF #FF3300 #FF3333 #FF3366 #FF3399 #FF33CC #FF33FF #FF6600 #FF6633 #FF9900 #FF9933 #FFCC00 #FFCC33".split(" "),r.log=console.debug||console.log||function(){},e.exports=vC(r),e.exports.formatters.j=function(d){try{return JSON.stringify(d)}catch(f){return"[UnexpectedJSONParseError]: "+f.message}}}),Ir=Hr("RTM:DEBUG"),Ze;Ir.enabled=!1,function(e){e[e.Uploading=0]="Uploading",e[e.Free=1]="Free"}(Ze||(Ze={}));var wC=function(){function e(r){W(this,e),m(this,"uploadRequest",void 0),m(this,"uploadState",void 0),m(this,"uploadResendCount",void 0),m(this,"LogCache",void 0),m(this,"LogsToPost",void 0),m(this,"processId",void 0),m(this,"sdkVersion",void 0),m(this,"logId",void 0),m(this,"rtmConfig",void 0),this.processId=r.processId,this.sdkVersion=r.sdkVersion,this.rtmConfig=r.rtmConfig,this.uploadRequest=r.uploadRequest,this.uploadState=Ze.Free,this.uploadResendCount=0,this.LogCache=[],this.LogsToPost=[],this.logId=0}return Ha(e,[{key:"upload",value:function(r){this.LogCache.push(r),this.uploadState===Ze.Free&&(this.LogsToPost=40>this.LogCache.length?this.LogCache.splice(0,this.LogCache.length):this.LogCache.splice(0,40),this.postLog(this.LogsToPost))}},{key:"postLog",value:function(r){var s=this;this.uploadState=Ze.Uploading,setTimeout(J(w.mark(function d(){var f,_,C;return w.wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return f={sdk_version:s.sdkVersion,process_id:s.processId,payload:JSON.stringify(r)},P.prev=1,P.next=4,s.uploadRequest(f,(_=s.rtmConfig.enableCloudProxy)!==null&&_!==void 0&&_);case 4:if(!Uk){P.next=6;break}throw Error("RTM is busy");case 6:P.next=13;break;case 8:return P.prev=8,P.t0=P.catch(1),C=2>s.uploadResendCount++?2e3:1e4,setTimeout(function(){return s.postLog(s.LogsToPost)},C),P.abrupt("return");case 13:if(Ir('The logs uploaded for "process-'.concat(gg,'"')),s.LogCache.length!==0){P.next=17;break}return s.uploadState=Ze.Free,P.abrupt("return");case 17:s.uploadResendCount=0,s.LogsToPost=40>s.LogCache.length?s.LogCache.splice(0,s.LogCache.length):s.LogCache.splice(0,40),s.postLog(s.LogsToPost);case 20:case"end":return P.stop()}},d,null,[[1,8]])})),Zd.getParameter("LOG_UPLOAD_INTERVAL"))}}]),e}(),Jr=function(e,r,s,d,f,_,C,P){var x=0;for(C=!!C&&Id(C,P,3);x<d;){if(x in s){if(P=C?C(s[x],x,r):s[x],0<_&&gd(P))f=Jr(e,r,P,ta(P.length),f,_-1)-1;else{if(9007199254740991<=f)throw TypeError("Exceed the acceptable array length");e[f]=P}f++}x++}return f},xC=Jr;N({target:"Array",proto:!0},{flat:function(){var e=arguments.length?arguments[0]:void 0,r=Qa(this),s=ta(r.length),d=Sg(r,0);return d.length=xC(d,r,r,s,0,e===void 0?1:$b(e)),d}}),N({target:"Object",stat:!0},{values:function(e){return aC(e)}});var yC=["CODE"],Db,ud,F;(function(e){e.CHINA="CN",e.ASIA="AS",e.NORTH_AMERICA="NA",e.EUROPE="EU",e.JAPAN="JP",e.INDIA="IN",e.OCEANIA="OC",e.SOUTH_AMERICA="SA",e.AFRICA="AF",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL"})(F||(F={}));var zC={CN:F.CHINA,NA:F.NORTH_AMERICA,EU:F.EUROPE,AS:F.ASIA,JP:F.JAPAN,IN:F.INDIA,GLOB:F.GLOBAL,AF:F.AFRICA,OC:F.OVERSEA,OVS:F.OVERSEA,SA:F.SOUTH_AMERICA},Kg=Wm((Db={},m(Db,F.ASIA,{CODE:F.ASIA,AP_DOMAINS:["ap-web-1-asia.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-asia.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_AP:["proxy-ap-web-asia.agora.io"],PROXY_NGINX:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]}),m(Db,F.NORTH_AMERICA,{CODE:F.NORTH_AMERICA,AP_DOMAINS:["ap-web-1-north-america.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-north-america.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_AP:["proxy-ap-web-america.agora.io"],PROXY_NGINX:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]}),m(Db,F.EUROPE,{CODE:F.EUROPE,AP_DOMAINS:["ap-web-1-europe.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-europe.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_AP:["proxy-ap-web-europe.agora.io"],PROXY_NGINX:["europe.webrtc-cloud-proxy.sd-rtn.com"]}),m(Db,F.JAPAN,{CODE:F.JAPAN,AP_DOMAINS:["ap-web-1-japan.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-japan.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_AP:["proxy-ap-web-japan.agora.io"],PROXY_NGINX:["japan.webrtc-cloud-proxy.sd-rtn.com"]}),m(Db,F.INDIA,{CODE:F.INDIA,AP_DOMAINS:["ap-web-1-india.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-india.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_AP:["proxy-ap-web-india.agora.io"],PROXY_NGINX:["india.webrtc-cloud-proxy.sd-rtn.com"]}),m(Db,F.OVERSEA,{CODE:F.OVERSEA,AP_DOMAINS:["ap-web-1-oversea.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_AP:["proxy-ap-web-oversea.agora.io"],PROXY_NGINX:["webrtc-cloud-proxy.agora.io"]}),m(Db,F.GLOBAL,{CODE:F.GLOBAL,AP_DOMAINS:["ap-web-1.agora.io","ap-web-2.agora.io"],AP_BACKUP_DOMAINS:["ap-web-3.agora.io","ap-web-4.agora.io"],EVENT_REPORT_DOMAIN:["webcollector-rtm.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["webcollector-1.agora.io"],LOG_UPLOAD_SERVER:["logservice-rtm.agora.io"],PROXY_AP:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],PROXY_NGINX:["webrtc-cloud-proxy.sd-rtn.com"]}),m(Db,F.OCEANIA,{CODE:F.OCEANIA,AP_DOMAINS:["ap-web-1-oceania.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-oceania.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_AP:["proxy-ap-web-oceania.agora.io"],PROXY_NGINX:["oceania.webrtc-cloud-proxy.sd-rtn.com"]}),m(Db,F.SOUTH_AMERICA,{CODE:F.SOUTH_AMERICA,AP_DOMAINS:["ap-web-1-south-america.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-south-america.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_AP:["proxy-ap-web-south-america.agora.io"],PROXY_NGINX:["south-america.webrtc-cloud-proxy.sd-rtn.com"]}),m(Db,F.AFRICA,{CODE:F.AFRICA,AP_DOMAINS:["ap-web-1-africa.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-africa.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_AP:["proxy-ap-web-africa.agora.io"],PROXY_NGINX:["africa.webrtc-cloud-proxy.sd-rtn.com"]}),m(Db,F.CHINA,{CODE:F.CHINA,AP_DOMAINS:["webrtc2-2.ap.sd-rtn.com"],AP_BACKUP_DOMAINS:["webrtc2-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_AP:["proxy-ap-web.agoraio.cn"],PROXY_NGINX:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]}),Db)),yf=(ud={},m(ud,F.ASIA,[F.CHINA,F.JAPAN,F.INDIA]),m(ud,F.EUROPE,[]),m(ud,F.NORTH_AMERICA,[]),m(ud,F.SOUTH_AMERICA,[]),m(ud,F.OCEANIA,[]),m(ud,F.AFRICA,[]),ud),Kr=[F.OVERSEA,F.GLOBAL,F.CHINA,F.NORTH_AMERICA,F.EUROPE,F.ASIA,F.JAPAN,F.INDIA,F.OCEANIA,F.SOUTH_AMERICA,F.AFRICA],Zm=function(e){return Object.values(yf).flat().includes(e)},cu=function(e){var r;return(r=Hg(yf).find(function(s){return(s=ra(s,2))[0],s[1].includes(e)}))===null||r===void 0?void 0:r[0]},AC=function(e){return e.sort(function(r,s){return Kr.indexOf(r)-Kr.indexOf(s)})},xe=function(e){var r=new Set;if((e=AC(e).slice(0,3).map(function(s){var d=Kg[s];if(d===void 0)throw new Ia("invalid area key");return s=d.CODE,d=ff(d,yC),r.add(s),d})).length===0)throw new Ia("areas cannot be empty");return ua({CODES:r},e.reduce(function(s,d){for(var f=0,_=Hg(s);f<_.length;f++){var C=ra(_[f],2),P=C[0];C=C[1],s[P]=Array.from(new Set([].concat(G(d[P]),G(C))))}return s}))},M,Lr=function(){var e=J(w.mark(function r(s,d){var f,_,C,P,x,B=arguments;return w.wrap(function(_t){for(;;)switch(_t.prev=_t.next){case 0:if(!(2<(_=2<B.length&&B[2]!==void 0?B[2]:0))){_t.next=3;break}return _t.abrupt("return");case 3:return C={withCredentials:!0,body:s,timeout:2e4},P=0<_?(M==null?void 0:M.LOG_UPLOAD_SERVER[0])||"rtm.logservice.sd-rtn.com":(M==null?void 0:M.LOG_UPLOAD_SERVER[0])||"logservice-rtm.agora.io",x=d?"https://".concat((f=M==null?void 0:M.PROXY_NGINX[0])!==null&&f!==void 0?f:"webrtc-cloud-proxy.sd-rtn.com","/ls/?h=").concat(P,"&p=443&d=upload/v1"):"https://".concat(P,"/upload/v1"),_t.next=8,te(x,C).catch(function(ue){return Lr(s,d,_+1)});case 8:case"end":return _t.stop()}},r)}));return function(r,s){return e.apply(this,arguments)}}(),Mr=new wC({processId:"process-".concat(gg),sdkVersion:"Agora_RTM_SDK_for_Web_".concat("v1.4.3-17-g1e27aa38"),uploadRequest:Lr,rtmConfig:{}}),il="text payload rawMessage thumbnail attributeInfos keys value extra".split(" "),Nr="account ticket uid detail token account fileName cname user group key origin users src dst lastUpdateUserId channel cert wan_ip".split(" "),Or="serverReceivedTs isOfflineMessage enableHistoricalMessaging enableOfflineMessaging hasPeerReceived messageType enableNotificationToChannelMembers lastUpdateTs".split(" "),BC="ChannelMessage MemberLeft MessageFromPeer LocalInvitationRefused LocalInvitationAccepted RemoteInvitationCanceled PeersOnlineStatusChanged AttributesUpdated MemberJoined".split(" "),ye=function(e){if(typeof e=="string")return oa(e);if(Array.isArray(e)&&e.every(function(_){return typeof _=="string"}))return e.map(function(_){return oa(_)});if(!Il(e)){for(var r={},s=0;s<Or.length;s++){var d=Or[s];d in e&&(r[d]=e[d])}if(0<Object.keys(r).length)return r;if(5>Object.keys(e).length){for(s=0,e=Object.entries(e);s<e.length;s++){var f=ra(e[s],2);d=f[0],f=f[1],il.includes(d)?r[d]="[Hidden Info]":r[oa(d)]=typeof f=="string"?oa(f):"[Sensitive Info]"}return r}return"[Sensitive Info]"}return e},Pr=function(e){return X(e)==="object"?yd(e)?Vm(fe(e,5),il,Nr):e.constructor&&e.constructor.name:e},Qr=function(e,r){return e instanceof Error?e.message:typeof e!="string"?JSON.stringify(Vm(fe(e,5),il,Nr)):(r=r.map(function(s){return s instanceof Error?s.message:X(s)==="object"?Gr(Array.isArray(s)?s.map(Pr):Pr(s)):s}),Nm.apply(void 0,[e.replace(/%[%Oo]/g,function(s){return s==="%%"?"%":s==="%o"||s==="%O"?"%s":s})].concat(G(r))))},CC=1,Rr=function(e,r,s){var d=Hr(e);return d.enabled=!0,d.log=s,d.useColors=!1,function(f){for(var _=arguments.length,C=Array(1<_?_-1:0),P=1;P<_;P++)C[P-1]=arguments[P];if(r.enableLogUpload){_=Cg(f);var x=Qr(_,C);Mr.upload({log_item_id:"".concat(CC++),log_level:e,payload_str:"[".concat(sC(),"] ").concat(e," - ").concat(256<x.length?x.slice(0,256):x)})}switch(_=function(B){var _t=x||Qr(Cg(f),C),ue=Nc.LOG_HANDLER;typeof ue=="function"&&ue({level:B,message:_t}),d(_t)},e){case"RTM:INFO":r.logFilter.info&&_("log");break;case"RTM:WARN":r.logFilter.warn&&_("warning");break;case"RTM:ERROR":r.logFilter.error&&_("error");break;case"RTM:TRACK":r.logFilter.track&&_("log");break;case"RTM:MSG:RECV":case"RTM:MSG:SEND":r.logFilter.debug&&_("debug");break;case"RTM:DEBUG":r.logFilter.debug&&_("debug")}}},jl,Sr=function(e){return function(r){var s=jl===1||e===void 0?"":"Ins#".concat(e," ");return"".concat(s).concat(r)}},kl=function(e,r,s){var d=Sr(jl);return Rr("RTM:".concat(r),s,function(f){return e(d(f))})},tb=function(){return function(e){function r(d,f){var _=2<arguments.length&&arguments[2]!==void 0&&arguments[2];W(this,r);var C=s.call(this);if(m(n(C),"logError",void 0),m(n(C),"invokeTracker",void 0),m(n(C),"resultTracker",void 0),m(n(C),"errorTracker",void 0),m(n(C),"eventTracker",void 0),m(n(C),"info",void 0),m(n(C),"warn",void 0),m(n(C),"log",void 0),m(n(C),"genLogger",void 0),m(n(C),"loggerId",void 0),m(n(C),"logger",void 0),m(n(C),"name",void 0),C.logger=d,C.name=f,C.loggerId=d.loggerId,C.info=d.info,C.warn=d.warn,C.logError=d.logError,C.genLogger=d.genLogger,C.log=d.genLogger("RTM:DEBUG","<".concat(f,"> ")),C.invokeTracker=d.genTracker("Invoke"),C.eventTracker=d.genTracker("Event"),C.resultTracker=d.genTracker("Result"),C.errorTracker=d.genTracker("Error"),_){var P=C.emit.bind(n(C));C.emit=function(){for(var x=arguments.length,B=Array(x),_t=0;_t<x;_t++)B[_t]=arguments[_t];x=B[0],_t=B.slice(1);var ue=BC.includes(x);C.eventTracker.apply(C,["%s: ".concat(0<_t.length?"%s emitted with args: ".concat(_t.map(function(){return"%o"})):"%s emitted"),f,x].concat(G(ue?_t.map(ye):_t)));try{P.apply(void 0,B)}catch(Wt){C.logError("Caught in the callback function of the event %s",x,Wt)}}}return C}la(r,e);var s=ma(r);return r}(ea)},DC=function(e){return kl(console.log.bind(console),"INFO",e)},EC=function(e){return kl(console.warn.bind(console),"WARN",e)},FC=function(e){return kl(console.error.bind(console),"ERROR",e)},Tr=function(e,r){return function(s){var d=1<arguments.length&&arguments[1]!==void 0?arguments[1]:"",f=Sr(e),_=console.debug.bind(console),C=Rr(s,r,function(P){return _(f(P))});return function(P){for(var x=arguments.length,B=Array(1<x?x-1:0),_t=1;_t<x;_t++)B[_t-1]=arguments[_t];return C.apply(void 0,[d+P].concat(B))}}},GC=function(e,r){return function(s){return Tr(e,r)("RTM:TRACK","[".concat(s,"] "))}},Li=t.URI,eu=Oh,HC=ff(VB,["Wrapper"]),$m=Gk(HC,"URI"),Ur=function(e,r){var s=-1,d=e.length,f=d-1;for(r=r===void 0?d:r;++s<r;){var _=e[d=nr(s,f)];e[d]=e[s],e[s]=_}return e.length=r,e},IC=function(e){return Ur(Xh(e))},JC=function(e){return Ur(Ni(e))},$e=function(e){return(Va(e)?IC:JC)(e)},af={0:9591,1:9593},$d=function(e){return"https://".concat(e,"/api/v1")},KC=bb.apply(void 0,G($e(["web-1.ap.sd-rtn.com","web-2.ap.sd-rtn.com"].map($d)))),LC=bb.apply(void 0,G($e(["ap-web-1.agora.io","ap-web-2.agora.io"].map($d)))),MC=bb.apply(void 0,G($e(["web-3.ap.sd-rtn.com","web-4.ap.sd-rtn.com"].map($d)))),NC=bb.apply(void 0,G($e(["ap-web-3.agora.io","ap-web-4.agora.io"].map($d)))),ll=Ph(),ml=function(e){function r(d,f,_,C,P,x){W(this,r);var B=s.call(this,P,Ai("Socket-",P.loggerId));if(m(n(B),"isActiveClose",!1),m(n(B),"loggedIn",!1),m(n(B),"useNewDomain",void 0),m(n(B),"receivedPacket",new Pa),m(n(B),"open$",void 0),m(n(B),"input$",new Pa),m(n(B),"userJoin$",new Pa),m(n(B),"attemptsSinceLastError",0),m(n(B),"message$",new Pa),m(n(B),"socket$",void 0),m(n(B),"toClose",new Pa),m(n(B),"toReconnect",new Pa),m(n(B),"sendLogger",void 0),m(n(B),"receiveLogger",void 0),m(n(B),"ip",void 0),m(n(B),"env",void 0),m(n(B),"ticket",void 0),m(n(B),"context",void 0),m(n(B),"getDomain",function(){return an(B.ip,B.useNewDomain)}),m(n(B),"socketReconnector",function(Wt){var _n=function(_i){return B.attemptsSinceLastError+=1,B.warn("The %s of Env %d reconnecting %s",B.name,B.env,_i.message),Bc(3e3)};return Wt.pipe(Ga(function(_i){return B.log("socket connection closed"),B.loggedIn=!1,2<=B.attemptsSinceLastError?(B.warn("socket connection failure"),B.emit("connectionFailure"),B.close(),Z(_i)):B.isActiveClose?vb:(B.emit("reconnect"),B.useNewDomain=!B.useNewDomain,Z(_i))}),oe(function(_i){return _i.pipe(Cc(_n))}))}),B.ip=d,B.env=f,B.ticket=_,B.context=C,B.useNewDomain=x??.5<=Math.random(),B.sendLogger=B.genLogger("RTM:MSG:SEND"),B.receiveLogger=B.genLogger("RTM:MSG:RECV"),f!==0&&f!==1)throw new ll({ILLEGAL_RTM_ENV:"The env number is out of rtm env count"});if(!Gm(d))throw new ll({IP_NOT_VALID:"The ip from ap is not valid"});var _t=af[f];B.log("Opening websocket address %s for the Env %d",B.ip,B.env);var ue=Xb(B.input$,B.userJoin$.pipe(Rt(2)),B.message$).pipe(ba(function(Wt){return Oh.encode(Wt).finish()}));return d=Xb(St("",{protocols:[],makeWebSocket:function(){if(B.context.config.enableCloudProxy){if(B.context.cloudProxyServers.length===0)throw B.logError("No cloud proxy server to connect"),new da;var Wt="wss://".concat(an(bn(B.context.cloudProxyServers),!1),"/");Wt=we(Wt,"sid",B.context.sid),Wt=we(Wt,"remote_port",_t.toString()),Wt=we(Wt,"remote_ip",B.ip),Wt=we(Wt,"token",B.context.key),Wt=new WebSocket(Wt)}else Wt=new WebSocket("wss://".concat(B.getDomain(),":").concat(_t));return Wt.binaryType="arraybuffer",Wt}}),B.toReconnect),B.socket$=Ca(d,Tk.pipe(hb(15e3),Ga(function(Wt){return Sa(Wt)&&B.warn("socket open timed out"),Z(Wt)}))).pipe(ba(function(Wt){if(Wt instanceof Error)throw B.warn("Env_%d: Force reconnect the socket",B.env),Wt;return Wt(ue).pipe(ba(function(_n){return Oh.decode(new Uint8Array(_n))}))}),B.socketReconnector),B.open$=B.socket$.pipe(ca(function(Wt){B.log("Websocket opened",B.name),Wt.subscribe(function(_n){var _i=_n.data;_n=Li[_n.uri].slice(0,-3),_i=$m[_n].decode(_i);var Ei=HA({},Gk(_i,"toJSON"),function(_s,_c){return _c instanceof U?Km(_c):_c}),_a=!1;if((_i instanceof vr||_i instanceof ur)&&_i.instance.lessThanOrEqual(4294967295)&&(_a=!0),_i instanceof wr||_i instanceof xr){var Di=_i.instance,_o=_i.sequence;(_i.dialogue.lessThanOrEqual(4294967295)||Di.lessThanOrEqual(4294967295)||_o.lessThan(1))&&(_a=!0)}_a?B.warn("Env_%d: Illegal %s, abandoned %o",B.env,_n,Ei):(_n!=="Pong"&&B.receiveLogger("Env_%d: %s %o",B.env,_n,Ei),B.receivedPacket.next([_n,_i]))},function(){})}),qf(void 0),ob(B.toClose),pe()),B}la(r,e);var s=ma(r);return Ha(r,[{key:"address",get:function(){return"".concat(this.ip,":").concat(af[this.env])}},{key:"sendPacket",value:function(d,f){if(d!=="Ping"){var _=uc(f,function(C){return C instanceof U?Km(C):C});this.sendLogger("Env_%d: %s %o",this.env,d,_)}f=du(d,f),d==="UserJoin"?this.userJoin$.next(f):d==="Message"?this.message$.next(f):this.input$.next(f)}},{key:"close",value:function(){this.isActiveClose=!0,this.loggedIn=!1,this.toClose.next()}},{key:"fromReceived",value:function(d){var f=this;return this.receivedPacket.pipe(ca(function(_){var C=ra(_,2);_=C[0],C=C[1],_==="UserResp"&&(f.attemptsSinceLastError=0,f.loggedIn=!0),_==="UserDrop"&&f.emit("socketUserDrop",C)}),wb(function(_){return ra(_,1)[0]===d}),ba(function(_){return ra(_,2)[1]}))}},{key:"forceReconnect",value:function(){this.toReconnect.next(new ll({FORCE_RECONNECTING:"Connection seems broken, try force reconnecting"}))}}]),r}(tb());N({target:"String",proto:!0,forced:zr},{padStart:function(e){return XB(this,e,1<arguments.length?arguments[1]:void 0)}});var OC=function(e){var r=xf(Kg);e=Yt(e);for(var s=0;s<r.length;s++){var d=Kg[r[s]];if(d!=null&&d.AP_DOMAINS.includes(e)||d!=null&&d.AP_BACKUP_DOMAINS.includes(e)||d!=null&&d.PROXY_AP.includes(e))return[d.CODE]}return[F.CHINA,F.GLOBAL]},PC={INVALID_APP_ID:"Illegal App ID",NO_AUTHORIZED:"Signature verification failed",TOKEN_TIMEOUT:"Dynamic key expired",INVALID_TOKEN_UID:"UID in the security key(token) is not valid",APP_ID_NO_ACTIVATED:"The vendor is not activated",DYNAMIC_KEY_NOT_ENABLED:"The vendor did not enable the dynamic key, but uses the dynamic key",DYNAMIC_ENABLED_BUT_STATIC_KEY:"The vendor enabled the dynamic key, but uses the static key",TOKEN_EXPIRED:"The token has expired",INVALID_USER_ID:"The user ID to login does not match the token",FORBIDDEN_REGION:"Forbidden to access the request in this area",CANNOT_MEET_AREA_DEMAND:"Cannot allocate to meet the requirements of the given area limit"},Vr={5:"INVALID_APP_ID",7:"INVALID_USER_ID",9:"NO_AUTHORIZED",10:"TOKEN_TIMEOUT",11:"APP_ID_NO_ACTIVATED",12:"INVALID_TOKEN_UID",13:"TOKEN_EXPIRED",14:"DYNAMIC_KEY_NOT_ENABLED",15:"DYNAMIC_ENABLED_BUT_STATIC_KEY",18:"FORBIDDEN_REGION",19:"CANNOT_MEET_AREA_DEMAND"},QC=[100,101,102],Qh=/web-(\d)/,Wr=function(e){function r(d,f){var _=2<arguments.length&&arguments[2]!==void 0&&arguments[2];W(this,r);var C=s.call(this,f,"AccessPoint");return m(n(C),"handleUniLbsError",function(P,x){var B=P;if(4<P.toString().length){var _t=P.toString().padStart(8,"0"),ue=parseInt(_t.slice(0,4),10);if(_t=parseInt(_t.slice(4,8),10),ue===201)B=_t;else if(ue===101&&!QC.includes(_t))return Z(Error("service is currently unavailable"))}if(ue=B.toString(),!Object.keys(Vr).includes(ue))return(P=new da(["Login is rejected by the server. The response code is %d",P],jg)).serverCode=B,Z(P);switch(ue=Vr[ue],B=PC[ue],ue){case"INVALID_APP_ID":case"APP_ID_NO_ACTIVATED":return(x=new Ye(B,$q)).serverCode=P,Z(x);case"INVALID_USER_ID":return(x=new Ye(B,Jh)).serverCode=P,Z(x);case"TOKEN_EXPIRED":case"TOKEN_TIMEOUT":return(x=new Ye(B,Kh)).serverCode=P,Z(x);case"NO_AUTHORIZED":case"INVALID_TOKEN_UID":case"DYNAMIC_KEY_NOT_ENABLED":case"DYNAMIC_ENABLED_BUT_STATIC_KEY":return(x=new Ye(B,ar)).serverCode=P,Z(x);case"CANNOT_MEET_AREA_DEMAND":return(x=OC(x)).forEach(function(Wt){return C.failedAreas.add(Wt)}),C.failedAreas.size===(M===void 0?2:M.CODES.size)?((x=new I(B,jg)).serverCode=P,Z(x)):Z(Error("ap ".concat(x.join(", ")," cannot meet requirement")));case"FORBIDDEN_REGION":return(x=new da(B,jg)).serverCode=P,Z(x);default:return Z(Im("ApResErrType",ue))}}),m(n(C),"getApEdgeInfo$",void 0),m(n(C),"getApEdgeInfoEndFirst$",void 0),m(n(C),"apFinish$",new Pa),m(n(C),"retryCount",0),m(n(C),"failedAreas",new Set),m(n(C),"usedUrl",[]),m(n(C),"newDomainUsed",!1),m(n(C),"backupNewDomainUsed",!1),m(n(C),"genUrl",function(){return M===void 0?mi.apply(void 0,G($e([KC,LC]))).pipe(ni(function(P){return bb.apply(void 0,G(P))})):bb.apply(void 0,G(M.AP_DOMAINS.slice(0,3).map($d)))}),m(n(C),"genBackupUrl",function(){return M===void 0?mi.apply(void 0,G($e([MC,NC]))).pipe(ni(function(P){return bb.apply(void 0,G(P))})):bb.apply(void 0,G(M.AP_BACKUP_DOMAINS.slice(0,3).map($d)))}),m(n(C),"getApUrl$",function(P){var x,B;return C.genUrl().pipe(wb(function(_t){return(!C.newDomainUsed||!_t.includes("sd-rtn.com"))&&(_t.includes("sd-rtn.com")&&(C.newDomainUsed=!0),!dl(C.usedUrl,function(ue){var Wt;return ue===((Wt=_t.match(Qh))===null||Wt===void 0?void 0:Wt[1])}))}),ca(function(_t){var ue;M===void 0&&typeof(_t=(ue=_t.match(Qh))===null||ue===void 0?void 0:ue[1])=="string"&&C.usedUrl.push(_t)}),Ka(P?Math.max(Nc.RECONNECTING_AP_NUM,(x=M==null?void 0:M.CODES.size)!==null&&x!==void 0?x:0):(B=M==null?void 0:M.CODES.size)!==null&&B!==void 0?B:2),Dd(function(){return r.runOutOfUrlSymbol}),Ga(function(_t,ue){return C.newDomainUsed=!1,_t===r.runOutOfUrlSymbol?(C.usedUrl=[],ue):Z(_t)}))}),m(n(C),"getBackupApUrl$",function(P){var x,B;return C.genBackupUrl().pipe(wb(function(_t){return(!C.backupNewDomainUsed||!_t.includes("sd-rtn.com"))&&(_t.includes("sd-rtn.com")&&(C.backupNewDomainUsed=!0),!dl(C.usedUrl,function(ue){var Wt;return ue===((Wt=_t.match(Qh))===null||Wt===void 0?void 0:Wt[1])}))}),ca(function(_t){var ue;M===void 0&&typeof(_t=(ue=_t.match(Qh))===null||ue===void 0?void 0:ue[1])=="string"&&C.usedUrl.push(_t)}),Ka(P?Math.max(Nc.RECONNECTING_AP_NUM,(x=M==null?void 0:M.CODES.size)!==null&&x!==void 0?x:0):(B=M==null?void 0:M.CODES.size)!==null&&B!==void 0?B:2),Dd(function(){return r.runOutOfUrlSymbol}),Ga(function(_t,ue){return C.backupNewDomainUsed=!1,_t===r.runOutOfUrlSymbol?(C.usedUrl=[],ue):Z(_t)}))}),m(n(C),"getProxyApUrl$",function(P){var x,B;return bb.apply(void 0,G(((M==null?void 0:M.PROXY_AP.slice(0,3))||["ap-proxy-1.agora.io","ap-proxy-2.agora.io"]).map($d))).pipe(Ka(P?Math.max(Nc.RECONNECTING_AP_NUM,(x=M==null?void 0:M.CODES.size)!==null&&x!==void 0?x:0):(B=M==null?void 0:M.CODES.size)!==null&&B!==void 0?B:2))}),m(n(C),"context",void 0),m(n(C),"fetchCloudProxy",function(P,x){var B=Ai("AP-",C.loggerId);C.log("The AccessPoint requests %s(%s)",P,B);var _t=new AbortController;return C.apFinish$.pipe(Ka(1)).subscribe(function(){return _t.abort()}),ad(J(w.mark(function ue(){var Wt;return w.wrap(function(_n){for(;;)switch(_n.prev=_n.next){case 0:return Wt=Ag(0,Number.MAX_SAFE_INTEGER),C.log("%s request opid: %d",B,Wt),_n.abrupt("return",te(P,{headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"90","Content-Type":"application/json"},body:{sid:C.context.sid,opid:Wt,appid:C.context.appId,client_ts:Math.ceil(Date.now()/1e3),request_bodies:[{uri:22,buffer:{service_ids:[7,16],key:x??C.context.key,cname:C.context.uid,uid:0,detail:ua({},M===void 0?{11:[F.CHINA,F.GLOBAL].join()}:{11:Array.from(M.CODES).map(function(_i){return _i===F.OVERSEA?"".concat(F.ASIA,",").concat(F.EUROPE,",").concat(F.AFRICA,",").concat(F.NORTH_AMERICA,",").concat(F.SOUTH_AMERICA,",").concat(F.OCEANIA):_i}).join(",")})}}]},signal:_t.signal}));case 3:case"end":return _n.stop()}},ue)}))).pipe(Ga(function(ue){return ue.name!=="AbortError"&&(C.logError(ue),C.warn("The AP server %s request failure",P,ue)),vb}),cb(function(){var ue=J(w.mark(function Wt(_n){var _i,Ei,_a,Di,_o,_s,_c,_m,Qm,tE,aE,CE,lE,gE,cE,_E,iE,rE,vf;return w.wrap(function(Fg){for(;;)switch(Fg.prev=Fg.next){case 0:if(_i=_n.responseText,Ei=JSON.parse(_i),C.log("The %s response is %o",B,Ei),((_a=Ei.response_body)===void 0||_a.length===0||_a.some(function(_d){var _f;return((_f=_d.buffer)===null||_f===void 0?void 0:_f.code)===void 0||_d.uri!==23}))&&Z(new da("cloud proxy response_body not valid",jg)),(Di=_a.filter(function(_d){return _d.buffer.code!==0})).length===0){Fg.next=14;break}if((_o=Di.find(function(_d){return _d.buffer.flag===128}))===void 0){Fg.next=12;break}return Fg.abrupt("return",C.handleUniLbsError(_o.buffer.code,P));case 12:return C.logError("cloud proxy error response"),Fg.abrupt("return",C.handleUniLbsError(Di[0].buffer.code,P));case 14:for(_s=[],_c=0;_c<_a.length;_c++)if(((tE=_a[_c])==null||(_m=tE.buffer)===null||_m===void 0?void 0:_m.flag)===262144)(aE=tE.buffer)===null||aE===void 0||(CE=aE.edges_services)===null||CE===void 0||(lE=CE.forEach)===null||lE===void 0||lE.call(CE,function(_d){Gm(_d=_d.ip)&&C.context.cloudProxyServers.indexOf(_d)===-1&&(C.log("got cloud proxy server: %s",_d),C.context.cloudProxyServers.push(_d))});else if((tE==null||(Qm=tE.buffer)===null||Qm===void 0?void 0:Qm.flag)===128){for(iE=function(_d,_f){var uE=_f[_d];_s.some(function(dE){return dE.ip===uE.ip})||_s.push({ip:uE.ip,ticket:tE.buffer.cert})},rE=0,vf=tE.buffer.edges_services;rE<vf.length;rE++)iE(rE,vf);C.context.rtmArea=(gE=(cE=tE.buffer)===null||cE===void 0||(_E=cE.detail)===null||_E===void 0?void 0:_E[9])!==null&&gE!==void 0?gE:""}return Fg.abrupt("return",bb.apply(void 0,G(_s).concat([fg])));case 19:case"end":return Fg.stop()}},Wt)}));return function(Wt){return ue.apply(this,arguments)}}()),Ga(function(ue){return sa(ue)?Z(ue):vb}),tg(),wb(function(ue){return ue!==void 0&&typeof ue.ip=="string"&&typeof ue.ticket=="string"}))}),m(n(C),"fetchAp",function(P,x){var B=Ai("AP-",C.loggerId);C.log("The AccessPoint requests %s(%s)",P,B);var _t=new AbortController;return C.apFinish$.pipe(Ka(1)).subscribe(function(){return _t.abort()}),ad(J(w.mark(function ue(){var Wt;return w.wrap(function(_n){for(;;)switch(_n.prev=_n.next){case 0:return Wt=Ag(0,Number.MAX_SAFE_INTEGER),C.log("%s request opid: %d",B,Wt),_n.abrupt("return",te(P,{headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"69","Content-Type":"application/json"},body:{flag:128,opid:Wt,key:x||C.context.key,cname:C.context.uid,detail:ua({},M===void 0?{11:[F.CHINA,F.GLOBAL].join()}:{11:Array.from(M.CODES).map(function(_i){return _i===F.OVERSEA?"".concat(F.ASIA,",").concat(F.EUROPE,",").concat(F.AFRICA,",").concat(F.NORTH_AMERICA,",").concat(F.SOUTH_AMERICA,",").concat(F.OCEANIA):_i}).join(",")}),uid:0,sid:C.context.sid},signal:_t.signal}));case 3:case"end":return _n.stop()}},ue)}))).pipe(Ga(function(ue){return ue.name!=="AbortError"&&(C.logError(ue),C.warn("The AP server %s request failure",P,ue)),vb}),cb(function(){var ue=J(w.mark(function Wt(_n){var _i,Ei,_a,Di,_o,_s,_c;return w.wrap(function(_m){for(;;)switch(_m.prev=_m.next){case 0:if(_i=_n.responseText,Ei=JSON.parse(_i),C.log("The %s response is %o",B,Ei),Di=(_a=Ei).code,_o=_a.addresses,_s=_a.detail,Di===0){_m.next=6;break}return _m.abrupt("return",C.handleUniLbsError(Di,P));case 6:if((_c=_o).length!==0){_m.next=11;break}return _m.abrupt("return",Z(Error("No available edge address to connect")));case 11:return C.context.rtmArea=_s==null?void 0:_s[9],_m.abrupt("return",bb.apply(void 0,G(_c).concat([fg])));case 13:case"end":return _m.stop()}},Wt)}));return function(Wt){return ue.apply(this,arguments)}}()),tg(),Ga(function(ue){return sa(ue)?Z(ue):vb}),wb(function(ue){return ue!==void 0&&typeof ue.ip=="string"&&typeof ue.ticket=="string"}))}),C.context=d,C.getApEdgeInfoEndFirst$=function(){var P=0<arguments.length&&arguments[0]!==void 0&&arguments[0];return Bc(0,P||_?Nc.RECONNECTING_AP_INTERVAL:2e3).pipe(Ka(1),ca(function(){C.retryCount+=1}),cb(function(){return C.context.config.enableCloudProxy?C.getProxyApUrl$(P||_):(4<=C.retryCount&&(C.retryCount=0),3>=C.retryCount?C.getApUrl$(P||_):C.getBackupApUrl$(P||_))}),cb(function(x){return C.context.config.enableCloudProxy?C.fetchCloudProxy(x):C.fetchAp(x)}),Ga(function(x){return x instanceof pb&&C.warn("AP request timeout"),Z(x)}),om(function(x){return x.ip}),ob(C.apFinish$))},C.getApEdgeInfo$=function(P){return Bc(0,P||_?Nc.RECONNECTING_AP_INTERVAL:2e3).pipe(Ka(8),ca(function(){C.retryCount+=1}),cb(function(){return C.context.config.enableCloudProxy?C.getProxyApUrl$(P||_):3>=C.retryCount?C.getApUrl$(P||_):C.getBackupApUrl$(P||_)}),cb(function(x){return(C.context.config.enableCloudProxy?C.fetchCloudProxy(x):C.fetchAp(x)).pipe()}),Ga(function(x){return x instanceof pb&&C.warn("AP request timeout"),Z(x)}),om(function(x){return x.ip}),ob(C.apFinish$))},C}la(r,e);var s=ma(r);return Ha(r,[{key:"clearUp",value:function(){this.failedAreas.clear(),this.retryCount=0}}]),r}(tb());m(Wr,"runOutOfUrlSymbol",Symbol("AP urls are used up"));var Xr=Ph(),Yr=function(e){function r(d,f,_){W(this,r);var C=s.call(this,f,"Connection");m(n(C),"apClient",void 0),m(n(C),"lastOpenSockets",[new qe(1),new qe(1)]),m(n(C),"curOpenSockets",[void 0,void 0]),m(n(C),"ipIterator",0),m(n(C),"firstEnv",.5<=Math.random()?1:0),m(n(C),"firstSocketOpener",void 0),m(n(C),"secondSocketOpener",void 0),m(n(C),"firstOpenKeeperSubject",new Pa),m(n(C),"secondOpenKeeperSubject",new Pa),m(n(C),"edgeInfoReplayed",void 0),m(n(C),"firstEnvOpenSocket",void 0),m(n(C),"firstOpenKeeperSub",void 0),m(n(C),"secondOpenKeeperSub",void 0),m(n(C),"context",void 0),m(n(C),"logger",void 0),C.context=d,C.logger=f,C.apClient=new Wr(C.context,f),C.apClient.apFinish$.subscribe(function(){C.log("Ap client fetch finished")});var P,x=[];return C.edgeInfoReplayed=C.apClient.getApEdgeInfo$(_).pipe(oe(function(B){return B.pipe(ca(function(_t){if(sa(_t))throw _t}),cd(_?Zd.getParameter("RECONNECTING_AP_INTERVAL"):900),ob(Bc(2e4)))}),wb(function(B){return!dl(x,B)}),Dd(function(){return new Xr({AP_NO_AVAILABLE_EDGE:"No available edge address to connect"})}),ca(function(B){x.push(B),C.log("An edge info got %o",B)}),ca({error:function(B){C.emit("connectionInitFailure",B)}}),wg(function(){C.apClient.clearUp()}),sm()),C.firstEnvOpenSocket=C.edgeInfoReplayed.pipe(cb(function(B){if(B===void 0)return Z(Error("Invalid edge info"));var _t=new ml(B.ip,C.firstEnv,B.ticket,C.context,f,P);return C.firstEnv=C.firstEnv===1?0:1,_t.on("connectionFailure",function(){return C.onSocketConnectionFailure(_t)}),P=!_t.useNewDomain,_t.open$.pipe(qf(_t))}),ca(function(B){C.log("The websocket of ENV_%d opened to %s:%d",B.env,B.ip,af[B.env]),C.curOpenSockets[B.env]=B,C.lastOpenSockets[B.env].next(B),C.firstEnv=B.env,C.openSecondSocket(B.env,B.ip,B.useNewDomain)}),Ka(1),pe()),C.firstSocketOpener=C.firstEnvOpenSocket.pipe(cb(function(B){return B.open$.pipe(ca(function(){C.log("The websocket of first ENV_%d re-opened to %s:%d",B.env,B.ip,af[B.env]),C.curOpenSockets[B.env]=B,C.lastOpenSockets[B.env].next(B)}))})),d=C.firstOpenKeeperSubject.pipe(Cc(Yc)),C.firstOpenKeeperSub=d.subscribe({error:C.logError}),C}la(r,e);var s=ma(r);return Ha(r,[{key:"initConnection",value:function(){this.firstOpenKeeperSubject.next(this.firstSocketOpener)}},{key:"closeSocket",value:function(d,f){if(![0,1].includes(d))throw new Fa({INVALID_ENV:"The env argument is not 0 or 1"});var _=d===this.firstEnv?this.firstOpenKeeperSub:this.secondOpenKeeperSub;this.firstOpenKeeperSub=void 0;var C=this.curOpenSockets[d];this.curOpenSockets[d]=void 0,C&&(C.isActiveClose=!0,setTimeout(function(){C.close()},f)),_!==void 0&&setTimeout(function(){_==null||_.unsubscribe()},f)}},{key:"waitClosing",value:function(d){var f=this;return d.isActiveClose=!0,d.open$.pipe(tt(),Ga(function(_){return _.message===mr.normalClosureMessage?vb:Z(_)}),hb(5e3),Ga(function(_){return _ instanceof pb?(f.warn("Force closing the ENV_%d connection",d.env),vb):Z(_)}))}},{key:"onSocketConnectionFailure",value:function(d){var f=[0,1].filter(function(_){return _!==d.env})[0];(f=this.curOpenSockets[f])&&f.loggedIn?this.reopenSocketWithApRequest(d.env):this.emit("socketsFailure")}},{key:"openSecondSocket",value:function(d,f,_){var C=this,P=d===1?0:1;this.secondSocketOpener=this.edgeInfoReplayed.pipe(rm(function(x,B){return[].concat(G(x),[B])},[]),ba(function(x){return kr(x,function(B){return Jm(f,B.ip)}).slice(-1)[0]}),Ka(1),cb(function(x){if(x===void 0)return Z(Error("Invalid edge info"));var B=new ml(x.ip,P,x.ticket,C.context,C.logger,_);return B.on("connectionFailure",function(){return C.onSocketConnectionFailure(B)}),B.open$.pipe(ca(function(){C.lastOpenSockets[P].next(B),C.curOpenSockets[P]=B}))}),pe()),this.secondOpenKeeperSub=this.secondOpenKeeperSubject.pipe(Cc(Yc)).subscribe({error:this.logError}),this.secondOpenKeeperSubject.next(this.secondSocketOpener)}},{key:"reopenSocketWithApRequest",value:function(d){var f=this,_=[0,1].filter(function(x){return x!==d})[0];if((_=this.curOpenSockets[_])!==void 0){var C,P=_.ip;_=this.apClient.getApEdgeInfoEndFirst$(!0).pipe(Dd(function(){return new Xr({AP_NO_AVAILABLE_EDGE:"No available edge address to connect"})}),oe(function(x){return x.pipe(ca(function(B){if(B.code===Kh)f.emit("tokenExpired"),f.apClient.apFinish$.next(void 0);else if(sa(B))throw B}),cd(Zd.getParameter("RECONNECTING_AP_INTERVAL")),ob(Bc(15e3)))}),ca(function(x){f.log("An edge info got %o",x)}),wg(function(){f.apClient.clearUp()})).pipe(rm(function(x,B){return[].concat(G(x),[B])},[]),ba(function(x){return(x=kr(x,function(B){return Jm(P,B.ip)})).length-1>=f.ipIterator?x.slice(-f.ipIterator++-1)[0]:(f.ipIterator=0,x.slice(-1)[0])}),Dd(),cb(function(x){if(x===void 0)return Z(Error("Invalid edge info"));var B=new ml(x.ip,d,x.ticket,f.context,f.logger,C);return B.on("connectionFailure",function(){return f.onSocketConnectionFailure(B)}),C=!B.useNewDomain,B.open$.pipe(qf(B))}),ca(function(x){f.log("The websocket of ENV_%d re-opened to %s:%d using ap",x.env,x.ip,af[x.env]),f.curOpenSockets[d]=x,f.lastOpenSockets[d].next(x)}),cb(function(x){return x.open$.pipe(ca(function(){f.log("The websocket of ENV_%d re-opened to %s:%d",x.env,x.ip,af[x.env]),f.curOpenSockets[d]=x,f.lastOpenSockets[d].next(x)}))}),pe()),d===this.firstEnv?this.firstOpenKeeperSubject.next(_):this.secondOpenKeeperSubject.next(_)}}}]),r}(tb()),Xc=fc.Writer,na=fc.util,zc=fc.roots.default||(fc.roots.default={}),RC=zc.Session=function(){function e(r){if(r)for(var s=Object.keys(r),d=0;d<s.length;++d)r[s[d]]!=null&&(this[s[d]]=r[s[d]])}return e.prototype.sid="",e.prototype.userId="",e.prototype.lts=na.Long?na.Long.fromBits(0,0,!1):0,e.prototype.elapse=na.Long?na.Long.fromBits(0,0,!1):0,e.prototype.appId="",e.prototype.ver="",e.prototype.buildno=0,e.prototype.installId="",e.prototype.os=0,e.prototype.did="",e.prototype.index=null,e.prototype.token="",e.prototype.version=0,e.prototype.subVersion=0,e.encode=function(r,s){return s||(s=Xc.create()),r.sid!=null&&Object.hasOwnProperty.call(r,"sid")&&s.uint32(10).string(r.sid),r.userId!=null&&Object.hasOwnProperty.call(r,"userId")&&s.uint32(18).string(r.userId),r.lts!=null&&Object.hasOwnProperty.call(r,"lts")&&s.uint32(24).int64(r.lts),r.elapse!=null&&Object.hasOwnProperty.call(r,"elapse")&&s.uint32(32).int64(r.elapse),r.appId!=null&&Object.hasOwnProperty.call(r,"appId")&&s.uint32(42).string(r.appId),r.ver!=null&&Object.hasOwnProperty.call(r,"ver")&&s.uint32(50).string(r.ver),r.buildno!=null&&Object.hasOwnProperty.call(r,"buildno")&&s.uint32(56).int32(r.buildno),r.installId!=null&&Object.hasOwnProperty.call(r,"installId")&&s.uint32(66).string(r.installId),r.os!=null&&Object.hasOwnProperty.call(r,"os")&&s.uint32(128).int32(r.os),r.did!=null&&Object.hasOwnProperty.call(r,"did")&&s.uint32(138).string(r.did),r.index!=null&&Object.hasOwnProperty.call(r,"index")&&zc.Session.CommonIndex.encode(r.index,s.uint32(162).fork()).ldelim(),r.token!=null&&Object.hasOwnProperty.call(r,"token")&&s.uint32(170).string(r.token),r.version!=null&&Object.hasOwnProperty.call(r,"version")&&s.uint32(176).int32(r.version),r.subVersion!=null&&Object.hasOwnProperty.call(r,"subVersion")&&s.uint32(184).int32(r.subVersion),s},e.CommonIndex=function(){function r(s){if(s)for(var d=Object.keys(s),f=0;f<d.length;++f)s[d[f]]!=null&&(this[d[f]]=s[d[f]])}return r.prototype.index1="",r.prototype.index2="",r.prototype.index3="",r.encode=function(s,d){return d||(d=Xc.create()),s.index1!=null&&Object.hasOwnProperty.call(s,"index1")&&d.uint32(10).string(s.index1),s.index2!=null&&Object.hasOwnProperty.call(s,"index2")&&d.uint32(18).string(s.index2),s.index3!=null&&Object.hasOwnProperty.call(s,"index3")&&d.uint32(26).string(s.index3),d},r}(),e}(),SC=zc.Link=function(){function e(r){if(r)for(var s=Object.keys(r),d=0;d<s.length;++d)r[s[d]]!=null&&(this[s[d]]=r[s[d]])}return e.prototype.sid="",e.prototype.userId="",e.prototype.lts=na.Long?na.Long.fromBits(0,0,!1):0,e.prototype.elapse=na.Long?na.Long.fromBits(0,0,!1):0,e.prototype.ec=0,e.prototype.sc=0,e.prototype.destServerIp="",e.prototype.ackedServerIp="",e.prototype.responseTime=0,e.encode=function(r,s){return s||(s=Xc.create()),r.sid!=null&&Object.hasOwnProperty.call(r,"sid")&&s.uint32(10).string(r.sid),r.userId!=null&&Object.hasOwnProperty.call(r,"userId")&&s.uint32(18).string(r.userId),r.lts!=null&&Object.hasOwnProperty.call(r,"lts")&&s.uint32(24).int64(r.lts),r.elapse!=null&&Object.hasOwnProperty.call(r,"elapse")&&s.uint32(32).int64(r.elapse),r.ec!=null&&Object.hasOwnProperty.call(r,"ec")&&s.uint32(40).int32(r.ec),r.sc!=null&&Object.hasOwnProperty.call(r,"sc")&&s.uint32(48).int32(r.sc),r.destServerIp!=null&&Object.hasOwnProperty.call(r,"destServerIp")&&s.uint32(58).string(r.destServerIp),r.ackedServerIp!=null&&Object.hasOwnProperty.call(r,"ackedServerIp")&&s.uint32(66).string(r.ackedServerIp),r.responseTime!=null&&Object.hasOwnProperty.call(r,"responseTime")&&s.uint32(72).int32(r.responseTime),s},e}(),TC=zc.Logout=function(){function e(r){if(r)for(var s=Object.keys(r),d=0;d<s.length;++d)r[s[d]]!=null&&(this[s[d]]=r[s[d]])}return e.prototype.sid="",e.prototype.userId="",e.prototype.lts=na.Long?na.Long.fromBits(0,0,!1):0,e.prototype.elapse=na.Long?na.Long.fromBits(0,0,!1):0,e.encode=function(r,s){return s||(s=Xc.create()),r.sid!=null&&Object.hasOwnProperty.call(r,"sid")&&s.uint32(10).string(r.sid),r.userId!=null&&Object.hasOwnProperty.call(r,"userId")&&s.uint32(18).string(r.userId),r.lts!=null&&Object.hasOwnProperty.call(r,"lts")&&s.uint32(24).int64(r.lts),r.elapse!=null&&Object.hasOwnProperty.call(r,"elapse")&&s.uint32(32).int64(r.elapse),s},e}(),UC=zc.KickedOff=function(){function e(r){if(r)for(var s=Object.keys(r),d=0;d<s.length;++d)r[s[d]]!=null&&(this[s[d]]=r[s[d]])}return e.prototype.sid="",e.prototype.userId="",e.prototype.lts=na.Long?na.Long.fromBits(0,0,!1):0,e.prototype.elapse=na.Long?na.Long.fromBits(0,0,!1):0,e.prototype.linkId=0,e.prototype.code=0,e.prototype.server="",e.prototype.serverCode=0,e.encode=function(r,s){return s||(s=Xc.create()),r.sid!=null&&Object.hasOwnProperty.call(r,"sid")&&s.uint32(10).string(r.sid),r.userId!=null&&Object.hasOwnProperty.call(r,"userId")&&s.uint32(18).string(r.userId),r.lts!=null&&Object.hasOwnProperty.call(r,"lts")&&s.uint32(24).int64(r.lts),r.elapse!=null&&Object.hasOwnProperty.call(r,"elapse")&&s.uint32(32).int64(r.elapse),r.linkId!=null&&Object.hasOwnProperty.call(r,"linkId")&&s.uint32(48).int32(r.linkId),r.code!=null&&Object.hasOwnProperty.call(r,"code")&&s.uint32(56).int32(r.code),r.server!=null&&Object.hasOwnProperty.call(r,"server")&&s.uint32(66).string(r.server),r.serverCode!=null&&Object.hasOwnProperty.call(r,"serverCode")&&s.uint32(72).int32(r.serverCode),s},e}(),VC=zc.ChnJoin=function(){function e(r){if(r)for(var s=Object.keys(r),d=0;d<s.length;++d)r[s[d]]!=null&&(this[s[d]]=r[s[d]])}return e.prototype.sid="",e.prototype.userId="",e.prototype.lts=na.Long?na.Long.fromBits(0,0,!1):0,e.prototype.elapse=na.Long?na.Long.fromBits(0,0,!1):0,e.prototype.cname="",e.prototype.errCode=0,e.encode=function(r,s){return s||(s=Xc.create()),r.sid!=null&&Object.hasOwnProperty.call(r,"sid")&&s.uint32(10).string(r.sid),r.userId!=null&&Object.hasOwnProperty.call(r,"userId")&&s.uint32(18).string(r.userId),r.lts!=null&&Object.hasOwnProperty.call(r,"lts")&&s.uint32(24).int64(r.lts),r.elapse!=null&&Object.hasOwnProperty.call(r,"elapse")&&s.uint32(32).int64(r.elapse),r.cname!=null&&Object.hasOwnProperty.call(r,"cname")&&s.uint32(50).string(r.cname),r.errCode!=null&&Object.hasOwnProperty.call(r,"errCode")&&s.uint32(56).int32(r.errCode),s},e}(),WC=zc.ChnJoinRes=function(){function e(r){if(r)for(var s=Object.keys(r),d=0;d<s.length;++d)r[s[d]]!=null&&(this[s[d]]=r[s[d]])}return e.prototype.sid="",e.prototype.userId="",e.prototype.lts=na.Long?na.Long.fromBits(0,0,!1):0,e.prototype.elapse=na.Long?na.Long.fromBits(0,0,!1):0,e.prototype.cname="",e.prototype.errCode=0,e.prototype.serverErrCode=0,e.encode=function(r,s){return s||(s=Xc.create()),r.sid!=null&&Object.hasOwnProperty.call(r,"sid")&&s.uint32(10).string(r.sid),r.userId!=null&&Object.hasOwnProperty.call(r,"userId")&&s.uint32(18).string(r.userId),r.lts!=null&&Object.hasOwnProperty.call(r,"lts")&&s.uint32(24).int64(r.lts),r.elapse!=null&&Object.hasOwnProperty.call(r,"elapse")&&s.uint32(32).int64(r.elapse),r.cname!=null&&Object.hasOwnProperty.call(r,"cname")&&s.uint32(50).string(r.cname),r.errCode!=null&&Object.hasOwnProperty.call(r,"errCode")&&s.uint32(56).int32(r.errCode),r.serverErrCode!=null&&Object.hasOwnProperty.call(r,"serverErrCode")&&s.uint32(64).int32(r.serverErrCode),s},e}(),XC=zc.ChnLeave=function(){function e(r){if(r)for(var s=Object.keys(r),d=0;d<s.length;++d)r[s[d]]!=null&&(this[s[d]]=r[s[d]])}return e.prototype.sid="",e.prototype.userId="",e.prototype.lts=na.Long?na.Long.fromBits(0,0,!1):0,e.prototype.elapse=na.Long?na.Long.fromBits(0,0,!1):0,e.prototype.cname="",e.prototype.errCode=0,e.encode=function(r,s){return s||(s=Xc.create()),r.sid!=null&&Object.hasOwnProperty.call(r,"sid")&&s.uint32(10).string(r.sid),r.userId!=null&&Object.hasOwnProperty.call(r,"userId")&&s.uint32(18).string(r.userId),r.lts!=null&&Object.hasOwnProperty.call(r,"lts")&&s.uint32(24).int64(r.lts),r.elapse!=null&&Object.hasOwnProperty.call(r,"elapse")&&s.uint32(32).int64(r.elapse),r.cname!=null&&Object.hasOwnProperty.call(r,"cname")&&s.uint32(50).string(r.cname),r.errCode!=null&&Object.hasOwnProperty.call(r,"errCode")&&s.uint32(56).int32(r.errCode),s},e}(),YC=zc.ConnectionStateChange=function(){function e(r){if(r)for(var s=Object.keys(r),d=0;d<s.length;++d)r[s[d]]!=null&&(this[s[d]]=r[s[d]])}return e.prototype.sid="",e.prototype.userId="",e.prototype.lts=na.Long?na.Long.fromBits(0,0,!1):0,e.prototype.elapse=na.Long?na.Long.fromBits(0,0,!1):0,e.prototype.oldState=0,e.prototype.newState=0,e.prototype.reason=0,e.prototype.reconnId=0,e.encode=function(r,s){return s||(s=Xc.create()),r.sid!=null&&Object.hasOwnProperty.call(r,"sid")&&s.uint32(10).string(r.sid),r.userId!=null&&Object.hasOwnProperty.call(r,"userId")&&s.uint32(18).string(r.userId),r.lts!=null&&Object.hasOwnProperty.call(r,"lts")&&s.uint32(24).int64(r.lts),r.elapse!=null&&Object.hasOwnProperty.call(r,"elapse")&&s.uint32(32).int64(r.elapse),r.oldState!=null&&Object.hasOwnProperty.call(r,"oldState")&&s.uint32(40).int32(r.oldState),r.newState!=null&&Object.hasOwnProperty.call(r,"newState")&&s.uint32(48).int32(r.newState),r.reason!=null&&Object.hasOwnProperty.call(r,"reason")&&s.uint32(56).int32(r.reason),r.reconnId!=null&&Object.hasOwnProperty.call(r,"reconnId")&&s.uint32(64).int32(r.reconnId),s},e}(),fu=Object.freeze({__proto__:null,Session:RC,Link:SC,Logout:TC,KickedOff:UC,ChnJoin:VC,ChnJoinRes:WC,ChnLeave:XC,ConnectionStateChange:YC,default:zc}),gu=Object.freeze({__proto__:null,Counter:1,ApiExec:154,Session:164,ApEvent:165,Link:166,Logout:167,TxMessage:168,RxMessage:169,KickedOff:170,TxMessageRes:171,ChnJoin:172,ChnJoinRes:173,ChnLeave:174,ChnGetMembers:175,ChnGetMembersRes:176,ChnMemberJoined:177,ChnMemberLeft:178,QueryPeersOnlineStatus:179,QueryPeersOnlineStatusRes:180,RenewToken:181,OperateAttribute:186,OperateAttributeRes:187,ApRequest:188,LinkTcpEvent:189,LinkLoginRequest:190,ConnectionStateChange:191,default:{Counter:1,ApiExec:154,Session:164,ApEvent:165,Link:166,Logout:167,TxMessage:168,RxMessage:169,KickedOff:170,TxMessageRes:171,ChnJoin:172,ChnJoinRes:173,ChnLeave:174,ChnGetMembers:175,ChnGetMembersRes:176,ChnMemberJoined:177,ChnMemberLeft:178,QueryPeersOnlineStatus:179,QueryPeersOnlineStatusRes:180,RenewToken:181,OperateAttribute:186,OperateAttributeRes:187,ApRequest:188,LinkTcpEvent:189,LinkLoginRequest:190,ConnectionStateChange:191}}),ZC=function(e){function r(d,f,_){return W(this,r),m(n(_=s.call(this,_,"Context")),"_token",void 0),m(n(_),"config",void 0),m(n(_),"_uid",void 0),m(n(_),"_sid",void 0),m(n(_),"_area","CN"),m(n(_),"appId",void 0),m(n(_),"enableCloudProxy",!1),m(n(_),"cloudProxyServers",[]),_.appId=d,_.config=f,_}la(r,e);var s=ma(r);return Ha(r,[{key:"token",set:function(d){this._token=typeof d=="string"&&d?d:void 0}},{key:"uid",get:function(){if(typeof this._uid=="string"&&this._uid)return this._uid;throw new Ia("Cannot get illegal uid")},set:function(d){if(this.log("The user ID is set to %s",oa(d)),!za(d))throw new Ia;this._uid=d}},{key:"key",get:function(){if(typeof this._token=="string"&&this._token)return this._token;if(typeof this.appId=="string"&&this.appId)return this.appId;throw new Ia("Cannot get illegal key")}},{key:"sid",get:function(){if(typeof this._sid=="string"&&this._sid)return this._sid;throw new Ia("Cannot get illegal sid")},set:function(d){if(this.log("sid is set to %s",d),typeof d!="string"||!d)throw new Ia;this._sid=d}},{key:"rtmArea",get:function(){if(typeof this._area=="string"&&this._area)return this._area;throw new Ia("Cannot get illegal area")},set:function(d){this.log("area is set to %s",d),typeof d=="string"&&d?this._area=d:this.warn("set area failed")}}]),r}(tb()),$C=!!Fc&&R(function(){Fc.prototype.finally.call({then:function(){}},function(){})});if(N({target:"Promise",proto:!0,real:!0,forced:$C},{finally:function(e){var r=kd(this,mc("Promise")),s=typeof e=="function";return this.then(s?function(d){return mj(r,e()).then(function(){return d})}:e,s?function(d){return mj(r,e()).then(function(){throw d})}:e)}}),typeof Fc=="function"){var Zr=mc("Promise").prototype.finally;Fc.prototype.finally!==Zr&&Ta(Fc.prototype,"finally",Zr,{unsafe:!0})}var aD=function(){var e=J(w.mark(function r(s){return w.wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.t0=Uint8Array,d.next=3,crypto.subtle.digest("SHA-256",s);case 3:return d.t1=d.sent,d.abrupt("return",new d.t0(d.t1));case 5:case"end":return d.stop()}},r)}));return function(r){return e.apply(this,arguments)}}(),$r=function(e){return Array.from(e).map(function(r){return r.toString(16).padStart(2,"0")}).join("")},bD=function(e){if(typeof e!="string")throw new TypeError("Expected input to be a string");if(e.length%2!=0)throw new RangeError("Expected string to be an even number of characters");for(var r=new Uint8Array(e.length/2),s=0;s<e.length;s+=2)r[s/2]=parseInt(e.substring(s,s+2),16);return r},as=function(e){return btoa(String.fromCharCode.apply(String,G(e))).replace(/={1,2}$/,"")},bs=function(){var e=J(w.mark(function r(s){var d;return w.wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.prev=0,f.next=3,crypto.subtle.digest("SHA-1",s);case 3:d=f.sent,f.next=9;break;case 6:f.prev=6,f.t0=f.catch(0),d=sha1.arrayBuffer(s);case 9:return f.abrupt("return",as(new Uint8Array(d)));case 10:case"end":return f.stop()}},r,null,[[0,6]])}));return function(r){return e.apply(this,arguments)}}(),cs=function(e,r,s,d){d[r]=!0,s.has(e)?s.get(e).add(r):s.set(e,new Set([r]))},cD=function(e){switch(e){case"89504E47":return"image/png";case"47494638":return"image/gif";case"25504446":return"application/pdf";case"FFD8FFDB":case"FFD8FFE0":case"FFD8FFE1":return"image/jpeg";case"504B0304":return"application/zip";default:return"application/octet-stream"}},ds=function(e){function r(d,f,_,C){W(this,r);var P=s.call(this,_,"ChunkDownloadManager");if(m(n(P),"abortController",new AbortController),m(n(P),"downloadedSize",0),m(n(P),"successCount",0),m(n(P),"timer",void 0),m(n(P),"chunks",[]),m(n(P),"retUnit",void 0),m(n(P),"singleThread",!1),m(n(P),"initialized",!1),m(n(P),"ee",void 0),m(n(P),"chunkCount",void 0),m(n(P),"aborted",!1),m(n(P),"serverToIndices",new Map),m(n(P),"backupToIndices",new Map),m(n(P),"indexToBackupServers",[]),m(n(P),"busyBackupServers",new Map),m(n(P),"downloadingChunks",new Set),m(n(P),"metaInfo",void 0),m(n(P),"transHandler",void 0),P.metaInfo=d,P.transHandler=f,P.ee=C===void 0?new ea:C,_=d.size,d=d.unit,_===0)throw new Ia("size cannot be 0");return f.cancelSignal!==void 0&&f.cancelSignal.addEventListener("abort",function(){P.abortController.abort()},{once:!0}),P.abortController.signal.addEventListener("abort",function(){P.aborted=!0},{once:!0}),P.chunkCount=Math.ceil(_/(32768*d)),P}la(r,e);var s=ma(r);return Ha(r,[{key:"setInfoByResponse",value:function(d){var f=this,_=d.serverList,C=d.backupList;if(d=d.unit,_.length<this.chunkCount&&C.length<this.chunkCount)throw new Ia("servers is not enough");this.updateProgress(0),this.initialized=!0;var P=Array(this.chunkCount).fill(!1);if(_.forEach(function(x,B){return x.forEach(function(_t){return cs(_t,B,f.serverToIndices,P)})}),C.forEach(function(x,B){return x.forEach(function(_t){return cs(_t,B,f.backupToIndices,P)})}),P.some(function(){return!1}))throw new da("Not enough servers to download",mg);this.indexToBackupServers=C.map(function(x){return new Set(x)}),this.retUnit=d}},{key:"downloadChunks",value:function(){this.aborted?this.warn("downloadChunks after abort, ignored"):this.serverToIndices.size===1&&Array.from(this.serverToIndices.keys())[0]===0?this.serversDownload(this.backupToIndices):1<=this.serverToIndices.size?this.serversDownload(this.serverToIndices,!0):this.ee.emit("error",new da("not enough servers to download",mg))}},{key:"updateProgress",value:function(d){var f=this,_=this.downloadedSize+d;this.downloadedSize>this.metaInfo.size?(this.warn("Invalid download size, overflowed"),this.ee.emit("error",new Wc("Invalid download size",mg))):(this.downloadedSize=_,this.timer!==void 0&&d!==0&&(clearTimeout(this.timer),this.timer=void 0),this.timer===void 0&&this.successCount!==this.chunkCount&&(this.timer=setTimeout(function(){f.ee.emit("timedOut"),f.abortController.abort()},12e4)),this.initialized&&d===0||this.transHandler.onOperationProgress===void 0||this.transHandler.onOperationProgress({totalSize:this.metaInfo.size,currentSize:this.downloadedSize}))}},{key:"getPayload",value:function(){for(var d=0,f=0,_=this.chunks;f<_.length;f++)d+=_[f].byteLength;if(d!==this.metaInfo.size)throw new Ia("invalid chunks total size");d=new Uint8Array(d),_=f=0;for(var C=this.chunks;_<C.length;_++){var P=C[_];d.set(new Uint8Array(P),f),f+=P.byteLength}return f=Array.from(d.subarray(0,4)).map(function(x){return x.toString(16)}).join("").toUpperCase(),Zt(d.buffer,cD(f))}},{key:"getDownloadUrl",value:function(d){var f=this.metaInfo.useNewDomain?"sd-rtn.com":"agora.io";return"https://".concat(Dg(d).split(".").join("-"),".edge.").concat(f,":9601/api/v1/chuck/download")}},{key:"serversDownload",value:function(){var d=J(w.mark(function f(_){var C,P=this,x=arguments;return w.wrap(function(B){for(;;)switch(B.prev=B.next){case 0:return C=1<x.length&&x[1]!==void 0&&x[1],B.next=3,Promise.all(Array.from(_.entries()).map(function(_t){return _t=ra(_t,2),P.postDownloadRequest(_t[0],Array.from(_t[1]),C).catch(function(ue){ue.statusCode===404?(P.ee.emit("notExist"),P.abortController.abort()):ue.name!=="AbortError"&&(Sa(ue)?P.singleThread?(P.abortController.abort(),P.ee.emit("timedOut")):(P.warn("%d download timed out after %d, retrying use single thread",ue.index,P.singleThread?6e4:3e4),P.abortController.abort(),P.singleThread=!0,P.ee.emit("multiTimeOut")):(P.ee.emit("error",ue),P.abortController.abort()))})}));case 3:case"end":return B.stop()}},f)}));return function(f){return d.apply(this,arguments)}}()},{key:"postDownloadRequest",value:function(){var d=J(w.mark(function f(_,C,P){var x,B,_t,ue,Wt,_n,_i,Ei,_a,Di=this;return w.wrap(function(_o){for(;;)switch(_o.prev=_o.next){case 0:if(_a=function(){return(_a=J(w.mark(function _s(_c){var _m,Qm,tE,aE,CE,lE,gE,cE,_E;return w.wrap(function(iE){for(;;)switch(iE.prev=iE.next){case 0:if(iE.prev=0,_c!==void 0||_!==0){iE.next=5;break}throw new Ia("Invalid serverIp");case 5:_m=_c===void 0?_i.getDownloadUrl(_):_c;case 6:return _i.downloadingChunks.add(x),iE.next=9,_n(_m);case 9:return Qm=iE.sent,tE=Qm.responseData,_i.downloadingChunks.delete(x),iE.abrupt("return",tE);case 15:if(iE.prev=15,iE.t0=iE.catch(0),_i.downloadingChunks.delete(x),C.unshift(x),_i.metaInfo.useNewDomain=!1,iE.t0.name!=="AbortError"){iE.next=22;break}throw iE.t0;case 22:if(!Sa(iE.t0)){iE.next=25;break}throw iE.t0.index=x,iE.t0;case 25:if(aE=ue,ue+=1,!(2>aE)){iE.next=30;break}return iE.t0 instanceof Ia||_i.warn("%o, %d download failed, retrying",iE.t0,x),iE.abrupt("return",Ei());case 30:if(iE.t0.statusCode!==504){iE.next=34;break}throw(CE=new db("download server timed out",{originalError:iE.t0,serverCode:504})).index=x,CE;case 34:if(!P||aE!==2||Wt[0]===0){iE.next=45;break}return iE.t0 instanceof Ia||_i.warn("%d download failed, using backup: %d, %o",x,Wt[0],iE.t0),iE.next=38,_i.busyBackupServers.get(Wt[0]);case 38:return lE=Ei(_i.getDownloadUrl(Wt[0])),_i.busyBackupServers.set(Wt[0],lE),iE.next=42,lE;case 42:return gE=iE.sent,_i.busyBackupServers.delete(Wt[0]),iE.abrupt("return",gE);case 45:if(!(P&&2<aE&&Wt[1]!==void 0&&Wt[1]!==0)){iE.next=56;break}return _i.warn("%d download failed, using backup 1: %d",x,Wt[1]),iE.next=49,_i.busyBackupServers.get(Wt[1]);case 49:return cE=Ei(_i.getDownloadUrl(Wt[1])),_i.busyBackupServers.set(Wt[1],cE),iE.next=53,cE;case 53:return _E=iE.sent,_i.busyBackupServers.delete(Wt[1]),iE.abrupt("return",_E);case 56:throw iE.t0.index=x,iE.t0;case 58:case"end":return iE.stop()}},_s,null,[[0,15]])}))).apply(this,arguments)},Ei=function(_s){return _a.apply(this,arguments)},!this.aborted){_o.next=4;break}throw new Ia("download already aborted");case 4:if((x=C.shift())!==void 0){_o.next=8;break}return this.log("%s download finished",_),_o.abrupt("return");case 8:if(!(this.singleThread&&0<this.downloadingChunks.size)){_o.next=10;break}return _o.abrupt("return");case 10:if(!this.downloadingChunks.has(x)){_o.next=13;break}return this.log("%s already downloading, return",x),_o.abrupt("return");case 13:if(this.chunks[x]===void 0){_o.next=19;break}return this.successCount===this.chunkCount&&(this.log("chunks all download"),this.ee.emit("finished")),this.log("%s already downloaded, do next",x),_o.next=18,this.postDownloadRequest(_,C,P);case 18:return _o.abrupt("return");case 19:return B=new FormData,_t={hash:hu(this.metaInfo.hashHexStr),unit:this.retUnit===void 0?this.metaInfo.unit:this.retUnit,instance:this.metaInfo.instance,loginOpt:this.metaInfo.loginOpt,ticket:this.metaInfo.ticket,index:x},B.append("parameter",JSON.stringify(_t)),ue=0,Wt=Array.from(this.indexToBackupServers[x]),_n=function(_s){return te(_s,{body:B,signal:Di.abortController.signal,timeout:Di.singleThread?12e4:3e4},{useBinaryResponse:!0})},_i=this,_o.next=28,Ei().then(function(_s){return Di.chunks[x]!==void 0?Di.log("chunk %d download duplicated",x):(Di.chunks[x]=_s,Di.log("chunk %d downloaded",x),Di.successCount+=1,Di.updateProgress(Di.chunks[x].byteLength)),Di.successCount===Di.chunkCount&&(Di.log("chunks all download"),Di.ee.emit("finished")),Di.singleThread?(Di.downloadChunks(),Promise.resolve()):Di.postDownloadRequest(_,C,P)});case 28:case"end":return _o.stop()}},f,this)}));return function(f,_,C){return d.apply(this,arguments)}}()}]),r}(tb()),es=function(e){function r(d,f,_,C){W(this,r);var P=s.call(this,_,"ChunkUploadManager");if(m(n(P),"chunkCount",0),m(n(P),"chunks",[]),m(n(P),"uploadedChunks",[]),m(n(P),"totalFailures",0),m(n(P),"timer",void 0),m(n(P),"initState","uninitialized"),m(n(P),"ee",void 0),m(n(P),"unit",0),m(n(P),"uploadedSize",0),m(n(P),"singleThread",!1),m(n(P),"abortController",new AbortController),m(n(P),"servers",[]),m(n(P),"aborted",!1),m(n(P),"metaInfo",void 0),m(n(P),"transHandler",void 0),P.metaInfo=d,P.transHandler=f,P.ee=C===void 0?new ea:C,d.file.length===0)throw new I("file not found or is empty",wf);return f.cancelSignal!==void 0&&f.cancelSignal.addEventListener("abort",function(){P.abortController.abort()},{once:!0}),P.abortController.signal.addEventListener("abort",function(){P.aborted=!0},{once:!0}),P}la(r,e);var s=ma(r);return Ha(r,[{key:"initChunks",value:function(){var d=J(w.mark(function f(_){var C,P,x,B,_t,ue=this;return w.wrap(function(Wt){for(;;)switch(Wt.prev=Wt.next){case 0:if(this.initState!=="initialized"&&this.initState!=="initializing"){Wt.next=2;break}throw new Ia("cannot re-initialize");case 2:for(this.initState="initializing",this.unit=_,C=this.sliceFile(_,this.metaInfo.file),this.chunkCount=C.length,P=[],x=function(_n,_i){var Ei=(_n=ra(_i[_n],2))[0],_a=_n[1];_n=bs(_a).then(function(Di){ue.chunks[Ei]={payload:_a,sha1:Di,uploadedTo:void 0,index:Ei,processed:!1}}),P.push(_n)},B=0,_t=Array.from(C.entries());B<_t.length;B++)x(B,_t);return Wt.next=11,Promise.all(P);case 11:this.updateProgress(0),this.initState="initialized",this.log("upload chunks initialized");case 14:case"end":return Wt.stop()}},f,this)}));return function(f){return d.apply(this,arguments)}}()},{key:"uploadToServers",value:function(){var d=this;if(!this.aborted){for(var f=this.chunks.filter(function(P){return!P.processed}),_=function(P){var x=f[P],B=d.servers.filter(function(ue){return!ue.isUploading}).sort(function(ue,Wt){return ue.successCount-Wt.successCount}).sort(function(ue,Wt){return ue.failureCount-Wt.failureCount})[0];if(B===void 0||1<B.failureCount)return d.log("Upload server not available, waiting"),d.ee.emit("serverUsedUp"),Om(1e3).then(function(){d.totalFailures>2*d.chunkCount&&d.ee.emit("error"),d.totalFailures+=1,B!==void 0&&(B.failureCount=0),d.uploadToServers()}).catch(function(){}),"break";x.processed=!0,B.isUploading=!0,d.log("uploading chunk %d to server %s",x.index,Dg(B.ip));var _t=d.getUploadUrl(B.ip);return J(w.mark(function ue(){var Wt;return w.wrap(function(_n){for(;;)switch(_n.prev=_n.next){case 0:return _n.prev=0,_n.next=3,d.postChunk(x.payload,_t,x.index);case 3:Wt=d.chunks.findIndex(function(_i){return _i===x}),x.uploadedTo=B.ip,d.chunks.splice(Wt,1),d.uploadedChunks.push(x),B.successCount+=1,B.isUploading=!1,d.updateProgress(x.payload.byteLength),d.log("upload chunk %d successfully",x.index),_n.next=31;break;case 13:if(_n.prev=13,_n.t0=_n.catch(0),B.isUploading=!1,x.processed=!1,_n.t0.statusCode!==504&&!Sa(_n.t0)){_n.next=27;break}if(d.singleThread){_n.next=24;break}return d.warn("%d upload timed out after %d, retrying use single thread",x.index,d.singleThread?12e4:3e4),d.abortController.abort(),d.singleThread=!0,d.ee.emit("multiTimeOut"),_n.abrupt("return");case 24:return d.ee.emit("timedOut"),d.abortController.abort(),_n.abrupt("return");case 27:return d.metaInfo.useNewDomain=!1,B.failureCount+=1,_n.next=31,Om(1e3);case 31:d.uploadedChunks.length===d.chunkCount?(d.log("chunks uploaded"),d.ee.emit("finished")):(d.singleThread||d.chunks.filter(function(_i){return!_i.processed}).length===1)&&d.uploadToServers();case 32:case"end":return _n.stop()}},ue,null,[[0,13]])}))(),d.singleThread?"break":void 0},C=0;C<f.length&&_(C)!=="break";C++);f.length===0&&this.uploadedChunks.length!==this.chunkCount&&this.log("%d chunks left uploading",this.chunkCount-this.uploadedChunks.length)}}},{key:"getUploadServerIPs",value:function(){var d=!0,f=[],_=G(this.uploadedChunks).sort(function(x,B){return x.index-B.index}),C=0;for(_=Array.from(_.values());C<_.length;C++){var P=_[C].uploadedTo;if(P===void 0){d=!1;break}f.push(P)}if(!d)throw new Ia("some chunks not uploaded, cannot get upload server ips");return f}},{key:"addServers",value:function(d){var f=this;d.forEach(function(_){var C=f.servers.findIndex(function(P){return P.ip===_});C!==-1?f.servers[C].failureCount=0:(f.log("server %s added",Dg(_)),f.servers.push({successCount:0,isUploading:!1,ip:_,failureCount:0}))})}},{key:"updateProgress",value:function(d){var f=this,_=d!==void 0?this.uploadedSize+d:this.metaInfo.file.length;_>this.metaInfo.file.length?(this.warn("Invalid upload size, overflowed"),this.ee.emit("error",new Wc("Invalid upload size",lg))):(this.uploadedSize=_,this.timer!==void 0&&d!==0&&(clearTimeout(this.timer),this.timer=void 0),this.timer===void 0&&d!==void 0&&this.uploadedChunks.length!==this.chunkCount&&(this.timer=setTimeout(function(){f.ee.emit("timedOut"),f.abortController.abort()},12e4)),this.initState==="initialized"&&d===0||this.transHandler.onOperationProgress===void 0||this.transHandler.onOperationProgress({totalSize:this.metaInfo.file.length,currentSize:this.uploadedSize}))}},{key:"sliceFile",value:function(d,f){var _=0,C=[],P=f.length;for(d*=32768;_<P;)C.push(f.slice(_,_+d)),_+=d;return this.log("chunks split into %d",C.length),C}},{key:"postChunk",value:function(){var d=J(w.mark(function f(_,C,P){var x,B,_t,ue,Wt,_n,_i,Ei;return w.wrap(function(_a){for(;;)switch(_a.prev=_a.next){case 0:if(!this.aborted){_a.next=2;break}throw new Ia("upload already aborted");case 2:if(this.unit!==void 0){_a.next=4;break}throw new Ia("unit is undefined");case 4:return x=this.metaInfo,B=x.ticket,_t=x.instance,ue=x.loginOpt,Wt=x.hashStr,_a.t0=P,_a.t1=Wt,_a.next=9,bs(_);case 9:return _a.t2=_a.sent,_a.t3=this.unit,_a.t4=B,_a.t5=_t,_a.t6=ue,_n={index:_a.t0,hash:_a.t1,sha1:_a.t2,unit:_a.t3,ticket:_a.t4,instance:_a.t5,loginOpt:_a.t6},(_i=new FormData).append("parameter",JSON.stringify(_n)),_i.append("payload",new Blob([_])),_a.next=20,te(C,{headers:{Accept:"application/json"},body:_i,timeout:this.singleThread?12e4:3e4,signal:this.abortController.signal});case 20:if(Ei=_a.sent,Ei.status===201){_a.next=24;break}throw new da("uploading chunk ".concat(P," failed"));case 24:case"end":return _a.stop()}},f,this)}));return function(f,_,C){return d.apply(this,arguments)}}()},{key:"getUploadUrl",value:function(d){var f=this.metaInfo.useNewDomain?"sd-rtn.com":"agora.io";return"https://".concat(Dg(d).split(".").join("-"),".edge.").concat(f,":9601/api/v1/chuck/upload")}}]),r}(tb()),fs=function(e){function r(d){W(this,r);var f=s.call(this,d,"MediaTaskManager");return m(n(f),"isProcessing",!1),m(n(f),"authInfo",void 0),m(n(f),"taskFinishers",{}),m(n(f),"mediaTasks",new Map),m(n(f),"ongoingTask",void 0),f.on("connectionStateChanged",function(_){if(_===S.ConnectionState.ABORTED||_===S.ConnectionState.DISCONNECTED){f.ongoingTask!==void 0&&f.cancelTask(f.ongoingTask),_=0;for(var C=Array.from(f.mediaTasks.entries());_<C.length;_++){var P=ra(C[_],2)[1];f.cancelTask(P)}f.mediaTasks.clear(),f.taskFinishers={}}else _===S.ConnectionState.RECONNECTING?f.ongoingTask!==void 0&&f.ongoingTask.manager.abortController.abort():_===S.ConnectionState.CONNECTED&&f.ongoingTask!==void 0&&f.ongoingTask.manager.ee.emit("reconnected")}),f}la(r,e);var s=ma(r);return Ha(r,[{key:"setAuthInfo",value:function(d){this.authInfo=d}},{key:"waitMediaTask",value:function(d){var f=this;return new Promise(function(_,C){f.taskFinishers[d]={resolve:_,reject:C},f.isProcessing||f.processMediaTask()}).finally(function(){f.ongoingTask!==void 0&&f.ongoingTask.manager.timer!==void 0&&clearTimeout(f.ongoingTask.manager.timer),delete f.taskFinishers[d],f.mediaTasks.size!==0?f.processMediaTask():f.isProcessing=!1})}},{key:"addUploadTask",value:function(d,f,_,C){var P=d.file;if(d=d.hash,this.authInfo===void 0)throw new Ia("session not found");if(this.mediaTasks.size>=r.MAX_PENDING_TASK_COUNT-1)throw new ib("Upload media failed, exceed max pending jobs",xA);return C=new es({hashStr:as(d),file:P,ticket:this.authInfo.ticket,instance:this.authInfo.instance.toString(),loginOpt:this.authInfo.loginOpt.toString(),useNewDomain:this.authInfo.useNewDomain},C,this.logger),P=Ud(),this.mediaTasks.set(P,{type:"UPLOAD",manager:C,hash:d,setter:_,fetcher:f,taskId:P}),P}},{key:"addDownloadTask",value:function(d,f,_){var C=d.hashHexStr,P=d.size,x=d.unit;if(d=d.zone,this.authInfo===void 0)throw new Ia("session not found");if(this.mediaTasks.size>=r.MAX_PENDING_TASK_COUNT-1)throw new ib("Download media failed, exceed max pending jobs",BA);return _=new ds({hashHexStr:C,ticket:this.authInfo.ticket,useNewDomain:this.authInfo.useNewDomain,instance:this.authInfo.instance.toString(),loginOpt:this.authInfo.loginOpt.toString(),size:P,zone:d,unit:x},_,this.logger),C=Ud(),this.mediaTasks.set(C,{type:"DOWNLOAD",manager:_,fetcher:f,taskId:C}),C}},{key:"doDownloadTaskImpl",value:function(){var d=J(w.mark(function f(_,C){var P,x,B,_t,ue,Wt,_n,_i,Ei=this,_a=arguments;return w.wrap(function(Di){for(;;)switch(Di.prev=Di.next){case 0:return P=2<_a.length&&_a[2]!==void 0&&_a[2],B=x=_.manager,P&&(x=new ds(B.metaInfo,B.transHandler,this.logger,B.ee)),_t=_.fetcher,Di.next=7,_t();case 7:if(ue=Di.sent,Wt=ue.serverList,_n=ue.backupList,_i=ue.unit,!P||_i===B.retUnit){Di.next=13;break}throw new da("download unit is different, reject to continue",mg);case 13:P&&(_.manager=x,x.downloadedSize=B.downloadedSize,x.successCount=B.successCount,x.timer=B.timer,x.chunks=B.chunks,x.initialized=B.initialized,x.singleThread=B.singleThread,x.updateProgress(0)),x.ee.once("reconnected",function(){x.ee.removeAllListeners(),Ei.doDownloadTaskImpl(_,C,!0).catch(function(_o){C.reject(_o)})}),x.ee.once("multiTimeOut",function(){x.ee.removeAllListeners(),Ei.doDownloadTaskImpl(_,C,!0).catch(function(_o){C.reject(_o)})}),x.ee.once("error",function(_o){x.ee.removeAllListeners(),C.reject(new da(["download file file, index %d",_o.index],{code:mg,originalError:_o}))}),x.ee.once("notExist",function(){x.abortController.abort(),x.ee.removeAllListeners(),C.reject(new da("download file not found",AA))}),x.ee.once("timedOut",function(){x.ee.removeAllListeners(),x.abortController.abort(),C.reject(new db("download timed out",zA))}),x.transHandler.cancelSignal!==void 0&&x.transHandler.cancelSignal.addEventListener("abort",function(){C.reject(new hl("Downloading canceled",ir))},{once:!0}),x.ee.once("finished",function(){C.resolve({type:"DOWNLOAD",payload:x.getPayload()})}),x.setInfoByResponse({serverList:Wt,backupList:_n,unit:_i}),x.downloadChunks();case 23:case"end":return Di.stop()}},f,this)}));return function(f,_){return d.apply(this,arguments)}}()},{key:"doDownloadTask",value:function(d,f){var _=this,C=2<arguments.length&&arguments[2]!==void 0&&arguments[2],P=d.taskId;return C||(this.mediaTasks.delete(P),this.ongoingTask=d),new Promise(function(x,B){_.doDownloadTaskImpl(d,f,C).then(x).catch(B)})}},{key:"doUploadTaskImpl",value:function(){var d=J(w.mark(function f(_,C){var P,x,B,_t,ue,Wt,_n,_i,Ei,_a=this,Di=arguments;return w.wrap(function(_o){for(;;)switch(_o.prev=_o.next){case 0:return P=2<Di.length&&Di[2]!==void 0&&Di[2],B=x=_.manager,P&&(x=new es(B.metaInfo,B.transHandler,this.logger,B.ee)),_t=_.fetcher,ue=new Pa,_n=new Promise(function(_s,_c){var _m=_t(),Qm=_m.ret,tE=_m.err,aE=_m.timeout;_m.fin.pipe(ob(ue)).subscribe({next:function(CE){C.resolve({type:"UPLOAD",retUnit:CE.unit,zone:CE.zone})},complete:function(){_s({hasExist:!0}),ue.next(),ue.complete()}}),Qm.pipe(ob(ue),cb(function(){var CE=J(w.mark(function lE(gE){var cE,_E;return w.wrap(function(iE){for(;;)switch(iE.prev=iE.next){case 0:if(cE=gE.servers,_E=gE.unit,P&&B.unit!==_E?C.reject(new da("upload unit is different, reject to continue",lg)):P&&(_.manager=x,x.chunkCount=B.chunkCount,x.chunks=B.chunks,x.totalFailures=B.totalFailures,x.uploadedChunks=B.uploadedChunks,x.timer=B.timer,x.initState=B.initState,x.unit=B.unit,x.uploadedSize=B.uploadedSize,x.singleThread=B.singleThread,x.updateProgress(0)),x.addServers(cE),x.initState!=="uninitialized"){iE.next=7;break}return Wt=x.initChunks(_E),iE.next=7,Wt;case 7:case"end":return iE.stop()}},lE)}));return function(lE){return CE.apply(this,arguments)}}())).subscribe({complete:function(){return _s({hasExist:!1})},error:_c}),_m=function(CE){x.initState!=="uninitialized"&&Wt?_s(Wt.then(function(){return{hasExist:!1}})):_c(CE)},tE.pipe(ob(ue)).subscribe({error:_m}),aE.pipe(ob(ue)).subscribe({error:_m})}),_o.next=9,_n;case 9:if(_i=_o.sent,!_i.hasExist){_o.next=15;break}return x.updateProgress(),this.log("file already exists, skipping upload"),_o.abrupt("return");case 15:ue.next(),ue.complete(),this.log("chunks initialization promise resolved"),Ei=gb(x.ee,"serverUsedUp").pipe(Gt(function(){return x.chunkCount!==x.uploadedChunks.length}),Jt(5e3,void 0,{leading:!1}),pm(function(){return _t().ret})).subscribe(function(_s){x.addServers(_s.servers)}),x.ee.once("reconnected",function(){x.ee.removeAllListeners(),_a.doUploadTask(_,C,!0).catch(function(_s){C.reject(_s)})}),x.ee.once("multiTimeOut",function(){x.ee.removeAllListeners(),_a.doUploadTask(_,C,!0).catch(function(_s){C.reject(_s)})}),x.ee.once("timedOut",function(){Ei.unsubscribe(),x.ee.removeAllListeners(),x.abortController.abort(),C.reject(new db("upload timed out",Lh))}),x.ee.once("error",function(_s){Ei.unsubscribe(),x.ee.removeAllListeners(),x.abortController.abort(),C.reject(_s||new da("upload error",lg))}),x.transHandler.cancelSignal!==void 0&&x.transHandler.cancelSignal.addEventListener("abort",function(){C.reject(new hl("Uploading canceled",hr))},{once:!0}),x.ee.once("finished",J(w.mark(function _s(){var _c,_m,Qm;return w.wrap(function(tE){for(;;)switch(tE.prev=tE.next){case 0:return Ei.unsubscribe(),tE.next=3,_.setter(x.unit,x.getUploadServerIPs());case 3:_c=tE.sent,_m=_c.zone,Qm=_c.unit,x.ee.removeAllListeners(),C.resolve({type:"UPLOAD",retUnit:Qm,zone:_m});case 8:case"end":return tE.stop()}},_s)}))),x.uploadToServers();case 26:case"end":return _o.stop()}},f,this)}));return function(f,_){return d.apply(this,arguments)}}()},{key:"doUploadTask",value:function(d,f){var _=this,C=2<arguments.length&&arguments[2]!==void 0&&arguments[2],P=d.taskId;return C||(this.mediaTasks.delete(P),this.ongoingTask=d),new Promise(function(x,B){_.doUploadTaskImpl(d,f,C).then(x).catch(B)})}},{key:"processMediaTask",value:function(){var d=J(w.mark(function f(){var _,C,P;return w.wrap(function(x){for(;;)switch(x.prev=x.next){case 0:if(this.mediaTasks.size!==0){x.next=2;break}throw Error("no upload tasks");case 2:if(this.isProcessing=!0,_=this.mediaTasks.keys().next().value,(C=this.taskFinishers[_])!==void 0){x.next=7;break}throw Error("top task not found");case 7:if((P=this.mediaTasks.get(_))!==void 0){x.next=10;break}throw new Ia("task invalid");case 10:if(P.type!=="UPLOAD"){x.next=15;break}return x.next=13,this.doUploadTask(P,C).catch(function(B){P.manager.ee.removeAllListeners(),C.reject(B)});case 13:x.next=18;break;case 15:if(P.type!=="DOWNLOAD"){x.next=18;break}return x.next=18,this.doDownloadTask(P,C).catch(function(B){P.manager.ee.removeAllListeners(),C.reject(B)});case 18:case"end":return x.stop()}},f,this)}));return function(){return d.apply(this,arguments)}}()},{key:"cancelTask",value:function(d){var f=d.type==="DOWNLOAD"?ir:hr;d.manager.ee.removeAllListeners(),d.manager.abortController.abort(),this.taskFinishers[d.taskId]!==void 0&&this.taskFinishers[d.taskId].reject(new hl("User logged out or kicked off, media task canceled",f))}}]),r}(tb());m(fs,"MAX_PENDING_TASK_COUNT",9),Oo("of",function(){for(var e=0,r=arguments.length,s=new(Ne(this))(r);r>e;)s[e]=arguments[e++];return s},Dj);var gs=1/0,dD=Math.max,ju=function(e,r,s){var d=Object(e);if(!Ed(e)){var f=Te(r);e=Ad(e),r=function(_){return f(d[_],_,d)}}return-1<(r=function(_,C,P){var x=_==null?0:_.length;if(!x)return-1;if(P==null)P=0;else{var B=(P=P?(P=gl(P))===gs||P===-gs?17976931348623157e292*(0>P?-1:1):P==P?P:0:P===0?P:0)%1;P=P==P?B?P-B:P:0}return 0>P&&(P=dD(x+P,0)),Xp(_,Te(C),P)}(e,r,s))?d[f?e[r]:r]:void 0},iu=function(e,r){return e&&e.length?vk(e,void 0,typeof r=="function"?r:void 0):[]},hs=function(){function e(){W(this,e),m(this,"size",0),m(this,"fields",new Map)}return Ha(e,[{key:"define",value:function(r,s,d){if(this.size+=d,64<this.size)throw new RangeError("the struct over 64 bits is not supported");Mg(s={val:0,isNumber:s==="number",isBoolean:s==="boolean",oneof:s==="number"||s==="boolean"?void 0:s,len:d}),this.fields.set(r,s)}},{key:"set",value:function(r,s){if(!(r=this.fields.get(r)))throw Error("field not found");var d=r.oneof;if(!U.isLong(s)&&typeof s!="number")if(typeof s=="boolean")s=s?1:0;else{if(d===void 0)throw Error("invalid field type");if((s=d[s])===void 0)throw Error("field type not found")}Mg(r,s),r.val=s}},{key:"toNumber",value:function(){for(var r=0,s=0,d=0,f=Array.from(this.fields);d<f.length;d++){var _=ra(f[d],2)[1],C=_.len;(_=_.val)!==void 0&&(r+=U.fromValue(_).shiftLeft(s).toNumber(),s+=C)}return r}},{key:"toLong",value:function(){for(var r=U.fromNumber(0,!0),s=0,d=0,f=Array.from(this.fields);d<f.length;d++){var _=ra(f[d],2)[1],C=_.len;(_=_.val)!==void 0&&(r=U.fromValue(_).shiftLeft(s).add(r),s+=C)}return r}},{key:"assert",value:function(r,s){function d(C){if(!U.isLong(C)&&typeof C!="number")if(typeof C=="boolean")C=C?1:0;else{if(_===void 0)throw Error("invalid field type");if((C=_[C])===void 0)throw Error("field type not found")}return Mg(f,C),Lg(C,f.val)}var f=this.fields.get(r);if(!f)throw Error("field not found");var _=f.oneof;if(!Array.isArray(s))return d(s);if(s.length===1)return d(s[0]);if(s.every(function(C){return typeof C=="string"})&&_!==void 0)return s.some(function(C){return d(C)});throw Error("invalid valueTypes")}},{key:"from",value:function(r){r=U.fromValue(r);for(var s=0,d=0,f=Array.from(this.fields);d<f.length;d++){var _=ra(f[d],2)[1],C=_.len,P=U.fromNumber(Math.pow(2,C)-1,!0).shiftLeft(s);Mg(_,P=r.and(P).shiftRightUnsigned(s)),_.val=P,s+=C}}},{key:"typeOf",value:function(r){if((r=this.fields.get(r))!==void 0){var s=r.oneof;if(r=r.val,s!==void 0){var d=0;for(s=Object.entries(s);d<s.length;d++){var f=ra(s[d],2),_=f[0];if(Lg(r,f[1]))return _}}}throw new TypeError("can only get type of oneof type")}}]),e}(),is=function(e){function r(d){W(this,r);var f=s.call(this);return f.define("Rejoin","boolean",1),f.define("Unused","number",31),f.define("Platform","number",8),f.define("Version","number",12),f.define("Subversion","number",12),f.set("Platform",7),f.set("Version",4),f.set("Subversion",203),f.set("Rejoin",d),f}la(r,e);var s=ma(r);return r}(hs),eD=ua(ua(ua(ua({},{PeerTextMessage:0,ChannelTextMessage:1,VendorTextMessage:2}),{PeerRawMessage:3,ChannelRawMessage:4,VendorRawMessage:5}),{PeerImageMessage:6,ChannelImageMessage:7,VendorImageMessage:8}),{PeerFileMessage:15,ChannelFileMessage:16,VendorFileMessage:17}),js={CallInvite:101,CallAccept:102,CallReject:103,CallCancel:104},fD=ua(ua({},eD),js),gD={Uncompressed:0,Zlib:1},ae=function(e){function r(d){W(this,r);var f=s.call(this);if(f.define("MessageType",fD,8),f.define("BroadcastJumps","number",2),f.define("ToCache","boolean",1),f.define("FromCache","boolean",1),f.define("CompressionMethod",gD,2),f.define("IterationNumber","number",4),f.define("BufferedMessage","boolean",1),f.define("ToArchive","boolean",1),f.define("FromArchive","boolean",1),typeof d=="number"||U.isLong(d))f.from(d);else if(d!==void 0){var _=0;for(d=Hg(d);_<d.length;_++){var C=ra(d[_],2);f.set(C[0],C[1])}}return f}la(r,e);var s=ma(r);return Ha(r,[{key:"isTextMessage",value:function(){return this.assert("MessageType",["PeerTextMessage","ChannelTextMessage","VendorTextMessage"])}},{key:"isRawMessage",value:function(){return this.assert("MessageType",["ChannelRawMessage","PeerRawMessage","VendorRawMessage"])}},{key:"isRawPeerMessage",value:function(){return this.assert("MessageType","PeerRawMessage")}},{key:"isRawChannelMessage",value:function(){return this.assert("MessageType","ChannelRawMessage")}},{key:"isPeerTextMessage",value:function(){return this.assert("MessageType","PeerTextMessage")}},{key:"isChannelTextMessage",value:function(){return this.assert("MessageType","ChannelTextMessage")}},{key:"isInvitation",value:function(d){var f=this;return d!==void 0?this.assert("MessageType",d):xf(js).some(function(_){return f.assert("MessageType",_)})}},{key:"isFileMessage",value:function(){return this.assert("MessageType",["PeerFileMessage","ChannelFileMessage","VendorFileMessage"])}},{key:"isImageMessage",value:function(){return this.assert("MessageType",["PeerImageMessage","ChannelImageMessage","VendorImageMessage"])}},{key:"isPeerMessage",value:function(){return this.assert("MessageType",["PeerFileMessage","PeerTextMessage","PeerImageMessage","PeerRawMessage"])}},{key:"isZlibCompressed",value:function(){return this.assert("CompressionMethod","Zlib")}},{key:"isFromCache",value:function(){return this.assert("FromCache",!0)}},{key:"isBufferedMessage",value:function(){return this.assert("BufferedMessage",!0)}},{key:"getInvitationType",value:function(){if(!this.isInvitation())throw new TypeError("cannot get InvitationType of a normal message type");return this.typeOf("MessageType")}}]),r}(hs),hD=function(e){function r(d){return W(this,r),m(n(d=s.call(this,d,"ChatManager")),"dialogueLru",new Sx(void 0,{maxlen:1e4,ttl:1e4})),d}la(r,e);var s=ma(r);return Ha(r,[{key:"getChatInfo",value:function(d){var f=this.dialogueLru.get(d);if(this.dialogueLru.prune(),f){var _=f.dialogue,C={dialogue:_,sequence:f=f.sequence.add(1)};return this.dialogueLru.set(d,{dialogue:_,sequence:f}),C}return _={dialogue:Bg(),sequence:U.fromNumber(1,!0)},this.dialogueLru.set(d,_),_}}]),r}(tb()),v={};X(module)=="object"&&(module.exports=v),v.parse=function(e,r){var s,d=v.bin.readUshort,f=v.bin.readUint,_={};for(s=(e=new Uint8Array(e)).length-4;f(e,s)!=101010256;)s--;var C=d(e,s=s+4+4);d(e,s+=2),f(e,s+=2),s=f(e,s+=4);for(var P=0;P<C;P++){f(e,s),s+=4,s+=4,s+=4,f(e,s+=4);var x=f(e,s+=4),B=f(e,s+=4),_t=d(e,s+=4),ue=d(e,s+2),Wt=d(e,s+4);s+=6;var _n=f(e,s+=8);s+=4,s+=_t+ue+Wt,v._readLocal(e,_n,_,x,B,r)}return _},v._readLocal=function(e,r,s,d,f,_){var C=v.bin.readUshort,P=v.bin.readUint;P(e,r),C(e,r+=4),C(e,r+=2);var x=C(e,r+=2);P(e,r+=2),P(e,r+=4),P=C(e,r=r+4+8);var B=C(e,r+=2);if(r+=2,C=v.bin.readUTF8(e,r,P),r=r+P+B,_)s[C]={size:f,csize:d};else if(e=new Uint8Array(e.buffer,r),x==0)s[C]=new Uint8Array(e.buffer.slice(r,r+d));else{if(x!=8)throw"unknown compression method: "+x;r=new Uint8Array(f),v.inflateRaw(e,r),s[C]=r}},v.inflateRaw=function(e,r){return v.F.inflate(e,r)},v.inflate=function(e,r){return e[0],e[1],v.inflateRaw(new Uint8Array(e.buffer,e.byteOffset+2,e.length-2),r)},v.deflate=function(e,r){r==null&&(r={level:6});var s=0,d=new Uint8Array(50+Math.floor(1.1*e.length));return d[s]=120,d[s+1]=156,s=v.F.deflateRaw(e,d,s+2,r.level),e=v.adler(e,0,e.length),d[s+0]=e>>>24&255,d[s+1]=e>>>16&255,d[s+2]=e>>>8&255,d[s+3]=e>>>0&255,new Uint8Array(d.buffer,0,s+4)},v.deflateRaw=function(e,r){r==null&&(r={level:6});var s=new Uint8Array(50+Math.floor(1.1*e.length)),d=v.F.deflateRaw(e,s,d,r.level);return new Uint8Array(s.buffer,0,d)},v.encode=function(e,r){r==null&&(r=!1);var s,d=0,f=v.bin.writeUint,_=v.bin.writeUshort,C={};for(s in e){var P=!v._noNeed(s)&&!r,x=e[s],B=v.crc.crc(x,0,x.length);C[s]={cpr:P,usize:x.length,crc:B,file:P?v.deflateRaw(x):x}}for(s in C)d+=C[s].file.length+30+46+2*v.bin.sizeUTF8(s);for(s in e=new Uint8Array(d+22),r=0,x=[],C)B=C[s],x.push(r),r=v._writeHeader(e,r,s,B,0);for(s in d=0,P=r,C)B=C[s],x.push(r),r=v._writeHeader(e,r,s,B,1,x[d++]);return C=r-P,f(e,r,101010256),_(e,r=r+4+4,d),_(e,r+=2,d),f(e,r+=2,C),f(e,r+4,P),e.buffer},v._noNeed=function(e){return e=e.split(".").pop().toLowerCase(),"png,jpg,jpeg,zip".indexOf(e)!=-1},v._writeHeader=function(e,r,s,d,f,_){var C=v.bin.writeUint,P=v.bin.writeUshort,x=d.file;return C(e,r,f==0?67324752:33639248),r+=4,f==1&&(r+=2),P(e,r,20),P(e,r+=2,0),P(e,r+=2,d.cpr?8:0),C(e,r+=2,0),C(e,r+=4,d.crc),C(e,r+=4,x.length),C(e,r+=4,d.usize),P(e,r+=4,v.bin.sizeUTF8(s)),P(e,r+=2,0),r+=2,f==1&&(C(e,r=r+2+2+6,_),r+=4),r+=s=v.bin.writeUTF8(e,r,s),f==0&&(e.set(x,r),r+=x.length),r},v.crc={table:function(){for(var e=new Uint32Array(256),r=0;256>r;r++){for(var s=r,d=0;8>d;d++)s=1&s?3988292384^s>>>1:s>>>1;e[r]=s}return e}(),update:function(e,r,s,d){for(var f=0;f<d;f++)e=v.crc.table[255&(e^r[s+f])]^e>>>8;return e},crc:function(e,r,s){return 4294967295^v.crc.update(4294967295,e,r,s)}},v.adler=function(e,r,s){var d=1,f=0,_=r;for(r+=s;_<r;){for(s=Math.min(_+5552,r);_<s;)f+=d+=e[_++];d%=65521,f%=65521}return f<<16|d},v.bin={readUshort:function(e,r){return e[r]|e[r+1]<<8},writeUshort:function(e,r,s){e[r]=255&s,e[r+1]=s>>8&255},readUint:function(e,r){return 16777216*e[r+3]+(e[r+2]<<16|e[r+1]<<8|e[r])},writeUint:function(e,r,s){e[r]=255&s,e[r+1]=s>>8&255,e[r+2]=s>>16&255,e[r+3]=s>>24&255},readASCII:function(e,r,s){for(var d="",f=0;f<s;f++)d+=String.fromCharCode(e[r+f]);return d},writeASCII:function(e,r,s){for(var d=0;d<s.length;d++)e[r+d]=s.charCodeAt(d)},pad:function(e){return 2>e.length?"0"+e:e},readUTF8:function(e,r,s){for(var d,f="",_=0;_<s;_++)f+="%"+v.bin.pad(e[r+_].toString(16));try{d=decodeURIComponent(f)}catch{return v.bin.readASCII(e,r,s)}return d},writeUTF8:function(e,r,s){for(var d=s.length,f=0,_=0;_<d;_++){var C=s.charCodeAt(_);if(!(4294967168&C))e[r+f]=C,f++;else if(!(4294965248&C))e[r+f]=192|C>>6,e[r+f+1]=128|C>>0&63,f+=2;else if(!(4294901760&C))e[r+f]=224|C>>12,e[r+f+1]=128|C>>6&63,e[r+f+2]=128|C>>0&63,f+=3;else{if(4292870144&C)throw"e";e[r+f]=240|C>>18,e[r+f+1]=128|C>>12&63,e[r+f+2]=128|C>>6&63,e[r+f+3]=128|C>>0&63,f+=4}}return f},sizeUTF8:function(e){for(var r=e.length,s=0,d=0;d<r;d++){var f=e.charCodeAt(d);if(!(4294967168&f))s++;else if(!(4294965248&f))s+=2;else if(!(4294901760&f))s+=3;else{if(4292870144&f)throw"e";s+=4}}return s}},v.F={},v.F.deflateRaw=function(e,r,s,d){var f=[[0,0,0,0,0],[4,4,8,4,0],[4,5,16,8,0],[4,6,16,16,0],[4,10,16,32,0],[8,16,32,32,0],[8,16,128,128,0],[8,32,128,256,0],[32,128,258,1024,1],[32,258,258,4096,1]][d],_=v.F.U,C=v.F._goodIndex;v.F._hash;var P=v.F._putsE,x=0;s<<=3;var B=0,_t=e.length;if(d==0){for(;x<_t;){var ue=Math.min(65535,_t-x);P(r,s,x+ue==_t?1:0),s=v.F._copyExact(e,x,ue,r,s+8),x+=ue}return s>>>3}P=_.lits,d=_.strt;var Wt=_.prev,_n=0,_i=0,Ei=0,_a=0,Di=0;for(2<_t&&(d[Di=v.F._hash(e,0)]=0),x=0;x<_t;x++){if(ue=Di,x+1<_t-2){Di=v.F._hash(e,x+1);var _o=x+1&32767;Wt[_o]=d[Di],d[Di]=_o}if(B<=x){if((14e3<_n||26697<_i)&&100<_t-x&&(B<x&&(P[_n]=x-B,_n+=2,B=x),s=v.F._writeBlock(x==_t-1||B==_t?1:0,P,_n,_a,e,Ei,x-Ei,r,s),_n=_i=_a=0,Ei=x),_o=0,x<_t-2&&(_o=v.F._bestMatch(e,x,Wt,ue,Math.min(f[2],_t-x),f[3])),_o!=0){ue=_o>>>16,_o&=65535;var _s=C(ue,_.of0);_.lhst[257+_s]++;var _c=C(_o,_.df0);_.dhst[_c]++,_a+=_.exb[_s]+_.dxb[_c],P[_n]=ue<<23|x-B,P[_n+1]=_o<<16|_s<<8|_c,_n+=2,B=x+ue}else _.lhst[e[x]]++;_i++}}for(Ei==x&&e.length!=0||(B<x&&(P[_n]=x-B,_n+=2),s=v.F._writeBlock(1,P,_n,_a,e,Ei,x-Ei,r,s));7&s;)s++;return s>>>3},v.F._bestMatch=function(e,r,s,d,f,_){var C=32767&r,P=s[C],x=C-P+32768&32767;if(P==C||d!=v.F._hash(e,r-x))return 0;for(var B=d=0,_t=Math.min(32767,r);x<=_t&&--_!=0&&P!=C;){if((d==0||e[r+d]==e[r+d-x])&&(C=v.F._howLong(e,r,x))>d){if(B=x,(d=C)>=f)break;x+2<C&&(C=x+2);for(var ue=0,Wt=0;Wt<C-2;Wt++){var _n=r-x+Wt+32768&32767,_i=_n-s[_n]+32768&32767;_i>ue&&(ue=_i,P=_n)}}x+=(C=P)-(P=s[C])+32768&32767}return d<<16|B},v.F._howLong=function(e,r,s){if(e[r]!=e[r-s]||e[r+1]!=e[r+1-s]||e[r+2]!=e[r+2-s])return 0;var d=r,f=Math.min(e.length,r+258);for(r+=3;r<f&&e[r]==e[r-s];)r++;return r-d},v.F._hash=function(e,r){return(e[r]<<8|e[r+1])+(e[r+2]<<4)&65535},v.saved=0,v.F._writeBlock=function(e,r,s,d,f,_,C,P,x){var B=v.F.U,_t=v.F._putsF,ue=v.F._putsE;B.lhst[256]++;var Wt=v.F.getTrees(),_n=Wt[0],_i=Wt[1],Ei=Wt[2],_a=Wt[3],Di=Wt[4],_o=Wt[5],_s=Wt[6];Wt=Wt[7];var _c=32+(x+3&7?8-(x+3&7):0)+(C<<3),_m=d+v.F.contSize(B.fltree,B.lhst)+v.F.contSize(B.fdtree,B.dhst);d=d+v.F.contSize(B.ltree,B.lhst)+v.F.contSize(B.dtree,B.dhst),d+=14+3*_o+v.F.contSize(B.itree,B.ihst)+(2*B.ihst[16]+3*B.ihst[17]+7*B.ihst[18]);for(var Qm=0;286>Qm;Qm++)B.lhst[Qm]=0;for(Qm=0;30>Qm;Qm++)B.dhst[Qm]=0;for(Qm=0;19>Qm;Qm++)B.ihst[Qm]=0;if(_c=_c<_m&&_c<d?0:_m<d?1:2,_t(P,x,e),_t(P,x+1,_c),x+=3,_c==0){for(;7&x;)x++;x=v.F._copyExact(f,_,C,P,x)}else{if(_c==1)var tE=B.fltree,aE=B.fdtree;if(_c==2){for(v.F.makeCodes(B.ltree,_n),v.F.revCodes(B.ltree,_n),v.F.makeCodes(B.dtree,_i),v.F.revCodes(B.dtree,_i),v.F.makeCodes(B.itree,Ei),v.F.revCodes(B.itree,Ei),tE=B.ltree,aE=B.dtree,ue(P,x,_a-257),ue(P,x+=5,Di-1),ue(P,x+=5,_o-4),x+=4,e=0;e<_o;e++)ue(P,x+3*e,B.itree[1+(B.ordr[e]<<1)]);x=v.F._codeTiny(_s,B.itree,P,x+3*_o),x=v.F._codeTiny(Wt,B.itree,P,x)}for(_o=0;_o<s;_o+=2){for(_s=(e=r[_o])>>>23,e=_+(8388607&e);_<e;)x=v.F._writeLit(f[_++],tE,P,x);_s!=0&&(e=(_n=r[_o+1])>>16,C=_n>>8&255,_n&=255,ue(P,x=v.F._writeLit(257+C,tE,P,x),_s-B.of0[C]),x+=B.exb[C],_t(P,x=v.F._writeLit(_n,aE,P,x),e-B.df0[_n]),x+=B.dxb[_n],_+=_s)}x=v.F._writeLit(256,tE,P,x)}return x},v.F._copyExact=function(e,r,s,d,f){var _=f>>>3;return d[_]=s,d[_+1]=s>>>8,d[_+2]=255-d[_],d[_+3]=255-d[_+1],_+=4,d.set(new Uint8Array(e.buffer,r,s),_),f+(s+4<<3)},v.F.getTrees=function(){for(var e=v.F.U,r=v.F._hufTree(e.lhst,e.ltree,15),s=v.F._hufTree(e.dhst,e.dtree,15),d=[],f=v.F._lenCodes(e.ltree,d),_=[],C=v.F._lenCodes(e.dtree,_),P=0;P<d.length;P+=2)e.ihst[d[P]]++;for(P=0;P<_.length;P+=2)e.ihst[_[P]]++;P=v.F._hufTree(e.ihst,e.itree,7);for(var x=19;4<x&&e.itree[1+(e.ordr[x-1]<<1)]==0;)x--;return[r,s,P,f,C,x,d,_]},v.F.getSecond=function(e){for(var r=[],s=0;s<e.length;s+=2)r.push(e[s+1]);return r},v.F.nonZero=function(e){for(var r="",s=0;s<e.length;s+=2)e[s+1]!=0&&(r+=(s>>1)+",");return r},v.F.contSize=function(e,r){for(var s=0,d=0;d<r.length;d++)s+=r[d]*e[1+(d<<1)];return s},v.F._codeTiny=function(e,r,s,d){for(var f=0;f<e.length;f+=2){var _=e[f],C=e[f+1];d=v.F._writeLit(_,r,s,d);var P=_==16?2:_==17?3:7;15<_&&(v.F._putsE(s,d,C,P),d+=P)}return d},v.F._lenCodes=function(e,r){for(var s=e.length;s!=2&&e[s-1]==0;)s-=2;for(var d=0;d<s;d+=2){var f=e[d+1],_=d+3<s?e[d+3]:-1,C=d+5<s?e[d+5]:-1,P=d==0?-1:e[d-1];if(f==0&&_==f&&C==f){for(_=d+5;_+2<s&&e[_+2]==f;)_+=2;11>(f=Math.min(_+1-d>>>1,138))?r.push(17,f-3):r.push(18,f-11),d+=2*f-2}else if(f==P&&_==f&&C==f){for(_=d+5;_+2<s&&e[_+2]==f;)_+=2;f=Math.min(_+1-d>>>1,6),r.push(16,f-3),d+=2*f-2}else r.push(f,0)}return s>>>1},v.F._hufTree=function(e,r,s){var d=[],f=e.length,_=r.length,C=0;for(C=0;C<_;C+=2)r[C]=0,r[C+1]=0;for(C=0;C<f;C++)e[C]!=0&&d.push({lit:C,f:e[C]});if(e=d.length,f=d.slice(0),e==0)return 0;if(e==1)return r[1+((s=d[0].lit)<<1)]=1,r[1+((s==0?1:0)<<1)]=1;d.sort(function(_t,ue){return _t.f-ue.f}),C=d[0],_=d[1];var P=0,x=1,B=2;for(d[0]={lit:-1,f:C.f+_.f,l:C,r:_,d:0};x!=e-1;)C=P!=x&&(B==e||d[P].f<d[B].f)?d[P++]:d[B++],_=P!=x&&(B==e||d[P].f<d[B].f)?d[P++]:d[B++],d[x++]={lit:-1,f:C.f+_.f,l:C,r:_};for((d=v.F.setDepth(d[x-1],0))>s&&(v.F.restrictDepth(f,s,d),d=s),C=0;C<e;C++)r[1+(f[C].lit<<1)]=f[C].d;return d},v.F.setDepth=function(e,r){return e.lit!=-1?e.d=r:Math.max(v.F.setDepth(e.l,r+1),v.F.setDepth(e.r,r+1))},v.F.restrictDepth=function(e,r,s){var d=0,f=1<<s-r,_=0;for(e.sort(function(P,x){return x.d==P.d?P.f-x.f:x.d-P.d}),d=0;d<e.length&&e[d].d>r;d++){var C=e[d].d;e[d].d=r,_+=f-(1<<s-C)}for(_>>>=s-r;0<_;)(C=e[d].d)<r?(e[d].d++,_-=1<<r-C-1):d++;for(;0<=d;d--)e[d].d==r&&0>_&&(e[d].d--,_++);_!=0&&console.log("debt left")},v.F._goodIndex=function(e,r){var s=0;return r[16|s]<=e&&(s|=16),r[8|s]<=e&&(s|=8),r[4|s]<=e&&(s|=4),r[2|s]<=e&&(s|=2),r[1|s]<=e&&(s|=1),s},v.F._writeLit=function(e,r,s,d){return v.F._putsF(s,d,r[e<<1]),d+r[1+(e<<1)]},v.F.inflate=function(e,r){var s=Uint8Array;if(e[0]==3&&e[1]==0)return r||new s(0);var d=v.F,f=d._bitsF,_=d._bitsE,C=d._decodeTiny,P=d.makeCodes,x=d.codes2map,B=d._get17,_t=d.U,ue=r==null;ue&&(r=new s(e.length>>>2<<3));for(var Wt,_n,_i,Ei,_a=0,Di=0,_o=_n=0,_s=0;_a==0;)if(_a=f(e,_s,1),Wt=f(e,_s+1,2),_s+=3,Wt==0)7&_s&&(_s+=8-(7&_s)),Wt=e[(_s=4+(_s>>>3))-4]|e[_s-3]<<8,ue&&(r=v.F._check(r,_o+Wt)),r.set(new s(e.buffer,e.byteOffset+_s,Wt),_o),_s=_s+Wt<<3,_o+=Wt;else{if(ue&&(r=v.F._check(r,_o+131072)),Wt==1&&(_i=_t.flmap,Ei=_t.fdmap,Di=511,_n=31),Wt==2){for(_n=_(e,_s,5)+257,Wt=_(e,_s+5,5)+1,_i=_(e,_s+10,4)+4,_s+=14,Ei=0;38>Ei;Ei+=2)_t.itree[Ei]=0,_t.itree[Ei+1]=0;for(Di=1,Ei=0;Ei<_i;Ei++){var _c=_(e,_s+3*Ei,3);_t.itree[1+(_t.ordr[Ei]<<1)]=_c,_c>Di&&(Di=_c)}_s+=3*_i,P(_t.itree,Di),x(_t.itree,Di,_t.imap),_i=_t.lmap,Ei=_t.dmap,_s=C(_t.imap,(1<<Di)-1,_n+Wt,e,_s,_t.ttree),Di=(1<<(_c=d._copyOut(_t.ttree,0,_n,_t.ltree)))-1,_n=(1<<(Wt=d._copyOut(_t.ttree,_n,Wt,_t.dtree)))-1,P(_t.ltree,_c),x(_t.ltree,_c,_i),P(_t.dtree,Wt),x(_t.dtree,Wt,Ei)}for(;;)if(_s+=15&(Wt=_i[B(e,_s)&Di]),(_c=Wt>>>4)>>>8==0)r[_o++]=_c;else{if(_c==256)break;Wt=_o+_c-254,264<_c&&(Wt=_o+((_c=_t.ldef[_c-257])>>>3)+_(e,_s,7&_c),_s+=7&_c),_s+=15&(_c=Ei[B(e,_s)&_n]);var _m=((_c=_t.ddef[_c>>>4])>>>4)+f(e,_s,15&_c);for(_s+=15&_c,ue&&(r=v.F._check(r,_o+131072));_o<Wt;)r[_o]=r[_o++-_m],r[_o]=r[_o++-_m],r[_o]=r[_o++-_m],r[_o]=r[_o++-_m];_o=Wt}}return r.length==_o?r:r.slice(0,_o)},v.F._check=function(e,r){var s=e.length;return r<=s?e:((r=new Uint8Array(Math.max(s<<1,r))).set(e,0),r)},v.F._decodeTiny=function(e,r,s,d,f,_){for(var C=v.F._bitsE,P=v.F._get17,x=0;x<s;){var B=e[P(d,f)&r];f+=15&B;var _t=B>>>4;if(15>=_t)_[x]=_t,x++;else{var ue=B=0;for(_t==16?(ue=3+C(d,f,2),f+=2,B=_[x-1]):_t==17?(ue=3+C(d,f,3),f+=3):_t==18&&(ue=11+C(d,f,7),f+=7),_t=x+ue;x<_t;)_[x]=B,x++}}return f},v.F._copyOut=function(e,r,s,d){for(var f=0,_=0,C=d.length>>>1;_<s;){var P=e[_+r];d[_<<1]=0,d[1+(_<<1)]=P,P>f&&(f=P),_++}for(;_<C;)d[_<<1]=0,d[1+(_<<1)]=0,_++;return f},v.F.makeCodes=function(e,r){var s,d,f=v.F.U,_=e.length,C=f.bl_count;for(s=0;s<=r;s++)C[s]=0;for(s=1;s<_;s+=2)C[e[s]]++;for(f=f.next_code,s=0,C[0]=0,d=1;d<=r;d++)s=s+C[d-1]<<1,f[d]=s;for(r=0;r<_;r+=2)(C=e[r+1])!=0&&(e[r]=f[C],f[C]++)},v.F.codes2map=function(e,r,s){for(var d=e.length,f=v.F.U.rev15,_=0;_<d;_+=2)if(e[_+1]!=0){var C=e[_+1],P=_>>1<<4|C,x=r-C;for(x=(C=e[_]<<x)+(1<<x);C!=x;)s[f[C]>>>15-r]=P,C++}},v.F.revCodes=function(e,r){for(var s=v.F.U.rev15,d=15-r,f=0;f<e.length;f+=2)e[f]=s[e[f]<<r-e[f+1]]>>>d},v.F._putsE=function(e,r,s){s<<=7&r,e[r>>>=3]|=s,e[r+1]|=s>>>8},v.F._putsF=function(e,r,s){s<<=7&r,e[r>>>=3]|=s,e[r+1]|=s>>>8,e[r+2]|=s>>>16},v.F._bitsE=function(e,r,s){return(e[r>>>3]|e[1+(r>>>3)]<<8)>>>(7&r)&(1<<s)-1},v.F._bitsF=function(e,r,s){return(e[r>>>3]|e[1+(r>>>3)]<<8|e[2+(r>>>3)]<<16)>>>(7&r)&(1<<s)-1},v.F._get17=function(e,r){return(e[r>>>3]|e[1+(r>>>3)]<<8|e[2+(r>>>3)]<<16)>>>(7&r)},v.F._get25=function(e,r){return(e[r>>>3]|e[1+(r>>>3)]<<8|e[2+(r>>>3)]<<16|e[3+(r>>>3)]<<24)>>>(7&r)},v.F.U=function(){var e=Uint16Array,r=Uint32Array;return{next_code:new e(16),bl_count:new e(16),ordr:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],of0:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],exb:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],ldef:new e(32),df0:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],dxb:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],ddef:new r(32),flmap:new e(512),fltree:[],fdmap:new e(32),fdtree:[],lmap:new e(32768),ltree:[],ttree:[],dmap:new e(32768),dtree:[],imap:new e(512),itree:[],rev15:new e(32768),lhst:new r(286),dhst:new r(30),ihst:new r(19),lits:new r(15e3),strt:new e(65536),prev:new e(32768)}}(),function(){function e(f,_,C){for(;_--!=0;)f.push(0,C)}for(var r=v.F.U,s=0;32768>s;s++){var d=s;d=(4278255360&(d=(4042322160&(d=(3435973836&(d=(2863311530&d)>>>1|(1431655765&d)<<1))>>>2|(858993459&d)<<2))>>>4|(252645135&d)<<4))>>>8|(16711935&d)<<8,r.rev15[s]=(d>>>16|d<<16)>>>17}for(s=0;32>s;s++)r.ldef[s]=r.of0[s]<<3|r.exb[s],r.ddef[s]=r.df0[s]<<4|r.dxb[s];e(r.fltree,144,8),e(r.fltree,112,9),e(r.fltree,24,7),e(r.fltree,8,8),v.F.makeCodes(r.fltree,9),v.F.codes2map(r.fltree,9,r.flmap),v.F.revCodes(r.fltree,9),e(r.fdtree,32,5),v.F.makeCodes(r.fdtree,5),v.F.codes2map(r.fdtree,5,r.fdmap),v.F.revCodes(r.fdtree,5),e(r.itree,19,0),e(r.ltree,286,0),e(r.dtree,30,0),e(r.ttree,320,0)}();var iD=["backups","servers"],jD=["backups","servers"],kD=["group"],nl=v.inflate,ks=v.deflate,ls=function(e){function r(d,f,_,C){W(this,r);var P=s.call(this,C,"Session");return m(n(P),"chatManager",void 0),m(n(P),"joinedChannels",new Set),m(n(P),"msgDedupLru",new tc(void 0,{maxlen:200})),m(n(P),"startTime",Date.now()),m(n(P),"seq",U.fromNumber(1,!0)),m(n(P),"userJoinOptions",new is(!1)),m(n(P),"seqSentStatuses",[!1,!1]),m(n(P),"dialogueSequenceLru",new tc(void 0,{maxlen:1e4})),m(n(P),"loggedOut",!1),m(n(P),"messageSentTimes",[]),m(n(P),"curLoginSockets",[void 0,void 0]),m(n(P),"loginSocketSubs",[{channels:new Map,receivers:[]},{channels:new Map,receivers:[]}]),m(n(P),"lastLoginSockets",[new qe(1),new qe(1)]),m(n(P),"dialPendingMsgSubjectMap",new Map),m(n(P),"context",void 0),m(n(P),"connection",void 0),m(n(P),"instanceId",void 0),m(n(P),"registerSocketsFailureListener",function(){P.connection.once("socketsFailure",function(){P.log("socketsFailure, creating a new connection"),ad(function(){return P.connection.removeAllListeners(),P.connection=new Yr(P.context,P.logger,!0),P.loginHandler(15e3,!0)}).pipe(oe(function(x){return x.pipe(cd(Zd.getParameter("RECONNECTING_AP_INTERVAL")))}),ob(P.connection.apClient.apFinish$)).subscribe(function(){P.log("new connection connected")})}),P.connection.listenerCount("tokenExpired")===0&&P.connection.on("tokenExpired",function(){P.emit("tokenExpired")})}),P.context=d,P.connection=f,P.instanceId=_,P.chatManager=new hD(C),P.log("The instanceId is %s",P.instanceId.toString()),P}la(r,e);var s=ma(r);return Ha(r,[{key:"fetchFileUploadIndexGet",value:function(d){var f=d.hash,_=d.size;if((d=this.getLoginSockets()).length===0)throw new K("Client is not logged in");var C=this.incGetSeq();return d.forEach(function(P){P.sendPacket("FileUploadIndexGet",{seq:C,hash:f,size:_})}),{ret:Ca.apply(void 0,G(d.map(function(P){return P.fromReceived("FileUploadIndexRet").pipe(aa(function(x){return C.eq(x.seq)}))}))),fin:Ca.apply(void 0,G(d.map(function(P){return P.fromReceived("FileUploadIndexFin").pipe(aa(function(x){return C.eq(x.seq)}))}))),err:Xb.apply(void 0,G(d.map(function(P){return P.fromReceived("FileUploadIndexErr").pipe(aa(function(x){return C.eq(x.seq)}),ba(function(x){throw new da(["The media message upload failure, code %d",x.code],lg)}))}))),timeout:r.genTimeoutError(Lh)}}},{key:"requestFileUploadIndexSet",value:function(d){var f=d.hash,_=d.unit,C=d.servers;if((d=this.getLoginSockets()).length===0)throw new K("Client is not logged in");var P=this.incGetSeq();return d.forEach(function(x){x.sendPacket("FileUploadIndexSet",{seq:P,servers:C,hash:f,unit:_})}),Ca.apply(void 0,[r.genTimeoutError(Lh)].concat(G(d.map(function(x){return x.fromReceived("FileUploadIndexErr").pipe(aa(function(B){return P.eq(B.seq)}),ba(function(B){throw new da(["FileUploadIndexSet failure, code %d",B.code],lg)}))})),G(d.map(function(x){return x.fromReceived("FileUploadIndexFin").pipe(aa(function(B){return P.eq(B.seq)}))}))))}},{key:"requestFileDownloadIndexGet",value:function(d){var f=d.size,_=d.zone,C=d.unit,P=d.hash,x=this.getLoginSockets();if(x.length===0)throw new K("Client is not logged in");var B=this.incGetSeq();return x.forEach(function(_t){_t.sendPacket("FileDownloadIndexGet",{seq:B,size:f,zone:_,unit:C,hash:P})}),d=Ca.apply(void 0,G(x.map(function(_t){return _t.fromReceived("FileDownloadIndexRet").pipe(aa(function(ue){return B.eq(ue.seq)}))}))).pipe(ba(function(_t){var ue=_t.backups,Wt=_t.servers;return _t=ff(_t,iD),ua({backupList:ue.map(function(_n){return[_n]}),serverList:Wt.map(function(_n){return[_n]})},_t)}),cd(500)),x=jm(x.map(function(_t){return _t.fromReceived("FileDownloadIndexRet").pipe(aa(function(ue){return B.eq(ue.seq)}))})),Ca(d,x.pipe(ba(function(_t){return _t.reduce(function(ue,Wt){var _n=ue.backupList,_i=ue.serverList;ue=Wt.backups;var Ei=Wt.servers;return Wt=ff(Wt,jD),ua({backupList:ue.map(function(_a,Di){return[_a].concat(G(_n!==void 0&&Array.isArray(_n[Di])?_n[Di]:[]))}),serverList:Ei.map(function(_a,Di){return[_a].concat(G(_n!==void 0&&Array.isArray(_i[Di])?_i[Di]:[]))})},Wt)},{})})),r.genTimeoutError(Lh))}},{key:"loginHandler",value:function(){var d=this,f=0<arguments.length&&arguments[0]!==void 0?arguments[0]:2e4,_=1<arguments.length&&arguments[1]!==void 0&&arguments[1];if(this.loggedOut&&_)throw new K("Already logged out, request ignored");_&&this.registerSocketsFailureListener(),this.connection.initConnection();var C=this.getSocketLoginObservables(this.connection.lastOpenSockets,this.seq),P=Date.now();return C.forEach(function(x,B){var _t=d.loginSocketSubs[B].login;_t!==void 0&&_t.unsubscribe(),d.loginSocketSubs[B].login=x.pipe(ca(function(ue){var Wt;d.curLoginSockets[B]=ue;var _n=Date.now();eb("Link",{ackedServerIp:ue.address,destServerIp:ue.ip,ec:0,sc:0,elapse:fb(d.startTime),lts:U.fromNumber(_n),responseTime:P-_n,sid:Xa(d.instanceId),userId:d.context.uid},(Wt=d.context.config.enableCloudProxy)!==null&&Wt!==void 0&&Wt),d.emit("userJoined",ue.env),_&&d.connection.apClient.apFinish$.next(void 0)})).subscribe(d.lastLoginSockets[B])}),this.initKeepAliveSender(),this.initKeepAliveReconnector(),this.initLoginReceiver(),Xb.apply(void 0,G(C).concat([gb(this.connection,"connectionInitFailure").pipe(ca(function(x){throw sa(x)||Sa(x)?x:new da("Login failure",{code:Zq,originalError:x})}))])).pipe(Ka(1),hb(f),Ga(function(x){return x instanceof pb&&d.warn("Client login timeout"),x&&x.code===Kh&&(d.connection.emit("tokenExpired"),d.connection.apClient.apFinish$.next(void 0)),d.clearSockets(0,_),Z(x)}),ca(function(){_||d.registerSocketsFailureListener()}),wg(function(){_||d.connection.apClient.apFinish$.next(void 0)}))}},{key:"logoutHandler",value:function(){var d=J(w.mark(function f(){var _,C,P,x=this;return w.wrap(function(B){for(;;)switch(B.prev=B.next){case 0:return this.loggedOut=!0,this.connection.apClient.apFinish$.next(void 0),_=this.getLoginSockets(),C=_.map(function(_t){return _t.sendPacket("UserQuit",{}),x.connection.waitClosing(_t)}),this.clearSockets(5e3),P=_.map(function(_t){return _t.env}),[0,1].filter(function(_t){return!P.includes(_t)}).forEach(function(_t){x.connection.closeSocket(_t,0)}),B.abrupt("return",Xb.apply(void 0,G(C)).toPromise());case 9:case"end":return B.stop()}},f,this)}));return function(){return d.apply(this,arguments)}}()},{key:"requestChannelJoin",value:function(){var d=J(w.mark(function f(_,C){var P,x,B,_t=this;return w.wrap(function(ue){for(;;)switch(ue.prev=ue.next){case 0:if(this.getLoginSockets().length!==0){ue.next=2;break}throw new K("Client is not logged in. Cannot join the channel",Vq);case 2:return P=gb(this,"channelLeft").pipe(wb(function(Wt){return Wt===_}),Ka(1)),x=this.incGetSeq(),(B=this.lastLoginSockets.map(function(Wt){return Wt.pipe(Cc(function(_n,_i){_i!==0&&_t.incSeqIfNeeded(_n.env);var Ei=_i===0?x:_t.seq;return _n.sendPacket("GroupEnter",{account:C,seq:Ei}),_n.fromReceived("GroupReply").pipe(aa(function(_a){return Ei.eq(_a.seq)}),ca(function(_a){if((_a=_a.code)!==0)throw new da(["Channel join failure. The response code is %d",_a],Rq)}))}),ob(P),pe())})).forEach(function(Wt,_n){var _i=function(){return _t.loginSocketSubs[_n].channels.delete(_.channelId)};_t.loginSocketSubs[_n].channels.set(_.channelId,Wt.subscribe({error:_i,complete:_i}))}),ue.next=8,Xb.apply(void 0,G(B)).pipe(Ka(1),hb(1e4),Ga(function(Wt){return Wt instanceof pb&&_t.warn("Channel join timeout"),Z(Wt)})).toPromise();case 8:this.joinedChannels.add(_);case 9:case"end":return ue.stop()}},f,this)}));return function(f,_){return d.apply(this,arguments)}}()},{key:"requestChannelLeave",value:function(d,f){this.emit("channelLeft",d),this.joinedChannels.delete(d),this.getLoginSockets().forEach(function(_){_.sendPacket("GroupLeave",{account:f})})}},{key:"requestChannelMemberList",value:function(d){var f=this.getLoginSockets();if(f.length===0)throw new K("Client is not logged in. Cannot get the channel members",cA);var _=this.incGetSeq();return f.forEach(function(C){C.sendPacket("GroupAllUsersList",{group:d,pageNumber:0,pageSize:200,seq:_})}),Ca.apply(void 0,[r.genTimeoutError(Pq)].concat(G(f.map(function(C){return C.fromReceived("GroupAllUsersResult").pipe(aa(function(P){var x=P.seq;return P.group===d&&_.eq(x)}))}))))}},{key:"requestPeersOnlineStatus",value:function(d){var f=this.getLoginSockets();if(f.length===0)throw new K("Client is not logged in");var _=this.incGetSeq();return f.forEach(function(C){C.sendPacket("UserStatusList",{users:d,seq:_})}),Ca.apply(void 0,[r.genTimeoutError(oA)].concat(G(f.map(function(C){return C.fromReceived("UserStatusResult").pipe(aa(function(P){return _.eq(P.seq)}))}))))}},{key:"requestSetLocalUserAttributes",value:function(d,f){var _=this,C=this.getLoginSockets();if(C.length===0)throw new K("Client is not logged in");var P=this.incGetSeq();return C.forEach(function(x,B){f!==void 0&&B!==f||x.sendPacket("UserAttributeSet",{account:_.context.uid,attributeInfos:Object.entries(d).map(function(_t){return{key:(_t=ra(_t,2))[0],value:_t[1]}}),seq:P})}),Ca.apply(void 0,G(C.map(function(x){return x.fromReceived("UserAttributeErr").pipe(aa(function(B){return P.eq(B.seq)}),ba(function(B){throw new da(["The user attributes set failure, code %d",B.code],Sb)}))})).concat([r.genTimeoutError(Tb)],G(C.map(function(x){return x.fromReceived("UserAttributeRsp").pipe(aa(function(B){return P.eq(B.seq)}))}))))}},{key:"requestSetChannelAttributes",value:function(d,f,_){var C=this.getLoginSockets();if(C.length===0)throw new K("Client is not logged in");var P=this.incGetSeq();return C.forEach(function(x){x.sendPacket("GroupAttributeSet",{broadcast:_,group:d,attributeInfos:Object.entries(f).map(function(B){return{key:(B=ra(B,2))[0],value:B[1]}}),seq:P})}),Ca.apply(void 0,G(C.map(function(x){return x.fromReceived("GroupAttributeErr").pipe(aa(function(B){return P.eq(B.seq)}),ba(function(B){throw new da(["The group attributes set failure, code %d",B.code],Sb)}))})).concat([r.genTimeoutError(Tb)],G(C.map(function(x){return x.fromReceived("GroupAttributeRsp").pipe(aa(function(B){return P.eq(B.seq)}))}))))}},{key:"requestAddOrUpdateLocalUserAttributes",value:function(d){var f=this,_=this.getLoginSockets();if(_.length===0)throw new K("Client is not logged in");var C=this.incGetSeq();return _.forEach(function(P){P.sendPacket("UserAttributeMod",{account:f.context.uid,attributeInfos:Object.entries(d).map(function(x){return{key:(x=ra(x,2))[0],value:x[1]}}),seq:C})}),Ca.apply(void 0,G(_.map(function(P){return P.fromReceived("UserAttributeErr").pipe(aa(function(x){return C.eq(x.seq)}),ba(function(x){throw new da(["The user attributes add or update failure, code %d",x.code],Sb)}))})).concat([r.genTimeoutError(Tb)],G(_.map(function(P){return P.fromReceived("UserAttributeRsp").pipe(aa(function(x){return C.eq(x.seq)}))}))))}},{key:"requestAddOrUpdateChannelAttributes",value:function(d,f,_){var C=this.getLoginSockets();if(C.length===0)throw new K("Client is not logged in");var P=this.incGetSeq();return C.forEach(function(x){x.sendPacket("GroupAttributeMod",{broadcast:_,group:d,attributeInfos:Object.entries(f).map(function(B){return{key:(B=ra(B,2))[0],value:B[1]}}),seq:P})}),Ca.apply(void 0,G(C.map(function(x){return x.fromReceived("GroupAttributeErr").pipe(aa(function(B){return P.eq(B.seq)}),ba(function(B){throw new da(["The group attributes add or update failure, code %d",B.code],Sb)}))})).concat([r.genTimeoutError(Tb)],G(C.map(function(x){return x.fromReceived("GroupAttributeRsp").pipe(aa(function(B){return P.eq(B.seq)}))}))))}},{key:"requestDeleteLocalUserAttributesByKeys",value:function(d){var f=this,_=this.getLoginSockets();if(_.length===0)throw new K("Client is not logged in");var C=this.incGetSeq();return _.forEach(function(P){P.sendPacket("UserAttributeDel",{account:f.context.uid,attributes:d,seq:C})}),Ca.apply(void 0,G(_.map(function(P){return P.fromReceived("UserAttributeErr").pipe(aa(function(x){return C.eq(x.seq)}),ba(function(x){throw new da(["The user attributes delete failure, code %d",x.code],Sb)}))})).concat([r.genTimeoutError(Tb)],G(_.map(function(P){return P.fromReceived("UserAttributeRsp").pipe(aa(function(x){return C.eq(x.seq)}))}))))}},{key:"requestDeleteChannelAttributesByKeys",value:function(d,f,_){var C=this.getLoginSockets();if(C.length===0)throw new K("Client is not logged in");var P=this.incGetSeq();return C.forEach(function(x){x.sendPacket("GroupAttributeDel",{group:d,broadcast:_,attributes:f,seq:P})}),Ca.apply(void 0,G(C.map(function(x){return x.fromReceived("GroupAttributeErr").pipe(aa(function(B){return P.eq(B.seq)}),ba(function(B){throw new da(["The channel attributes delete failure, code %d",B.code],Sb)}))})).concat([r.genTimeoutError(Tb)],G(C.map(function(x){return x.fromReceived("GroupAttributeRsp").pipe(aa(function(B){return P.eq(B.seq)}))}))))}},{key:"requestClearLocalUserAttributes",value:function(){var d=this,f=this.getLoginSockets();if(f.length===0)throw new K("Client is not logged in");var _=this.incGetSeq();return f.forEach(function(C){C.sendPacket("UserAttributeSet",{account:d.context.uid,seq:_,attributeInfos:[]})}),Ca.apply(void 0,G(f.map(function(C){return C.fromReceived("UserAttributeErr").pipe(aa(function(P){return _.eq(P.seq)}),ba(function(P){throw new da(["The user attributes clear failure, code %d",P.code],Sb)}))})).concat([r.genTimeoutError(Tb)],G(f.map(function(C){return C.fromReceived("UserAttributeRsp").pipe(aa(function(P){return _.eq(P.seq)}))}))))}},{key:"requestClearChannelAttributes",value:function(d,f){var _=this.getLoginSockets();if(_.length===0)throw new K("Client is not logged in");var C=this.incGetSeq();return _.forEach(function(P){P.sendPacket("GroupAttributeSet",{group:d,seq:C,attributeInfos:[],broadcast:f})}),Ca.apply(void 0,G(_.map(function(P){return P.fromReceived("GroupAttributeErr").pipe(aa(function(x){return C.eq(x.seq)}),ba(function(x){throw new da(["The channel attributes clear failure, code %d",x.code],Sb)}))})).concat([r.genTimeoutError(Tb)],G(_.map(function(P){return P.fromReceived("GroupAttributeRsp").pipe(aa(function(x){return C.eq(x.seq)}))}))))}},{key:"requestGetUserAttributesByKeys",value:function(d,f){var _=this.getLoginSockets();if(_.length===0)throw new K("Client is not logged in");var C=this.incGetSeq();return _.forEach(function(P){P.sendPacket("UserAttributeGet",{account:d,seq:C,attributes:f})}),Ca.apply(void 0,[r.genTimeoutError(Tb)].concat(G(_.map(function(P){return P.fromReceived("UserAttributeErr").pipe(aa(function(x){return C.eq(x.seq)}),ba(function(x){throw(x=x.code)===10008?new da("The user requested is not online",Lq):new Wc(["User attribute operation unknown error code: %d",x],Sb)}))})),G(_.map(function(P){return P.fromReceived("UserAttributeRet").pipe(aa(function(x){return C.eq(x.seq)}))}))))}},{key:"requestGetChannelAttributesByKeys",value:function(d,f){var _=this.getLoginSockets();if(_.length===0)throw new K("Client is not logged in");var C=this.incGetSeq();return _.forEach(function(P){P.sendPacket("GroupAttributeGet",{group:d,seq:C,attributes:f})}),Ca.apply(void 0,[r.genTimeoutError(Tb)].concat(G(_.map(function(P){return P.fromReceived("GroupAttributeErr").pipe(aa(function(x){return C.eq(x.seq)}),ba(function(x){throw new da(["The channel attributes get failure, code %d",x.code],Sb)}))})),G(_.map(function(P){return P.fromReceived("GroupAttributeRet").pipe(aa(function(x){return C.eq(x.seq)}))}))))}},{key:"requestGetUserAttributeKeys",value:function(d){var f=this.getLoginSockets();if(f.length===0)throw new K("Client is not logged in");var _=this.incGetSeq();return f.forEach(function(C){C.sendPacket("UserAttributeKeysGet",{account:d,seq:_})}),Ca.apply(void 0,[r.genTimeoutError(Tb)].concat(G(f.map(function(C){return C.fromReceived("UserAttributeErr").pipe(aa(function(P){return _.eq(P.seq)}),ba(function(P){throw(P=P.code)===10008?new da("The user requested is not online",Lq):new Wc(["User attribute operation unknown error code: %d",P],Sb)}))})),G(f.map(function(C){return C.fromReceived("UserAttributeKeysRet").pipe(aa(function(P){return _.eq(P.seq)}))}))))}},{key:"requestGetChannelAttributesKeys",value:function(d){var f=this.getLoginSockets();if(f.length===0)throw new K("Client is not logged in");var _=this.incGetSeq();return f.forEach(function(C){C.sendPacket("GroupAttributeKeysGet",{group:d,seq:_})}),Ca.apply(void 0,[r.genTimeoutError(Tb)].concat(G(f.map(function(C){return C.fromReceived("GroupAttributeErr").pipe(aa(function(P){return _.eq(P.seq)}),ba(function(P){throw new Wc(["Channel attribute operation unknown error code: %d",P.code],Sb)}))})),G(f.map(function(C){return C.fromReceived("GroupAttributeKeysRet").pipe(aa(function(P){return _.eq(P.seq)}))}))))}},{key:"requestGetChannelMemberCount",value:function(d){var f=this.getLoginSockets();if(f.length===0)throw new K("Client is not logged in");var _=this.incGetSeq();return f.forEach(function(C){C.sendPacket("GroupStatusList",{groups:d,seq:_})}),Ca.apply(void 0,[r.genTimeoutError(Pq)].concat(G(f.map(function(C){return C.fromReceived("GroupStatusResult").pipe(aa(function(P){return _.eq(P.seq)}))}))))}},{key:"requestSubscribePeersOnlineStatus",value:function(d){var f=this.getLoginSockets();if(f.length===0)throw new K("Client is not logged in");var _=this.incGetSeq();return f.forEach(function(C){C.sendPacket("SubscribeUserStatus",{seq:_,users:d})}),Ca.apply(void 0,[r.genTimeoutError(vA)].concat(G(f.map(function(C){return C.fromReceived("SubscribeResponse").pipe(aa(function(P){return _.eq(P.seq)}))}))))}},{key:"requestUnsubscribePeersOnlineStatus",value:function(d){var f=this.getLoginSockets();if(f.length===0)throw new K("Client is not logged in");var _=this.incGetSeq();f.forEach(function(C){C.sendPacket("UnsubscribeUserStatus",{seq:_,users:d})})}},{key:"sendInvitationMessage",value:function(){var d=J(w.mark(function f(_){var C,P,x,B,_t,ue,Wt,_n,_i,Ei,_a,Di,_o=this;return w.wrap(function(_s){for(;;)switch(_s.prev=_s.next){case 0:if(C=_.peerId,P=_.callId,x=_.extra,B=_.isAcceptAck,_t=_.channelId,ue=_.type,Wt={callId:P},B===void 0){_s.next=6;break}if(ue==="CallAccept"){_s.next=5;break}throw Error("invalid invitation type");case 5:Wt.type=B?"ack":"request";case 6:return Wt.channel=_t,(ue==="CallInvite"||ue==="CallCancel"||ue==="CallReject"||ue==="CallAccept"&&B===!1)&&x!==void 0&&(Wt.extra=x),_n=Bg(),this.log("The sent invitation body is %o",Wt),_i=function(_c){return{MiscMap:{},sequence:U.fromNumber(1),dialogue:_n,instance:_o.instanceId,dst:C,ms:U.fromNumber(Date.now(),!0),options:new ae({IterationNumber:_c,MessageType:ue}).toLong(),payload:new TextEncoder().encode(JSON.stringify(Wt)),src:_o.context.uid}},_s.next=14,Kb(this.sendMessageToRetry(_i,!0)).pipe(hb(1e4),Ga(function(_c){return _c instanceof pb&&_o.warn("Send invitation timeout"),Z(_c)})).toPromise();case 14:return Ei=_s.sent,_a=Ei.code,Di=Ei.retryTimes,_s.abrupt("return",{hasPeerReceived:_a===0,hasReSent:Di!==0});case 18:case"end":return _s.stop()}},f,this)}));return function(f){return d.apply(this,arguments)}}()},{key:"sendMediaMessage",value:function(){var d=J(w.mark(function f(_,C,P,x,B,_t){var ue,Wt,_n,_i,Ei,_a,Di,_o,_s,_c,_m,Qm,tE,aE,CE,lE,gE,cE,_E,iE,rE,vf,Fg,_d,_f,uE,dE,IE,DE,GE=this;return w.wrap(function(QE){for(;;)switch(QE.prev=QE.next){case 0:if(Wt=C.width,_n=Wt===void 0?0:Wt,_i=C.height,Ei=_i===void 0?0:_i,_a=C.fileName,Di=_a===void 0?"":_a,_o=C.description,_s=_o===void 0?"":_o,_c=C.thumbnail,_m=_c===void 0?new Blob:_c,Qm=C.thumbnailHeight,tE=Qm===void 0?0:Qm,aE=C.thumbnailWidth,CE=aE===void 0?0:aE,lE=C.size,gE=lE===void 0?0:lE,cE=C.mediaId,_E=B.enableOfflineMessaging,iE=B.enableHistoricalMessaging,za(P)){QE.next=4;break}throw new I("The send message arguments are not valid",x?$k:hg);case 4:if(!(32768<new Blob([Di,_m,_s]).size)){QE.next=6;break}throw new I("The size of message overflowed ",x?ve:Hh);case 6:return rE=this.chatManager.getChatInfo(P),vf=rE.dialogue,Fg=rE.sequence,_d=this.instanceId,this.log('A%s media message is sending to %s: "'.concat(_d,"-").concat(vf,"#").concat(Fg,'"'),x?" peer":" channel",oa(P)),m(ue={},"media_description",_s),m(ue,"media_width",_n),m(ue,"media_height",Ei),m(ue,"media_thumbnailwidth",CE),m(ue,"media_thumbnailheight",tE),m(ue,"media_size",gE),m(ue,"media_id",cE),m(ue,"media_filename",Di),_f=uc(ue,function(a_){return new TextEncoder().encode(a_.toString())}),QE.t0=Uint8Array,QE.next=14,Ji(_m);case 14:return QE.t1=QE.sent,_f.media_thumbnail=new QE.t0(QE.t1),uE=x&&_==="IMAGE"?"PeerImageMessage":x&&_==="FILE"?"PeerFileMessage":x||_!=="IMAGE"?"ChannelFileMessage":"ChannelImageMessage",dE=function(a_){return{MiscMap:_f,sequence:Fg,dialogue:vf,instance:_d,dst:P,ms:U.fromNumber(Date.now(),!0),options:new ae({IterationNumber:a_,CompressionMethod:"Uncompressed",MessageType:uE,ToCache:_E,ToArchive:iE}).toLong(),payload:new Uint8Array,src:GE.context.uid}},QE.next=20,Kb(this.sendMessageToRetry(dE,!0)).pipe(hb(_t===void 0?1e4:_t),Ga(function(a_){return a_ instanceof pb&&GE.warn("Send message timeout"),Z(a_)})).toPromise();case 20:if(IE=QE.sent,(DE=IE.code)!==2){QE.next=24;break}throw new da("The peer does not support this type of message",nA);case 24:return QE.abrupt("return",{hasPeerReceived:DE===0});case 25:case"end":return QE.stop()}},f,this)}));return function(f,_,C,P,x,B){return d.apply(this,arguments)}}()},{key:"sendRawMessage",value:function(){var d=J(w.mark(function f(_,C,P,x,B,_t){var ue,Wt,_n,_i,Ei,_a,Di,_o,_s,_c,_m=this;return w.wrap(function(Qm){for(;;)switch(Qm.prev=Qm.next){case 0:if(ue=B.enableOfflineMessaging,Wt=B.enableHistoricalMessaging,za(P)&&_ instanceof Uint8Array&&typeof C=="string"){Qm.next=3;break}throw new I("The send message arguments are not valid",x?$k:hg);case 3:if(!(32768<_.byteLength+new Blob([C]).size)){Qm.next=5;break}throw new ib("The message size is over the 32KB limit",x?ve:Hh);case 5:return _n=!Zd.getParameter("DISABLE_MESSAGE_COMPRESSION")&&128<=_.byteLength,_i=this.chatManager.getChatInfo(P),Ei=_i.dialogue,_a=_i.sequence,Di=this.instanceId,this.log('A%s %s raw message is sending to %s: "'.concat(Di,"-").concat(Ei,"#").concat(_a,'"'),_n?" compressed":"",x?"peer":"channel",oa(P)),_o=function(tE){return{MiscMap:{description:new TextEncoder().encode(C)},sequence:_a,dialogue:Ei,instance:Di,dst:P,ms:U.fromNumber(Date.now(),!0),options:new ae({IterationNumber:tE,CompressionMethod:_n?"Zlib":"Uncompressed",MessageType:x?"PeerRawMessage":"ChannelRawMessage",ToCache:ue,ToArchive:Wt}).toLong(),payload:_n?ks(_):_,src:_m.context.uid}},Qm.next=12,Kb(this.sendMessageToRetry(_o,!0)).pipe(hb(_t===void 0?1e4:_t),Ga(function(tE){return tE instanceof pb&&_m.warn("Send message timeout"),Z(tE)})).toPromise();case 12:return _s=Qm.sent,_c=_s.code,Qm.abrupt("return",{hasPeerReceived:_c===0});case 15:case"end":return Qm.stop()}},f,this)}));return function(f,_,C,P,x,B){return d.apply(this,arguments)}}()},{key:"sendTextMessage",value:function(){var d=J(w.mark(function f(_,C,P,x,B){var _t,ue,Wt,_n,_i,Ei,_a,Di,_o,_s,_c,_m=this;return w.wrap(function(Qm){for(;;)switch(Qm.prev=Qm.next){case 0:if(_t=x.enableOfflineMessaging,ue=x.enableHistoricalMessaging,za(C)){Qm.next=3;break}throw new I("The send message arguments are not valid",P?$k:hg);case 3:if(!(32768<new Blob([_]).size)){Qm.next=5;break}throw new ib("The message size is over the 32KB limit",P?ve:Hh);case 5:return Wt=!Zd.getParameter("DISABLE_MESSAGE_COMPRESSION")&&128<=new Blob([_]).size,_n=this.chatManager.getChatInfo(C),_i=_n.dialogue,Ei=_n.sequence,_a=this.instanceId,this.log('A%s %s message is sending to %s: "'.concat(_a,"-").concat(_i,"#").concat(Ei,'"'),Wt?" compressed":"",P?"peer":"channel",oa(C)),Di=new TextEncoder().encode(_),_o=function(tE){return{MiscMap:{},sequence:Ei,dialogue:_i,instance:_a,dst:C,ms:U.fromNumber(Date.now(),!0),options:new ae({IterationNumber:tE,CompressionMethod:Wt?"Zlib":"Uncompressed",MessageType:P?"PeerTextMessage":"ChannelTextMessage",ToCache:_t,ToArchive:ue}).toLong(),payload:Wt?ks(Di):Di,src:_m.context.uid}},Qm.next=13,Kb(this.sendMessageToRetry(_o,!0)).pipe(hb(B===void 0?1e4:B),Ga(function(tE){return tE instanceof pb&&_m.warn("Send message timeout"),Z(tE)})).toPromise();case 13:return _s=Qm.sent,_c=_s.code,Qm.abrupt("return",{hasPeerReceived:_c===0});case 16:case"end":return Qm.stop()}},f,this)}));return function(f,_,C,P,x){return d.apply(this,arguments)}}()},{key:"cleanLoginSubs",value:function(d,f){Object.entries(this.loginSocketSubs[d]).forEach(function(_){var C=(_=ra(_,2))[1];_[0]==="channels"&&f||(Array.isArray(C)||C instanceof Map?C.forEach(function(P){return P.unsubscribe()}):C&&C.unsubscribe())}),this.loginSocketSubs[d]={channels:f?this.loginSocketSubs[d].channels:new Map,receivers:[]}}},{key:"sendMessageToRetry",value:function(){var d=J(w.mark(function f(_,C){var P,x,B,_t,ue,Wt,_n,_i,Ei,_a=this,Di=arguments;return w.wrap(function(_o){for(;;)switch(_o.prev=_o.next){case 0:if(P=2<Di.length&&Di[2]!==void 0?Di[2]:0,this.log("Attempt to send the message ".concat(C?" with retrying, %o":"without retrying"),{retryTimes:P}),(x=this.getLoginSockets()).length!==0){_o.next=5;break}throw Error("no logged-in sockets");case 5:return B=_(P),x.forEach(function(_s){_s.sendPacket("Message",B)}),_t=B.dialogue,ue=B.sequence,Wt=B.instance,_n=x.map(function(_s){return _s.fromReceived("Ack").pipe(wb(function(_c){return _t.eq(_c.dialogue)&&ue.eq(_c.sequence)&&Wt.eq(_c.instance)}))}),_o.prev=9,_o.next=12,Xb.apply(void 0,G(_n)).pipe(hb(6e3),Ga(function(_s){return Sa(_s)&&_a.warn("Message send timeout, retry times %d",P),Z(_s)}),Ka(1)).toPromise();case 12:return _i=_o.sent,Ei=_i.code,this.log("The message has been acked, %o",{code:Ei}),_o.abrupt("return",{code:Ei,retryTimes:P});case 18:if(_o.prev=18,_o.t0=_o.catch(9),!(_o.t0 instanceof pb&&C)){_o.next=22;break}return _o.abrupt("return",this.sendMessageToRetry(_,!1,P+1));case 22:throw _o.t0;case 23:case"end":return _o.stop()}},f,this,[[9,18]])}));return function(f,_){return d.apply(this,arguments)}}()},{key:"initKeepAliveSender",value:function(){var d=this;this.lastLoginSockets.map(function(f){return f.pipe(Cc(function(_){return Bc(0,2750).pipe(ca(function(){d.incSeqIfNeeded(_.env),_.sendPacket("Ping",{ms:U.fromNumber(Date.now(),!0),seq:d.seq})}))}))}).forEach(function(f,_){var C=d.loginSocketSubs[_].keepAlive;C!==void 0&&C.unsubscribe(),d.loginSocketSubs[_].keepAlive=f.subscribe({error:function(){}})})}},{key:"initKeepAliveReconnector",value:function(){var d=this;this.lastLoginSockets.map(function(f){return f.pipe(Cc(function(_){var C,P=!1,x=_.userJoin$.pipe(ca(function(){P=!0})),B=_.input$.pipe(ca(function(_t){Li[_t.uri].slice(0,-3)!=="Ping"&&(P=!1)}));return Xb(Bc(15e3,1e4).pipe(Pt(_.receivedPacket),ca(function(_t){_t=ra(_t,2),_t=ra(_t[1],2)[1],C!==_t||P||_.forceReconnect(),C=_t})),x,B)}))}).forEach(function(f,_){var C=d.loginSocketSubs[_].keepAliveReconnector;C!==void 0&&C.unsubscribe(),d.loginSocketSubs[_].keepAliveReconnector=f.subscribe({error:function(){}})})}},{key:"initLoginReceiver",value:function(){var d=this;this.lastLoginSockets.map(function(f){return f.pipe(Cc(function(_){return Xb(gb(_,"reconnect").pipe(ca(d.onSocketReconnect(_))),_.fromReceived("Message").pipe(ca(d.onMessage(_))),_.fromReceived("GroupEnterNotice").pipe(ca(d.onGroupEnterNotice())),_.fromReceived("GroupLeaveNotice").pipe(ca(d.onGroupLeaveNotice())),_.fromReceived("GroupCountNotice").pipe(ca(d.onGroupCountNotice())),_.fromReceived("GroupAttributeAlt").pipe(ca(d.onGroupAttributeAlt())),_.fromReceived("UserJoinNotice").pipe(ca(d.onUserNotice(S.PeerOnlineState.ONLINE))),_.fromReceived("UserQuitNotice").pipe(ca(d.onUserNotice(S.PeerOnlineState.OFFLINE))),_.fromReceived("UserWaitNotice").pipe(ca(d.onUserNotice(S.PeerOnlineState.UNREACHABLE)))).pipe(qf(void 0))}))}).forEach(function(f,_){d.loginSocketSubs[_].receivers.push(f.subscribe({error:function(){}}))})}},{key:"requestSocketLogin",value:function(d,f,_){var C=this;return im(ad(function(){C.userJoinOptions=new is(f),d.sendPacket("UserJoin",{account:C.context.uid,instance:C.instanceId,opt:C.userJoinOptions.toLong(),seq:_,ticket:d.ticket})}),d.fromReceived("UserResp").pipe(aa(function(P){return _.eq(P.seq)}),ca(function(P){if((P=P.code)!==0)throw C.clearSockets(),C.logError("Connected to gateway success but the Rtm server rejected login"),new da(["Login failure. The response code from the RTM service is %d",P],jg);C.log("ENV_%d logged in",d.env)}),qf(d),hb(15e3))).pipe(wb(function(P){return P!==void 0}),Ga(function(P){return P instanceof pb&&C.warn("Login response timeout, rejoin: %s",f),Z(P)}))}},{key:"getSocketLoginObservables",value:function(d,f){var _=this;return d.map(function(C){return C.pipe(ca(function(P){P.listenerCount("socketUserDrop")===0&&P.on("socketUserDrop",function(x){return _.onUserDrop(x,P)})}),Cc(function(P,x){return _.incSeqIfNeeded(P.env),_.requestSocketLogin(P,x!==0,x===0?f:_.seq)}),pe())})}},{key:"incSeqIfNeeded",value:function(d){if(![0,1].includes(d))throw new Fa({INVALID_ENV:"The env argument is not 0 or 1"});this.seqSentStatuses[d]&&(this.seq=this.seq.add(1),this.seqSentStatuses=[!1,!1]),this.seqSentStatuses[d]=!0}},{key:"incGetSeq",value:function(){return this.seq=this.seq.add(1),this.seqSentStatuses=[!0,!0],this.seq}},{key:"getLoginSockets",value:function(){for(var d=this.curLoginSockets,f=-1,_=d==null?0:d.length,C=0,P=[];++f<_;){var x=d[f];x&&(P[C++]=x)}return P}},{key:"emitMessage",value:function(d,f){var _=d.options,C=d.payload,P=d.src,x=d.dst,B=d.instance,_t=d.dialogue,ue=d.sequence,Wt=d.ms,_n=d.MiscMap;this.dialogueSequenceLru.set(_t.toString(),ue),B="".concat(B,"-").concat(_t,"#").concat(ue),this.msgDedupLru.has(B)?this.warn("Env_%d: Messages out-of-order or not start with 1: %s",f,B):(this.msgDedupLru.set(B,void 0),f=new ae(_),this.lastLoginSockets.forEach(function(){var _i=J(w.mark(function Ei(_a){var Di;return w.wrap(function(_o){for(;;)switch(_o.prev=_o.next){case 0:return _o.next=2,_a.pipe(Ka(1)).toPromise();case 2:Di=_o.sent,r.sendMessageAck(d,Di);case 4:case"end":return _o.stop()}},Ei)}));return function(Ei){return _i.apply(this,arguments)}}()),_=f.isZlibCompressed(),f.isInvitation()?(x=pa(_?nl(Xm(C,Uint8Array.of(0,0,0,0))):C),x=JSON.parse(x),this.log("The received invitation body is %o",x),this.emit("invitationMessage",{body:x,type:f.getInvitationType(),peerId:P,serverReceivedTs:Wt.toNumber()})):f.isTextMessage()?(_n=f.isPeerTextMessage(),C=pa(_?nl(Xm(C,Uint8Array.of(0,0,0,0))):C),this.info("Received a %s %s text message from %s to %s, %s",_?" compressed":"",_n?"peer":"channel",oa(P),oa(x),B),_n?(P={text:C,peerId:P,properties:{serverReceivedTs:Wt.toNumber(),isOfflineMessage:f.isFromCache()}},this.emit("peerTextMessage",P)):this.emit("channelTextMessage",{channelId:x,memberId:P,text:C,properties:{serverReceivedTs:Wt.toNumber(),isOfflineMessage:!1}})):f.isRawMessage()?(_t=f.isRawPeerMessage(),_n=(_n=_n.description)===void 0?"":pa(_n),C=_?nl(C):C,this.info("Received a %s %s raw message from %s to %s, %s",_?" compressed":"",_t?"peer":"channel",oa(P),oa(x),B),_t?(P={desc:_n,raw:C,peerId:P,properties:{serverReceivedTs:Wt.toNumber(),isOfflineMessage:f.isFromCache()}},this.emit("peerRawMessage",P)):this.emit("channelRawMessage",{desc:_n,raw:C,channelId:x,memberId:P,properties:{serverReceivedTs:Wt.toNumber(),isOfflineMessage:!1}})):(f.isImageMessage()||f.isFileMessage())&&(C=f.isPeerMessage(),this.info("Received a %s media message from %s to %s, %s",C?"peer":"channel",oa(P),oa(x),B),C?this.emit("peerMediaMessage",{messageType:f.isImageMessage()?"IMAGE":"FILE",details:_n,peerId:P,properties:{serverReceivedTs:Wt.toNumber(),isOfflineMessage:f.isFromCache()}}):this.emit("channelMediaMessage",{messageType:f.isImageMessage()?"IMAGE":"FILE",details:_n,memberId:P,channelId:x,properties:{serverReceivedTs:Wt.toNumber(),isOfflineMessage:f.isFromCache()}})))}},{key:"onSocketReconnect",value:function(d){var f=this;return function(){var _=[0,1].filter(function(C){return C!==d.env})[0];(_=f.connection.curOpenSockets[_])&&!_.loggedIn&&f.emit("connectionLost")}}},{key:"onUserDrop",value:function(d,f){var _;d=d.code,eb("KickedOff",{code:0,elapse:fb(this.startTime),linkId:parseInt(f.name.split("-")[1],10),lts:U.fromNumber(Date.now()),server:f.address,serverCode:d,sid:Xa(this.instanceId),userId:this.context.uid},(_=this.context.config.enableCloudProxy)!==null&&_!==void 0&&_),d===10006||d===10001?this.warn("Login too often and kicked off, reconnect and login"):d===10009?(this.warn("The instance ID conflicts, reconnecting"),this.instanceId=Bg(),this.context.sid=Xa(this.instanceId),this.emit("instanceChanged",this.instanceId)):[11,14,15,16].includes(d)&&(this.emit("userDrop",d),this.clearSockets())}},{key:"clearSockets",value:function(){var d=this,f=0<arguments.length&&arguments[0]!==void 0?arguments[0]:0,_=1<arguments.length&&arguments[1]!==void 0&&arguments[1];[0,1].forEach(function(C){d.cleanLoginSubs(C,_),d.connection.closeSocket(C,f)})}},{key:"onMessage",value:function(d){var f=this;return function(_){var C=_.dialogue,P=_.instance,x=_.sequence,B=_.options;if(_.src===f.context.uid)f.log("The message is from the local account, ignored");else{var _t=C.toString(),ue=f.dialPendingMsgSubjectMap.get(_t);if(C="".concat(P,"-").concat(C,"#").concat(x),ue)ue.next(_),f.log("Env_%d: The dialogue has pending messages, next: %s",d.env,C);else{var Wt=f.dialogueSequenceLru.get(_t);if(ue=!Wt&&x.eq(1),P=Wt!==void 0&&x.sub(Wt).eq(1),ue||P)f.emitMessage(_,d.env);else{if(Wt){if(x.lte(Wt))return;f.log("Env_%d: The message pended, the sequence is not continuous with the last: %s",d.env,C)}else f.log("Env_%d: The message pended, the first sequence is not equal to 1: %s",d.env,C);x=new Pa,f.dialPendingMsgSubjectMap.set(_t,x);var _n=x.pipe(Qs(Pk),xg(function(_i,Ei){return[].concat(G(_i),[Ei])},[]),ba(function(_i){return G(_i).sort(function(Ei,_a){return Ei=Ei.sequence,_a=_a.sequence,Ei.eq(_a)?0:Ei.gt(_a)?1:-1})}),sm(1));B=!(B=new ae(B)).isFromCache()&&!B.isBufferedMessage(),_n.pipe(ob(Bc(B?750:1500)),aa(function(_i){if(2>_i.length)return!1;for(var Ei=Wt===void 0?U.fromNumber(1,!0):Wt.add(1),_a=0;_a<_i.length;Ei=Ei.add(1),_a++)if(!_i[_a].sequence.eq(Ei))return!1;return!0}),wg(function(){f.dialPendingMsgSubjectMap.delete(_t)})).subscribe(function(_i){_i.forEach(function(Ei){f.emitMessage(Ei,d.env),f.log("Env_%d: The message queue has fully ordered, emitting: %s",d.env,"".concat(Ei.instance,"-").concat(Ei.dialogue,"#").concat(Ei.sequence))})},function(_i){_i instanceof vg&&_n.pipe(Ka(1)).subscribe(function(Ei){return Ei.forEach(function(_a){f.log("Env_%d: The message pending queue expired, emitting: %s",d.env,"".concat(_a.instance,"-").concat(_a.dialogue,"#").concat(_a.sequence)),f.emitMessage(_a,d.env)})})}),x.next(_)}}}}}},{key:"onGroupEnterNotice",value:function(){var d=this;return function(f){d.emit("memberNotice",{channelId:f.group,seq:f.seq,instance:f.instance,memberId:f.user,type:"MemberJoined",size:f.size})}}},{key:"onGroupLeaveNotice",value:function(){var d=this;return function(f){d.emit("memberNotice",{channelId:f.group,seq:f.seq,instance:f.instance,memberId:f.user,type:"MemberLeft",size:f.size})}}},{key:"onGroupCountNotice",value:function(){var d=this;return function(f){d.emit("memberNotice",{channelId:f.group,seq:f.seq,instance:f.instance,type:"MemberCountUpdated",size:f.size})}}},{key:"onGroupAttributeAlt",value:function(){var d=this;return function(f){var _=f.group;f=ff(f,kD),d.emit("channelAttributesUpdated",ua({channelId:_},f))}}},{key:"onUserNotice",value:function(d){var f=this;return function(_){f.emit("peerOnlineStatusChanged",{peerId:_.user,instance:_.instance,seq:_.seq,state:d})}}}],[{key:"sendMessageAck",value:function(d,f){var _=new ae(d.options);(_.isInvitation()||_.isPeerMessage())&&f.sendPacket("Ack",{code:0,dialogue:d.dialogue,instance:d.instance,sequence:d.sequence})}}]),r}(tb());m(ls,"genTimeoutError",function(e,r){return bb(void 0).pipe(cd(r===void 0?1e4:r),ba(function(){throw new db(["Request timed out after %ds",r===void 0?1e4:r],e)}))});var ms,ol,pl=0,ql=0;Ud.v1=function(e,r,s){s=r&&s||0;var d=r||[],f=(e=e||{}).node||ms,_=e.clockseq!==void 0?e.clockseq:ol;if(f==null||_==null){var C=Jq();f==null&&(f=ms=[1|C[0],C[1],C[2],C[3],C[4],C[5]]),_==null&&(_=ol=16383&(C[6]<<8|C[7]))}C=e.msecs!==void 0?e.msecs:new Date().getTime();var P=e.nsecs!==void 0?e.nsecs:ql+1,x=C-pl+(P-ql)/1e4;if(0>x&&e.clockseq===void 0&&(_=_+1&16383),(0>x||C>pl)&&e.nsecs===void 0&&(P=0),1e4<=P)throw Error("uuid.v1(): Can't create more than 10M uuids/sec");for(pl=C,ql=P,ol=_,e=(1e4*(268435455&(C+=122192928e5))+P)%4294967296,d[s++]=e>>>24&255,d[s++]=e>>>16&255,d[s++]=e>>>8&255,d[s++]=255&e,e=C/4294967296*1e4&268435455,d[s++]=e>>>8&255,d[s++]=255&e,d[s++]=e>>>24&15|16,d[s++]=e>>>16&255,d[s++]=_>>>8|128,d[s++]=255&_,_=0;6>_;++_)d[s+_]=f[_];return r||Kq(d)},Ud.v4=Ud;var rl=Ph(),vd,bf=S.LocalInvitationFailureReason,Ba=S.LocalInvitationState,lD=(vd=function(e){function r(d,f,_){W(this,r);var C=s.call(this,_,"RtmLocalInvitation",!0);return m(n(C),"state",Ba.IDLE),m(n(C),"localInvitationEnd$",Ca(gb(n(C),"LocalInvitationAccepted"),gb(n(C),"LocalInvitationRefused"),gb(n(C),"LocalInvitationFailure"),gb(n(C),"LocalInvitationCanceled")).pipe(Ka(1))),m(n(C),"callId",Ud.v4()),m(n(C),"_content",""),m(n(C),"_channelId",""),m(n(C),"_response",""),m(n(C),"calleeId",void 0),m(n(C),"logger",void 0),m(n(C),"getSession",void 0),C.calleeId=d,C.getSession=f,C.logger=_,C}la(r,e);var s=ma(r);return Ha(r,[{key:"channelId",get:function(){return this._channelId},set:function(d){this.state!==Ba.IDLE?this.info("set channelId only allow before invitation sent to remote"):(this.log("set channelId for %s",this.callId),this._channelId=d)}},{key:"content",get:function(){return this._content},set:function(d){this.log("set content for %s",this.callId),this._content=d}},{key:"response",get:function(){return this._response},set:function(d){throw new I('Cannot set the "response" of the LocalInvitation instance.',xc)}},{key:"send",value:function(){var d,f=this;if(this.state===Ba.SENT_TO_REMOTE||this.state===Ba.RECEIVED_BY_REMOTE)throw new K("The local invitation send failure. The call invitation has already been sent.",gA);if(this.isLocalInvitationEnd())throw new K("The local invitation send failure. The call invitation has ended.",Ih);if(0<this._channelId.length&&!za(this._channelId))throw new I("Illegal invitation channel ID",xc);if(!za(this.calleeId))throw new I("Illegal invitation callee user ID",xc);if(8192<Ig(this._content))throw new I('The length of the "content" overflows. The number of bytes representing content must not exceed 8 Ã— 1024 if encoded in UTF-8.',xc);this.state=Ba.SENT_TO_REMOTE,ad(J(w.mark(function _(){var C,P,x;return w.wrap(function(B){for(;;)switch(B.prev=B.next){case 0:return B.next=2,f.getSession().sendInvitationMessage({peerId:f.calleeId,callId:f.callId,extra:f._content,type:"CallInvite",channelId:f._channelId});case 2:if(C=B.sent,P=C.hasPeerReceived,x=C.hasReSent,!f.isLocalInvitationEnd()){B.next=7;break}throw new db("send invitation timeout");case 7:if(f.log("The local invitation has sent to the callee"),P||x){B.next=11;break}throw d=new rl({PEER_NOT_ONLINE:"The peer of the invitation is not online"});case 11:if(P){B.next=14;break}throw d=new rl({RESENT_AND_OFFLINE:"Resent and the peer of the invitation is not online"});case 14:case"end":return B.stop()}},_)}))).pipe(oe(function(_){return _.pipe(ca(function(C){if(!(C instanceof rl))throw C}),cd(2e3))}),hb(3e4),Ga(function(_){return Sa(_)&&f.warn("local invitation ack timed out"),Z(_)}),ob(this.localInvitationEnd$)).subscribe({next:function(){f.state===Ba.RECEIVED_BY_REMOTE?f.log('The local invitation state is already "RECEIVED_BY_REMOTE", skipped emitting "LocalInvitationReceivedByPeer"'):f.state!==Ba.SENT_TO_REMOTE?f.log("The invitation has ended, skipped emitting the %s event","LocalInvitationReceivedByPeer"):(f.info("The peer received the local invitation %s.",f.callId),f.state=Ba.RECEIVED_BY_REMOTE,f.emit("LocalInvitationReceivedByPeer"),f.localInvitationEnd$.pipe(hb(6e4),Ga(function(_){return Sa(_)&&f.warn("local invitation expired"),Z(_)})).subscribe({error:function(){f.state=Ba.FAILURE,f.emit("LocalInvitationFailure",bf.INVITATION_EXPIRE)}}))},error:function(_){f.isLocalInvitationEnd()?f.log("The invitation has ended, skipped emitting the %s event","LocalInvitationFailure"):(f.state=Ba.FAILURE,Sa(_)&&d?d.code==="PEER_NOT_ONLINE"?f.emit("LocalInvitationFailure",bf.PEER_OFFLINE):d.code==="RESENT_AND_OFFLINE"&&f.emit("LocalInvitationFailure",bf.PEER_NO_RESPONSE):Sa(_)?f.emit("LocalInvitationFailure",bf.PEER_NO_RESPONSE):_.name==="RtmInvalidStatusError"?f.emit("LocalInvitationFailure",bf.NOT_LOGGEDIN):f.emit("LocalInvitationFailure",bf.UNKNOWN))}})}},{key:"cancel",value:function(){if(this.isLocalInvitationEnd())throw new K("The local invitation cancel failure",Ih);if(this.state===Ba.IDLE)throw new K("The local invitation has not been sent",fA);if(8192<Ig(this._content))throw new I('The length of the "content" overflows. The number of bytes representing content must not exceed 8 Ã— 1024 if encoded in UTF-8.',xc);this.getSession().sendInvitationMessage({callId:this.callId,peerId:this.calleeId,type:"CallCancel",channelId:this._channelId,extra:this._content}),this.state=Ba.CANCELED,this.emit("LocalInvitationCanceled")}},{key:"onAcceptReceived",value:function(d){if(this.isLocalInvitationEnd()&&this.state!==Ba.ACCEPTED_BY_REMOTE)this.log("The invitation has ended, skipped emitting the %s event","LocalInvitationAccepted");else{if(this.state===Ba.IDLE)throw new K("the local have not sent the invitation, how can remote accept it?");this.getSession().sendInvitationMessage({callId:this.callId,isAcceptAck:!0,type:"CallAccept",peerId:this.calleeId,channelId:this.channelId}),this.state===Ba.ACCEPTED_BY_REMOTE?this.log("already in ACCEPTED_BY_REMOTE state, ignore emit ACCEPTED_BY_REMOTE"):(this.state===Ba.SENT_TO_REMOTE&&(this.log("receive LocalInvitationAccepted before remote response to the invitation"),this.state=Ba.RECEIVED_BY_REMOTE,this.emit("LocalInvitationReceivedByPeer")),this.state=Ba.ACCEPTED_BY_REMOTE,this._response=d,this.emit("LocalInvitationAccepted",d))}}},{key:"onRefuseReceived",value:function(d){if(this.isLocalInvitationEnd())this.log("The invitation has ended, skipped emitting the %s event","LocalInvitationRefused");else{if(this.state===Ba.IDLE)throw new K("the local have not sent the invitation, how can remote refuse it?");this.state===Ba.SENT_TO_REMOTE&&(this.log("receive LocalInvitationRefused before remote response to the invitation"),this.state=Ba.RECEIVED_BY_REMOTE,this.emit("LocalInvitationReceivedByPeer")),this._response=d,this.state=Ba.REFUSED_BY_REMOTE,this.emit("LocalInvitationRefused",d)}}},{key:"isLocalInvitationEnd",value:function(){return[Ba.CANCELED,Ba.FAILURE,Ba.ACCEPTED_BY_REMOTE,Ba.REFUSED_BY_REMOTE].includes(this.state)}}]),r}(tb()),fa(vd.prototype,"send",[Nb],Object.getOwnPropertyDescriptor(vd.prototype,"send"),vd.prototype),fa(vd.prototype,"cancel",[Nb],Object.getOwnPropertyDescriptor(vd.prototype,"cancel"),vd.prototype),vd),Rh=S.RemoteInvitationFailureReason,kb=S.RemoteInvitationState,mD=function(e){function r(d){var f=d.invitationChannel,_=d.extraContent,C=d.callId,P=d.callerId,x=d.logger;d=d.getSession,W(this,r);var B=s.call(this,x,"RtmRemoteInvitation",!0);return m(n(B),"state",kb.INVITATION_RECEIVED),m(n(B),"remoteInvitationEnd$",Ca(gb(n(B),"RemoteInvitationCanceled"),gb(n(B),"RemoteInvitationRefused"),gb(n(B),"RemoteInvitationAccepted"),gb(n(B),"RemoteInvitationFailure")).pipe(Ka(1))),m(n(B),"callerId",void 0),m(n(B),"callId",void 0),m(n(B),"_getSession",void 0),m(n(B),"logger",void 0),m(n(B),"_content",void 0),m(n(B),"_channelId",void 0),m(n(B),"_response",""),B._channelId=f,B._content=_,B.callId=C,B.callerId=P,B._getSession=d,B.logger=x,B.remoteInvitationEnd$.pipe(hb(6e4),Ga(function(_t){return Sa(_t)&&B.warn("Remote invitation expired"),Z(_t)})).subscribe({error:function(){B.state=kb.FAILURE,B.emit("RemoteInvitationFailure",Rh.INVITATION_EXPIRE)}}),B}la(r,e);var s=ma(r);return Ha(r,[{key:"channelId",get:function(){return this._channelId},set:function(d){throw new I('Cannot set the "response" of the RemoteInvitation instance.',xc)}},{key:"content",get:function(){return this._content},set:function(d){throw new I('Cannot set the "content" of the RemoteInvitation instance.',xc)}},{key:"response",get:function(){return this._response},set:function(d){this._response=d}},{key:"accept",value:function(){var d,f=this;if(this.isRemoteInvitationEnd())throw new K("The local invitation has ended. Cannot accept.",Ih);if(this.state===kb.ACCEPT_SENT_TO_LOCAL)throw new K("The remote invitation is accepting. Cannot do the operation.",Qq);if(8192<Ig(this._response))throw new I('The length of the "response" overflows. The number of bytes representing content must not exceed 8 Ã— 1024 if encoded in UTF-8.',xc);this.state=kb.ACCEPT_SENT_TO_LOCAL,Xb(mm(1e3).pipe(cb(function(){return ad(J(w.mark(function _(){return w.wrap(function(C){for(;;)switch(C.prev=C.next){case 0:return C.abrupt("return",f._getSession().sendInvitationMessage({peerId:f.callerId,callId:f.callId,extra:f.response,type:"CallAccept",isAcceptAck:!1,channelId:f.channelId}));case 1:case"end":return C.stop()}},_)})))}),wb(function(_){return d=_.hasPeerReceived}),Ka(1)),gb(this,"RemoteInvitationAccepted")).pipe(hb(5e3),ob(this.remoteInvitationEnd$)).subscribe({error:function(_){if(f.logError(_),f.state=kb.FAILURE,Sa(_))switch(d){case void 0:case!0:return void f.emit("RemoteInvitationFailure",Rh.ACCEPT_FAILURE);case!1:return void f.emit("RemoteInvitationFailure",Rh.PEER_OFFLINE)}f.emit("RemoteInvitationFailure",Rh.UNKNOWN)}})}},{key:"refuse",value:function(){if(this.state===kb.ACCEPT_SENT_TO_LOCAL)throw new K("The remote invitation is accepting. Cannot do the operation.",Qq);if(this.isRemoteInvitationEnd())throw new K("The invitation is end. Cannot refuse",Ih);if(8192<Ig(this._response))throw new I('The length of the "response" overflows. The number of bytes representing content must not exceed 8 Ã— 1024 if encoded in UTF-8.',xc);this._getSession().sendInvitationMessage({peerId:this.callerId,callId:this.callId,extra:this.response,type:"CallReject",channelId:this.channelId}),this.state=kb.REFUSED,this.emit("RemoteInvitationRefused")}},{key:"onCancelReceived",value:function(d){this.isRemoteInvitationEnd()?this.log("The invitation has ended, skipped emitting the %s event","RemoteInvitationCanceled"):(this.state===kb.ACCEPT_SENT_TO_LOCAL&&this.log("caller canceled before receive accept"),this._content=d,this.state=kb.CANCELED,this.emit("RemoteInvitationCanceled",d))}},{key:"onAcceptAckReceived",value:function(){this.state!==kb.ACCEPT_SENT_TO_LOCAL?this.log("The invitation has ended, skipped emitting the %s event","ori:".concat(this.state,", to: RemoteInvitationAccepted")):(this.state=kb.ACCEPTED,this.emit("RemoteInvitationAccepted"))}},{key:"isRemoteInvitationEnd",value:function(){return[kb.ACCEPTED,kb.REFUSED,kb.CANCELED,kb.FAILURE].includes(this.state)}}]),r}(tb()),nD=function(e){function r(d,f){W(this,r);var _=s.call(this,f,"InvitationManager");return m(n(_),"getSession",void 0),m(n(_),"invitationDispatcher",new ea.EventEmitter),m(n(_),"outgoingLocalInvitations",new Map),m(n(_),"receivedRemoteInvitations",new tc(void 0,{maxlen:1e4})),m(n(_),"logger",void 0),_.getSession=cn(d),_.logger=f,_.invitationDispatcher.on("remoteInvitationToManager",function(C){var P=C.callId,x=C.extra,B=C.callerId;C=C.channelId,_.receivedRemoteInvitations.has(P)||((x=new mD({callerId:B,callId:P,getSession:_.getSession,logger:f,extraContent:x,invitationChannel:C})).remoteInvitationEnd$.subscribe(function(){_.receivedRemoteInvitations.delete(P)}),_.receivedRemoteInvitations.set(P,x),_.emit("remoteInvitationInstance",x))}),_.invitationDispatcher.on("acceptAckToRemoteInvitation",function(C){(C=_.receivedRemoteInvitations.get(C.callId))&&C.onAcceptAckReceived()}),_.invitationDispatcher.on("cancelToRemoteInvitation",function(C){var P=C.extra;(C=_.receivedRemoteInvitations.get(C.callId))&&C.onCancelReceived(P)}),_.invitationDispatcher.on("acceptToLocalInvitation",function(C){var P=C.extra;(C=_.outgoingLocalInvitations.get(C.callId))&&C.onAcceptReceived(P)}),_.invitationDispatcher.on("refuseToLocalInvitation",function(C){var P=C.extra;(C=_.outgoingLocalInvitations.get(C.callId))&&C.onRefuseReceived(P)}),_}la(r,e);var s=ma(r);return Ha(r,[{key:"invitationMessageHandler",value:function(d){var f=d.body,_=f.callId,C=f.extra;C=C===void 0?"":C;var P=f.type,x=(f=f.channel)===void 0?"":f,B=d.type;switch(f=d.peerId,d=d.serverReceivedTs,B){case"CallAccept":P==="ack"?this.invitationDispatcher.emit("acceptAckToRemoteInvitation",{callId:_}):P==="request"&&this.invitationDispatcher.emit("acceptToLocalInvitation",{callId:_,extra:C});break;case"CallInvite":this.invitationDispatcher.emit("remoteInvitationToManager",{callId:_,callerId:f,extra:C,channelId:x});break;case"CallCancel":if(_==="0"){_="".concat("AgoraRTMLegacyEndcallCompatibleMessagePrefix","_").concat(x,"_").concat(C),this.getSession().emit("peerTextMessage",{peerId:f,properties:{serverReceivedTs:d,isOfflineMessage:!1},text:_});break}this.invitationDispatcher.emit("cancelToRemoteInvitation",{callId:_,extra:C});break;case"CallReject":this.invitationDispatcher.emit("refuseToLocalInvitation",{callId:_,extra:C});break;default:throw Im("invitationType",B)}}},{key:"genLocalInvitation",value:function(d){var f=this,_=new lD(d,this.getSession,this.logger);return _.localInvitationEnd$.subscribe(function(){f.outgoingLocalInvitations.delete(_.callId)}),this.outgoingLocalInvitations.set(_.callId,_),_}}]),r}(tb()),oD=function(e,r,s){var d=!0,f=!0;if(typeof e!="function")throw new TypeError("Expected a function");return lb(s)&&(d="leading"in s?!!s.leading:d,f="trailing"in s?!!s.trailing:f),qC(e,r,{leading:d,maxWait:r,trailing:f})},ub,cf;(function(e){e[e.JOINED=0]="JOINED",e[e.LEFT=1]="LEFT"})(cf||(cf={}));var ns=S.ConnectionState,pD=(ub=function(e){function r(d,f,_,C){W(this,r);var P=s.call(this,C,"RtmChannel",!0);return m(n(P),"onMemberCountUpdated",oD(function(x){x!==P.memberCount&&(P.memberCount=x,P.emit("MemberCountUpdated",x))},1e3)),m(n(P),"getSession",void 0),m(n(P),"memberCount",0),m(n(P),"memberJoinedLru",new tc(void 0,{maxlen:1e4})),m(n(P),"memberLeftLru",new tc(void 0,{maxlen:1e4})),m(n(P),"memberJoinStateLru",new tc(void 0,{maxlen:1e4})),m(n(P),"attributesSeqLru",new tc(void 0,{maxlen:1e4})),m(n(P),"channelId",void 0),m(n(P),"client",void 0),m(n(P),"onAttributesUpdated",function(x){var B=x.channelId,_t=x.attributeMaps,ue=x.seq;x=x.instance.toString();var Wt=P.attributesSeqLru.get(x);if((!Wt||ue.greaterThan(Wt))&&(P.attributesSeqLru.set(x,ue),B===P.channelId)){for(B={},ue=0;ue<_t.length;ue++){var _n=_t[ue];x=_n.key,Wt=_n.ms;var _i=_n.value;if(_n=_n.origin,typeof x!="string"||!U.isLong(Wt)||typeof _i!="string"||!za(_n))break;B[x]={value:_i,lastUpdateUserId:_n,lastUpdateTs:Wt.toNumber()}}P.emit("AttributesUpdated",B)}}),m(n(P),"onChannelTextMessage",function(x){var B=x.memberId,_t=x.text,ue=x.properties;x.channelId===P.channelId&&P.emit("ChannelMessage",{text:_t,messageType:S.MessageType.TEXT},B,ue)}),m(n(P),"onChannelMediaMessage",function(x){var B=x.memberId,_t=x.properties,ue=x.details,Wt=x.messageType;x.channelId===P.channelId&&(Wt==="FILE"?P.emit("ChannelMessage",{messageType:S.MessageType.FILE,size:parseInt(pa(ue.media_size),10),description:pa(ue.media_description),fileName:pa(ue.media_filename),mediaId:pa(ue.media_id),thumbnail:new Blob([ue.media_thumbnail])},B,_t):Wt==="IMAGE"&&P.emit("ChannelMessage",{messageType:S.MessageType.IMAGE,size:parseInt(pa(ue.media_size),10),description:pa(ue.media_description),fileName:pa(ue.media_filename),mediaId:pa(ue.media_id),thumbnail:new Blob([ue.media_thumbnail]),height:parseInt(pa(ue.media_height),10),width:parseInt(pa(ue.media_width),10),thumbnailHeight:parseInt(pa(ue.media_thumbnailheight),10),thumbnailWidth:parseInt(pa(ue.media_thumbnailwidth),10)},B,_t))}),m(n(P),"onChannelRawMessage",function(x){var B=x.desc,_t=x.raw,ue=x.memberId,Wt=x.properties;x.channelId===P.channelId&&P.emit("ChannelMessage",{messageType:S.MessageType.RAW,rawMessage:_t,description:B},ue,Wt)}),m(n(P),"onMemberNotice",function(x){var B=x.memberId,_t=x.type,ue=x.size;if(x.channelId===P.channelId){var Wt=x.instance.toString();x=x.seq.toString();var _n={MemberLeft:P.memberLeftLru,MemberJoined:P.memberJoinedLru,MemberCountUpdated:void 0}[_t];if(_n){if(_n.has(Wt+x))return void P.log("received duplicated %s notice (seq: %s), channel '%s', member '%s'",_t,x,oa(P.channelId),oa(B||""));if(_n.set(Wt+x,void 0),typeof B!="string")return;if(B!==P.getSession().context.uid&&((Wt=P.memberJoinStateLru.get(B))===cf.JOINED&&_t==="MemberJoined"||Wt===cf.LEFT&&_t==="MemberLeft"))return void P.log("received duplicated %s state (seq: %s), channel '%s', member '%s'",_t,x,oa(P.channelId),oa(B||""));P.memberJoinStateLru.set(B,_t==="MemberJoined"?cf.JOINED:cf.LEFT)}P.info("Channel %s - %s, memberId: %s",_t,oa(P.channelId),_t==="MemberCountUpdated"?"[unknown]":oa(B||"")),Wt=B===P.getSession().context.uid,_t==="MemberLeft"&&za(B)||_t==="MemberJoined"&&za(B)?(Wt||P.emit(_t,B),P.onMemberCountUpdated(ue)):_t==="MemberCountUpdated"&&typeof ue=="number"&&P.onMemberCountUpdated(ue)}}),P.getSession=cn(f),P.channelId=d,P.client=_,P.info("A channel created, id %s",oa(d)),P}la(r,e);var s=ma(r);return Ha(r,[{key:"join",value:function(){var d=J(w.mark(function f(){var _,C,P,x,B,_t,ue;return w.wrap(function(Wt){for(;;)switch(Wt.prev=Wt.next){case 0:if(za(this.channelId)){Wt.next=2;break}throw new I(["The %s in the arguments is invalid","channelId"],hA);case 2:Wt.prev=2,_=this.getSession(),Wt.next=9;break;case 6:throw Wt.prev=6,Wt.t0=Wt.catch(2),new K("The client is not logged in. Cannot do the operation",Vq);case 9:if(!_.joinedChannels.has(this)){Wt.next=12;break}throw eb("ChnJoin",{cname:this.channelId,lts:U.fromNumber(Date.now()),userId:_.context.uid,elapse:fb(_.startTime),errCode:Uq,sid:Xa(_.instanceId)},(C=this.client.context.config.enableCloudProxy)!==null&&C!==void 0&&C),new K("The channel has joined. Cannot rejoin",Uq);case 12:if(Wt.prev=12,this.log("Joining the channel %s",oa(this.channelId)),!this.hasOtherChannelJoined()){Wt.next=17;break}throw eb("ChnJoin",{cname:this.channelId,lts:U.fromNumber(Date.now()),userId:_.context.uid,elapse:fb(_.startTime),errCode:Wq,sid:Xa(_.instanceId)},(B=this.client.context.config.enableCloudProxy)!==null&&B!==void 0&&B),new K("A channel of the same channel ID has already joined. Cannot rejoin",Wq);case 17:if(_.joinedChannels.size!==20){Wt.next=20;break}throw eb("ChnJoin",{cname:this.channelId,lts:U.fromNumber(Date.now()),userId:_.context.uid,elapse:fb(_.startTime),errCode:Tq,sid:Xa(_.instanceId)},(_t=this.client.context.config.enableCloudProxy)!==null&&_t!==void 0&&_t),new ib("The joined channels has exceeded the limit of 20",Tq);case 20:return eb("ChnJoin",{cname:this.channelId,lts:U.fromNumber(Date.now()),userId:_.context.uid,elapse:fb(_.startTime),errCode:0,sid:Xa(_.instanceId)},(P=this.client.context.config.enableCloudProxy)!==null&&P!==void 0&&P),Wt.next=23,_.requestChannelJoin(this,this.channelId);case 23:eb("ChnJoinRes",{cname:this.channelId,lts:U.fromNumber(Date.now()),elapse:fb(_.startTime),errCode:0,sid:Xa(_.instanceId),serverErrCode:0,userId:_.context.uid},(x=this.client.context.config.enableCloudProxy)!==null&&x!==void 0&&x),this.info("The channel %s joined successfully",oa(this.channelId)),_.on("channelTextMessage",this.onChannelTextMessage),_.on("channelRawMessage",this.onChannelRawMessage),_.on("channelMediaMessage",this.onChannelMediaMessage),_.on("memberNotice",this.onMemberNotice),_.on("channelAttributesUpdated",this.onAttributesUpdated),Wt.next=41;break;case 32:if(Wt.prev=32,Wt.t1=Wt.catch(12),this.logError(Wt.t1),!sa(Wt.t1)){Wt.next=37;break}throw Wt.t1;case 37:if(!Sa(Wt.t1)){Wt.next=40;break}throw eb("ChnJoinRes",{cname:this.channelId,lts:U.fromNumber(Date.now()),elapse:fb(_.startTime),errCode:Sq,sid:Xa(_.instanceId),serverErrCode:0,userId:_.context.uid},(ue=this.client.context.config.enableCloudProxy)!==null&&ue!==void 0&&ue),new db(["Join channel %s timed out",oa(this.channelId)],Sq);case 40:throw new Wc(["The channel %s join failure",oa(this.channelId)],{code:Rq,originalError:Wt.t1});case 41:case"end":return Wt.stop()}},f,this,[[2,6],[12,32]])}));return function(){return d.apply(this,arguments)}}()},{key:"leave",value:function(){var d=J(w.mark(function f(){var _,C,P,x;return w.wrap(function(B){for(;;)switch(B.prev=B.next){case 0:B.prev=0,C=this.getSession(),B.next=7;break;case 4:throw B.prev=4,B.t0=B.catch(0),new K("The client is not logged in. Cannot do the operation",jA);case 7:if(C.joinedChannels.has(this)){B.next=9;break}throw new K("The channel does not join. Cannot do the operation",iA);case 9:B.prev=9,C.requestChannelLeave(this,this.channelId),this.memberLeftLru.empty(),this.memberJoinedLru.empty(),this.attributesSeqLru.empty(),this.memberJoinStateLru.empty(),this.memberCount=0,C.removeListener("channelTextMessage",this.onChannelTextMessage),C.removeListener("channelRawMessage",this.onChannelRawMessage),C.removeListener("channelMediaMessage",this.onChannelMediaMessage),C.removeListener("memberNotice",this.onMemberNotice),C.removeListener("channelAttributesUpdated",this.onAttributesUpdated),B.next=32;break;case 23:if(B.prev=23,B.t1=B.catch(9),this.logError(B.t1),!sa(B.t1)){B.next=30;break}throw B.t1.code===void 0&&(B.t1.code=Yq),eb("ChnLeave",{cname:this.channelId,lts:U.fromNumber(Date.now()),elapse:fb(C.startTime),errCode:Yq,sid:Xa(C.instanceId),userId:C.context.uid},(x=this.client.context.config.enableCloudProxy)!==null&&x!==void 0&&x),B.t1;case 30:throw eb("ChnLeave",{cname:this.channelId,lts:U.fromNumber(Date.now()),elapse:fb(C.startTime),errCode:Xq,sid:Xa(C.instanceId),userId:C.context.uid},(P=this.client.context.config.enableCloudProxy)!==null&&P!==void 0&&P),new Wc("The channel leave failure",{code:Xq,originalError:B.t1});case 32:eb("ChnLeave",{cname:this.channelId,lts:U.fromNumber(Date.now()),elapse:fb(C.startTime),errCode:0,sid:Xa(C.instanceId),userId:C.context.uid},(_=this.client.context.config.enableCloudProxy)!==null&&_!==void 0&&_);case 33:case"end":return B.stop()}},f,this,[[0,4],[9,23]])}));return function(){return d.apply(this,arguments)}}()},{key:"sendMessage",value:function(){var d=J(w.mark(function f(_){var C,P,x,B,_t,ue=this,Wt=arguments;return w.wrap(function(_n){for(;;)switch(_n.prev=_n.next){case 0:C=1<Wt.length&&Wt[1]!==void 0?Wt[1]:{},P=C.enableHistoricalMessaging,x=P!==void 0&&P,Tm(_,Hh),_n.prev=2,B=this.getSession(),_n.next=9;break;case 6:throw _n.prev=6,_n.t0=_n.catch(2),new K("The client is not logged in. Cannot do the operation",ig);case 9:if(B.joinedChannels.has(this)){_n.next=11;break}throw new K("The channel does not join. Cannot do the operation",ig);case 11:if(this.client.connectionState!==ns.RECONNECTING){_n.next=16;break}return _t=Date.now(),_n.next=15,new Promise(function(_i,Ei){var _a=function(){var _o=J(w.mark(function _s(){var _c;return w.wrap(function(_m){for(;;)switch(_m.prev=_m.next){case 0:return _c=Date.now()-_t,_m.prev=1,_m.next=4,Gg({message:_,peerId:ue.channelId,toPeer:!1,session:ue.getSession(),errorCodes:{NOT_LOGGED_IN:ig,TOO_OFTEN:Mq},diff:_c,logger:ue.logger,options:{enableHistoricalMessaging:x,enableOfflineMessaging:!1}});case 4:_i(),_m.next=12;break;case 7:_m.prev=7,_m.t0=_m.catch(1),Sa(_m.t0)&&Ei(new db(Yd(ue.name,"sendMessageToPeer",1e4),Yk)),sa(_m.t0)&&Ei(_m.t0),Ei(new da("Channel message send failure",{code:hg,originalError:_m.t0}));case 12:return _m.prev=12,clearTimeout(Di),_m.finish(12);case 15:case"end":return _m.stop()}},_s,null,[[1,7,12,15]])}));return function(){return _o.apply(this,arguments)}}();ue.client.internalEmitter.once("RECONNECTED",_a);var Di=setTimeout(function(){ue.client.internalEmitter.off("RECONNECTED",_a),Ei(new db(Yd(ue.name,"sendMessageToPeer",1e4),Yk))},9e3)});case 15:return _n.abrupt("return");case 16:if(this.client.connectionState===ns.CONNECTED){_n.next=18;break}throw new K("The client is not logged in. Cannot do the operation",ig);case 18:return _n.prev=18,_n.next=21,Gg({message:_,peerId:this.channelId,toPeer:!1,session:this.getSession(),errorCodes:{NOT_LOGGED_IN:ig,TOO_OFTEN:Mq},diff:0,logger:this.logger,options:{enableHistoricalMessaging:x,enableOfflineMessaging:!1}});case 21:_n.next=31;break;case 23:if(_n.prev=23,_n.t1=_n.catch(18),!Sa(_n.t1)){_n.next=27;break}throw new db(Yd(this.name,"sendMessage",1e4),Yk);case 27:if(!sa(_n.t1)){_n.next=30;break}throw this.logError(_n.t1),_n.t1;case 30:throw new Wc("The channel message send failure",hg);case 31:case"end":return _n.stop()}},f,this,[[2,6],[18,23]])}));return function(f){return d.apply(this,arguments)}}()},{key:"getMembers",value:function(){var d=J(w.mark(function f(){var _,C,P;return w.wrap(function(x){for(;;)switch(x.prev=x.next){case 0:x.prev=0,x.prev=1,_=this.getSession(),x.next=8;break;case 5:throw x.prev=5,x.t0=x.catch(1),new K("The client is not logged in. Cannot do the operation",eA);case 8:if(_.joinedChannels.has(this)){x.next=10;break}throw new K("The channel does not join. Cannot do the operation",dA);case 10:return C=this.getSession().requestChannelMemberList(this.channelId),x.next=13,C.pipe(ba(function(B){return B.memberInfos.map(function(_t){return _t.account})})).toPromise();case 13:return P=x.sent,this.info("Channel %s - get members success, %o",oa(this.channelId),P.map(oa)),x.abrupt("return",P);case 18:if(x.prev=18,x.t1=x.catch(0),!sa(x.t1)){x.next=23;break}throw this.logError(x.t1),x.t1;case 23:throw new Wc("The channel members get failure",bA);case 24:case"end":return x.stop()}},f,this,[[0,18],[1,5]])}));return function(){return d.apply(this,arguments)}}()},{key:"hasOtherChannelJoined",value:function(){var d=this;return!this.getSession().joinedChannels.has(this)&&Array.from(this.getSession().joinedChannels).some(function(f){return f.channelId===d.channelId})}}]),r}(tb()),fa(ub.prototype,"join",[Nb],Object.getOwnPropertyDescriptor(ub.prototype,"join"),ub.prototype),fa(ub.prototype,"leave",[Nb],Object.getOwnPropertyDescriptor(ub.prototype,"leave"),ub.prototype),fa(ub.prototype,"sendMessage",[Nb],Object.getOwnPropertyDescriptor(ub.prototype,"sendMessage"),ub.prototype),fa(ub.prototype,"getMembers",[Ma],Object.getOwnPropertyDescriptor(ub.prototype,"getMembers"),ub.prototype),ub),E,Eb=S.ConnectionChangeReason,T=S.ConnectionState,os={DISCONNECTED:1,CONNECTING:2,CONNECTED:3,RECONNECTING:4,ABORTED:5},qD={LOGIN:1,LOGIN_SUCCESS:2,LOGIN_FAILURE:3,LOGIN_TIMEOUT:4,INTERRUPTED:5,LOGOUT:6,BANNED_BY_SERVER:7,REMOTE_LOGIN:8},rD=(E=function(e){function r(d,f,_,C){W(this,r);var P=s.call(this,f,"RtmClient",!0);return m(n(P),"connectionState",T.DISCONNECTED),m(n(P),"internalEmitter",new ea),m(n(P),"context",void 0),m(n(P),"attributes",{}),m(n(P),"loginPromise",void 0),m(n(P),"attributeDrafts",new Set),m(n(P),"session",void 0),m(n(P),"lastLoginTime",void 0),m(n(P),"reconnId",0),m(n(P),"channelAttributesCacheLru",new tc(void 0,{maxlen:1e4})),m(n(P),"invitationManager",void 0),m(n(P),"subscribedPeerStatusCache",{}),m(n(P),"peerStatusSeqLru",new tc(void 0,{maxlen:1e4})),m(n(P),"peerUnreachableTimers",{}),m(n(P),"mediaTaskManager",void 0),m(n(P),"setParameters",void 0),m(n(P),"updateConfig",void 0),m(n(P),"userDropHandler",function(x){if(P.connectionState!==T.ABORTED)switch(x){case 11:P.logError("Kicked off by remote session"),P.onConnectionStateChanged(T.ABORTED,Eb.REMOTE_LOGIN);break;case 14:case 15:case 16:P.logError("Server banned because of illegal ".concat({14:"User ID",15:"IP",16:"Channel Name"}[x])),P.onConnectionStateChanged(T.ABORTED,Eb.BANNED_BY_SERVER);break;default:P.logError("User kicked off for unknown code: ".concat(x)),P.onConnectionStateChanged(T.ABORTED,Eb.INTERRUPTED)}}),P.context=new ZC(d,_,f),P.mediaTaskManager=new fs(f),P.context.config=_,P.internalEmitter.setMaxListeners(512),P.setParameters=C.bind(n(P)),P.updateConfig=C.bind(n(P)),P.invitationManager=new nD(function(){return P.session},f),P.invitationManager.on("remoteInvitationInstance",function(x){P.emit("RemoteInvitationReceived",x)}),P}la(r,e);var s=ma(r);return Ha(r,[{key:"renewToken",value:function(){var d=J(w.mark(function f(_){var C,P,x,B=this;return w.wrap(function(_t){for(;;)switch(_t.prev=_t.next){case 0:if(typeof _=="string"&&_.length!==0){_t.next=2;break}throw new I("Invalid argument",rA);case 2:if(this.connectionState!==T.ABORTED){_t.next=5;break}return _t.next=5,new Promise(function(){});case 5:if(this.connectionState===T.CONNECTED||this.connectionState===T.RECONNECTING){_t.next=7;break}throw new K("The client is not logged in",uA);case 7:if(this.session!==void 0){_t.next=9;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 9:return _t.prev=9,C=this.context.token,this.context.token=_,_t.next=14,this.session.connection.apClient.getApEdgeInfo$(!1).pipe(Dd(function(){return Error("No available edge address to connect")}),oe(function(ue){return ue.pipe(ca(function(Wt){if(sa(Wt))throw Wt}),cd(2500),Ka(4))}),Ka(1),hb(2e4),Ga(function(ue){return Sa(ue)&&B.warn("renewToken timed out"),Z(ue)})).toPromise();case 14:P=_t.sent,x=P.ticket,_t.next=27;break;case 18:if(_t.prev=18,_t.t0=_t.catch(9),this.context.token=C,_t.t0.code!==$q&&_t.t0.code!==ar){_t.next=23;break}throw new Ye("Invalid token",tA);case 23:if(_t.t0.code!==Kh){_t.next=25;break}throw new Ye("The token expired",sA);case 25:if(!Sa(_t.t0)){_t.next=27;break}throw new db("Renew token timed out",qA);case 27:this.session.curLoginSockets.filter(function(ue){return ue!==void 0}).forEach(function(ue){return ue.ticket=x});case 28:case"end":return _t.stop()}},f,this,[[9,18]])}));return function(f){return d.apply(this,arguments)}}()},{key:"queryPeersOnlineStatus",value:function(){var d=J(w.mark(function f(_){var C,P,x=this;return w.wrap(function(B){for(;;)switch(B.prev=B.next){case 0:if(this.connectionState===T.CONNECTED){B.next=2;break}throw new K("The client is not logged in",pA);case 2:if(this.session!==void 0){B.next=4;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:if(!(!Array.isArray(_)||_.length===0||_.some(function(_t){return!za(_t)})||256<_.length)){B.next=6;break}throw new I("invalid arguments",er);case 6:return B.next=8,this.session.requestPeersOnlineStatus(_).toPromise();case 8:return C=B.sent,P=uc(Jk(C.userInfos,"account"),function(_t){return!!_t.ts}),Object.keys(P).forEach(function(_t){if(_t in x.subscribedPeerStatusCache&&x.subscribedPeerStatusCache[_t]!==S.PeerOnlineState.UNREACHABLE){var ue=P[_t]?S.PeerOnlineState.ONLINE:S.PeerOnlineState.OFFLINE;x.emit("PeersOnlineStatusChanged",m({},_t,ue)),x.subscribedPeerStatusCache[_t]=ue}}),B.abrupt("return",P);case 12:case"end":return B.stop()}},f,this)}));return function(f){return d.apply(this,arguments)}}()},{key:"getChannelMemberCount",value:function(){var d=J(w.mark(function f(_){var C,P,x,B,_t,ue,Wt,_n=this;return w.wrap(function(_i){for(;;)switch(_i.prev=_i.next){case 0:if(this.connectionState===T.CONNECTED){_i.next=2;break}throw new K("The client is not logged in",aA);case 2:if(this.session!==void 0){_i.next=4;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:if(Array.isArray(_)&&_.every(function(Ei){return typeof Ei=="string"})&&_.length!==0){_i.next=6;break}throw new I("Invalid arguments: channelIds",Oq);case 6:if(!(32<_.length)){_i.next=8;break}throw new I("getChannelMemberCount exceed limit of 32 channelIds",$z);case 8:C=0;case 9:if(!(C<_.length)){_i.next=16;break}if(za(P=_[C])){_i.next=13;break}throw new I(["getChannelMemberCount channel id %s is invalid",P],Oq);case 13:C++,_i.next=9;break;case 16:return _i.next=18,this.session.requestGetChannelMemberCount(_).toPromise();case 18:for(x=_i.sent,B=x.groupInfos,_t={},ue=function(Ei){var _a=(Ei=B[Ei]).group,Di=Ei.memberCount;za(_a)&&typeof Di=="number"&&(_n.session.joinedChannels.forEach(function(_o){_o.channelId===_a&&_o.onMemberCountUpdated(Di)}),_t[_a]=Di)},Wt=0;Wt<B.length;Wt++)ue(Wt);return _i.abrupt("return",_t);case 24:case"end":return _i.stop()}},f,this)}));return function(f){return d.apply(this,arguments)}}()},{key:"setLocalUserAttributes",value:function(){var d=J(w.mark(function f(_){var C,P;return w.wrap(function(x){for(;;)switch(x.prev=x.next){case 0:if(uf({attributes:_,maxAttrValueSize:8192,maxAttrsCount:32,maxTotalSize:16384}),this.connectionState===T.CONNECTED){x.next=3;break}throw new K("The client is not logged in",Ub);case 3:if(this.session!==void 0){x.next=5;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 5:return C=this.session.requestSetLocalUserAttributes(_).toPromise(),P={attribute:_,promise:C},this.attributeDrafts.add(P),x.prev=8,x.next=11,C;case 11:this.attributes=_,x.next=19;break;case 14:if(x.prev=14,x.t0=x.catch(8),!sa(x.t0)){x.next=18;break}throw x.t0;case 18:throw new I("arguments is not valid",Ja);case 19:return x.prev=19,this.attributeDrafts.delete(P),x.finish(19);case 22:case"end":return x.stop()}},f,this,[[8,14,19,22]])}));return function(f){return d.apply(this,arguments)}}()},{key:"setChannelAttributes",value:function(){var d=J(w.mark(function f(_,C){var P,x,B,_t,ue,Wt=arguments;return w.wrap(function(_n){for(;;)switch(_n.prev=_n.next){case 0:if(P=2<Wt.length&&Wt[2]!==void 0?Wt[2]:{},x=P.enableNotificationToChannelMembers,B=x!==void 0&&x,uf({attributes:C,maxAttrValueSize:8192,maxAttrsCount:32,maxTotalSize:32768}),this.connectionState===T.CONNECTED){_n.next=4;break}throw new K("The client is not logged in",Ub);case 4:if(this.session!==void 0){_n.next=6;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 6:return _t=this.session.requestSetChannelAttributes(_,C,B).toPromise(),_n.prev=7,_n.next=10,_t;case 10:ue=uc(C,function(_i){return new Blob([_i]).size}),this.channelAttributesCacheLru.set(_,ue),_n.next=19;break;case 14:if(_n.prev=14,_n.t0=_n.catch(7),!sa(_n.t0)){_n.next=18;break}throw _n.t0;case 18:throw new I("arguments is not valid",Ja);case 19:case"end":return _n.stop()}},f,this,[[7,14]])}));return function(f,_){return d.apply(this,arguments)}}()},{key:"addOrUpdateLocalUserAttributes",value:function(){var d=J(w.mark(function f(_){var C,P,x;return w.wrap(function(B){for(;;)switch(B.prev=B.next){case 0:if(C=ua(ua({},this.attributes),_),uf({attributes:_,maxAttrValueSize:8192,maxAttrsCount:32,maxTotalSize:16384}),uf({attributes:C,maxAttrValueSize:8192,maxAttrsCount:32,maxTotalSize:16384}),this.connectionState===T.CONNECTED){B.next=5;break}throw new K("The client is not logged in",Ub);case 5:if(this.session!==void 0){B.next=7;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 7:return P=this.session.requestAddOrUpdateLocalUserAttributes(_).toPromise(),x={attribute:C,promise:P},this.attributeDrafts.add(x),B.prev=10,B.next=13,P;case 13:this.attributes=C,B.next=21;break;case 16:if(B.prev=16,B.t0=B.catch(10),!sa(B.t0)){B.next=20;break}throw B.t0;case 20:throw new I("arguments is not valid",er);case 21:return B.prev=21,this.attributeDrafts.delete(x),B.finish(21);case 24:case"end":return B.stop()}},f,this,[[10,16,21,24]])}));return function(f){return d.apply(this,arguments)}}()},{key:"addOrUpdateChannelAttributes",value:function(){var d=J(w.mark(function f(_,C){var P,x,B,_t,ue,Wt,_n,_i=arguments;return w.wrap(function(Ei){for(;;)switch(Ei.prev=Ei.next){case 0:if(P=2<_i.length&&_i[2]!==void 0?_i[2]:{},x=P.enableNotificationToChannelMembers,B=x!==void 0&&x,_t=this.channelAttributesCacheLru.get(_,{}),ue=uc(C,function(_a){return new Blob([_a]).size}),Wt=ua(ua({},_t),ue),uf({attributes:C,attrSizeMap:Wt,maxAttrValueSize:8192,maxAttrsCount:32,maxTotalSize:32768}),this.connectionState===T.CONNECTED){Ei.next=7;break}throw new K("The client is not logged in",Ub);case 7:if(this.session!==void 0){Ei.next=9;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 9:return _n=this.session.requestAddOrUpdateChannelAttributes(_,C,B).toPromise(),Ei.prev=10,Ei.next=13,_n;case 13:this.channelAttributesCacheLru.set(_,Wt),Ei.next=21;break;case 16:if(Ei.prev=16,Ei.t0=Ei.catch(10),!sa(Ei.t0)){Ei.next=20;break}throw Ei.t0;case 20:throw new I("arguments is not valid",Ja);case 21:case"end":return Ei.stop()}},f,this,[[10,16]])}));return function(f,_){return d.apply(this,arguments)}}()},{key:"deleteLocalUserAttributesByKeys",value:function(){var d=J(w.mark(function f(_){var C,P,x,B;return w.wrap(function(_t){for(;;)switch(_t.prev=_t.next){case 0:if(Array.isArray(_)&&_.length!==0&&!_.some(function(ue){return ue.length===0})){_t.next=2;break}throw new K("arguments is not valid",Ja);case 2:if(this.connectionState===T.CONNECTED){_t.next=4;break}throw new K("The client is not logged in",Ub);case 4:if(this.session!==void 0){_t.next=6;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 6:return C=this.session.requestDeleteLocalUserAttributesByKeys(_).toPromise(),P={attribute:Gk(this.attributes,_),promise:C},this.attributeDrafts.add(P),_t.prev=9,_t.next=12,C;case 12:for(x=0;x<_.length;x++)B=_[x],delete this.attributes[B];_t.next=20;break;case 15:if(_t.prev=15,_t.t0=_t.catch(9),!sa(_t.t0)){_t.next=19;break}throw _t.t0;case 19:throw new I("arguments is not valid",Ja);case 20:return _t.prev=20,this.attributeDrafts.delete(P),_t.finish(20);case 23:case"end":return _t.stop()}},f,this,[[9,15,20,23]])}));return function(f){return d.apply(this,arguments)}}()},{key:"deleteChannelAttributesByKeys",value:function(){var d=J(w.mark(function f(_,C){var P,x,B,_t,ue,Wt,_n,_i=arguments;return w.wrap(function(Ei){for(;;)switch(Ei.prev=Ei.next){case 0:if(P=2<_i.length&&_i[2]!==void 0?_i[2]:{},x=P.enableNotificationToChannelMembers,B=x!==void 0&&x,Array.isArray(C)&&C.length!==0&&za(_)&&!C.some(function(_a){return _a.length===0||512<_a.length})){Ei.next=3;break}throw new K("arguments is not valid",Ja);case 3:if(this.connectionState===T.CONNECTED){Ei.next=5;break}throw new K("The client is not logged in",Ub);case 5:if(this.session!==void 0){Ei.next=7;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 7:return _t=this.session.requestDeleteChannelAttributesByKeys(_,C,B).toPromise(),Ei.prev=8,Ei.next=11,_t;case 11:if(ue=this.channelAttributesCacheLru.get(_))for(Wt=0;Wt<C.length;Wt++)_n=C[Wt],delete ue[_n];Ei.next=20;break;case 15:if(Ei.prev=15,Ei.t0=Ei.catch(8),!sa(Ei.t0)){Ei.next=19;break}throw Ei.t0;case 19:throw new I("arguments is not valid",Ja);case 20:case"end":return Ei.stop()}},f,this,[[8,15]])}));return function(f,_){return d.apply(this,arguments)}}()},{key:"clearLocalUserAttributes",value:function(){var d=J(w.mark(function f(){var _,C;return w.wrap(function(P){for(;;)switch(P.prev=P.next){case 0:if(this.connectionState===T.CONNECTED){P.next=2;break}throw new K("The client is not logged in",Ub);case 2:if(this.session!==void 0){P.next=4;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:return _=this.session.requestClearLocalUserAttributes().toPromise(),C={attribute:{},promise:_},this.attributeDrafts.add(C),P.prev=7,P.next=10,_;case 10:this.attributes={},P.next=18;break;case 13:if(P.prev=13,P.t0=P.catch(7),!sa(P.t0)){P.next=17;break}throw P.t0;case 17:throw new I("arguments is not valid",Ja);case 18:return P.prev=18,this.attributeDrafts.delete(C),P.finish(18);case 21:case"end":return P.stop()}},f,this,[[7,13,18,21]])}));return function(){return d.apply(this,arguments)}}()},{key:"clearChannelAttributes",value:function(){var d=J(w.mark(function f(_){var C,P,x,B,_t=arguments;return w.wrap(function(ue){for(;;)switch(ue.prev=ue.next){case 0:if(C=1<_t.length&&_t[1]!==void 0?_t[1]:{},P=C.enableNotificationToChannelMembers,x=P!==void 0&&P,this.connectionState===T.CONNECTED){ue.next=3;break}throw new K("The client is not logged in",Ub);case 3:if(this.session!==void 0){ue.next=5;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 5:return B=this.session.requestClearChannelAttributes(_,x).toPromise(),ue.prev=6,ue.next=9,B;case 9:this.channelAttributesCacheLru.delete(_),ue.next=17;break;case 12:if(ue.prev=12,ue.t0=ue.catch(6),!sa(ue.t0)){ue.next=16;break}throw ue.t0;case 16:throw new I("arguments is not valid",Ja);case 17:case"end":return ue.stop()}},f,this,[[6,12]])}));return function(f){return d.apply(this,arguments)}}()},{key:"getUserAttributes",value:function(){var d=J(w.mark(function f(_){var C,P,x;return w.wrap(function(B){for(;;)switch(B.prev=B.next){case 0:if(za(_)){B.next=2;break}throw new I("Not a valid user ID",Ja);case 2:if(this.connectionState===T.CONNECTED){B.next=4;break}throw new K("The client is not logged in",Ub);case 4:if(this.session!==void 0){B.next=6;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 6:return B.prev=6,B.next=9,this.session.requestGetUserAttributeKeys(_).toPromise();case 9:return C=B.sent,P=C.keys,B.next=13,this.session.requestGetUserAttributesByKeys(_,P.slice(0,512)).toPromise();case 13:x=B.sent,B.next=21;break;case 16:if(B.prev=16,B.t0=B.catch(6),!sa(B.t0)){B.next=20;break}throw B.t0;case 20:throw new I("arguments is not valid",Ja);case 21:return B.abrupt("return",Yp(x.attributeInfos.map(function(_t){return[_t.key,_t.value]})));case 22:case"end":return B.stop()}},f,this,[[6,16]])}));return function(f){return d.apply(this,arguments)}}()},{key:"getChannelAttributes",value:function(){var d=J(w.mark(function f(_){var C,P,x,B,_t,ue,Wt,_n,_i,Ei,_a;return w.wrap(function(Di){for(;;)switch(Di.prev=Di.next){case 0:if(za(_)){Di.next=2;break}throw new I("Not a valid channel ID",Ja);case 2:if(this.connectionState===T.CONNECTED){Di.next=4;break}throw new K("The client is not logged in",Ub);case 4:if(this.session!==void 0){Di.next=6;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 6:return Di.prev=6,Di.next=9,this.session.requestGetChannelAttributesKeys(_).toPromise();case 9:return C=Di.sent,P=C.keys,Di.next=13,this.session.requestGetChannelAttributesByKeys(_,P).toPromise();case 13:x=Di.sent,B=x.attributeMaps,Di.next=22;break;case 17:if(Di.prev=17,Di.t0=Di.catch(6),!sa(Di.t0)){Di.next=21;break}throw Di.t0;case 21:throw new I("arguments is not valid",Ja);case 22:_t={},ue=0;case 24:if(!(ue<B.length)){Di.next=32;break}if(Wt=B[ue],_n=Wt.key,_i=Wt.ms,Ei=Wt.value,_a=Wt.origin,typeof _n=="string"&&U.isLong(_i)&&typeof Ei=="string"&&za(_a)){Di.next=28;break}return Di.abrupt("break",32);case 28:_t[_n]={value:Ei,lastUpdateUserId:_a,lastUpdateTs:_i.toNumber()};case 29:ue++,Di.next=24;break;case 32:return this.channelAttributesCacheLru.set(_,uc(_t,function(_o){return new Blob([_o.value]).size})),Di.abrupt("return",_t);case 34:case"end":return Di.stop()}},f,this,[[6,17]])}));return function(f){return d.apply(this,arguments)}}()},{key:"getChannelAttributesByKeys",value:function(){var d=J(w.mark(function f(_,C){var P,x,B,_t,ue,Wt,_n,_i,Ei,_a;return w.wrap(function(Di){for(;;)switch(Di.prev=Di.next){case 0:if(this.connectionState===T.CONNECTED){Di.next=2;break}throw new K("The client is not logged in",Ub);case 2:if(this.session!==void 0){Di.next=4;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:return Hm(_,C),Di.prev=5,Di.next=8,this.session.requestGetChannelAttributesByKeys(_,C).toPromise();case 8:P=Di.sent,x=P.attributeMaps,Di.next=17;break;case 12:if(Di.prev=12,Di.t0=Di.catch(5),!sa(Di.t0)){Di.next=16;break}throw Di.t0;case 16:throw new I("arguments is not valid",Ja);case 17:B={},_t=this.channelAttributesCacheLru.get(_,{}),ue=0;case 20:if(!(ue<x.length)){Di.next=29;break}if(Wt=x[ue],_n=Wt.key,_i=Wt.ms,Ei=Wt.value,_a=Wt.origin,typeof _n=="string"&&U.isLong(_i)&&typeof Ei=="string"&&za(_a)){Di.next=24;break}return Di.abrupt("break",29);case 24:_t[_n]=new Blob([Ei]).size,B[_n]={value:Ei,lastUpdateUserId:_a,lastUpdateTs:_i.toNumber()};case 26:ue++,Di.next=20;break;case 29:return this.channelAttributesCacheLru.set(_,_t),Di.abrupt("return",B);case 31:case"end":return Di.stop()}},f,this,[[5,12]])}));return function(f,_){return d.apply(this,arguments)}}()},{key:"getUserAttributesByKeys",value:function(){var d=J(w.mark(function f(_,C){var P;return w.wrap(function(x){for(;;)switch(x.prev=x.next){case 0:if(this.connectionState===T.CONNECTED){x.next=2;break}throw new K("The client is not logged in",Ub);case 2:if(this.session!==void 0){x.next=4;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:return Hm(_,C),x.prev=5,x.next=8,this.session.requestGetUserAttributesByKeys(_,C).toPromise();case 8:P=x.sent,x.next=16;break;case 11:if(x.prev=11,x.t0=x.catch(5),!sa(x.t0)){x.next=15;break}throw x.t0;case 15:throw new I("arguments is not valid",Ja);case 16:return x.abrupt("return",Yp(P.attributeInfos.map(function(B){return[B.key,B.value]})));case 17:case"end":return x.stop()}},f,this,[[5,11]])}));return function(f,_){return d.apply(this,arguments)}}()},{key:"login",value:function(){var d=J(w.mark(function f(_){var C,P,x,B,_t=this;return w.wrap(function(ue){for(;;)switch(ue.prev=ue.next){case 0:if(Uk=!0,C=Bg(),P=_.token,_.token===this.context.appId&&(P=void 0),setTimeout(function(){var Wt;eb("Session",{appId:_t.context.appId,did:navigator.userAgent,elapse:fb(_t.session&&_t.session.startTime),index:{index1:_.uid,index2:_t.context.appId,index3:"enableLogUpload=".concat(_t.context.config.enableLogUpload)},installId:gg,lts:U.fromNumber(Date.now()),os:7,sid:Xa(C),token:P||"",userId:_.uid,ver:"1.4.3-203",buildno:603,subVersion:203,version:4},(Wt=_t.context.config.enableCloudProxy)!==null&&Wt!==void 0&&Wt)},1e4),yd(_)&&za(_.uid)){ue.next=7;break}throw new I("not a valid user id",Jh);case 7:if(typeof P!="string"||!P){ue.next=11;break}this.context.token=P,ue.next=13;break;case 11:if(typeof P=="string"||P==null){ue.next=13;break}throw new I('The "token" is not a valid string.',Jh);case 13:return x=Date.now(),this.context.sid=Xa(C),this.loginPromise=this.loginImpl({uid:_.uid,instanceId:C}),this.info("RTM Client logging in as ".concat(oa(_.uid))),ue.prev=17,ue.next=20,this.loginPromise;case 20:ue.next=27;break;case 22:throw ue.prev=22,ue.t0=ue.catch(17),sa(ue.t0)&&eb("Link",{ackedServerIp:"",destServerIp:"",ec:ue.t0.code||1,sc:ue.t0.serverCode,elapse:fb(this.session&&this.session.startTime),lts:U.fromNumber(Date.now()),responseTime:Date.now()-x,sid:Xa(C),userId:_.uid},(B=this.context.config.enableCloudProxy)!==null&&B!==void 0&&B),this.context.token=void 0,ue.t0;case 27:return ue.prev=27,this.loginPromise=void 0,ue.finish(27);case 30:Uk=!1;case 31:case"end":return ue.stop()}},f,this,[[17,22,27,30]])}));return function(f){return d.apply(this,arguments)}}()},{key:"logout",value:function(){var d=J(w.mark(function f(){var _;return w.wrap(function(C){for(;;)switch(C.prev=C.next){case 0:if(!this.loginPromise){C.next=3;break}return C.next=3,this.loginPromise;case 3:if(this.connectionState!==T.DISCONNECTED){C.next=6;break}throw this.logError("Already in logout state"),new K("Logout failure. The client has already been logged out",br);case 6:if(this.connectionState!==T.ABORTED){C.next=10;break}return this.info('Reset connection state from "ABORTED" to "DISCONNECTED"'),this.onConnectionStateChanged(T.DISCONNECTED,Eb.LOGOUT),C.abrupt("return");case 10:if(this.session!==void 0){C.next=13;break}return this.onConnectionStateChanged(T.DISCONNECTED,Eb.LOGOUT),C.abrupt("return");case 13:return eb("Logout",{elapse:fb(this.session.startTime),lts:U.fromNumber(Date.now()),sid:Xa(this.session.instanceId),userId:this.context.uid},(_=this.context.config.enableCloudProxy)!==null&&_!==void 0&&_),C.next=16,this.session.logoutHandler();case 16:this.onConnectionStateChanged(T.DISCONNECTED,Eb.LOGOUT),this.log("Log out success");case 18:case"end":return C.stop()}},f,this)}));return function(){return d.apply(this,arguments)}}()},{key:"logoutSync",value:function(){var d,f=this;if(this.connectionState===T.DISCONNECTED)throw this.logError("Already in logout state"),new K("Logout failure. The client has already been logged out",br);this.connectionState===T.ABORTED?this.info('Reset connection state from "ABORTED" to "DISCONNECTED"'):this.session!==void 0&&(eb("Logout",{elapse:fb(this.session.startTime),lts:U.fromNumber(Date.now()),sid:Xa(this.session.instanceId),userId:this.context.uid},(d=this.context.config.enableCloudProxy)!==null&&d!==void 0&&d),this.session.logoutHandler().then(function(){f.log("Log out success")})),this.onConnectionStateChanged(T.DISCONNECTED,Eb.LOGOUT)}},{key:"sendMessageToPeer",value:function(){var d=J(w.mark(function f(_,C){var P,x,B,_t,ue,Wt,_n=this,_i=arguments;return w.wrap(function(Ei){for(;;)switch(Ei.prev=Ei.next){case 0:if(P=2<_i.length&&_i[2]!==void 0?_i[2]:{},x=P.enableOfflineMessaging,B=x!==void 0&&x,_t=P.enableHistoricalMessaging,ue=_t!==void 0&&_t,Tm(_,ve),this.connectionState!==T.RECONNECTING){Ei.next=5;break}return Wt=Date.now(),Ei.abrupt("return",new Promise(function(_a,Di){var _o=function(){var _c=J(w.mark(function _m(){var Qm;return w.wrap(function(tE){for(;;)switch(tE.prev=tE.next){case 0:if(_n.session!==void 0){tE.next=2;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 2:return Qm=Date.now()-Wt,tE.prev=3,tE.t0=_a,tE.next=7,Gg({message:_,peerId:C,toPeer:!0,session:_n.session,errorCodes:{NOT_LOGGED_IN:al,TOO_OFTEN:dr},diff:Qm,logger:_n.logger,options:{enableHistoricalMessaging:ue,enableOfflineMessaging:B}});case 7:tE.t1=tE.sent,(0,tE.t0)(tE.t1),tE.next=16;break;case 11:tE.prev=11,tE.t2=tE.catch(3),Sa(tE.t2)&&Di(new db(Yd(_n.name,"sendMessageToPeer",1e4),Zk)),sa(tE.t2)&&Di(tE.t2),Di(new da("Peer-to-peer message send failure",{code:cr,originalError:tE.t2}));case 16:return tE.prev=16,clearTimeout(_s),tE.finish(16);case 19:case"end":return tE.stop()}},_m,null,[[3,11,16,19]])}));return function(){return _c.apply(this,arguments)}}();_n.internalEmitter.once("RECONNECTED",_o);var _s=setTimeout(function(){_n.internalEmitter.off("RECONNECTED",_o),Di(new db(Yd(_n.name,"sendMessageToPeer",1e4),Zk))},9e3)}));case 5:if(this.connectionState===T.CONNECTED){Ei.next=7;break}throw new K("Failed to send the peer-to-peer message. The client is not logged in",al);case 7:if(this.session!==void 0){Ei.next=9;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 9:return Ei.prev=9,Ei.next=12,Gg({message:_,peerId:C,toPeer:!0,session:this.session,errorCodes:{NOT_LOGGED_IN:al,TOO_OFTEN:dr},diff:0,logger:this.logger,options:{enableHistoricalMessaging:ue,enableOfflineMessaging:B}});case 12:return Ei.abrupt("return",Ei.sent);case 15:if(Ei.prev=15,Ei.t0=Ei.catch(9),!Sa(Ei.t0)){Ei.next=19;break}throw new db(Yd(this.name,"sendMessageToPeer",1e4),Zk);case 19:if(!sa(Ei.t0)){Ei.next=21;break}throw Ei.t0;case 21:throw new da("Peer-to-peer message send failure",{code:cr,originalError:Ei.t0});case 22:case"end":return Ei.stop()}},f,this,[[9,15]])}));return function(f,_){return d.apply(this,arguments)}}()},{key:"createChannel",value:function(d){var f=this;if(!za(d))throw new I(["The %s in the arguments is invalid",Object.keys({channelId:d})[0]],Zz);return new pD(d,function(){return f.session},this,this.logger)}},{key:"createLocalInvitation",value:function(d){if(!za(d))throw new I(["The %s in the arguments is invalid",Object.keys({calleeId:d})[0]],xc);return this.invitationManager.genLocalInvitation(d)}},{key:"subscribePeersOnlineStatus",value:function(){var d=J(w.mark(function f(_){var C,P,x,B,_t,ue,Wt,_n,_i,Ei,_a,Di,_o,_s=this;return w.wrap(function(_c){for(;;)switch(_c.prev=_c.next){case 0:if(this.connectionState===T.CONNECTED){_c.next=2;break}throw new K("The client is not logged in",bl);case 2:if(this.session!==void 0){_c.next=4;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:if(Array.isArray(_)&&_.length!==0){_c.next=6;break}throw new I("Invalid arguments: peerIds",kg);case 6:C=0;case 7:if(!(C<_.length)){_c.next=14;break}if(za(P=_[C])){_c.next=11;break}throw new I(["subscribePeersOnlineStatus peer id %s is invalid",P],kg);case 11:C++,_c.next=7;break;case 14:if(!(512<(x=_&&_.length?vk(_):[]).length+Object.keys(this.subscribedPeerStatusCache).length)){_c.next=17;break}throw new ib("Subscribed peers overflows",gr);case 17:return _c.next=19,this.session.requestSubscribePeersOnlineStatus(x).toPromise();case 19:B=_c.sent,_t=B.errors,ue=[],Wt=[],_n=0;case 24:if(!(_n<_t.length)){_c.next=32;break}if(_i=_t[_n],Ei=_i.code,typeof(_a=_i.account)=="string"){_c.next=28;break}throw new da("Returned account is invalid",fr);case 28:Ei!==0&&ue.push(_a);case 29:_n++,_c.next=24;break;case 32:for(Di=0;Di<x.length;Di++)_o=x[Di],ue.includes(_o)||(Wt.push(_o),this.subscribedPeerStatusCache[_o]=void 0);if(this.session.requestPeersOnlineStatus(Wt).pipe(ba(function(_m){return uc(Jk(_m.userInfos,"account"),function(Qm){return!!Qm.ts})})).subscribe(function(_m){_m=uc(_m,function(Qm,tE){return Qm=Qm?S.PeerOnlineState.ONLINE:S.PeerOnlineState.OFFLINE,_s.subscribedPeerStatusCache[tE]=Qm}),_s.emit("PeersOnlineStatusChanged",_m)}),ue.length===0){_c.next=36;break}throw new da("Subscription failed",fr);case 36:case"end":return _c.stop()}},f,this)}));return function(f){return d.apply(this,arguments)}}()},{key:"unsubscribePeersOnlineStatus",value:function(){var d=J(w.mark(function f(_){var C,P,x,B,_t;return w.wrap(function(ue){for(;;)switch(ue.prev=ue.next){case 0:if(this.connectionState===T.CONNECTED){ue.next=2;break}throw new K("The client is not logged in",bl);case 2:if(this.session!==void 0){ue.next=4;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:if(Array.isArray(_)&&_.length!==0){ue.next=6;break}throw new I("Invalid arguments: peerIds",kg);case 6:C=0;case 7:if(!(C<_.length)){ue.next=14;break}if(za(P=_[C])){ue.next=11;break}throw new I(["subscribePeersOnlineStatus peer id %s is invalid",P],kg);case 11:C++,ue.next=7;break;case 14:if(!(512<_.length)){ue.next=16;break}throw new ib("Unsubscribed peers overflows",gr);case 16:for(x=_&&_.length?vk(_):[],this.session.requestUnsubscribePeersOnlineStatus(x),B=0;B<x.length;B++)_t=x[B],delete this.subscribedPeerStatusCache[_t];case 19:case"end":return ue.stop()}},f,this)}));return function(f){return d.apply(this,arguments)}}()},{key:"queryPeersBySubscriptionOption",value:function(){var d=J(w.mark(function f(_){return w.wrap(function(C){for(;;)switch(C.prev=C.next){case 0:if(this.connectionState===T.CONNECTED){C.next=2;break}throw new K("The client is not logged in",bl);case 2:if(_!==S.PeerSubscriptionOption.ONLINE_STATUS){C.next=4;break}return C.abrupt("return",Object.keys(this.subscribedPeerStatusCache));case 4:throw new I("Subscription option not supported",kg);case 5:case"end":return C.stop()}},f,this)}));return function(f){return d.apply(this,arguments)}}()},{key:"createMessage",value:function(d){return d.messageType==="IMAGE"?ua({width:0,height:0,fileName:"",description:"",thumbnail:new Blob,thumbnailWidth:0,thumbnailHeight:0,size:0},d):d.messageType==="FILE"?ua({fileName:"",description:"",thumbnail:new Blob,size:0},d):d}},{key:"downloadMedia",value:function(){var d=J(w.mark(function f(_){var C,P,x,B,_t,ue,Wt,_n,_i,Ei,_a,Di,_o,_s,_c=this,_m=arguments;return w.wrap(function(Qm){for(;;)switch(Qm.prev=Qm.next){case 0:if(C=1<_m.length&&_m[1]!==void 0?_m[1]:{},typeof _=="string"){Qm.next=3;break}throw new I("invalid mediaId format",cl);case 3:if(Qm.prev=3,P=_.split("z"),x=ra(P,3),B=x[0],_t=x[1],ue=x[2],Wt=B.slice(1,65),_n=bD(Wt),_i=parseInt(B.slice(65),10),Ei=parseInt(_t,10),_a=parseInt(ue,10),!(Number.isNaN(_i)||Number.isNaN(Ei)||Number.isNaN(_a))){Qm.next=12;break}throw new I("Invalid mediaId content",cl);case 12:Qm.next=19;break;case 14:if(Qm.prev=14,Qm.t0=Qm.catch(3),!sa(Qm.t0)){Qm.next=18;break}throw Qm.t0;case 18:throw new I("parse mediaId failure",{code:cl,originalError:Qm.t0});case 19:if(this.connectionState===T.CONNECTED){Qm.next=21;break}throw new K("The client is not logged in, cannot download",CA);case 21:if(this.session!==void 0){Qm.next=23;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 23:return Di=this.mediaTaskManager.addDownloadTask({unit:Ei,zone:_i,hashHexStr:Wt,size:_a},function(){if(_c.session===void 0)throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});return _c.session.requestFileDownloadIndexGet({hash:_n,zone:_i,unit:Ei,size:_a}).toPromise()},C),Qm.next=26,this.mediaTaskManager.waitMediaTask(Di);case 26:return _o=Qm.sent,_s=_o.payload,Qm.abrupt("return",_s);case 29:case"end":return Qm.stop()}},f,this,[[3,14]])}));return function(f){return d.apply(this,arguments)}}()},{key:"createMediaMessageByUploading",value:function(){var d=J(w.mark(function f(_){var C,P,x,B,_t,ue,Wt,_n,_i,Ei,_a,Di,_o,_s,_c,_m,Qm,tE,aE,CE,lE,gE,cE,_E,iE=this,rE=arguments;return w.wrap(function(vf){for(;;)switch(vf.prev=vf.next){case 0:if(C=1<rE.length&&rE[1]!==void 0?rE[1]:{},P=2<rE.length&&rE[2]!==void 0?rE[2]:{},yd(C)){vf.next=4;break}throw new I("Invalid params",wf);case 4:if(x="thumbnailWidth"in C||"thumbnailHeight"in C||"width"in C||"height"in C,B=C.messageType,_t=B===void 0?x?"IMAGE":"FILE":B,ue=C.description,Wt=ue===void 0?"":ue,_n=C.fileName,_i=_n===void 0?"":_n,Ei=C.thumbnail,typeof C.messageType=="string"&&typeof Wt=="string"&&typeof _i=="string"&&(Pm(Ei)||Ei===void 0)&&Pm(_)){vf.next=8;break}throw new I("Invalid message params type",wf);case 8:if(!x||_t!=="FILE"){vf.next=10;break}throw new I("Invalid message params, unexpected field in RtmFileMessage",wf);case 10:if(!(33554432<(_a=_.size))){vf.next=13;break}throw new ib("The payload size overflow 32 MB",wA);case 13:return vf.next=15,Ji(_);case 15:return Di=vf.sent,vf.next=18,aD(Di);case 18:if(_o=vf.sent,this.connectionState===T.CONNECTED){vf.next=21;break}throw new K("The client is not logged in",yA);case 21:if(_t!=="IMAGE"){vf.next=29;break}return vf.next=24,Xt(C,Di);case 24:_s=vf.sent,_c=_s.height,_m=_s.width,Qm=_s.thumbnailWidth,tE=_s.thumbnailHeight;case 29:return aE=this.mediaTaskManager.addUploadTask({file:new Uint8Array(Di),hash:_o},function(){if(iE.session===void 0)throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});return iE.session.fetchFileUploadIndexGet({hash:_o,size:_a})},function(Fg,_d){if(iE.session===void 0)throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});return iE.session.requestFileUploadIndexSet({hash:_o,unit:Fg,servers:_d}).toPromise()},P),vf.next=32,this.mediaTaskManager.waitMediaTask(aE);case 32:if(CE=vf.sent,lE=CE.zone,gE=CE.retUnit,_t!=="IMAGE"){vf.next=38;break}return cE={height:_c,width:_m,fileName:_i,size:_a,description:Wt,thumbnail:Ei,messageType:_t,thumbnailWidth:Qm,thumbnailHeight:tE,mediaId:"0".concat($r(_o)).concat(lE,"z").concat(gE,"z").concat(_a,"z").concat(_c,"z").concat(_m)},vf.abrupt("return",cE);case 38:return _E={fileName:_i,size:_a,description:Wt,mediaId:"0".concat($r(_o)).concat(lE,"z").concat(gE,"z").concat(_a),thumbnail:Ei,messageType:_t},vf.abrupt("return",_E);case 40:case"end":return vf.stop()}},f,this)}));return function(f){return d.apply(this,arguments)}}()},{key:"loginImpl",value:function(){var d=J(w.mark(function f(_){var C,P,x,B,_t=this;return w.wrap(function(ue){for(;;)switch(ue.prev=ue.next){case 0:if(C=_.uid,P=_.instanceId,!(this.lastLoginTime!==void 0&&500>Date.now()-this.lastLoginTime)){ue.next=4;break}throw new rC(["The frequency of login exceeded the limit of %d queries per second",2],mA);case 4:if(this.connectionState===T.DISCONNECTED){ue.next=6;break}throw new K("The SDK is either logging in or has logged in the Agora RTM system",kA);case 6:ue.prev=6,this.context.uid=C,ue.next=13;break;case 10:throw ue.prev=10,ue.t0=ue.catch(6),new I(["The %s in the arguments is invalid",Object.keys({uid:C})[0]],Jh);case 13:return this.onConnectionStateChanged(T.CONNECTING,Eb.LOGIN),this.session=x=new ls(this.context,new Yr(this.context,this.logger,!1),P,this.logger),B=function(){_t.connectionState===T.CONNECTED&&(_t.onConnectionStateChanged(T.RECONNECTING,Eb.INTERRUPTED),_t.session)&&_t.session.once("userJoined",function(){_t.onConnectionStateChanged(T.CONNECTED,Eb.LOGIN_SUCCESS)})},x.on("connectionLost",B),x.on("tokenExpired",function(){_t.emit("TokenExpired")}),x.once("userDrop",this.userDropHandler),this.session.on("peerTextMessage",function(Wt){_t.emit("MessageFromPeer",{text:Wt.text,messageType:S.MessageType.TEXT},Wt.peerId,Wt.properties)}),this.session.on("peerMediaMessage",function(Wt){var _n=Wt.peerId,_i=Wt.properties,Ei=Wt.messageType;Wt=Wt.details,Ei==="FILE"?_t.emit("MessageFromPeer",{messageType:S.MessageType.FILE,size:parseInt(pa(Wt.media_size),10),description:pa(Wt.media_description),fileName:pa(Wt.media_filename),mediaId:pa(Wt.media_id),thumbnail:new Blob([Wt.media_thumbnail])},_n,_i):Ei==="IMAGE"&&_t.emit("MessageFromPeer",{messageType:S.MessageType.IMAGE,size:parseInt(pa(Wt.media_size),10),description:pa(Wt.media_description),fileName:pa(Wt.media_filename),mediaId:pa(Wt.media_id),thumbnail:new Blob([Wt.media_thumbnail]),height:parseInt(pa(Wt.media_height),10),width:parseInt(pa(Wt.media_width),10),thumbnailHeight:parseInt(pa(Wt.media_thumbnailheight),10),thumbnailWidth:parseInt(pa(Wt.media_thumbnailwidth),10)},_n,_i)}),this.session.on("peerRawMessage",function(Wt){_t.emit("MessageFromPeer",{rawMessage:Wt.raw,description:Wt.desc,messageType:S.MessageType.RAW},Wt.peerId,Wt.properties)}),x.on("instanceChanged",function(Wt){return P=Wt}),x.on("peerOnlineStatusChanged",function(Wt){var _n=Wt.instance.toString()+Wt.state,_i=_t.peerStatusSeqLru.get(_n);!_i||Wt.seq.greaterThan(_i)?(_t.peerStatusSeqLru.set(_n,Wt.seq),Wt.state!==_t.subscribedPeerStatusCache[Wt.peerId]&&_t.emit("PeersOnlineStatusChanged",m({},Wt.peerId,Wt.state)),_t.subscribedPeerStatusCache[Wt.peerId]=Wt.state,clearTimeout(_t.peerUnreachableTimers[_n]),Wt.state===S.PeerOnlineState.UNREACHABLE&&(_t.peerUnreachableTimers[_n]=setTimeout(function(){_t.subscribedPeerStatusCache[Wt.peerId]===S.PeerOnlineState.UNREACHABLE&&(_t.subscribedPeerStatusCache[Wt.peerId]=S.PeerOnlineState.ONLINE,_t.emit("PeersOnlineStatusChanged",m({},Wt.peerId,S.PeerOnlineState.ONLINE)))},3e4))):_t.log("peerOnlineStatusChanged dedup for %s, %d",_n,Wt.seq.toNumber())}),x.on("invitationMessage",this.invitationManager.invitationMessageHandler.bind(this.invitationManager)),x.on("channelAttributesUpdated",function(Wt){var _n=Wt.channelId;Wt=Wt.attributeMaps;for(var _i={},Ei=0;Ei<Wt.length;Ei++){var _a=Wt[Ei],Di=_a.key,_o=_a.ms,_s=_a.value;if(_a=_a.origin,typeof Di!="string"||!U.isLong(_o)||typeof _s!="string"||!za(_a))break;_i[Di]=new Blob([_s]).size}_t.channelAttributesCacheLru.set(_n,_i)}),x.on("userJoined",function(Wt){if(Object.keys(_t.attributes).length!==0){if(_t.session===void 0)return;_t.session.requestSetLocalUserAttributes(_t.attributes,Wt).toPromise()}if(_t.attributeDrafts.size!==0)for(var _n=function(_a,Di){var _o=(_a=Di[_a]).attribute;_a.promise.then(function(){_t.session!==void 0&&_t.session.requestSetLocalUserAttributes(_o,Wt).toPromise()})},_i=0,Ei=Array.from(_t.attributeDrafts);_i<Ei.length;_i++)_n(_i,Ei);Object.keys(_t.subscribedPeerStatusCache).length!==0&&x.requestSubscribePeersOnlineStatus(Object.keys(_t.subscribedPeerStatusCache))}),this.lastLoginTime=Date.now(),ue.prev=29,ue.next=32,x.loginHandler().toPromise();case 32:this.mediaTaskManager.setAuthInfo({ticket:x.connection.curOpenSockets.filter(function(Wt){return Wt!==void 0})[0].ticket,instance:x.instanceId,useNewDomain:.5<=Math.random(),loginOpt:x.userJoinOptions.toLong()}),ue.next=44;break;case 35:if(ue.prev=35,ue.t1=ue.catch(29),!Sa(ue.t1)){ue.next=40;break}throw this.onConnectionStateChanged(T.DISCONNECTED,Eb.LOGIN_TIMEOUT),new db(Yd(this.name,"login",2e4),lA);case 40:if(this.onConnectionStateChanged(T.DISCONNECTED,Eb.LOGIN_FAILURE),!sa(ue.t1)){ue.next=43;break}throw ue.t1;case 43:throw new da("Login failure",{code:Zq,originalError:ue.t1});case 44:this.onConnectionStateChanged(T.CONNECTED,Eb.LOGIN_SUCCESS);case 45:case"end":return ue.stop()}},f,this,[[6,10],[29,35]])}));return function(f){return d.apply(this,arguments)}}()},{key:"onConnectionStateChanged",value:function(d,f){var _,C=this;d===T.RECONNECTING&&(this.reconnId+=1),eb("ConnectionStateChange",{elapse:fb(this.session&&this.session.startTime),lts:U.fromNumber(Date.now()),newState:os[d],oldState:os[this.connectionState],reason:qD[f],sid:Xa(this.session&&this.session.instanceId||U.fromNumber(0)),userId:this.context.uid,reconnId:this.reconnId},(_=this.context.config.enableCloudProxy)!==null&&_!==void 0&&_),this.connectionState===T.RECONNECTING&&d===T.CONNECTED&&(Object.keys(this.subscribedPeerStatusCache).length!==0&&this.session!==void 0&&this.session.requestPeersOnlineStatus(Object.keys(this.subscribedPeerStatusCache)).pipe(ba(function(P){return uc(Jk(P.userInfos,"account"),function(x){return!!x.ts})})).subscribe(function(P){P=uc(P,function(x,B){return x=x?S.PeerOnlineState.ONLINE:S.PeerOnlineState.OFFLINE,C.subscribedPeerStatusCache[B]=x}),C.emit("PeersOnlineStatusChanged",P)}),this.internalEmitter.emit("RECONNECTED")),this.connectionState=d,d!==T.ABORTED&&d!==T.DISCONNECTED||(this.reconnId=0,this.attributes={},this.session&&(this.session.removeAllListeners(),this.session.joinedChannels.clear(),this.session.msgDedupLru.empty(),this.session.dialogueSequenceLru.empty(),this.session.dialPendingMsgSubjectMap.clear()),this.session=void 0,this.channelAttributesCacheLru.empty(),this.peerStatusSeqLru.empty(),this.peerUnreachableTimers={},this.subscribedPeerStatusCache={},this.attributeDrafts.clear(),this.context.token=void 0),this.mediaTaskManager.emit("connectionStateChanged",d),this.emit("ConnectionStateChanged",d,f)}}]),r}(tb()),fa(E.prototype,"renewToken",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"renewToken"),E.prototype),fa(E.prototype,"queryPeersOnlineStatus",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"queryPeersOnlineStatus"),E.prototype),fa(E.prototype,"getChannelMemberCount",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"getChannelMemberCount"),E.prototype),fa(E.prototype,"setLocalUserAttributes",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"setLocalUserAttributes"),E.prototype),fa(E.prototype,"setChannelAttributes",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"setChannelAttributes"),E.prototype),fa(E.prototype,"addOrUpdateLocalUserAttributes",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"addOrUpdateLocalUserAttributes"),E.prototype),fa(E.prototype,"addOrUpdateChannelAttributes",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"addOrUpdateChannelAttributes"),E.prototype),fa(E.prototype,"deleteLocalUserAttributesByKeys",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"deleteLocalUserAttributesByKeys"),E.prototype),fa(E.prototype,"deleteChannelAttributesByKeys",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"deleteChannelAttributesByKeys"),E.prototype),fa(E.prototype,"clearLocalUserAttributes",[Nb],Object.getOwnPropertyDescriptor(E.prototype,"clearLocalUserAttributes"),E.prototype),fa(E.prototype,"clearChannelAttributes",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"clearChannelAttributes"),E.prototype),fa(E.prototype,"getUserAttributes",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"getUserAttributes"),E.prototype),fa(E.prototype,"getChannelAttributes",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"getChannelAttributes"),E.prototype),fa(E.prototype,"getChannelAttributesByKeys",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"getChannelAttributesByKeys"),E.prototype),fa(E.prototype,"getUserAttributesByKeys",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"getUserAttributesByKeys"),E.prototype),fa(E.prototype,"login",[Nb],Object.getOwnPropertyDescriptor(E.prototype,"login"),E.prototype),fa(E.prototype,"logout",[Nb],Object.getOwnPropertyDescriptor(E.prototype,"logout"),E.prototype),fa(E.prototype,"logoutSync",[Nb],Object.getOwnPropertyDescriptor(E.prototype,"logoutSync"),E.prototype),fa(E.prototype,"sendMessageToPeer",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"sendMessageToPeer"),E.prototype),fa(E.prototype,"createChannel",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"createChannel"),E.prototype),fa(E.prototype,"createLocalInvitation",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"createLocalInvitation"),E.prototype),fa(E.prototype,"subscribePeersOnlineStatus",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"subscribePeersOnlineStatus"),E.prototype),fa(E.prototype,"unsubscribePeersOnlineStatus",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"unsubscribePeersOnlineStatus"),E.prototype),fa(E.prototype,"queryPeersBySubscriptionOption",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"queryPeersBySubscriptionOption"),E.prototype),fa(E.prototype,"createMessage",[Nb],Object.getOwnPropertyDescriptor(E.prototype,"createMessage"),E.prototype),fa(E.prototype,"downloadMedia",[Nb],Object.getOwnPropertyDescriptor(E.prototype,"downloadMedia"),E.prototype),fa(E.prototype,"createMediaMessageByUploading",[Nb],Object.getOwnPropertyDescriptor(E.prototype,"createMediaMessageByUploading"),E.prototype),E),ps={LOG_FILTER_OFF:{error:!1,warn:!1,info:!1,track:!1,debug:!1},LOG_FILTER_ERROR:{error:!0,warn:!1,info:!1,track:!1,debug:!1},LOG_FILTER_WARNING:{error:!0,warn:!0,info:!1,track:!1,debug:!1},LOG_FILTER_INFO:{error:!0,warn:!0,info:!0,track:!1,debug:!1},LOG_FILTER_DEBUG:{error:!0,warn:!0,info:!0,track:!0,debug:!0}},qs={enableLogUpload:!1,logFilter:ps.LOG_FILTER_INFO,enableCloudProxy:!1},Zd=ua(ua({createInstance:function(e){var r=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{},s=2<arguments.length?arguments[2]:void 0;if(!/^[\dA-Za-z]{32}$/.test(e))throw new I(["The %s in the arguments is invalid",Object.keys({appId:e})[0]],Nq);var d=Object.keys(r).filter(function(_t){return!(_t in qs)});if(d.length!==0)throw new I("Invalid RTM config: ".concat(d.join(", ")),Nq);var f=ua(ua({},qs),r);if(s!==void 0&&(!Array.isArray(s)||s.length===0))throw new I("Invalid area config");if(s!=null){if(!s.every(function(_t){return _t in S.LegacyAreaCode}))throw new I("Invalid area codes: ".concat(s.filter(function(_t){return!(_t in S)}).join(", ")));M=xe(s.map(function(_t){return zC[_t]}))}s=jl=Ya.__global_unique_id__=(Ya.__global_unique_id__||0)+1;var _=DC(f);d=EC(f);var C=FC(f),P=GC(s,f),x=Tr(s,f),B=x("RTM:DEBUG","<Entry> ");return Mr.rtmConfig=f,_("The Agora RTM Web SDK version is %s","1.4.3-203"),r.enableCloudProxy&&_("RTM cloud proxy enabled"),r.enableLogUpload&&_("Log upload enabled"),M&&B("Area is set to %s",Array.from(M.CODES).map(function(_t){return xf(F).find(function(ue){return F[ue]===_t})}).join(", ")),B("Creating an RtmClient instance"),B('The Git commit ID is "'.concat("v1.4.3-17-g1e27aa38",'"')),B("The App ID is %s",Um(e,4,10,"*".repeat(6))),_("The process ID is %s",gg),B("The build is %s","v1.4.3-17-g1e27aa38"),B("NODE_ENV is %s","production"),new rD(e,{genLogger:x,genTracker:P,info:_,warn:d,logError:C,loggerId:s},f,function(_t){for(var ue=0,Wt=xf(_t);ue<Wt.length;ue++){var _n=Wt[ue];try{var _i=_t[_n];_i!=null&&(_t.enableCloudProxy&&_("RTM cloud proxy enabled"),_t.enableLogUpload&&_("Log upload enabled"),f[_n]=_i)}catch{throw new I(["The %s in the arguments is invalid",_n],void 0)}}})},BUILD:"v1.4.3-17-g1e27aa38",VERSION:"1.4.3-203",END_CALL_PREFIX:"AgoraRTMLegacyEndcallCompatibleMessagePrefix",processId:gg,ConnectionChangeReason:S.ConnectionChangeReason,ConnectionState:S.ConnectionState,LocalInvitationFailureReason:S.LocalInvitationFailureReason,LocalInvitationState:S.LocalInvitationState,RemoteInvitationFailureReason:S.RemoteInvitationFailureReason,RemoteInvitationState:S.RemoteInvitationState,MessageType:S.MessageType,PeerOnlineState:S.PeerOnlineState,PeerSubscriptionOption:S.PeerSubscriptionOption},ps),{},{setParameter:function(e,r){Object.keys(Nc).includes(e)&&(Nc[e]=r)},getParameter:function(e){return Nc[e]},setArea:function(e){var r=e.areaCodes;if(e=e.excludedArea,!Array.isArray(r)||r.length===0||!r.every(function(s){return s in S.AreaCode}))throw new I("Invalid area config");if(e!==void 0&&e===S.AreaCode.GLOBAL)throw new I("Excluded area cannot be global");if(e===void 0)M=xe(r.map(function(s){return F[s]}));else{if(r.includes(e))throw new I("Excluded area cannot be in areaCodes");if(!(e in F))throw new I("Invalid excludedArea:",e);M=bu({areas:r.map(function(s){return F[s]}),excludedArea:F[e]})}}});return Zd})})(agoraRtmSdk,agoraRtmSdk.exports);var agoraRtmSdkExports=agoraRtmSdk.exports;const AgoraRTM__default=getDefaultExportFromCjs(agoraRtmSdkExports);var createLazyClient=function e(){var r;function s(d,f,_){return r||(r=AgoraRTM__default.createInstance(d,f,_)),r}return function(d,f,_){return s(d,f,_)}},createLazyChannel=function e(){var r;function s(d,f){return r||(r=d.createChannel(f)),r}return function(d,f){return s(d,f)}},AreaCode;(function(e){e.GLOBAL="GLOBAL",e.INDIA="INDIA",e.JAPAN="JAPAN",e.ASIA="ASIA",e.EUROPE="EUROPE",e.CHINA="CHINA",e.NORTH_AMERICA="NORTH_AMERICA"})(AreaCode||(AreaCode={}));function _extends(){return _extends=Object.assign||function(e){for(var r=1;r<arguments.length;r++){var s=arguments[r];for(var d in s)Object.prototype.hasOwnProperty.call(s,d)&&(e[d]=s[d])}return e},_extends.apply(this,arguments)}typeof Symbol<"u"&&(Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator")));typeof Symbol<"u"&&(Symbol.asyncIterator||(Symbol.asyncIterator=Symbol("Symbol.asyncIterator")));function _catch(e,r){try{var s=e()}catch(d){return r(d)}return s&&s.then?s.then(void 0,r):s}var RtcContext=React.createContext({}),RtcProvider=RtcContext.Provider;RtcContext.Consumer;var remoteTrackState;(function(e){e[e.yes=0]="yes",e[e.subbed=1]="subbed",e[e.no=2]="no"})(remoteTrackState||(remoteTrackState={}));var layout;(function(e){e[e.grid=0]="grid",e[e.pin=1]="pin"})(layout||(layout={}));var ToggleState;(function(e){e[e.disabled=0]="disabled",e[e.enabled=1]="enabled",e[e.disabling=2]="disabling",e[e.enabling=3]="enabling"})(ToggleState||(ToggleState={}));var initialValue={rtcProps:{appId:"",channel:"",role:"host"},rtmProps:{}},PropsContext=React.createContext(initialValue),PropsProvider=PropsContext.Provider,MaxUidContext=React.createContext([]),MaxUidProvider=MaxUidContext.Provider,MaxUidConsumer=MaxUidContext.Consumer,MinUidContext=React.createContext([]),MinUidProvider=MinUidContext.Provider,MinUidConsumer=MinUidContext.Consumer,TracksContext=React.createContext({}),TracksProvider=TracksContext.Provider,initState={max:[{uid:0,hasAudio:remoteTrackState.no,hasVideo:remoteTrackState.no}],min:[],isScreensharing:!1},reducer=function e(r,s){var d=initState,f=[].concat(r.max,r.min).map(function(B){return B.uid});switch(s.type){case"Screensharing":d=_extends({},r,{isScreensharing:s.value[0]}),console.log("!Screensharingstate",r,d);break;case"update-user-video":d={min:r.min.map(function(B){return B.uid===0?{uid:0,hasAudio:remoteTrackState.subbed,hasVideo:remoteTrackState.subbed}:B}),max:r.max.map(function(B){return B.uid===0?{uid:0,hasAudio:remoteTrackState.subbed,hasVideo:remoteTrackState.subbed}:B}),isScreensharing:r.isScreensharing};break;case"user-joined":if(f.indexOf(s.value[0].uid)===-1){var _=[].concat(r.min,[{uid:s.value[0].uid,hasAudio:remoteTrackState.no,hasVideo:remoteTrackState.no}]);_.length===1&&r.max[0].uid===0?d={max:_,min:r.max,isScreensharing:r.isScreensharing}:d={min:_,max:r.max,isScreensharing:r.isScreensharing}}break;case"user-unpublished":if(r.max[0].uid===s.value[0].uid)d={max:[{uid:s.value[0].uid,hasAudio:s.value[1]==="audio"?remoteTrackState.no:r.max[0].hasAudio,hasVideo:s.value[1]==="video"?remoteTrackState.no:r.max[0].hasVideo}],min:r.min,isScreensharing:r.isScreensharing};else{var C=r.min.find(function(B){return B.uid===s.value[0].uid});if(C){var P=[].concat(r.min.filter(function(B){return B.uid!==s.value[0].uid}),[{uid:s.value[0].uid,hasAudio:s.value[1]==="audio"?remoteTrackState.no:C.hasAudio,hasVideo:s.value[1]==="video"?remoteTrackState.no:C.hasVideo}]);d={min:P,max:r.max,isScreensharing:r.isScreensharing}}}break;case"user-published":r.max[0].uid===s.value[0].uid?d={max:[{uid:s.value[0].uid,hasAudio:s.value[1]==="audio"?remoteTrackState.subbed:r.max[0].hasAudio,hasVideo:s.value[1]==="video"?remoteTrackState.subbed:r.max[0].hasVideo}],min:r.min,isScreensharing:r.isScreensharing}:d={min:r.min.map(function(B){return B.uid!==s.value[0].uid?B:{uid:B.uid,hasAudio:s.value[1]==="audio"?remoteTrackState.subbed:B.hasAudio,hasVideo:s.value[1]==="video"?remoteTrackState.subbed:B.hasVideo}}),max:r.max,isScreensharing:r.isScreensharing};break;case"user-left":if(r.max[0].uid===s.value[0].uid){var x=[].concat(r.min);d={max:[x.pop()],min:x,isScreensharing:r.isScreensharing}}else d={min:r.min.filter(function(B){return B.uid!==s.value[0].uid}),max:r.max,isScreensharing:r.isScreensharing};break;case"user-swap":r.max[0].uid===s.value[0].uid||(d={max:[s.value[0]],min:[].concat(r.min.filter(function(B){return B.uid!==s.value[0].uid}),[r.max[0]]),isScreensharing:r.isScreensharing});break;case"local-user-mute-video":d={min:r.min.map(function(B){return B.uid===0?{uid:0,hasAudio:B.hasAudio,hasVideo:s.value[0]}:B}),max:r.max.map(function(B){return B.uid===0?{uid:0,hasAudio:B.hasAudio,hasVideo:s.value[0]}:B}),isScreensharing:r.isScreensharing};break;case"local-user-mute-audio":d={min:r.min.map(function(B){return B.uid===0?{uid:0,hasAudio:s.value[0],hasVideo:B.hasVideo}:B}),max:r.max.map(function(B){return B.uid===0?{uid:0,hasAudio:s.value[0],hasVideo:B.hasVideo}:B}),isScreensharing:r.isScreensharing};break;case"remote-user-mute-video":d={min:r.min.map(function(B){return B.uid===s.value[0].uid?{uid:B.uid,hasVideo:s.value[1],hasAudio:B.hasAudio}:B}),max:r.max.map(function(B){return B.uid===s.value[0].uid?{uid:B.uid,hasVideo:s.value[1],hasAudio:B.hasAudio}:B}),isScreensharing:r.isScreensharing};break;case"remote-user-mute-audio":d={min:r.min.map(function(B){return B.uid===s.value[0].uid?{uid:B.uid,hasAudio:s.value[1],hasVideo:B.hasVideo}:B}),max:r.max.map(function(B){return B.uid===s.value[0].uid?{uid:B.uid,hasAudio:s.value[1],hasVideo:B.hasVideo}:B}),isScreensharing:r.isScreensharing};break;case"leave-channel":d=initState;break;case"ActiveSpeaker":r.max[0].uid===s.value[0]?d=_extends({},r):d={max:[r.min.find(function(B){return B.uid===s.value[0]})],min:[].concat(r.min.filter(function(B){return B.uid!==s.value[0]}),[r.max[0]]),isScreensharing:r.isScreensharing};break}return console.log("!state-update",_extends({},r,d),d),_extends({},r,d)},startScreenshare=function e(r,s,d,f,_,C,P){try{var x=function(){try{try{console.log(ue),C&&(ue.on("token-privilege-will-expire",function(){try{return console.log("token will expire"),Promise.resolve(fetch(C+"/rtc/"+s+"/publisher/uid/"+_n+"/")).then(function(Di){return Promise.resolve(Di.json()).then(function(_o){var _s=_o.rtcToken;ue.renewToken(_s)})})}catch(Di){return Promise.reject(Di)}}),ue.on("token-privilege-did-expire",function(){try{return Promise.resolve(fetch(C+"/rtc/"+s+"/publisher/uid/"+_n+"/")).then(function(Di){return Promise.resolve(Di.json()).then(function(_o){var _s=_o.rtcToken;ue.renewToken(_s)})})}catch(Di){return Promise.reject(Di)}})),d.on("track-ended",function(){ue.leave(),ue.removeAllListeners()})}catch(Di){console.log(Di)}return Promise.resolve()}catch(Di){return Promise.reject(Di)}},B=function(){try{ue.setClientRole("host");var Di=function(){if(C){var _o=_catch(function(){return Promise.resolve(fetch(C+"/rtc/"+s+"/publisher/uid/"+_n+"/")).then(function(_s){return Promise.resolve(_s.json()).then(function(_c){var _m=_c.rtcToken;return Promise.resolve(ue.join(r,s,_m,_n)).then(function(Qm){Wt=Qm})})})},function(_s){console.log(_s)});if(_o&&_o.then)return _o.then(function(){})}else return Promise.resolve(ue.join(r,s,f||null,_n||0)).then(function(_s){Wt=_s})}();return Promise.resolve(Di&&Di.then?Di.then(function(){}):void 0)}catch(_o){return Promise.reject(_o)}},_t=function(){try{var Di=function(){var _c=function(){if(d.enabled){var _m=function(){if(!_i)return Promise.resolve(ue.publish([d]).then(function(){_i=!0})).then(function(){})}();if(_m&&_m.then)return _m.then(function(){})}}();if(_c&&_c.then)return _c.then(function(){})},_o=function(){if(P)return Promise.resolve(ue.enableDualStream()).then(function(){})}();return Promise.resolve(_o&&_o.then?_o.then(Di):Di(_o))}catch(_s){return Promise.reject(_s)}},ue=AgoraRTC__default.createClient({mode:"live",role:"host",codec:"vp8"}),Wt=0,_n=_||1,_i=!1,Ei=function(){try{var Di=_catch(function(){return d.close(),Promise.resolve(ue.leave()).then(function(){ue.removeAllListeners()})},function(_o){console.log(_o)});return Promise.resolve(Di&&Di.then?Di.then(function(){}):void 0)}catch(_o){return Promise.reject(_o)}};return stopScreenshare=Ei,Promise.resolve(x()).then(function(){return Promise.resolve(B()).then(function(){return Promise.resolve(_t()).then(function(){Wt&&console.log(Wt)})})})}catch(_a){return Promise.reject(_a)}},stopScreenshare=function e(){},useClient=createClient({codec:"vp8",mode:"live"}),RtcConfigure=function e(r){var s=reactExports.useRef(),d=reactExports.useRef(),f=reactExports.useRef(!1),_=reactExports.useContext(TracksContext),C=_.localVideoTrack,P=_.localAudioTrack,x=reactExports.useContext(PropsContext),B=x.callbacks,_t=x.rtcProps,ue=reactExports.useState(!1),Wt=ue[0],_n=ue[1],_i=reactExports.useState(!1),Ei=_i[0],_a=_i[1],Di=null,_o=reactExports.useRef(new Promise(function(cE,_E){Di=cE,console.log(_E)})),_s=useClient();_t.customRtcClient&&(_s.removeAllListeners(),_s=_t.customRtcClient);var _c=!1,_m=!1,Qm=reactExports.useRef({}),tE=r.callActive;tE===void 0&&(tE=!0);var aE=reactExports.useReducer(reducer,initState),CE=aE[0],lE=aE[1];reactExports.useEffect(function(){var cE=function(){try{try{if(console.log(_s),_s.on("user-joined",function(){try{for(var _d=arguments.length,_f=new Array(_d),uE=0;uE<_d;uE++)_f[uE]=arguments[uE];var dE=_f[0];return dE.uid===r.screenshareUid&&f.current||dE.uid===1&&f.current||(Qm.current[dE.uid]={}),lE({type:"user-joined",value:_f}),Promise.resolve()}catch(IE){return Promise.reject(IE)}}),_s.on("user-published",function(){for(var _d=arguments.length,_f=new Array(_d),uE=0;uE<_d;uE++)_f[uE]=arguments[uE];try{var dE=_f[0],IE=_f[1];return console.log("user-published",dE.uid),dE.uid===r.screenshareUid&&f.current||dE.uid===1&&f.current?lE({type:"user-published",value:_f}):_s.subscribe(dE,IE).then(function(DE){if(Qm.current[dE.uid][IE+"Track"]=dE[IE+"Track"],IE==="audio"){var GE;(GE=dE.audioTrack)===null||GE===void 0||GE.play()}else _t.enableDualStream&&_t.dualStreamMode&&_s.setStreamFallbackOption(dE.uid,_t.dualStreamMode);lE({type:"user-published",value:_f})}).catch(function(DE){return console.log(DE)}),Promise.resolve()}catch(DE){return Promise.reject(DE)}}),_s.on("user-unpublished",function(){try{for(var _d=arguments.length,_f=new Array(_d),uE=0;uE<_d;uE++)_f[uE]=arguments[uE];var dE=_f[0],IE=_f[1];if(console.log("user-unpublished",dE.uid),IE==="audio"){var DE;(DE=dE.audioTrack)===null||DE===void 0||DE.stop()}return lE({type:"user-unpublished",value:_f}),Promise.resolve()}catch(GE){return Promise.reject(GE)}}),_s.on("connection-state-change",function(){try{for(var _d=arguments.length,_f=new Array(_d),uE=0;uE<_d;uE++)_f[uE]=arguments[uE];var dE=_f[0],IE=_f[1],DE=_f[2];if(console.log("connection",IE,dE,DE),dE==="CONNECTED")_a(!0);else if(dE==="DISCONNECTED"){try{stopScreenshare(),f.current=!1}catch(GE){console.log("stopscreenshare",GE)}lE({type:"leave-channel",value:null})}else _a(!1);return Promise.resolve()}catch(GE){return Promise.reject(GE)}}),_s.on("user-left",function(){for(var _d=arguments.length,_f=new Array(_d),uE=0;uE<_d;uE++)_f[uE]=arguments[uE];lE({type:"user-left",value:_f})}),_t.tokenUrl){var iE=_t.tokenUrl,rE=_t.channel,vf=_t.uid;_s.on("token-privilege-will-expire",function(){try{return console.log("token will expire"),Promise.resolve(fetch(iE+"/rtc/"+rE+"/publisher/uid/"+(vf||0)+"/")).then(function(_d){return Promise.resolve(_d.json()).then(function(_f){var uE=_f.rtcToken;_s.renewToken(uE)})})}catch(_d){return Promise.reject(_d)}}),_s.on("token-privilege-did-expire",function(){try{return Promise.resolve(fetch(iE+"/rtc/"+rE+"/publisher/uid/"+(vf||0)+"/")).then(function(_d){return Promise.resolve(_d.json()).then(function(_f){var uE=_f.rtcToken;_s.renewToken(uE)})})}catch(_d){return Promise.reject(_d)}})}if(B){var Fg=Object.keys(B);Fg.map(function(_d){try{_s.on(_d,function(){for(var _f=arguments.length,uE=new Array(_f),dE=0;dE<_f;dE++)uE[dE]=arguments[dE];B[_d].apply(null,uE)})}catch(_f){console.log(_f)}})}Di(!0),_n(!0)}catch(_d){console.log("!!!",_d)}return Promise.resolve()}catch(_d){return Promise.reject(_d)}};return Di?(cE(),function(){try{_s.removeAllListeners()}catch(_E){console.log(_E)}}):function(){}},[_t.appId]),reactExports.useEffect(function(){var cE=function(){try{return Promise.resolve(_o.current).then(function(){var rE=_t.tokenUrl,vf=_t.channel,Fg=_t.uid,_d=_t.appId,_f=_t.token,uE=function(){if(_s&&!_E){_t.role==="audience"?_s.setClientRole(_t.role):_s.setClientRole("host");var dE=function(){if(rE){var IE=_catch(function(){return Promise.resolve(fetch(rE+"/rtc/"+vf+"/publisher/uid/"+(Fg||0)+"/")).then(function(DE){return Promise.resolve(DE.json()).then(function(GE){var QE=GE.rtcToken;return Promise.resolve(_s.join(_d,vf,QE,Fg||0)).then(function(a_){s.current=a_})})})},function(DE){console.log(DE)});if(IE&&IE.then)return IE.then(function(){})}else return Promise.resolve(_s.join(_d,vf,_f||null,Fg||0)).then(function(DE){s.current=DE})}();if(dE&&dE.then)return dE.then(function(){})}else console.error("trying to join before RTC Engine was initialized")}();if(uE&&uE.then)return uE.then(function(){})})}catch(rE){return Promise.reject(rE)}},_E=!1;return tE?(cE(),console.log("Attempted join: ",_t.channel)):console.log("In precall - waiting to join"),function(){if(_E=!0,tE){console.log("Leaving channel");try{stopScreenshare(),f.current=!1}catch(iE){console.log(iE)}_o.current=_s.leave().catch(function(iE){return console.log(iE)})}}},[_t.channel,_t.uid,tE,_t.tokenUrl]),reactExports.useEffect(function(){var cE=function(){try{var iE=function(){function Fg(){var _f=function(){if(C!=null&&C.enabled&&Ei){var uE=function(){if(!_c)return Promise.resolve(_s.publish([C]).then(function(){_c=!0})).then(function(){})}();if(uE&&uE.then)return uE.then(function(){})}}();if(_f&&_f.then)return _f.then(function(){})}var _d=function(){if(P!=null&&P.enabled&&Ei){var _f=function(){if(!_m)return Promise.resolve(_s.publish([P]).then(function(){_m=!0})).then(function(){})}();if(_f&&_f.then)return _f.then(function(){})}}();return _d&&_d.then?_d.then(Fg):Fg(_d)},rE=function(){if(_t.enableDualStream)return Promise.resolve(_s.enableDualStream()).then(function(){})}();return Promise.resolve(rE&&rE.then?rE.then(iE):iE(rE))}catch(vf){return Promise.reject(vf)}};console.log("Publish",C,P,tE),tE&&cE()},[tE,C==null?void 0:C.enabled,P==null?void 0:P.enabled,Ei]),reactExports.useEffect(function(){C&&P!==null&&(Qm.current[0]={audioTrack:P,videoTrack:C},lE({type:"update-user-video",value:[P,C]}))},[_t.channel,Ei]),reactExports.useEffect(function(){Ei&&_t.token&&_s.renewToken(_t.token).then(function(cE){return console.log("renewed token",cE)})},[_t.token,Ei]),reactExports.useEffect(function(){_t.role&&_s.setClientRole(_t.role).then(function(cE){return console.log("changed role",cE)})},[_t.role,Ei]),reactExports.useEffect(function(){var cE=function(){try{var iE=function(){if(_t.activeSpeaker&&_t.layout!==layout.grid)return _s.on("volume-indicator",function(rE){var vf=rE.reduce(function(_f,uE){return _f===null||uE.level>_f.level?uE:_f},null),Fg=vf?vf.uid:void 0,_d=Fg===s.current?0:Fg;Fg!==void 0&&lE({type:"ActiveSpeaker",value:[_d]})}),Promise.resolve(_s.enableAudioVolumeIndicator()).then(function(){})}();return Promise.resolve(iE&&iE.then?iE.then(function(){}):void 0)}catch(rE){return Promise.reject(rE)}};return tE&&cE(),function(){_s.removeAllListeners("volume-indicator")}},[_t.activeSpeaker,_t.layout]);var gE=function(){try{var _E=function(){try{return lE({type:"Screensharing",value:[!0]}),Promise.resolve(AgoraRTC__default.createScreenVideoTrack({},"disable")).then(function(vf){d.current=vf;var Fg=_t.screenshareUid||1;return Qm.current[Fg]={videoTrack:d.current},d.current.on("track-ended",function(){f.current=!1,lE({type:"Screensharing",value:[!1]})}),f.current=!0,Promise.resolve(startScreenshare(_t.appId,_t.channel,d.current,_t.screenshareToken,_t.screenshareUid,_t.tokenUrl,_t.enableDualStream)).then(function(){})})}catch(vf){return Promise.reject(vf)}},iE=function(){stopScreenshare(),f.current=!1};return f.current?iE():_E(),Promise.resolve()}catch(rE){return Promise.reject(rE)}};return React.createElement(RtcProvider,{value:{client:_s,mediaStore:Qm.current,localVideoTrack:C,localAudioTrack:P,dispatch:lE,localUid:s,channelJoined:Ei,toggleScreensharing:gE,isScreensharing:f.current}},React.createElement(MaxUidProvider,{value:CE.max},React.createElement(MinUidProvider,{value:CE.min},Wt?r.children:null)))},icons={videocam:React.createElement(React.Fragment,null,React.createElement("polygon",{points:"23 7 16 12 23 17 23 7"}),React.createElement("rect",{x:"1",y:"5",width:"15",height:"14",rx:"2",ry:"2"})),videocamOff:React.createElement(React.Fragment,null,React.createElement("path",{d:"M16 16v1a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V7a2 2 0 0 1 2-2h2m5.66 0H14a2 2 0 0 1 2 2v3.34l1 1L23 7v10"}),React.createElement("line",{x1:"1",y1:"1",x2:"23",y2:"23"})),remoteSwap:React.createElement(React.Fragment,null,React.createElement("polyline",{points:"15 3 21 3 21 9"}),React.createElement("polyline",{points:"9 21 3 21 3 15"}),React.createElement("line",{x1:"21",y1:"3",x2:"14",y2:"10"}),React.createElement("line",{x1:"3",y1:"21",x2:"10",y2:"14"})),callEnd:React.createElement(React.Fragment,null,React.createElement("path",{d:"M10.68 13.31a16 16 0 0 0 3.41 2.6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7 2 2 0 0 1 1.72 2v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.42 19.42 0 0 1-3.33-2.67m-2.67-3.34a19.79 19.79 0 0 1-3.07-8.63A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91"}),React.createElement("line",{x1:"23",y1:"1",x2:"1",y2:"23"})),mic:React.createElement(React.Fragment,null,React.createElement("path",{d:"M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"}),React.createElement("path",{d:"M19 10v2a7 7 0 0 1-14 0v-2"}),React.createElement("line",{x1:"12",y1:"19",x2:"12",y2:"23"}),React.createElement("line",{x1:"8",y1:"23",x2:"16",y2:"23"})),micOff:React.createElement(React.Fragment,null,React.createElement("line",{x1:"1",y1:"1",x2:"23",y2:"23"}),React.createElement("path",{d:"M9 9v3a3 3 0 0 0 5.12 2.12M15 9.34V4a3 3 0 0 0-5.94-.6"}),React.createElement("path",{d:"M17 16.95A7 7 0 0 1 5 12v-2m14 0v2a7 7 0 0 1-.11 1.23"}),React.createElement("line",{x1:"12",y1:"19",x2:"12",y2:"23"}),React.createElement("line",{x1:"8",y1:"23",x2:"16",y2:"23"})),screen:React.createElement(React.Fragment,null,React.createElement("rect",{x:"2",y:"3",width:"20",height:"14",rx:"2",ry:"2"}),React.createElement("line",{x1:"8",y1:"21",x2:"16",y2:"21"}),React.createElement("line",{x1:"12",y1:"17",x2:"12",y2:"21"})),stop:React.createElement(React.Fragment,null,React.createElement("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),React.createElement("line",{x1:"6",y1:"6",x2:"18",y2:"18"}))},BtnTemplate=function e(r){var s=r.onClick,d=r.name,f=r.disabled,_=r.style,C=reactExports.useContext(PropsContext),P=C.styleProps,x=P||{},B=x.theme,_t=x.BtnTemplateStyles,ue=x.iconSize,Wt=x.customIcon;return React.createElement("div",{style:_extends({},{width:35,height:35,borderRadius:"100%",borderWidth:2,borderStyle:"solid",borderColor:"#fff",backgroundColor:"rgba(0,80,180,0.2)",alignItems:"center",justifyContent:"center",display:"flex",cursor:f?"auto":"pointer",margin:4},_t,_),onClick:s},Wt?React.createElement("img",{src:Wt[d],alt:d}):React.createElement("svg",{style:{width:ue||24,height:ue||24},xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",opacity:f?"0.5":"1",stroke:B||"#fff",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},icons[d]))};function EndCall(){var e=reactExports.useContext(PropsContext),r=e.styleProps,s=e.callbacks,d=r||{},f=d.localBtnStyles,_=f||{},C=_.endCall;return React.createElement(BtnTemplate,{style:C||{backgroundColor:"#ef5588",borderColor:"#f00"},name:"callEnd",onClick:function(){return(s==null?void 0:s.EndCall)&&s.EndCall()}})}var LocalContext=reactExports.createContext({}),LocalUserContext=function e(r){var s=reactExports.useContext(MaxUidContext),d=reactExports.useContext(MinUidContext),f;return s[0].uid===0?f=s[0]:f=d.find(function(_){return _.uid===0}),React.createElement(LocalContext.Provider,{value:f},r.children)},muteAudio=function(e,r,s,d){try{var f=function(){if(e.uid===0){var _=e.hasAudio,C=function(){if(_===ToggleState.enabled||_===ToggleState.disabled){var P=_===ToggleState.enabled?ToggleState.disabling:ToggleState.enabling;r({type:"local-user-mute-audio",value:[P]}),d&&d["local-user-mute-audio"]&&d["local-user-mute-audio"](P);var x=_catch(function(){return Promise.resolve(s==null?void 0:s.setEnabled(_!==ToggleState.enabled)).then(function(){P=_===ToggleState.enabled?ToggleState.disabled:ToggleState.enabled,d&&d["local-user-mute-audio"]&&d["local-user-mute-audio"](P),r({type:"local-user-mute-audio",value:[_===ToggleState.enabled?ToggleState.disabled:ToggleState.enabled]})})},function(){r({type:"local-user-mute-audio",value:[_]})});if(x&&x.then)return x.then(function(){})}}();if(C&&C.then)return C.then(function(){})}}();return Promise.resolve(f&&f.then?f.then(function(){}):void 0)}catch(_){return Promise.reject(_)}};function LocalAudioMute(){var e=reactExports.useContext(PropsContext),r=e.styleProps,s=e.callbacks,d=r||{},f=d.localBtnStyles,_=f||{},C=_.muteLocalAudio,P=reactExports.useContext(RtcContext),x=P.dispatch,B=P.localAudioTrack,_t=reactExports.useContext(LocalContext);return React.createElement("div",null,React.createElement(BtnTemplate,{style:C,name:_t.hasAudio===ToggleState.enabled?"mic":"micOff",onClick:function(){return B&&muteAudio(_t,x,B,s)}}))}function Screenshare(){var e=reactExports.useContext(PropsContext),r=e.styleProps,s=r||{},d=s.localBtnStyles,f=d||{},_=f.screenshare,C=reactExports.useContext(RtcContext),P=C.toggleScreensharing,x=C.isScreensharing;return React.createElement("div",null,React.createElement(BtnTemplate,{style:_,name:x?"stop":"screen",onClick:function(){return P()}}))}var muteVideo=function(e,r,s,d){try{var f=function(){if(e.uid===0){var _=e.hasVideo,C=function(){if(_===ToggleState.enabled||_===ToggleState.disabled){var P=_===ToggleState.enabled?ToggleState.disabling:ToggleState.enabling;r({type:"local-user-mute-video",value:[P]}),d&&d["local-user-mute-video"]&&d["local-user-mute-video"](P);var x=_catch(function(){return Promise.resolve(s==null?void 0:s.setEnabled(_!==ToggleState.enabled)).then(function(){P=_===ToggleState.enabled?ToggleState.disabled:ToggleState.enabled,d&&d["local-user-mute-video"]&&d["local-user-mute-video"](P),r({type:"local-user-mute-video",value:[P]})})},function(){r({type:"local-user-mute-video",value:[_]})});if(x&&x.then)return x.then(function(){})}}();if(C&&C.then)return C.then(function(){})}}();return Promise.resolve(f&&f.then?f.then(function(){}):void 0)}catch(_){return Promise.reject(_)}};function LocalVideoMute(){var e=reactExports.useContext(PropsContext),r=e.styleProps,s=e.callbacks,d=r||{},f=d.localBtnStyles,_=f||{},C=_.muteLocalVideo,P=reactExports.useContext(RtcContext),x=P.dispatch,B=P.localVideoTrack,_t=reactExports.useContext(LocalContext);return React.createElement("div",null,React.createElement(BtnTemplate,{style:C,name:_t.hasVideo===ToggleState.enabled?"videocam":"videocamOff",onClick:function(){return B&&muteVideo(_t,x,B,s)}}))}function LocalControls(){var e=reactExports.useContext(PropsContext),r=e.styleProps,s=e.rtcProps,d=r||{},f=d.localBtnContainer;return React.createElement("div",{style:_extends({},{backgroundColor:"#007bff",width:"100%",height:70,zIndex:10,display:"flex",flexDirection:"row",justifyContent:"space-evenly",alignItems:"center"},f)},s.role!=="audience"&&React.createElement(LocalVideoMute,null),s.role!=="audience"&&React.createElement(LocalAudioMute,null),s.role!=="audience"&&s.enableScreensharing&&React.createElement(Screenshare,null),React.createElement(EndCall,null))}var rtmStatusEnum;(function(e){e[e.initFailed=0]="initFailed",e[e.offline=1]="offline",e[e.initialising=2]="initialising",e[e.loggingIn=3]="loggingIn",e[e.loggedIn=4]="loggedIn",e[e.connected=5]="connected",e[e.loginFailed=6]="loginFailed"})(rtmStatusEnum||(rtmStatusEnum={}));var clientRoleRaw;(function(e){e[e.broadcaster=0]="broadcaster",e[e.audience=1]="audience"})(clientRoleRaw||(clientRoleRaw={}));var mutingDevice;(function(e){e[e.camera=0]="camera",e[e.microphone=1]="microphone"})(mutingDevice||(mutingDevice={}));var popUpStateEnum;(function(e){e[e.closed=0]="closed",e[e.muteMic=1]="muteMic",e[e.muteCamera=2]="muteCamera",e[e.unmuteMic=3]="unmuteMic",e[e.unmuteCamera=4]="unmuteCamera"})(popUpStateEnum||(popUpStateEnum={}));var RtmContext=reactExports.createContext(null),RtmProvider=RtmContext.Provider;RtmContext.Consumer;function RemoteVideoMute(e){var r=reactExports.useContext(PropsContext),s=r.styleProps,d=reactExports.useContext(RtmContext),f=d.sendMuteRequest,_=d.uidMap,C=s||{},P=C.remoteBtnStyles,x=P||{},B=x.muteRemoteVideo,_t=e.UIKitUser,ue=_t.hasVideo===remoteTrackState.no;return _t.uid!==0&&_[_t.uid]?React.createElement("div",null,React.createElement(BtnTemplate,{name:_t.hasVideo===remoteTrackState.subbed?"videocam":"videocamOff",style:B,onClick:function(){return f(mutingDevice.camera,_t.uid,!ue)}})):null}function RemoteAudioMute(e){var r=reactExports.useContext(PropsContext),s=r.styleProps,d=s||{},f=d.remoteBtnStyles,_=reactExports.useContext(RtmContext),C=_.sendMuteRequest,P=_.uidMap,x=f||{},B=x.muteRemoteAudio,_t=e.UIKitUser,ue=_t.hasAudio===remoteTrackState.no;return _t.uid!==0&&P[_t.uid]?React.createElement("div",null,React.createElement(BtnTemplate,{style:B,name:_t.hasAudio===remoteTrackState.subbed?"mic":"micOff",onClick:function(){return C(mutingDevice.microphone,_t.uid,!ue)}})):null}function SwapUser(e){var r=reactExports.useContext(RtcContext),s=r.dispatch,d=e.UIKitUser;return React.createElement("div",null,React.createElement(BtnTemplate,{name:"remoteSwap",onClick:function(){return s({type:"user-swap",value:[d]})}}))}var VideoPlaceholder=function e(r){var s=reactExports.useContext(PropsContext),d=s.styleProps,f=s.rtcProps,_=d||{},C=_.maxViewStyles,P=_.maxViewOverlayContainer,x=r.user,B=f.CustomVideoPlaceholder;return B?B&&B(_extends({},r),null):React.createElement("div",{key:x.uid,style:_extends({},style.max,C)},React.createElement("div",{style:style.imgContainer},React.createElement("img",{style:style.img,src:"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9ImN1cnJlbnRDb2xvciIgc3Ryb2tlLXdpZHRoPSIyIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGNsYXNzPSJmZWF0aGVyIGZlYXRoZXItdXNlciI+PHBhdGggZD0iTTIwIDIxdi0yYTQgNCAwIDAgMC00LTRIOGE0IDQgMCAwIDAtNCA0djIiPjwvcGF0aD48Y2lyY2xlIGN4PSIxMiIgY3k9IjciIHI9IjQiPjwvY2lyY2xlPjwvc3ZnPg=="})),r.isShown&&React.createElement("div",{style:_extends({},style.btnContainer,P)},r.showButtons&&React.createElement(React.Fragment,null,!f.disableRtm&&React.createElement(RemoteVideoMute,{UIKitUser:x}),!f.disableRtm&&React.createElement(RemoteAudioMute,{UIKitUser:x}),r.showSwap&&React.createElement(SwapUser,{UIKitUser:x}))))},style={max:{flex:1,display:"flex",backgroundColor:"#007bff33",flexDirection:"row",position:"relative"},imgContainer:{flex:10,display:"flex",justifyContent:"center"},img:{width:100,height:100,position:"absolute",alignSelf:"center",justifySelf:"center",margin:"auto",display:"flex"},btnContainer:{position:"absolute",margin:5,flexDirection:"column",display:"flex"}},Username=function e(r){var s=reactExports.useContext(RtmContext),d=s.usernames,f=reactExports.useContext(PropsContext),_=f.rtmProps,C=f.styleProps,P=r.user;return _!=null&&_.displayUsername?React.createElement("p",{style:_extends({},styles$1.username,C==null?void 0:C.usernameText)},P.uid===1?"Screenshare":d[P.uid]):React.createElement(React.Fragment,null)},styles$1={username:{position:"absolute",background:"#007bffaa",padding:"2px 8px",color:"#fff",margin:0,bottom:0,right:0,zIndex:90}},MaxVideoView=function e(r){var s=reactExports.useContext(RtcContext),d=s.mediaStore,f=reactExports.useContext(PropsContext),_=f.styleProps,C=f.rtcProps,P=_||{},x=P.maxViewStyles,B=P.videoMode,_t=P.maxViewOverlayContainer,ue=B==null?void 0:B.max,Wt=reactExports.useState(!1),_n=Wt[0],_i=Wt[1],Ei=r.user;return React.createElement("div",{style:_extends({},styles$1$1.container,r.style,x),onMouseEnter:function(){return _i(!0)},onMouseLeave:function(){return _i(!1)}},Ei.hasVideo===1?React.createElement("div",{style:styles$1$1.videoContainer},!C.disableRtm&&React.createElement(Username,{user:Ei}),React.createElement(AgoraVideoPlayer,{style:styles$1$1.videoplayer,config:{fit:ue||"cover"},videoTrack:d[Ei.uid].videoTrack}),_n&&React.createElement("div",{style:_extends({},styles$1$1.overlay,_t)},!C.disableRtm&&React.createElement(RemoteVideoMute,{UIKitUser:Ei}),!C.disableRtm&&React.createElement(RemoteAudioMute,{UIKitUser:Ei}))):React.createElement("div",{style:styles$1$1.videoContainer},!C.disableRtm&&React.createElement(Username,{user:Ei}),React.createElement(VideoPlaceholder,{user:Ei,isShown:_n,showButtons:!0})))},styles$1$1={container:{display:"flex",flex:1},videoContainer:{display:"flex",flex:1,position:"relative"},videoplayer:{width:"100%",display:"flex",flex:1},overlay:{position:"absolute",margin:5,flexDirection:"column",display:"flex"},username:{position:"absolute",background:"#007bffaa",padding:"2px 8px",color:"#fff",margin:0,bottom:0,right:0,zIndex:90}},MinVideoView=function e(r){var s=reactExports.useContext(RtcContext),d=s.mediaStore,f=reactExports.useContext(PropsContext),_=f.styleProps,C=f.rtcProps,P=_||{},x=P.minViewStyles,B=P.videoMode,_t=P.minViewOverlayContainer,ue=B==null?void 0:B.min,Wt=reactExports.useState(!1),_n=Wt[0],_i=Wt[1],Ei=r.user;return React.createElement("div",{style:_extends({},{display:"flex",flex:1},x),onMouseEnter:function(){return _i(!0)},onMouseLeave:function(){return _i(!1)}},Ei.hasVideo===1?React.createElement("div",{style:_extends({},{display:"flex",flex:1,position:"relative"})},React.createElement(AgoraVideoPlayer,{style:{flex:10,display:"flex"},config:{fit:ue!==void 0?ue:"cover"},videoTrack:d[Ei.uid].videoTrack}),_n&&React.createElement("div",{style:_extends({},{margin:4,position:"absolute",flex:1,display:"flex",flexDirection:"column"},_t)},!C.disableRtm&&React.createElement(RemoteVideoMute,{UIKitUser:Ei}),!C.disableRtm&&React.createElement(RemoteAudioMute,{UIKitUser:Ei}),React.createElement(SwapUser,{UIKitUser:Ei}))):React.createElement(VideoPlaceholder,{user:Ei,isShown:_n,showButtons:!0,showSwap:!0}))},styles$2={test:"_3ybTi",scrollbar:"_3Sxu7"},PinnedVideo=function e(){var r=reactExports.useContext(PropsContext),s=r.styleProps,d=r.rtcProps,f=s||{},_=f.minViewContainer,C=f.pinnedVideoContainer,P=f.maxViewContainer,x=f.scrollViewContainer,B=reactExports.useRef(null),_t=reactExports.useState(0),ue=_t[0],Wt=_t[1],_n=reactExports.useState(0),_i=_n[0],Ei=_n[1],_a=ue>_i;return reactExports.useEffect(function(){var Di=function(){B.current&&(Wt(B.current.offsetWidth),Ei(B.current.offsetHeight))};return window.addEventListener("resize",Di),B.current&&(Wt(B.current.offsetWidth),Ei(B.current.offsetHeight)),function(){window.removeEventListener("resize",Di)}},[]),React.createElement("div",{ref:B,style:_extends({},{display:"flex",flex:1,flexDirection:_a?"row":"column-reverse",overflow:"hidden"},C)},React.createElement("div",{style:_extends({},{display:"flex",flex:_a?5:4},P)},React.createElement(MaxUidConsumer,null,function(Di){return d.role==="audience"&&Di[0].uid===0?null:React.createElement(MaxVideoView,{user:Di[0]})})),React.createElement("div",{className:styles$2.scrollbar,style:_extends({},{overflowY:_a?"scroll":"hidden",overflowX:_a?"hidden":"scroll",display:"flex",flex:1,flexDirection:_a?"column":"row"},x)},React.createElement(MinUidConsumer,null,function(Di){return Di.map(function(_o){return d.role==="audience"&&_o.uid===0?null:React.createElement("div",{style:_extends({},{minHeight:_a?"35vh":"99%",minWidth:_a?"99%":"40vw",margin:2,display:"flex"},_),key:_o.uid},React.createElement(MinVideoView,{user:_o}))})})))},GridVideo=function e(){var r=reactExports.useContext(PropsContext),s=r.styleProps,d=r.rtcProps,f=s||{},_=f.gridVideoCells,C=f.gridVideoContainer,P=reactExports.useContext(MaxUidContext),x=reactExports.useContext(MinUidContext),B=d.role==="audience"?[].concat(P,x).filter(function(_s){return _s.uid!==0}):[].concat(P,x),_t=reactExports.useRef(null),ue=reactExports.useState(window.innerWidth),Wt=ue[0],_n=ue[1],_i=reactExports.useState(window.innerHeight),Ei=_i[0],_a=_i[1],Di=Wt>Ei,_o="minmax(0, 1fr) ";return reactExports.useEffect(function(){var _s=function(){_t.current&&(_n(_t.current.offsetWidth),_a(_t.current.offsetHeight))};return window.addEventListener("resize",_s),_t.current&&(_n(_t.current.offsetWidth),_a(_t.current.offsetHeight)),function(){window.removeEventListener("resize",_s)}},[]),React.createElement("div",{ref:_t,style:_extends({},{width:"100%",height:"100%",display:"grid",gridTemplateColumns:Di?B.length>9?_o.repeat(4):B.length>4?_o.repeat(3):B.length>1?_o.repeat(2):_o:B.length>8?_o.repeat(3):B.length>2?_o.repeat(2):_o},C)},B.map(function(_s){return React.createElement(MaxVideoView,{user:_s,style:_extends({},{height:"100%",width:"100%"},_),key:_s.uid})}))},useTracks=createMicrophoneAndCameraTracks({encoderConfig:{}},{encoderConfig:{}}),TracksConfigure=function e(r){var s=reactExports.useState(!1),d=s[0],f=s[1],_=reactExports.useState(null),C=_[0],P=_[1],x=reactExports.useState(null),B=x[0],_t=x[1],ue=useTracks(),Wt=ue.ready,_n=ue.tracks,_i=ue.error,Ei=reactExports.useRef({});return reactExports.useEffect(function(){return _n!==null?(_t(_n[0]),P(_n[1]),Ei.current[0]={audioTrack:_n[0],videoTrack:_n[1]},f(!0)):_i&&(console.error(_i),f(!1)),function(){if(_n){var _a,Di;(_a=_n[0])===null||_a===void 0||_a.close(),(Di=_n[1])===null||Di===void 0||Di.close()}}},[Wt,_i]),React.createElement(TracksProvider,{value:{localVideoTrack:C,localAudioTrack:B}},d?r.children:null)},timeNow=function e(){return new Date().getTime()},useChannel=createLazyChannel(),useClient$1=createLazyClient(),RtmConfigure=function e(r){var s=reactExports.useContext(PropsContext),d=s.rtcProps,f=s.rtmProps,_=reactExports.useState(!1),C=_[0],P=_[1],x=useClient$1(d.appId),B=useChannel(x,d.channel),_t=reactExports.useRef(""),ue=reactExports.useRef(5),Wt=reactExports.useContext(LocalContext),_n=reactExports.useContext(PropsContext),_i=_n.rtmCallbacks,Ei=reactExports.useState({}),_a=Ei[0],Di=Ei[1],_o=reactExports.useState({}),_s=_o[0],_c=_o[1],_m=reactExports.useState({}),Qm=_m[0],tE=_m[1],aE=reactExports.useState(popUpStateEnum.closed),CE=aE[0],lE=aE[1],gE=reactExports.useState(rtmStatusEnum.offline),cE=gE[0],_E=gE[1],iE=reactExports.useContext(RtcContext),rE=iE.localUid,vf=iE.localAudioTrack,Fg=iE.localVideoTrack,_d=iE.dispatch,_f=iE.channelJoined,uE=function o_(){try{var LE=d.tokenUrl,R_=function(){if(LE){var KE=_catch(function(){return Promise.resolve(fetch(LE+"/rtm/"+((f==null?void 0:f.uid)||_t.current))).then(function(F_){return Promise.resolve(F_.json()).then(function(T0){var Mb=T0.rtmToken;return Promise.resolve(x.login({uid:(f==null?void 0:f.uid)||_t.current,token:Mb})).then(function(){ue.current=5})})})},function(){setTimeout(function(){try{return ue.current=ue.current+ue.current,o_(),Promise.resolve()}catch(F_){return Promise.reject(F_)}},ue.current*1e3)});if(KE&&KE.then)return KE.then(function(){})}else{var f_=_catch(function(){return Promise.resolve(x.login({uid:(f==null?void 0:f.uid)||_t.current,token:(f==null?void 0:f.token)||void 0})).then(function(){ue.current=5})},function(){setTimeout(function(){try{return ue.current=ue.current+ue.current,o_(),Promise.resolve()}catch(F_){return Promise.reject(F_)}},ue.current*1e3)});if(f_&&f_.then)return f_.then(function(){})}}();return Promise.resolve(R_&&R_.then?R_.then(function(){}):void 0)}catch(KE){return Promise.reject(KE)}},dE=function o_(){try{var LE=_catch(function(){return Promise.resolve(B.join()).then(function(){ue.current=5})},function(){setTimeout(function(){try{return ue.current=ue.current+ue.current,o_(),Promise.resolve()}catch(R_){return Promise.reject(R_)}},ue.current*1e3)});return Promise.resolve(LE&&LE.then?LE.then(function(){}):void 0)}catch(R_){return Promise.reject(R_)}},IE=function(){try{if(_E(rtmStatusEnum.initialising),d.uid?_t.current=String(d.uid):_t.current=String(timeNow()),x.on("ConnectionStateChanged",function(KE,f_){console.log(KE,f_)}),x.on("TokenExpired",function(){try{var KE=d.tokenUrl;console.log("token expired - renewing");var f_=function(){if(KE){var F_=_catch(function(){return Promise.resolve(fetch(KE+"/rtm/"+((f==null?void 0:f.uid)||_t.current))).then(function(T0){return Promise.resolve(T0.json()).then(function(Mb){var A0=Mb.rtmToken;return Promise.resolve(x.renewToken(A0)).then(function(){ue.current=5})})})},function(T0){console.error("TokenExpiredError",T0)});if(F_&&F_.then)return F_.then(function(){})}}();return Promise.resolve(f_&&f_.then?f_.then(function(){}):void 0)}catch(F_){return Promise.reject(F_)}}),x.on("MessageFromPeer",function(KE,f_){QE(KE,f_)}),B.on("ChannelMessage",function(KE,f_){QE(KE,f_)}),B.on("MemberJoined",function(KE){try{return Promise.resolve(s0(DE(),KE)).then(function(){})}catch(f_){return Promise.reject(f_)}}),B.on("MemberCountUpdated",function(KE){try{return console.log("RTM-MemberCountUpdated: ",KE),Promise.resolve()}catch(f_){return Promise.reject(f_)}}),_i!=null&&_i.channel?Object.keys(_i.channel).map(function(KE){_i.channel&&B.on(KE,_i.channel[KE])}):_i!=null&&_i.client&&Object.keys(_i.client).map(function(KE){_i.client&&x.on(KE,_i.client[KE])}),d.tokenUrl){var LE=d.tokenUrl,R_=d.uid;x.on("TokenExpired",function(){try{return console.log("token expired"),Promise.resolve(fetch(LE+"/rtm/"+(R_||0)+"/")).then(function(KE){return Promise.resolve(KE.json()).then(function(f_){var F_=f_.rtmToken;x.renewToken(F_)})})}catch(KE){return Promise.reject(KE)}})}return _E(rtmStatusEnum.loggingIn),Promise.resolve(uE()).then(function(){return _E(rtmStatusEnum.loggedIn),Promise.resolve(dE()).then(function(){_E(rtmStatusEnum.connected),_c(function(KE){return _extends({},KE,{0:f==null?void 0:f.username})}),M0(DE())})})}catch(KE){return Promise.reject(KE)}},DE=function(){return{messageType:"UserData",rtmId:(f==null?void 0:f.uid)||_t.current,rtcId:rE.current,username:f==null?void 0:f.username,role:d.role==="audience"?1:0,uikit:{platform:"web",framework:"react",version:"1.2.0"},agora:{rtm:AgoraRTM__default.VERSION,rtc:AgoraRTC__default.VERSION}}},GE=function(LE,R_,KE){var f_=(f==null?void 0:f.showPopUpBeforeRemoteMute)===!1,F_={messageType:"MuteRequest",device:LE,rtcId:R_,mute:KE,isForceful:f_},T0=_a[R_];f_&&!KE?console.log("cannot send force unmute request"):T0?s0(F_,T0):console.log("peer not found")},QE=function(LE,R_){var KE;if(LE.messageType==="RAW"?KE=parsePayload(LE.rawMessage):LE.messageType==="TEXT"&&(KE=JSON.parse(LE.text)),console.log(KE,R_),KE)switch(KE.messageType){case"UserData":a_(KE);break;case"MuteRequest":m0(KE);break;case"RtmDataRequest":switch(KE.type){case"ping":W0(R_);break;case"userData":mS(R_);break;default:console.log(R_)}break;default:console.log("unknown message content")}else console.log("unknown rtm message type")},a_=function(LE){Di(function(R_){var KE;return _extends({},R_,(KE={},KE[LE.rtcId]=LE.rtmId,KE))}),_c(function(R_){var KE;return _extends({},R_,(KE={},KE[LE.rtcId]=LE.username,KE))}),tE(function(R_){var KE;return _extends({},R_,(KE={},KE[LE.rtmId]=LE,KE))})},m0=function(LE){rE.current===LE.rtcId&&(LE.isForceful?LE.mute?LE.device===mutingDevice.microphone?vf&&muteAudio(Wt,_d,vf):LE.device===mutingDevice.camera&&Fg&&muteVideo(Wt,_d,Fg):console.error("cannot force unmute"):LE.device===mutingDevice.microphone?LE.mute?lE(popUpStateEnum.muteMic):lE(popUpStateEnum.unmuteMic):LE.device===mutingDevice.camera&&(LE.mute?lE(popUpStateEnum.muteCamera):lE(popUpStateEnum.unmuteCamera)))},W0=function(LE){s0({messageType:"RtmDataRequest",type:"pong"},LE)},mS=function(LE){s0(DE(),LE)},M0=function(LE){try{var R_=x.createMessage({text:JSON.stringify(LE),messageType:AgoraRTM__default.MessageType.TEXT}),KE=_catch(function(){return Promise.resolve(B.sendMessage(R_)).then(function(){})},function(f_){console.error(f_)});return Promise.resolve(KE&&KE.then?KE.then(function(){}):void 0)}catch(f_){return Promise.reject(f_)}},s0=function(LE,R_){try{var KE=x.createMessage({text:JSON.stringify(LE),messageType:AgoraRTM__default.MessageType.TEXT}),f_=_catch(function(){return Promise.resolve(x.sendMessageToPeer(KE,String(R_))).then(function(){})},function(F_){console.error(F_)});return Promise.resolve(f_&&f_.then?f_.then(function(){}):void 0)}catch(F_){return Promise.reject(F_)}},Y0=function(){try{return Promise.resolve(x.logout()).then(function(){return Promise.resolve(x.removeAllListeners()).then(function(){})})}catch(LE){return Promise.reject(LE)}};return reactExports.useEffect(function(){return _f&&(IE(),P(!0)),function(){_f&&Y0()}},[d.channel,d.appId,_f]),React.createElement(RtmProvider,{value:{rtmStatus:cE,sendPeerMessage:s0,sendChannelMessage:M0,sendMuteRequest:GE,rtmClient:x,uidMap:_a,usernames:_s,userDataMap:Qm,popUpState:CE,setPopUpState:lE}},C?r.children:React.createElement(React.Fragment,null))};new TextEncoder;var dec=new TextDecoder,parsePayload=function e(r){return JSON.parse(dec.decode(r))};function PopUp(){var e=reactExports.useContext(PropsContext),r=e.styleProps,s=reactExports.useContext(RtmContext),d=s.popUpState,f=s.setPopUpState,_=r||{},C=_.popUpContainer,P=reactExports.useContext(RtcContext),x=P.dispatch,B=P.localVideoTrack,_t=P.localAudioTrack,ue=reactExports.useContext(LocalContext);return d!==popUpStateEnum.closed?React.createElement("div",{style:_extends({},styles$3.container,C)},React.createElement("div",{style:{color:"#fff",fontSize:18,fontWeight:700}},d===popUpStateEnum.muteCamera||d===popUpStateEnum.muteMic?"Mute ":"Unmute ",d===popUpStateEnum.muteCamera||d===popUpStateEnum.unmuteCamera?"Camera":"Mic","?"),React.createElement("div",{style:{flexDirection:"row",display:"flex",width:"100%",justifyContent:"space-around"}},React.createElement("div",{onClick:function(){switch(d){case popUpStateEnum.muteCamera:ue.hasVideo&&B&&muteVideo(ue,x,B);break;case popUpStateEnum.muteMic:ue.hasAudio&&_t&&muteAudio(ue,x,_t);break;case popUpStateEnum.unmuteCamera:!ue.hasVideo&&B&&muteVideo(ue,x,B);break;case popUpStateEnum.unmuteMic:!ue.hasAudio&&_t&&muteAudio(ue,x,_t);break}f(popUpStateEnum.closed)},style:styles$3.button},"Confirm"),React.createElement("div",{style:styles$3.buttonClose,onClick:function(){return f(popUpStateEnum.closed)}},"Close"))):null}var styles$3={button:{color:"#fff",cursor:"pointer",borderWidth:2,borderStyle:"solid",borderColor:"#fff",padding:"2px 4px",borderRadius:4},buttonClose:{color:"#fff",cursor:"pointer",borderWidth:2,borderStyle:"solid",borderColor:"#fff",padding:"2px 4px",borderRadius:4},container:{backgroundColor:"#007bffaa",position:"absolute",width:240,height:80,top:"50%",left:"50%",transform:"translate(-50%, -50%)",zIndex:100,display:"flex",flexDirection:"column",justifyContent:"space-evenly",alignItems:"center"}},AgoraUIKit=function e(r){var s=r.styleProps,d=r.rtcProps,f=s||{},_=f.UIKitContainer;return React.createElement(PropsProvider,{value:r},React.createElement("div",{style:_extends({},style$1,_)},d.role==="audience"?React.createElement(VideocallUI,null):React.createElement(TracksConfigure,null,React.createElement(VideocallUI,null))))},VideocallUI=function e(){var r=reactExports.useContext(PropsContext),s=r.rtcProps;return React.createElement(RtcConfigure,{callActive:s.callActive},React.createElement(LocalUserContext,null,s.disableRtm?React.createElement(React.Fragment,null,(s==null?void 0:s.layout)===layout.grid?React.createElement(GridVideo,null):React.createElement(PinnedVideo,null),React.createElement(LocalControls,null)):React.createElement(RtmConfigure,null,React.createElement(PopUp,null),(s==null?void 0:s.layout)===layout.grid?React.createElement(GridVideo,null):React.createElement(PinnedVideo,null),React.createElement(LocalControls,null))))},style$1={display:"flex",flex:1,minHeight:0,flexDirection:"column"};const styles={container:{width:"100%",height:"100%",display:"flex",flex:1}},VideoCallScreen=({openVideoCall:e,handleOpenVideoCall:r,socket:s})=>{const d=useDispatch(),f=useSelector(ue=>ue.auth.user),_=useSelector(ue=>ue.chat.selectedChat),C=useSelector(ue=>ue.chat.joinedVideoRoom),[P,x]=reactExports.useState(!0),B=reactExports.useRef();reactExports.useEffect(()=>{if(s){const ue=()=>{Q.dismiss(),B.current&&clearTimeout(B.current),B.current=setTimeout(()=>{Q.error("Call timed out",TOAST_ACTION)},16e3)},Wt=_i=>{Q.dismiss(),clearTimeout(B.current),Q.error(`${_i} has cancelled the call`,TOAST_ACTION)},_n=()=>{Q.dismiss(),clearTimeout(B.current);const _i=_.users.filter(Ei=>Ei._id!==(f==null?void 0:f._id))[0].name;Q.success(`${_i} has accepted the call`,TOAST_ACTION)};return!C&&ue(),s.on("call-cancelled",Wt),s.on("call-answered",_n),()=>{clearTimeout(B.current),s.off("call-cancelled",Wt),s.off("call-answered",_n)}}},[s,_.users]);const _t={rtcProps:{appId:"297b2a58b58e43aaad41e5290c82b97d",channel:_._id,token:null,layout:layout.grid},callbacks:{EndCall:()=>{x(!1),C&&d(setJoinVideoRoom(!1)),r()}}};return jsxRuntimeExports.jsxs(react.Dialog,{open:e,size:"lg",handler:r,dismiss:{enabled:!1},animate:{mount:{scale:1,y:0},unmount:{scale:.9,y:-100}},children:[jsxRuntimeExports.jsx(k,{}),jsxRuntimeExports.jsx(react.DialogHeader,{className:"pb-0",children:jsxRuntimeExports.jsx("div",{className:"flex justify-between items-center w-full",children:jsxRuntimeExports.jsx("div",{className:"flex items-center justify-between gap-5 transition-transform duration-300 mx-1 px-2 pb-3 rounded-lg cursor-pointer hover:bg-gray-200 hover:scale-105",children:jsxRuntimeExports.jsxs("div",{className:"pt-2",children:[jsxRuntimeExports.jsx("h1",{className:"lg:text-2xl text-lg font-extrabold font-logo text-center text-socioverse-400 inline",children:"SOCIOVERSE"}),jsxRuntimeExports.jsx("h1",{className:"text-blue-gray-500 text-sm lg:text-base ",children:"Video Room"})]})})})}),jsxRuntimeExports.jsx(react.DialogBody,{className:"flex flex-col gap-4 lg:mx-4 lg:my-0 mx-2 max-h-[36rem] overflow-hidden no-scrollbar",children:jsxRuntimeExports.jsx("div",{style:styles.container,children:P?jsxRuntimeExports.jsx(AgoraUIKit,{rtcProps:_t.rtcProps,callbacks:_t.callbacks,styleProps:{localBtnContainer:{backgroundColor:"#ff764c",borderRadius:"2rem",margin:"0.5rem 0 0 0"},UIKitContainer:{width:"24rem",height:"24rem",gap:"1rem"},gridVideoContainer:{gap:"1rem"}}}):null})})]})},ChatBox=({socket:e,socketConnected:r})=>{const s=useSelector(ue=>ue.chat.selectedChat),d=useSelector(ue=>ue.chat.openVideoCall),f=useSelector(ue=>{var Wt;return(Wt=ue.auth.user)==null?void 0:Wt._id}),_=useSelector(ue=>ue.auth.user),C=useDispatch(),[P,x]=reactExports.useState(!1),B=()=>x(ue=>!ue),_t=()=>C(setOpenVideoCall(!d));return s?jsxRuntimeExports.jsxs(jsxRuntimeExports.Fragment,{children:[jsxRuntimeExports.jsxs("div",{className:"flex flex-col justify-between p-2 md:p-4 gap-4 md:gap-8 h-full w-full",children:[jsxRuntimeExports.jsxs("header",{className:"flex items-center justify-between",children:[s.isGroupChat?jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between gap-4",children:[jsxRuntimeExports.jsx("img",{className:"inline-block h-10 w-10 md:h-12 md:w-12 rounded-full",src:s.groupDp,alt:"group dp"}),jsxRuntimeExports.jsx("h1",{className:"font-medium text-lg md:text-2xl",children:s.chatName})]}):jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between gap-4",children:[jsxRuntimeExports.jsx("img",{className:"inline-block h-10 w-10 md:h-12 md:w-12 rounded-full",src:f&&getSender(f,s.users).dp?getSender(f,s.users).dp:CONSTANTS_COMMON.DEFAULT_IMG,alt:"dp"}),jsxRuntimeExports.jsx("h1",{className:"font-medium text-lg md:text-2xl",children:f&&getSender(f,s.users).name})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between gap-4",children:[jsxRuntimeExports.jsx("div",{className:`flex justify-center items-center h-7 w-7 md:w-9 md:h-9 rounded-full hover:bg-blue-gray-100 transition duration-100 
          ease-in-out group cursor-pointer border border-blue-gray-800 hover:border-2`,onClick:()=>C(setSelectedChat(null)),children:jsxRuntimeExports.jsx(FaArrowLeft,{className:"group-hover:text-blue-gray-800 md:text-xl font-bold text-blue-gray-500"})}),!s.isGroupChat&&jsxRuntimeExports.jsx("div",{className:`flex justify-center items-center h-7 w-7 md:w-9 md:h-9 transition duration-300 ease-in-out bg-blue-gray-100 rounded-full cursor-pointer border-2 border-blue-gray-500 
            hover:border-green-500 hover:bg-white hover:border-3 group`,onClick:()=>{e.emit("call-user",_,s),C(setOpenVideoCall(!0))},children:jsxRuntimeExports.jsx(MdVideoCall,{className:"text-xl text-socioverse-500  group-hover:text-green-500"})}),jsxRuntimeExports.jsx("div",{className:`flex justify-center items-center h-7 w-7 md:w-9 md:h-9 rounded-full hover:bg-blue-gray-100 transition duration-100 
          ease-in-out group cursor-pointer border border-blue-gray-800 hover:border-2`,onClick:B,children:jsxRuntimeExports.jsx(SlOptionsVertical,{className:"group-hover:text-blue-gray-800 md:text-xl font-bold text-blue-gray-500"})})]})]}),jsxRuntimeExports.jsx("div",{className:" h-full w-full flex flex-col gap-4 overflow-y-scroll no-scrollbar bg-blue-gray-300/50 rounded-xl",children:jsxRuntimeExports.jsx(ChatBoxContent,{socket:e,socketConnected:r})})]}),jsxRuntimeExports.jsx(OptionsDialog,{openOptions:P,handleOpenOptions:B,socket:e}),d&&jsxRuntimeExports.jsx(VideoCallScreen,{openVideoCall:d,handleOpenVideoCall:_t,socket:e})]}):jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children:jsxRuntimeExports.jsx("div",{className:"flex items-center justify-center h-full",children:jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center",children:[jsxRuntimeExports.jsx("img",{src:CONSTANTS_COMMON.CHAT_SVG,alt:"chat"}),jsxRuntimeExports.jsx("h1",{className:"font-semibold text-2xl text-blue-gray-700",children:"Click on a user to start chatting !"})]})})})},SideDrawer=({userId:e})=>{const[r,s]=reactExports.useState(!1),[d,f]=reactExports.useState(""),[_,C]=reactExports.useState([]),[P,x]=reactExports.useState(!1),B=useDispatch(),_t=useSelector(Ei=>Ei.chat.chats),ue=()=>{s(Ei=>!Ei)},Wt=async()=>{try{x(!0);const Ei=await searchUsers(d);x(!1),Ei.users.length===0&&(Q.dismiss(),Q.error("No user found",TOAST_ACTION)),C(Ei.users)}catch{Q.dismiss(),Q.error("Failed to load search results",TOAST_ACTION)}},_n=async Ei=>{try{const _a=await fetchOtherUserChat(Ei);_t.find(Di=>Di._id===_a.chat._id)||B(setChats([_a.chat,..._t])),B(setSelectedChat(_a.chat)),_i()}catch{Q.error("Error fetching the chat",TOAST_ACTION)}},_i=()=>{const Ei=document.getElementById("popover-button");Ei&&Ei.click()};return jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children:jsxRuntimeExports.jsxs(react.Popover,{placement:"bottom-end",dismiss:{enabled:!1},children:[jsxRuntimeExports.jsx(react.PopoverHandler,{onClick:ue,children:jsxRuntimeExports.jsx("div",{id:"popover-button",className:classnames("flex justify-center items-center w-9 h-9 rounded-full hover:bg-blue-gray-100 transition duration-100 ease-in-out group cursor-pointer border border-blue-gray-800 hover:border-2",{"bg-blue-gray-100 border-2":r},{"bg-white border":!r}),children:jsxRuntimeExports.jsx(BiSearchAlt,{className:classnames("group-hover:text-blue-gray-800 text-2xl font-bold",{"text-blue-gray-800":r},{"text-blue-gray-500":!r})})})}),jsxRuntimeExports.jsx(react.PopoverContent,{className:"max-h-[70vh] lg:max-h-[75vh] bg-gray-400 w-[20rem] overflow-y-scroll no-scrollbar",children:jsxRuntimeExports.jsxs("div",{className:"p-5 bg-white rounded-lg h-full w-full",children:[jsxRuntimeExports.jsxs("div",{className:classnames("relative flex w-full",{"mb-4":_.length>0},{"mb-0":_.length===0}),children:[jsxRuntimeExports.jsx(react.Input,{type:"text",label:"Search User",value:d,onChange:Ei=>f(Ei.target.value),className:"pr-20",containerProps:{className:"min-w-0"}}),jsxRuntimeExports.jsx(react.Button,{size:"sm",disabled:!d.trim(),className:classnames("!absolute right-1 top-1 rounded",{"bg-socioverse-400":d},{"bg-blue-gray-300":!d}),onClick:Wt,children:"Search"})]}),P?jsxRuntimeExports.jsx("div",{className:"overflow-y-hidden flex flex-col gap-4",children:Array(5).fill(0).map((Ei,_a)=>jsxRuntimeExports.jsx(ChatLoading,{},_a))}):_.map(Ei=>Ei._id!==e&&jsxRuntimeExports.jsx("div",{className:`flex w-60 px-4 py-2 mb-5 items-center justify-between transition duration-100 
                  ease-in-out rounded-lg shadow-md hover:scale-105 hover:rounded-lg cursor-pointer bg-[#E8E8E8] hover:bg-blue-gray-600 group`,onClick:()=>_n(Ei._id),children:jsxRuntimeExports.jsxs("div",{className:"s) => setLimt-3 flex items-center space-x-2",children:[jsxRuntimeExports.jsx("img",{className:"inline-block h-12 w-12 rounded-full",src:Ei.dp?Ei.dp:CONSTANTS_COMMON.DEFAULT_IMG,alt:"user dp"}),jsxRuntimeExports.jsxs("span",{className:"flex flex-col",children:[jsxRuntimeExports.jsx("span",{className:"text-[14px] font-medium text-gray-900 group-hover:text-white group-hover:font-bold",children:Ei.name}),jsxRuntimeExports.jsxs("span",{className:"text-[11px] font-medium text-gray-500 group-hover:text-white group-hover:font-bold",children:["@",Ei.username]})]})]})},Ei._id))]})})]})})};function CreateGroupDialog({openCreateGroupDialog:e,handleCreateGroupDialog:r,socket:s}){const d=useDispatch(),f=useSelector(aE=>{var CE;return(CE=aE.auth.user)==null?void 0:CE._id}),[_,C]=reactExports.useState(new FormData),[P,x]=reactExports.useState(""),[B,_t]=reactExports.useState([]),[ue,Wt]=reactExports.useState(""),[_n,_i]=reactExports.useState([]),[Ei,_a]=reactExports.useState(!1),Di=useSelector(aE=>aE.chat.chats),[_o,_s]=reactExports.useState();reactExports.useEffect(()=>{let aE;const CE=async()=>{try{_a(!0);const lE=await searchUsers(ue);_a(!1),_i(lE.users)}catch(lE){console.log(lE),Q.dismiss(),Q.error("Failed to load search results",TOAST_ACTION)}};return ue.length>0&&(aE=setTimeout(CE,500)),()=>{clearTimeout(aE)}},[ue]);const _c=aE=>{if(B.includes(aE)){Q.dismiss(),Q.warn("User already added",TOAST_ACTION);return}_t([...B,aE])},_m=aE=>{_t(B.filter(CE=>CE!==aE))},Qm=async()=>{if(!P.trim()||!B){Q.dismiss(),Q.warn("Please fill all the fields",TOAST_ACTION);return}try{_o&&_.append("groupDp",_o);const aE=await createGroupChat(P,B);if(_o){const CE=await addGroupDp(aE.groupChat._id,_);d(setChats([CE.groupChat,...Di])),s.emit("group updation",CE.groupChat)}else d(setChats([aE.groupChat,...Di])),s.emit("group updation",aE.groupChat);Q.dismiss(),Q.success("Group created successfully",TOAST_ACTION),_s(void 0),C(new FormData),x(""),_t([]),r()}catch{Q.dismiss(),Q.error("Error in creating group chat",TOAST_ACTION)}},tE=aE=>{aE.target.files&&aE.target.files.length>0&&_s(aE.target.files[0])};return jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children:jsxRuntimeExports.jsxs(react.Dialog,{size:"xs",dismiss:{enabled:!1},open:e,handler:r,className:"bg-transparent shadow-none max-h-[90vh] overflow-y-scroll no-scrollbar",children:[jsxRuntimeExports.jsx(k,{}),jsxRuntimeExports.jsxs(react.Card,{className:"mx-auto w-full ",children:[jsxRuntimeExports.jsxs(react.CardBody,{className:"flex flex-col gap-4",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between",children:[jsxRuntimeExports.jsx(react.Typography,{variant:"h4",color:"blue-gray",children:"Create Group"}),jsxRuntimeExports.jsx(AiOutlineCloseCircle,{className:"text-3xl cursor-pointer text-black",onClick:aE=>{aE.stopPropagation(),_s(void 0),_t([]),r()}})]}),jsxRuntimeExports.jsx(react.Typography,{className:"-mb-2",variant:"h6",children:"Add Image"}),jsxRuntimeExports.jsxs("div",{className:"mx-auto",children:[jsxRuntimeExports.jsx("input",{type:"file",accept:"image/*",id:"group-image",className:"hidden",onChange:tE}),jsxRuntimeExports.jsx("label",{htmlFor:"group-image",children:jsxRuntimeExports.jsx("img",{src:_o instanceof File?URL.createObjectURL(_o):_o||CONSTANTS_COMMON.DEFAULT_IMG,className:"h-36 w-36 rounded-full border-4 border-gray-500 border-dashed bg-white m-2 flex items-center justify-center cursor-pointer p-2"})})]}),jsxRuntimeExports.jsx(react.Typography,{className:"-mb-2",variant:"h6",children:"Group Name"}),jsxRuntimeExports.jsx(react.Input,{label:"Enter the name",size:"lg",onChange:aE=>x(aE.target.value)}),jsxRuntimeExports.jsx(react.Typography,{className:"-mb-2",variant:"h6",children:"Add Members"}),jsxRuntimeExports.jsx(react.Input,{label:"Enter the members",size:"lg",onChange:aE=>Wt(aE.target.value)}),jsxRuntimeExports.jsx("div",{className:"max-h-36 overflow-y-scroll flex items-center justify-center flex-wrap gap-2 no-scrollbar",children:B.map(aE=>jsxRuntimeExports.jsx("div",{children:jsxRuntimeExports.jsx(react.Chip,{variant:"ghost",animate:{mount:{y:0},unmount:{y:50}},value:aE.name,onClose:()=>_m(aE),className:"rounded-full",color:"green"})},aE._id))}),Ei?jsxRuntimeExports.jsx("div",{className:"overflow-y-hidden flex flex-col gap-4",children:Array(3).fill(0).map((aE,CE)=>jsxRuntimeExports.jsx(ChatLoading,{},CE))}):jsxRuntimeExports.jsx("div",{className:"max-h-64 overflow-y-scroll overflow-x-hidden no-scrollbar mx-4",children:_n==null?void 0:_n.slice(0,4).map(aE=>aE._id!==f&&jsxRuntimeExports.jsx("div",{className:`flex w-full px-4 py-2 mb-5 items-center justify-between transition duration-100 
                                    ease-in-out rounded-lg shadow-md hover:scale-95 hover:rounded-lg cursor-pointer 
                                    bg-[#E8E8E8] hover:bg-blue-gray-600 group`,onClick:()=>_c(aE),children:jsxRuntimeExports.jsxs("div",{className:"s) => setLimt-3 flex items-center space-x-2",children:[jsxRuntimeExports.jsx("img",{className:"inline-block h-12 w-12 rounded-full",src:aE.dp?aE.dp:CONSTANTS_COMMON.DEFAULT_IMG,alt:"user dp"}),jsxRuntimeExports.jsxs("span",{className:"flex flex-col",children:[jsxRuntimeExports.jsx("span",{className:"text-[14px] font-medium text-gray-900 group-hover:text-white group-hover:font-bold",children:aE.name}),jsxRuntimeExports.jsxs("span",{className:"text-[11px] font-medium text-gray-500 group-hover:text-white group-hover:font-bold",children:["@",aE.username]})]})]})},aE._id))})]}),jsxRuntimeExports.jsx(react.CardFooter,{className:"pt-0",children:jsxRuntimeExports.jsx(react.Button,{onClick:Qm,className:"float-right bg-socioverse-400 rounded-full",children:"Create Chat"})})]})]})})}const MyChats=({userId:e,socket:r})=>{const s=useDispatch(),d=useSelector(ue=>ue.chat.chats),f=useSelector(ue=>ue.chat.selectedChat),_=useSelector(ue=>ue.chat.fetchUserChatsAgain),[C,P]=reactExports.useState(!1),x=()=>P(ue=>!ue);reactExports.useEffect(()=>{B(),_&&s(setFetchUserChatsAgain(!1))},[_]),reactExports.useEffect(()=>{r&&r.on("group updated",()=>{B()})});const B=async()=>{try{const ue=await fetchChats();s(setChats(ue.chats))}catch{Q.dismiss(),Q.error("Error fetching chats",TOAST_ACTION)}},_t=ue=>{s(setSelectedChat(ue))};return jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children:jsxRuntimeExports.jsxs("div",{className:"flex flex-col justify-between p-4 gap-8 h-full",children:[jsxRuntimeExports.jsxs("header",{className:"flex items-center justify-between",children:[jsxRuntimeExports.jsx("h1",{className:"font-bold text-2xl",children:"My Chats"}),jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between gap-3",children:[jsxRuntimeExports.jsxs(react.Button,{className:"flex items-center justify-between rounded-full bg-socioverse-400 gap-1",size:"sm",onClick:x,children:[jsxRuntimeExports.jsx("h1",{children:"Add Group"}),jsxRuntimeExports.jsx(AiOutlinePlusCircle,{className:"font-extrabold text-lg"})]}),jsxRuntimeExports.jsx(CreateGroupDialog,{openCreateGroupDialog:C,handleCreateGroupDialog:x,socket:r}),jsxRuntimeExports.jsx(SideDrawer,{userId:e})]})]}),jsxRuntimeExports.jsx("div",{className:"flex flex-col gap-4 h-full overflow-y-scroll no-scrollbar ",children:d.length===0?jsxRuntimeExports.jsx("div",{className:"overflow-y-hidden flex flex-col gap-4 w-full",children:Array(6).fill(0).map((ue,Wt)=>jsxRuntimeExports.jsx(ChatLoading,{},Wt))}):d.map(ue=>jsxRuntimeExports.jsx("div",{className:classnames("flex items-center justify-between py-2 px-2 md:px-4 rounded-xl cursor-pointer shadow-sm hover:bg-blue-gray-600  group",{"bg-blue-gray-600/90 ":(f==null?void 0:f._id)===ue._id},{"bg-gray-100":(f==null?void 0:f._id)!==ue._id}),onClick:()=>_t(ue),children:ue.isGroupChat?jsxRuntimeExports.jsxs("div",{className:"s) => setLimt-3 flex items-center space-x-2 ",children:[jsxRuntimeExports.jsx("img",{className:"inline-block h-12 w-12 rounded-full",src:ue.groupDp,alt:"group dp"}),jsxRuntimeExports.jsxs("span",{className:"flex flex-col",children:[jsxRuntimeExports.jsx("span",{className:classnames("text-[14px] group-hover:font-bold group-hover:text-white",{"text-white font-bold":(f==null?void 0:f._id)===ue._id},{"text-gray-900 font-medium":(f==null?void 0:f._id)!==ue._id}),children:ue.chatName}),jsxRuntimeExports.jsx("span",{className:classnames("text-[11px] group-hover:font-bold group-hover:text-white",{"text-white font-bold":(f==null?void 0:f._id)===ue._id},{"text-gray-500 font-medium":(f==null?void 0:f._id)!==ue._id}),children:ue.latestMessage?jsxRuntimeExports.jsx(jsxRuntimeExports.Fragment,{children:ue.latestMessage.image?"ðŸ“·":truncate(ue.latestMessage.content,20)}):" no message"})]})]}):jsxRuntimeExports.jsxs("div",{className:"s) => setLimt-3 flex items-center space-x-2 ",children:[jsxRuntimeExports.jsx("img",{className:"inline-block h-12 w-12 rounded-full",src:getSender(e,ue.users).dp?getSender(e,ue.users).dp:CONSTANTS_COMMON.DEFAULT_IMG,alt:"dp"}),jsxRuntimeExports.jsxs("span",{className:"flex flex-col",children:[jsxRuntimeExports.jsx("span",{className:classnames("text-[14px] group-hover:font-bold group-hover:text-white",{"text-white font-bold":(f==null?void 0:f._id)===ue._id},{"text-gray-900 font-medium":(f==null?void 0:f._id)!==ue._id}),children:getSender(e,ue.users).name}),jsxRuntimeExports.jsx("span",{className:classnames("text-[11px] group-hover:font-bold group-hover:text-white",{"text-white font-bold":(f==null?void 0:f._id)===ue._id},{"text-gray-500 font-medium":(f==null?void 0:f._id)!==ue._id}),children:ue.latestMessage?ue.latestMessage.image?"ðŸ“·":truncate(ue.latestMessage.content,20):" no message"})]})]})},ue._id))})]})})},ChatPage=({socket:e,socketConnected:r})=>{const s=useSelector(P=>P.auth.user),d=useSelector(P=>P.chat.selectedChat),f=useNavigate(),_=useDispatch();reactExports.useEffect(()=>{s||C()||f("/error")},[s]),reactExports.useEffect(()=>()=>{location.pathname!=="/message"&&_(setSelectedChat(null))},[]);const C=async()=>{try{const{user:P}=await getUserInfo(),{accessToken:x}=store.getState().auth;return _(setCredentials({user:P,accessToken:x})),P}catch(P){if(isAxiosError(P)){const x=P;x.response&&x.response.status>=400&&x.response.status<=500&&f("/login")}}};return jsxRuntimeExports.jsxs("div",{className:"w-full h-[80vh] lg:h-[85vh] ",children:[jsxRuntimeExports.jsx(k,{}),jsxRuntimeExports.jsxs("div",{className:"flex justify-between items-center w-full h-full p-2 gap-5",children:[jsxRuntimeExports.jsx("div",{className:classnames("md:block md:w-4/12 h-full bg-white border border-blue-gray-500 rounded-xl",{"w-full":!d},{hidden:d}),children:jsxRuntimeExports.jsx(MyChats,{userId:s&&s._id,socket:e})}),jsxRuntimeExports.jsx("div",{className:classnames("md:block md:w-8/12 h-full bg-white border border-blue-gray-500 rounded-xl",{"w-full block":d},{hidden:!d}),children:jsxRuntimeExports.jsx(ChatBox,{socket:e,socketConnected:r})})]})]})};export{ChatPage as default};
