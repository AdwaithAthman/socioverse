import{u as H,r as n,a as O,g as te,b as ae,j as e,k as E,H as ge,L as B,C as A,R as ne,c as l,A as V,d as J,s as X,e as Y,f as pe,Q as w,T as M,h as fe,i as je,l as ve,m as be,n as Z,o as Q,p as we,M as le,q as re,B as G,t as W,v as oe,w as Ne,G as ye,x as ke,y as Ce,z as Se,D as _e,E as ie,F as Ue,I as Ie,J as De,K as Fe,N as Me,O as Ae,P as Le,S as Be,U as me,V as ce,W as Oe,X as Te,Y as Ee}from"./index-f946f455.js";import{T as de}from"./index.esm-57e7230c.js";import{f as xe}from"./index-fece1ea8.js";import{u as He,I as Ve}from"./ImageCropper-e8994465.js";function ze({handleFollowingAdd:c,handleFollowingRemove:f}){const g=H(t=>{var d;return(d=t==null?void 0:t.auth)==null?void 0:d.user}),[h,j]=n.useState(null),[a,p]=n.useState(),[u,o]=n.useState([]),[b,x]=n.useState(!1),S=()=>x(!b),y=O();n.useEffect(()=>{const t=async()=>{if(!g){const r=await d();j(r)}},d=async()=>{const{user:r}=await J(),{accessToken:m}=X.getState().auth;return y(Y({user:r,accessToken:m})),r};t(),te().then(r=>{r.suggestions.length===0?ae().then(m=>o(m.users)):o(r.suggestions)})},[]),n.useEffect(()=>{g&&p(g.following)},[g]);const _=(t,d)=>{pe(t).then(()=>{c(!0),w.dismiss(),w.success(`Following ${d}`,{...M,position:"bottom-left"})}),!(a!=null&&a.includes(t))&&p([...a,t]),y(fe(t))},U=(t,d)=>{je(t).then(()=>{f(!0),w.dismiss(),w.success(`Unfollowed ${d}`,{...M,position:"bottom-left"})}),p(a==null?void 0:a.filter(r=>r!==t)),y(ve(t))},k=()=>{te().then(t=>{t.suggestions.length===0?ae().then(d=>o(d.users)):o(t.suggestions)})};return e.jsxs(e.Fragment,{children:[e.jsx(E,{}),e.jsx("div",{className:"flex max-w-2xl flex-col rounded-lg border shadow-lg p-2",children:e.jsx("div",{children:e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"text-2xl",children:e.jsx(ge,{})}),e.jsx("h1",{className:"inline-flex items-center text-lg font-semibold",children:"People you may know"})]}),e.jsx("div",{className:"flex flex-col gap-2 ",children:u.slice(0,5).map(t=>{var d,r;return e.jsxs("div",{className:"flex p-2 items-center justify-between transition duration-100 ease-in-out hover:shadow-md hover:scale-105 hover:rounded-lg",children:[e.jsx(B,{to:`/profile/${t._id}`,children:e.jsxs("div",{className:"s) => setLimt-3 flex items-center space-x-2",children:[e.jsx("img",{className:"inline-block h-12 w-12 rounded-full",src:t.dp?t.dp:A.DEFAULT_IMG,alt:"user dp"}),e.jsxs("span",{className:"flex flex-col",children:[e.jsx("span",{className:"text-[14px] font-medium text-gray-900",children:t==null?void 0:t.name}),e.jsx("span",{className:"text-[11px] font-medium text-gray-500",children:t.username?`@${t.username}`:"@ -"})]})]})}),a!=null&&a.includes(t._id)||g&&((d=t.followers)!=null&&d.includes(g._id))||h&&((r=t.followers)!=null&&r.includes(h._id))?e.jsx("div",{className:"flex justify-center items-center w-8 h-8 transition duration-300 ease-in-out bg-blue-gray-500 rounded-full cursor-pointer border-2 border-blue-gray-700 hover:border-red-700 hover:bg-white hover:border-3 group",onClick:()=>U(t._id,t.name),children:e.jsx(ne,{className:"text-xl text-white group-hover:text-red-500"})}):e.jsx("div",{className:"flex justify-center items-center w-8 h-8 transition duration-300 ease-in-out bg-blue-gray-100 rounded-full cursor-pointer border-2 border-blue-gray-500 hover:bg-white hover:border-3 group",onClick:()=>_(t._id,t.name),children:e.jsx(de,{className:"text-xl text-socioverse-500 group-hover:text-blue-gray-500"})})]},t._id)})}),e.jsx("div",{className:"inline-block",children:e.jsxs(l.Button,{variant:"text",className:"flex items-center gap-2 text-black capitalize shadow-none text-sm font-semibold",onClick:()=>{k(),S()},disabled:u.length<=5,children:["View More",e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"h-4 w-4",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M17.25 8.25L21 12m0 0l-3.75 3.75M21 12H3"})})]})})]})})})}),e.jsxs(l.Dialog,{open:b,size:"xs",handler:S,animate:{mount:{scale:1,y:0},unmount:{scale:.9,y:-100}},children:[e.jsx(l.DialogHeader,{children:e.jsxs("div",{className:"flex justify-between items-center w-full",children:[e.jsx("h1",{className:"text-xl font-semibold",children:"People you may know"}),e.jsx("div",{children:e.jsx(V,{className:"text-3xl cursor-pointer",onClick:S})})]})}),e.jsx(E,{}),e.jsx(l.DialogBody,{className:"flex flex-col gap-4 lg:mx-4 lg:my-0 m-2 max-h-[20.5rem] overflow-y-scroll",children:e.jsx("div",{className:"flex flex-col gap-2 ",children:u.map(t=>{var d,r;return e.jsxs("div",{className:"flex p-2 items-center justify-between transition duration-100 ease-in-out hover:shadow-md hover:scale-105 hover:rounded-lg",children:[e.jsx(B,{to:`/profile/${t._id}`,children:e.jsxs("div",{className:"mt-3 flex items-center space-x-2",children:[e.jsx("img",{className:"inline-block h-12 w-12 rounded-full",src:t.dp?t.dp:A.DEFAULT_IMG,alt:"user dp"}),e.jsxs("span",{className:"flex flex-col",children:[e.jsx("span",{className:"text-[14px] font-medium text-gray-900",children:t==null?void 0:t.name}),e.jsx("span",{className:"text-[11px] font-medium text-gray-500",children:t.username?`@${t.username}`:"@ -"})]})]})}),a!=null&&a.includes(t._id)||g&&((d=t.followers)!=null&&d.includes(g._id))||h&&((r=t.followers)!=null&&r.includes(h._id))?e.jsx("div",{className:"flex justify-center items-center w-8 h-8 transition duration-300 ease-in-out bg-blue-gray-500 rounded-full cursor-pointer border-2 border-blue-gray-700 hover:border-red-700 hover:bg-white hover:border-3 group",onClick:()=>U(t._id,t.name),children:e.jsx(ne,{className:"text-xl text-white group-hover:text-red-500"})}):e.jsx("div",{className:"flex justify-center items-center w-8 h-8 transition duration-300 ease-in-out bg-blue-gray-100 rounded-full cursor-pointer border-2 border-blue-gray-500 hover:bg-white hover:border-3 group",onClick:()=>_(t._id,t.name),children:e.jsx(de,{className:"text-xl text-socioverse-500 group-hover:text-blue-gray-500"})})]},t._id)})})}),e.jsx(l.DialogFooter,{children:void 0})]})]})}function $e({newFollowing:c,handleFollowingAdd:f,removeFollowing:g,handleFollowingRemove:h,socket:j}){const a=O(),p=be(),u=Z(),[o,b]=n.useState([]),[x,S]=n.useState([]),[y,_]=n.useState(!1),[U,k]=n.useState(!1),t=()=>_(!y),d=()=>k(!U),r=H(s=>s.auth.user);n.useEffect(()=>{r&&(Q(r._id).then(s=>{b(s.following)}),we(r._id).then(s=>{S(s.followers)}))},[r]);const[m,L]=n.useState(1),T=s=>L(m===s?0:s);c&&(r&&Q(r._id).then(s=>{b(s.following)}),f(!1)),g&&(r&&Q(r._id).then(s=>{b(s.following)}),h(!1));const C=async s=>{const I=await xe(s);a(oe(I.chat)),p.pathname!=="/message"&&u("/message")},F=async s=>{const I=await xe(s);a(oe(I.chat)),j&&j.emit("call-user",r,I.chat),a(Ne(!0)),p.pathname!=="/message"&&u("/message")};return e.jsxs(e.Fragment,{children:[e.jsxs(l.Accordion,{open:m===2,className:"mb-5 rounded-lg border px-2 shadow-lg",children:[e.jsxs("div",{onClick:()=>T(2),className:`border-b-0 transition-colors flex items-center justify-between p-4 cursor-pointer 
          `,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h1",{className:"text-lg font-semibold",children:"Followers"}),e.jsx(l.Chip,{value:x==null?void 0:x.length,size:"sm",variant:"ghost",color:"blue-gray",className:"rounded-full"})]}),e.jsx("div",{className:"text-2xl",children:m===2?e.jsx(le,{}):e.jsx(re,{})})]}),e.jsx(l.AccordionBody,{className:"pt-0 text-base font-normal",children:e.jsxs("div",{className:"flex flex-col gap-4 px-4",children:[e.jsx("div",{className:"flex flex-col gap-2 ",children:x!=null&&x.length&&x?x.slice(0,5).map((s,I)=>e.jsxs("div",{className:"flex p-2 items-center justify-between transition duration-100 ease-in-out rounded-lg hover:shadow-md hover:scale-105 hover:rounded-lg",children:[e.jsx(B,{to:`/profile/${s._id}`,children:e.jsxs("div",{className:"mt-3 flex items-center space-x-2",children:[e.jsx("img",{className:"inline-block h-12 w-12 rounded-full",src:s.dp?s.dp:A.DEFAULT_IMG,alt:"user dp"}),e.jsxs("span",{className:"flex flex-col",children:[e.jsx("span",{className:"text-[14px] font-medium text-gray-900",children:s.name}),e.jsxs("span",{className:"text-[11px] font-medium text-gray-500",children:["@",s.username]})]})]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex justify-center items-center w-8 h-8 transition duration-300 ease-in-out bg-blue-gray-100 rounded-full cursor-pointer border-2 border-blue-gray-500 hover:border-green-500 hover:bg-white hover:border-3 group",onClick:()=>C(s._id),children:e.jsx(G,{className:"text-md text-socioverse-500 group-hover:text-green-500"})}),e.jsx("div",{className:"flex justify-center items-center w-8 h-8 transition duration-300 ease-in-out bg-blue-gray-100 rounded-full cursor-pointer border-2 border-blue-gray-500 hover:border-green-500 hover:bg-white hover:border-3 group",onClick:()=>F(s._id),children:e.jsx(W,{className:"text-xl text-socioverse-500  group-hover:text-green-500"})})]})]},I)):e.jsx("div",{children:"No followers"})}),x!=null&&x.length?e.jsx("div",{className:"inline-block",children:e.jsxs(l.Button,{variant:"text",className:"flex items-center gap-2 text-black capitalize shadow-none text-sm font-semibold",onClick:t,disabled:(x==null?void 0:x.length)<6,children:["View All",e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"h-4 w-4",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M17.25 8.25L21 12m0 0l-3.75 3.75M21 12H3"})})]})}):""]})})]}),e.jsxs(l.Accordion,{open:m===3,className:"mb-5 rounded-lg border px-2 shadow-lg",children:[e.jsxs("div",{onClick:()=>T(3),className:`border-b-0 transition-colors flex items-center justify-between p-4 cursor-pointer 
          `,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h1",{className:"text-lg font-semibold",children:"Following"}),e.jsx(l.Chip,{value:o==null?void 0:o.length,size:"sm",variant:"ghost",color:"blue-gray",className:"rounded-full"})]}),e.jsx("div",{className:"text-2xl",children:m===3?e.jsx(le,{}):e.jsx(re,{})})]}),e.jsx(l.AccordionBody,{className:"pt-0 text-base font-normal",children:e.jsxs("div",{className:"flex flex-col gap-4 px-4",children:[e.jsx("div",{className:"flex flex-col gap-2 ",children:o!=null&&o.length&&o?o.slice(0,5).map(s=>e.jsxs("div",{className:"flex p-2 items-center justify-between transition duration-100 ease-in-out hover:shadow-md hover:scale-105 hover:rounded-lg",children:[e.jsx(B,{to:`/profile/${s._id}`,children:e.jsxs("div",{className:"mt-3 flex items-center space-x-2",children:[e.jsx("img",{className:"inline-block h-12 w-12 rounded-full",src:s.dp?s.dp:A.DEFAULT_IMG,alt:"user dp"}),e.jsxs("span",{className:"flex flex-col",children:[e.jsx("span",{className:"text-[14px] font-medium text-gray-900",children:s.name}),e.jsxs("span",{className:"text-[11px] font-medium text-gray-500",children:["@",s.username]})]})]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex justify-center items-center w-8 h-8 transition duration-300 ease-in-out bg-blue-gray-100 rounded-full cursor-pointer border-2 border-blue-gray-500 hover:border-green-500 hover:bg-white hover:border-3 group",children:e.jsx(G,{className:"text-md text-socioverse-500 group-hover:text-green-500",onClick:()=>C(s._id)})}),e.jsx("div",{className:"flex justify-center items-center w-8 h-8 transition duration-300 ease-in-out bg-blue-gray-100 rounded-full cursor-pointer border-2 border-blue-gray-500 hover:border-green-500 hover:bg-white hover:border-3 group",onClick:()=>F(s._id),children:e.jsx(W,{className:"text-xl text-socioverse-500  group-hover:text-green-500"})})]})]},s._id)):e.jsx("div",{children:"No following"})}),o!=null&&o.length?e.jsx("div",{className:"inline-block",children:e.jsxs(l.Button,{variant:"text",className:"flex items-center gap-2 text-black capitalize shadow-none text-sm font-semibold",onClick:d,disabled:(o==null?void 0:o.length)<6,children:["View All",e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:2,stroke:"currentColor",className:"h-4 w-4",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M17.25 8.25L21 12m0 0l-3.75 3.75M21 12H3"})})]})}):""]})})]}),e.jsxs(l.Dialog,{open:y,size:"xs",handler:t,animate:{mount:{scale:1,y:0},unmount:{scale:.9,y:-100}},children:[e.jsx(l.DialogHeader,{children:e.jsxs("div",{className:"flex justify-between items-center w-full",children:[e.jsx("h1",{className:"text-xl font-semibold",children:"Followers List"}),e.jsx("div",{children:e.jsx(V,{className:"text-3xl cursor-pointer",onClick:t})})]})}),e.jsx(E,{}),e.jsx(l.DialogBody,{className:"flex flex-col gap-4 lg:mx-4 lg:my-0 m-2 max-h-[20.5rem] overflow-y-scroll",children:e.jsx("div",{className:"flex flex-col gap-2 ",children:x.map(s=>e.jsxs("div",{className:"flex p-2 items-center justify-between transition duration-100 ease-in-out hover:shadow-md hover:scale-105 hover:rounded-lg",children:[e.jsx(B,{to:`/profile/${s._id}`,children:e.jsxs("div",{className:"mt-3 flex items-center space-x-2",children:[e.jsx("img",{className:"inline-block h-12 w-12 rounded-full",src:s.dp?s.dp:A.DEFAULT_IMG,alt:"user dp"}),e.jsxs("span",{className:"flex flex-col",children:[e.jsx("span",{className:"text-[14px] font-medium text-gray-900",children:s==null?void 0:s.name}),e.jsx("span",{className:"text-[11px] font-medium text-gray-500",children:s.username?`@${s.username}`:"@ -"})]})]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex justify-center items-center w-8 h-8 transition duration-300 ease-in-out bg-blue-gray-100 rounded-full cursor-pointer border-2 border-blue-gray-500 hover:border-green-500 hover:bg-white hover:border-3 group",onClick:()=>C(s._id),children:e.jsx(G,{className:"text-md text-socioverse-500 group-hover:text-green-500"})}),e.jsx("div",{className:"flex justify-center items-center w-8 h-8 transition duration-300 ease-in-out bg-blue-gray-100 rounded-full cursor-pointer border-2 border-blue-gray-500 hover:border-green-500 hover:bg-white hover:border-3 group",onClick:()=>F(s._id),children:e.jsx(W,{className:"text-xl text-socioverse-500  group-hover:text-green-500"})})]})]},s._id))})}),e.jsx(l.DialogFooter,{children:void 0})]}),e.jsxs(l.Dialog,{open:U,size:"xs",handler:d,animate:{mount:{scale:1,y:0},unmount:{scale:.9,y:-100}},children:[e.jsx(l.DialogHeader,{children:e.jsxs("div",{className:"flex justify-between items-center w-full",children:[e.jsx("h1",{className:"text-xl font-semibold",children:"Following List"}),e.jsx("div",{children:e.jsx(V,{className:"text-3xl cursor-pointer",onClick:d})})]})}),e.jsx(E,{}),e.jsx(l.DialogBody,{className:"flex flex-col gap-4 lg:mx-4 lg:my-0 m-2 max-h-[20.5rem] overflow-y-scroll",children:e.jsx("div",{className:"flex flex-col gap-2 ",children:o.map(s=>e.jsxs("div",{className:"flex p-2 items-center justify-between transition duration-100 ease-in-out hover:shadow-md hover:scale-105 hover:rounded-lg",children:[e.jsx(B,{to:`/profile/${s._id}`,children:e.jsxs("div",{className:"mt-3 flex items-center space-x-2",children:[e.jsx("img",{className:"inline-block h-12 w-12 rounded-full",src:s.dp?s.dp:A.DEFAULT_IMG,alt:"user dp"}),e.jsxs("span",{className:"flex flex-col",children:[e.jsx("span",{className:"text-[14px] font-medium text-gray-900",children:s==null?void 0:s.name}),e.jsx("span",{className:"text-[11px] font-medium text-gray-500",children:s.username?`@${s.username}`:"@ -"})]})]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"flex justify-center items-center w-8 h-8 transition duration-300 ease-in-out bg-blue-gray-100 rounded-full cursor-pointer border-2 border-blue-gray-500 hover:border-green-500 hover:bg-white hover:border-3 group",onClick:()=>C(s._id),children:e.jsx(G,{className:"text-md text-socioverse-500 group-hover:text-green-500"})}),e.jsx("div",{className:"flex justify-center items-center w-8 h-8 transition duration-300 ease-in-out bg-blue-gray-100 rounded-full cursor-pointer border-2 border-blue-gray-500 hover:border-green-500 hover:bg-white hover:border-3 group",onClick:()=>F(s._id),children:e.jsx(W,{className:"text-xl text-socioverse-500  group-hover:text-green-500"})})]})]},s._id))})}),e.jsx(l.DialogFooter,{children:void 0})]})]})}function Re(){return e.jsxs("div",{className:"flex w-full flex-row items-center gap-2 rounded-[99px] border shadow-md border-black/40 bg-blue-gray-100/30 p-1 md:p-2",children:[e.jsx(l.Textarea,{rows:1,resize:!1,placeholder:"Start your post here...",className:"min-h-full !border-0 focus:border-transparent",containerProps:{className:"grid h-full"},labelProps:{className:"before:content-none after:content-none"}}),e.jsx("div",{children:e.jsx(l.IconButton,{variant:"text",className:"rounded-full text-blue-gray-700",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,className:"h-5 w-5",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 12L3.269 3.126A59.768 59.768 0 0121.485 12 59.77 59.77 0 013.27 20.876L5.999 12zm0 0h7.5"})})})})]})}function Ge(c){return ye({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},child:[{tag:"path",attr:{d:"M23 19a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h4l2-3h6l2 3h4a2 2 0 0 1 2 2z"}},{tag:"circle",attr:{cx:"12",cy:"13",r:"4"}}]})(c)}const We=()=>{const c=O();return He(async f=>await Ce(f),{onSuccess:f=>{c(ke(f))}})},qe=({open:c,handleOpen:f,setIsLastPage:g,setPostCreated:h})=>{const j=H(i=>i.auth.user),[a,p]=n.useState(!1),[u,o]=n.useState(null),[b,x]=n.useState(null),[S,y]=n.useState(!1),[_,U]=n.useState(null),[k,t]=n.useState(new FormData),[d,r]=n.useState([]),m=H(i=>i.post.image),L=O(),T=()=>p(!a),C=()=>y(!S),F=We(),s=async(i,N)=>{if(i.length>0)try{i.forEach((D,K)=>{N.append("files",D,`image${K}.jpg`)})}catch(D){console.error("Upload error:",D)}},I=i=>{r(N=>[...N,{blob:i,image:URL.createObjectURL(i)}]),C()},z=i=>{var N;if((N=i.target.files)!=null&&N.length&&i.target.files[0]){const D=i.target.files[0];D.type.startsWith("image/")?(U(D),y(!0)):w.warn("Only image files are allowed!",M)}},$=async()=>{if(m&&m.length>0){const i=d.map(N=>N.blob);await s(i,k)}if(u&&k.append("description",u),b&&k.append("hashtags",b),!u&&!b&&(!m||m.length===0))w.dismiss(),w.error("All the fields cannot be empty!",M);else try{const i=F.mutateAsync(k);w.promise(i,{pending:"Uploading the post...",success:"Post uploaded successfully",error:"Upload failed!"},{...M,position:"bottom-left",closeButton:!1}),await(i||F.isSuccess)?(g(!1),w.dismiss(),h((await i).post)):w.dismiss(),f(),x(null),o(null),U(null),L(Ie()),r([])}catch{w.dismiss(),w.error("Upload failed!",{...M,position:"bottom-left"})}t(new FormData)},q=i=>{L(De(i)),r(N=>N.filter(D=>D.image!==i))};return e.jsxs(e.Fragment,{children:[e.jsxs(l.Dialog,{open:c,size:"md",handler:f,dismiss:{enabled:!1},animate:{mount:{scale:1,y:0},unmount:{scale:.9,y:-100}},children:[e.jsx(E,{}),e.jsx(l.DialogHeader,{children:e.jsxs("div",{className:"flex justify-between items-center w-full",children:[e.jsx("div",{className:"flex items-center justify-between gap-5 transition-transform duration-300 mx-1 px-2 pb-3 rounded-lg cursor-pointer hover:bg-gray-200 hover:scale-105",children:j&&e.jsx(B,{to:`/profile/${j._id}`,children:e.jsxs("div",{className:"mt-3 flex items-center space-x-2",children:[e.jsx("img",{className:"inline-block h-12 w-12 rounded-full",src:j.dp?j.dp:A.DEFAULT_IMG,alt:"user dp"}),e.jsxs("span",{className:"flex flex-col",children:[e.jsx("span",{className:"text-[14px] font-bold text-gray-900",children:j.name}),e.jsx("span",{className:"text-[11px] font-bold text-green-500",children:"Post to Connections"})]})]})})}),e.jsx("div",{children:e.jsx(V,{className:"text-3xl cursor-pointer",onClick:f})})]})}),e.jsxs(l.DialogBody,{className:"flex flex-col gap-4 lg:mx-4 my-0 mx-2 px-4 py-0 md:px-4 md:py-4 max-h-[20.5rem] overflow-y-scroll",children:[e.jsx("div",{className:"w-full mb-20 sm:mb-12",children:e.jsx(Se,{textValue:u,setTextValue:o})}),a&&e.jsx("div",{className:"w-full",children:e.jsx(l.Input,{label:"Hashtags",value:b||"",onChange:i=>x(i.target.value)})}),m&&m.length>0&&e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsx("div",{className:"border border-black/20 py-5 md:py-10 flex flex-col gap-2 md:gap-5",children:m.map((i,N)=>e.jsx("div",{className:"h-56 md:h-[19rem] w-full relative",style:{backgroundImage:`url(${i})`,backgroundSize:"contain",backgroundRepeat:"no-repeat",backgroundPosition:"center"},children:e.jsx("div",{className:"absolute flex gap-3 bottom-5 right-4 md:bottom-3 md:right-16",children:e.jsx("div",{className:"flex justify-center items-center w-8 h-8 transition duration-300 ease-in-out bg-blue-gray-500 rounded-full cursor-pointer border-2 border-blue-gray-700 hover:border-red-700 hover:bg-white hover:border-3 group opacity-70 hover:opacity-100",children:e.jsx(_e,{className:"text-xl text-white group-hover:text-red-500",onClick:()=>q(i)})})})},N))}),m.length===5&&e.jsx("em",{className:"text-sm font-light text-right pr-1",children:"* Max of 5 images are allowed!"})]})]}),e.jsx(l.DialogFooter,{children:e.jsxs("div",{className:"float-left mx-4 mb-4 flex justify-between items-center w-full",children:[e.jsxs("div",{className:"flex justify-between items-center gap-3 mx-2",children:[e.jsx("div",{className:ie("flex justify-center items-center border-2 w-8 h-8 rounded-full cursor-pointer hover:border-socioverse-500 group",{"border-socioverse-500":a},{"border-black":!a}),onClick:T,children:e.jsx(Ue,{className:ie("text-2xl group-hover:text-socioverse-500",{"text-socioverse-500":a},{"text-black":!a})})}),e.jsx("input",{type:"file",accept:"image/*",id:"image-input",className:"hidden",onChange:z,disabled:(m==null?void 0:m.length)===5}),e.jsx("label",{htmlFor:"image-input",className:"flex justify-center items-center text-black border-black border-2 w-8 h-8 rounded-full cursor-pointer hover:border-socioverse-500 group",children:e.jsx(Ge,{className:"text-xl group-hover:text-socioverse-500"})})]}),e.jsx(l.Button,{size:"sm",className:"rounded-full bg-socioverse-500",onClick:$,children:"Post"})]})})]}),e.jsxs(l.Dialog,{open:S,size:"lg",handler:C,animate:{mount:{scale:1,y:0},unmount:{scale:.9,y:-100}},children:[e.jsx(l.DialogHeader,{children:e.jsxs("div",{className:"flex justify-between items-center w-full",children:[e.jsx("div",{className:"text-2xl",children:"Image"}),e.jsx("div",{children:e.jsx(V,{className:"text-3xl cursor-pointer",onClick:C})})]})}),e.jsx(l.DialogBody,{className:"lg:m-4 m-2",children:_?e.jsx("div",{className:"w-auto lg:h-[28rem] h-96 ",children:e.jsx(Ve,{image:URL.createObjectURL(_),getImage:I,aspectRatio:1.5/1})}):" "})]})]})},Ke=({handleUsernameInputPopup:c,usernameInputPopupOpen:f,setIsUsernameAvailable:g})=>{const h=O(),j=Fe().shape({username:Me().trim().matches(/^\S+$/,"Username cannot contain whitespace characters").min(3,"Username should be atleast 3 characters").required("Username is required")}),a=Ae({initialValues:{username:""},validationSchema:j,onSubmit:async p=>{try{const u=await Le(p.username);u.status==="success"?(h(Be(p.username)),g(!0),w.success("Username added successfully",{...M,position:"bottom-left"}),g(!0),c()):w.error(u.message,M)}catch(u){if(me(u)){const o=u;if(o.response&&o.response.status>=400&&o.response.status<=500){const b=o.response.data.message;w.error(b,M)}}}}});return e.jsxs(l.Dialog,{open:f,size:"md",handler:c,dismiss:{enabled:!1},animate:{mount:{scale:1,y:0},unmount:{scale:.9,y:-100}},children:[e.jsx(l.DialogHeader,{children:e.jsxs("div",{className:"flex justify-between items-center w-full",children:[e.jsx("div",{className:"text-2xl",children:"User Info"}),e.jsx("div",{})]})}),e.jsx(E,{}),e.jsx(l.DialogBody,{className:"mx-4 mb-8",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("div",{className:"text-md mb-6 border-2 p-4 rounded-lg bg-green-50 border-green-500",children:"Enter your username to continue, it should be unique!"}),e.jsxs("form",{onSubmit:a.handleSubmit,className:"flex items-start gap-5 justify-center",children:[e.jsx("div",{className:"w-[20rem]",children:e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx(l.Input,{type:"text",label:"Username",name:"username",value:a.values.username,onChange:a.handleChange,onBlur:a.handleBlur}),a.touched.username&&a.errors.username&&e.jsx("div",{className:"text-red-500 mt-[0.5rem] text-sm inline",children:a.errors.username})]})}),e.jsx(l.Button,{size:"lg",className:"bg-socioverse-500 hover:scale-105 text-white px-4 py-2 rounded-lg",disabled:!a.values.username,type:"submit",children:"Continue"})]})]})})]})},Qe=({user:c,socket:f})=>{const g=O(),[h,j]=n.useState([]),[a,p]=n.useState(!1),[u,o]=n.useState(1),[b,x]=n.useState(!1),[S,y]=n.useState(null),[_,U]=n.useState(null),[k,t]=n.useState(null),[d,r]=n.useState(null),[m,L]=n.useState(!0),[T,C]=n.useState(!1),F=Z();n.useEffect(()=>{c&&L(!!c.username)},[c]),n.useEffect(()=>{c&&C(!m)},[m,c]);const s=()=>{C(v=>!v)},I=async()=>{const v=await ce(u);j(v.posts),o(u+1),p(!1)};n.useEffect(()=>{I()},[]),n.useEffect(()=>{const v=document.getElementById("sentinel"),R=new IntersectionObserver(async ue=>{if(ue[0].isIntersecting&&!a&&!b){p(!0);const se=await ce(u);if(se.posts.length===0){x(!0),p(!1);return}else x(!1);j([...h,...se.posts]),o(u+1),p(!1)}});return R.observe(v),()=>{R.unobserve(v)}},[a,h,u,b]),n.useEffect(()=>{c||J().then(v=>{g(Y({user:v.user,accessToken:X.getState().auth.accessToken}))})},[g,c]);const[z,$]=n.useState(!1),q=()=>$(!z),i=()=>{$(!0)},[N,D]=n.useState(!1),[K,he]=n.useState(!1),P=v=>{D(v)},ee=v=>{he(v)};return S&&(j(h.filter(v=>v._id!==S)),y(null)),n.useEffect(()=>{_&&(j(h.filter(v=>v._id!==_)),U(null))},[h,_]),n.useEffect(()=>{k&&(j([{...k,newPostCreated:!0},...h]),t(null))},[k,h]),n.useEffect(()=>{d&&(j(h.map(v=>v._id===d._id?d:v)),r(null))},[d,h]),e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"lg:flex gap-3 items-start justify-between h-[80vh] lg:h-[85vh]",children:[e.jsx("aside",{className:"hidden lg:block w-3/12 px-3 sticky top-28 overflow-y-auto h-[80vh] no-scrollbar",children:e.jsx($e,{newFollowing:N,handleFollowingAdd:P,removeFollowing:K,handleFollowingRemove:ee,socket:f})}),e.jsxs("main",{className:"w-full lg:w-6/12 px-3 md:px-6 overflow-x-hidden overflow-y-auto h-[85vh] no-scrollbar flex flex-col items-center p-2",children:[e.jsxs("div",{className:"flex items-center justify-between w-full md:p-2 mb-8 gap-3 md:gap-5 sticky top-0 z-40",children:[e.jsx(l.Avatar,{variant:"circular",alt:"user dp",className:"border h-12 w-12 md:h-14 md:w-14 border-gray-500 p-0.5 cursor-pointer",src:c&&c.dp?c.dp:A.DEFAULT_IMG,onClick:()=>F(`/profile/${c&&c._id}`)}),e.jsx("div",{className:"w-full",onClick:i,children:e.jsx(Re,{})})]}),e.jsxs("div",{className:" overflow-y-auto h-[85vh] w-full no-scrollbar flex flex-col items-center",children:[e.jsxs("div",{className:"mb-10 max-w-[30rem] w-full",children:[h.map((v,R)=>e.jsx("div",{className:"mb-10 w-full",children:e.jsx(Oe,{postData:v,setDeletedPostId:y,setReportedPostId:U,setPostEdited:r})},R)),a&&e.jsx("div",{className:"w-full px-2",children:e.jsx(Te,{})}),e.jsx(qe,{open:z,handleOpen:q,setIsLastPage:x,setPostCreated:t})]}),b&&e.jsx("div",{children:" No posts..."}),e.jsx("div",{id:"sentinel",style:{height:"1px"},className:"w-full mb-4",children:!b&&e.jsx("div",{children:e.jsx("img",{src:Ee,className:"w-20 h-20 mx-auto mt-2 lg:mt-4"})})})]})]}),e.jsx("aside",{className:"hidden lg:block w-3/12 px-3 pb-5 sticky top-28 overflow-hidden",children:e.jsx(ze,{handleFollowingAdd:P,handleFollowingRemove:ee})})]}),e.jsx(Ke,{handleUsernameInputPopup:s,usernameInputPopupOpen:T,setIsUsernameAvailable:L})]})},Je=({user:c,socket:f})=>e.jsx(e.Fragment,{children:e.jsx(Qe,{user:c,socket:f})}),es=({socket:c})=>{const f=H(a=>a.auth),g=Z(),h=O();n.useEffect(()=>{f.isAuthenticated||j()||g("/error")},[f]);const j=async()=>{try{const{user:a}=await J(),{accessToken:p}=X.getState().auth;return h(Y({user:a,accessToken:p})),a}catch(a){if(me(a)){const p=a;p.response&&p.response.status>=400&&p.response.status<=500&&g("/login")}}};return e.jsx(e.Fragment,{children:e.jsx(Je,{user:f.user,socket:c})})};export{es as default};
